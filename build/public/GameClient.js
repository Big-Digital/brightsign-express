/*! For license information please see GameClient.js.LICENSE.txt */
var GameClient;(()=>{var e,t,i,s,r={35:(e,t,i)=>{"use strict";i.d(t,{g:()=>m});var s=i(4754),r=i(4537),n=i(3054),o=i(4049),a=i(3113),h=i(5686),l=i(2213),c=i(5098),u=i(1183),d=i(2050),_=i(427);function p(e,t,i=!1){const s=t.width,r=t.height;if(e instanceof Float32Array){let t=e.byteLength/e.BYTES_PER_ELEMENT;const i=new Uint8Array(t);for(;--t>=0;){let s=e[t];s<0?s=0:s>1&&(s=1),i[t]=255*s}e=i}const n=document.createElement("canvas");n.width=s,n.height=r;const o=n.getContext("2d");if(!o)return null;const a=o.createImageData(s,r);if(a.data.set(e),o.putImageData(a,0,0),i){const e=document.createElement("canvas");e.width=s,e.height=r;const t=e.getContext("2d");return t?(t.translate(0,r),t.scale(1,-1),t.drawImage(n,0,0),e.toDataURL("image/png")):null}return n.toDataURL("image/png")}var g=i(8795),f=i(979);class m extends a.t{static _CreateVideoTexture(e,t,i,s=!1,r=!1,n=m.TRILINEAR_SAMPLINGMODE,o={},a,h=5){throw(0,l.n)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(e,t,i,s,r=m.TRILINEAR_SAMPLINGMODE,o=null,a=null,h=null,l=!1,u,d,_,p,f){let b;super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new n.cP,this._isBlocking=!0,this.name=e||"",this.url=e;let v=!1,T=null,y=!0;"object"==typeof i&&null!==i?(b=i.noMipmap??!1,s=i.invertY??!g.rX,r=i.samplingMode??m.TRILINEAR_SAMPLINGMODE,o=i.onLoad??null,a=i.onError??null,h=i.buffer??null,l=i.deleteBuffer??!1,u=i.format,d=i.mimeType,_=i.loaderOptions,p=i.creationFlags,v=i.useSRGBBuffer??!1,T=i.internalTexture??null,y=i.gammaSpace??y,f=i.forcedExtension??f):b=!!i,this._gammaSpace=y,this._noMipmap=b,this._invertY=void 0===s?!g.rX:s,this._initialSamplingMode=r,this._buffer=h,this._deleteBuffer=l,this._mimeType=d,this._loaderOptions=_,this._creationFlags=p,this._useSRGBBuffer=v,this._forcedExtension=f,u&&(this._format=u);const x=this.getScene(),A=this._getEngine();if(!A)return;A.onBeforeTextureInitObservable.notifyObservers(this);const C=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),o&&o(),!this.isBlocking&&x&&x.resetCachedMaterial()},S=(e,t)=>{this._loadingError=!0,this._errorObject={message:e,exception:t},a&&a(e,t),m.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!T)return this._delayedOnLoad=C,void(this._delayedOnError=S);if(this._texture=T??this._getFromCache(this.url,b,r,this._invertY,v,this.isCube),this._texture)if(this._texture.isReady)c._.SetImmediate((()=>C()));else{const e=this._texture.onLoadedObservable.add(C);this._texture.onErrorObservable.add((t=>{S(t.message,t.exception),this._texture?.onLoadedObservable.remove(e)}))}else if(x&&x.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=S;else{try{this._texture=A.createTexture(this.url,b,this._invertY,x,r,C,S,this._buffer,void 0,this._format,this._forcedExtension,d,_,p,v)}catch(e){throw S("error loading",e),e}l&&(this._buffer=null)}}updateURL(e,t=null,i,s){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=s,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?c._.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(e,t,i,s){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,o.Pq.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,s),s.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,s.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,s.z+=this.wRotationCenter}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=o.uq.Zero(),this._rowGenerationMatrix=new o.uq,this._t0=o.Pq.Zero(),this._t1=o.Pq.Zero(),this._t2=o.Pq.Zero()),o.uq.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(o.uq.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,o.AA.Matrix[0]),o.uq.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,o.AA.Matrix[1]),o.uq.ScalingToRef(this._cachedUScale,this._cachedVScale,0,o.AA.Matrix[2]),o.uq.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,o.AA.Matrix[3]),o.AA.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(o.AA.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(o.AA.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(o.AA.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),o.uq.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.getScene();if(!t)return this._cachedTextureMatrix;const i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const e=this.getScene();if(!e)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==m.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=o.uq.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=o.uq.Zero());const t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case m.PLANAR_MODE:o.uq.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case m.PROJECTION_MODE:{o.uq.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const t=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=t.updateFlag,t.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:o.uq.IdentityToRef(this._cachedReflectionTextureMatrix)}return t&&e.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return f.p.Clone((()=>new m(this._texture?this._texture.url:null,this.getScene(),e)),this)}serialize(){const e=this.name;m.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const t=super.serialize(m._SerializeInternalTextureUniqueId);return t?((m.SerializeBuffers||m.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?t.base64String="data:image/png;base64,"+(0,_.EL)(this._buffer):(m.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?function(e,t=0,i=0){const s=e.getInternalTexture();if(!s)return null;const r=e._readPixelsSync(t,i);return r?p(r,e.getSize(),s.invertY):null}(this):async function(e,t=0,i=0){const s=e.getInternalTexture();if(!s)return null;const r=await e.readPixels(t,i);return r?p(r,e.getSize(),s.invertY):null}(this))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,m._SerializeInternalTextureUniqueId&&(t.internalTextureUniqueId=this._texture?.uniqueId),t.internalTextureLabel=this._texture?.label,t.noMipmap=this._noMipmap,this.name=e,t):null}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,i){if(e.customType){const s=u.n.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&s.updateSamplingMode&&s._samplingMode&&s._samplingMode!==e.samplingMode&&s.updateSamplingMode(e.samplingMode),s}if(e.isCube&&!e.isRenderTarget)return m._CubeTextureParser(e,t,i);const s=void 0!==e.internalTextureUniqueId;if(!e.name&&!e.isRenderTarget&&!s)return null;let r;if(s){const i=t.getEngine().getLoadedTexturesCache();for(const t of i)if(t.uniqueId===e.internalTextureUniqueId){r=t;break}}const n=t=>{if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),e.samplingMode){const i=e.samplingMode;t&&t.samplingMode!==i&&t.updateSamplingMode(i)}if(t&&e.animations)for(let i=0;i<e.animations.length;i++){const s=e.animations[i],r=(0,h.n9)("BABYLON.Animation");r&&t.animations.push(r.Parse(s))}t&&t._texture&&(s&&!r&&t._texture._setUniqueId(e.internalTextureUniqueId),t._texture.label=e.internalTextureLabel)};return f.p.Parse((()=>{let s=!0;if(e.noMipmap&&(s=!1),e.mirrorPlane){const i=m._CreateMirror(e.name,e.renderTargetSize,t,s);return i._waitingRenderList=e.renderList,i.mirrorPlane=d.Z.FromArray(e.mirrorPlane),n(i),i}if(e.isRenderTarget){let i=null;if(e.isCube){if(t.reflectionProbes)for(let i=0;i<t.reflectionProbes.length;i++){const s=t.reflectionProbes[i];if(s.name===e.name)return s.cubeTexture}}else i=m._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,s,e._creationFlags??0),i._waitingRenderList=e.renderList;return n(i),i}if(e.isVideo){const r=m._CreateVideoTexture(i+(e.url||e.name),i+(e.src||e.url),t,s,e.invertY,e.samplingMode,e.settings||{});return n(r),r}{let o;if(e.base64String&&!r)o=m.CreateFromBase64String(e.base64String,e.base64String,t,!s,e.invertY,e.samplingMode,(()=>{n(o)}),e._creationFlags??0,e._useSRGBBuffer??!1),o.name=e.name;else{let a;a=e.name&&(e.name.indexOf("://")>0||e.name.startsWith("data:"))?e.name:i+e.name,e.url&&(e.url.startsWith("data:")||m.UseSerializedUrlIfAny)&&(a=e.url);const h={noMipmap:!s,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{n(o)},internalTexture:r};o=new m(a,t,h)}return o}}),e,t)}static CreateFromBase64String(e,t,i,s,r,n=m.TRILINEAR_SAMPLINGMODE,o=null,a=null,h=5,l,c){return new m("data:"+t,i,s,r,n,o,a,e,!1,h,void 0,void 0,l,c)}static LoadFromDataString(e,t,i,s=!1,r,n=!0,o=m.TRILINEAR_SAMPLINGMODE,a=null,h=null,l=5,c,u){return"data:"!==e.substring(0,5)&&(e="data:"+e),new m(e,i,r,n,o,a,h,t,s,l,void 0,void 0,c,u)}}m.SerializeBuffers=!0,m.ForceSerializeBuffers=!1,m.OnTextureLoadErrorObservable=new n.cP,m._SerializeInternalTextureUniqueId=!1,m._CubeTextureParser=(e,t,i)=>{throw(0,l.n)("CubeTexture")},m._CreateMirror=(e,t,i,s)=>{throw(0,l.n)("MirrorTexture")},m._CreateRenderTargetTexture=(e,t,i,s,r)=>{throw(0,l.n)("RenderTargetTexture")},m.NEAREST_SAMPLINGMODE=1,m.NEAREST_NEAREST_MIPLINEAR=8,m.BILINEAR_SAMPLINGMODE=2,m.LINEAR_LINEAR_MIPNEAREST=11,m.TRILINEAR_SAMPLINGMODE=3,m.LINEAR_LINEAR_MIPLINEAR=3,m.NEAREST_NEAREST_MIPNEAREST=4,m.NEAREST_LINEAR_MIPNEAREST=5,m.NEAREST_LINEAR_MIPLINEAR=6,m.NEAREST_LINEAR=7,m.NEAREST_NEAREST=1,m.LINEAR_NEAREST_MIPNEAREST=9,m.LINEAR_NEAREST_MIPLINEAR=10,m.LINEAR_LINEAR=2,m.LINEAR_NEAREST=12,m.EXPLICIT_MODE=0,m.SPHERICAL_MODE=1,m.PLANAR_MODE=2,m.CUBIC_MODE=3,m.PROJECTION_MODE=4,m.SKYBOX_MODE=5,m.INVCUBIC_MODE=6,m.EQUIRECTANGULAR_MODE=7,m.FIXED_EQUIRECTANGULAR_MODE=8,m.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,m.CLAMP_ADDRESSMODE=0,m.WRAP_ADDRESSMODE=1,m.MIRROR_ADDRESSMODE=2,m.UseSerializedUrlIfAny=!1,(0,s.Cg)([(0,r.lK)()],m.prototype,"url",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"uOffset",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"vOffset",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"uScale",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"vScale",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"uAng",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"vAng",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"wAng",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"uRotationCenter",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"vRotationCenter",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"wRotationCenter",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"homogeneousRotationInUVTransform",void 0),(0,s.Cg)([(0,r.lK)()],m.prototype,"isBlocking",null),(0,h.Y5)("BABYLON.Texture",m),f.p._TextureParser=m.Parse},108:(e,t,i)=>{"use strict";i.d(t,{V:()=>f});var s=i(4049),r=i(451),n=i(2605),o=i(766),a=i(9593),h=i(6523),l=i(1717),c=i(9732),u=i(641),d=i(8421),_=i(1497),p=i(8795),g=i(2465);class f{get boundingBias(){return this._boundingBias}set boundingBias(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)}static CreateGeometryForMesh(e){const t=new f(f.RandomId(),e.getScene());return t.applyToMesh(e),t}get meshes(){return this._meshes}constructor(e,t,i,s=!1,r=null){this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||_.q.LastCreatedScene,this._scene&&(this.id=e,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=s,i?this.setAllVerticesData(i,s):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),r&&(this.applyToMesh(r),r.computeWorldMatrix(!0)))}get extend(){return this._extend}getScene(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const e=new Set;for(const t in this._vertexBuffers)e.add(this._vertexBuffers[t].getWrapperBuffer());e.forEach((e=>{e._rebuild()}))}setAllVerticesData(e,t){e.applyToGeometry(this,t),this._notifyUpdate()}setVerticesData(e,t,i=!1,s){i&&Array.isArray(t)&&(t=new Float32Array(t));const r=new o.R(this._engine,t,e,{updatable:i,postponeInternalCreation:0===this._meshes.length,stride:s,label:"Geometry_"+this.id+"_"+e});this.setVerticesBuffer(r)}removeVerticesData(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(e,t=null,i=!0){const r=e.getKind();this._vertexBuffers[r]&&i&&this._vertexBuffers[r].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[r]=e;const n=this._meshes,a=n.length;if(r===o.R.PositionKind){this._totalVertices=t??e._maxVerticesCount,this._updateExtend(e.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const i=this._extend&&this._extend.minimum||new s.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=this._extend&&this._extend.maximum||new s.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let e=0;e<a;e++){const t=n[e];t.buildBoundingInfo(i,r),t._createGlobalSubMesh(t.isUnIndexed),t.computeWorldMatrix(!0),t.synchronizeInstances()}}this._notifyUpdate(r)}updateVerticesDataDirectly(e,t,i,s=!1){const r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,i,s),this._notifyUpdate(e))}updateVerticesData(e,t,i=!1){const s=this.getVertexBuffer(e);s&&(s.update(t),e===o.R.PositionKind&&(this._totalVertices=s._maxVerticesCount,this._updateBoundingInfo(i,t)),this._notifyUpdate(e))}_updateBoundingInfo(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e){const e=this._meshes;for(const t of e){t.hasBoundingInfo?t.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):t.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const e=t.subMeshes;for(const t of e)t.refreshBoundingInfo()}}}_bind(e,t,i,s){if(!e)return;void 0===t&&(t=this._indexBuffer);const r=this.getVertexBuffers();if(!r)return;if(t!=this._indexBuffer||!this._vertexArrayObjects&&!s)return void this._engine.bindBuffers(r,t,e,i);const n=s||this._vertexArrayObjects,o=this._engine;n[e.key]||(n[e.key]=o.recordVertexArrayObject(r,t,e,i)),o.bindVertexArrayObject(n[e.key],t)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(e,t,i){const s=this.getVertexBuffer(e);return s?s.getFloatData(this._totalVertices,i||t&&1!==this._meshes.length):null}copyVerticesData(e,t){const i=this.getVertexBuffer(e);if(!i)return;t[e]||(t[e]=new Float32Array(this._totalVertices*i.getSize()));const s=i.getData();s&&(0,g.gs)(s,i.getSize(),i.type,i.byteOffset,i.byteStride,i.normalized,this._totalVertices,t[e])}isVertexBufferUpdatable(e){const t=this._vertexBuffers[e];return!!t&&t.isUpdatable()}getVertexBuffer(e){return this.isReady()?this._vertexBuffers[e]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}getVerticesDataKinds(){const e=[];let t;if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e}updateIndices(e,t,i=!1){if(this._indexBuffer)if(this._indexBufferIsUpdatable){const s=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),s)for(const e of this._meshes)e._createGlobalSubMesh(!0)}else this.setIndices(e,null,!0)}setIndexBuffer(e,t,i){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=e,this._totalVertices=t,this._totalIndices=i,e.is32Bits||(e.is32Bits=this._totalIndices>65535);for(const e of this._meshes)e._createGlobalSubMesh(!0),e.synchronizeInstances();this._notifyUpdate()}setIndices(e,t=null,i=!1,s=!1){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i,"Geometry_"+this.id+"_IndexBuffer")),null!=t&&(this._totalVertices=t);for(const e of this._meshes)e._createGlobalSubMesh(!s),e.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}getIndices(e,t){if(!this.isReady())return null;const i=this._indices;return t||e&&1!==this._meshes.length?i.slice():i}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(e=null){e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])}releaseForMesh(e,t){const i=this._meshes,s=i.indexOf(e);-1!==s&&(i.splice(s,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,0===i.length&&t&&this.dispose())}applyToMesh(e){if(e._geometry===this)return;const t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();const i=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}_updateExtend(e=null){if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&!(e=this.getVerticesData(o.R.PositionKind)))return;this._extend=(0,d.b8)(e,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(e){const t=this._meshes.length;for(const i in this._vertexBuffers)1===t&&this._vertexBuffers[i].create(),i===o.R.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()}_notifyUpdate(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const e of this._meshes)e._markSubMeshesAsAttributesDirty()}load(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))}_queueLoad(e,t){this.delayLoadingFile&&(e.addPendingData(this),e._loadFile(this.delayLoadingFile,(i=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(i),this),this.delayLoadState=1,this._delayInfo=[],e.removePendingData(this);const s=this._meshes,r=s.length;for(let e=0;e<r;e++)this._applyToMesh(s[e]);t&&t()}),void 0,!0))}toLeftHanded(){const e=this.getIndices(!1);if(null!=e&&e.length>0){for(let t=0;t<e.length;t+=3){const i=e[t+0];e[t+0]=e[t+2],e[t+2]=i}this.setIndices(e)}const t=this.getVerticesData(o.R.PositionKind,!1);if(null!=t&&t.length>0){for(let e=0;e<t.length;e+=3)t[e+2]=-t[e+2];this.setVerticesData(o.R.PositionKind,t,!1)}const i=this.getVerticesData(o.R.NormalKind,!1);if(null!=i&&i.length>0){for(let e=0;e<i.length;e+=3)i[e+2]=-i[e+2];this.setVerticesData(o.R.NormalKind,i,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const e=this.getVerticesData(o.R.PositionKind);if(!e||0===e.length)return!1;for(let t=3*this._positionsCache.length,i=this._positionsCache.length;t<e.length;t+=3,++i)this._positionsCache[i]=s.Pq.FromArray(e,t);for(let t=0,i=0;t<e.length;t+=3,++i)this._positionsCache[i].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0}isDisposed(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};const e=this._meshes,t=e.length;for(let i=0;i<t;i++)e[i]._invalidateInstanceVertexArrayObject()}}dispose(){const e=this._meshes,t=e.length;let i;for(i=0;i<t;i++)this.releaseForMesh(e[i]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const e in this._vertexBuffers)this._vertexBuffers[e].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const e=this._parentContainer.geometries.indexOf(this);e>-1&&this._parentContainer.geometries.splice(e,1),this._parentContainer=null}this._isDisposed=!0}copy(e){const t=new n.P;t.indices=[];const i=this.getIndices();if(i)for(let e=0;e<i.length;e++)t.indices.push(i[e]);let s,r=!1,o=!1;for(s in this._vertexBuffers){const e=this.getVerticesData(s);if(e&&(e instanceof Float32Array?t.set(new Float32Array(e),s):t.set(e.slice(0),s),!o)){const e=this.getVertexBuffer(s);e&&(r=e.isUpdatable(),o=!r)}}const a=new f(e,this._scene,t,r);for(s in a.delayLoadState=this.delayLoadState,a.delayLoadingFile=this.delayLoadingFile,a._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)a._delayInfo=a._delayInfo||[],a._delayInfo.push(s);return a._boundingInfo=new l.j(this._extend.minimum,this._extend.maximum),a}serialize(){const e={};return e.id=this.id,e.uniqueId=this.uniqueId,e.updatable=this._updatable,u.Y&&u.Y.HasTags(this)&&(e.tags=u.Y.GetTags(this)),e}_toNumberArray(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const e in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)}serializeVerticeData(){const e=this.serialize();return this.isVerticesDataPresent(o.R.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(o.R.PositionKind)),this.isVertexBufferUpdatable(o.R.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(o.R.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(o.R.NormalKind)),this.isVertexBufferUpdatable(o.R.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(o.R.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(o.R.TangentKind)),this.isVertexBufferUpdatable(o.R.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(o.R.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(o.R.UVKind)),this.isVertexBufferUpdatable(o.R.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(o.R.UV2Kind)&&(e.uvs2=this._toNumberArray(this.getVerticesData(o.R.UV2Kind)),this.isVertexBufferUpdatable(o.R.UV2Kind)&&(e.uvs2._updatable=!0)),this.isVerticesDataPresent(o.R.UV3Kind)&&(e.uvs3=this._toNumberArray(this.getVerticesData(o.R.UV3Kind)),this.isVertexBufferUpdatable(o.R.UV3Kind)&&(e.uvs3._updatable=!0)),this.isVerticesDataPresent(o.R.UV4Kind)&&(e.uvs4=this._toNumberArray(this.getVerticesData(o.R.UV4Kind)),this.isVertexBufferUpdatable(o.R.UV4Kind)&&(e.uvs4._updatable=!0)),this.isVerticesDataPresent(o.R.UV5Kind)&&(e.uvs5=this._toNumberArray(this.getVerticesData(o.R.UV5Kind)),this.isVertexBufferUpdatable(o.R.UV5Kind)&&(e.uvs5._updatable=!0)),this.isVerticesDataPresent(o.R.UV6Kind)&&(e.uvs6=this._toNumberArray(this.getVerticesData(o.R.UV6Kind)),this.isVertexBufferUpdatable(o.R.UV6Kind)&&(e.uvs6._updatable=!0)),this.isVerticesDataPresent(o.R.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(o.R.ColorKind)),this.isVertexBufferUpdatable(o.R.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(o.R.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(o.R.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(o.R.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(o.R.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(o.R.MatricesWeightsKind)),this.isVertexBufferUpdatable(o.R.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e}static ExtractFromMesh(e,t){const i=e._geometry;return i?i.copy(t):null}static RandomId(){return c.S0.RandomId()}static _GetGeometryByLoadedUniqueId(e,t){for(let i=0;i<t.geometries.length;i++)if(t.geometries[i]._loadedUniqueId===e)return t.geometries[i];return null}static _ImportGeometry(e,t){const i=t.getScene(),s=e.geometryUniqueId,n=e.geometryId;if(s||n){const e=s?this._GetGeometryByLoadedUniqueId(s,i):i.getGeometryById(n);e&&e.applyToMesh(t)}else if(e instanceof ArrayBuffer){const i=t._binaryInfo;if(i.positionsAttrDesc&&i.positionsAttrDesc.count>0){const s=new Float32Array(e,i.positionsAttrDesc.offset,i.positionsAttrDesc.count);t.setVerticesData(o.R.PositionKind,s,!1)}if(i.normalsAttrDesc&&i.normalsAttrDesc.count>0){const s=new Float32Array(e,i.normalsAttrDesc.offset,i.normalsAttrDesc.count);t.setVerticesData(o.R.NormalKind,s,!1)}if(i.tangetsAttrDesc&&i.tangetsAttrDesc.count>0){const s=new Float32Array(e,i.tangetsAttrDesc.offset,i.tangetsAttrDesc.count);t.setVerticesData(o.R.TangentKind,s,!1)}if(i.uvsAttrDesc&&i.uvsAttrDesc.count>0){const s=new Float32Array(e,i.uvsAttrDesc.offset,i.uvsAttrDesc.count);if(p.rX)for(let e=1;e<s.length;e+=2)s[e]=1-s[e];t.setVerticesData(o.R.UVKind,s,!1)}if(i.uvs2AttrDesc&&i.uvs2AttrDesc.count>0){const s=new Float32Array(e,i.uvs2AttrDesc.offset,i.uvs2AttrDesc.count);if(p.rX)for(let e=1;e<s.length;e+=2)s[e]=1-s[e];t.setVerticesData(o.R.UV2Kind,s,!1)}if(i.uvs3AttrDesc&&i.uvs3AttrDesc.count>0){const s=new Float32Array(e,i.uvs3AttrDesc.offset,i.uvs3AttrDesc.count);if(p.rX)for(let e=1;e<s.length;e+=2)s[e]=1-s[e];t.setVerticesData(o.R.UV3Kind,s,!1)}if(i.uvs4AttrDesc&&i.uvs4AttrDesc.count>0){const s=new Float32Array(e,i.uvs4AttrDesc.offset,i.uvs4AttrDesc.count);if(p.rX)for(let e=1;e<s.length;e+=2)s[e]=1-s[e];t.setVerticesData(o.R.UV4Kind,s,!1)}if(i.uvs5AttrDesc&&i.uvs5AttrDesc.count>0){const s=new Float32Array(e,i.uvs5AttrDesc.offset,i.uvs5AttrDesc.count);if(p.rX)for(let e=1;e<s.length;e+=2)s[e]=1-s[e];t.setVerticesData(o.R.UV5Kind,s,!1)}if(i.uvs6AttrDesc&&i.uvs6AttrDesc.count>0){const s=new Float32Array(e,i.uvs6AttrDesc.offset,i.uvs6AttrDesc.count);if(p.rX)for(let e=1;e<s.length;e+=2)s[e]=1-s[e];t.setVerticesData(o.R.UV6Kind,s,!1)}if(i.colorsAttrDesc&&i.colorsAttrDesc.count>0){const s=new Float32Array(e,i.colorsAttrDesc.offset,i.colorsAttrDesc.count);t.setVerticesData(o.R.ColorKind,s,!1,i.colorsAttrDesc.stride)}if(i.matricesIndicesAttrDesc&&i.matricesIndicesAttrDesc.count>0){const s=new Int32Array(e,i.matricesIndicesAttrDesc.offset,i.matricesIndicesAttrDesc.count),r=[];for(let e=0;e<s.length;e++){const t=s[e];r.push(255&t),r.push((65280&t)>>8),r.push((16711680&t)>>16),r.push(t>>24&255)}t.setVerticesData(o.R.MatricesIndicesKind,r,!1)}if(i.matricesIndicesExtraAttrDesc&&i.matricesIndicesExtraAttrDesc.count>0){const s=new Int32Array(e,i.matricesIndicesExtraAttrDesc.offset,i.matricesIndicesExtraAttrDesc.count),r=[];for(let e=0;e<s.length;e++){const t=s[e];r.push(255&t),r.push((65280&t)>>8),r.push((16711680&t)>>16),r.push(t>>24&255)}t.setVerticesData(o.R.MatricesIndicesExtraKind,r,!1)}if(i.matricesWeightsAttrDesc&&i.matricesWeightsAttrDesc.count>0){const s=new Float32Array(e,i.matricesWeightsAttrDesc.offset,i.matricesWeightsAttrDesc.count);t.setVerticesData(o.R.MatricesWeightsKind,s,!1)}if(i.indicesAttrDesc&&i.indicesAttrDesc.count>0){const s=new Int32Array(e,i.indicesAttrDesc.offset,i.indicesAttrDesc.count);t.setIndices(s,null)}if(i.subMeshesAttrDesc&&i.subMeshesAttrDesc.count>0){const s=new Int32Array(e,i.subMeshesAttrDesc.offset,5*i.subMeshesAttrDesc.count);t.subMeshes=[];for(let e=0;e<i.subMeshesAttrDesc.count;e++){const i=s[5*e+0],r=s[5*e+1],n=s[5*e+2],o=s[5*e+3],h=s[5*e+4];a.K.AddToMesh(i,r,n,o,h,t)}}}else if(e.positions&&e.normals&&e.indices){if(t.setVerticesData(o.R.PositionKind,e.positions,e.positions._updatable),t.setVerticesData(o.R.NormalKind,e.normals,e.normals._updatable),e.tangents&&t.setVerticesData(o.R.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&t.setVerticesData(o.R.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&t.setVerticesData(o.R.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&t.setVerticesData(o.R.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&t.setVerticesData(o.R.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&t.setVerticesData(o.R.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&t.setVerticesData(o.R.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&t.setVerticesData(o.R.ColorKind,r.ov.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(o.R.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{const i=[];for(let t=0;t<e.matricesIndices.length;t++){const s=e.matricesIndices[t];i.push(255&s),i.push((65280&s)>>8),i.push((16711680&s)>>16),i.push(s>>24&255)}t.setVerticesData(o.R.MatricesIndicesKind,i,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(o.R.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{const i=[];for(let t=0;t<e.matricesIndicesExtra.length;t++){const s=e.matricesIndicesExtra[t];i.push(255&s),i.push((65280&s)>>8),i.push((16711680&s)>>16),i.push(s>>24&255)}t.setVerticesData(o.R.MatricesIndicesExtraKind,i,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(f._CleanMatricesWeights(e,t),t.setVerticesData(o.R.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&t.setVerticesData(o.R.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),t.setIndices(e.indices,null)}if(e.subMeshes){t.subMeshes=[];for(let i=0;i<e.subMeshes.length;i++){const s=e.subMeshes[i];a.K.AddToMesh(s.materialIndex,s.verticesStart,s.verticesCount,s.indexStart,s.indexCount,t)}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),t._shouldGenerateFlatShading=!1),t.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(t)}static _CleanMatricesWeights(e,t){const i=.001;if(!h.B.CleanBoneMatrixWeights)return;let s=0;if(!(e.skeletonId>-1))return;{const i=t.getScene().getLastSkeletonById(e.skeletonId);if(!i)return;s=i.bones.length}const r=t.getVerticesData(o.R.MatricesIndicesKind),n=t.getVerticesData(o.R.MatricesIndicesExtraKind),a=e.matricesWeights,l=e.matricesWeightsExtra,c=e.numBoneInfluencer,u=a.length;for(let e=0;e<u;e+=4){let t=0,o=-1;for(let s=0;s<4;s++){const r=a[e+s];t+=r,r<i&&o<0&&(o=s)}if(l)for(let s=0;s<4;s++){const r=l[e+s];t+=r,r<i&&o<0&&(o=s+4)}if((o<0||o>c-1)&&(o=c-1),t>i){const i=1/t;for(let t=0;t<4;t++)a[e+t]*=i;if(l)for(let t=0;t<4;t++)l[e+t]*=i}else o>=4?(l[e+o-4]=1-t,n[e+o-4]=s):(a[e+o]=1-t,r[e+o]=s)}t.setVerticesData(o.R.MatricesIndicesKind,r),e.matricesWeightsExtra&&t.setVerticesData(o.R.MatricesIndicesExtraKind,n)}static Parse(e,t,i){const r=new f(e.id,t,void 0,e.updatable);return r._loadedUniqueId=e.uniqueId,u.Y&&u.Y.AddTagsTo(r,e.tags),e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r._boundingInfo=new l.j(s.Pq.FromArray(e.boundingBoxMinimum),s.Pq.FromArray(e.boundingBoxMaximum)),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(o.R.UVKind),e.hasUVs2&&r._delayInfo.push(o.R.UV2Kind),e.hasUVs3&&r._delayInfo.push(o.R.UV3Kind),e.hasUVs4&&r._delayInfo.push(o.R.UV4Kind),e.hasUVs5&&r._delayInfo.push(o.R.UV5Kind),e.hasUVs6&&r._delayInfo.push(o.R.UV6Kind),e.hasColors&&r._delayInfo.push(o.R.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(o.R.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(o.R.MatricesWeightsKind),r._delayLoadingFunction=n.P.ImportVertexData):n.P.ImportVertexData(e,r),t.pushGeometry(r,!0),r}}},109:(e,t,i)=>{"use strict";i.d(t,{G:()=>n});var s=i(4049),r=i(766);class n{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(e=!1,t=!0){if(!this.pickedMesh||t&&!this.pickedMesh.isVerticesDataPresent(r.R.NormalKind))return null;let i,n=this.pickedMesh.getIndices();0===n?.length&&(n=null);const o=s.AA.Vector3[0],a=s.AA.Vector3[1],h=s.AA.Vector3[2];if(t){const e=this.pickedMesh.getVerticesData(r.R.NormalKind);let t=n?s.Pq.FromArrayToRef(e,3*n[3*this.faceId],o):o.copyFromFloats(e[3*this.faceId*3],e[3*this.faceId*3+1],e[3*this.faceId*3+2]),l=n?s.Pq.FromArrayToRef(e,3*n[3*this.faceId+1],a):a.copyFromFloats(e[3*(3*this.faceId+1)],e[3*(3*this.faceId+1)+1],e[3*(3*this.faceId+1)+2]),c=n?s.Pq.FromArrayToRef(e,3*n[3*this.faceId+2],h):h.copyFromFloats(e[3*(3*this.faceId+2)],e[3*(3*this.faceId+2)+1],e[3*(3*this.faceId+2)+2]);t=t.scale(this.bu),l=l.scale(this.bv),c=c.scale(1-this.bu-this.bv),i=new s.Pq(t.x+l.x+c.x,t.y+l.y+c.y,t.z+l.z+c.z)}else{const e=this.pickedMesh.getVerticesData(r.R.PositionKind),t=n?s.Pq.FromArrayToRef(e,3*n[3*this.faceId],o):o.copyFromFloats(e[3*this.faceId*3],e[3*this.faceId*3+1],e[3*this.faceId*3+2]),l=n?s.Pq.FromArrayToRef(e,3*n[3*this.faceId+1],a):a.copyFromFloats(e[3*(3*this.faceId+1)],e[3*(3*this.faceId+1)+1],e[3*(3*this.faceId+1)+2]),c=n?s.Pq.FromArrayToRef(e,3*n[3*this.faceId+2],h):h.copyFromFloats(e[3*(3*this.faceId+2)],e[3*(3*this.faceId+2)+1],e[3*(3*this.faceId+2)+2]),u=t.subtract(l),d=c.subtract(l);i=s.Pq.Cross(u,d)}const l=(e,t)=>{let i=e.getWorldMatrix();e.nonUniformScaling&&(s.AA.Matrix[0].copyFrom(i),i=s.AA.Matrix[0],i.setTranslationFromFloats(0,0,0),i.invert(),i.transposeToRef(s.AA.Matrix[1]),i=s.AA.Matrix[1]),s.Pq.TransformNormalToRef(t,i,t)};if(e&&l(this.pickedMesh,i),this.ray){const t=s.AA.Vector3[0].copyFrom(i);e||l(this.pickedMesh,t),s.Pq.Dot(t,this.ray.direction)>0&&i.negateInPlace()}return i.normalize(),i}getTextureCoordinates(e=r.R.UVKind){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e))return null;const t=this.pickedMesh.getIndices();if(!t)return null;const i=this.pickedMesh.getVerticesData(e);if(!i)return null;let n=s.I9.FromArray(i,2*t[3*this.faceId]),o=s.I9.FromArray(i,2*t[3*this.faceId+1]),a=s.I9.FromArray(i,2*t[3*this.faceId+2]);return n=n.scale(this.bu),o=o.scale(this.bv),a=a.scale(1-this.bu-this.bv),new s.I9(n.x+o.x+a.x,n.y+o.y+a.y)}}},117:(e,t,i)=>{"use strict";i.d(t,{m:()=>a});var s=i(1425),r=i(4049);class n{set opaqueSortCompareFn(e){this._opaqueSortCompareFn=e||n.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(e){this._alphaTestSortCompareFn=e||n.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(e){this._transparentSortCompareFn=e||n.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(e,t,i=null,r=null,n=null){this.index=e,this._opaqueSubMeshes=new s.L(256),this._transparentSubMeshes=new s.L(256),this._alphaTestSubMeshes=new s.L(256),this._depthOnlySubMeshes=new s.L(256),this._particleSystems=new s.L(256),this._spriteManagers=new s.L(256),this._empty=!0,this._edgesRenderers=new s.b(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=r,this.transparentSortCompareFn=n}render(e,t,i,s){if(e)return void e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const r=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(r.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),r.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const n=r.getStencilBuffer();if(r.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(s),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(r.setStencilBuffer(n),this._scene.useOrderIndependentTransparency){const e=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);e.length&&this._renderTransparent(e)}else this._renderTransparent(this._transparentSubMeshes);r.setAlphaMode(0)}if(r.setStencilBuffer(!1),this._edgesRenderers.length){for(let e=0;e<this._edgesRenderers.length;e++)this._edgesRenderers.data[e].render();r.setAlphaMode(0)}r.setStencilBuffer(n)}_renderOpaqueSorted(e){n._RenderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(e){n._RenderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(e){n._RenderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(e,t,i,s){let o,a=0;const h=i?i.globalPosition:n._ZeroVector;if(s)for(;a<e.length;a++)o=e.data[a],o._alphaIndex=o.getMesh().alphaIndex,o._distanceToCamera=r.Pq.Distance(o.getBoundingInfo().boundingSphere.centerWorld,h);const l=e.length===e.data.length?e.data:e.data.slice(0,e.length);t&&l.sort(t);const c=l[0].getMesh().getScene();for(a=0;a<l.length;a++)if(o=l[a],!c._activeMeshesFrozenButKeepClipping||o.isInFrustum(c._frustumPlanes)){if(s){const e=o.getMaterial();if(e&&e.needDepthPrePass){const t=e.getScene().getEngine();t.setColorWrite(!1),t.setAlphaMode(0),o.render(!1),t.setColorWrite(!0)}}o.render(s)}}static defaultTransparentSortCompare(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:n.backToFrontSortCompare(e,t)}static backToFrontSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}static frontToBackSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0}static PainterSortCompare(e,t){const i=e.getMesh(),s=t.getMesh();return i.material&&s.material?i.material.uniqueId-s.material.uniqueId:i.uniqueId-s.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(e,t,i){void 0===t&&(t=e.getMesh()),void 0===i&&(i=e.getMaterial()),null!=i&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTestingForMesh(t)?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t.isEnabled()&&t.isVisible&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}dispatchSprites(e){this._spriteManagers.push(e),this._empty=!1}dispatchParticles(e){this._particleSystems.push(e),this._empty=!1}_renderParticles(e){if(0===this._particleSystems.length)return;const t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const s=this._particleSystems.data[i];if(0===(t&&t.layerMask&s.layerMask))continue;const r=s.emitter;r.position&&e&&-1===e.indexOf(r)||this._scene._activeParticles.addCount(s.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let t=0;t<this._spriteManagers.length;t++){const i=this._spriteManagers.data[t];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}n._ZeroVector=r.Pq.Zero();class o{}class a{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(e){e!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=e,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const e of this._scene.meshes)if(e.subMeshes)for(const t of e.subMeshes)t._wasDispatched=!1;if(this._scene.spriteManagers)for(const e of this._scene.spriteManagers)e._wasDispatched=!1;for(const e of this._scene.particleSystems)e._wasDispatched=!1}constructor(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new o,this._maintainStateBetweenFrames=!1,this._scene=e;for(let e=a.MIN_RENDERINGGROUPS;e<a.MAX_RENDERINGGROUPS;e++)this._autoClearDepthStencil[e]={autoClear:!0,depth:!0,stencil:!0}}getRenderingGroup(e){const t=e||0;return this._prepareRenderingGroup(t),this._renderingGroups[t]}_clearDepthStencilBuffer(e=!0,t=!0){this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)}render(e,t,i,s){const r=this._renderingGroupInfo;if(r.scene=this._scene,r.camera=this._scene.activeCamera,r.renderingManager=this,this._scene.spriteManagers&&s)for(let e=0;e<this._scene.spriteManagers.length;e++){const t=this._scene.spriteManagers[e];this.dispatchSprites(t)}for(let n=a.MIN_RENDERINGGROUPS;n<a.MAX_RENDERINGGROUPS;n++){this._depthStencilBufferAlreadyCleaned=n===a.MIN_RENDERINGGROUPS;const o=this._renderingGroups[n];if(!o||o._empty)continue;const h=1<<n;if(r.renderingGroupId=n,this._scene.onBeforeRenderingGroupObservable.notifyObservers(r,h),a.AUTOCLEAR){const e=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(n):this._autoClearDepthStencil[n];e&&e.autoClear&&this._clearDepthStencilBuffer(e.depth,e.stencil)}for(const e of this._scene._beforeRenderingGroupDrawStage)e.action(n);o.render(e,s,i,t);for(const e of this._scene._afterRenderingGroupDrawStage)e.action(n);this._scene.onAfterRenderingGroupObservable.notifyObservers(r,h)}}reset(){if(!this.maintainStateBetweenFrames)for(let e=a.MIN_RENDERINGGROUPS;e<a.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let e=a.MIN_RENDERINGGROUPS;e<a.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let e=a.MIN_RENDERINGGROUPS;e<a.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.dispose()}}_prepareRenderingGroup(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new n(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}dispatchSprites(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchSprites(e))}dispatchParticles(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchParticles(e))}dispatch(e,t,i){void 0===t&&(t=e.getMesh()),this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatch(e,t,i))}setRenderingOrder(e,t=null,i=null,s=null){if(this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=s,this._renderingGroups[e]){const t=this._renderingGroups[e];t.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],t.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],t.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}setRenderingAutoClearDepthStencil(e,t,i=!0,s=!0){this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:s}}getAutoClearDepthStencilSetup(e){return this._autoClearDepthStencil[e]}}a.MAX_RENDERINGGROUPS=4,a.MIN_RENDERINGGROUPS=0,a.AUTOCLEAR=!0},156:(e,t,i)=>{"use strict";i.d(t,{I:()=>o});var s=i(959),r=i(4049),n=i(7761);class o{constructor(e,t,i){this.vectors=(0,s.mI)(8,r.Pq.Zero),this.center=r.Pq.Zero(),this.centerWorld=r.Pq.Zero(),this.extendSize=r.Pq.Zero(),this.extendSizeWorld=r.Pq.Zero(),this.directions=(0,s.mI)(3,r.Pq.Zero),this.vectorsWorld=(0,s.mI)(8,r.Pq.Zero),this.minimumWorld=r.Pq.Zero(),this.maximumWorld=r.Pq.Zero(),this.minimum=r.Pq.Zero(),this.maximum=r.Pq.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,t,i)}reConstruct(e,t,i){const s=e.x,n=e.y,o=e.z,a=t.x,h=t.y,l=t.z,c=this.vectors;this.minimum.copyFromFloats(s,n,o),this.maximum.copyFromFloats(a,h,l),c[0].copyFromFloats(s,n,o),c[1].copyFromFloats(a,h,l),c[2].copyFromFloats(a,n,o),c[3].copyFromFloats(s,h,o),c[4].copyFromFloats(s,n,l),c[5].copyFromFloats(a,h,o),c[6].copyFromFloats(s,h,l),c[7].copyFromFloats(a,n,l),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||r.uq.IdentityReadOnly,this._update(this._worldMatrix)}scale(e){const t=o._TmpVector3,i=this.maximum.subtractToRef(this.minimum,t[0]),s=i.length();i.normalizeFromLength(s);const r=s*e,n=i.scaleInPlace(.5*r),a=this.center.subtractToRef(n,t[1]),h=this.center.addToRef(n,t[2]);return this.reConstruct(a,h,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){const t=this.minimumWorld,i=this.maximumWorld,s=this.directions,n=this.vectorsWorld,o=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),i.copyFrom(this.maximum);for(let e=0;e<8;++e)n[e].copyFrom(o[e]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(let s=0;s<8;++s){const a=n[s];r.Pq.TransformCoordinatesToRef(o[s],e,a),t.minimizeInPlace(a),i.maximizeInPlace(a)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}r.Pq.FromArrayToRef(e.m,0,s[0]),r.Pq.FromArrayToRef(e.m,4,s[1]),r.Pq.FromArrayToRef(e.m,8,s[2]),this._worldMatrix=e}isInFrustum(e){return o.IsInFrustum(this.vectorsWorld,e)}isCompletelyInFrustum(e){return o.IsCompletelyInFrustum(this.vectorsWorld,e)}intersectsPoint(e){const t=this.minimumWorld,i=this.maximumWorld,s=t.x,r=t.y,o=t.z,a=i.x,h=i.y,l=i.z,c=e.x,u=e.y,d=e.z,_=-n.bH;return!(a-c<_||_>c-s||h-u<_||_>u-r||l-d<_||_>d-o)}intersectsSphere(e){return o.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)}intersectsMinMax(e,t){const i=this.minimumWorld,s=this.maximumWorld,r=i.x,n=i.y,o=i.z,a=s.x,h=s.y,l=s.z,c=e.x,u=e.y,d=e.z,_=t.x,p=t.y,g=t.z;return!(a<c||r>_||h<u||n>p||l<d||o>g)}dispose(){this._drawWrapperFront?.dispose(),this._drawWrapperBack?.dispose()}static Intersects(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}static IntersectsSphere(e,t,i,s){const n=o._TmpVector3[0];return r.Pq.ClampToRef(i,e,t,n),r.Pq.DistanceSquared(i,n)<=s*s}static IsCompletelyInFrustum(e,t){for(let i=0;i<6;++i){const s=t[i];for(let t=0;t<8;++t)if(s.dotCoordinate(e[t])<0)return!1}return!0}static IsInFrustum(e,t){for(let i=0;i<6;++i){let s=!0;const r=t[i];for(let t=0;t<8;++t)if(r.dotCoordinate(e[t])>=0){s=!1;break}if(s)return!1}return!0}}o._TmpVector3=(0,s.mI)(3,r.Pq.Zero)},219:e=>{"use strict";e.exports=Error},242:(e,t,i)=>{"use strict";i.r(t),i.d(t,{postprocessVertexShader:()=>n});const s="postprocessVertexShader",r="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";i(4796).l.ShadersStore[s]=r;const n={name:s,shader:r}},321:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.bakedVertexAnimation="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;float VATEndFrame=BVASNAME.y;float VATOffsetFrame=BVASNAME.z;float VATSpeed=BVASNAME.w;float totalFrames=VATEndFrame-VATStartFrame+1.0;float time=bakedVertexAnimationTime*VATSpeed/totalFrames;float frameCorrection=time<1.0 ? 0.0 : 1.0;float numOfFrames=totalFrames-frameCorrection;float VATFrameNum=fract(time)*numOfFrames;VATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);VATFrameNum=floor(VATFrameNum);VATFrameNum+=VATStartFrame+frameCorrection;mat4 VATInfluence;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;}\n#endif\n"},376:e=>{"use strict";e.exports=Function.prototype.call},427:(e,t,i)=>{"use strict";i.d(t,{AV:()=>n,EL:()=>r,Tq:()=>s,yS:()=>o});const s=e=>{if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return t},r=e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i,s,r,n,o,a,h,l="",c=0;const u=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;c<u.length;)i=u[c++],s=c<u.length?u[c++]:Number.NaN,r=c<u.length?u[c++]:Number.NaN,n=i>>2,o=(3&i)<<4|s>>4,a=(15&s)<<2|r>>6,h=63&r,isNaN(s)?a=h=64:isNaN(r)&&(h=64),l+=t.charAt(n)+t.charAt(o)+t.charAt(a)+t.charAt(h);return l},n=e=>atob(e),o=e=>{const t=n(e),i=t.length,s=new Uint8Array(new ArrayBuffer(i));for(let e=0;e<i;e++)s[e]=t.charCodeAt(e);return s.buffer}},451:(e,t,i)=>{"use strict";i.d(t,{IG:()=>_,ov:()=>d,v9:()=>u});var s=i(959),r=i(5686),n=i(7761),o=i(8857);function a(e){return Math.pow(e,n.tk)}function h(e){return e<=.04045?.0773993808*e:Math.pow(.947867299*(e+.055),2.4)}function l(e){return Math.pow(e,n.rv)}function c(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class u{constructor(e=0,t=0,i=0){this.r=e,this.g=t,this.b=i}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let e=255*this.r|0;return e=397*e^255*this.g,e=397*e^255*this.b,e}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}fromArray(e,t=0){return u.FromArrayToRef(e,t,this),this}toColor4(e=1){return new d(this.r,this.g,this.b,e)}asArray(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(e){return new u(this.r*e.r,this.g*e.g,this.b*e.b)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyByFloats(e,t,i){return new u(this.r*e,this.g*t,this.b*i)}divide(e){throw new ReferenceError("Can not divide a color")}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}divideInPlace(e){throw new ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.r,e.g,e.b)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.r,e.g,e.b)}minimizeInPlaceFromFloats(e,t,i){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this}maximizeInPlaceFromFloats(e,t,i){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this}floorToRef(e){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(e){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}equalsFloats(e,t,i){return this.equalsToFloats(e,t,i)}equalsToFloats(e,t,i){return this.r===e&&this.g===t&&this.b===i}equalsWithEpsilon(e,t=n.bH){return(0,o.WithinEpsilon)(this.r,e.r,t)&&(0,o.WithinEpsilon)(this.g,e.g,t)&&(0,o.WithinEpsilon)(this.b,e.b,t)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(e){throw new ReferenceError("Can not negate a color")}scale(e){return new u(this.r*e,this.g*e,this.b*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t}clampToRef(e=0,t=1,i){return i.r=(0,o.Clamp)(this.r,e,t),i.g=(0,o.Clamp)(this.g,e,t),i.b=(0,o.Clamp)(this.b,e,t),i}add(e){return new u(this.r+e.r,this.g+e.g,this.b+e.b)}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addInPlaceFromFloats(e,t,i){return this.r+=e,this.g+=t,this.b+=i,this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t}subtract(e){return new u(this.r-e.r,this.g-e.g,this.b-e.b)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this}subtractFromFloats(e,t,i){return new u(this.r-e,this.g-t,this.b-i)}subtractFromFloatsToRef(e,t,i,s){return s.r=this.r-e,s.g=this.g-t,s.b=this.b-i,s}clone(){return new u(this.r,this.g,this.b)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyFromFloats(e,t,i){return this.r=e,this.g=t,this.b=i,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this.r=this.g=this.b=e,this}toHexString(){const e=Math.round(255*this.r),t=Math.round(255*this.g),i=Math.round(255*this.b);return"#"+(0,o.ToHex)(e)+(0,o.ToHex)(t)+(0,o.ToHex)(i)}fromHexString(e){return"#"!==e.substring(0,1)||7!==e.length||(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new u)}toHSVToRef(e){const t=this.r,i=this.g,s=this.b,r=Math.max(t,i,s),n=Math.min(t,i,s);let o=0,a=0;const h=r,l=r-n;return 0!==r&&(a=l/r),r!=n&&(r==t?(o=(i-s)/l,i<s&&(o+=6)):r==i?o=(s-t)/l+2:r==s&&(o=(t-i)/l+4),o*=60),e.r=o,e.g=a,e.b=h,e}toLinearSpace(e=!1){const t=new u;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=h(this.r),e.g=h(this.g),e.b=h(this.b)):(e.r=a(this.r),e.g=a(this.g),e.b=a(this.b)),this}toGammaSpace(e=!1){const t=new u;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=c(this.r),e.g=c(this.g),e.b=c(this.b)):(e.r=l(this.r),e.g=l(this.g),e.b=l(this.b)),this}static HSVtoRGBToRef(e,t,i,s){const r=i*t,n=e/60,o=r*(1-Math.abs(n%2-1));let a=0,h=0,l=0;n>=0&&n<=1?(a=r,h=o):n>=1&&n<=2?(a=o,h=r):n>=2&&n<=3?(h=r,l=o):n>=3&&n<=4?(h=o,l=r):n>=4&&n<=5?(a=o,l=r):n>=5&&n<=6&&(a=r,l=o);const c=i-r;return s.r=a+c,s.g=h+c,s.b=l+c,s}static FromHSV(e,t,i){const s=new u(0,0,0);return u.HSVtoRGBToRef(e,t,i,s),s}static FromHexString(e){return new u(0,0,0).fromHexString(e)}static FromArray(e,t=0){return new u(e[t],e[t+1],e[t+2])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2]}static FromInts(e,t,i){return new u(e/255,t/255,i/255)}static Lerp(e,t,i){const s=new u(0,0,0);return u.LerpToRef(e,t,i,s),s}static LerpToRef(e,t,i,s){s.r=e.r+(t.r-e.r)*i,s.g=e.g+(t.g-e.g)*i,s.b=e.b+(t.b-e.b)*i}static Hermite(e,t,i,s,r){const n=r*r,o=r*n,a=2*o-3*n+1,h=-2*o+3*n,l=o-2*n+r,c=o-n,d=e.r*a+i.r*h+t.r*l+s.r*c,_=e.g*a+i.g*h+t.g*l+s.g*c,p=e.b*a+i.b*h+t.b*l+s.b*c;return new u(d,_,p)}static Hermite1stDerivative(e,t,i,s,r){const n=u.Black();return this.Hermite1stDerivativeToRef(e,t,i,s,r,n),n}static Hermite1stDerivativeToRef(e,t,i,s,r,n){const o=r*r;n.r=6*(o-r)*e.r+(3*o-4*r+1)*t.r+6*(-o+r)*i.r+(3*o-2*r)*s.r,n.g=6*(o-r)*e.g+(3*o-4*r+1)*t.g+6*(-o+r)*i.g+(3*o-2*r)*s.g,n.b=6*(o-r)*e.b+(3*o-4*r+1)*t.b+6*(-o+r)*i.b+(3*o-2*r)*s.b}static Red(){return new u(1,0,0)}static Green(){return new u(0,1,0)}static Blue(){return new u(0,0,1)}static Black(){return new u(0,0,0)}static get BlackReadOnly(){return u._BlackReadOnly}static White(){return new u(1,1,1)}static Purple(){return new u(.5,0,.5)}static Magenta(){return new u(1,0,1)}static Yellow(){return new u(1,1,0)}static Gray(){return new u(.5,.5,.5)}static Teal(){return new u(0,1,1)}static Random(){return new u(Math.random(),Math.random(),Math.random())}}u._V8PerformanceHack=new u(.5,.5,.5),u._BlackReadOnly=u.Black(),Object.defineProperties(u.prototype,{dimension:{value:[3]},rank:{value:1}});class d{constructor(e=0,t=0,i=0,s=1){this.r=e,this.g=t,this.b=i,this.a=s}asArray(){return[this.r,this.g,this.b,this.a]}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}add(e){return new d(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t.a=this.a+e.a,t}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}addInPlaceFromFloats(e,t,i,s){return this.r+=e,this.g+=t,this.b+=i,this.a+=s,this}subtract(e){return new d(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}subtractFromFloats(e,t,i,s){return new d(this.r-e,this.g-t,this.b-i,this.a-s)}subtractFromFloatsToRef(e,t,i,s,r){return r.r=this.r-e,r.g=this.g-t,r.b=this.b-i,r.a=this.a-s,r}scale(e){return new d(this.r*e,this.g*e,this.b*e,this.a*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,t}clampToRef(e=0,t=1,i){return i.r=(0,o.Clamp)(this.r,e,t),i.g=(0,o.Clamp)(this.g,e,t),i.b=(0,o.Clamp)(this.b,e,t),i.a=(0,o.Clamp)(this.a,e,t),i}multiply(e){return new d(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a,this}multiplyByFloats(e,t,i,s){return new d(this.r*e,this.g*t,this.b*i,this.a*s)}divide(e){throw new ReferenceError("Can not divide a color")}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}divideInPlace(e){throw new ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.r=Math.min(this.r,e.r),this.g=Math.min(this.g,e.g),this.b=Math.min(this.b,e.b),this.a=Math.min(this.a,e.a),this}maximizeInPlace(e){return this.r=Math.max(this.r,e.r),this.g=Math.max(this.g,e.g),this.b=Math.max(this.b,e.b),this.a=Math.max(this.a,e.a),this}minimizeInPlaceFromFloats(e,t,i,s){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this.a=Math.min(s,this.a),this}maximizeInPlaceFromFloats(e,t,i,s){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this.a=Math.max(s,this.a),this}floorToRef(e){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(e){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(e){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(e,t=n.bH){return(0,o.WithinEpsilon)(this.r,e.r,t)&&(0,o.WithinEpsilon)(this.g,e.g,t)&&(0,o.WithinEpsilon)(this.b,e.b,t)&&(0,o.WithinEpsilon)(this.a,e.a,t)}equalsToFloats(e,t,i,s){return this.r===e&&this.g===t&&this.b===i&&this.a===s}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let e=255*this.r|0;return e=397*e^255*this.g,e=397*e^255*this.b,e=397*e^255*this.a,e}clone(){return(new d).copyFrom(this)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}copyFromFloats(e,t,i,s){return this.r=e,this.g=t,this.b=i,this.a=s,this}set(e,t,i,s){return this.copyFromFloats(e,t,i,s)}setAll(e){return this.r=this.g=this.b=this.a=e,this}toHexString(e=!1){const t=Math.round(255*this.r),i=Math.round(255*this.g),s=Math.round(255*this.b);if(e)return"#"+(0,o.ToHex)(t)+(0,o.ToHex)(i)+(0,o.ToHex)(s);const r=Math.round(255*this.a);return"#"+(0,o.ToHex)(t)+(0,o.ToHex)(i)+(0,o.ToHex)(s)+(0,o.ToHex)(r)}fromHexString(e){return"#"!==e.substring(0,1)||9!==e.length&&7!==e.length||(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255,9===e.length&&(this.a=parseInt(e.substring(7,9),16)/255)),this}toLinearSpace(e=!1){const t=new d;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=h(this.r),e.g=h(this.g),e.b=h(this.b)):(e.r=a(this.r),e.g=a(this.g),e.b=a(this.b)),e.a=this.a,this}toGammaSpace(e=!1){const t=new d;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=c(this.r),e.g=c(this.g),e.b=c(this.b)):(e.r=l(this.r),e.g=l(this.g),e.b=l(this.b)),e.a=this.a,this}static FromHexString(e){return"#"!==e.substring(0,1)||9!==e.length&&7!==e.length?new d(0,0,0,0):new d(0,0,0,1).fromHexString(e)}static Lerp(e,t,i){return d.LerpToRef(e,t,i,new d)}static LerpToRef(e,t,i,s){return s.r=e.r+(t.r-e.r)*i,s.g=e.g+(t.g-e.g)*i,s.b=e.b+(t.b-e.b)*i,s.a=e.a+(t.a-e.a)*i,s}static Hermite(e,t,i,s,r){const n=r*r,o=r*n,a=2*o-3*n+1,h=-2*o+3*n,l=o-2*n+r,c=o-n,u=e.r*a+i.r*h+t.r*l+s.r*c,_=e.g*a+i.g*h+t.g*l+s.g*c,p=e.b*a+i.b*h+t.b*l+s.b*c,g=e.a*a+i.a*h+t.a*l+s.a*c;return new d(u,_,p,g)}static Hermite1stDerivative(e,t,i,s,r){const n=new d;return this.Hermite1stDerivativeToRef(e,t,i,s,r,n),n}static Hermite1stDerivativeToRef(e,t,i,s,r,n){const o=r*r;n.r=6*(o-r)*e.r+(3*o-4*r+1)*t.r+6*(-o+r)*i.r+(3*o-2*r)*s.r,n.g=6*(o-r)*e.g+(3*o-4*r+1)*t.g+6*(-o+r)*i.g+(3*o-2*r)*s.g,n.b=6*(o-r)*e.b+(3*o-4*r+1)*t.b+6*(-o+r)*i.b+(3*o-2*r)*s.b,n.a=6*(o-r)*e.a+(3*o-4*r+1)*t.a+6*(-o+r)*i.a+(3*o-2*r)*s.a}static FromColor3(e,t=1){return new d(e.r,e.g,e.b,t)}static FromArray(e,t=0){return new d(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]}static FromInts(e,t,i,s){return new d(e/255,t/255,i/255,s/255)}static CheckColors4(e,t){if(e.length===3*t){const t=[];for(let i=0;i<e.length;i+=3){const s=i/3*4;t[s]=e[i],t[s+1]=e[i+1],t[s+2]=e[i+2],t[s+3]=1}return t}return e}}d._V8PerformanceHack=new d(.5,.5,.5,.5),Object.defineProperties(d.prototype,{dimension:{value:[4]},rank:{value:1}});class _{}_.Color3=(0,s.mI)(3,u.Black),_.Color4=(0,s.mI)(3,(()=>new d(0,0,0,0))),(0,r.Y5)("BABYLON.Color3",u),(0,r.Y5)("BABYLON.Color4",d)},462:(e,t,i)=>{"use strict";i.r(t),i.d(t,{_KTXTextureLoader:()=>_});var s=i(3039);class r{constructor(e,t){if(this.data=e,this.isInvalid=!1,!r.IsValid(e))return this.isInvalid=!0,void s.V.Error("texture missing KTX identifier");const i=Uint32Array.BYTES_PER_ELEMENT,n=new DataView(this.data.buffer,this.data.byteOffset+12,13*i),o=67305985===n.getUint32(0,!0);return this.glType=n.getUint32(1*i,o),this.glTypeSize=n.getUint32(2*i,o),this.glFormat=n.getUint32(3*i,o),this.glInternalFormat=n.getUint32(4*i,o),this.glBaseInternalFormat=n.getUint32(5*i,o),this.pixelWidth=n.getUint32(6*i,o),this.pixelHeight=n.getUint32(7*i,o),this.pixelDepth=n.getUint32(8*i,o),this.numberOfArrayElements=n.getUint32(9*i,o),this.numberOfFaces=n.getUint32(10*i,o),this.numberOfMipmapLevels=n.getUint32(11*i,o),this.bytesOfKeyValueData=n.getUint32(12*i,o),0!==this.glType?(s.V.Error("only compressed formats currently supported"),void(this.isInvalid=!0)):(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0===this.pixelHeight||0!==this.pixelDepth?(s.V.Error("only 2D textures currently supported"),void(this.isInvalid=!0)):0!==this.numberOfArrayElements?(s.V.Error("texture arrays not currently supported"),void(this.isInvalid=!0)):this.numberOfFaces!==t?(s.V.Error("number of faces expected"+t+", but found "+this.numberOfFaces),void(this.isInvalid=!0)):void(this.loadType=r.COMPRESSED_2D))}uploadLevels(e,t){switch(this.loadType){case r.COMPRESSED_2D:this._upload2DCompressedLevels(e,t);case r.TEX_2D:case r.COMPRESSED_3D:case r.TEX_3D:}}_upload2DCompressedLevels(e,t){let i=r.HEADER_LEN+this.bytesOfKeyValueData,s=this.pixelWidth,n=this.pixelHeight;const o=t?this.numberOfMipmapLevels:1;for(let t=0;t<o;t++){const r=new Int32Array(this.data.buffer,this.data.byteOffset+i,1)[0];i+=4;for(let o=0;o<this.numberOfFaces;o++){const a=new Uint8Array(this.data.buffer,this.data.byteOffset+i,r);e.getEngine()._uploadCompressedDataToTextureDirectly(e,e.format,s,n,a,o,t),i+=r,i+=3-(r+3)%4}s=Math.max(1,.5*s),n=Math.max(1,.5*n)}}static IsValid(e){if(e.byteLength>=12){const t=new Uint8Array(e.buffer,e.byteOffset,12);if(171===t[0]&&75===t[1]&&84===t[2]&&88===t[3]&&32===t[4]&&49===t[5]&&49===t[6]&&187===t[7]&&13===t[8]&&10===t[9]&&26===t[10]&&10===t[11])return!0}return!1}}r.HEADER_LEN=64,r.COMPRESSED_2D=0,r.COMPRESSED_3D=1,r.TEX_2D=2,r.TEX_3D=3;var n,o,a,h=i(5743),l=i(9732);function c(e,t){const i=t?.jsDecoderModule||KTX2DECODER;e&&(e.wasmUASTCToASTC&&(i.LiteTranscoder_UASTC_ASTC.WasmModuleURL=e.wasmUASTCToASTC),e.wasmUASTCToBC7&&(i.LiteTranscoder_UASTC_BC7.WasmModuleURL=e.wasmUASTCToBC7),e.wasmUASTCToRGBA_UNORM&&(i.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=e.wasmUASTCToRGBA_UNORM),e.wasmUASTCToRGBA_SRGB&&(i.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=e.wasmUASTCToRGBA_SRGB),e.wasmUASTCToR8_UNORM&&(i.LiteTranscoder_UASTC_R8_UNORM.WasmModuleURL=e.wasmUASTCToR8_UNORM),e.wasmUASTCToRG8_UNORM&&(i.LiteTranscoder_UASTC_RG8_UNORM.WasmModuleURL=e.wasmUASTCToRG8_UNORM),e.jsMSCTranscoder&&(i.MSCTranscoder.JSModuleURL=e.jsMSCTranscoder),e.wasmMSCTranscoder&&(i.MSCTranscoder.WasmModuleURL=e.wasmMSCTranscoder),e.wasmZSTDDecoder&&(i.ZSTDDecoder.WasmModuleURL=e.wasmZSTDDecoder)),t&&(t.wasmUASTCToASTC&&(i.LiteTranscoder_UASTC_ASTC.WasmBinary=t.wasmUASTCToASTC),t.wasmUASTCToBC7&&(i.LiteTranscoder_UASTC_BC7.WasmBinary=t.wasmUASTCToBC7),t.wasmUASTCToRGBA_UNORM&&(i.LiteTranscoder_UASTC_RGBA_UNORM.WasmBinary=t.wasmUASTCToRGBA_UNORM),t.wasmUASTCToRGBA_SRGB&&(i.LiteTranscoder_UASTC_RGBA_SRGB.WasmBinary=t.wasmUASTCToRGBA_SRGB),t.wasmUASTCToR8_UNORM&&(i.LiteTranscoder_UASTC_R8_UNORM.WasmBinary=t.wasmUASTCToR8_UNORM),t.wasmUASTCToRG8_UNORM&&(i.LiteTranscoder_UASTC_RG8_UNORM.WasmBinary=t.wasmUASTCToRG8_UNORM),t.jsMSCTranscoder&&(i.MSCTranscoder.JSModule=t.jsMSCTranscoder),t.wasmMSCTranscoder&&(i.MSCTranscoder.WasmBinary=t.wasmMSCTranscoder),t.wasmZSTDDecoder&&(i.ZSTDDecoder.WasmBinary=t.wasmZSTDDecoder))}function u(e){let t;void 0===e&&"undefined"!=typeof KTX2DECODER&&(e=KTX2DECODER),onmessage=i=>{if(i.data)switch(i.data.action){case"init":{const s=i.data.urls;s&&(s.jsDecoderModule&&void 0===e&&(importScripts(s.jsDecoderModule),e=KTX2DECODER),c(s)),i.data.wasmBinaries&&c(void 0,{...i.data.wasmBinaries,jsDecoderModule:e}),t=new e.KTX2Decoder,postMessage({action:"init"});break}case"setDefaultDecoderOptions":e.KTX2Decoder.DefaultDecoderOptions=i.data.options;break;case"decode":t.decode(i.data.data,i.data.caps,i.data.options).then((e=>{const t=[];for(let i=0;i<e.mipmaps.length;++i){const s=e.mipmaps[i];s&&s.data&&t.push(s.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:e},t)})).catch((e=>{postMessage({action:"decoded",success:!1,msg:e})}))}}}!function(e){e[e.ETC1S=0]="ETC1S",e[e.UASTC4x4=1]="UASTC4x4"}(n||(n={})),function(e){e[e.ASTC_4X4_RGBA=0]="ASTC_4X4_RGBA",e[e.BC7_RGBA=1]="BC7_RGBA",e[e.BC3_RGBA=2]="BC3_RGBA",e[e.BC1_RGB=3]="BC1_RGB",e[e.PVRTC1_4_RGBA=4]="PVRTC1_4_RGBA",e[e.PVRTC1_4_RGB=5]="PVRTC1_4_RGB",e[e.ETC2_RGBA=6]="ETC2_RGBA",e[e.ETC1_RGB=7]="ETC1_RGB",e[e.RGBA32=8]="RGBA32",e[e.R8=9]="R8",e[e.RG8=10]="RG8"}(o||(o={})),function(e){e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGBA_ASTC_4X4_KHR=37808]="COMPRESSED_RGBA_ASTC_4X4_KHR",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.RGBA8Format=32856]="RGBA8Format",e[e.R8Format=33321]="R8Format",e[e.RG8Format=33323]="RG8Format"}(a||(a={}));class d{static GetDefaultNumWorkers(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static _Initialize(e){if(d._WorkerPoolPromise||d._DecoderModulePromise)return;const t={jsDecoderModule:l.S0.GetBabylonScriptURL(this.URLConfig.jsDecoderModule,!0),wasmUASTCToASTC:l.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToASTC,!0),wasmUASTCToBC7:l.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToBC7,!0),wasmUASTCToRGBA_UNORM:l.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_UNORM,!0),wasmUASTCToRGBA_SRGB:l.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_SRGB,!0),wasmUASTCToR8_UNORM:l.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToR8_UNORM,!0),wasmUASTCToRG8_UNORM:l.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRG8_UNORM,!0),jsMSCTranscoder:l.S0.GetBabylonScriptURL(this.URLConfig.jsMSCTranscoder,!0),wasmMSCTranscoder:l.S0.GetBabylonScriptURL(this.URLConfig.wasmMSCTranscoder,!0),wasmZSTDDecoder:l.S0.GetBabylonScriptURL(this.URLConfig.wasmZSTDDecoder,!0)};e&&"function"==typeof Worker&&"undefined"!=typeof URL?d._WorkerPoolPromise=new Promise((i=>{const s=`${c}(${u})()`,r=URL.createObjectURL(new Blob([s],{type:"application/javascript"}));i(new h.h(e,(()=>function(e,t,i){return new Promise(((t,s)=>{const r=t=>{e.removeEventListener("error",r),e.removeEventListener("message",n),s(t)},n=i=>{"init"===i.data.action&&(e.removeEventListener("error",r),e.removeEventListener("message",n),t(e))};e.addEventListener("error",r),e.addEventListener("message",n),e.postMessage({action:"init",urls:i,wasmBinaries:undefined})}))}(new Worker(r),0,t))))})):void 0===d._KTX2DecoderModule?d._DecoderModulePromise=l.S0.LoadBabylonScriptAsync(t.jsDecoderModule).then((()=>(d._KTX2DecoderModule=KTX2DECODER,d._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,d._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,c(t,d._KTX2DecoderModule),new d._KTX2DecoderModule.KTX2Decoder))):(d._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,d._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,d._DecoderModulePromise=Promise.resolve(new d._KTX2DecoderModule.KTX2Decoder))}constructor(e,t=d.DefaultNumWorkers){this._engine=e;const i="object"==typeof t&&t.workerPool||d.WorkerPool;if(i)d._WorkerPoolPromise=Promise.resolve(i);else{"object"==typeof t?d._KTX2DecoderModule=t?.binariesAndModulesContainer?.jsDecoderModule:"undefined"!=typeof KTX2DECODER&&(d._KTX2DecoderModule=KTX2DECODER);const e="number"==typeof t?t:t.numWorkers??d.DefaultNumWorkers;d._Initialize(e)}}_uploadAsync(e,t,i){const s=this._engine.getCaps(),r={astc:!!s.astc,bptc:!!s.bptc,s3tc:!!s.s3tc,pvrtc:!!s.pvrtc,etc2:!!s.etc2,etc1:!!s.etc1};if(d._WorkerPoolPromise)return d._WorkerPoolPromise.then((s=>new Promise(((n,o)=>{s.push(((s,a)=>{const h=e=>{s.removeEventListener("error",h),s.removeEventListener("message",l),o(e),a()},l=e=>{if("decoded"===e.data.action){if(s.removeEventListener("error",h),s.removeEventListener("message",l),e.data.success)try{this._createTexture(e.data.decodedData,t,i),n()}catch(e){o({message:e})}else o({message:e.data.msg});a()}};s.addEventListener("error",h),s.addEventListener("message",l),s.postMessage({action:"setDefaultDecoderOptions",options:d.DefaultDecoderOptions._getKTX2DecoderOptions()});const c=new Uint8Array(e.byteLength);c.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),s.postMessage({action:"decode",data:c,caps:r,options:i},[c.buffer])}))}))));if(d._DecoderModulePromise)return d._DecoderModulePromise.then((i=>(d.DefaultDecoderOptions.isDirty&&(d._KTX2DecoderModule.KTX2Decoder.DefaultDecoderOptions=d.DefaultDecoderOptions._getKTX2DecoderOptions()),new Promise(((r,n)=>{i.decode(e,s).then((e=>{this._createTexture(e,t),r()})).catch((e=>{n({message:e})}))})))));throw new Error("KTX2 decoder module is not available")}_createTexture(e,t,i){this._engine._bindTextureDirectly(3553,t),i&&(i.transcodedFormat=e.transcodedFormat,i.isInGammaSpace=e.isInGammaSpace,i.hasAlpha=e.hasAlpha,i.transcoderName=e.transcoderName);let s=!0;switch(e.transcodedFormat){case 32856:t.type=0,t.format=5;break;case 33321:t.type=0,t.format=6;break;case 33323:t.type=0,t.format=7;break;default:t.format=e.transcodedFormat,s=!1}if(t._gammaSpace=e.isInGammaSpace,t.generateMipMaps=e.mipmaps.length>1,e.errors)throw new Error("KTX2 container - could not transcode the data. "+e.errors);for(let i=0;i<e.mipmaps.length;++i){const r=e.mipmaps[i];if(!r||!r.data)throw new Error("KTX2 container - could not transcode one of the image");s?(t.width=r.width,t.height=r.height,this._engine._uploadDataToTextureDirectly(t,r.data,0,i,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(t,e.transcodedFormat,r.width,r.height,r.data,0,i)}t._extension=".ktx2",t.width=e.mipmaps[0].width,t.height=e.mipmaps[0].height,t.isReady=!0,this._engine._bindTextureDirectly(3553,null)}static IsValid(e){if(e.byteLength>=12){const t=new Uint8Array(e.buffer,e.byteOffset,12);if(171===t[0]&&75===t[1]&&84===t[2]&&88===t[3]&&32===t[4]&&50===t[5]&&48===t[6]&&187===t[7]&&13===t[8]&&10===t[9]&&26===t[10]&&10===t[11])return!0}return!1}}d.URLConfig={jsDecoderModule:"https://cdn.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,wasmUASTCToR8_UNORM:null,wasmUASTCToRG8_UNORM:null,jsMSCTranscoder:null,wasmMSCTranscoder:null,wasmZSTDDecoder:null},d.DefaultNumWorkers=d.GetDefaultNumWorkers(),d.DefaultDecoderOptions=new class{constructor(){this._isDirty=!0,this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=!0,this._ktx2DecoderOptions={}}get isDirty(){return this._isDirty}get useRGBAIfASTCBC7NotAvailableWhenUASTC(){return this._useRGBAIfASTCBC7NotAvailableWhenUASTC}set useRGBAIfASTCBC7NotAvailableWhenUASTC(e){this._useRGBAIfASTCBC7NotAvailableWhenUASTC!==e&&(this._useRGBAIfASTCBC7NotAvailableWhenUASTC=e,this._isDirty=!0)}get useRGBAIfOnlyBC1BC3AvailableWhenUASTC(){return this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC}set useRGBAIfOnlyBC1BC3AvailableWhenUASTC(e){this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC!==e&&(this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=e,this._isDirty=!0)}get forceRGBA(){return this._forceRGBA}set forceRGBA(e){this._forceRGBA!==e&&(this._forceRGBA=e,this._isDirty=!0)}get forceR8(){return this._forceR8}set forceR8(e){this._forceR8!==e&&(this._forceR8=e,this._isDirty=!0)}get forceRG8(){return this._forceRG8}set forceRG8(e){this._forceRG8!==e&&(this._forceRG8=e,this._isDirty=!0)}get bypassTranscoders(){return this._bypassTranscoders}set bypassTranscoders(e){this._bypassTranscoders!==e&&(this._bypassTranscoders=e,this._isDirty=!0)}_getKTX2DecoderOptions(){if(!this._isDirty)return this._ktx2DecoderOptions;this._isDirty=!1;const e={useRGBAIfASTCBC7NotAvailableWhenUASTC:this._useRGBAIfASTCBC7NotAvailableWhenUASTC,forceRGBA:this._forceRGBA,forceR8:this._forceR8,forceRG8:this._forceRG8,bypassTranscoders:this._bypassTranscoders};return this.useRGBAIfOnlyBC1BC3AvailableWhenUASTC&&(e.transcodeFormatDecisionTree={UASTC:{transcodeFormat:[o.BC1_RGB,o.BC3_RGBA],yes:{transcodeFormat:o.RGBA32,engineFormat:32856,roundToMultiple4:!1}}}),this._ktx2DecoderOptions=e,e}};class _{constructor(){this.supportCascades=!1}loadCubeData(e,t,i,s){if(Array.isArray(e))return;t._invertVScale=!t.invertY;const n=t.getEngine(),o=new r(e,6),a=o.numberOfMipmapLevels>1&&t.generateMipMaps;n._unpackFlipY(!0),o.uploadLevels(t,t.generateMipMaps),t.width=o.pixelWidth,t.height=o.pixelHeight,n._setCubeMapTextureParams(t,a,o.numberOfMipmapLevels-1),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),s&&s()}loadData(e,t,i,n){if(r.IsValid(e)){t._invertVScale=!t.invertY;const s=new r(e,1),n=function(e){switch(e){case 35916:return 33776;case 35918:return 33778;case 35919:return 33779;case 37493:return 37492;case 37497:return 37496;case 37495:return 37494;case 37840:return 37808;case 36493:return 36492}return null}(s.glInternalFormat);n?(t.format=n,t._useSRGBBuffer=t.getEngine()._getUseSRGBBuffer(!0,t.generateMipMaps),t._gammaSpace=!0):t.format=s.glInternalFormat,i(s.pixelWidth,s.pixelHeight,t.generateMipMaps,!0,(()=>{s.uploadLevels(t,t.generateMipMaps)}),s.isInvalid)}else d.IsValid(e)?new d(t.getEngine())._uploadAsync(e,t,n).then((()=>{i(t.width,t.height,t.generateMipMaps,!0,(()=>{}),!1)}),(e=>{s.V.Warn(`Failed to load KTX2 texture data: ${e.message}`),i(0,0,!1,!1,(()=>{}),!0)})):(s.V.Error("texture missing KTX identifier"),i(0,0,!1,!1,(()=>{}),!0))}}},470:(e,t,i)=>{"use strict";i.d(t,{p:()=>h});var s=i(4754),r=i(4537),n=i(4049),o=i(9838),a=i(6871);class h extends o.v{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=n.uq.Identity(),this._projectionMatrix=n.uq.Identity()}_setPosition(e){this._position=e}get position(){return this._position}set position(e){this._setPosition(e)}_setDirection(e){this._direction=e}get direction(){return this._direction}set direction(e){this._setDirection(e)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix||(this.transformedPosition||(this.transformedPosition=n.Pq.Zero()),n.Pq.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=n.Pq.Zero()),n.Pq.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),0))}getDepthScale(){return 50}getShadowDirection(e){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(e){return this.direction=n.Pq.Normalize(e.subtract(this.position)),this.direction}getRotation(){this.direction.normalize();const e=n.Pq.Cross(this.direction,a._0.Y),t=n.Pq.Cross(e,this.direction);return n.Pq.RotationFromAxis(e,t,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=n.Pq.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}computeWorldMatrix(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=n.uq.Identity()),n.uq.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e?.minZ||0}getDepthMaxZ(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e?.maxZ||1e4}setShadowProjectionMatrix(e,t,i){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,i,e):this._setDefaultShadowProjectionMatrix(e,t,i),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(e){const t=n.AA.Vector3[0];let i=this.position;this.computeTransformedInformation()&&(i=this.transformedPosition),n.Pq.NormalizeToRef(this.getShadowDirection(e),t),1===Math.abs(n.Pq.Dot(t,n.Pq.Up()))&&(t.z=1e-13);const s=n.AA.Vector3[1];return i.addToRef(t,s),n.uq.LookAtLHToRef(i,s,n.Pq.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(e,t){return this.setShadowProjectionMatrix(this._projectionMatrix,e??this._viewMatrix,t??[]),this._projectionMatrix}}(0,s.Cg)([(0,r.P_)()],h.prototype,"position",null),(0,s.Cg)([(0,r.P_)()],h.prototype,"direction",null),(0,s.Cg)([(0,r.lK)()],h.prototype,"shadowMinZ",null),(0,s.Cg)([(0,r.lK)()],h.prototype,"shadowMaxZ",null)},482:(e,t,i)=>{"use strict";i.d(t,{M:()=>s});const s={name:"obj",extensions:".obj"}},504:(e,t,i)=>{"use strict";i.d(t,{H:()=>o,_:()=>a});var s=i(3039),r=i(979),n=i(9642),o={};class a{constructor(e){this.attachedToElement=!1,this.attached={},this.camera=e,this.checkInputs=()=>{}}add(e){const t=e.getSimpleName();this.attached[t]?s.V.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault))}remove(e){for(const t in this.attached){const i=this.attached[t];if(i===e)return i.detachControl(),i.camera=null,delete this.attached[t],void this.rebuildInputCheck()}}removeByType(e){for(const t in this.attached){const i=this.attached[t];i.getClassName()===e&&(i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}}_addCheckInputs(e){const t=this.checkInputs;return()=>{t(),e()}}attachInput(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}attachElement(e=!1){if(!this.attachedToElement){e=!n.i.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedToElement=!0,this.noPreventDefault=e;for(const t in this.attached)this.attached[t].attachControl(e)}}detachElement(e=!1){for(const t in this.attached)this.attached[t].detachControl(),e&&(this.attached[t].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const e in this.attached){const t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(e){const t={};for(const e in this.attached){const i=this.attached[e],s=r.p.Serialize(i);t[i.getClassName()]=s}e.inputsmgr=t}parse(e){const t=e.inputsmgr;if(t){this.clear();for(const e in t){const i=o[e];if(i){const s=t[e],n=r.p.Parse((()=>new i),s,null);this.add(n)}}}else for(const t in this.attached){const i=o[this.attached[t].getClassName()];if(i){const s=r.p.Parse((()=>new i),e,null);this.remove(this.attached[t]),this.add(s)}}}}},588:(e,t,i)=>{"use strict";var s=i(1711),r=i(8527),n=i(3575),o=i(9167),a=i(9075)||o||n;e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new s("Side channel does not contain "+r(e))},delete:function(t){return!!e&&e.delete(t)},get:function(t){return e&&e.get(t)},has:function(t){return!!e&&e.has(t)},set:function(t,i){e||(e=a()),e.set(t,i)}};return t}},641:(e,t,i)=>{"use strict";i.d(t,{Y:()=>r});class s{static Eval(e,t){return"true"===(e=e.match(/\([^()]*\)/g)?e.replace(/\([^()]*\)/g,(e=>(e=e.slice(1,e.length-1),s._HandleParenthesisContent(e,t)))):s._HandleParenthesisContent(e,t))||"false"!==e&&s.Eval(e,t)}static _HandleParenthesisContent(e,t){let i;t=t||(e=>"true"===e);const r=e.split("||");for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e)){let n=s._SimplifyNegation(r[e].trim());const o=n.split("&&");if(o.length>1)for(let e=0;e<o.length;++e){const r=s._SimplifyNegation(o[e].trim());if(i="true"!==r&&"false"!==r?"!"===r[0]?!t(r.substring(1)):t(r):"true"===r,!i){n="false";break}}if(i||"true"===n){i=!0;break}i="true"!==n&&"false"!==n?"!"===n[0]?!t(n.substring(1)):t(n):"true"===n}return i?"true":"false"}static _SimplifyNegation(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,(e=>(e=e.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?e="false":"!false"===e&&(e="true"),e}}class r{static EnableFor(e){e._tags=e._tags||{},e.hasTags=()=>r.HasTags(e),e.addTags=t=>r.AddTagsTo(e,t),e.removeTags=t=>r.RemoveTagsFrom(e,t),e.matchesTagsQuery=t=>r.MatchesQuery(e,t)}static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static HasTags(e){if(!e._tags)return!1;const t=e._tags;for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!0;return!1}static GetTags(e,t=!0){if(!e._tags)return null;if(t){const t=[];for(const i in e._tags)Object.prototype.hasOwnProperty.call(e._tags,i)&&!0===e._tags[i]&&t.push(i);return t.join(" ")}return e._tags}static AddTagsTo(e,t){t&&"string"==typeof t&&t.split(" ").forEach((function(t){r._AddTagTo(e,t)}))}static _AddTagTo(e,t){""!==(t=t.trim())&&"true"!==t&&"false"!==t&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(r.EnableFor(e),e._tags[t]=!0))}static RemoveTagsFrom(e,t){if(!r.HasTags(e))return;const i=t.split(" ");for(const t in i)r._RemoveTagFrom(e,i[t])}static _RemoveTagFrom(e,t){delete e._tags[t]}static MatchesQuery(e,t){return void 0===t||(""===t?r.HasTags(e):s.Eval(t,(t=>r.HasTags(e)&&e._tags[t])))}}},766:(e,t,i)=>{"use strict";i.d(t,{R:()=>a,h:()=>o});var s=i(4982),r=i(3039),n=i(2465);class o{get isDisposed(){return this._isDisposed}constructor(e,t,i,r=0,n=!1,o=!1,a=!1,h,l){this._isAlreadyOwned=!1,this._isDisposed=!1,e&&e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=o,this._divisor=h||1,this._label=l,t instanceof s.n?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=a?r:r*Float32Array.BYTES_PER_ELEMENT,n||this.create()}createVertexBuffer(e,t,i,s,r,n=!1,o){const h=n?t:t*Float32Array.BYTES_PER_ELEMENT,l=s?n?s:s*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new a(this._engine,this,e,this._updatable,!0,l,void 0===r?this._instanced:r,h,i,void 0,void 0,!0,this._divisor||o)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(e=null){!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e,this._label),this._data=e):this._buffer=this._engine.createVertexBuffer(e,void 0,this._label))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label));r.V.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(e){this.create(e)}updateDirectly(e,t,i,s=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,s?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===t&&void 0===i?e:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class a{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(e){const t=0!=e;this._instanceDivisor=e,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}get _maxVerticesCount(){const e=this.getData();return e?Array.isArray(e)?e.length/(this.byteStride/4)-this.byteOffset/4:(e.byteLength-this.byteOffset)/this.byteStride:0}constructor(e,t,i,s,r,h,l,c,u,d,_=!1,p=!1,g=1,f=!1){this._isDisposed=!1;let m=!1;if(this.engine=e,"object"==typeof s&&null!==s?(m=s.updatable??!1,r=s.postponeInternalCreation,h=s.stride,l=s.instanced,c=s.offset,u=s.size,d=s.type,_=s.normalized??!1,p=s.useBytes??!1,g=s.divisor??1,f=s.takeBufferOwnership??!1,this._label=s.label):m=!!s,t instanceof o?(this._buffer=t,this._ownsBuffer=f):(this._buffer=new o(e,t,m,h,r,l,p,g,this._label),this._ownsBuffer=!0),this.uniqueId=a._Counter++,this._kind=i,void 0===d){const e=this.getData();this.type=e?a.GetDataType(e):a.FLOAT}else this.type=d;const b=(0,n.PD)(this.type);p?(this._size=u||(h?h/b:a.DeduceStride(i)),this.byteStride=h||this._buffer.byteStride||this._size*b,this.byteOffset=c||0):(this._size=u||h||a.DeduceStride(i),this.byteStride=h?h*b:this._buffer.byteStride||this._size*b,this.byteOffset=(c||0)*b),this.normalized=_,this._instanced=void 0!==l&&l,this._instanceDivisor=l?g:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){this._buffer?._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(e,t){const i=this.getData();return i?(0,n.jm)(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,e,t):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,n.PD)(this.type)}getOffset(){return this.byteOffset/(0,n.PD)(this.type)}getSize(e=!1){return e?this._size*(0,n.PD)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(e){this._buffer.create(e),this._alignBuffer()}update(e){this._buffer.update(e),this._alignBuffer()}updateDirectly(e,t,i=!1){this._buffer.updateDirectly(e,t,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(e,t){(0,n.XG)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,((e,i)=>{for(let s=0;s<this._size;s++)t(e[s],i+s)}))}_alignBuffer(){}static DeduceStride(e){switch(e){case a.UVKind:case a.UV2Kind:case a.UV3Kind:case a.UV4Kind:case a.UV5Kind:case a.UV6Kind:return 2;case a.NormalKind:case a.PositionKind:return 3;case a.ColorKind:case a.ColorInstanceKind:case a.MatricesIndicesKind:case a.MatricesIndicesExtraKind:case a.MatricesWeightsKind:case a.MatricesWeightsExtraKind:case a.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}}static GetDataType(e){return e instanceof Int8Array?a.BYTE:e instanceof Uint8Array?a.UNSIGNED_BYTE:e instanceof Int16Array?a.SHORT:e instanceof Uint16Array?a.UNSIGNED_SHORT:e instanceof Int32Array?a.INT:e instanceof Uint32Array?a.UNSIGNED_INT:a.FLOAT}static GetTypeByteLength(e){return(0,n.PD)(e)}static ForEach(e,t,i,s,r,o,a,h){(0,n.XG)(e,t,i,s,r,o,a,((e,t)=>{for(let i=0;i<s;i++)h(e[i],t+i)}))}static GetFloatData(e,t,i,s,r,o,a,h){return(0,n.jm)(e,t,i,s,r,o,a,h)}}a._Counter=0,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.PositionKind="position",a.NormalKind="normal",a.TangentKind="tangent",a.UVKind="uv",a.UV2Kind="uv2",a.UV3Kind="uv3",a.UV4Kind="uv4",a.UV5Kind="uv5",a.UV6Kind="uv6",a.ColorKind="color",a.ColorInstanceKind="instanceColor",a.MatricesIndicesKind="matricesIndices",a.MatricesWeightsKind="matricesWeights",a.MatricesIndicesExtraKind="matricesIndicesExtra",a.MatricesWeightsExtraKind="matricesWeightsExtra"},769:e=>{"use strict";var t=String.prototype.replace,i=/%20/g,s="RFC3986";e.exports={default:s,formatters:{RFC1738:function(e){return t.call(e,i,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:s}},780:(e,t,i)=>{"use strict";i.d(t,{Rl:()=>_});var s=i(8836),r=i(9642),n=i(7761),o=i(4049),a=i(959),h=i(7329),l=i(109),c=i(1497),u=i(2631);const d=void 0;class _{constructor(e,t,i=Number.MAX_VALUE,s=n.bH){this.origin=e,this.direction=t,this.length=i,this.epsilon=s}clone(){return new _(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(e,t,i=0){const s=_._TmpVector3[0].copyFromFloats(e.x-i,e.y-i,e.z-i),r=_._TmpVector3[1].copyFromFloats(t.x+i,t.y+i,t.z+i);let n,o,a,h,l=0,c=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<s.x||this.origin.x>r.x)return!1}else if(n=1/this.direction.x,o=(s.x-this.origin.x)*n,a=(r.x-this.origin.x)*n,a===-1/0&&(a=1/0),o>a&&(h=o,o=a,a=h),l=Math.max(o,l),c=Math.min(a,c),l>c)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<s.y||this.origin.y>r.y)return!1}else if(n=1/this.direction.y,o=(s.y-this.origin.y)*n,a=(r.y-this.origin.y)*n,a===-1/0&&(a=1/0),o>a&&(h=o,o=a,a=h),l=Math.max(o,l),c=Math.min(a,c),l>c)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<s.z||this.origin.z>r.z)return!1}else if(n=1/this.direction.z,o=(s.z-this.origin.z)*n,a=(r.z-this.origin.z)*n,a===-1/0&&(a=1/0),o>a&&(h=o,o=a,a=h),l=Math.max(o,l),c=Math.min(a,c),l>c)return!1;return!0}intersectsBox(e,t=0){return this.intersectsBoxMinMax(e.minimum,e.maximum,t)}intersectsSphere(e,t=0){const i=e.center.x-this.origin.x,s=e.center.y-this.origin.y,r=e.center.z-this.origin.z,n=i*i+s*s+r*r,o=e.radius+t,a=o*o;if(n<=a)return!0;const h=i*this.direction.x+s*this.direction.y+r*this.direction.z;return!(h<0)&&n-h*h<=a}intersectsTriangle(e,t,i){const s=_._TmpVector3[0],r=_._TmpVector3[1],n=_._TmpVector3[2],a=_._TmpVector3[3],l=_._TmpVector3[4];t.subtractToRef(e,s),i.subtractToRef(e,r),o.Pq.CrossToRef(this.direction,r,n);const c=o.Pq.Dot(s,n);if(0===c)return null;const u=1/c;this.origin.subtractToRef(e,a);const d=o.Pq.Dot(a,n)*u;if(d<-this.epsilon||d>1+this.epsilon)return null;o.Pq.CrossToRef(a,s,l);const p=o.Pq.Dot(this.direction,l)*u;if(p<-this.epsilon||d+p>1+this.epsilon)return null;const g=o.Pq.Dot(r,l)*u;return g>this.length?null:new h.w(1-d-p,d,g)}intersectsPlane(e){let t;const i=o.Pq.Dot(e.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const s=o.Pq.Dot(e.normal,this.origin);return t=(-e.d-s)/i,t<0?t<-9.99999997475243e-7?null:0:t}}intersectsAxis(e,t=0){switch(e){case"y":{const e=(this.origin.y-t)/this.direction.y;return e>0?null:new o.Pq(this.origin.x+this.direction.x*-e,t,this.origin.z+this.direction.z*-e)}case"x":{const e=(this.origin.x-t)/this.direction.x;return e>0?null:new o.Pq(t,this.origin.y+this.direction.y*-e,this.origin.z+this.direction.z*-e)}case"z":{const e=(this.origin.z-t)/this.direction.z;return e>0?null:new o.Pq(this.origin.x+this.direction.x*-e,this.origin.y+this.direction.y*-e,t)}default:return null}}intersectsMesh(e,t,i,s=!1,r,n=!1){const a=o.AA.Matrix[0];return e.getWorldMatrix().invertToRef(a),this._tmpRay?_.TransformToRef(this,a,this._tmpRay):this._tmpRay=_.Transform(this,a),e.intersects(this._tmpRay,t,i,s,r,n)}intersectsMeshes(e,t,i){i?i.length=0:i=[];for(let s=0;s<e.length;s++){const r=this.intersectsMesh(e[s],t);r.hit&&i.push(r)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}intersectionSegment(e,t,i){const s=this.origin,r=o.AA.Vector3[0],n=o.AA.Vector3[1],a=o.AA.Vector3[2],h=o.AA.Vector3[3];t.subtractToRef(e,r),this.direction.scaleToRef(_._Rayl,a),s.addToRef(a,n),e.subtractToRef(s,h);const l=o.Pq.Dot(r,r),c=o.Pq.Dot(r,a),u=o.Pq.Dot(a,a),d=o.Pq.Dot(r,h),p=o.Pq.Dot(a,h),g=l*u-c*c;let f,m,b=g,v=g;g<_._Smallnum?(f=0,b=1,m=p,v=u):(f=c*p-u*d,m=l*p-c*d,f<0?(f=0,m=p,v=u):f>b&&(f=b,m=p+c,v=u)),m<0?(m=0,-d<0?f=0:-d>l?f=b:(f=-d,b=l)):m>v&&(m=v,-d+c<0?f=0:-d+c>l?f=b:(f=-d+c,b=l));const T=Math.abs(f)<_._Smallnum?0:f/b,y=Math.abs(m)<_._Smallnum?0:m/v,x=o.AA.Vector3[4];a.scaleToRef(y,x);const A=o.AA.Vector3[5];r.scaleToRef(T,A),A.addInPlace(h);const C=o.AA.Vector3[6];return A.subtractToRef(x,C),y>0&&y<=this.length&&C.lengthSquared()<i*i?A.length():-1}update(e,t,i,s,r,n,a,h=!1){if(h){_._RayDistant||(_._RayDistant=_.Zero()),_._RayDistant.unprojectRayToRef(e,t,i,s,o.uq.IdentityReadOnly,n,a);const h=o.AA.Matrix[0];r.invertToRef(h),_.TransformToRef(_._RayDistant,h,this)}else this.unprojectRayToRef(e,t,i,s,r,n,a);return this}static Zero(){return new _(o.Pq.Zero(),o.Pq.Zero())}static CreateNew(e,t,i,s,r,n,o){return _.Zero().update(e,t,i,s,r,n,o)}static CreateNewFromTo(e,t,i=o.uq.IdentityReadOnly){const s=new _(new o.Pq(0,0,0),new o.Pq(0,0,0));return _.CreateFromToToRef(e,t,s,i)}static CreateFromToToRef(e,t,i,s=o.uq.IdentityReadOnly){i.origin.copyFrom(e);const r=t.subtractToRef(e,i.direction),n=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return i.length=n,i.direction.normalize(),_.TransformToRef(i,s,i)}static Transform(e,t){const i=new _(new o.Pq(0,0,0),new o.Pq(0,0,0));return _.TransformToRef(e,t,i),i}static TransformToRef(e,t,i){o.Pq.TransformCoordinatesToRef(e.origin,t,i.origin),o.Pq.TransformNormalToRef(e.direction,t,i.direction),i.length=e.length,i.epsilon=e.epsilon;const s=i.direction,r=s.length();if(0!==r&&1!==r){const e=1/r;s.x*=e,s.y*=e,s.z*=e,i.length*=r}return i}unprojectRayToRef(e,t,i,s,r,n,a){const h=o.AA.Matrix[0];r.multiplyToRef(n,h),h.multiplyToRef(a,h),h.invert();const l=c.q.LastCreatedEngine,u=o.AA.Vector3[0];u.x=e/i*2-1,u.y=-(t/s*2-1),u.z=l?.useReverseDepthBuffer?1:l?.isNDCHalfZRange?0:-1;const d=o.AA.Vector3[1].copyFromFloats(u.x,u.y,1-1e-8),_=o.AA.Vector3[2],p=o.AA.Vector3[3];o.Pq._UnprojectFromInvertedMatrixToRef(u,h,_),o.Pq._UnprojectFromInvertedMatrixToRef(d,h,p),this.origin.copyFrom(_),p.subtractToRef(_,this.direction),this.direction.normalize()}}function p(e,t,i,s,r,n=!1){const o=_.Zero();return g(e,t,i,s,o,r,n),o}function g(e,t,i,s,r,n,a=!1,h=!1){const l=e.getEngine();if(!n&&!(n=e.activeCamera))return e;const c=n.viewport,u=l.getRenderHeight(),{x:d,y:_,width:p,height:g}=c.toGlobal(l.getRenderWidth(),u),f=1/l.getHardwareScalingLevel();return t=t*f-d,i=i*f-(u-_-g),r.update(t,i,p,g,s||o.uq.IdentityReadOnly,a?o.uq.IdentityReadOnly:n.getViewMatrix(),n.getProjectionMatrix(),h),e}function f(e,t,i,s,r){if(!l.G)return e;const n=e.getEngine();if(!r&&!(r=e.activeCamera))throw new Error("Active camera not set");const a=r.viewport,h=n.getRenderHeight(),{x:c,y:u,width:d,height:_}=a.toGlobal(n.getRenderWidth(),h),p=o.uq.Identity(),g=1/n.getHardwareScalingLevel();return t=t*g-c,i=i*g-(h-u-_),s.update(t,i,d,_,p,p,r.getProjectionMatrix()),e}function m(e,t,i,s,r,n,o,a){const h=t(s,i.enableDistantPicking),l=i.intersects(h,r,o,n,s,a);return l&&l.hit?!r&&null!=e&&l.distance>=e.distance?null:l:null}function b(e,t,i,s,r,n){let a=null;const h=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),c=e.cameraToUseForPointers||e.activeCamera,u=d||m;for(let l=0;l<e.meshes.length;l++){const d=e.meshes[l];if(i){if(!i(d,-1))continue}else if(!d.isEnabled()||!d.isVisible||!d.isPickable)continue;const _=h&&d.isWorldMatrixCameraDependent(),p=d.computeWorldMatrix(_,c);if(d.hasThinInstances&&d.thinInstanceEnablePicking){const e=u(a,t,d,p,!0,!0,n);if(e){if(r)return e;const h=o.AA.Matrix[1],l=d.thinInstanceGetWorldMatrices();for(let e=0;e<l.length;e++){if(i&&!i(d,e))continue;l[e].multiplyToRef(p,h);const o=u(a,t,d,h,s,r,n,!0);if(o&&(a=o,a.thinInstanceIndex=e,s))return a}}}else{const e=u(a,t,d,p,s,r,n);if(e&&(a=e,s))return a}}return a||new l.G}function v(e,t,i,s){if(!l.G)return null;const r=[],n=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),a=e.cameraToUseForPointers||e.activeCamera,h=d||m;for(let l=0;l<e.meshes.length;l++){const c=e.meshes[l];if(i){if(!i(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.isPickable)continue;const u=n&&c.isWorldMatrixCameraDependent(),d=c.computeWorldMatrix(u,a);if(c.hasThinInstances&&c.thinInstanceEnablePicking){if(h(null,t,c,d,!0,!0,s)){const e=o.AA.Matrix[1],n=c.thinInstanceGetWorldMatrices();for(let o=0;o<n.length;o++){if(i&&!i(c,o))continue;n[o].multiplyToRef(d,e);const a=h(null,t,c,e,!1,!1,s,!0);a&&(a.thinInstanceIndex=o,r.push(a))}}}else{const e=h(null,t,c,d,!1,!1,s);e&&r.push(e)}}return r}function T(e,t,i=100,s,r){s||(s=e.getWorldMatrix()),t.length=i,r?t.origin.copyFrom(r):t.origin.copyFrom(e.position);const n=o.AA.Vector3[2];n.set(0,0,e._scene.useRightHandedSystem?-1:1);const a=o.AA.Vector3[3];return o.Pq.TransformNormalToRef(n,s,a),o.Pq.NormalizeToRef(a,t.direction),t}var y,x;_._TmpVector3=(0,a.mI)(6,o.Pq.Zero),_._RayDistant=_.Zero(),_._Smallnum=1e-8,_._Rayl=1e9,y=s.Z,(x=r.i)&&(x.prototype.getForwardRay=function(e=100,t,i){return T(this,new _(o.Pq.Zero(),o.Pq.Zero(),e),e,t,i)},x.prototype.getForwardRayToRef=function(e,t=100,i,s){return T(this,e,t,i,s)}),y&&(u.h._IsPickingAvailable=!0,y.prototype.createPickingRay=function(e,t,i,s,r=!1){return p(this,e,t,i,s,r)}),s.Z.prototype.createPickingRayToRef=function(e,t,i,s,r,n=!1,o=!1){return g(this,e,t,i,s,r,n,o)},s.Z.prototype.createPickingRayInCameraSpace=function(e,t,i){return function(e,t,i,s){const r=_.Zero();return f(e,t,i,r,s),r}(this,e,t,i)},s.Z.prototype.createPickingRayInCameraSpaceToRef=function(e,t,i,s){return f(this,e,t,i,s)},s.Z.prototype.pickWithBoundingInfo=function(e,t,i,s,r){return function(e,t,i,s,r,n){if(!l.G)return null;const a=b(e,(s=>(e._tempPickingRay||(e._tempPickingRay=_.Zero()),g(e,t,i,s,e._tempPickingRay,n||null),e._tempPickingRay)),s,r,!0);return a&&(a.ray=p(e,t,i,o.uq.Identity(),n||null)),a}(this,e,t,i,s,r)},s.Z.prototype.pick=function(e,t,i,s,r,n,a=!1){return function(e,t,i,s,r,n,a){const h=b(e,((s,r)=>(e._tempPickingRay||(e._tempPickingRay=_.Zero()),g(e,t,i,s,e._tempPickingRay,n||null,!1,r),e._tempPickingRay)),s,r,!1,a);return h&&(h.ray=p(e,t,i,o.uq.Identity(),n||null)),h}(this,e,t,i,s,r,n)},s.Z.prototype.pickWithRay=function(e,t,i,s){return function(e,t,i,s,r){const n=b(e,(i=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=o.uq.Identity()),i.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=_.Zero()),_.TransformToRef(t,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform)),i,s,!1,r);return n&&(n.ray=t),n}(this,e,t,i,s)},s.Z.prototype.multiPick=function(e,t,i,s,r){return function(e,t,i,s,r,n){return v(e,(s=>p(e,t,i,s,r||null)),s,n)}(this,e,t,i,s,r)},s.Z.prototype.multiPickWithRay=function(e,t,i){return function(e,t,i,s){return v(e,(i=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=o.uq.Identity()),i.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=_.Zero()),_.TransformToRef(t,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform)),i,s)}(this,e,t,i)}},844:(e,t,i)=>{"use strict";i.d(t,{S:()=>u});var s=i(4754),r=i(4537),n=i(4049),o=i(4459),a=i(9271),h=i(9732),l=i(5686),c=i(976);class u extends o.F{get angularSensibility(){const e=this.inputs.attached.mouse;return e?e.angularSensibility:0}set angularSensibility(e){const t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get keysUpward(){const e=this.inputs.attached.keyboard;return e?e.keysUpward:[]}set keysUpward(e){const t=this.inputs.attached.keyboard;t&&(t.keysUpward=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}get keysDownward(){const e=this.inputs.attached.keyboard;return e?e.keysDownward:[]}set keysDownward(e){const t=this.inputs.attached.keyboard;t&&(t.keysDownward=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}get keysRotateLeft(){const e=this.inputs.attached.keyboard;return e?e.keysRotateLeft:[]}set keysRotateLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateLeft=e)}get keysRotateRight(){const e=this.inputs.attached.keyboard;return e?e.keysRotateRight:[]}set keysRotateRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateRight=e)}get keysRotateUp(){const e=this.inputs.attached.keyboard;return e?e.keysRotateUp:[]}set keysRotateUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateUp=e)}get keysRotateDown(){const e=this.inputs.attached.keyboard;return e?e.keysRotateDown:[]}set keysRotateDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateDown=e)}constructor(e,t,i,s=!0){super(e,t,i,s),this.ellipsoid=new n.Pq(.5,1,.5),this.ellipsoidOffset=new n.Pq(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=n.Pq.Zero(),this._diffPosition=n.Pq.Zero(),this._newPosition=n.Pq.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=(e,t,i=null)=>{this._newPosition.copyFrom(t),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>c.$.CollisionsEpsilon&&(this.position.addToRef(this._diffPosition,this._deferredPositionUpdate),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate),this.onCollide&&i&&this.onCollide(i))},this.inputs=new a.s(this),this.inputs.addKeyboard().addMouse()}attachControl(e,t){t=h.S0.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(t)}detachControl(){this.inputs.detachElement(),this.cameraDirection=new n.Pq(0,0,0),this.cameraRotation=new n.I9(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(e){this._collisionMask=isNaN(e)?-1:e}_collideWithWorld(e){let t;t=this.parent?n.Pq.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let s=e;this.applyGravity&&(s=e.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,s,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=n.Pq.Zero(),this._transformedDirection=n.Pq.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(e){this._needMoveForGravity=e}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"FreeCamera"}}(0,s.Cg)([(0,r.P_)()],u.prototype,"ellipsoid",void 0),(0,s.Cg)([(0,r.P_)()],u.prototype,"ellipsoidOffset",void 0),(0,s.Cg)([(0,r.lK)()],u.prototype,"checkCollisions",void 0),(0,s.Cg)([(0,r.lK)()],u.prototype,"applyGravity",void 0),(0,l.Y5)("BABYLON.FreeCamera",u)},866:(e,t,i)=>{"use strict";i.d(t,{ji:()=>r});const s={};function r(e,t){s[e]=t}},879:(e,t,i)=>{"use strict";i.d(t,{h:()=>r});var s=i(976);class r{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(e){this._BaseWeightTextureEnabled!==e&&(this._BaseWeightTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(e){this._DecalMapEnabled!==e&&(this._DecalMapEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,s.$.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(e){this._TranslucencyColorTextureEnabled!==e&&(this._TranslucencyColorTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,s.$.MarkAllMaterialsAsDirty(1))}}r._DiffuseTextureEnabled=!0,r._BaseWeightTextureEnabled=!0,r._DetailTextureEnabled=!0,r._DecalMapEnabled=!0,r._AmbientTextureEnabled=!0,r._OpacityTextureEnabled=!0,r._ReflectionTextureEnabled=!0,r._EmissiveTextureEnabled=!0,r._SpecularTextureEnabled=!0,r._BumpTextureEnabled=!0,r._LightmapTextureEnabled=!0,r._RefractionTextureEnabled=!0,r._ColorGradingTextureEnabled=!0,r._FresnelEnabled=!0,r._ClearCoatTextureEnabled=!0,r._ClearCoatBumpTextureEnabled=!0,r._ClearCoatTintTextureEnabled=!0,r._SheenTextureEnabled=!0,r._AnisotropicTextureEnabled=!0,r._ThicknessTextureEnabled=!0,r._RefractionIntensityTextureEnabled=!0,r._TranslucencyIntensityTextureEnabled=!0,r._TranslucencyColorTextureEnabled=!0,r._IridescenceTextureEnabled=!0},946:(e,t,i)=>{"use strict";var s=i(4499),r=i(1711),n=i(376),o=i(3836);e.exports=function(e){if(e.length<1||"function"!=typeof e[0])throw new r("a function is required");return o(s,n,e)}},959:(e,t,i)=>{"use strict";function s(e,t){const i=[];for(let s=0;s<e;++s)i.push(t());return i}function r(e,t){return s(e,t)}i.d(t,{lL:()=>o,ln:()=>r,mI:()=>s});const n=["push","splice","pop","shift","unshift"];function o(e,t){const i=n.map((i=>function(e,t,i){const s=e[t];if("function"!=typeof s)return null;const r=function(){const s=e.length,n=r.previous.apply(e,arguments);return i(t,s),n};return s.next=r,r.previous=s,e[t]=r,()=>{const i=r.previous;if(!i)return;const s=r.next;s?(i.next=s,s.previous=i):(i.next=void 0,e[t]=i),r.next=void 0,r.previous=void 0}}(e,i,t)));return()=>{i.forEach((e=>{e?.()}))}}},976:(e,t,i)=>{"use strict";i.d(t,{$:()=>v});var s=i(1497),r=i(3039),n=i(2450),o=i(3405),a=i(8827);class h{constructor(e=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class l{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}constructor(e=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}reset(){this.stencilMaterial=void 0,this.stencilGlobal?.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(e){if(!e)return;const t=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class c{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=c.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=c.KEEP,this.opDepthFail=c.KEEP,this.opStencilDepthPass=c.REPLACE}get stencilFunc(){return this.func}set stencilFunc(e){this.func=e}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(e){this.funcRef=e}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(e){this.funcMask=e}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(e){this.opDepthFail=e}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}get stencilMask(){return this.mask}set stencilMask(e){this.mask=e}get stencilTest(){return this.enabled}set stencilTest(e){this.enabled=e}}c.ALWAYS=519,c.KEEP=7680,c.REPLACE=7681;class u{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(e,t,i,s){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===s||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=s,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(e,t,i,s){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===s||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=s,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var d=i(2213),_=i(3788),p=i(4920),g=i(3054),f=i(8615),m=i(2144);function b(e,t){if((0,p.BA)()){const{requestAnimationFrame:i}=t||window;if("function"==typeof i)return i(e)}else if("function"==typeof requestAnimationFrame)return requestAnimationFrame(e);return setTimeout(e,16)}class v{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(e){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return this.isNDCHalfZRange&&(e+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}_rebuildInternalTextures(){const e=this._internalTexturesCache.slice();for(const t of e)t._rebuild()}_rebuildRenderTargetWrappers(){const e=this._renderTargetWrapperCache.slice();for(const t of e)t._rebuild()}_rebuildEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}n.M.ResetCache()}_rebuildGraphicsResources(){this.wipeCaches(!0),this._rebuildEffects(),this._rebuildComputeEffects?.(),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){r.V.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(e){setTimeout((async()=>{this._clearEmptyResources();const t=this._depthCullingState.depthTest,i=this._depthCullingState.depthFunc,s=this._depthCullingState.depthMask,r=this._stencilState.stencilTest;await e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=i,this._depthCullingState.depthMask=s,this._stencilState.stencilTest=r,this._flagContextRestored()}),0)}get isDisposed(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(e){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(e){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(e){if(!e)return this._activeRenderLoops.length=0,void this._cancelFrame();const t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const e=this._frameHandler;if(this._frameHandler=0,(0,p.BA)()){const{cancelAnimationFrame:t}=this.getHostWindow()||window;if("function"==typeof t)return t(e)}else if("function"==typeof cancelAnimationFrame)return cancelAnimationFrame(e);return clearTimeout(e)}}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e,void 0!==e&&(this._minFrameTime=e<=0?Number.MAX_VALUE:1e3/(e+1))}_isOverFrameTime(e){if(!e)return!1;const t=e-this._lastFrameTime;return!(void 0===this._maxFPS||t>=this._minFrameTime)||(this._lastFrameTime=e,!1)}_processFrame(e){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(e)){let e=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.endFrame())}}_renderLoop(e){this._processFrame(e),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++)(0,this._activeRenderLoops[e])()}_renderViews(){return!1}_queueNewFrame(e,t){return b(e,t)}runRenderLoop(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(e){this._depthCullingState.depthTest=e}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}getZOffset(){const e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}getZOffsetUnits(){const e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}getHostWindow(){return(0,p.BA)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(e){this._compatibilityMode=!0}_rebuildTextures(){for(const e of this.scenes)e._rebuildTextures();for(const e of this._virtualScenes)e._rebuildTextures()}_releaseRenderTargetWrapper(e){const t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)}get currentViewport(){return this._cachedViewport}setViewport(e,t,i){const s=t||this.getRenderWidth(),r=i||this.getRenderHeight(),n=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(n*s,o*r,s*e.width,r*e.height)}createCanvasImage(){return document.createElement("img")}get description(){let e=this.name+this.version;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}_createTextureBase(e,t,i,n,o=3,a=null,h=null,l,c,u=null,d=null,p=null,g=null,f,b,T){const y="data:"===(e=e||"").substr(0,5),x="blob:"===e.substr(0,5),A=y&&-1!==e.indexOf(";base64,"),C=d||new _.h(this,1);C!==d&&(C.label=e.substring(0,60));const S=e;!this._transformTextureUrl||A||d||u||(e=this._transformTextureUrl(e)),S!==e&&(C._originalUrl=S);const E=e.lastIndexOf(".");let R=g||(E>-1?e.substring(E).toLowerCase():"");R.indexOf("?")>-1&&(R=R.split("?")[0]);const P=(0,m.gT)(R,f);n&&n.addPendingData(C),C.url=e,C.generateMipMaps=!t,C.samplingMode=o,C.invertY=i,C._useSRGBBuffer=this._getUseSRGBBuffer(!!T,t),this._doNotHandleContextLost||(C._buffer=u);let I=null;a&&!d&&(I=C.onLoadedObservable.add(a)),d||this._internalTexturesCache.push(C);const M=(i,d)=>{n&&n.removePendingData(C),e===S?(I&&C.onLoadedObservable.remove(I),s.q.UseFallbackTexture&&e!==s.q.FallbackTexture&&this._createTextureBase(s.q.FallbackTexture,t,C.invertY,n,o,null,h,l,c,u,C),i=(i||"Unknown error")+(s.q.UseFallbackTexture?" - Fallback texture was used":""),C.onErrorObservable.notifyObservers({message:i,exception:d}),h&&h(i,d)):(r.V.Warn(`Failed to load ${e}, falling back to ${S}`),this._createTextureBase(S,t,C.invertY,n,o,a,h,l,c,u,C,p,g,f,b,T))};if(P){const t=async e=>{(await P).loadData(e,C,((e,t,i,s,r,a)=>{a?M("TextureLoader failed to load data"):l(C,R,n,{width:e,height:t},C.invertY,!i,s,(()=>(r(),!1)),o)}),b)};u?u instanceof ArrayBuffer?t(new Uint8Array(u)):ArrayBuffer.isView(u)?t(u):h&&h("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,(e=>t(new Uint8Array(e))),void 0,n?n.offlineProvider:void 0,!0,((e,t)=>{M("Unable to load "+(e&&e.responseURL,t))}))}else{const i=e=>{x&&!this._doNotHandleContextLost&&(C._buffer=e),l(C,R,n,e,C.invertY,t,!1,c,o)};!y||A?u&&("string"==typeof u.decoding||u.close)?i(u):v._FileToolsLoadImage(e||"",i,M,n?n.offlineProvider:null,f,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof u||u instanceof ArrayBuffer||ArrayBuffer.isView(u)||u instanceof Blob?v._FileToolsLoadImage(u,i,M,n?n.offlineProvider:null,f,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):u&&i(u)}return C}_rebuildBuffers(){for(const e of this._uniformBuffers)e._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,p.Nf)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(e){this._name=e}static get NpmPackage(){return"babylonjs@7.51.0"}static get Version(){return"7.51.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(e,t,i){this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new h,this._stencilStateComposer=new l,this._stencilState=new c,this._alphaState=new u,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new g.cP,this.onCanvasFocusObservable=new g.cP,this.onNewSceneAddedObservable=new g.cP,this.onResizeObservable=new g.cP,this.onCanvasPointerOutObservable=new g.cP,this.onEffectErrorObservable=new g.cP,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new g.cP,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=e=>this._renderLoop(e),this._lastFrameTime=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new g.cP,this.onAfterShaderCompilationObservable=new g.cP,this.onBeginFrameObservable=new g.cP,this.onEndFrameObservable=new g.cP,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new g.cP,this.onContextRestoredObservable=new g.cP,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new g.cP,this.onReleaseEffectsObservable=new g.cP,s.q.Instances.push(this),this.startTime=a.j.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,o.I.SetMatrixPrecision(!!t.useHighPrecisionMatrix),(0,p.XD)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=i??!1,t.antialias=e??t.antialias,t.deterministicLockstep=t.deterministicLockstep??!1,t.lockstepMaxSteps=t.lockstepMaxSteps??4,t.timeStep=t.timeStep??1/60,t.audioEngine=t.audioEngine??!0,t.stencil=t.stencil??!0,this._audioContext=t.audioEngineOptions?.audioContext??null,this._audioDestination=t.audioEngineOptions?.audioDestination??null,this.premultipliedAlpha=t.premultipliedAlpha??!0,this._doNotHandleContextLost=!!t.doNotHandleContextLost,this._isStencilEnable=!!t.stencil,this.useExactSrgbConversions=t.useExactSrgbConversions??!1;const r=(0,p.BA)()&&window.devicePixelRatio||1,n=t.limitDeviceRatio||r;i=i||t.adaptToDeviceRatio||!1,this._hardwareScalingLevel=i?1/Math.min(n,r):1,this._lastDevicePixelRatio=r,this._creationOptions=t}resize(e=!1){let t,i;if(this.adaptToDeviceRatio){const e=(0,p.BA)()&&window.devicePixelRatio||1,t=this._lastDevicePixelRatio/e;this._lastDevicePixelRatio=e,this._hardwareScalingLevel*=t}if((0,p.BA)()&&(0,p.Nf)())if(this._renderingCanvas){const e=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};t=this._renderingCanvas.clientWidth||e.width||this._renderingCanvas.width||100,i=this._renderingCanvas.clientHeight||e.height||this._renderingCanvas.height||100}else t=window.innerWidth,i=window.innerHeight;else t=this._renderingCanvas?this._renderingCanvas.width:100,i=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(t/this._hardwareScalingLevel,i/this._hardwareScalingLevel,e)}setSize(e,t,i=!1){if(!this._renderingCanvas)return!1;if(e|=0,t|=0,!i&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)return!1;if(this._renderingCanvas.width=e,this._renderingCanvas.height=t,this.scenes){for(let e=0;e<this.scenes.length;e++){const t=this.scenes[e];for(let e=0;e<t.cameras.length;e++)t.cameras[e]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(e,t,i,s,r,n,o,a,h,l,c){throw(0,d.n)("engine.rawTexture")}createRawCubeTexture(e,t,i,s,r,n,o,a){throw(0,d.n)("engine.rawTexture")}createRawTexture3D(e,t,i,s,r,n,o,a,h,l,c){throw(0,d.n)("engine.rawTexture")}createRawTexture2DArray(e,t,i,s,r,n,o,a,h,l,c){throw(0,d.n)("engine.rawTexture")}_sharedInit(e){this._renderingCanvas=e}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const e=navigator.userAgent;this.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&(0,p.Nf)()&&"ontouchend"in document},this._checkForMobile(),(0,p.BA)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(e){return document.createElement("video")}_reportDrawCall(e=1){this._drawCalls?.addCount(e,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(e,t){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(e,t){return createImageBitmap(e,t)}resizeImageBitmap(e,t,i){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(e){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);const i=document.createElement("canvas");return i.width=e,i.height=t,i}createCanvas(e,t){return v._CreateCanvas(e,t)}static _FileToolsLoadImage(e,t,i,s,r,n){throw(0,d.n)("FileTools")}_loadFile(e,t,i,s,r,n){const o=(0,f.W0)(e,t,i,s,r,n);return this._activeRequests.push(o),o.onCompleteObservable.add((()=>{const e=this._activeRequests.indexOf(o);-1!==e&&this._activeRequests.splice(e,1)})),o}static _FileToolsLoadFile(e,t,i,s,r,n){if(f.sg.loadFile)return f.sg.loadFile(e,t,i,s,r,n);throw(0,d.n)("FileTools")}dispose(){for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();this.releaseComputeEffects?.(),n.M.ResetCache();for(const e of this._activeRequests)e.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,p.BA)()&&window.removeEventListener("resize",this._checkForMobile);const e=s.q.Instances.indexOf(this);e>=0&&s.q.Instances.splice(e,1),s.q.Instances.length||(s.q.OnEnginesDisposedObservable.notifyObservers(this),s.q.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(e){throw(0,d.n)("LoadingScreen")}static MarkAllMaterialsAsDirty(e,t){for(let i=0;i<s.q.Instances.length;i++){const r=s.q.Instances[i];for(let i=0;i<r.scenes.length;i++)r.scenes[i].markAllMaterialsAsDirty(e,t)}}}v._RenderPassIdCounter=0,v._RescalePostProcessFactory=null,v.CollisionsEpsilon=.001,v.QueueNewFrame=b},979:(e,t,i)=>{"use strict";i.d(t,{p:()=>l});var s=i(2213),r=i(641),n=i(451),o=i(4049),a=i(6706);const h=function(e,t,i,s={}){const n=e();r.Y&&r.Y.HasTags(t)&&r.Y.AddTagsTo(n,r.Y.GetTags(t,!0));const o=(0,a.K)(n),h={};for(const e in o){const r=o[e],a=t[e],c=r.type;if(null!=a&&("uniqueId"!==e||l.AllowLoadingUniqueId))switch(c){case 0:case 6:case 9:case 11:n[e]=a;break;case 1:s.cloneTexturesOnlyOnce&&h[a.uniqueId]?n[e]=h[a.uniqueId]:(n[e]=i||a.isRenderTarget?a:a.clone(),h[a.uniqueId]=n[e]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:n[e]=i?a:a.clone()}}return n};class l{static AppendSerializedAnimations(e,t){if(e.animations){t.animations=[];for(let i=0;i<e.animations.length;i++){const s=e.animations[i];t.animations.push(s.serialize())}}}static Serialize(e,t){t||(t={}),r.Y&&(t.tags=r.Y.GetTags(e));const i=(0,a.K)(e);for(const s in i){const r=i[s],n=r.sourceName||s,o=r.type,a=e[s];if(null!=a&&("uniqueId"!==s||l.AllowLoadingUniqueId))switch(o){case 0:t[n]=a;break;case 1:case 3:case 7:case 9:t[n]=a.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:t[n]=a.asArray();break;case 6:case 11:t[n]=a.id}}return t}static ParseProperties(e,t,i,s){s||(s="");const r=(0,a.K)(t);for(const a in r){const h=r[a],c=e[h.sourceName||a],u=h.type;if(null!=c&&("uniqueId"!==a||l.AllowLoadingUniqueId)){const e=t;switch(u){case 0:e[a]=c;break;case 1:i&&(e[a]=l._TextureParser(c,i,s));break;case 2:e[a]=n.v9.FromArray(c);break;case 3:e[a]=l._FresnelParametersParser(c);break;case 4:e[a]=o.I9.FromArray(c);break;case 5:e[a]=o.Pq.FromArray(c);break;case 6:i&&(e[a]=i.getLastMeshById(c));break;case 7:e[a]=l._ColorCurvesParser(c);break;case 8:e[a]=n.ov.FromArray(c);break;case 9:e[a]=l._ImageProcessingConfigurationParser(c);break;case 10:e[a]=o.PT.FromArray(c);break;case 11:i&&(e[a]=i.getCameraById(c));break;case 12:e[a]=o.uq.FromArray(c)}}}}static Parse(e,t,i,s=null){const n=e();return r.Y&&r.Y.AddTagsTo(n,t.tags),l.ParseProperties(t,n,i,s),n}static Clone(e,t,i={}){return h(e,t,!1,i)}static Instanciate(e,t){return h(e,t,!0)}}l.AllowLoadingUniqueId=!1,l._ImageProcessingConfigurationParser=e=>{throw(0,s.n)("ImageProcessingConfiguration")},l._FresnelParametersParser=e=>{throw(0,s.n)("FresnelParameters")},l._ColorCurvesParser=e=>{throw(0,s.n)("ColorCurves")},l._TextureParser=(e,t,i)=>{throw(0,s.n)("Texture")}},1011:(e,t,i)=>{"use strict";var s=i(3788),r=i(3039),n=i(9649),o=i(7634),a=i(976),h=i(2144);a.$.prototype._partialLoadFile=function(e,t,i,s,r=null){this._loadFile(e,(e=>{i[t]=e,i._internalCount++,6===i._internalCount&&s(i)}),void 0,void 0,!0,((e,t)=>{r&&e&&r(e.status+" "+e.statusText,t)}))},a.$.prototype._cascadeLoadFiles=function(e,t,i,s=null){const r=[];r._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(i[e],e,r,t,s)},a.$.prototype._cascadeLoadImgs=function(e,t,i,s,r=null,n){const o=[];o._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(s[a],a,o,e,t,i,r,n)},a.$.prototype._partialLoadImg=function(e,t,i,s,r,a,h=null,l){const c=(0,o.z)();(0,n.W$)(e,(e=>{i[t]=e,i._internalCount++,s&&s.removePendingData(c),6===i._internalCount&&a&&a(r,i)}),((e,t)=>{s&&s.removePendingData(c),h&&h(e,t)}),s?s.offlineProvider:null,l),s&&s.addPendingData(c)},a.$.prototype.createCubeTextureBase=function(e,t,i,n,o=null,a=null,l,c=null,u=!1,d=0,_=0,p=null,g=null,f=null,m=!1,b=null){const v=p||new s.h(this,7);v.isCube=!0,v.url=e,v.generateMipMaps=!n,v._lodGenerationScale=d,v._lodGenerationOffset=_,v._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),v!==p&&(v.label=e.substring(0,60)),this._doNotHandleContextLost||(v._extension=c,v._files=i,v._buffer=b);const T=e;this._transformTextureUrl&&!p&&(e=this._transformTextureUrl(e));const y=c??function(e){const t=e.split("?")[0],i=t.lastIndexOf(".");return i>-1?t.substring(i).toLowerCase():""}(e),x=(0,h.gT)(y),A=(s,h)=>{e===T?a&&s&&a(s.status+" "+s.statusText,h):(r.V.Warn(`Failed to load ${e}, falling back to the ${T}`),this.createCubeTextureBase(T,t,i,!!n,o,a,l,c,u,d,_,v,g,f,m,b))};if(x)x.then((s=>{const n=e=>{g&&g(v,e),s.loadCubeData(e,v,u,o,a)};b?n(b):i&&6===i.length?s.supportCascades?this._cascadeLoadFiles(t,(e=>n(e.map((e=>new Uint8Array(e))))),i,a):a?a("Textures type does not support cascades."):r.V.Warn("Texture loader does not support cascades."):this._loadFile(e,(e=>n(new Uint8Array(e))),void 0,void 0,!0,A)}));else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,v,((e,t)=>{f&&f(e,t)}),i,a)}return this._internalTexturesCache.push(v),v}},1077:(e,t,i)=>{"use strict";i.d(t,{$:()=>c,J:()=>l});var s=i(766),r=i(1956),n=i(3054),o=i(2450),a=i(2558);i(242);const h={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class l{constructor(e,t=h){this._fullscreenViewport=new r.L(0,0,1,1);const i=t.positions??h.positions,n=t.indices??h.indices;this.engine=e,this._vertexBuffers={[s.R.PositionKind]:new s.R(e,i,s.R.PositionKind,!1,!1,2)},this._indexBuffer=e.createIndexBuffer(n),this._onContextRestoredObserver=e.onContextRestoredObservable.add((()=>{this._indexBuffer=e.createIndexBuffer(n);for(const e in this._vertexBuffers)this._vertexBuffers[e]._rebuild()}))}setViewport(e=this._fullscreenViewport){this.engine.setViewport(e)}bindBuffers(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)}applyEffectWrapper(e){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(e.drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.engine.drawElementsType(0,0,6)}_isRenderTargetTexture(e){return void 0!==e.renderTarget}render(e,t=null){if(!e.effect.isReady())return;this.saveStates(),this.setViewport();const i=null===t?null:this._isRenderTargetTexture(t)?t.renderTarget:t;i&&this.engine.bindFramebuffer(i),this.applyEffectWrapper(e),this.draw(),i&&this.engine.unBindFramebuffer(i),this.restoreStates()}dispose(){const e=this._vertexBuffers[s.R.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[s.R.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class c{static RegisterShaderCodeProcessing(e,t){t?c._CustomShaderCodeProcessing[e??""]=t:delete c._CustomShaderCodeProcessing[e??""]}static _GetShaderCodeProcessing(e){return c._CustomShaderCodeProcessing[e]??c._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(e){this.options.name=e}isReady(){return this._drawWrapper.effect?.isReady()??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(e){this._drawWrapper.effect=e}constructor(e){this.alphaMode=0,this.onEffectCreatedObservable=new n.cP(void 0,!0),this.onApplyObservable=new n.cP,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...e,name:e.name||"effectWrapper",engine:e.engine,uniforms:e.uniforms||e.uniformNames||[],uniformNames:void 0,samplers:e.samplers||e.samplerNames||[],samplerNames:void 0,attributeNames:e.attributeNames||["position"],uniformBuffers:e.uniformBuffers||[],defines:e.defines||"",useShaderStore:e.useShaderStore||!1,vertexUrl:e.vertexUrl||e.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:e.fragmentShader||"pass",indexParameters:e.indexParameters,blockCompilation:e.blockCompilation||!1,shaderLanguage:e.shaderLanguage||0,onCompiled:e.onCompiled||void 0,extraInitializations:e.extraInitializations||void 0,extraInitializationsAsync:e.extraInitializationsAsync||void 0,useAsPostProcess:e.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),e.vertexUrl||e.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.engine.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new a.E(this.options.engine),this._webGPUReady=1===this.options.shaderLanguage;const t=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,t,this.options.extraInitializations)}_gatherImports(e=!1,t){this.options.useAsPostProcess&&(e&&this._webGPUReady?t.push(Promise.all([i.e(7653).then(i.bind(i,7653))])):t.push(Promise.all([Promise.resolve().then(i.bind(i,242))])))}_postConstructor(e,t=null,i,s){this._importPromises.length=0,s&&this._importPromises.push(...s);const r=this.options.engine.isWebGPU&&!c.ForceGLSL;this._gatherImports(r,this._importPromises),void 0!==i&&i(r,this._importPromises),r&&this._webGPUReady&&(this.options.shaderLanguage=1),e||this.updateEffect(t)}updateEffect(e=null,t=null,i=null,s,r,n,a,h){const l=c._GetShaderCodeProcessing(this.name);if(l?.defineCustomBindings){const s=t?.slice()??[];s.push(...this.options.uniforms);const r=i?.slice()??[];r.push(...this.options.samplers),e=l.defineCustomBindings(this.name,e,s,r),t=s,i=r}this.options.defines=e||"";const u=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let d;d=this.options.extraInitializationsAsync?async()=>{u?.(),await this.options.extraInitializationsAsync}:u,this.options.useShaderStore?this._drawWrapper.effect=this.options.engine.createEffect({vertex:a??this._shaderPath.vertex,fragment:h??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:t||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:i||this.options.samplers,defines:null!==e?e:"",fallbacks:null,onCompiled:r??this.options.onCompiled,onError:n??null,indexParameters:s||this.options.indexParameters,processCodeAfterIncludes:l?.processCodeAfterIncludes?(e,t)=>l.processCodeAfterIncludes(this.name,e,t):null,processFinalCode:l?.processFinalCode?(e,t)=>l.processFinalCode(this.name,e,t):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:d},this.options.engine):this._drawWrapper.effect=new o.M(this._shaderPath,this.options.attributeNames,t||this.options.uniforms,i||this.options.samplerNames,this.options.engine,e,void 0,r||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,d),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){this.options.useAsPostProcess&&(this.options.engine.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),c._GetShaderCodeProcessing(this.name)?.bindCustomBindings?.(this.name,this._drawWrapper.effect)}dispose(e=!1){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}c.ForceGLSL=!1,c._CustomShaderCodeProcessing={}},1088:(e,t,i)=>{"use strict";var s=i(588),r=i(5364),n=i(769),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},h=Array.isArray,l=Array.prototype.push,c=function(e,t){l.apply(e,h(t)?t:[t])},u=Date.prototype.toISOString,d=n.default,_={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:r.encode,encodeValuesOnly:!1,filter:void 0,format:d,formatter:n.formatters[d],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},p={},g=function e(t,i,n,o,a,l,u,d,g,f,m,b,v,T,y,x,A,C){for(var S,E=t,R=C,P=0,I=!1;void 0!==(R=R.get(p))&&!I;){var M=R.get(t);if(P+=1,void 0!==M){if(M===P)throw new RangeError("Cyclic object value");I=!0}void 0===R.get(p)&&(P=0)}if("function"==typeof f?E=f(i,E):E instanceof Date?E=v(E):"comma"===n&&h(E)&&(E=r.maybeMap(E,(function(e){return e instanceof Date?v(e):e}))),null===E){if(l)return g&&!x?g(i,_.encoder,A,"key",T):i;E=""}if("string"==typeof(S=E)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||r.isBuffer(E))return g?[y(x?i:g(i,_.encoder,A,"key",T))+"="+y(g(E,_.encoder,A,"value",T))]:[y(i)+"="+y(String(E))];var w,O=[];if(void 0===E)return O;if("comma"===n&&h(E))x&&g&&(E=r.maybeMap(E,g)),w=[{value:E.length>0?E.join(",")||null:void 0}];else if(h(f))w=f;else{var B=Object.keys(E);w=m?B.sort(m):B}var D=d?String(i).replace(/\./g,"%2E"):String(i),F=o&&h(E)&&1===E.length?D+"[]":D;if(a&&h(E)&&0===E.length)return F+"[]";for(var L=0;L<w.length;++L){var N=w[L],k="object"==typeof N&&N&&void 0!==N.value?N.value:E[N];if(!u||null!==k){var U=b&&d?String(N).replace(/\./g,"%2E"):String(N),V=h(E)?"function"==typeof n?n(F,U):F:F+(b?"."+U:"["+U+"]");C.set(t,P);var G=s();G.set(p,C),c(O,e(k,V,n,o,a,l,u,d,"comma"===n&&x&&h(E)?null:g,f,m,b,v,T,y,x,A,G))}}return O};e.exports=function(e,t){var i,r=e,l=function(e){if(!e)return _;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||_.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=n.default;if(void 0!==e.format){if(!o.call(n.formatters,e.format))throw new TypeError("Unknown format option provided.");i=e.format}var s,r=n.formatters[i],l=_.filter;if(("function"==typeof e.filter||h(e.filter))&&(l=e.filter),s=e.arrayFormat in a?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":_.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var c=void 0===e.allowDots?!0===e.encodeDotInKeys||_.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:_.addQueryPrefix,allowDots:c,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:_.allowEmptyArrays,arrayFormat:s,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:_.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?_.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:_.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:_.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:_.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:_.encodeValuesOnly,filter:l,format:i,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:_.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:_.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:_.strictNullHandling}}(t);"function"==typeof l.filter?r=(0,l.filter)("",r):h(l.filter)&&(i=l.filter);var u=[];if("object"!=typeof r||null===r)return"";var d=a[l.arrayFormat],p="comma"===d&&l.commaRoundTrip;i||(i=Object.keys(r)),l.sort&&i.sort(l.sort);for(var f=s(),m=0;m<i.length;++m){var b=i[m],v=r[b];l.skipNulls&&null===v||c(u,g(v,b,d,p,l.allowEmptyArrays,l.strictNullHandling,l.skipNulls,l.encodeDotInKeys,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,f))}var T=u.join(l.delimiter),y=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),T.length>0?y+T:""}},1126:(e,t,i)=>{"use strict";i.d(t,{tI:()=>d,bS:()=>v,tg:()=>p,A5:()=>_,YM:()=>g,C5:()=>b,GX:()=>u,kf:()=>l,EX:()=>c,Cm:()=>h,N5:()=>a});class s{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}setEngine(e){this.engine=e}_fillEffectInformation(e,t,i,s,r,n,o,a){const h=this.engine;if(h.supportsUniformBuffers)for(const i in t)e.bindUniformBlock(i,t[i]);let l;for(this.engine.getUniforms(this,i).forEach(((e,t)=>{s[i[t]]=e})),this._uniforms=s,l=0;l<r.length;l++)null==e.getUniform(r[l])&&(r.splice(l,1),l--);r.forEach(((e,t)=>{n[e]=t}));for(const e of h.getAttributes(this,o))a.push(e)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(e,t){const i=this._valueCache[e],s=t.updateFlag;return(void 0===i||i!==s)&&(this._valueCache[e]=s,!0)}_cacheFloat2(e,t,i){let s=this._valueCache[e];if(!s||2!==s.length)return s=[t,i],this._valueCache[e]=s,!0;let r=!1;return s[0]!==t&&(s[0]=t,r=!0),s[1]!==i&&(s[1]=i,r=!0),r}_cacheFloat3(e,t,i,s){let r=this._valueCache[e];if(!r||3!==r.length)return r=[t,i,s],this._valueCache[e]=r,!0;let n=!1;return r[0]!==t&&(r[0]=t,n=!0),r[1]!==i&&(r[1]=i,n=!0),r[2]!==s&&(r[2]=s,n=!0),n}_cacheFloat4(e,t,i,s,r){let n=this._valueCache[e];if(!n||4!==n.length)return n=[t,i,s,r],this._valueCache[e]=n,!0;let o=!1;return n[0]!==t&&(n[0]=t,o=!0),n[1]!==i&&(n[1]=i,o=!0),n[2]!==s&&(n[2]=s,o=!0),n[3]!==r&&(n[3]=r,o=!0),o}setInt(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setInt3(e,t,i,s){this._cacheFloat3(e,t,i,s)&&(this.engine.setInt3(this._uniforms[e],t,i,s)||(this._valueCache[e]=null))}setInt4(e,t,i,s,r){this._cacheFloat4(e,t,i,s,r)&&(this.engine.setInt4(this._uniforms[e],t,i,s,r)||(this._valueCache[e]=null))}setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}setUInt(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setUInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setUInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setUInt3(e,t,i,s){this._cacheFloat3(e,t,i,s)&&(this.engine.setUInt3(this._uniforms[e],t,i,s)||(this._valueCache[e]=null))}setUInt4(e,t,i,s,r){this._cacheFloat4(e,t,i,s,r)&&(this.engine.setUInt4(this._uniforms[e],t,i,s,r)||(this._valueCache[e]=null))}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}setMatrix(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.asArray())||(this._valueCache[e]=null))}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setFloat(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))}setFloat2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))}setFloat3(e,t,i,s){this._cacheFloat3(e,t,i,s)&&(this.engine.setFloat3(this._uniforms[e],t,i,s)||(this._valueCache[e]=null))}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setFloat4(e,t,i,s,r){this._cacheFloat4(e,t,i,s,r)&&(this.engine.setFloat4(this._uniforms[e],t,i,s,r)||(this._valueCache[e]=null))}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))}setColor4(e,t,i){this._cacheFloat4(e,t.r,t.g,t.b,i)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null))}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}var r=i(8615);const n=new WeakMap,o={_webGLVersion:2,cachedPipelines:{}};function a(e){let t=n.get(e);if(!t){if(!e)return o;t={_webGLVersion:e.TEXTURE_BINDING_3D?2:1,_context:e,parallelShaderCompile:e.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},n.set(e,t)}return t}function h(e){n.delete(e)}function l(e,t,i,s,r,n){const o=a(s);return n||(n=o._createShaderProgramInjection??d),n(e,m(t,"vertex",s,o._contextWasLost),m(i,"fragment",s,o._contextWasLost),s,r,o.validateShaderPrograms)}function c(e,t,i,s,r,n=null,o){const h=a(r);o||(o=h._createShaderProgramInjection??d);const l=h._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return o(e,f(t,"vertex",s,l,r,h._contextWasLost),f(i,"fragment",s,l,r,h._contextWasLost),r,n,h.validateShaderPrograms)}function u(e,t){const i=new s,r=a(e);return r.parallelShaderCompile&&!r.disableParallelShaderCompile&&(i.isParallelCompiled=!0),i.context=r._context,i}function d(e,t,i,s,r=null,n){const o=s.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");return s.attachShader(o,t),s.attachShader(o,i),s.linkProgram(o),e.context=s,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||p(e,s,n),o}function _(e,t,i){const s=e;if(s._isDisposed)return!1;const r=a(t);return!!(r&&r.parallelShaderCompile&&r.parallelShaderCompile.COMPLETION_STATUS_KHR&&s.program&&t.getProgramParameter(s.program,r.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(p(s,t,i),!0)}function p(e,t,i){const s=e.context,r=e.vertexShader,n=e.fragmentShader,o=e.program;if(!s.getProgramParameter(o,s.LINK_STATUS)){if(!t.getShaderParameter(r,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(r);if(i)throw e.vertexCompilationError=i,new Error("VERTEX SHADER "+i)}if(!t.getShaderParameter(n,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(n);if(i)throw e.fragmentCompilationError=i,new Error("FRAGMENT SHADER "+i)}const i=s.getProgramInfoLog(o);if(i)throw e.programLinkError=i,new Error(i)}if(i&&(s.validateProgram(o),!s.getProgramParameter(o,s.VALIDATE_STATUS))){const t=s.getProgramInfoLog(o);if(t)throw e.programValidationError=t,new Error(t)}s.deleteShader(r),s.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}function g(e,t,i,s,r,n,o,h,u,d="",_,p,g){const f=a(e.context);p||(p=f.createRawShaderProgramInjection??l),g||(g=f.createShaderProgramInjection??c);const m=e;m.program=s?p(m,t,i,m.context,u):g(m,t,i,h,m.context,u),m.program.__SPECTOR_rebuildProgram=o,_()}function f(e,t,i,s,n,o){return m((0,r.iL)(e,i,s),t,n,o)}function m(e,t,i,s){const r=i.createShader("vertex"===t?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!r){let e=i.NO_ERROR,r=i.NO_ERROR;for(;(r=i.getError())!==i.NO_ERROR;)e=r;throw new Error(`Something went wrong while creating a gl ${t} shader object. gl error=${e}, gl isContextLost=${i.isContextLost()}, _contextWasLost=${s}`)}return i.shaderSource(r,e),i.compileShader(r),r}function b(e,t){t.useProgram(e)}function v(e,t){const i=e;if(!i.isParallelCompiled)return void t(e);const s=i.onCompiled;i.onCompiled=()=>{s?.(),t(e)}}},1146:(e,t,i)=>{"use strict";var s=i(1901),r=i(3113);r.t.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(r.t.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=s.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},1183:(e,t,i)=>{"use strict";i.d(t,{n:()=>n});var s=i(3039),r=i(5686);class n{static Instantiate(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];const t=(0,r.n9)(e);if(t)return t;s.V.Warn(e+" not found, you may have missed an import.");const i=e.split(".");let n=window||this;for(let e=0,t=i.length;e<t;e++)n=n[i[e]];return"function"!=typeof n?null:n}}n.RegisteredExternalClasses={}},1243:(e,t,i)=>{"use strict";i.d(t,{y:()=>f});var s=i(4754),r=i(4537),n=i(4564),o=i(1497),a=i(3299),h=i(4796);const l=new RegExp("^([gimus]+)!");class c{constructor(e){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=e,this._scene=e.getScene(),this._engine=this._scene.getEngine()}_addPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!e.isCompatible(this._material.shaderLanguage))throw`The plugin "${e.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const t=e.getClassName();c._MaterialPluginClassToMainDefine[t]||(c._MaterialPluginClassToMainDefine[t]="MATERIALPLUGIN_"+ ++c._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(e,t)=>this._handlePluginEvent(e,t),this._plugins.push(e),this._plugins.sort(((e,t)=>e.priority-t.priority)),this._codeInjectionPoints={};const i={};i[c._MaterialPluginClassToMainDefine[t]]={type:"boolean",default:!0};for(const e of this._plugins)e.collectDefines(i),this._collectPointNames("vertex",e.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",e.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=i,!0}_activatePlugin(e){-1===this._activePlugins.indexOf(e)&&(this._activePlugins.push(e),this._activePlugins.sort(((e,t)=>e.priority-t.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort(((e,t)=>e.priority-t.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null}_handlePluginEventIsReadyForSubMesh(e){let t=!0;for(const i of this._activePlugins)t=t&&i.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh);e.isReadyForSubMesh=t}_handlePluginEventPrepareDefinesBeforeAttributes(e){for(const t of this._activePlugins)t.prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}_handlePluginEventPrepareDefines(e){for(const t of this._activePlugins)t.prepareDefines(e.defines,this._scene,e.mesh)}_handlePluginEventHardBindForSubMesh(e){for(const t of this._activePluginsForExtraEvents)t.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventBindForSubMesh(e){for(const t of this._activePlugins)t.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventHasRenderTargetTextures(e){let t=!1;for(const e of this._activePluginsForExtraEvents)if(t=e.hasRenderTargetTextures(),t)break;e.hasRenderTargetTextures=t}_handlePluginEventFillRenderTargetTextures(e){for(const t of this._activePluginsForExtraEvents)t.fillRenderTargetTextures(e.renderTargets)}_handlePluginEvent(e,t){switch(e){case 512:{const e=t;for(const t of this._activePlugins)t.getActiveTextures(e.activeTextures);break}case 256:{const e=t;for(const t of this._activePlugins)t.getAnimatables(e.animatables);break}case 1024:{const e=t;let i=!1;for(const t of this._activePlugins)if(i=t.hasTexture(e.texture),i)break;e.hasTexture=i;break}case 2:{const e=t;for(const t of this._plugins)t.dispose(e.forceDisposeTextures);break}case 4:t.defineNames=this._defineNamesFromPlugins;break;case 128:{const e=t;for(const t of this._activePlugins)e.fallbackRank=t.addFallbacks(e.defines,e.fallbacks,e.fallbackRank),t.getAttributes(e.attributes,this._scene,e.mesh);this._uniformList.length>0&&e.uniforms.push(...this._uniformList),this._samplerList.length>0&&e.samplers.push(...this._samplerList),this._uboList.length>0&&e.uniformBuffersNames.push(...this._uboList),e.customCode=this._injectCustomCode(e,e.customCode);break}case 8:{const e=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const i=1===this._material.shaderLanguage;for(const t of this._plugins){const s=t.getUniforms(this._material.shaderLanguage);if(s){if(s.ubo)for(const t of s.ubo){if(t.size&&t.type){const s=t.arraySize??0;if(e.ubo.addUniform(t.name,t.size,s),i){let e;switch(t.type){case"mat4":e="mat4x4f";break;case"float":e="f32";break;default:e=`${t.type}f`}this._uboDeclaration+=`uniform ${t.name}: ${e}${s>0?`[${s}]`:""};\n`}else this._uboDeclaration+=`${t.type} ${t.name}${s>0?`[${s}]`:""};\n`}this._uniformList.push(t.name)}s.vertex&&(this._vertexDeclaration+=s.vertex+"\n"),s.fragment&&(this._fragmentDeclaration+=s.fragment+"\n")}t.getSamplers(this._samplerList),t.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(e,t){if(t)for(const i in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][i]=!0}_injectCustomCode(e,t){return(i,s)=>{t&&(s=t(i,s)),this._uboDeclaration&&(s=s.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(s=s.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(s=s.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const r=this._codeInjectionPoints?.[i];if(!r)return s;let n=null;for(let t in r){let r="";for(const s of this._activePlugins){let o=s.getCustomCode(i,this._material.shaderLanguage)?.[t];if(o){if(s.resolveIncludes){if(null===n){const t=0;n={defines:[],indexParameters:e.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:h.l.GetShadersRepository(t),includesShadersStore:h.l.GetIncludesShadersStore(t),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}n.isFragment="fragment"===i,(0,a.Iq)(o,n,(e=>o=e))}r+=o+"\n"}}if(r.length>0)if("!"===t.charAt(0)){t=t.substring(1);let e="g";if("!"===t.charAt(0))e="",t=t.substring(1);else{const i=l.exec(t);i&&i.length>=2&&(e=i[1],t=t.substring(e.length+1))}e.indexOf("g")<0&&(e+="g");const i=s,n=new RegExp(t,e);let o=n.exec(i);for(;null!==o;){let e=r;for(let t=0;t<o.length;++t)e=e.replace("$"+t,o[t]);s=s.replace(o[0],e),o=n.exec(i)}}else{const e="#define "+t;s=s.replace(e,"\n"+r+"\n"+e)}}return s}}}c._MaterialPluginClassToMainDefine={},c._MaterialPluginCounter=0,o.q.OnEnginesDisposedObservable.add((()=>{u.length=0,d=!1,n.i.OnEventObservable.remove(_),_=null}));const u=[];let d=!1,_=null;var p=i(979),g=i(5686);class f{isCompatible(e){return 0===e}_enable(e){e&&this._pluginManager._activatePlugin(this)}constructor(e,t,i,s,r=!0,n=!1,o=!1){this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=e,this.name=t,this.priority=i,this.resolveIncludes=o,e.pluginManager||(e.pluginManager=new c(e),e.onDisposeObservable.add((()=>{e.pluginManager=void 0}))),this._pluginDefineNames=s,this._pluginManager=e.pluginManager,r&&this._pluginManager._addPlugin(this),n&&this._enable(!0),this.markAllDefinesAsDirty=e._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(e,t,i,s){return!0}hardBindForSubMesh(e,t,i,s){}bindForSubMesh(e,t,i,s){}dispose(e){}getCustomCode(e,t=0){return null}collectDefines(e){if(this._pluginDefineNames)for(const t of Object.keys(this._pluginDefineNames)){if("_"===t[0])continue;const i=typeof this._pluginDefineNames[t];e[t]={type:"number"===i?"number":"string"===i?"string":"boolean"===i?"boolean":"object",default:this._pluginDefineNames[t]}}}prepareDefinesBeforeAttributes(e,t,i){}prepareDefines(e,t,i){}hasTexture(e){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(e){}getActiveTextures(e){}getAnimatables(e){}addFallbacks(e,t,i){return i}getSamplers(e){}getAttributes(e,t,i){}getUniformBuffersNames(e){}getUniforms(e=0){return{}}copyTo(e){p.p.Clone((()=>e),this)}serialize(){return p.p.Serialize(this)}parse(e,t,i){p.p.Parse((()=>this),e,t,i)}}(0,s.Cg)([(0,r.lK)()],f.prototype,"name",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"priority",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"resolveIncludes",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"registerForExtraEvents",void 0),(0,g.Y5)("BABYLON.MaterialPluginBase",f)},1328:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.clipPlaneVertex="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n"},1345:(e,t,i)=>{"use strict";function s(e,t,i){try{const s=e.next();s.done?t(s):s.value?s.value.then((()=>{s.value=void 0,t(s)}),i):t(s)}catch(e){i(e)}}function r(e=25){let t;return(i,r,n)=>{const o=performance.now();void 0===t||o-t>e?(t=o,setTimeout((()=>{s(i,r,n)}),0)):s(i,r,n)}}function n(e,t,i,s,r){const n=()=>{let o;const a=e=>{e.done?i(e.value):void 0===o?o=!0:n()};do{o=void 0,r&&r.aborted?s(new Error("Aborted")):t(e,a,s),void 0===o&&(o=!1)}while(o)};n()}function o(e,t){let i;return n(e,s,(e=>i=e),(e=>{throw e}),t),i}function a(e,t,i){return new Promise(((s,r)=>{n(e,t,s,r,i)}))}function h(e,t){return(...i)=>o(e(...i),t)}i.d(t,{Aj:()=>h,V1:()=>o,VP:()=>r,kj:()=>a})},1386:(e,t,i)=>{"use strict";var s=i(8499);s.ThinEngine.prototype.updateDynamicIndexBuffer=function(e,t,i=0){let s;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),s=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,s,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},s.ThinEngine.prototype.updateDynamicVertexBuffer=function(e,t,i,s){this.bindArrayBuffer(e),void 0===i&&(i=0);const r=t.byteLength||t.length;void 0===s||s>=r&&0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t).subarray(0,s/4)):(t=t instanceof ArrayBuffer?new Uint8Array(t,0,s):new Uint8Array(t.buffer,t.byteOffset,s),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t)),this._resetVertexBufferBinding()}},1399:(e,t,i)=>{"use strict";var s=i(6433);if(s)try{s([],"length")}catch(e){s=null}e.exports=s},1407:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.clipPlaneFragmentDeclaration="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n"},1425:(e,t,i)=>{"use strict";i.d(t,{L:()=>s,b:()=>r});class s{constructor(e){this.length=0,this.data=new Array(e),this._id=s._GlobalId++}push(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}forEach(e){for(let t=0;t<this.length;t++)e(this.data[t])}sort(e){this.data.sort(e)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}}indexOf(e){const t=this.data.indexOf(e);return t>=this.length?-1:t}contains(e){return-1!==this.indexOf(e)}}s._GlobalId=0;class r extends s{constructor(){super(...arguments),this._duplicateId=0}push(e){super.push(e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(e){return!(e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||(this.push(e),0))}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let t=0;t<e.length;t++){const i=(e.data||e)[t];this.pushNoDuplicate(i)}}}}},1427:(e,t,i)=>{"use strict";i.d(t,{uD:()=>P,qS:()=>A,cn:()=>w});var s,r=i(9732),n=i(3054),o=i(8836),a=i(1497),h=i(3039),l=i(6523),c=i(9649),u=i(4837),d=i(7634),_=i(976),p=i(2276);!function(e){e[e.Clean=0]="Clean",e[e.Stop=1]="Stop",e[e.Sync=2]="Sync",e[e.NoSync=3]="NoSync"}(s||(s={}));const g=new n.cP,f={};let m=!1;function b(){return f[".babylon"]}function v(e,t){return f[e]||(h.V.Warn("Unable to find a plugin to load "+e+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),t?b():void 0)}function T(e,t,i){let s="Unable to load from "+(e.rawData?"binary data":e.url);return t?s+=`: ${t}`:i&&(s+=`: ${i}`),s}async function y(e,t,i,s,r,n,o,a,h){const l="data:"===(u=e.url).substring(0,5)?u.substring(5):null;var u;if(e.rawData&&!o)throw"When using ArrayBufferView to load data the file extension must be provided.";const d=l||o?"":function(e){const t=e.indexOf("?");-1!==t&&(e=e.substring(0,t));const i=e.lastIndexOf(".");return e.substring(i,e.length).toLowerCase()}(e.url);let m=o?v(o,!0):l?function(e){for(const t in f){const i=f[t].plugin;if(i.canDirectLoad&&i.canDirectLoad(e))return f[t]}return b()}(e.url):v(d,!1);if(!m&&d){if(e.url&&!e.url.startsWith("blob:")){const t=await function(e,t){const i=t.method||"GET";return new Promise(((s,r)=>{const n=new p.u;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const e={};if(t.responseHeaders)for(const i of t.responseHeaders)e[i]=n.getResponseHeader(i)||"";s({response:n.response,headerValues:e})}else r(`Unable to fetch data from ${e}. Error code: ${n.status}`)})),n.open(i,e),n.send()}))}(e.url,{method:"HEAD",responseHeaders:["Content-Type"]}),i=t.headerValues?t.headerValues["Content-Type"]:"";i&&(m=function(e){for(const t in f){const i=f[t];if(i.mimeType===e)return i}}(i))}m||(m=b())}if(!m)throw new Error(`No plugin or fallback for ${o??e.url}`);if(!1===h?.[m.plugin.name]?.enabled)throw new Error(`The '${m.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(e.rawData&&!m.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(e=>{if(m.plugin.createPlugin){const t=m.plugin.createPlugin(h??{});return t instanceof Promise?(t.then(e).catch((e=>{r("Error instantiating plugin.",e)})),null):(e(t),t)}return e(m.plugin),m.plugin})((h=>{if(!h)throw`The loader plugin corresponding to the '${o}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(g.notifyObservers(h),l&&(h.canDirectLoad&&h.canDirectLoad(e.url)||!(0,c.f2)(e.url))){if(h.directLoad){const e=h.directLoad(t,l);e instanceof Promise?e.then((e=>{i(h,e)})).catch((e=>{r("Error in directLoad of _loadData: "+e,e)})):i(h,e)}else i(h,l);return}const u=m.isBinary,d=(e,s)=>{t.isDisposed?r("Scene has been disposed"):i(h,e,s)};let p=null,f=!1;h.onDisposeObservable?.add((()=>{f=!0,p&&(p.abort(),p=null),n()}));const b=()=>{if(f)return;const i=(e,t)=>{r(e?.statusText,t)};if(!h.loadFile&&e.rawData)throw"Plugin does not support loading ArrayBufferView.";p=h.loadFile?h.loadFile(t,e.rawData||e.file||e.url,e.rootUrl,d,s,u,i,a):t._loadFile(e.file||e.url,d,s,!0,u,i)},v=t.getEngine();let T=v.enableOfflineSupport;if(T){let i=!1;for(const s of t.disableOfflineSupportExceptionRules)if(s.test(e.url)){i=!0;break}T=!i}T&&_.$.OfflineProviderFactory?t.offlineProvider=_.$.OfflineProviderFactory(e.url,b,v.disableManifestCheck):b()}))}function x(e,t){let i,s,n=null,o=null;if(t)if(t.name)i=`file:${t.name}`,s=t.name,n=t;else if(ArrayBuffer.isView(t))i="",s=(0,d.z)(),o=t;else if(t.startsWith("data:"))i=t,s="";else if(e){const n=t;if("/"===n.substring(0,1))return r.S0.Error("Wrong sceneFilename parameter"),null;i=e+n,s=n}else i=t,s=r.S0.GetFilename(t),e=r.S0.GetFolderPath(t);else i=e,s=r.S0.GetFilename(e),e=r.S0.GetFolderPath(e);return{url:i,rootUrl:e,name:s,file:n,rawData:o}}function A(e){if("string"==typeof e.extensions){const t=e.extensions;f[t.toLowerCase()]={plugin:e,isBinary:!1}}else{const t=e.extensions;Object.keys(t).forEach((i=>{f[i.toLowerCase()]={plugin:e,isBinary:t[i].isBinary,mimeType:t[i].mimeType}}))}}async function C(e,t,i="",s=a.q.LastCreatedScene,r=null,n=null,o=null,l=null,c="",d={}){if(!s)return h.V.Error("No scene available to import mesh to"),null;const _=x(t,i);if(!_)return null;const p={};s.addPendingData(p);const g=()=>{s.removePendingData(p)},f=(e,t)=>{const i=T(_,e,t);o?o(s,i,new u.bu(i,u.tG.SceneLoaderError,t)):h.V.Error(i),g()},m=n?e=>{try{n(e)}catch(e){f("Error in onProgress callback: "+e,e)}}:void 0,b=(e,t,i,n,o,a,h,l)=>{if(s.importedMeshesFiles.push(_.url),r)try{r(e,t,i,n,o,a,h,l)}catch(e){f("Error in onSuccess callback: "+e,e)}s.removePendingData(p)};return await y(_,s,((t,i,r)=>{if(t.rewriteRootURL&&(_.rootUrl=t.rewriteRootURL(_.rootUrl,r)),t.importMesh){const r=[],n=[],o=[];if(!t.importMesh(e,s,i,_.rootUrl,r,n,o,f))return;s.loadingPluginName=t.name,b(r,n,o,[],[],[],[],[])}else t.importMeshAsync(e,s,i,_.rootUrl,m,_.name).then((e=>{s.loadingPluginName=t.name,b(e.meshes,e.particleSystems,e.skeletons,e.animationGroups,e.transformNodes,e.geometries,e.lights,e.spriteManagers)})).catch((e=>{f(e.message,e)}))}),m,f,g,l,c,d)}async function S(e,t="",i=a.q.LastCreatedEngine,s=null,n=null,h=null,l=null,c="",u={}){i?await E(e,t,new o.Z(i),s,n,h,l,c,u):r.S0.Error("No engine available")}async function E(e,t="",i=a.q.LastCreatedScene,s=null,r=null,n=null,o=null,c="",d={}){if(!i)return h.V.Error("No scene available to append to"),null;const _=x(e,t);if(!_)return null;const p={};i.addPendingData(p);const g=()=>{i.removePendingData(p)};l.B.ShowLoadingScreen&&!m&&(m=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((()=>{i.getEngine().hideLoadingUI(),m=!1})));const f=(e,t)=>{const s=T(_,e,t);n?n(i,s,new u.bu(s,u.tG.SceneLoaderError,t)):h.V.Error(s),g()},b=r?e=>{try{r(e)}catch(e){f("Error in onProgress callback",e)}}:void 0,v=()=>{if(s)try{s(i)}catch(e){f("Error in onSuccess callback",e)}i.removePendingData(p)};return await y(_,i,((e,t)=>{if(e.load){if(!e.load(i,t,_.rootUrl,f))return;i.loadingPluginName=e.name,v()}else e.loadAsync(i,t,_.rootUrl,b,_.name).then((()=>{i.loadingPluginName=e.name,v()})).catch((e=>{f(e.message,e)}))}),b,f,g,o,c,d)}async function R(e,t="",i=a.q.LastCreatedScene,s=null,r=null,n=null,o=null,l="",c={}){if(!i)return h.V.Error("No scene available to load asset container to"),null;const d=x(e,t);if(!d)return null;const _={};i.addPendingData(_);const p=()=>{i.removePendingData(_)},g=(e,t)=>{const s=T(d,e,t);n?n(i,s,new u.bu(s,u.tG.SceneLoaderError,t)):h.V.Error(s),p()},f=r?e=>{try{r(e)}catch(e){g("Error in onProgress callback",e)}}:void 0,m=e=>{if(s)try{s(e)}catch(e){g("Error in onSuccess callback",e)}i.removePendingData(_)};return await y(d,i,((e,t)=>{if(e.loadAssetContainer){const s=e.loadAssetContainer(i,t,d.rootUrl,g);if(!s)return;s.populateRootNodes(),i.loadingPluginName=e.name,m(s)}else e.loadAssetContainerAsync?e.loadAssetContainerAsync(i,t,d.rootUrl,f,d.name).then((t=>{t.populateRootNodes(),i.loadingPluginName=e.name,m(t)})).catch((e=>{g(e.message,e)})):g("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),f,g,p,o,l,c)}function P(e,t,i){const{rootUrl:s="",onProgress:r,pluginExtension:n,name:o,pluginOptions:a}=i??{};return I(s,e,t,r,n,o,a)}function I(e,t,i,s,r,n,o){return new Promise(((a,h)=>{try{R(e,t,i,(e=>{a(e)}),s,((e,t,i)=>{h(i||new Error(t))}),r,n,o).catch(h)}catch(e){h(e)}}))}async function M(e,t="",i=a.q.LastCreatedScene,s=!0,r=0,n=null,o=null,l=null,c=null,u=null,d="",_={}){if(!i)return void h.V.Error("No scene available to load animations to");if(s){for(const e of i.animatables)e.reset();i.stopAllAnimations(),i.animationGroups.slice().forEach((e=>{e.dispose()})),i.getNodes().forEach((e=>{e.animations&&(e.animations=[])}))}else switch(r){case 0:i.animationGroups.slice().forEach((e=>{e.dispose()}));break;case 1:i.animationGroups.forEach((e=>{e.stop()}));break;case 2:i.animationGroups.forEach((e=>{e.reset(),e.restart()}));break;case 3:break;default:return void h.V.Error("Unknown animation group loading mode value '"+r+"'")}const p=i.animatables.length;await R(e,t,i,(e=>{e.mergeAnimationsTo(i,i.animatables.slice(p),n),e.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),o&&o(i)}),l,c,u,d,_)}class w{static get ForceFullSceneLoadingForIncremental(){return l.B.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){l.B.ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return l.B.ShowLoadingScreen}static set ShowLoadingScreen(e){l.B.ShowLoadingScreen=e}static get loggingLevel(){return l.B.loggingLevel}static set loggingLevel(e){l.B.loggingLevel=e}static get CleanBoneMatrixWeights(){return l.B.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){l.B.CleanBoneMatrixWeights=e}static GetDefaultPlugin(){return b()}static GetPluginForExtension(e){return v(e,!0)?.plugin}static IsPluginForExtensionAvailable(e){return function(e){return!!f[e]}(e)}static RegisterPlugin(e){A(e)}static ImportMesh(e,t,i,s,r,n,o,h,l){C(e,t,i,s,r,n,o,h,l).catch((e=>o?.(a.q.LastCreatedScene,e?.message,e)))}static ImportMeshAsync(e,t,i,s,r,n,o){return function(e,t,i,s,r,n,o){return new Promise(((a,h)=>{try{C(e,t,i,s,((e,t,i,s,r,n,o,h)=>{a({meshes:e,particleSystems:t,skeletons:i,animationGroups:s,transformNodes:r,geometries:n,lights:o,spriteManagers:h})}),r,((e,t,i)=>{h(i||new Error(t))}),n,o,undefined).catch(h)}catch(e){h(e)}}))}(e,t,i,s,r,n,o)}static Load(e,t,i,s,r,n,o,h){S(e,t,i,s,r,n,o,h).catch((e=>n?.(a.q.LastCreatedScene,e?.message,e)))}static LoadAsync(e,t,i,s,r,n){return function(e,t,i,s,r,n,o){return new Promise(((a,h)=>{S(e,t,i,(e=>{a(e)}),s,((e,t,i)=>{h(i||new Error(t))}),r,n,o)}))}(e,t,i,s,r,n)}static Append(e,t,i,s,r,n,o,h){E(e,t,i,s,r,n,o,h).catch((e=>n?.(i??a.q.LastCreatedScene,e?.message,e)))}static AppendAsync(e,t,i,s,r,n){return function(e,t,i,s,r,n,o){return new Promise(((a,h)=>{try{E(e,t,i,(e=>{a(e)}),s,((e,t,i)=>{h(i||new Error(t))}),r,n,o).catch(h)}catch(e){h(e)}}))}(e,t,i,s,r,n)}static LoadAssetContainer(e,t,i,s,r,n,o,h){R(e,t,i,s,r,n,o,h).catch((e=>n?.(i??a.q.LastCreatedScene,e?.message,e)))}static LoadAssetContainerAsync(e,t,i,s,r,n){return I(e,t,i,s,r,n)}static ImportAnimations(e,t,i,s,r,n,o,h,l,c,u){M(e,t,i,s,r,n,o,h,l,c,u).catch((e=>l?.(i??a.q.LastCreatedScene,e?.message,e)))}static ImportAnimationsAsync(e,t,i,s,r,n,o,a,h,l,c){return function(e,t,i,s,r,n,o,a,h,l){return new Promise(((c,u)=>{try{M(e,t,i,s,r,n,(e=>{c(e)}),o,((e,t,i)=>{u(i||new Error(t))}),a,h,l).catch(u)}catch(e){u(e)}}))}(e,t,i,s,r,n,a,l,c)}}w.NO_LOGGING=0,w.MINIMAL_LOGGING=1,w.SUMMARY_LOGGING=2,w.DETAILED_LOGGING=3,w.OnPluginActivatedObservable=g},1497:(e,t,i)=>{"use strict";i.d(t,{q:()=>r});var s=i(3054);class r{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}r.Instances=[],r.OnEnginesDisposedObservable=new s.cP,r._LastCreatedScene=null,r.UseFallbackTexture=!0,r.FallbackTexture=""},1498:(e,t,i)=>{"use strict";i.d(t,{Qs:()=>g,SX:()=>v,LZ:()=>b}),i(35),i(3600);var s=i(4754),r=i(4245),n=i(976),o=i(5686),a=i(979),h=i(1077),l=i(7291);class c extends h.${_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([i.e(5879).then(i.bind(i,8260))]))):t.push(Promise.all([i.e(9762).then(i.bind(i,9762))])),super._gatherImports(e,t)}constructor(e,t=null,i){super({...i,name:e,engine:t||l.N.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:c.FragmentUrl})}}c.FragmentUrl="pass";class u extends h.${_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([i.e(3796).then(i.bind(i,3796))]))):t.push(Promise.all([i.e(3885).then(i.bind(i,3885))])),super._gatherImports(e,t)}constructor(e,t=null,i){super({...i,name:e,engine:t||l.N.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:u.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}u.FragmentUrl="passCube";var d=i(4537);class _ extends r.w{getClassName(){return"PassPostProcess"}constructor(e,t,i=null,s,r,n,o=0,a=!1){const h={size:"number"==typeof t?t:void 0,camera:i,samplingMode:s,engine:r,reusable:n,textureType:o,blockCompilation:a,...t};super(e,c.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new c(e,r,h),...h})}static _Parse(e,t,i,s){return a.p.Parse((()=>new _(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable)),e,i,s)}}(0,o.Y5)("BABYLON.PassPostProcess",_);class p extends r.w{get face(){return this._effectWrapper.face}set face(e){this._effectWrapper.face=e}getClassName(){return"PassCubePostProcess"}constructor(e,t,i=null,s,r,n,o=0,a=!1){const h={size:"number"==typeof t?t:void 0,camera:i,samplingMode:s,engine:r,reusable:n,textureType:o,blockCompilation:a,...t};super(e,c.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new u(e,r,h),...h})}static _Parse(e,t,i,s){return a.p.Parse((()=>new p(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable)),e,i,s)}}function g(e,t,i,s,n,o,a,h){const l=t.getEngine();return t.isReady=!1,n=n??t.samplingMode,s=s??t.type,o=o??t.format,a=a??t.width,h=h??t.height,-1===s&&(s=0),new Promise((c=>{const u=new r.w("postprocess",e,null,null,1,null,n,l,!1,void 0,s,void 0,null,!1,o);u.externalTextureSamplerBinding=!0;const d=l.createRenderTargetTexture({width:a,height:h},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:n,type:s,format:o});u.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{u.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},i.postProcessManager.directRender([u],d,!0),l.restoreDefaultFramebuffer(),l._releaseTexture(t),u&&u.dispose(),d._swapAndDie(t),t.type=s,t.format=5,t.isReady=!0,c(t)}))}))}))}let f,m;function b(e){f||(f=new Float32Array(1),m=new Int32Array(f.buffer)),f[0]=e;const t=m[0];let i=t>>16&32768,s=t>>12&2047;const r=t>>23&255;return r<103?i:r>142?(i|=31744,i|=(255==r?0:1)&&8388607&t,i):r<113?(s|=2048,i|=(s>>114-r)+(s>>113-r&1),i):(i|=r-112<<10|s>>1,i+=1&s,i)}function v(e){const t=(32768&e)>>15,i=(31744&e)>>10,s=1023&e;return 0===i?(t?-1:1)*Math.pow(2,-14)*(s/Math.pow(2,10)):31==i?s?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,i-15)*(1+s/Math.pow(2,10))}(0,s.Cg)([(0,d.lK)()],p.prototype,"face",null),n.$._RescalePostProcessFactory=e=>new _("rescale",1,null,2,e,!1,0)},1513:(e,t,i)=>{"use strict";i.d(t,{K:()=>s});class s{constructor(e,t,i){this.name=e,this.from=t,this.to=i}clone(){return new s(this.name,this.from,this.to)}}},1588:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},1601:(e,t,i)=>{"use strict";i.d(t,{b4:()=>l,bu:()=>u,mO:()=>c,uR:()=>_});var s=i(4920),r=i(1126),n=i(4796),o=i(3039),a=i(3299),h=i(8615);function l(e,t){return(0,r.N5)(t).cachedPipelines[e]}function c(e){const t=e._name,i=e.context;if(t&&i){const e=(0,r.N5)(i),s=e.cachedPipelines[t];s?.dispose(),delete e.cachedPipelines[t]}}function u(e,t,i,r,n,o,h){let l,c;const u=(0,s.BA)()?o?.getHostDocument():null;l="string"==typeof t?t:t.vertexSource?"source:"+t.vertexSource:t.vertexElement?u?.getElementById(t.vertexElement)||t.vertexElement:t.vertex||t,c="string"==typeof t?t:t.fragmentSource?"source:"+t.fragmentSource:t.fragmentElement?u?.getElementById(t.fragmentElement)||t.fragmentElement:t.fragment||t;const _=[void 0,void 0],p=()=>{if(_[0]&&_[1]){e.isFragment=!0;const[s,l]=_;(0,a.M0)(l,e,((o,l)=>{h&&(h._fragmentSourceCodeBeforeMigration=l),i&&(o=i("fragment",o));const c=(0,a.nO)(s,o,e);e=null;const u=function(e,t,i,s){return i?{vertexSourceCode:(1===s?"//":"")+"#define SHADER_NAME vertex:"+(i.vertexElement||i.vertex||i.spectorName||i)+"\n"+e,fragmentSourceCode:(1===s?"//":"")+"#define SHADER_NAME fragment:"+(i.fragmentElement||i.fragment||i.spectorName||i)+"\n"+t}:{vertexSourceCode:e,fragmentSourceCode:t}}(c.vertexCode,c.fragmentCode,t,n);r?.(u.vertexSourceCode,u.fragmentSourceCode)}),o)}};d(l,"Vertex","",(t=>{(0,a.pB)(e),(0,a.M0)(t,e,((e,s)=>{h&&(h._rawVertexSourceCode=t,h._vertexSourceCodeBeforeMigration=s),i&&(e=i("vertex",e)),_[0]=e,p()}),o)}),n),d(c,"Fragment","Pixel",(e=>{h&&(h._rawFragmentSourceCode=e),_[1]=e,p()}),n)}function d(e,t,i,r,o,a){if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return void r((0,s.Zl)(e));if("source:"===e.substring(0,7))return void r(e.substring(7));if("base64:"===e.substring(0,7))return void r(window.atob(e.substring(7)));const l=n.l.GetShadersStore(o);if(l[e+t+"Shader"])return void r(l[e+t+"Shader"]);if(i&&l[e+i+"Shader"])return void r(l[e+i+"Shader"]);let c;if(c="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:n.l.GetShadersRepository(o)+e,!(a=a||h.W0))throw new Error("loadFileInjection is not defined");a(c+"."+t.toLowerCase()+".fx",r)}const _=(e,t,i,s)=>{try{const n=e.context?(0,r.N5)(e.context):null;n&&(n.disableParallelShaderCompile=e.disableParallelCompilation);const o=e.existingPipelineContext||t(e.shaderProcessingContext);return o._name=e.name,e.name&&n&&(n.cachedPipelines[e.name]=o),i(o,e.vertex,e.fragment,!!e.createAsRaw,"","",e.rebuildRebind,e.defines,e.transformFeedbackVaryings,"",(()=>{s(o,(()=>{e.onRenderingStateCompiled?.(o)}))})),o}catch(e){throw o.V.Error("Error compiling effect"),e}}},1651:(e,t,i)=>{"use strict";i.d(t,{r:()=>n});var s=i(3039);const r=(e,t,i)=>e?e.getClassName&&"Mesh"===e.getClassName()?null:!e.getClassName||"SubMesh"!==e.getClassName()&&"PhysicsBody"!==e.getClassName()?e.clone?e.clone():Array.isArray(e)?e.slice():i&&"object"==typeof e?{...e}:null:e.clone(t):null;class n{static DeepCopy(e,t,i,n,o=!1){const a=function(e){const t=[];do{Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)}))}while(e=Object.getPrototypeOf(e));return t}(e);for(const h of a){if("_"===h[0]&&(!n||-1===n.indexOf(h)))continue;if(h.endsWith("Observable"))continue;if(i&&-1!==i.indexOf(h))continue;const a=e[h],l=typeof a;if("function"!==l)try{if("object"===l)if(a instanceof Uint8Array)t[h]=Uint8Array.from(a);else if(a instanceof Array){if(t[h]=[],a.length>0)if("object"==typeof a[0])for(let e=0;e<a.length;e++){const i=r(a[e],t,o);-1===t[h].indexOf(i)&&t[h].push(i)}else t[h]=a.slice(0)}else t[h]=r(a,t,o);else t[h]=a}catch(e){s.V.Warn(e.message)}}}}},1663:(e,t,i)=>{"use strict";function s(e){let t=1;do{t*=2}while(t<e);return t===e}function r(e,t,i){return e*(1-i)+t*i}function n(e){const t=o(e),i=a(e);return t-e>e-i?i:t}function o(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function a(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)}function h(e,t,i=2){let s;switch(i){case 1:s=a(e);break;case 2:s=n(e);break;default:s=o(e)}return Math.min(s,t)}i.d(t,{C4:()=>a,L8:()=>s,OG:()=>n,R:()=>h,zF:()=>r})},1711:e=>{"use strict";e.exports=TypeError},1717:(e,t,i)=>{"use strict";i.d(t,{j:()=>u});var s=i(959),r=i(4049),n=i(156),o=i(7484);const a={min:0,max:0},h={min:0,max:0},l=(e,t,i)=>{const s=r.Pq.Dot(t.centerWorld,e),n=Math.abs(r.Pq.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(r.Pq.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(r.Pq.Dot(t.directions[2],e))*t.extendSize.z;i.min=s-n,i.max=s+n},c=(e,t,i)=>(l(e,t,a),l(e,i,h),!(a.min>h.max||h.min>a.max));class u{constructor(e,t,i){this._isLocked=!1,this.boundingBox=new n.I(e,t,i),this.boundingSphere=new o.i(e,t,i)}reConstruct(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e}update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}centerOn(e,t){const i=u._TmpVector3[0].copyFrom(e).subtractInPlace(t),s=u._TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(i,s,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,s,this.boundingBox.getWorldMatrix()),this}encapsulate(e){const t=r.Pq.Minimize(this.minimum,e),i=r.Pq.Maximize(this.maximum,e);return this.reConstruct(t,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(e){const t=r.AA.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(t);const i=r.AA.Vector3[0];return r.Pq.TransformCoordinatesToRef(e.boundingBox.minimumWorld,t,i),this.encapsulate(i),r.Pq.TransformCoordinatesToRef(e.boundingBox.maximumWorld,t,i),this.encapsulate(i),this}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}isInFrustum(e,t=0){return!(2!==t&&3!==t||!this.boundingSphere.isCenterInFrustum(e))||!!this.boundingSphere.isInFrustum(e)&&(!(1!==t&&3!==t)||this.boundingBox.isInFrustum(e))}get diagonalLength(){const e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,u._TmpVector3[0]).length()}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(e){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e)}intersects(e,t){if(!o.i.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!n.I.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;const i=this.boundingBox,s=e.boundingBox;return!!(c(i.directions[0],i,s)&&c(i.directions[1],i,s)&&c(i.directions[2],i,s)&&c(s.directions[0],i,s)&&c(s.directions[1],i,s)&&c(s.directions[2],i,s)&&c(r.Pq.Cross(i.directions[0],s.directions[0]),i,s)&&c(r.Pq.Cross(i.directions[0],s.directions[1]),i,s)&&c(r.Pq.Cross(i.directions[0],s.directions[2]),i,s)&&c(r.Pq.Cross(i.directions[1],s.directions[0]),i,s)&&c(r.Pq.Cross(i.directions[1],s.directions[1]),i,s)&&c(r.Pq.Cross(i.directions[1],s.directions[2]),i,s)&&c(r.Pq.Cross(i.directions[2],s.directions[0]),i,s)&&c(r.Pq.Cross(i.directions[2],s.directions[1]),i,s)&&c(r.Pq.Cross(i.directions[2],s.directions[2]),i,s))}}u._TmpVector3=(0,s.mI)(2,r.Pq.Zero)},1724:(e,t,i)=>{"use strict";var s,r=i(946),n=i(1399);try{s=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var o=!!s&&n&&n(Object.prototype,"__proto__"),a=Object,h=a.getPrototypeOf;e.exports=o&&"function"==typeof o.get?r([o.get]):"function"==typeof h&&function(e){return h(null==e?e:a(e))}},1901:(e,t,i)=>{"use strict";i.d(t,{d:()=>l});var s=i(4049),r=i(8857),n=i(4871),o=i(7761),a=i(451);class h{constructor(e,t,i,s){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=i,this.worldAxisForFileY=s}}class l{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const t=e.getSize().width,i=e.readPixels(0,void 0,void 0,!1),s=e.readPixels(1,void 0,void 0,!1);let r,n;e.isRenderTarget?(r=e.readPixels(3,void 0,void 0,!1),n=e.readPixels(2,void 0,void 0,!1)):(r=e.readPixels(2,void 0,void 0,!1),n=e.readPixels(3,void 0,void 0,!1));const o=e.readPixels(4,void 0,void 0,!1),a=e.readPixels(5,void 0,void 0,!1),h=e.gammaSpace;let l=0;return 1!=e.textureType&&2!=e.textureType||(l=1),new Promise((e=>{Promise.all([s,i,r,n,o,a]).then((([i,s,r,n,o,a])=>{const c={size:t,right:s,left:i,up:r,down:n,front:o,back:a,format:5,type:l,gammaSpace:h};e(this.ConvertCubeMapToSphericalPolynomial(c))}))}))}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new n.O;let i=0;const s=2/e.size,h=s,l=.5*s,c=l-1;for(let n=0;n<6;n++){const u=this._FileFaces[n],d=e[u.name];let _=c;const p=5===e.format?4:3;for(let n=0;n<e.size;n++){let g=c;for(let h=0;h<e.size;h++){const c=u.worldAxisForFileX.scale(g).add(u.worldAxisForFileY.scale(_)).add(u.worldAxisForNormal);c.normalize();const f=this._AreaElement(g-l,_-l)-this._AreaElement(g-l,_+l)-this._AreaElement(g+l,_-l)+this._AreaElement(g+l,_+l);let m=d[n*e.size*p+h*p+0],b=d[n*e.size*p+h*p+1],v=d[n*e.size*p+h*p+2];isNaN(m)&&(m=0),isNaN(b)&&(b=0),isNaN(v)&&(v=0),0===e.type&&(m/=255,b/=255,v/=255),e.gammaSpace&&(m=Math.pow((0,r.Clamp)(m),o.tk),b=Math.pow((0,r.Clamp)(b),o.tk),v=Math.pow((0,r.Clamp)(v),o.tk));const T=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(m,b,v);if(e>T){const t=T/e;m*=t,b*=t,v*=t}}else m=(0,r.Clamp)(m,0,T),b=(0,r.Clamp)(b,0,T),v=(0,r.Clamp)(v,0,T);const y=new a.v9(m,b,v);t.addLight(c,y,f),i+=f,g+=s}_+=h}}const u=4*Math.PI*6/6/i;return t.scaleInPlace(u),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),n.Q.FromHarmonics(t)}}l._FileFaces=[new h("right",new s.Pq(1,0,0),new s.Pq(0,0,-1),new s.Pq(0,-1,0)),new h("left",new s.Pq(-1,0,0),new s.Pq(0,0,1),new s.Pq(0,-1,0)),new h("up",new s.Pq(0,1,0),new s.Pq(1,0,0),new s.Pq(0,0,1)),new h("down",new s.Pq(0,-1,0),new s.Pq(1,0,0),new s.Pq(0,0,-1)),new h("front",new s.Pq(0,0,1),new s.Pq(1,0,0),new s.Pq(0,-1,0)),new h("back",new s.Pq(0,0,-1),new s.Pq(-1,0,0),new s.Pq(0,-1,0))],l.MAX_HDRI_VALUE=4096,l.PRESERVE_CLAMPED_COLORS=!1},1956:(e,t,i)=>{"use strict";i.d(t,{L:()=>s});class s{constructor(e,t,i,s){this.x=e,this.y=t,this.width=i,this.height=s}toGlobal(e,t){return new s(this.x*e,this.y*t,this.width*e,this.height*t)}toGlobalToRef(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this}clone(){return new s(this.x,this.y,this.width,this.height)}}},1994:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});var s=i(8827);class r{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(e,t){r.Enabled&&(this._current+=e,t&&this._fetchResult())}beginMonitoring(){r.Enabled&&(this._startMonitoringTime=s.j.Now)}endMonitoring(e=!0){if(!r.Enabled)return;e&&this.fetchNewFrame();const t=s.j.Now;this._current=t-this._startMonitoringTime,e&&this._fetchResult()}endFrame(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const e=s.j.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}r.Enabled=!0},2036:(e,t,i)=>{"use strict";i.d(t,{cU:()=>p,gW:()=>y,o5:()=>f,ow:()=>T});var s=i(9732),r=i(4049),n=i(8857),o=i(4871),a=i(3788),h=i(3113),l=(i(8836),i(4245)),c=i(3039);i(3736),i(4054),i(1146);const u="image/png",d=2,_=[134,22,135,150,246,214,150,54];function p(e){const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let i=0;for(let e=0;e<_.length;e++)if(t.getUint8(i++)!==_[e])return c.V.Error("Not a babylon environment map"),null;let s="",r=0;for(;r=t.getUint8(i++);)s+=String.fromCharCode(r);let n=JSON.parse(s);return n=g(n),n.binaryDataPosition=i,n.specular&&(n.specular.lodGenerationScale=n.specular.lodGenerationScale||.8),n}function g(e){if(e.version>d)throw new Error(`Unsupported babylon environment map version "${e.version}". Latest supported version is "${d}".`);return 2===e.version?e:e={...e,version:2,imageType:u}}function f(e,t,i){const s=(i=g(i)).specular;if(!s)return Promise.resolve([]);e._lodGenerationScale=s.lodGenerationScale;const r=[],n=function(e,t){const i=(t=g(t)).specular;let s=Math.log2(t.width);if(s=Math.round(s)+1,i.mipmaps.length!==6*s)throw new Error(`Unsupported specular mipmaps number "${i.mipmaps.length}"`);const r=new Array(s);for(let n=0;n<s;n++){r[n]=new Array(6);for(let s=0;s<6;s++){const o=i.mipmaps[6*n+s];r[n][s]=new Uint8Array(e.buffer,e.byteOffset+t.binaryDataPosition+o.position,o.length)}}return r}(t,i);r.push(b(e,n,i.imageType));const o=i.irradiance?.irradianceTexture;if(o){const s=function(e,t){t=g(t);const i=new Array(6),s=t.irradiance?.irradianceTexture;if(s){if(6!==s.faces.length)throw new Error(`Incorrect irradiance texture faces number "${s.faces.length}"`);for(let r=0;r<6;r++){const n=s.faces[r];i[r]=new Uint8Array(e.buffer,e.byteOffset+t.binaryDataPosition+n.position,n.length)}}return i}(t,i);r.push(async function(e,t,i,s=u){const r=e.getEngine(),n=new a.h(r,5),o=new h.t(r,n);e._irradianceTexture=o,n.isCube=!0,n.format=5,n.type=0,n.generateMipMaps=!0,n._cachedAnisotropicFilteringLevel=null,n.generateMipMaps=!0,n.width=i,n.height=i,r.updateTextureSamplingMode(3,n),await v(n,[t],!1,s),r.generateMipMapsForCubemap(n),n.isReady=!0}(e,s,o.size,i.imageType))}return Promise.all(r)}function m(e,t,i,s,r,n,o,a,h,l,c){return new Promise(((u,d)=>{if(i){const i=t.createTexture(null,!0,!0,null,1,null,(e=>{d(e)}),e);s?.onEffectCreatedObservable.addOnce((a=>{a.executeWhenCompiled((()=>{s.externalTextureSamplerBinding=!0,s.onApply=s=>{s._bindTexture("textureSampler",i),s.setFloat2("scale",1,t._features.needsInvertingBitmap&&e instanceof ImageBitmap?-1:1)},t.scenes.length&&(t.scenes[0].postProcessManager.directRender([s],l,!0,n,o),t.restoreDefaultFramebuffer(),i.dispose(),URL.revokeObjectURL(r),u())}))}))}else{if(t._uploadImageToTexture(c,e,n,o),a){const i=h[o];i&&t._uploadImageToTexture(i._texture,e,n,0)}u()}}))}async function b(e,t,i=u){const s=e.getEngine();e.format=5,e.type=0,e.generateMipMaps=!0,e._cachedAnisotropicFilteringLevel=null,s.updateTextureSamplingMode(3,e),await v(e,t,!0,i),e.isReady=!0}async function v(e,t,r,o=u){if(!s.S0.IsExponentOfTwo(e.width))throw new Error("Texture size must be a power of two");const c=(0,n.ILog2)(e.width)+1,d=e.getEngine();let _=!1,p=!1,g=null,f=null,b=null;const v=d.getCaps();v.textureLOD?d._features.supportRenderAndCopyToLodForFloatTextures?v.textureHalfFloatRender&&v.textureHalfFloatLinearFiltering?(_=!0,e.type=2):v.textureFloatRender&&v.textureFloatLinearFiltering&&(_=!0,e.type=1):_=!1:(_=!1,p=r);let T=0;if(_)d.isWebGPU?(T=1,await i.e(6441).then(i.bind(i,6441))):await i.e(7436).then(i.bind(i,7436)),g=new l.w("rgbdDecode","rgbdDecode",null,null,1,null,3,d,!1,void 0,e.type,void 0,null,!1,void 0,T),e._isRGBD=!1,e.invertY=!1,f=d.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:e.type,format:5});else if(e._isRGBD=!0,e.invertY=!0,p){const t=3;b={};const i=e._lodGenerationScale,s=e._lodGenerationOffset;for(let r=0;r<t;r++){const n=(c-1)*i+s,o=s+(n-s)*(1-r/(t-1)),l=Math.round(Math.min(Math.max(o,0),n)),u=new a.h(d,2);u.isCube=!0,u.invertY=!0,u.generateMipMaps=!1,d.updateTextureSamplingMode(2,u);const _=new h.t(null);switch(_._isCube=!0,_._texture=u,b[l]=_,r){case 0:e._lodTextureLow=_;break;case 1:e._lodTextureMid=_;break;case 2:e._lodTextureHigh=_}}}const y=[];for(let i=0;i<t.length;i++)for(let s=0;s<6;s++){const r=t[i][s],n=new Blob([r],{type:o}),a=URL.createObjectURL(n);let h;if(d._features.forceBitmapOverHTMLImageElement)h=d.createImageBitmap(n,{premultiplyAlpha:"none"}).then((t=>m(t,d,_,g,a,s,i,p,b,f,e)));else{const t=new Image;t.src=a,h=new Promise(((r,n)=>{t.onload=()=>{m(t,d,_,g,a,s,i,p,b,f,e).then((()=>r())).catch((e=>{n(e)}))},t.onerror=e=>{n(e)}}))}y.push(h)}if(t.length<c){let i;const s=Math.pow(2,c-1-t.length),r=s*s*4;switch(e.type){case 0:i=new Uint8Array(r);break;case 2:i=new Uint16Array(r);break;case 1:i=new Float32Array(r)}for(let s=t.length;s<c;s++)for(let t=0;t<6;t++)d._uploadArrayBufferViewToTexture(e,i,t,s)}if(await Promise.all(y),f){const t=e._irradianceTexture;e._irradianceTexture=null,d._releaseTexture(e),f._swapAndDie(e),e._irradianceTexture=t}g&&g.dispose(),p&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))}function T(e,t){const i=(t=g(t)).irradiance;if(!i)return;const s=new o.Q;r.Pq.FromArrayToRef(i.x,0,s.x),r.Pq.FromArrayToRef(i.y,0,s.y),r.Pq.FromArrayToRef(i.z,0,s.z),r.Pq.FromArrayToRef(i.xx,0,s.xx),r.Pq.FromArrayToRef(i.yy,0,s.yy),r.Pq.FromArrayToRef(i.zz,0,s.zz),r.Pq.FromArrayToRef(i.yz,0,s.yz),r.Pq.FromArrayToRef(i.zx,0,s.zx),r.Pq.FromArrayToRef(i.xy,0,s.xy),e._sphericalPolynomial=s}function y(e,t,i,s,r){const n=b(e.getEngine().createRawCubeTexture(null,e.width,e.format,e.type,e.generateMipMaps,e.invertY,e.samplingMode,e._compression),t).then((()=>e));return e.onRebuildCallback=e=>({proxy:n,isReady:!0,isAsync:!0}),e._source=13,e._bufferViewArrayArray=t,e._lodGenerationScale=s,e._lodGenerationOffset=r,e._sphericalPolynomial=i,b(e,t).then((()=>(e.isReady=!0,e)))}},2050:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var s=i(4049);class r{constructor(e,t,i,r){this.normal=new s.Pq(e,t,i),this.d=r}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new r(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let e=this.normal.getHashCode();return e=397*e^this.d,e}normalize(){const e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}transform(e){const t=r._TmpMatrix;e.invertToRef(t);const i=t.m,s=this.normal.x,n=this.normal.y,o=this.normal.z,a=this.d,h=s*i[0]+n*i[1]+o*i[2]+a*i[3],l=s*i[4]+n*i[5]+o*i[6]+a*i[7],c=s*i[8]+n*i[9]+o*i[10]+a*i[11],u=s*i[12]+n*i[13]+o*i[14]+a*i[15];return new r(h,l,c,u)}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}copyFromPoints(e,t,i){const s=t.x-e.x,r=t.y-e.y,n=t.z-e.z,o=i.x-e.x,a=i.y-e.y,h=i.z-e.z,l=r*h-n*a,c=n*o-s*h,u=s*a-r*o,d=Math.sqrt(l*l+c*c+u*u);let _;return _=0!==d?1/d:0,this.normal.x=l*_,this.normal.y=c*_,this.normal.z=u*_,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}isFrontFacingTo(e,t){return s.Pq.Dot(this.normal,e)<=t}signedDistanceTo(e){return s.Pq.Dot(e,this.normal)+this.d}static FromArray(e){return new r(e[0],e[1],e[2],e[3])}static FromPoints(e,t,i){const s=new r(0,0,0,0);return s.copyFromPoints(e,t,i),s}static FromPositionAndNormal(e,t){const i=new r(0,0,0,0);return this.FromPositionAndNormalToRef(e,t,i)}static FromPositionAndNormalToRef(e,t,i){return i.normal.copyFrom(t),i.normal.normalize(),i.d=-e.dot(i.normal),i}static SignedDistanceToPlaneFromPositionAndNormal(e,t,i){const r=-(t.x*e.x+t.y*e.y+t.z*e.z);return s.Pq.Dot(i,t)+r}}r._TmpMatrix=s.uq.Identity()},2144:(e,t,i)=>{"use strict";i.d(t,{gT:()=>o});var s=i(3039);const r=new Map;function n(e,t){(function(e){return r.delete(e)})(e)&&s.V.Warn(`Extension with the name '${name}' already exists`),r.set(e,t)}function o(e,t){"image/ktx"!==t&&"image/ktx2"!==t||(e=".ktx"),r.has(e)||(e.endsWith(".ies")&&n(".ies",(()=>i.e(1107).then(i.bind(i,1107)).then((e=>new e._IESTextureLoader)))),e.endsWith(".dds")&&n(".dds",(()=>Promise.resolve().then(i.bind(i,8908)).then((e=>new e._DDSTextureLoader)))),e.endsWith(".basis")&&n(".basis",(()=>i.e(6774).then(i.bind(i,6774)).then((e=>new e._BasisTextureLoader)))),e.endsWith(".env")&&n(".env",(()=>Promise.resolve().then(i.bind(i,4526)).then((e=>new e._ENVTextureLoader)))),e.endsWith(".hdr")&&n(".hdr",(()=>i.e(2497).then(i.bind(i,2497)).then((e=>new e._HDRTextureLoader)))),(e.endsWith(".ktx")||e.endsWith(".ktx2"))&&(n(".ktx",(()=>Promise.resolve().then(i.bind(i,462)).then((e=>new e._KTXTextureLoader)))),n(".ktx2",(()=>Promise.resolve().then(i.bind(i,462)).then((e=>new e._KTXTextureLoader))))),e.endsWith(".tga")&&n(".tga",(()=>i.e(5980).then(i.bind(i,5980)).then((e=>new e._TGATextureLoader)))),e.endsWith(".exr")&&n(".exr",(()=>i.e(407).then(i.bind(i,407)).then((e=>new e._ExrTextureLoader)))));const s=r.get(e);return s?Promise.resolve(s(t)):null}},2165:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.morphTargetsVertexGlobalDeclaration="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];uniform vec3 morphTargetTextureInfo;uniform highp sampler2DArray morphTargets;vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV).xyz;}\nvec4 readVector4FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV);}\n#endif\n#endif\n"},2213:(e,t,i)=>{"use strict";i.d(t,{n:()=>r});const s={};function r(e,t=!1){if(!t||!s[e])return s[e]=!0,`${e} needs to be imported before as it contains a side-effect required by your code.`}},2250:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.clipPlaneFragment="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n"},2276:(e,t,i)=>{"use strict";i.d(t,{u:()=>s});class s{constructor(){this._xhr="undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(s.CustomRequestHeaders).length>0||s.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const e in s.CustomRequestHeaders){const t=s.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}}_shouldSkipRequestModifications(e){return s.SkipRequestModificationForBabylonCDN&&(e.includes("preview.babylonjs.com")||e.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(e){this._xhr.onprogress=e}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(e){this._xhr.responseType=e}get timeout(){return this._xhr.timeout}set timeout(e){this._xhr.timeout=e}addEventListener(e,t,i){this._xhr.addEventListener(e,t,i)}removeEventListener(e,t,i){this._xhr.removeEventListener(e,t,i)}abort(){this._xhr.abort()}send(e){s.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)}open(e,t){for(const e of s.CustomRequestModifiers){if(this._shouldSkipRequestModifications(t))return;t=e(this._xhr,t)||t}t=(t=t.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=t,this._xhr.open(e,t,!0)}setRequestHeader(e,t){this._xhr.setRequestHeader(e,t)}getResponseHeader(e){return this._xhr.getResponseHeader(e)}}s.CustomRequestHeaders={},s.CustomRequestModifiers=new Array,s.SkipRequestModificationForBabylonCDN=!0},2282:(e,t,i)=>{"use strict";i.d(t,{V:()=>u});var s=i(4754),r=i(4537),n=i(979),o=i(3054),a=i(4049),h=i(4292),l=i(5686);const c=a.uq.Compose(a.Pq.One(),a.PT.FromEulerAngles(0,Math.PI,0),a.Pq.Zero());class u extends h.b{get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._cache.useBillboardPosition=!!(this._billboardMode&u.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==u.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}constructor(e,t=null,i=!0){super(e,t,!1),this._forward=new a.Pq(0,0,1),this._up=new a.Pq(0,1,0),this._right=new a.Pq(1,0,0),this._position=a.Pq.Zero(),this._rotation=a.Pq.Zero(),this._rotationQuaternion=null,this._scaling=a.Pq.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=u.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=a.uq.Zero(),this._usePivotMatrix=!1,this._absolutePosition=a.Pq.Zero(),this._absoluteScaling=a.Pq.Zero(),this._absoluteRotationQuaternion=a.PT.Identity(),this._pivotMatrix=a.uq.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new o.cP,this._nonUniformScaling=!1,i&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(e){this._position=e,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this._rotationQuaternion=null,this._markAsDirtyInternal()}get scaling(){return this._scaling}set scaling(e){this._scaling=e,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return a.Pq.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return a.Pq.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return a.Pq.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=a.uq.Identity()),this._poseMatrix}_isSynchronized(){const e=this._cache;return!(this._billboardMode!==e.billboardMode||this._billboardMode!==u.BILLBOARDMODE_NONE||e.pivotMatrixUpdated||this._infiniteDistance||this._position._isDirty||this._scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)}_initCache(){super._initCache();const e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1,e.useBillboardPosition=!1,e.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(e){return this.setPivotMatrix(e,!1)}setPivotMatrix(e,t=!0){return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=a.uq.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(e=null,t,i){const s=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);s&&i&&i(this,s);for(const e of this.getChildTransformNodes(!0))e.instantiateHierarchy(s,t,i);return s}freezeWorldMatrix(e=null,t=!1){return e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||a.PT.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(e){if(!e)return this;let t,i,s;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],i=arguments[1],s=arguments[2]}else t=e.x,i=e.y,s=e.z;if(this.parent){const e=a.AA.Matrix[0];this.parent.getWorldMatrix().invertToRef(e),a.Pq.TransformCoordinatesFromFloatsToRef(t,i,s,e,this.position)}else this.position.x=t,this.position.y=i,this.position.z=s;return this._absolutePosition.copyFrom(e),this}setPositionWithLocalVector(e){return this.computeWorldMatrix(),this.position=a.Pq.TransformNormal(e,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();const e=a.AA.Matrix[0];return this._localMatrix.invertToRef(e),a.Pq.TransformNormal(this.position,e)}locallyTranslate(e){return this.computeWorldMatrix(!0),this.position=a.Pq.TransformCoordinates(e,this._localMatrix),this}lookAt(e,t=0,i=0,s=0,r=0){const n=u._LookAtVectorCache,o=0===r?this.position:this.getAbsolutePosition();if(e.subtractToRef(o,n),this.setDirection(n,t,i,s),1===r&&this.parent)if(this.rotationQuaternion){const e=a.AA.Matrix[0];this.rotationQuaternion.toRotationMatrix(e);const t=a.AA.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.invert(),e.multiplyToRef(t,e),this.rotationQuaternion.fromRotationMatrix(e)}else{const e=a.AA.Quaternion[0];a.PT.FromEulerVectorToRef(this.rotation,e);const t=a.AA.Matrix[0];e.toRotationMatrix(t);const i=a.AA.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(i),i.invert(),t.multiplyToRef(i,t),e.fromRotationMatrix(t),e.toEulerAnglesToRef(this.rotation)}return this}getDirection(e){const t=a.Pq.Zero();return this.getDirectionToRef(e,t),t}getDirectionToRef(e,t){return a.Pq.TransformNormalToRef(e,this.getWorldMatrix(),t),this}setDirection(e,t=0,i=0,s=0){const r=-Math.atan2(e.z,e.x)+Math.PI/2,n=Math.sqrt(e.x*e.x+e.z*e.z),o=-Math.atan2(e.y,n);return this.rotationQuaternion?a.PT.RotationYawPitchRollToRef(r+t,o+i,s,this.rotationQuaternion):(this.rotation.x=o+i,this.rotation.y=r+t,this.rotation.z=s),this}setPivotPoint(e,t=0){0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);const i=this.getWorldMatrix();if(1==t){const t=a.AA.Matrix[0];i.invertToRef(t),e=a.Pq.TransformCoordinates(e,t)}return this.setPivotMatrix(a.uq.Translation(-e.x,-e.y,-e.z),!0)}getPivotPoint(){const e=a.Pq.Zero();return this.getPivotPointToRef(e),e}getPivotPointToRef(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const e=a.Pq.Zero();return this.getAbsolutePivotPointToRef(e),e}getAbsolutePivotPointToRef(e){return this.getPivotPointToRef(e),a.Pq.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}markAsDirty(e){if(this._isDirty)return this;if(this._children)for(const t of this._children)t.markAsDirty(e);return super.markAsDirty(e)}setParent(e,t=!1,i=!1){if(!e&&!this.parent)return this;const s=a.AA.Quaternion[0],r=a.AA.Vector3[0],n=a.AA.Vector3[1],o=a.AA.Matrix[1];a.uq.IdentityToRef(o);const h=a.AA.Matrix[0];this.computeWorldMatrix(!0);let l=this.rotationQuaternion;return l||(l=u._TmpRotation,a.PT.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,l)),a.uq.ComposeToRef(this.scaling,l,this.position,h),this.parent&&h.multiplyToRef(this.parent.computeWorldMatrix(!0),h),e&&(e.computeWorldMatrix(!0).invertToRef(o),h.multiplyToRef(o,h)),h.decompose(n,s,r,t?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(s):s.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(n),this.position.copyFrom(r),this.parent=e,i&&this.setPivotMatrix(a.uq.Identity()),this}addChild(e,t=!1){return e.setParent(this,t),this}removeChild(e,t=!1){return e.parent!==this||e.setParent(null,t),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)}attachToBone(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(!0),e.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(e=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=e?this._currentParentWhenAttachingToBone:null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(e,t,i){let s;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&0!==i){if(this.parent){const i=this.parent.getWorldMatrix(),s=a.AA.Matrix[0];i.invertToRef(s),e=a.Pq.TransformNormal(e,s),i.determinant()<0&&(t*=-1)}s=a.PT.RotationAxisToRef(e,t,u._RotationAxisCache),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else s=a.PT.RotationAxisToRef(e,t,u._RotationAxisCache),this.rotationQuaternion.multiplyToRef(s,this.rotationQuaternion);return this}rotateAround(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=a.PT.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const s=a.AA.Vector3[0],r=a.AA.Vector3[1],n=a.AA.Vector3[2],o=a.AA.Quaternion[0],h=a.AA.Matrix[0],l=a.AA.Matrix[1],c=a.AA.Matrix[2],u=a.AA.Matrix[3];return e.subtractToRef(this.position,s),a.uq.TranslationToRef(s.x,s.y,s.z,h),a.uq.TranslationToRef(-s.x,-s.y,-s.z,l),a.uq.RotationAxisToRef(t,i,c),l.multiplyToRef(c,u),u.multiplyToRef(h,u),u.decompose(r,o,n),this.position.addInPlace(n),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(e,t,i){const s=e.scale(t);if(i&&0!==i)this.setAbsolutePosition(this.getAbsolutePosition().add(s));else{const e=this.getPositionExpressedInLocalSpace().add(s);this.setPositionWithLocalVector(e)}return this}addRotation(e,t,i){let s;this.rotationQuaternion?s=this.rotationQuaternion:(s=a.AA.Quaternion[1],a.PT.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,s));const r=a.AA.Quaternion[0];return a.PT.RotationYawPitchRollToRef(t,e,i,r),s.multiplyInPlace(r),this.rotationQuaternion||s.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==u.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}computeWorldMatrix(e=!1,t=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const i=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===i||this.isSynchronized()))return this._currentRenderId=i,this._worldMatrix;t=t||this.getScene().activeCamera,this._updateCache();const s=this._cache;s.pivotMatrixUpdated=!1,s.billboardMode=this.billboardMode,s.infiniteDistance=this.infiniteDistance,s.parent=this._parentNode,this._currentRenderId=i,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const r=this._getEffectiveParent(),n=u._TmpScaling;let o,h=this._position;if(this._infiniteDistance&&!this.parent&&t){const e=t.getWorldMatrix(),i=new a.Pq(e.m[12],e.m[13],e.m[14]);h=u._TmpTranslation,h.copyFromFloats(this._position.x+i.x,this._position.y+i.y,this._position.z+i.z)}if(n.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,o=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(a.PT.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(o=u._TmpRotation,a.PT.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,o)),this._usePivotMatrix){const e=a.AA.Matrix[1];a.uq.ScalingToRef(n.x,n.y,n.z,e);const t=a.AA.Matrix[0];o.toRotationMatrix(t),this._pivotMatrix.multiplyToRef(e,a.AA.Matrix[4]),a.AA.Matrix[4].multiplyToRef(t,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(h.x,h.y,h.z)}else a.uq.ComposeToRef(n,o,h,this._localMatrix);if(r&&r.getWorldMatrix){if(e&&r.computeWorldMatrix(e),s.useBillboardPath){if(this._transformToBoneReferal){const e=this.parent;e.getSkeleton().prepare(),e.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),a.AA.Matrix[7])}else a.AA.Matrix[7].copyFrom(r.getWorldMatrix());const e=a.AA.Vector3[5],t=a.AA.Vector3[6],i=a.AA.Quaternion[0];a.AA.Matrix[7].decompose(t,i,e),a.uq.ScalingToRef(t.x,t.y,t.z,a.AA.Matrix[7]),a.AA.Matrix[7].setTranslation(e),u.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(i,e),this._localMatrix.setTranslation(e)),this._localMatrix.multiplyToRef(a.AA.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const e=this.parent;e.getSkeleton().prepare(),this._localMatrix.multiplyToRef(e.getFinalMatrix(),a.AA.Matrix[6]),a.AA.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(r.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(s.useBillboardPath&&t&&this.billboardMode&&!s.useBillboardPosition){const e=a.AA.Vector3[0];if(this._worldMatrix.getTranslationToRef(e),a.AA.Matrix[1].copyFrom(t.getViewMatrix()),this._scene.useRightHandedSystem&&a.AA.Matrix[1].multiplyToRef(c,a.AA.Matrix[1]),a.AA.Matrix[1].setTranslationFromFloats(0,0,0),a.AA.Matrix[1].invertToRef(a.AA.Matrix[0]),(this.billboardMode&u.BILLBOARDMODE_ALL)!==u.BILLBOARDMODE_ALL){a.AA.Matrix[0].decompose(void 0,a.AA.Quaternion[0],void 0);const e=a.AA.Vector3[1];a.AA.Quaternion[0].toEulerAnglesToRef(e),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(e.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(e.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(e.z=0),a.uq.RotationYawPitchRollToRef(e.y,e.x,e.z,a.AA.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.AA.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.AA.Vector3[0])}else if(s.useBillboardPath&&t&&s.useBillboardPosition){const e=a.AA.Vector3[0];this._worldMatrix.getTranslationToRef(e);const i=t.globalPosition;this._worldMatrix.invertToRef(a.AA.Matrix[1]);const s=a.AA.Vector3[1];a.Pq.TransformCoordinatesToRef(i,a.AA.Matrix[1],s),s.normalize();const r=-Math.atan2(s.z,s.x)+Math.PI/2,n=Math.sqrt(s.x*s.x+s.z*s.z),o=-Math.atan2(s.y,n);if(a.PT.RotationYawPitchRollToRef(r,o,0,a.AA.Quaternion[0]),(this.billboardMode&u.BILLBOARDMODE_ALL)!==u.BILLBOARDMODE_ALL){const e=a.AA.Vector3[1];a.AA.Quaternion[0].toEulerAnglesToRef(e),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(e.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(e.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(e.z=0),a.uq.RotationYawPitchRollToRef(e.y,e.x,e.z,a.AA.Matrix[0])}else a.uq.FromQuaternionToRef(a.AA.Quaternion[0],a.AA.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.AA.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.AA.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):r&&r._nonUniformScaling?this._updateNonUniformScalingState(r._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=a.uq.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(e=!0){if(this.computeWorldMatrix(),e){const e=this.getChildren();for(let t=0;t<e.length;++t){const i=e[t];if(i){i.computeWorldMatrix();const e=a.AA.Matrix[0];i._localMatrix.multiplyToRef(this._localMatrix,e);const t=a.AA.Quaternion[0];e.decompose(i.scaling,t,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(i.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=a.PT.Identity()),this._worldMatrix=a.uq.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}unregisterAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}getPositionInCameraSpace(e=null){return e||(e=this.getScene().activeCamera),a.Pq.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}getDistanceToCamera(e=null){return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}clone(e,t,i){const s=n.p.Clone((()=>new u(e,this.getScene())),this);if(s.name=e,s.id=e,t&&(s.parent=t),!i){const t=this.getDescendants(!0);for(let i=0;i<t.length;i++){const r=t[i];r.clone&&r.clone(e+"."+r.name,s)}}return s}serialize(e){const t=n.p.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),n.p.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t}static Parse(e,t,i){const s=n.p.Parse((()=>new u(e.name,t)),e,t,i);if(e.localMatrix?s.setPreTransformMatrix(a.uq.FromArray(e.localMatrix)):e.pivotMatrix&&s.setPivotMatrix(a.uq.FromArray(e.pivotMatrix)),s.setEnabled(e.isEnabled),s._waitingParsedUniqueId=e.uniqueId,void 0!==e.parentId&&(s._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],r=(0,l.n9)("BABYLON.Animation");r&&s.animations.push(r.Parse(i))}h.b.ParseAnimationRanges(s,e,t)}return e.autoAnimate&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),s}getChildTransformNodes(e,t){const i=[];return this._getDescendants(i,e,(e=>(!t||t(e))&&e instanceof u)),i}dispose(e,t=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const e=this._parentContainer.transformNodes.indexOf(this);e>-1&&this._parentContainer.transformNodes.splice(e,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e){const e=this.getChildTransformNodes(!0);for(const t of e)t.parent=null,t.computeWorldMatrix(!0)}super.dispose(e,t)}normalizeToUnitCube(e=!0,t=!1,i){let s=null,r=null;t&&(this.rotationQuaternion?(r=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(s=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const n=this.getHierarchyBoundingVectors(e,i),o=n.max.subtract(n.min),a=Math.max(o.x,o.y,o.z);if(0===a)return this;const h=1/a;return this.scaling.scaleInPlace(h),t&&(this.rotationQuaternion&&r?this.rotationQuaternion.copyFrom(r):this.rotation&&s&&this.rotation.copyFrom(s)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}u.BILLBOARDMODE_NONE=0,u.BILLBOARDMODE_X=1,u.BILLBOARDMODE_Y=2,u.BILLBOARDMODE_Z=4,u.BILLBOARDMODE_ALL=7,u.BILLBOARDMODE_USE_POSITION=128,u.BillboardUseParentOrientation=!1,u._TmpRotation=a.PT.Zero(),u._TmpScaling=a.Pq.Zero(),u._TmpTranslation=a.Pq.Zero(),u._LookAtVectorCache=new a.Pq(0,0,0),u._RotationAxisCache=new a.PT,(0,s.Cg)([(0,r.P_)("position")],u.prototype,"_position",void 0),(0,s.Cg)([(0,r.P_)("rotation")],u.prototype,"_rotation",void 0),(0,s.Cg)([(0,r.bR)("rotationQuaternion")],u.prototype,"_rotationQuaternion",void 0),(0,s.Cg)([(0,r.P_)("scaling")],u.prototype,"_scaling",void 0),(0,s.Cg)([(0,r.lK)("billboardMode")],u.prototype,"_billboardMode",void 0),(0,s.Cg)([(0,r.lK)()],u.prototype,"scalingDeterminant",void 0),(0,s.Cg)([(0,r.lK)("infiniteDistance")],u.prototype,"_infiniteDistance",void 0),(0,s.Cg)([(0,r.lK)()],u.prototype,"ignoreNonUniformScaling",void 0),(0,s.Cg)([(0,r.lK)()],u.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},2286:(e,t,i)=>{"use strict";var s=i(5364),r=Object.prototype.hasOwnProperty,n=Array.isArray,o={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:s.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},h=function(e,t,i){if(e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1)return e.split(",");if(t.throwOnLimitExceeded&&i>=t.arrayLimit)throw new RangeError("Array limit exceeded. Only "+t.arrayLimit+" element"+(1===t.arrayLimit?"":"s")+" allowed in an array.");return e},l=function(e,t,i,n){if(e){var o=i.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,l=i.depth>0&&/(\[[^[\]]*])/.exec(o),c=l?o.slice(0,l.index):o,u=[];if(c){if(!i.plainObjects&&r.call(Object.prototype,c)&&!i.allowPrototypes)return;u.push(c)}for(var d=0;i.depth>0&&null!==(l=a.exec(o))&&d<i.depth;){if(d+=1,!i.plainObjects&&r.call(Object.prototype,l[1].slice(1,-1))&&!i.allowPrototypes)return;u.push(l[1])}if(l){if(!0===i.strictDepth)throw new RangeError("Input depth exceeded depth option of "+i.depth+" and strictDepth is true");u.push("["+o.slice(l.index)+"]")}return function(e,t,i,r){var n=0;if(e.length>0&&"[]"===e[e.length-1]){var o=e.slice(0,-1).join("");n=Array.isArray(t)&&t[o]?t[o].length:0}for(var a=r?t:h(t,i,n),l=e.length-1;l>=0;--l){var c,u=e[l];if("[]"===u&&i.parseArrays)c=i.allowEmptyArrays&&(""===a||i.strictNullHandling&&null===a)?[]:s.combine([],a);else{c=i.plainObjects?{__proto__:null}:{};var d="["===u.charAt(0)&&"]"===u.charAt(u.length-1)?u.slice(1,-1):u,_=i.decodeDotInKeys?d.replace(/%2E/g,"."):d,p=parseInt(_,10);i.parseArrays||""!==_?!isNaN(p)&&u!==_&&String(p)===_&&p>=0&&i.parseArrays&&p<=i.arrayLimit?(c=[])[p]=a:"__proto__"!==_&&(c[_]=a):c={0:a}}a=c}return a}(u,t,i,n)}};e.exports=function(e,t){var i=function(e){if(!e)return o;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0!==e.throwOnLimitExceeded&&"boolean"!=typeof e.throwOnLimitExceeded)throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var t=void 0===e.charset?o.charset:e.charset,i=void 0===e.duplicates?o.duplicates:e.duplicates;if("combine"!==i&&"first"!==i&&"last"!==i)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||o.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:o.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:o.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||s.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,duplicates:i,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictDepth:"boolean"==typeof e.strictDepth?!!e.strictDepth:o.strictDepth,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling,throwOnLimitExceeded:"boolean"==typeof e.throwOnLimitExceeded&&e.throwOnLimitExceeded}}(t);if(""===e||null==e)return i.plainObjects?{__proto__:null}:{};for(var c="string"==typeof e?function(e,t){var i={__proto__:null},l=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;l=l.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var c=t.parameterLimit===1/0?void 0:t.parameterLimit,u=l.split(t.delimiter,t.throwOnLimitExceeded?c+1:c);if(t.throwOnLimitExceeded&&u.length>c)throw new RangeError("Parameter limit exceeded. Only "+c+" parameter"+(1===c?"":"s")+" allowed.");var d,_=-1,p=t.charset;if(t.charsetSentinel)for(d=0;d<u.length;++d)0===u[d].indexOf("utf8=")&&("utf8=%E2%9C%93"===u[d]?p="utf-8":"utf8=%26%2310003%3B"===u[d]&&(p="iso-8859-1"),_=d,d=u.length);for(d=0;d<u.length;++d)if(d!==_){var g,f,m=u[d],b=m.indexOf("]="),v=-1===b?m.indexOf("="):b+1;-1===v?(g=t.decoder(m,o.decoder,p,"key"),f=t.strictNullHandling?null:""):(g=t.decoder(m.slice(0,v),o.decoder,p,"key"),f=s.maybeMap(h(m.slice(v+1),t,n(i[g])?i[g].length:0),(function(e){return t.decoder(e,o.decoder,p,"value")}))),f&&t.interpretNumericEntities&&"iso-8859-1"===p&&(f=a(String(f))),m.indexOf("[]=")>-1&&(f=n(f)?[f]:f);var T=r.call(i,g);T&&"combine"===t.duplicates?i[g]=s.combine(i[g],f):T&&"last"!==t.duplicates||(i[g]=f)}return i}(e,i):e,u=i.plainObjects?{__proto__:null}:{},d=Object.keys(c),_=0;_<d.length;++_){var p=d[_],g=l(p,c[p],i,"string"==typeof e);u=s.merge(u,g,i)}return!0===i.allowSparse?u:s.compact(u)}},2450:(e,t,i)=>{"use strict";i.d(t,{M:()=>h});var s=i(3054),r=i(3039),n=i(4796),o=i(1601),a=i(5098);class h{static get ShadersRepository(){return n.l.ShadersRepository}static set ShadersRepository(e){n.l.ShadersRepository=e}get isDisposed(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new s.cP),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,i,r=null,n,a=null,l=null,c=null,u=null,d,_="",p=0,g){this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new s.cP,this.onErrorObservable=new s.cP,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=e,this._key=_;const f=this._key.replace(/\r/g,"").replace(/\n/g,"|");let m;if(t.attributes){const e=t;if(this._engine=i,this._attributesNames=e.attributes,this._uniformsNames=e.uniformsNames.concat(e.samplers),this._samplerList=e.samplers.slice(),this.defines=e.defines,this.onError=e.onError,this.onCompiled=e.onCompiled,this._fallbacks=e.fallbacks,this._indexParameters=e.indexParameters,this._transformFeedbackVaryings=e.transformFeedbackVaryings||null,this._multiTarget=!!e.multiTarget,this._shaderLanguage=e.shaderLanguage??0,this._disableParallelShaderCompilation=!!e.disableParallelShaderCompilation,e.uniformBuffersNames){this._uniformBuffersNamesList=e.uniformBuffersNames.slice();for(let t=0;t<e.uniformBuffersNames.length;t++)this._uniformBuffersNames[e.uniformBuffersNames[t]]=t}this._processFinalCode=e.processFinalCode??null,this._processCodeAfterIncludes=e.processCodeAfterIncludes??void 0,g=e.extraInitializationsAsync,m=e.existingPipelineContext}else this._engine=n,this.defines=null==a?"":a,this._uniformsNames=i.concat(r),this._samplerList=r?r.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=p,this.onError=u,this.onCompiled=c,this._indexParameters=d,this._fallbacks=l;"WEBGL2"===this._engine.shaderPlatformName&&(m=(0,o.b4)(f,this._engine._gl)??m),this._attributeLocationByName={},this.uniqueId=h._UniqueIdSeed++,m?(this._pipelineContext=m,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,g),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.isDisposed||this.dispose(!0)}))}async _processShaderCodeAsync(e=null,t=!1,i=null,s){s&&await s(),this._processingContext=i||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const r={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:e??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:n.l.GetShadersRepository(this._shaderLanguage),includesShadersStore:n.l.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,o.bu)(r,this.name,this._processFinalCode,((e,i)=>{this._vertexSourceCode=e,this._fragmentSourceCode=i,this._prepareEffect(t)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.isDisposed||!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(e){return this._attributes[e]}getAttributeLocationByName(e){return this._attributeLocationByName[e]}getAttributesCount(){return this._attributes.length}getUniformIndex(e){return this._uniformsNames.indexOf(e)}getUniform(e){return this._uniforms[e]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}whenCompiledAsync(){return new Promise((e=>{this.executeWhenCompiled(e)}))}executeWhenCompiled(e){this.isReady()?e(this):(this.onCompileObservable.add((t=>{e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(e){(0,a.F)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(t=>{this._processCompilationErrors(t,e)}),16,3e4,!0,` - Effect: ${"string"==typeof this.name?this.name:this.key}`)}get vertexSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._pipelineContext?._getVertexShaderCode()??this._vertexSourceCode}get fragmentSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._pipelineContext?._getFragmentShaderCode()??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(e,t,i,s){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(e,t)=>{s&&s(t)},this.onCompiled=()=>{const e=this.getEngine().scenes;if(e)for(let t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);this._pipelineContext._handlesSpectorRebuildCallback?.(i)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(e){if(this._pipelineContext=e,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let e=0;e<this._attributesNames.length;e++){const t=this._attributesNames[e];this._attributeLocationByName[t]=this._attributes[e]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),h.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(e=!1){const t=this._pipelineContext;this._isReady=!1;try{const i=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),s=i?null:this.defines,r=i?this._vertexSourceCodeOverride:this._vertexSourceCode,n=i?this._fragmentSourceCodeOverride:this._fragmentSourceCode,a=this._engine;this._pipelineContext=(0,o.uR)({existingPipelineContext:e?t:null,vertex:r,fragment:n,context:"WEBGL2"===a.shaderPlatformName||"WEBGL1"===a.shaderPlatformName?a._gl:void 0,rebuildRebind:(e,t,i,s)=>this._rebuildProgram(e,t,i,s),defines:s,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:i,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:i=>{t&&!e&&this._engine._deletePipelineContext(t),i&&this._onRenderingStateCompiled(i)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(e){this._processCompilationErrors(e,t)}}_getShaderCodeAndErrorLine(e,t,i){const s=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let r=null;if(t&&e){const n=t.match(s);if(n&&2===n.length){const t=parseInt(n[1]),s=e.split("\n",-1);s.length>=t&&(r=`Offending line [${t}] in ${i?"fragment":"vertex"} code: ${s[t-1]}`)}}return[e,r]}_processCompilationErrors(e,t=null){this._compilationError=e.message;const i=this._attributesNames,s=this._fallbacks;if(r.V.Error("Unable to compile effect:"),r.V.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),r.V.Error("Attributes: "+i.map((function(e){return" "+e}))),r.V.Error("Defines:\n"+this.defines),h.LogShaderCodeOnCompilationError){let e=null,t=null,i=null;this._pipelineContext?._getVertexShaderCode()&&([i,e]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),i&&(r.V.Error("Vertex code:"),r.V.Error(i))),this._pipelineContext?._getFragmentShaderCode()&&([i,t]=this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(),this._compilationError,!0),i&&(r.V.Error("Fragment code:"),r.V.Error(i))),e&&r.V.Error(e),t&&r.V.Error(t)}r.V.Error("Error: "+this._compilationError);const n=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};t&&(this._pipelineContext=t,this._isReady=!0,n()),s?(this._pipelineContext=null,s.hasMoreFallbacks?(this._allFallbacksProcessed=!1,r.V.Error("Trying next fallback."),this.defines=s.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,n(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,t||n())}get isSupported(){return""===this._compilationError}_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setTextureArray(e,t){const i=e+"Ex";if(-1===this._samplerList.indexOf(i+"0")){const s=this._samplerList.indexOf(e);for(let e=1;e<t.length;e++){const t=i+(e-1).toString();this._samplerList.splice(s+e,0,t)}let r=0;for(const e of this._samplerList)this._samplers[e]=r,r+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}bindUniformBuffer(e,t){const i=this._uniformBuffersNames[t];void 0===i||h._BaseCache[i]===e&&this._engine._features.useUBOBindingCache||(h._BaseCache[i]=e,this._engine.bindUniformBufferBase(e,i,t))}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setInt(e,t){return this._pipelineContext.setInt(e,t),this}setInt2(e,t,i){return this._pipelineContext.setInt2(e,t,i),this}setInt3(e,t,i,s){return this._pipelineContext.setInt3(e,t,i,s),this}setInt4(e,t,i,s,r){return this._pipelineContext.setInt4(e,t,i,s,r),this}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}setUInt2(e,t,i){return this._pipelineContext.setUInt2(e,t,i),this}setUInt3(e,t,i,s){return this._pipelineContext.setUInt3(e,t,i,s),this}setUInt4(e,t,i,s,r){return this._pipelineContext.setUInt4(e,t,i,s,r),this}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setArray(e,t){return this._pipelineContext.setArray(e,t),this}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}setFloat2(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}setFloat3(e,t,i,s){return this._pipelineContext.setFloat3(e,t,i,s),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setFloat4(e,t,i,s,r){return this._pipelineContext.setFloat4(e,t,i,s,r),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setColor4(e,t,i){return this._pipelineContext.setColor4(e,t,i),this}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(e=!1){if(e)this._refCount=0;else{if(h.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,o.mO)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(e,t,i,s=0){t&&(n.l.GetShadersStore(s)[`${e}PixelShader`]=t),i&&(n.l.GetShadersStore(s)[`${e}VertexShader`]=i)}static ResetCache(){h._BaseCache={}}}h.LogShaderCodeOnCompilationError=!0,h.PersistentMode=!1,h.AutomaticallyClearCodeCache=!1,h._UniqueIdSeed=0,h._BaseCache={},h.ShadersStore=n.l.ShadersStore,h.IncludesShadersStore=n.l.IncludesShadersStore},2465:(e,t,i)=>{"use strict";i.d(t,{PD:()=>o,XG:()=>h,gs:()=>c,jm:()=>l,w:()=>a});var s=i(3039);function r(e,t,i,s){switch(t){case 5120:{let t=e.getInt8(i);return s&&(t=Math.max(t/127,-1)),t}case 5121:{let t=e.getUint8(i);return s&&(t/=255),t}case 5122:{let t=e.getInt16(i,!0);return s&&(t=Math.max(t/32767,-1)),t}case 5123:{let t=e.getUint16(i,!0);return s&&(t/=65535),t}case 5124:return e.getInt32(i,!0);case 5125:return e.getUint32(i,!0);case 5126:return e.getFloat32(i,!0);default:throw new Error(`Invalid component type ${t}`)}}function n(e,t,i,s,r){switch(t){case 5120:s&&(r=Math.round(127*r)),e.setInt8(i,r);break;case 5121:s&&(r=Math.round(255*r)),e.setUint8(i,r);break;case 5122:s&&(r=Math.round(32767*r)),e.setInt16(i,r,!0);break;case 5123:s&&(r=Math.round(65535*r)),e.setUint16(i,r,!0);break;case 5124:e.setInt32(i,r,!0);break;case 5125:e.setUint32(i,r,!0);break;case 5126:e.setFloat32(i,r,!0);break;default:throw new Error(`Invalid component type ${t}`)}}function o(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${e}'`)}}function a(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${e}'`)}}function h(e,t,i,s,a,h,l,c){const u=new Array(s),d=new Array(s);if(e instanceof Array){let r=t/4;const n=i/4;for(let t=0;t<h;t+=s){for(let t=0;t<s;t++)u[t]=d[t]=e[r+t];c(d,t);for(let t=0;t<s;t++)u[t]!==d[t]&&(e[r+t]=d[t]);r+=n}}else{const _=ArrayBuffer.isView(e)?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e),p=o(a);for(let e=0;e<h;e+=s){for(let e=0,i=t;e<s;e++,i+=p)u[e]=d[e]=r(_,a,i,l);c(d,e);for(let e=0,i=t;e<s;e++,i+=p)u[e]!==d[e]&&n(_,a,i,l,d[e]);t+=i}}}function l(e,t,i,r,n,a,l,c){const u=t*o(i),d=l*t;if(5126!==i||n!==u){const s=new Float32Array(d);return h(e,r,n,t,i,d,a,((e,i)=>{for(let r=0;r<t;r++)s[i+r]=e[r]})),s}if(!(e instanceof Array||e instanceof Float32Array)||0!==r||e.length!==d){if(e instanceof Array){const t=r/4;return e.slice(t,t+d)}if(e instanceof ArrayBuffer)return new Float32Array(e,r,d);{const t=e.byteOffset+r;return 3&t&&(s.V.Warn("Float array must be aligned to 4-bytes border"),c=!0),c?new Float32Array(e.buffer.slice(t,t+d*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(e.buffer,t,d)}}return c?e.slice():e}function c(e,t,i,r,n,a,l,c){const u=t*o(i),d=l*t;if(c.length!==d)throw new Error("Output length is not valid");if(5126===i&&n===u)if(e instanceof Array){const t=r/4;c.set(e,t)}else if(e instanceof ArrayBuffer){const t=new Float32Array(e,r,d);c.set(t)}else{const t=e.byteOffset+r;if(3&t)return s.V.Warn("Float array must be aligned to 4-bytes border"),void c.set(new Float32Array(e.buffer.slice(t,t+d*Float32Array.BYTES_PER_ELEMENT)));const i=new Float32Array(e.buffer,t,d);c.set(i)}else h(e,r,n,t,i,d,a,((e,i)=>{for(let s=0;s<t;s++)c[i+s]=e[s]}))}},2507:(e,t,i)=>{"use strict";var s=i(3054),r=i(3039),n=i(976),o=i(4920);n.$.AudioEngineFactory=(e,t,i)=>new a(e,t,i);class a{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(e=null,t=null,i=null){if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new s.cP,this.onAudioLockedObservable=new s.cP,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,o.BA)())return;void 0!==window.AudioContext&&(this.canUseWebAudio=!0);const r=document.createElement("audio");this._hostElement=e,this._audioContext=t,this._audioDestination=i;try{r&&r.canPlayType&&(r.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||r.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(e){}try{r&&r.canPlayType&&r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}}lock(){this._triggerSuspendedState()}unlock(){if("running"===this._audioContext?.state)return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?this._audioContext?.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){this._audioContext?.addEventListener("statechange",(()=>{this.unlocked&&"running"!==this._audioContext?.state&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){return this._audioContext?.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(e){this.canUseWebAudio=!1,r.V.Error("Web Audio: "+e.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const e=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",t=document.createElement("style");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},2558:(e,t,i)=>{"use strict";i.d(t,{E:()=>r});var s=i(5098);class r{static GetEffect(e){return void 0===e.getPipelineContext?e.effect:e}constructor(e,t=!0){this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}setEffect(e,t,i=!0){this.effect=e,void 0!==t&&(this.defines=t),i&&this.drawContext?.reset()}dispose(e=!1){if(this.effect){const t=this.effect;e?t.dispose():s._.SetImmediate((()=>{t.getEngine().onEndFrameObservable.addOnce((()=>{t.dispose()}))})),this.effect=null}this.drawContext?.dispose()}}},2596:(e,t,i)=>{"use strict";i.d(t,{M:()=>s});class s{constructor(e){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e,e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(e=!1){this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const e of Object.keys(this))"_"!==e[0]&&this._keys.push(e);if(this._externalProperties)for(const e in this._externalProperties)-1===this._keys.indexOf(e)&&this._keys.push(e)}isEqual(e){if(this._keys.length!==e._keys.length)return!1;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];if(this[i]!==e[i])return!1}return!0}cloneTo(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(let t=0;t<this._keys.length;t++){const i=this._keys[t];e[i]=this[i]}}reset(){this._keys.forEach((e=>this._setDefaultValue(e)))}_setDefaultValue(e){const t=this._externalProperties?.[e]?.type??typeof this[e],i=this._externalProperties?.[e]?.default;switch(t){case"number":this[e]=i??0;break;case"string":this[e]=i??"";break;default:this[e]=i??!1}}toString(){let e="";for(let t=0;t<this._keys.length;t++){const i=this._keys[t],s=this[i];switch(typeof s){case"number":case"string":e+="#define "+i+" "+s+"\n";break;default:s&&(e+="#define "+i+"\n")}}return e}}},2605:(e,t,i)=>{"use strict";i.d(t,{P:()=>p});var s=i(4754),r=i(4049),n=i(766),o=i(2213),a=i(451),h=i(3039),l=i(4537),c=i(1345),u=i(4837),d=i(9593);class _{}class p{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,c.Aj)(this._applyToCoroutine.bind(this)),this.uniqueId=p._UniqueIDGenerator,p._UniqueIDGenerator++}set(e,t){switch(e.length||h.V.Warn(`Setting vertex data kind '${t}' with an empty array`),t){case n.R.PositionKind:this.positions=e;break;case n.R.NormalKind:this.normals=e;break;case n.R.TangentKind:this.tangents=e;break;case n.R.UVKind:this.uvs=e;break;case n.R.UV2Kind:this.uvs2=e;break;case n.R.UV3Kind:this.uvs3=e;break;case n.R.UV4Kind:this.uvs4=e;break;case n.R.UV5Kind:this.uvs5=e;break;case n.R.UV6Kind:this.uvs6=e;break;case n.R.ColorKind:this.colors=e;break;case n.R.MatricesIndicesKind:this.matricesIndices=e;break;case n.R.MatricesWeightsKind:this.matricesWeights=e;break;case n.R.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case n.R.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}}applyToMesh(e,t){return this._applyTo(e,t,!1),this}applyToGeometry(e,t){return this._applyTo(e,t,!1),this}updateMesh(e){return this._update(e),this}updateGeometry(e){return this._update(e),this}*_applyToCoroutine(e,t=!1,i){if(this.positions&&(e.setVerticesData(n.R.PositionKind,this.positions,t),i&&(yield)),this.normals&&(e.setVerticesData(n.R.NormalKind,this.normals,t),i&&(yield)),this.tangents&&(e.setVerticesData(n.R.TangentKind,this.tangents,t),i&&(yield)),this.uvs&&(e.setVerticesData(n.R.UVKind,this.uvs,t),i&&(yield)),this.uvs2&&(e.setVerticesData(n.R.UV2Kind,this.uvs2,t),i&&(yield)),this.uvs3&&(e.setVerticesData(n.R.UV3Kind,this.uvs3,t),i&&(yield)),this.uvs4&&(e.setVerticesData(n.R.UV4Kind,this.uvs4,t),i&&(yield)),this.uvs5&&(e.setVerticesData(n.R.UV5Kind,this.uvs5,t),i&&(yield)),this.uvs6&&(e.setVerticesData(n.R.UV6Kind,this.uvs6,t),i&&(yield)),this.colors&&(e.setVerticesData(n.R.ColorKind,this.colors,t),this.hasVertexAlpha&&void 0!==e.hasVertexAlpha&&(e.hasVertexAlpha=!0),i&&(yield)),this.matricesIndices&&(e.setVerticesData(n.R.MatricesIndicesKind,this.matricesIndices,t),i&&(yield)),this.matricesWeights&&(e.setVerticesData(n.R.MatricesWeightsKind,this.matricesWeights,t),i&&(yield)),this.matricesIndicesExtra&&(e.setVerticesData(n.R.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),i&&(yield)),this.matricesWeightsExtra&&(e.setVerticesData(n.R.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),i&&(yield)),this.indices?(e.setIndices(this.indices,null,t),i&&(yield)):e.setIndices([],null),e.subMeshes&&this.materialInfos&&this.materialInfos.length>1){const t=e;t.subMeshes=[];for(const e of this.materialInfos)new d.K(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,t)}return this}_update(e,t,i){return this.positions&&e.updateVerticesData(n.R.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData(n.R.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData(n.R.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData(n.R.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData(n.R.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData(n.R.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData(n.R.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData(n.R.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData(n.R.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData(n.R.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData(n.R.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData(n.R.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData(n.R.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData(n.R.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this}static _TransformVector3Coordinates(e,t,i=0,s=e.length){const n=r.AA.Vector3[0],o=r.AA.Vector3[1];for(let a=i;a<i+s;a+=3)r.Pq.FromArrayToRef(e,a,n),r.Pq.TransformCoordinatesToRef(n,t,o),e[a]=o.x,e[a+1]=o.y,e[a+2]=o.z}static _TransformVector3Normals(e,t,i=0,s=e.length){const n=r.AA.Vector3[0],o=r.AA.Vector3[1];for(let a=i;a<i+s;a+=3)r.Pq.FromArrayToRef(e,a,n),r.Pq.TransformNormalToRef(n,t,o),e[a]=o.x,e[a+1]=o.y,e[a+2]=o.z}static _TransformVector4Normals(e,t,i=0,s=e.length){const n=r.AA.Vector4[0],o=r.AA.Vector4[1];for(let a=i;a<i+s;a+=4)r.IU.FromArrayToRef(e,a,n),r.IU.TransformNormalToRef(n,t,o),e[a]=o.x,e[a+1]=o.y,e[a+2]=o.z,e[a+3]=o.w}static _FlipFaces(e,t=0,i=e.length){for(let s=t;s<t+i;s+=3){const t=e[s+1];e[s+1]=e[s+2],e[s+2]=t}}transform(e){const t=e.determinant()<0;return this.positions&&p._TransformVector3Coordinates(this.positions,e),this.normals&&p._TransformVector3Normals(this.normals,e),this.tangents&&p._TransformVector4Normals(this.tangents,e),t&&this.indices&&p._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const e=[];for(const t of this.materialInfos){const i=new p;if(this.positions&&(i.positions=this.positions.slice(3*t.verticesStart,3*(t.verticesCount+t.verticesStart))),this.normals&&(i.normals=this.normals.slice(3*t.verticesStart,3*(t.verticesCount+t.verticesStart))),this.tangents&&(i.tangents=this.tangents.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.colors&&(i.colors=this.colors.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.uvs&&(i.uvs=this.uvs.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs2&&(i.uvs2=this.uvs2.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs3&&(i.uvs3=this.uvs3.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs4&&(i.uvs4=this.uvs4.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs5&&(i.uvs5=this.uvs5.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs6&&(i.uvs6=this.uvs6.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.matricesIndices&&(i.matricesIndices=this.matricesIndices.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.matricesIndicesExtra&&(i.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.matricesWeights&&(i.matricesWeights=this.matricesWeights.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.matricesWeightsExtra&&(i.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.indices){i.indices=[];for(let e=t.indexStart;e<t.indexStart+t.indexCount;e++)i.indices.push(this.indices[e]-t.verticesStart)}const s=new _;s.indexStart=0,s.indexCount=i.indices?i.indices.length:0,s.materialIndex=t.materialIndex,s.verticesStart=0,s.verticesCount=(i.positions?i.positions.length:0)/3,i.materialInfos=[s],e.push(i)}return e}merge(e,t=!1,i=!1,s=!1,r=!1){const n=Array.isArray(e)?e.map((e=>({vertexData:e}))):[{vertexData:e}];return(0,c.V1)(this._mergeCoroutine(void 0,n,t,!1,i,s,r))}*_mergeCoroutine(e,t,i=!1,s,r,o=!1,a=!1){this._validate();let h=t.map((e=>e.vertexData)),l=this;if(a)for(const e of h)e&&(e._validate(),!this.normals&&e.normals&&(this.normals=new Float32Array(this.positions.length)),!this.tangents&&e.tangents&&(this.tangents=new Float32Array(this.positions.length/3*4)),!this.uvs&&e.uvs&&(this.uvs=new Float32Array(this.positions.length/3*2)),!this.uvs2&&e.uvs2&&(this.uvs2=new Float32Array(this.positions.length/3*2)),!this.uvs3&&e.uvs3&&(this.uvs3=new Float32Array(this.positions.length/3*2)),!this.uvs4&&e.uvs4&&(this.uvs4=new Float32Array(this.positions.length/3*2)),!this.uvs5&&e.uvs5&&(this.uvs5=new Float32Array(this.positions.length/3*2)),!this.uvs6&&e.uvs6&&(this.uvs6=new Float32Array(this.positions.length/3*2)),!this.colors&&e.colors&&(this.colors=new Float32Array(this.positions.length/3*4),this.colors.fill(1)),!this.matricesIndices&&e.matricesIndices&&(this.matricesIndices=new Float32Array(this.positions.length/3*4)),!this.matricesWeights&&e.matricesWeights&&(this.matricesWeights=new Float32Array(this.positions.length/3*4)),!this.matricesIndicesExtra&&e.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.positions.length/3*4)),!this.matricesWeightsExtra&&e.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.positions.length/3*4)));for(const e of h)if(e)if(a)this.normals&&!e.normals&&(e.normals=new Float32Array(e.positions.length)),this.tangents&&!e.tangents&&(e.tangents=new Float32Array(e.positions.length/3*4)),this.uvs&&!e.uvs&&(e.uvs=new Float32Array(e.positions.length/3*2)),this.uvs2&&!e.uvs2&&(e.uvs2=new Float32Array(e.positions.length/3*2)),this.uvs3&&!e.uvs3&&(e.uvs3=new Float32Array(e.positions.length/3*2)),this.uvs4&&!e.uvs4&&(e.uvs4=new Float32Array(e.positions.length/3*2)),this.uvs5&&!e.uvs5&&(e.uvs5=new Float32Array(e.positions.length/3*2)),this.uvs6&&!e.uvs6&&(e.uvs6=new Float32Array(e.positions.length/3*2)),this.colors&&!e.colors&&(e.colors=new Float32Array(e.positions.length/3*4),e.colors.fill(1)),this.matricesIndices&&!e.matricesIndices&&(e.matricesIndices=new Float32Array(e.positions.length/3*4)),this.matricesWeights&&!e.matricesWeights&&(e.matricesWeights=new Float32Array(e.positions.length/3*4)),this.matricesIndicesExtra&&!e.matricesIndicesExtra&&(e.matricesIndicesExtra=new Float32Array(e.positions.length/3*4)),this.matricesWeightsExtra&&!e.matricesWeightsExtra&&(e.matricesWeightsExtra=new Float32Array(e.positions.length/3*4));else if(e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(o){let i=0,s=0,r=0;const n=[];let o=null;const a=[];for(const t of this.splitBasedOnMaterialID())a.push({vertexData:t,transform:e});for(const e of t)if(e.vertexData)for(const t of e.vertexData.splitBasedOnMaterialID())a.push({vertexData:t,transform:e.transform});a.sort(((e,t)=>{const i=e.vertexData.materialInfos?e.vertexData.materialInfos[0].materialIndex:0,s=t.vertexData.materialInfos?t.vertexData.materialInfos[0].materialIndex:0;return i>s?1:i===s?0:-1}));for(const e of a){const t=e.vertexData;if(i=t.materialInfos?t.materialInfos[0].materialIndex:0,o&&o.materialIndex===i)o.indexCount+=t.indices.length,o.verticesCount+=t.positions.length/3;else{const e=new _;e.materialIndex=i,e.indexStart=s,e.indexCount=t.indices.length,e.verticesStart=r,e.verticesCount=t.positions.length/3,n.push(e),o=e}s+=t.indices.length,r+=t.positions.length/3}const c=a.splice(0,1)[0];l=c.vertexData,e=c.transform,h=a.map((e=>e.vertexData)),t=a,this.materialInfos=n}const c=h.reduce(((e,t)=>e+(t.indices?.length??0)),l.indices?.length??0);let u=r||h.some((e=>e.indices===l.indices))?l.indices?.slice():l.indices;if(c>0){let r=u?.length??0;if(u||(u=new Array(c)),u.length!==c){if(Array.isArray(u))u.length=c;else{const e=i||u instanceof Uint32Array?new Uint32Array(c):new Uint16Array(c);e.set(u),u=e}e&&e.determinant()<0&&p._FlipFaces(u,0,r)}let n=l.positions?l.positions.length/3:0;for(const{vertexData:e,transform:i}of t)if(e.indices){for(let t=0;t<e.indices.length;t++)u[r+t]=e.indices[t]+n;i&&i.determinant()<0&&p._FlipFaces(u,r,e.indices.length),n+=e.positions.length/3,r+=e.indices.length,s&&(yield)}}return this.indices=u,this.positions=p._MergeElement(n.R.PositionKind,l.positions,e,t.map((e=>[e.vertexData.positions,e.transform]))),s&&(yield),l.normals&&(this.normals=p._MergeElement(n.R.NormalKind,l.normals,e,t.map((e=>[e.vertexData.normals,e.transform]))),s&&(yield)),l.tangents&&(this.tangents=p._MergeElement(n.R.TangentKind,l.tangents,e,t.map((e=>[e.vertexData.tangents,e.transform]))),s&&(yield)),l.uvs&&(this.uvs=p._MergeElement(n.R.UVKind,l.uvs,e,t.map((e=>[e.vertexData.uvs,e.transform]))),s&&(yield)),l.uvs2&&(this.uvs2=p._MergeElement(n.R.UV2Kind,l.uvs2,e,t.map((e=>[e.vertexData.uvs2,e.transform]))),s&&(yield)),l.uvs3&&(this.uvs3=p._MergeElement(n.R.UV3Kind,l.uvs3,e,t.map((e=>[e.vertexData.uvs3,e.transform]))),s&&(yield)),l.uvs4&&(this.uvs4=p._MergeElement(n.R.UV4Kind,l.uvs4,e,t.map((e=>[e.vertexData.uvs4,e.transform]))),s&&(yield)),l.uvs5&&(this.uvs5=p._MergeElement(n.R.UV5Kind,l.uvs5,e,t.map((e=>[e.vertexData.uvs5,e.transform]))),s&&(yield)),l.uvs6&&(this.uvs6=p._MergeElement(n.R.UV6Kind,l.uvs6,e,t.map((e=>[e.vertexData.uvs6,e.transform]))),s&&(yield)),l.colors&&(this.colors=p._MergeElement(n.R.ColorKind,l.colors,e,t.map((e=>[e.vertexData.colors,e.transform]))),(void 0!==l.hasVertexAlpha||t.some((e=>void 0!==e.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=l.hasVertexAlpha||t.some((e=>e.vertexData.hasVertexAlpha))),s&&(yield)),l.matricesIndices&&(this.matricesIndices=p._MergeElement(n.R.MatricesIndicesKind,l.matricesIndices,e,t.map((e=>[e.vertexData.matricesIndices,e.transform]))),s&&(yield)),l.matricesWeights&&(this.matricesWeights=p._MergeElement(n.R.MatricesWeightsKind,l.matricesWeights,e,t.map((e=>[e.vertexData.matricesWeights,e.transform]))),s&&(yield)),l.matricesIndicesExtra&&(this.matricesIndicesExtra=p._MergeElement(n.R.MatricesIndicesExtraKind,l.matricesIndicesExtra,e,t.map((e=>[e.vertexData.matricesIndicesExtra,e.transform]))),s&&(yield)),l.matricesWeightsExtra&&(this.matricesWeightsExtra=p._MergeElement(n.R.MatricesWeightsExtraKind,l.matricesWeightsExtra,e,t.map((e=>[e.vertexData.matricesWeightsExtra,e.transform])))),this}static _MergeElement(e,t,i,s){const r=s.filter((e=>null!==e[0]&&void 0!==e[0]));if(!t&&0==r.length)return t;if(!t)return this._MergeElement(e,r[0][0],r[0][1],r.slice(1));const o=r.reduce(((e,t)=>e+t[0].length),t.length),a=e===n.R.PositionKind?p._TransformVector3Coordinates:e===n.R.NormalKind?p._TransformVector3Normals:e===n.R.TangentKind?p._TransformVector4Normals:()=>{};if(t instanceof Float32Array){const e=new Float32Array(o);e.set(t),i&&a(e,i,0,t.length);let s=t.length;for(const[t,i]of r)e.set(t,s),i&&a(e,i,s,t.length),s+=t.length;return e}{const e=new Array(o);for(let i=0;i<t.length;i++)e[i]=t[i];i&&a(e,i,0,t.length);let s=t.length;for(const[t,i]of r){for(let i=0;i<t.length;i++)e[s+i]=t[i];i&&a(e,i,s,t.length),s+=t.length}return e}}_validate(){if(!this.positions)throw new u.bu("Positions are required",u.tG.MeshInvalidPositionsError);const e=(e,t)=>{const i=n.R.DeduceStride(e);if(t.length%i!=0)throw new Error("The "+e+"s array count must be a multiple of "+i);return t.length/i},t=e(n.R.PositionKind,this.positions),i=(i,s)=>{const r=e(i,s);if(r!==t)throw new Error("The "+i+"s element count ("+r+") does not match the positions count ("+t+")")};this.normals&&i(n.R.NormalKind,this.normals),this.tangents&&i(n.R.TangentKind,this.tangents),this.uvs&&i(n.R.UVKind,this.uvs),this.uvs2&&i(n.R.UV2Kind,this.uvs2),this.uvs3&&i(n.R.UV3Kind,this.uvs3),this.uvs4&&i(n.R.UV4Kind,this.uvs4),this.uvs5&&i(n.R.UV5Kind,this.uvs5),this.uvs6&&i(n.R.UV6Kind,this.uvs6),this.colors&&i(n.R.ColorKind,this.colors),this.matricesIndices&&i(n.R.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(n.R.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(n.R.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(n.R.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const e=this.serialize();return p.Parse(e)}serialize(){const e={};if(this.positions&&(e.positions=Array.from(this.positions)),this.normals&&(e.normals=Array.from(this.normals)),this.tangents&&(e.tangents=Array.from(this.tangents)),this.uvs&&(e.uvs=Array.from(this.uvs)),this.uvs2&&(e.uvs2=Array.from(this.uvs2)),this.uvs3&&(e.uvs3=Array.from(this.uvs3)),this.uvs4&&(e.uvs4=Array.from(this.uvs4)),this.uvs5&&(e.uvs5=Array.from(this.uvs5)),this.uvs6&&(e.uvs6=Array.from(this.uvs6)),this.colors&&(e.colors=Array.from(this.colors),e.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(e.matricesIndices=Array.from(this.matricesIndices),e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(e.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),e.indices=this.indices?Array.from(this.indices):[],this.materialInfos){e.materialInfos=[];for(const t of this.materialInfos){const i={indexStart:t.indexStart,indexCount:t.indexCount,materialIndex:t.materialIndex,verticesStart:t.verticesStart,verticesCount:t.verticesCount};e.materialInfos.push(i)}}return e}static ExtractFromMesh(e,t,i){return p._ExtractFrom(e,t,i)}static ExtractFromGeometry(e,t,i){return p._ExtractFrom(e,t,i)}static _ExtractFrom(e,t,i){const s=new p;if(e.isVerticesDataPresent(n.R.PositionKind)&&(s.positions=e.getVerticesData(n.R.PositionKind,t,i)),e.isVerticesDataPresent(n.R.NormalKind)&&(s.normals=e.getVerticesData(n.R.NormalKind,t,i)),e.isVerticesDataPresent(n.R.TangentKind)&&(s.tangents=e.getVerticesData(n.R.TangentKind,t,i)),e.isVerticesDataPresent(n.R.UVKind)&&(s.uvs=e.getVerticesData(n.R.UVKind,t,i)),e.isVerticesDataPresent(n.R.UV2Kind)&&(s.uvs2=e.getVerticesData(n.R.UV2Kind,t,i)),e.isVerticesDataPresent(n.R.UV3Kind)&&(s.uvs3=e.getVerticesData(n.R.UV3Kind,t,i)),e.isVerticesDataPresent(n.R.UV4Kind)&&(s.uvs4=e.getVerticesData(n.R.UV4Kind,t,i)),e.isVerticesDataPresent(n.R.UV5Kind)&&(s.uvs5=e.getVerticesData(n.R.UV5Kind,t,i)),e.isVerticesDataPresent(n.R.UV6Kind)&&(s.uvs6=e.getVerticesData(n.R.UV6Kind,t,i)),e.isVerticesDataPresent(n.R.ColorKind)){const r=e.geometry||e,o=r.getVertexBuffer(n.R.ColorKind),a=r.getVerticesData(n.R.ColorKind,t,i);if(3===o.getSize()){const e=new Float32Array(4*a.length/3);for(let t=0,i=0;t<a.length;t+=3,i+=4)e[i]=a[t],e[i+1]=a[t+1],e[i+2]=a[t+2],e[i+3]=1;s.colors=e}else{if(4!==o.getSize())throw new Error(`Unexpected number of color components: ${o.getSize()}`);s.colors=a}}return e.isVerticesDataPresent(n.R.MatricesIndicesKind)&&(s.matricesIndices=e.getVerticesData(n.R.MatricesIndicesKind,t,i)),e.isVerticesDataPresent(n.R.MatricesWeightsKind)&&(s.matricesWeights=e.getVerticesData(n.R.MatricesWeightsKind,t,i)),e.isVerticesDataPresent(n.R.MatricesIndicesExtraKind)&&(s.matricesIndicesExtra=e.getVerticesData(n.R.MatricesIndicesExtraKind,t,i)),e.isVerticesDataPresent(n.R.MatricesWeightsExtraKind)&&(s.matricesWeightsExtra=e.getVerticesData(n.R.MatricesWeightsExtraKind,t,i)),s.indices=e.getIndices(t,i),s}static CreateRibbon(e){throw(0,o.n)("ribbonBuilder")}static CreateBox(e){throw(0,o.n)("boxBuilder")}static CreateTiledBox(e){throw(0,o.n)("tiledBoxBuilder")}static CreateTiledPlane(e){throw(0,o.n)("tiledPlaneBuilder")}static CreateSphere(e){throw(0,o.n)("sphereBuilder")}static CreateCylinder(e){throw(0,o.n)("cylinderBuilder")}static CreateTorus(e){throw(0,o.n)("torusBuilder")}static CreateLineSystem(e){throw(0,o.n)("linesBuilder")}static CreateDashedLines(e){throw(0,o.n)("linesBuilder")}static CreateGround(e){throw(0,o.n)("groundBuilder")}static CreateTiledGround(e){throw(0,o.n)("groundBuilder")}static CreateGroundFromHeightMap(e){throw(0,o.n)("groundBuilder")}static CreatePlane(e){throw(0,o.n)("planeBuilder")}static CreateDisc(e){throw(0,o.n)("discBuilder")}static CreatePolygon(e,t,i,s,r,n,a){throw(0,o.n)("polygonBuilder")}static CreateIcoSphere(e){throw(0,o.n)("icoSphereBuilder")}static CreatePolyhedron(e){throw(0,o.n)("polyhedronBuilder")}static CreateCapsule(e={orientation:r.Pq.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw(0,o.n)("capsuleBuilder")}static CreateTorusKnot(e){throw(0,o.n)("torusKnotBuilder")}static ComputeNormals(e,t,i,s){let n=0,o=0,a=0,h=0,l=0,c=0,u=0,d=0,_=0,p=0,g=0,f=0,m=0,b=0,v=0,T=0,y=0,x=0,A=0,C=0,S=!1,E=!1,R=!1,P=!1,I=1,M=0,w=null;s&&(S=!!s.facetNormals,E=!!s.facetPositions,R=!!s.facetPartitioning,I=!0===s.useRightHandedSystem?-1:1,M=s.ratio||0,P=!!s.depthSort,w=s.distanceTo,P&&void 0===w&&(w=r.Pq.Zero()));let O=0,B=0,D=0,F=0;for(R&&s&&s.bbSize&&(O=s.subDiv.X*M/s.bbSize.x,B=s.subDiv.Y*M/s.bbSize.y,D=s.subDiv.Z*M/s.bbSize.z,F=s.subDiv.max*s.subDiv.max,s.facetPartitioning.length=0),n=0;n<e.length;n++)i[n]=0;const L=t.length/3|0;for(n=0;n<L;n++){if(f=3*t[3*n],m=f+1,b=f+2,v=3*t[3*n+1],T=v+1,y=v+2,x=3*t[3*n+2],A=x+1,C=x+2,o=e[f]-e[v],a=e[m]-e[T],h=e[b]-e[y],l=e[x]-e[v],c=e[A]-e[T],u=e[C]-e[y],d=I*(a*u-h*c),_=I*(h*l-o*u),p=I*(o*c-a*l),g=Math.sqrt(d*d+_*_+p*p),g=0===g?1:g,d/=g,_/=g,p/=g,S&&s&&(s.facetNormals[n].x=d,s.facetNormals[n].y=_,s.facetNormals[n].z=p),E&&s&&(s.facetPositions[n].x=(e[f]+e[v]+e[x])/3,s.facetPositions[n].y=(e[m]+e[T]+e[A])/3,s.facetPositions[n].z=(e[b]+e[y]+e[C])/3),R&&s){const t=Math.floor((s.facetPositions[n].x-s.bInfo.minimum.x*M)*O),i=Math.floor((s.facetPositions[n].y-s.bInfo.minimum.y*M)*B),r=Math.floor((s.facetPositions[n].z-s.bInfo.minimum.z*M)*D),o=Math.floor((e[f]-s.bInfo.minimum.x*M)*O),a=Math.floor((e[m]-s.bInfo.minimum.y*M)*B),h=Math.floor((e[b]-s.bInfo.minimum.z*M)*D),l=Math.floor((e[v]-s.bInfo.minimum.x*M)*O),c=Math.floor((e[T]-s.bInfo.minimum.y*M)*B),u=Math.floor((e[y]-s.bInfo.minimum.z*M)*D),d=Math.floor((e[x]-s.bInfo.minimum.x*M)*O),_=Math.floor((e[A]-s.bInfo.minimum.y*M)*B),p=Math.floor((e[C]-s.bInfo.minimum.z*M)*D),g=o+s.subDiv.max*a+F*h,S=l+s.subDiv.max*c+F*u,E=d+s.subDiv.max*_+F*p,R=t+s.subDiv.max*i+F*r;s.facetPartitioning[R]=s.facetPartitioning[R]?s.facetPartitioning[R]:new Array,s.facetPartitioning[g]=s.facetPartitioning[g]?s.facetPartitioning[g]:new Array,s.facetPartitioning[S]=s.facetPartitioning[S]?s.facetPartitioning[S]:new Array,s.facetPartitioning[E]=s.facetPartitioning[E]?s.facetPartitioning[E]:new Array,s.facetPartitioning[g].push(n),S!=g&&s.facetPartitioning[S].push(n),E!=S&&E!=g&&s.facetPartitioning[E].push(n),R!=g&&R!=S&&R!=E&&s.facetPartitioning[R].push(n)}if(P&&s&&s.facetPositions){const e=s.depthSortedFacets[n];e.ind=3*n,e.sqDistance=r.Pq.DistanceSquared(s.facetPositions[n],w)}i[f]+=d,i[m]+=_,i[b]+=p,i[v]+=d,i[T]+=_,i[y]+=p,i[x]+=d,i[A]+=_,i[C]+=p}for(n=0;n<i.length/3;n++)d=i[3*n],_=i[3*n+1],p=i[3*n+2],g=Math.sqrt(d*d+_*_+p*p),g=0===g?1:g,d/=g,_/=g,p/=g,i[3*n]=d,i[3*n+1]=_,i[3*n+2]=p}static _ComputeSides(e,t,i,s,n,o,a){const h=i.length,l=s.length;let c,u;switch(e=e||p.DEFAULTSIDE){case p.FRONTSIDE:break;case p.BACKSIDE:for(c=0;c<h;c+=3){const e=i[c];i[c]=i[c+2],i[c+2]=e}for(u=0;u<l;u++)s[u]=-s[u];break;case p.DOUBLESIDE:{const e=t.length,d=e/3;for(let i=0;i<e;i++)t[e+i]=t[i];for(c=0;c<h;c+=3)i[c+h]=i[c+2]+d,i[c+1+h]=i[c+1]+d,i[c+2+h]=i[c]+d;for(u=0;u<l;u++)s[l+u]=-s[u];const _=n.length;let p=0;for(p=0;p<_;p++)n[p+_]=n[p];for(o=o||new r.IU(0,0,1,1),a=a||new r.IU(0,0,1,1),p=0,c=0;c<_/2;c++)n[p]=o.x+(o.z-o.x)*n[p],n[p+1]=o.y+(o.w-o.y)*n[p+1],n[p+_]=a.x+(a.z-a.x)*n[p+_],n[p+_+1]=a.y+(a.w-a.y)*n[p+_+1],p+=2;break}}}static Parse(e){const t=new p,i=e.positions;i&&t.set(i,n.R.PositionKind);const s=e.normals;s&&t.set(s,n.R.NormalKind);const r=e.tangents;r&&t.set(r,n.R.TangentKind);const o=e.uvs;o&&t.set(o,n.R.UVKind);const h=e.uvs2;h&&t.set(h,n.R.UV2Kind);const l=e.uvs3;l&&t.set(l,n.R.UV3Kind);const c=e.uvs4;c&&t.set(c,n.R.UV4Kind);const u=e.uvs5;u&&t.set(u,n.R.UV5Kind);const d=e.uvs6;d&&t.set(d,n.R.UV6Kind);const g=e.colors;g&&(t.set(a.ov.CheckColors4(g,i.length/3),n.R.ColorKind),void 0!==e.hasVertexAlpha&&(t.hasVertexAlpha=e.hasVertexAlpha));const f=e.matricesIndices;f&&t.set(f,n.R.MatricesIndicesKind);const m=e.matricesWeights;m&&t.set(m,n.R.MatricesWeightsKind);const b=e.indices;b&&(t.indices=b);const v=e.materialInfos;if(v){t.materialInfos=[];for(const e of v){const i=new _;i.indexCount=e.indexCount,i.indexStart=e.indexStart,i.verticesCount=e.verticesCount,i.verticesStart=e.verticesStart,i.materialIndex=e.materialIndex,t.materialInfos.push(i)}}return t}static ImportVertexData(e,t){const i=p.Parse(e);t.setAllVerticesData(i,e.updatable)}}p.FRONTSIDE=0,p.BACKSIDE=1,p.DOUBLESIDE=2,p.DEFAULTSIDE=0,p._UniqueIDGenerator=0,(0,s.Cg)([l.Cx.filter(((...[e])=>!Array.isArray(e)))],p,"_TransformVector3Coordinates",null),(0,s.Cg)([l.Cx.filter(((...[e])=>!Array.isArray(e)))],p,"_TransformVector3Normals",null),(0,s.Cg)([l.Cx.filter(((...[e])=>!Array.isArray(e)))],p,"_TransformVector4Normals",null),(0,s.Cg)([l.Cx.filter(((...[e])=>!Array.isArray(e)))],p,"_FlipFaces",null)},2610:(e,t,i)=>{"use strict";i.d(t,{P:()=>r});var s=i(2050);class r{static GetPlanes(e){const t=[];for(let e=0;e<6;e++)t.push(new s.Z(0,0,0,0));return r.GetPlanesToRef(e,t),t}static GetNearPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()}static GetFarPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()}static GetLeftPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()}static GetRightPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()}static GetTopPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()}static GetBottomPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()}static GetPlanesToRef(e,t){r.GetNearPlaneToRef(e,t[0]),r.GetFarPlaneToRef(e,t[1]),r.GetLeftPlaneToRef(e,t[2]),r.GetRightPlaneToRef(e,t[3]),r.GetTopPlaneToRef(e,t[4]),r.GetBottomPlaneToRef(e,t[5])}static IsPointInFrustum(e,t){for(let i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0}}},2631:(e,t,i)=>{"use strict";i.d(t,{h:()=>s});class s{}s._IsPickingAvailable=!1},2687:(e,t,i)=>{"use strict";i.d(t,{o:()=>s});class s{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let e=0|this.width;return e=397*e^this.height,e}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(e,t){return new s(this.width*e,this.height*t)}clone(){return new s(this.width,this.height)}equals(e){return!!e&&this.width===e.width&&this.height===e.height}get surface(){return this.width*this.height}static Zero(){return new s(0,0)}add(e){return new s(this.width+e.width,this.height+e.height)}subtract(e){return new s(this.width-e.width,this.height-e.height)}scale(e){return new s(this.width*e,this.height*e)}static Lerp(e,t,i){const r=e.width+(t.width-e.width)*i,n=e.height+(t.height-e.height)*i;return new s(r,n)}}},2746:(e,t,i)=>{"use strict";i.d(t,{X:()=>n});var s=i(8857);const r=s.HighestCommonFactor,n={...s,TwoPi:2*Math.PI,Sign:Math.sign,Log2:Math.log2,HCF:r}},2793:(e,t,i)=>{"use strict";i.d(t,{J:()=>s});class s{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(e){}bindForSubMesh(e,t,i,s,r){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&(-1!==t.prePassRenderer.getIndex(2)||-1!==t.prePassRenderer.getIndex(11))){this.previousWorldMatrices[i.uniqueId]||(this.previousWorldMatrices[i.uniqueId]=s.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());const r=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=r.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==r.frameId&&(this._lastUpdateFrameId=r.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[i.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[i.uniqueId]=s.clone()}}}},3039:(e,t,i)=>{"use strict";i.d(t,{V:()=>s});class s{static _CheckLimit(e,t){let i=s._LogLimitOutputs[e];return i?i.current++:(i={limit:t,current:1},s._LogLimitOutputs[e]=i),i.current<=i.limit}static _GenerateLimitMessage(e,t=1){const i=s._LogLimitOutputs[e];if(!i||!s.MessageLimitReached)return;const r=this._Levels[t];i.current===i.limit&&s[r.name](s.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,r.name??""))}static _AddLogEntry(e){s._LogCache=e+s._LogCache,s.OnNewCacheEntry&&s.OnNewCacheEntry(e)}static _FormatMessage(e){const t=e=>e<10?"0"+e:""+e,i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e}static _LogDisabled(e,t){}static _LogEnabled(e=1,t,i){const r=Array.isArray(t)?t[0]:t;if(void 0!==i&&!s._CheckLimit(r,i))return;const n=s._FormatMessage(r),o=this._Levels[e],a=Array.isArray(t)?t.slice(1):[];o.logFunc&&o.logFunc("BJS - "+n,...a);const h=`<div style='color:${o.color}'>${n}</div><br>`;s._AddLogEntry(h),s._GenerateLimitMessage(r,e)}static get LogCache(){return s._LogCache}static ClearLogCache(){s._LogCache="",s._LogLimitOutputs={},s.errorsCount=0}static set LogLevels(e){s.Log=s._LogDisabled,s.Warn=s._LogDisabled,s.Error=s._LogDisabled,[s.MessageLogLevel,s.WarningLogLevel,s.ErrorLogLevel].forEach((t=>{if((e&t)===t){const e=this._Levels[t];s[e.name]=s._LogEnabled.bind(s,t)}}))}}s.NoneLogLevel=0,s.MessageLogLevel=1,s.WarningLogLevel=2,s.ErrorLogLevel=4,s.AllLogLevel=7,s.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",s._LogCache="",s._LogLimitOutputs={},s._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],s.errorsCount=0,s.Log=s._LogEnabled.bind(s,s.MessageLogLevel),s.Warn=s._LogEnabled.bind(s,s.WarningLogLevel),s.Error=s._LogEnabled.bind(s,s.ErrorLogLevel)},3054:(e,t,i)=>{"use strict";i.d(t,{cP:()=>o});const s="undefined"!=typeof WeakRef;class r{constructor(e,t=!1,i,s){this.initialize(e,t,i,s)}initialize(e,t=!1,i,s){return this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=s,this}}class n{constructor(e,t,i=null){this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class o{static FromPromise(e,t){const i=new o;return e.then((e=>{i.notifyObservers(e)})).catch((e=>{if(!t)throw e;t.notifyObservers(e)})),i}get observers(){return this._observers}constructor(e,t=!1){this.notifyIfTriggered=t,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new r(0),e&&(this._onObserverAdded=e)}add(e,t=-1,i=!1,r=null,o=!1){if(!e)return null;const a=new n(e,t,r);a.unregisterOnNextCall=o,i?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(a,this._lastNotifiedValue);const h=s?new WeakRef(this):{deref:()=>this};return a._remove=()=>{const e=h.deref();e&&e._remove(a)},a}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}remove(e){return!!e&&(e._remove=null,-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))}removeCallback(e,t){for(let i=0;i<this._observers.length;i++){const s=this._observers[i];if(!(s._willBeUnregistered||s.callback!==e||t&&t!==s.scope))return this._deferUnregister(s),!0}return!1}_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((()=>{this._remove(e)}),0))}_remove(e,t=!0){if(!e)return!1;const i=this._observers.indexOf(e);return-1!==i&&(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0)}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}notifyObservers(e,t=-1,i,s,r){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;const n=this._eventState;n.mask=t,n.target=i,n.currentTarget=s,n.skipNextObservers=!1,n.lastReturnValue=e,n.userInfo=r;for(const i of this._observers)if(!i._willBeUnregistered&&(i.mask&t&&(i.unregisterOnNextCall&&this._deferUnregister(i),i.scope?n.lastReturnValue=i.callback.apply(i.scope,[e,n]):n.lastReturnValue=i.callback(e,n)),n.skipNextObservers))return!1;return!0}notifyObserver(e,t,i=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),e._willBeUnregistered)return;const s=this._eventState;s.mask=i,s.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(t,s)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const e=new o;return e._observers=this._observers.slice(0),e}hasSpecificMask(e=-1){for(const t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}}},3086:(e,t,i)=>{"use strict";i.d(t,{v9:()=>s.v9,ov:()=>s.ov,PT:()=>r.PT,IG:()=>s.IG,AA:()=>r.AA,I9:()=>r.I9,Pq:()=>r.Pq,IU:()=>r.IU}),i(6871);var s=i(451),r=(i(7761),i(2610),i(3245),i(2050),i(2687),i(4049));i(1956)},3113:(e,t,i)=>{"use strict";i.d(t,{t:()=>d});var s=i(4754),r=i(4537),n=i(3054),o=i(4049),a=i(1497),h=i(7634),l=(i(9649),i(2687));class c{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(e){return void 0!==e?.shareDepth}constructor(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=l.o.Zero(),this._cachedBaseSize=l.o.Zero(),this._initialSamplingMode=2,this._texture=c._IsRenderTargetWrapper(e)?e.texture:e,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var u=i(979);class d extends c{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(e){e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||(this._uid=(0,h.z)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(e,t=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=d.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new n.cP,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,e?d._IsScene(e)?this._scene=e:this._engine=e:this._scene=a.q.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return o.uq.IdentityReadOnly}getReflectionTextureMatrix(){return o.uq.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,i,s,r,n){const o=this._getEngine();if(!o)return null;const a=o._getUseSRGBBuffer(!!r,t),h=o.getLoadedTexturesCache();for(let o=0;o<h.length;o++){const l=h[o];if(!(void 0!==r&&a!==l._useSRGBBuffer||void 0!==s&&s!==l.invertY||l.url!==e||l.generateMipMaps!==!t||i&&i!==l.samplingMode||void 0!==n&&n!==l.isCube))return l.incrementReferences(),l}return null}_rebuild(e=!1){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(e=0,t=0,i=null,s=!0,r=!1,n=0,o=0,a=Number.MAX_VALUE,h=Number.MAX_VALUE){if(!this._texture)return null;const l=this._getEngine();if(!l)return null;const c=this.getSize();let u=c.width,d=c.height;0!==t&&(u/=Math.pow(2,t),d/=Math.pow(2,t),u=Math.round(u),d=Math.round(d)),a=Math.min(u,a),h=Math.min(d,h);try{return this._texture.isCube?l._readTexturePixels(this._texture,a,h,e,t,i,s,r,n,o):l._readTexturePixels(this._texture,a,h,-1,t,i,s,r,n,o)}catch(e){return null}}_readPixelsSync(e=0,t=0,i=null,s=!0,r=!1){if(!this._texture)return null;const n=this.getSize();let o=n.width,a=n.height;const h=this._getEngine();if(!h)return null;0!=t&&(o/=Math.pow(2,t),a/=Math.pow(2,t),o=Math.round(o),a=Math.round(a));try{return this._texture.isCube?h._readTexturePixelsSync(this._texture,o,a,e,t,i,s,r):h._readTexturePixelsSync(this._texture,o,a,-1,t,i,s,r)}catch(e){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const e=this._parentContainer.textures.indexOf(this);e>-1&&this._parentContainer.textures.splice(e,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(e=!1){if(!this.name&&!e)return null;const t=u.p.Serialize(this);return u.p.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let i=e.length;if(0!==i)for(let s=0;s<e.length;s++){const r=e[s];if(r.isReady())0==--i&&t();else{const e=r.onLoadObservable;e?e.addOnce((()=>{0==--i&&t()})):0==--i&&t()}}else t()}static _IsScene(e){return"Scene"===e.getClassName()}}d.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,s.Cg)([(0,r.lK)()],d.prototype,"uniqueId",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"name",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"displayName",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"metadata",void 0),(0,s.Cg)([(0,r.lK)("hasAlpha")],d.prototype,"_hasAlpha",void 0),(0,s.Cg)([(0,r.lK)("getAlphaFromRGB")],d.prototype,"_getAlphaFromRGB",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"level",void 0),(0,s.Cg)([(0,r.lK)("coordinatesIndex")],d.prototype,"_coordinatesIndex",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"optimizeUVAllocation",void 0),(0,s.Cg)([(0,r.lK)("coordinatesMode")],d.prototype,"_coordinatesMode",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"wrapU",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"wrapV",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"wrapR",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"anisotropicFilteringLevel",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"isCube",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"is3D",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"is2DArray",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"gammaSpace",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"invertZ",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"lodLevelInAlpha",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"lodGenerationOffset",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"lodGenerationScale",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"linearSpecularLOD",null),(0,s.Cg)([(0,r.uM)()],d.prototype,"irradianceTexture",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"isRenderTarget",void 0)},3116:(e,t,i)=>{"use strict";i.d(t,{LT:()=>h,NK:()=>o,VH:()=>a});var s=i(7473);function r(e,t,i,s,r,n){r>0?(r=function(e,t){return t>1023?1*Math.pow(2,1023)*Math.pow(2,t-1023):t<-1074?1*Math.pow(2,-1074)*Math.pow(2,t+1074):1*Math.pow(2,t)}(0,r-136),e[n+0]=t*r,e[n+1]=i*r,e[n+2]=s*r):(e[n+0]=0,e[n+1]=0,e[n+2]=0)}function n(e,t){let i="",s="";for(let r=t;r<e.length-t&&(s=String.fromCharCode(e[r]),"\n"!=s);r++)i+=s;return i}function o(e){let t=0,i=0,s=n(e,0);if("#"!=s[0]||"?"!=s[1])throw"Bad HDR Format.";let r=!1,o=!1,a=0;do{a+=s.length+1,s=n(e,a),"FORMAT=32-bit_rle_rgbe"==s?o=!0:0==s.length&&(r=!0)}while(!r);if(!o)throw"HDR Bad header format, unsupported FORMAT";a+=s.length+1,s=n(e,a);const h=/^-Y (.*) \+X (.*)$/g.exec(s);if(!h||h.length<3)throw"HDR Bad header format, no size";if(i=parseInt(h[2]),t=parseInt(h[1]),i<8||i>32767)throw"HDR Bad header format, unsupported size";return a+=s.length+1,{height:t,width:i,dataPosition:a}}function a(e,t,i=!1){const r=new Uint8Array(e),n=o(r),a=h(r,n);return s.D.ConvertPanoramaToCubemap(a,n.width,n.height,t,i)}function h(e,t){return function(e,t){let i=t.height;const s=t.width;let n,o,a,h,c,u=t.dataPosition,d=0,_=0,p=0;const g=new ArrayBuffer(4*s),f=new Uint8Array(g),m=new ArrayBuffer(t.width*t.height*4*3),b=new Float32Array(m);for(;i>0;){if(n=e[u++],o=e[u++],a=e[u++],h=e[u++],2!=n||2!=o||128&a||t.width<8||t.width>32767)return l(e,t);if((a<<8|h)!=s)throw"HDR Bad header format, wrong scan line width";for(d=0,p=0;p<4;p++)for(_=(p+1)*s;d<_;)if(n=e[u++],o=e[u++],n>128){if(c=n-128,0==c||c>_-d)throw"HDR Bad Format, bad scanline data (run)";for(;c-- >0;)f[d++]=o}else{if(c=n,0==c||c>_-d)throw"HDR Bad Format, bad scanline data (non-run)";if(f[d++]=o,--c>0)for(let t=0;t<c;t++)f[d++]=e[u++]}for(p=0;p<s;p++)n=f[p],o=f[p+s],a=f[p+2*s],h=f[p+3*s],r(b,n,o,a,h,(t.height-i)*s*3+3*p);i--}return b}(e,t)}function l(e,t){let i=t.height;const s=t.width;let n,o,a,h,l,c=t.dataPosition;const u=new ArrayBuffer(t.width*t.height*4*3),d=new Float32Array(u);for(;i>0;){for(l=0;l<t.width;l++)n=e[c++],o=e[c++],a=e[c++],h=e[c++],r(d,n,o,a,h,(t.height-i)*s*3+3*l);i--}return d}},3190:(e,t,i)=>{"use strict";i.r(t),i.d(t,{depthPixelShader:()=>o});var s=i(4796);i(1407),i(5432),i(2250);const r="depthPixelShader",n="#ifdef ALPHATEST\nvarying vec2 vUV;uniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvarying float vDepthMetric;\n#ifdef PACKED\n#include<packingFunctions>\n#endif\n#ifdef STORE_CAMERASPACE_Z\nvarying vec4 vViewPos;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef STORE_CAMERASPACE_Z\n#ifdef PACKED\ngl_FragColor=pack(vViewPos.z);\n#else\ngl_FragColor=vec4(vViewPos.z,0.0,0.0,1.0);\n#endif\n#else\n#ifdef NONLINEARDEPTH\n#ifdef PACKED\ngl_FragColor=pack(gl_FragCoord.z);\n#else\ngl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);\n#endif\n#else\n#ifdef PACKED\ngl_FragColor=pack(vDepthMetric);\n#else\ngl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);\n#endif\n#endif\n#endif\n}";s.l.ShadersStore[r]=n;const o={name:r,shader:n}},3218:(e,t,i)=>{"use strict";i.d(t,{B:()=>s});const s={name:"splat",extensions:{".splat":{isBinary:!0},".ply":{isBinary:!0},".spz":{isBinary:!0}}}},3221:e=>{"use strict";e.exports=URIError},3232:(e,t,i)=>{"use strict";var s=i(8897),r=i(946),n=r([s("%String.prototype.indexOf%")]);e.exports=function(e,t){var i=s(e,!!t);return"function"==typeof i&&n(e,".prototype.")>-1?r([i]):i}},3240:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.instancesDeclaration="#ifdef INSTANCES\nattribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)\nattribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)\nuniform mat4 previousWorld;\n#endif\n#endif\n"},3245:(e,t,i)=>{"use strict";i.d(t,{Cu:()=>c,jj:()=>d,tO:()=>u,vr:()=>a});var s,r=i(8857),n=i(4049),o=i(7761);!function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(s||(s={}));class a{static Interpolate(e,t,i,s,r){const n=1-3*s+3*t,o=3*s-6*t,a=3*t;let h=e;for(let t=0;t<5;t++){const t=h*h;h-=1/(3*n*t+2*o*h+a)*(n*(t*h)+o*t+a*h-e),h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*r+Math.pow(h,3)}}class h{constructor(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(e,t){const i=t.subtract(e),s=Math.atan2(i.y,i.x);return new h(s)}static BetweenTwoVectors(e,t){let i=e.lengthSquared()*t.lengthSquared();if(0===i)return new h(Math.PI/2);i=Math.sqrt(i);let s=e.dot(t)/i;s=(0,r.Clamp)(s,-1,1);const n=Math.acos(s);return new h(n)}static FromRadians(e){return new h(e)}static FromDegrees(e){return new h(e*Math.PI/180)}}class l{constructor(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;const s=Math.pow(t.x,2)+Math.pow(t.y,2),r=(Math.pow(e.x,2)+Math.pow(e.y,2)-s)/2,o=(s-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new n.I9((r*(t.y-i.y)-o*(e.y-t.y))/a,((e.x-t.x)*o-(t.x-i.x)*r)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=h.BetweenTwoPoints(this.centerPoint,this.startPoint);const l=this.startAngle.degrees();let c=h.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),u=h.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-l>180&&(c-=360),c-l<-180&&(c+=360),u-c>180&&(u-=360),u-c<-180&&(u+=360),this.orientation=c-l<0?0:1,this.angle=h.FromDegrees(0===this.orientation?l-u:u-l)}}class c{constructor(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n.I9(e,t))}addLineTo(e,t){if(this.closed)return this;const i=new n.I9(e,t),s=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(s).length(),this}addArcTo(e,t,i,s,r=36){if(this.closed)return this;const o=this._points[this._points.length-1],a=new n.I9(e,t),h=new n.I9(i,s),c=new l(o,a,h);let u=c.angle.radians()/r;0===c.orientation&&(u*=-1);let d=c.startAngle.radians()+u;for(let e=0;e<r;e++){const e=Math.cos(d)*c.radius+c.centerPoint.x,t=Math.sin(d)*c.radius+c.centerPoint.y;this.addLineTo(e,t),d+=u}return this}addQuadraticCurveTo(e,t,i,s,r=36){if(this.closed)return this;const n=(e,t,i,s)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*s,o=this._points[this._points.length-1];for(let a=0;a<=r;a++){const h=a/r,l=n(h,o.x,e,i),c=n(h,o.y,t,s);this.addLineTo(l,c)}return this}addBezierCurveTo(e,t,i,s,r,n,o=36){if(this.closed)return this;const a=(e,t,i,s,r)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*s+e*e*e*r,h=this._points[this._points.length-1];for(let l=0;l<=o;l++){const c=l/o,u=a(c,h.x,e,i,r),d=a(c,h.y,t,s,n);this.addLineTo(u,d)}return this}isPointInside(e){let t=!1;const i=this._points.length;for(let s=i-1,r=0;r<i;s=r++){let i=this._points[s],n=this._points[r],o=n.x-i.x,a=n.y-i.y;if(Math.abs(a)>Number.EPSILON){if(a<0&&(i=this._points[r],o=-o,n=this._points[s],a=-a),e.y<i.y||e.y>n.y)continue;if(e.y===i.y&&e.x===i.x)return!0;{const s=a*(e.x-i.x)-o*(e.y-i.y);if(0===s)return!0;if(s<0)continue;t=!t}}else{if(e.y!==i.y)continue;if(n.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=n.x)return!0}}return t}close(){return this.closed=!0,this}length(){let e=this._length;if(this.closed){const t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e}area(){const e=this._points.length;let t=0;for(let i=e-1,s=0;s<e;i=s++)t+=this._points[i].x*this._points[s].y-this._points[s].x*this._points[i].y;return.5*t}getPoints(){return this._points}getPointAtLengthPosition(e){if(e<0||e>1)return n.I9.Zero();const t=e*this.length();let i=0;for(let e=0;e<this._points.length;e++){const s=(e+1)%this._points.length,r=this._points[e],o=this._points[s].subtract(r),a=o.length()+i;if(t>=i&&t<=a){const e=o.normalize(),s=t-i;return new n.I9(r.x+e.x*s,r.y+e.y*s)}i=a}return n.I9.Zero()}static StartingAt(e,t){return new c(e,t)}}class u{constructor(e,t=null,i,s=!1){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:n.Pq.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:n.uq.Identity()};for(let t=0;t<e.length;t++)this._curve[t]=e[t].clone();this._raw=i||!1,this._alignTangentsWithPath=s,this._compute(t,s)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(e){return this._updatePointAtData(e).point}getTangentAt(e,t=!1){return this._updatePointAtData(e,t),t?n.Pq.TransformCoordinates(n.Pq.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(e,t=!1){return this._updatePointAtData(e,t),t?n.Pq.TransformCoordinates(n.Pq.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(e,t=!1){return this._updatePointAtData(e,t),t?n.Pq.TransformCoordinates(n.Pq.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(e){return this.length()*e}getPreviousPointIndexAt(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex}getSubPositionAt(e){return this._updatePointAtData(e),this._pointAtData.subPosition}getClosestPositionTo(e){let t=Number.MAX_VALUE,i=0;for(let s=0;s<this._curve.length-1;s++){const r=this._curve[s+0],o=this._curve[s+1].subtract(r).normalize(),a=this._distances[s+1]-this._distances[s+0],h=Math.min(Math.max(n.Pq.Dot(o,e.subtract(r).normalize()),0)*n.Pq.Distance(r,e)/a,1),l=n.Pq.Distance(r.add(o.scale(h*a)),e);l<t&&(t=l,i=(this._distances[s+0]+a*h)/this.length())}return i}slice(e=0,t=1){if(e<0&&(e=1- -1*e%1),t<0&&(t=1- -1*t%1),e>t){const i=e;e=t,t=i}const i=this.getCurve(),s=this.getPointAt(e);let r=this.getPreviousPointIndexAt(e);const n=this.getPointAt(t),o=this.getPreviousPointIndexAt(t)+1,a=[];return 0!==e&&(r++,a.push(s)),a.push(...i.slice(r,o)),1===t&&1!==e||a.push(n),new u(a,this.getNormalAt(e),this._raw,this._alignTangentsWithPath)}update(e,t=null,i=!1){for(let t=0;t<e.length;t++)this._curve[t].x=e[t].x,this._curve[t].y=e[t].y,this._curve[t].z=e[t].z;return this._compute(t,i),this}_compute(e,t=!1){const i=this._curve.length;if(i<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();const s=this._tangents[0],r=this._normalVector(s,e);let o,a,h,l,c;this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=n.Pq.Cross(s,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let e=1;e<i;e++)o=this._getLastNonNullVector(e),e<i-1&&(a=this._getFirstNonNullVector(e),this._tangents[e]=t?a:o.add(a),this._tangents[e].normalize()),this._distances[e]=this._distances[e-1]+this._curve[e].subtract(this._curve[e-1]).length(),h=this._tangents[e],c=this._binormals[e-1],this._normals[e]=n.Pq.Cross(c,h),this._raw||(0===this._normals[e].length()?(l=this._normals[e-1],this._normals[e]=l.clone()):this._normals[e].normalize()),this._binormals[e]=n.Pq.Cross(h,this._normals[e]),this._raw||this._binormals[e].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(e){let t=1,i=this._curve[e+t].subtract(this._curve[e]);for(;0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i}_getLastNonNullVector(e){let t=1,i=this._curve[e].subtract(this._curve[e-t]);for(;0===i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i}_normalVector(e,t){let i,s=e.length();if(0===s&&(s=1),null==t){let t;t=(0,r.WithinEpsilon)(Math.abs(e.y)/s,1,o.bH)?(0,r.WithinEpsilon)(Math.abs(e.x)/s,1,o.bH)?(0,r.WithinEpsilon)(Math.abs(e.z)/s,1,o.bH)?n.Pq.Zero():new n.Pq(0,0,1):new n.Pq(1,0,0):new n.Pq(0,-1,0),i=n.Pq.Cross(e,t)}else i=n.Pq.Cross(e,t),n.Pq.CrossToRef(i,e,i);return i.normalize(),i}_updatePointAtData(e,t=!1){if(this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;const i=this.getPoints();if(e<=0)return this._setPointAtData(0,0,i[0],0,t);if(e>=1)return this._setPointAtData(1,1,i[i.length-1],i.length-1,t);let s,r=i[0],o=0;const a=e*this.length();for(let h=1;h<i.length;h++){s=i[h];const l=n.Pq.Distance(r,s);if(o+=l,o===a)return this._setPointAtData(e,1,s,h,t);if(o>a){const i=(o-a)/l,n=r.subtract(s),c=s.add(n.scaleInPlace(i));return this._setPointAtData(e,1-i,c,h-1,t)}r=s}return this._pointAtData}_setPointAtData(e,t,i,s,r){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=s,this._pointAtData.interpolateReady=r,r&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=n.uq.Identity();const e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){const t=e+1,i=this._tangents[e].clone(),s=this._normals[e].clone(),r=this._binormals[e].clone(),o=this._tangents[t].clone(),a=this._normals[t].clone(),h=this._binormals[t].clone(),l=n.PT.RotationQuaternionFromAxis(s,r,i),c=n.PT.RotationQuaternionFromAxis(a,h,o);n.PT.Slerp(l,c,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class d{static CreateQuadraticBezier(e,t,i,s){s=s>2?s:3;const r=[],o=(e,t,i,s)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*s;for(let a=0;a<=s;a++)r.push(new n.Pq(o(a/s,e.x,t.x,i.x),o(a/s,e.y,t.y,i.y),o(a/s,e.z,t.z,i.z)));return new d(r)}static CreateCubicBezier(e,t,i,s,r){r=r>3?r:4;const o=[],a=(e,t,i,s,r)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*s+e*e*e*r;for(let h=0;h<=r;h++)o.push(new n.Pq(a(h/r,e.x,t.x,i.x,s.x),a(h/r,e.y,t.y,i.y,s.y),a(h/r,e.z,t.z,i.z,s.z)));return new d(o)}static CreateHermiteSpline(e,t,i,s,r){const o=[],a=1/r;for(let h=0;h<=r;h++)o.push(n.Pq.Hermite(e,t,i,s,h*a));return new d(o)}static CreateCatmullRomSpline(e,t,i){const s=[],r=1/t;let o=0;if(i){const i=e.length;for(let a=0;a<i;a++){o=0;for(let h=0;h<t;h++)s.push(n.Pq.CatmullRom(e[a%i],e[(a+1)%i],e[(a+2)%i],e[(a+3)%i],o)),o+=r}s.push(s[0])}else{const i=[];i.push(e[0].clone()),Array.prototype.push.apply(i,e),i.push(e[e.length-1].clone());let a=0;for(;a<i.length-3;a++){o=0;for(let e=0;e<t;e++)s.push(n.Pq.CatmullRom(i[a],i[a+1],i[a+2],i[a+3],o)),o+=r}a--,s.push(n.Pq.CatmullRom(i[a],i[a+1],i[a+2],i[a+3],o))}return new d(s)}static ArcThru3Points(e,t,i,s=32,r=!1,o=!1){const a=[],h=t.subtract(e),l=i.subtract(t),c=e.subtract(i),u=n.Pq.Cross(h,l),_=u.length();if(_<Math.pow(10,-8))return new d(a);const p=h.lengthSquared(),g=l.lengthSquared(),f=c.lengthSquared(),m=u.lengthSquared(),b=.5*h.length()*l.length()*c.length()/_,v=-.5*g*n.Pq.Dot(h,c)/m,T=-.5*f*n.Pq.Dot(h,l)/m,y=-.5*p*n.Pq.Dot(l,c)/m,x=e.scale(v).add(t.scale(T)).add(i.scale(y)),A=e.subtract(x).normalize(),C=n.Pq.Cross(u,A).normalize();if(o){const t=2*Math.PI/s;for(let e=0;e<=2*Math.PI;e+=t)a.push(x.add(A.scale(b*Math.cos(e)).add(C.scale(b*Math.sin(e)))));a.push(e)}else{const t=1/s;let o=0,h=n.Pq.Zero();do{h=x.add(A.scale(b*Math.cos(o)).add(C.scale(b*Math.sin(o)))),a.push(h),o+=t}while(!h.equalsWithEpsilon(i,b*t*1.1));a.push(i),r&&a.push(e)}return new d(a)}constructor(e){this._length=0,this._points=e,this._length=this._computeLength(e)}getPoints(){return this._points}length(){return this._length}continue(e){const t=this._points[this._points.length-1],i=this._points.slice(),s=e.getPoints();for(let e=1;e<s.length;e++)i.push(s[e].subtract(s[0]).add(t));return new d(i)}_computeLength(e){let t=0;for(let i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t}}},3299:(e,t,i)=>{"use strict";i.d(t,{nO:()=>C,pB:()=>x,M0:()=>A,Iq:()=>I,J:()=>M});class s{constructor(){this.children=[]}isValid(e){return!0}process(e,t){let i="";if(this.line){let s=this.line;const r=t.processor;if(r){r.lineProcessor&&(s=r.lineProcessor(s,t.isFragment,t.processingContext));const i=t.processor?.attributeKeywordName??"attribute",n=t.isFragment&&t.processor?.varyingFragmentKeywordName?t.processor?.varyingFragmentKeywordName:!t.isFragment&&t.processor?.varyingVertexKeywordName?t.processor?.varyingVertexKeywordName:"varying";!t.isFragment&&r.attributeProcessor&&this.line.startsWith(i)?s=r.attributeProcessor(this.line,e,t.processingContext):r.varyingProcessor&&(r.varyingCheck?.(this.line,t.isFragment)||!r.varyingCheck&&this.line.startsWith(n))?s=r.varyingProcessor(this.line,t.isFragment,e,t.processingContext):r.uniformProcessor&&r.uniformRegexp&&r.uniformRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(s=r.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):r.uniformBufferProcessor&&r.uniformBufferRegexp&&r.uniformBufferRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(s=r.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0):r.textureProcessor&&r.textureRegexp&&r.textureRegexp.test(this.line)?s=r.textureProcessor(this.line,t.isFragment,e,t.processingContext):(r.uniformProcessor||r.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?r.uniformProcessor&&(s=r.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):r.uniformBufferProcessor&&(s=r.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)),t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,r.endOfUniformBufferProcessor&&(s=r.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}i+=s+"\n"}return this.children.forEach((s=>{i+=s.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),i}}class r{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){this._lines.length=0;for(const t of e){if(!t||"\r"===t)continue;if("#"===t[0]){this._lines.push(t);continue}const e=t.trim();if(!e)continue;if(e.startsWith("//")){this._lines.push(t);continue}const i=e.indexOf(";");if(-1===i)this._lines.push(e);else if(i===e.length-1)e.length>1&&this._lines.push(e);else{const e=t.split(";");for(let t=0;t<e.length;t++){let i=e[t];i&&(i=i.trim(),i&&this._lines.push(i+(t!==e.length-1?";":"")))}}}}}class n extends s{process(e,t){for(let i=0;i<this.children.length;i++){const s=this.children[i];if(s.isValid(e))return s.process(e,t)}return""}}class o extends s{isValid(e){return this.testExpression.isTrue(e)}}class a{isTrue(e){return!0}static postfixToInfix(e){const t=[];for(const i of e)if(void 0===a._OperatorPriority[i])t.push(i);else{const e=t[t.length-1],s=t[t.length-2];t.length-=2,t.push(`(${s}${i}${e})`)}return t[t.length-1]}static infixToPostfix(e){const t=a._InfixToPostfixCache.get(e);if(t)return t.accessTime=Date.now(),t.result;if(!(e.includes("&&")||e.includes("||")||e.includes(")")||e.includes("(")))return[e];const i=[];let s=-1;const r=()=>{c=c.trim(),""!==c&&(i.push(c),c="")},n=e=>{s<a._Stack.length-1&&(a._Stack[++s]=e)},o=()=>a._Stack[s],h=()=>-1===s?"!!INVALID EXPRESSION!!":a._Stack[s--];let l=0,c="";for(;l<e.length;){const t=e.charAt(l),u=l<e.length-1?e.substring(l,2+l):"";if("("===t)c="",n(t);else if(")"===t){for(r();-1!==s&&"("!==o();)i.push(h());h()}else if(a._OperatorPriority[u]>1){for(r();-1!==s&&a._OperatorPriority[o()]>=a._OperatorPriority[u];)i.push(h());n(u),l++}else c+=t;l++}for(r();-1!==s;)"("===o()?h():i.push(h());return a._InfixToPostfixCache.size>=a.InfixToPostfixCacheLimitSize&&a.ClearCache(),a._InfixToPostfixCache.set(e,{result:i,accessTime:Date.now()}),i}static ClearCache(){const e=Array.from(a._InfixToPostfixCache.entries()).sort(((e,t)=>e[1].accessTime-t[1].accessTime));for(let t=0;t<a.InfixToPostfixCacheCleanupSize;t++)a._InfixToPostfixCache.delete(e[t][0])}}a.InfixToPostfixCacheLimitSize=5e4,a.InfixToPostfixCacheCleanupSize=25e3,a._InfixToPostfixCache=new Map,a._OperatorPriority={")":0,"(":1,"||":2,"&&":3},a._Stack=["","","","","","","","","","","","","","","","","","","",""];class h extends a{constructor(e,t=!1){super(),this.define=e,this.not=t}isTrue(e){let t=void 0!==e[this.define];return this.not&&(t=!t),t}}class l extends a{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}class c extends a{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}class u extends a{constructor(e,t,i){super(),this.define=e,this.operand=t,this.testValue=i}isTrue(e){let t=e[this.define];void 0===t&&(t=this.define);let i=!1;const s=parseInt(t),r=parseInt(this.testValue);switch(this.operand){case">":i=s>r;break;case"<":i=s<r;break;case"<=":i=s<=r;break;case">=":i=s>=r;break;case"==":i=s===r;break;case"!=":i=s!==r}return i}}var d=i(2213),_=i(8615);const p=/defined\s*?\((.+?)\)/g,g=/defined\s*?\[(.+?)\]/g,f=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,m=/__decl__/,b=/light\{X\}.(\w*)/g,v=/\{X\}/g,T=[],y=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function x(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function A(e,t,i,n){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),I(e,t,(e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines));const o=function(e,t,i){let n=function(e,t){if(t.processor?.noPrecision)return e;const i=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e}(e,t);if(!t.processor)return n;if(0===t.processor.shaderLanguage&&-1!==n.indexOf("#version 3")&&(n=n.replace("#version 300 es",""),!t.processor.parseGLES3))return n;const o=t.defines,a=function(e,t){const i=e.defines,s={};for(const e of i){const t=e.replace("#define","").replace(";","").trim().split(" ");s[t[0]]=t.length>1?t[1]:""}return 0===e.processor?.shaderLanguage&&(s.GL_ES="true"),s.__VERSION__=e.version,s[e.platformName]="true",(0,_.xt)(s,t?.isNDCHalfZRange,t?.useReverseDepthBuffer,t?.useExactSrgbConversions),s}(t,i);return t.processor.preProcessor&&(n=t.processor.preProcessor(n,o,a,t.isFragment,t.processingContext)),n=function(e,t,i){const n=new s,o=new r;return o.lineIndex=-1,o.lines=e.split("\n"),P(o,n),n.process(t,i)}(n,a,t),t.processor.postProcessor&&(n=t.processor.postProcessor(n,o,t.isFragment,t.processingContext,i?{drawBuffersExtensionDisabled:!i.getCaps().drawBuffersExtension}:{})),i?._features.needShaderCodeInlining&&(n=i.inlineShaderCode(n)),n}(e,t,n);i(o,e)}))}function C(e,t,i){return i.processor&&i.processor.finalizeShaders?i.processor.finalizeShaders(e,t,i.processingContext):{vertexCode:e,fragmentCode:t}}function S(e){const t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new h(t[1].trim(),"!"===e[0]);const i=["==","!=",">=","<=","<",">"];let s="",r=0;for(s of i)if(r=e.indexOf(s),r>-1)break;if(-1===r)return new h(e);const n=e.substring(0,r).trim(),o=e.substring(r+s.length).trim();return new u(n,s,o)}function E(e,t){const i=new o,s=e.substring(0,t);let r=e.substring(t);return r=r.substring(0,(r.indexOf("//")+1||r.length+1)-1).trim(),i.testExpression="#ifdef"===s?new h(r):"#ifndef"===s?new h(r,!0):function(e){e=e.replace(p,"defined[$1]");const t=a.infixToPostfix(e),i=[];for(const e of t)if("||"!==e&&"&&"!==e)i.push(e);else if(i.length>=2){let t=i[i.length-1],s=i[i.length-2];i.length-=2;const r="&&"==e?new c:new l;"string"==typeof t&&(t=t.replace(g,"defined($1)")),"string"==typeof s&&(s=s.replace(g,"defined($1)")),r.leftOperand="string"==typeof s?S(s):s,r.rightOperand="string"==typeof t?S(t):t,i.push(r)}let s=i[i.length-1];return"string"==typeof s&&(s=s.replace(g,"defined($1)")),"string"==typeof s?S(s):s}(r),i}function R(e,t,i){let r=e.currentLine;for(;P(e,i);){r=e.currentLine;const n=r.substring(0,5).toLowerCase();if("#else"===n){const i=new s;return t.children.push(i),void P(e,i)}if("#elif"===n){const e=E(r,5);t.children.push(e),i=e}}}function P(e,t){for(;e.canRead;){e.lineIndex++;const i=e.currentLine;if(i.indexOf("#")>=0){const s=y.exec(i);if(s&&s.length){switch(s[0]){case"#ifdef":{const s=new n;t.children.push(s);const r=E(i,6);s.children.push(r),R(e,s,r);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const s=new n;t.children.push(s);const r=E(i,7);s.children.push(r),R(e,s,r);break}case"#if":{const s=new n,r=E(i,3);t.children.push(s),s.children.push(r),R(e,s,r);break}}continue}}const r=new s;if(r.line=i,t.children.push(r),"#"===i[0]&&"d"===i[1]){const e=i.replace(";","").split(" ");r.additionalDefineKey=e[1],3===e.length&&(r.additionalDefineValue=e[2])}}return!1}function I(e,t,i){let s;for(T.length=0;null!==(s=f.exec(e));)T.push(s);let r=String(e),n=[e],o=!1;for(const e of T){let s=e[1];if(-1!==s.indexOf("__decl__")&&(s=s.replace(m,""),t.supportsUniformBuffers&&(s=s.replace("Vertex","Ubo").replace("Fragment","Ubo")),s+="Declaration"),!t.includesShadersStore[s]){const e=t.shadersRepository+"ShadersInclude/"+s+".fx";return void M.loadFile(e,(e=>{t.includesShadersStore[s]=e,I(n.join(""),t,i)}))}{let i=t.includesShadersStore[s];if(e[2]){const t=e[3].split(",");for(let e=0;e<t.length;e+=2){const s=new RegExp(t[e],"g"),r=t[e+1];i=i.replace(s,r)}}if(e[4]){const s=e[5];if(-1!==s.indexOf("..")){const e=s.split(".."),r=parseInt(e[0]);let n=parseInt(e[1]),o=i.slice(0);i="",isNaN(n)&&(n=t.indexParameters[e[1]]);for(let e=r;e<n;e++)t.supportsUniformBuffers||(o=o.replace(b,((e,t)=>t+"{X}"))),i+=o.replace(v,e.toString())+"\n"}else t.supportsUniformBuffers||(i=i.replace(b,((e,t)=>t+"{X}"))),i=i.replace(v,s)}const r=[];for(const t of n){const s=t.split(e[0]);for(let e=0;e<s.length-1;e++)r.push(s[e]),r.push(i);r.push(s[s.length-1])}n=r,o=o||i.indexOf("#include<")>=0||i.indexOf("#include <")>=0}}T.length=0,r=n.join(""),o?I(r.toString(),t,i):i(r)}const M={loadFile:(e,t,i,s,r,n)=>{throw(0,d.n)("FileTools")}}},3405:(e,t,i)=>{"use strict";i.d(t,{I:()=>s});class s{static SetMatrixPrecision(e){if(s.MatrixTrackPrecisionChange=!1,e&&!s.MatrixUse64Bits&&s.MatrixTrackedMatrices)for(let e=0;e<s.MatrixTrackedMatrices.length;++e){const t=s.MatrixTrackedMatrices[e],i=t._m;t._m=new Array(16);for(let e=0;e<16;++e)t._m[e]=i[e]}s.MatrixUse64Bits=e,s.MatrixCurrentType=s.MatrixUse64Bits?Array:Float32Array,s.MatrixTrackedMatrices=null}}s.MatrixUse64Bits=!1,s.MatrixTrackPrecisionChange=!0,s.MatrixCurrentType=Float32Array,s.MatrixTrackedMatrices=[]},3550:(e,t,i)=>{"use strict";i.d(t,{p:()=>d});var s=i(4754),r=i(4537),n=i(3054),o=i(451),a=i(979);function h(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}class l{constructor(){this._dirty=!0,this._tempColor=new o.ov(0,0,0,0),this._globalCurve=new o.ov(0,0,0,0),this._highlightsCurve=new o.ov(0,0,0,0),this._midtonesCurve=new o.ov(0,0,0,0),this._shadowsCurve=new o.ov(0,0,0,0),this._positiveCurve=new o.ov(0,0,0,0),this._negativeCurve=new o.ov(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(e){this._globalHue=e,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(e){this._globalDensity=e,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(e){this._globalSaturation=e,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(e){this._globalExposure=e,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(e){this._highlightsHue=e,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(e){this._highlightsDensity=e,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(e){this._highlightsSaturation=e,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(e){this._highlightsExposure=e,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(e){this._midtonesHue=e,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(e){this._midtonesDensity=e,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(e){this._midtonesSaturation=e,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(e){this._midtonesExposure=e,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(e){this._shadowsHue=e,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(e){this._shadowsDensity=e,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(e){this._shadowsSaturation=e,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(e){this._shadowsExposure=e,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(e,t,i="vCameraColorCurvePositive",s="vCameraColorCurveNeutral",r="vCameraColorCurveNegative"){e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(s,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(r,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))}_getColorGradingDataToRef(e,t,i,s,r){null!=e&&(e=l._Clamp(e,0,360),t=l._Clamp(t,-100,100),i=l._Clamp(i,-100,100),s=l._Clamp(s,-100,100),t=l._ApplyColorGradingSliderNonlinear(t),t*=.5,s=l._ApplyColorGradingSliderNonlinear(s),t<0&&(t*=-1,e=(e+180)%360),l._FromHSBToRef(e,t,50+.25*s,r),r.scaleToRef(2,r),r.a=1+.01*i)}static _ApplyColorGradingSliderNonlinear(e){e/=100;let t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100,t}static _FromHSBToRef(e,t,i,s){let r=l._Clamp(e,0,360);const n=l._Clamp(t/100,0,1),o=l._Clamp(i/100,0,1);if(0===n)s.r=o,s.g=o,s.b=o;else{r/=60;const e=Math.floor(r),t=r-e,i=o*(1-n),a=o*(1-n*t),h=o*(1-n*(1-t));switch(e){case 0:s.r=o,s.g=h,s.b=i;break;case 1:s.r=a,s.g=o,s.b=i;break;case 2:s.r=i,s.g=o,s.b=h;break;case 3:s.r=i,s.g=a,s.b=o;break;case 4:s.r=h,s.g=i,s.b=o;break;default:s.r=o,s.g=i,s.b=a}}s.a=1}static _Clamp(e,t,i){return Math.min(Math.max(e,t),i)}clone(){return a.p.Clone((()=>new l),this)}serialize(){return a.p.Serialize(this)}static Parse(e){return a.p.Parse((()=>new l),e,null,null)}}l.PrepareUniforms=h,(0,s.Cg)([(0,r.lK)()],l.prototype,"_globalHue",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_globalDensity",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_globalSaturation",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_globalExposure",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_highlightsHue",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_highlightsDensity",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_highlightsSaturation",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_highlightsExposure",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_midtonesHue",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_midtonesDensity",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_midtonesSaturation",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"_midtonesExposure",void 0),a.p._ColorCurvesParser=l.Parse;var c=i(1663),u=i(5686);class d{constructor(){this.colorCurves=new l,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=d.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new o.ov(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=d.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new n.cP}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())}get exposure(){return this._exposure}set exposure(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())}get contrast(){return this._contrast}set contrast(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(e){this.vignetteCenterY=e}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(e){this.vignetteCenterX=e}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(e){this._ditheringIntensity!==e&&(this._ditheringIntensity=e,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(e,t=!1){if(t!==this.applyByPostProcess||!this._isEnabled)return e.VIGNETTE=!1,e.TONEMAPPING=0,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.DITHER=!1,e.IMAGEPROCESSING=!1,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===d._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case d.TONEMAPPING_KHR_PBR_NEUTRAL:e.TONEMAPPING=3;break;case d.TONEMAPPING_ACES:e.TONEMAPPING=2;break;default:e.TONEMAPPING=1}else e.TONEMAPPING=0;e.CONTRAST=1!==this.contrast,e.EXPOSURE=1!==this.exposure,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.DITHER=this._ditheringEnabled,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSING=e.VIGNETTE||!!e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING||e.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&l.Bind(this.colorCurves,e),this._vignetteEnabled||this._ditheringEnabled){const i=1/e.getEngine().getRenderWidth(),s=1/e.getEngine().getRenderHeight();if(e.setFloat2("vInverseScreenSize",i,s),this._ditheringEnabled&&e.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const r=null!=t?t:s/i;let n=Math.tan(.5*this.vignetteCameraFov),o=n*r;const a=Math.sqrt(o*n);o=(0,c.zF)(o,a,this.vignetteStretch),n=(0,c.zF)(n,a,this.vignetteStretch),e.setFloat4("vignetteSettings1",o,n,-o*this.vignetteCenterX,-n*this.vignetteCenterY);const h=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)}}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);const t=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(t-1)/t,.5/t,t,this.colorGradingTexture.level)}}clone(){return a.p.Clone((()=>new d),this)}serialize(){return a.p.Serialize(this)}static Parse(e){const t=a.p.Parse((()=>new d),e,null,null);return void 0!==e.vignetteCentreX&&(t.vignetteCenterX=e.vignetteCentreX),void 0!==e.vignetteCentreY&&(t.vignetteCenterY=e.vignetteCentreY),t}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}d.TONEMAPPING_STANDARD=0,d.TONEMAPPING_ACES=1,d.TONEMAPPING_KHR_PBR_NEUTRAL=2,d.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),(t.VIGNETTE||t.DITHER)&&e.push("vInverseScreenSize"),t.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&h(e),t.DITHER&&e.push("ditherIntensity")},d.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},d._VIGNETTEMODE_MULTIPLY=0,d._VIGNETTEMODE_OPAQUE=1,(0,s.Cg)([(0,r.wL)()],d.prototype,"colorCurves",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_colorCurvesEnabled",void 0),(0,s.Cg)([(0,r.uM)("colorGradingTexture")],d.prototype,"_colorGradingTexture",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_colorGradingEnabled",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_colorGradingWithGreenDepth",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_colorGradingBGR",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_exposure",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_toneMappingEnabled",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_toneMappingType",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_contrast",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"vignetteStretch",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"vignetteCenterX",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"vignetteCenterY",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"vignetteWeight",void 0),(0,s.Cg)([(0,r.qK)()],d.prototype,"vignetteColor",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"vignetteCameraFov",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_vignetteBlendMode",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_vignetteEnabled",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_ditheringEnabled",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_ditheringIntensity",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_skipFinalColorClamp",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_applyByPostProcess",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"_isEnabled",void 0),a.p._ImageProcessingConfigurationParser=d.Parse,(0,u.Y5)("BABYLON.ImageProcessingConfiguration",d)},3564:(e,t,i)=>{"use strict";i.d(t,{c:()=>u});var s=i(4754),r=i(4564),n=i(4537),o=i(879),a=i(2596),h=i(1243),l=i(5241);class c extends a.M{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class u extends h.y{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,t=!0){super(e,"DetailMap",140,new c,t),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=r.i.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t,i){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&i.getCaps().standardDerivatives&&this._texture&&o.h.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const i=t.getEngine();e._areTexturesDirty&&(i.getCaps().standardDerivatives&&this._texture&&o.h.DetailTextureEnabled&&this._isEnabled?((0,l.YT)(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||this._texture&&o.h.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,l.mA)(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&o.h.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){e&&this._texture?.dispose()}getClassName(){return"DetailMapConfiguration"}getSamplers(e){e.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,s.Cg)([(0,n.uM)("detailTexture"),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"texture",void 0),(0,s.Cg)([(0,n.lK)()],u.prototype,"diffuseBlendLevel",void 0),(0,s.Cg)([(0,n.lK)()],u.prototype,"roughnessBlendLevel",void 0),(0,s.Cg)([(0,n.lK)()],u.prototype,"bumpLevel",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"normalBlendMethod",void 0),(0,s.Cg)([(0,n.lK)(),(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isEnabled",void 0)},3575:(e,t,i)=>{"use strict";var s=i(8527),r=i(1711),n=function(e,t,i){for(var s,r=e;null!=(s=r.next);r=s)if(s.key===t)return r.next=s.next,i||(s.next=e.next,e.next=s),s};e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new r("Side channel does not contain "+s(e))},delete:function(t){var i=e&&e.next,s=function(e,t){if(e)return n(e,t,!0)}(e,t);return s&&i&&i===s&&(e=void 0),!!s},get:function(t){return function(e,t){if(e){var i=n(e,t);return i&&i.value}}(e,t)},has:function(t){return function(e,t){return!!e&&!!n(e,t)}(e,t)},set:function(t,i){e||(e={next:void 0}),function(e,t,i){var s=n(e,t);s?s.value=i:e.next={key:t,next:e.next,value:i}}(e,t,i)}};return t}},3600:(e,t,i)=>{"use strict";i.d(t,{$:()=>_});var s=i(3054),r=i(4049),n=i(35),o=i(8442),a=i(1663),h=i(2450),l=i(3039),c=i(117),u=i(959);class d{get renderList(){return this._renderList}set renderList(e){this._renderList!==e&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),e&&(this._unObserveRenderList=(0,u.lL)(e,this._renderListHasChanged)),this._renderList=e)}get name(){return this._name}set name(e){if(this._name===e)return;if(this._name=e,!this._scene)return;const t=this._scene.getEngine();for(let e=0;e<this._renderPassIds.length;++e){const i=this._renderPassIds[e];t._renderPassNames[i]=`${this._name}#${e}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(e,t){let i;i=Array.isArray(e)?e:[e];for(let e=0;e<i.length;++e)for(let s=0;s<this.options.numPasses;++s)i[e].setMaterialForRenderPass(this._renderPassIds[s],void 0!==t?Array.isArray(t)?t[s]:t:void 0)}constructor(e,t,i){this._unObserveRenderList=null,this._renderListHasChanged=(e,t)=>{const i=this._renderList?this._renderList.length:0;(0===t&&i>0||0===i)&&this._scene.meshes.forEach((e=>{e._markSubMeshesAsLightDirty()}))},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.onBeforeRenderObservable=new s.cP,this.onAfterRenderObservable=new s.cP,this.onBeforeRenderingManagerRenderObservable=new s.cP,this.onAfterRenderingManagerRenderObservable=new s.cP,this.onFastPathRenderObservable=new s.cP,this._currentRefreshId=-1,this._refreshRate=1,this._currentSceneCamera=null,this.name=e,this._scene=t,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...i},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new c.m(t),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const e=this._scene.getEngine();for(let t=0;t<this.options.numPasses;++t)e.releaseRenderPassId(this._renderPassIds[t]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const e=this._scene.getEngine();for(let t=0;t<this.options.numPasses;++t)this._renderPassIds[t]=e.createRenderPassId(`${this.name}#${t}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(e,t){this.prepareRenderList(),this.initRender(e,t);const i=this._checkReadiness();return this.finishRender(),i}prepareRenderList(){const e=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let t=0;t<this._waitingRenderList.length;t++){const i=this._waitingRenderList[t],s=e.getMeshById(i);s&&this.renderList.push(s)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const e=this._scene.meshes;for(let t=0;t<e.length;t++){const i=e[t];this.renderListPredicate(i)&&this.renderList.push(i)}}}initRender(e,t){const i=this._scene.getEngine(),s=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,s&&(s!==this._scene.activeCamera&&(this._scene.setTransformMatrix(s.getViewMatrix(),s.getProjectionMatrix(!0)),this._scene.activeCamera=s),i.setViewport(s.rigParent?s.rigParent.viewport:s.viewport,e,t)),this._defaultRenderListPrepared=!1}finishRender(){const e=this._scene;e.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==e.activeCamera&&e.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),e.getEngine().setViewport(this._currentSceneCamera.viewport)),e.resetCachedMaterial()}render(e=0,t=!1){const i=this._scene,s=i.getEngine(),r=s.currentRenderPassId;if(s.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e),s.snapshotRendering&&1===s.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(e);else{let t=null;const s=this.renderList?this.renderList:i.getActiveMeshes().data,r=this.renderList?this.renderList.length:i.getActiveMeshes().length;this.getCustomRenderList&&(t=this.getCustomRenderList(e,s,r)),t?this._prepareRenderingManager(t,t.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(s,r,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),t=s),this.onBeforeRenderingManagerRenderObservable.notifyObservers(e),this._renderingManager.render(this.customRenderFunction,t,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(e)}t||this.onAfterRenderObservable.notifyObservers(e),s.currentRenderPassId=r}_checkReadiness(){const e=this._scene,t=e.getEngine(),i=t.currentRenderPassId;let s=!0;e.getViewMatrix()||e.updateTransformMatrix();const r=this.options.numPasses;for(let i=0;i<r&&s;i++){let n=null;const o=this.renderList?this.renderList:e.getActiveMeshes().data,a=this.renderList?this.renderList.length:e.getActiveMeshes().length;t.currentRenderPassId=this._renderPassIds[i],this.onBeforeRenderObservable.notifyObservers(i),this.getCustomRenderList&&(n=this.getCustomRenderList(i,o,a)),n||(n=o),this.options.doNotChangeAspectRatio||e.updateTransformMatrix(!0);for(let e=0;e<n.length&&s;++e){const t=n[e];if(t.isEnabled()&&!t.isBlocked&&t.isVisible&&t.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(t,this.refreshRate,!0)){s=!1;continue}}else if(!t.isReady(!0)){s=!1;continue}}this.onAfterRenderObservable.notifyObservers(i),r>1&&(e.incrementRenderId(),e.resetCachedMaterial())}const n=this.particleSystemList||e.particleSystems;for(const e of n)e.isReady()||(s=!1);return t.currentRenderPassId=i,s}_prepareRenderingManager(e,t,i){const s=this._scene,r=s.activeCamera,n=this.cameraForLOD??r;this._renderingManager.reset();const o=s.getRenderId(),a=s.getFrameId();for(let h=0;h<t;h++){const t=e[h];if(t&&!t.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(t,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!t.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let e,h=null;if(n){const e=t._internalAbstractMeshDataInfo._currentLOD.get(n);e&&e[1]===a?h=e[0]:(h=s.customLODSelector?s.customLODSelector(t,n):t.getLOD(n),e?(e[0]=h,e[1]=a):t._internalAbstractMeshDataInfo._currentLOD.set(n,[h,a]))}else h=t;if(!h)continue;if(h!==t&&0!==h.billboardMode&&h.computeWorldMatrix(),h._preActivateForIntermediateRendering(o),e=!(!i||!r||t.layerMask&r.layerMask),t.isEnabled()&&t.isVisible&&t.subMeshes&&!e){if(h!==t&&h._activate(o,!0),t._activate(o,!0)&&t.subMeshes.length){t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(h=t):h._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,h._internalAbstractMeshDataInfo._isActiveIntermediate=!0,s._prepareSkeleton(h);for(let e=0;e<h.subMeshes.length;e++){const t=h.subMeshes[e];this._renderingManager.dispatch(t,h)}}t._postActivate()}}}const h=this.particleSystemList||s.particleSystems;for(let e=0;e<h.length;e++){const t=h[e],i=t.emitter;t.isStarted()&&i&&(!i.position||i.isEnabled())&&this._renderingManager.dispatchParticles(t)}}setRenderingOrder(e,t=null,i=null,s=null){this._renderingManager.setRenderingOrder(e,t,i,s)}setRenderingAutoClearDepthStencil(e,t,i=!0,s=!0){this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,s),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const e=new d(this.name,this._scene,this.options);return this.renderList&&(e.renderList=this.renderList.slice(0)),e}dispose(){const e=this.renderList?this.renderList:this._scene.getActiveMeshes().data,t=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let i=0;i<t;i++){const t=e[i];void 0!==t.getMaterialForRenderPass(this.renderPassId)&&t.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===d.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=d.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}d.REFRESHRATE_RENDER_ONCE=0,d.REFRESHRATE_RENDER_ONEVERYFRAME=1,d.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,h.M.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)};class _ extends n.g{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(e){this._objectRenderer.renderListPredicate=e}get renderList(){return this._objectRenderer.renderList}set renderList(e){this._objectRenderer.renderList=e}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(e){this._objectRenderer.particleSystemList=e}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(e){this._objectRenderer.getCustomRenderList=e}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(e){this._objectRenderer.renderParticles=e}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(e){this._objectRenderer.renderSprites=e}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(e){this._objectRenderer.forceLayerMaskCheck=e}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(e){this._objectRenderer.activeCamera=e}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(e){this._objectRenderer.cameraForLOD=e}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(e){this._objectRenderer.customIsReadyFunction=e}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(e){this._objectRenderer.customRenderFunction=e}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(e){this._objectRenderer._waitingRenderList=e}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(e,t){this._objectRenderer.setMaterialForRendering(e,t)}get isMulti(){return this._renderTarget?.isMulti??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){return this._renderTarget?._depthStencilTexture??null}constructor(e,t,i,o=!1,a=!0,h=0,c=!1,u=n.g.TRILINEAR_SAMPLINGMODE,_=!0,p=!1,g=!1,f=5,m=!1,b,v,T=!1,y=!1){let x,A,C=!0;if("object"==typeof o){const e=o;o=!!e.generateMipMaps,a=e.doNotChangeAspectRatio??!0,h=e.type??0,c=!!e.isCube,u=e.samplingMode??n.g.TRILINEAR_SAMPLINGMODE,_=e.generateDepthBuffer??!0,p=!!e.generateStencilBuffer,g=!!e.isMulti,f=e.format??5,m=!!e.delayAllocation,b=e.samples,v=e.creationFlags,T=!!e.noColorAttachment,y=!!e.useSRGBBuffer,x=e.colorAttachment,C=e.gammaSpace??C,A=e.existingObjectRenderer}if(super(null,i,!o,void 0,u,void 0,void 0,void 0,void 0,f),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new s.cP,this.onAfterUnbindObservable=new s.cP,this.onClearObservable=new s.cP,this.onResizeObservable=new s.cP,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=r.Pq.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(i=this.getScene()))return;const S=this.getScene().getEngine();this._gammaSpace=C,this._coordinatesMode=n.g.PROJECTION_MODE,this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._dontDisposeObjectRenderer=!!A,this._processSizeParameter(t),this._objectRenderer=A??new d(e,i,{numPasses:c?6:this.getRenderLayers()||1,doNotChangeAspectRatio:a}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const e of this._scene._beforeRenderTargetClearStage)e.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(S):this.skipInitialClear||S.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const e of this._scene._beforeRenderTargetDrawStage)e.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const e of this._scene._afterRenderTargetDrawStage)e.action(this,this._currentFaceIndex,this._currentLayer);const e=this._texture?.generateMipMaps??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const e of this._scene._afterRenderTargetPostProcessStage)e.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=e),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),S):l.V.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(S):this.skipInitialClear||S.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=S.onResizeObservable.add((()=>{})),this._generateMipMaps=!!o,this._doNotChangeAspectRatio=a,g||(this._renderTargetOptions={generateMipMaps:o,type:h,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:_,generateStencilBuffer:p,samples:b,creationFlags:v,noColorAttachment:T,useSRGBBuffer:y,colorAttachment:x,label:this.name},this.samplingMode===n.g.NEAREST_SAMPLINGMODE&&(this.wrapU=n.g.CLAMP_ADDRESSMODE,this.wrapV=n.g.CLAMP_ADDRESSMODE),m||(c?(this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=n.g.INVCUBIC_MODE,this._textureMatrix=r.uq.Identity()):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==b&&(this.samples=b)))}createDepthStencilTexture(e=0,t=!0,i=!1,s=1,r=14,n){this._renderTarget?.createDepthStencilTexture(e,t,i,s,r,n)}_processSizeParameter(e){if(e.ratio){this._sizeRatio=e.ratio;const t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e}get samples(){return this._renderTarget?.samples??this._samples}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}addPostProcess(e){if(!this._postProcessManager){const e=this.getScene();if(!e)return;this._postProcessManager=new o.X(e),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}clearPostProcesses(e=!1){if(this._postProcesses){if(e)for(const e of this._postProcesses)e.dispose();this._postProcesses=[]}}removePostProcess(e){if(!this._postProcesses)return;const t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(e){this._objectRenderer.refreshRate=e}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const e=this._size.layers;if(e)return e;return this._size.depth||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(e){const t=Math.max(1,this.getRenderSize()*e);this.resize(t)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(e){const t=this.isCube;this._renderTarget?.dispose(),this._renderTarget=null;const i=this.getScene();i&&(this._processSizeParameter(e),this._renderTarget=t?i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(e=!1,t=!1){this._render(e,t)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(i.bind(i,4054)).then((e=>this._dumpTools=e))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const e=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),e}_render(e=!1,t=!1){const i=this.getScene();if(i){if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let s=0;s<6;s++)this._renderToTarget(s,e,t),i.incrementRenderId(),i.resetCachedMaterial();else this._renderToTarget(0,e,t);else for(let s=0;s<this.getRenderLayers();s++)this._renderToTarget(0,e,t,s),i.incrementRenderId(),i.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(e,t){const i=e*t,s=(0,a.OG)(i+16384/(128+i));return Math.min((0,a.C4)(e),s)}_bindFrameBuffer(e=0,t=0){const i=this.getScene();if(!i)return;const s=i.getEngine();this._renderTarget&&s.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(t)}))}_prepareFrame(e,t,i,s){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):s&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,i)}_renderToTarget(e,t,i,s=0){const r=this.getScene();if(!r)return;const n=r.getEngine();this._currentFaceIndex=e,this._currentLayer=s,this._currentUseCameraPostProcess=t,this._currentDumpForDebug=i,this._prepareFrame(r,e,s,t),n._debugPushGroup?.(`render to face #${e} layer #${s}`,2),this._objectRenderer.render(e+s,!0),n._debugPopGroup?.(2),this._unbindFrameBuffer(n,e),this._texture&&this.isCube&&5===e&&n.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(e,t=null,i=null,s=null){this._objectRenderer.setRenderingOrder(e,t,i,s)}setRenderingAutoClearDepthStencil(e,t){this._objectRenderer.setRenderingAutoClearDepthStencil(e,t)}clone(){const e=this.getSize(),t=new _(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t}serialize(){if(!this.name)return null;const e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(let t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e}disposeFramebufferObjects(){this._renderTarget?.dispose(!0)}releaseInternalTexture(){this._renderTarget?.releaseTextures(),this._texture=null}dispose(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const e=this.getScene();if(!e)return;let t=e.customRenderTargets.indexOf(this);t>=0&&e.customRenderTargets.splice(t,1);for(const i of e.cameras)t=i.customRenderTargets.indexOf(this),t>=0&&i.customRenderTargets.splice(t,1);this._renderTarget?.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}_.REFRESHRATE_RENDER_ONCE=d.REFRESHRATE_RENDER_ONCE,_.REFRESHRATE_RENDER_ONEVERYFRAME=d.REFRESHRATE_RENDER_ONEVERYFRAME,_.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=d.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,n.g._CreateRenderTargetTexture=(e,t,i,s,r)=>new _(e,t,i,s)},3700:e=>{"use strict";e.exports=Math.floor},3736:(e,t,i)=>{"use strict";i.d(t,{G:()=>n});var s=i(4245),r=i(1498);class n{static ExpandRGBDTexture(e){const t=e._texture;if(!t||!e.isRGBD)return;const r=t.getEngine(),n=r.getCaps(),o=t.isReady;let a=!1;n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?(a=!0,t.type=2):n.textureFloatRender&&n.textureFloatLinearFiltering&&(a=!0,t.type=1),a&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);const h=async()=>{const n=r.isWebGPU,o=n?1:0;t.isReady=!1,n?await i.e(6441).then(i.bind(i,6441)):await i.e(7436).then(i.bind(i,7436));const a=new s.w("rgbdDecode","rgbdDecode",null,null,1,null,3,r,!1,void 0,t.type,void 0,null,!1,void 0,o);a.externalTextureSamplerBinding=!0;const h=r.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});a.onEffectCreatedObservable.addOnce((i=>{i.executeWhenCompiled((()=>{a.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},e.getScene().postProcessManager.directRender([a],h,!0),r.restoreDefaultFramebuffer(),r._releaseTexture(t),a&&a.dispose(),h._swapAndDie(t),t.isReady=!0}))}))};a&&(o?h():e.onLoadObservable.addOnce(h))}static async EncodeTextureToRGBD(e,t,s=0){return t.getEngine().isWebGPU?await i.e(357).then(i.bind(i,357)):await i.e(7332).then(i.bind(i,7332)),(0,r.Qs)("rgbdEncode",e,t,s,1,5)}}},3785:(e,t,i)=>{"use strict";var s=i(9176),r=i(766),n=i(4049),o=i(3039),a=i(1717);s.e.prototype.thinInstanceAdd=function(e,t=!0){if(!this.getScene().getEngine().getCaps().instancedArrays)return o.V.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(e)?e.length:1);const i=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(e))for(let i=0;i<e.length;++i)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e[i],i===e.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e,t);return i},s.e.prototype.thinInstanceAddSelf=function(e=!0){return this.thinInstanceAdd(n.uq.IdentityReadOnly,e)},s.e.prototype.thinInstanceRegisterAttribute=function(e,t){e===r.R.ColorKind&&(e=r.R.ColorInstanceKind),this.removeVerticesData(e),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[e]=t,this._userThinInstanceBuffersStorage.sizes[e]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[e]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[e]),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new r.R(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])},s.e.prototype.thinInstanceSetMatrixAt=function(e,t,i=!0){if(!this._thinInstanceDataStorage.matrixData||e>=this._thinInstanceDataStorage.instancesCount)return!1;const s=this._thinInstanceDataStorage.matrixData;return t.copyToArray(s,16*e),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[e]=t),i&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},s.e.prototype.thinInstanceSetAttributeAt=function(e,t,i,s=!0){return e===r.R.ColorKind&&(e=r.R.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[e]||t>=this._thinInstanceDataStorage.instancesCount||(this._thinInstanceUpdateBufferSize(e,0),this._userThinInstanceBuffersStorage.data[e].set(i,t*this._userThinInstanceBuffersStorage.strides[e]),s&&this.thinInstanceBufferUpdated(e),0))},Object.defineProperty(s.e.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(e){const t=this._thinInstanceDataStorage.matrixData??this.source?._thinInstanceDataStorage.matrixData;e<=(t?t.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=e)},enumerable:!0,configurable:!0}),s.e.prototype._thinInstanceCreateMatrixBuffer=function(e,t,i=!0){const s=new r.h(this.getEngine(),t,!i,16,!1,!0);for(let t=0;t<4;t++)this.setVerticesBuffer(s.createVertexBuffer(e+t,4*t,4));return s},s.e.prototype.thinInstanceSetBuffer=function(e,t,i=0,s=!0){i=i||16,"matrix"===e?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*i,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,null!==t?(this._thinInstanceDataStorage.instancesCount=t.length/i,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",t,s),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):"previousMatrix"===e?(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=t,null!==t&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",t,s))):(e===r.R.ColorKind&&(e=r.R.ColorInstanceKind),null===t?this._userThinInstanceBuffersStorage?.data[e]&&(this.removeVerticesData(e),delete this._userThinInstanceBuffersStorage.data[e],delete this._userThinInstanceBuffersStorage.strides[e],delete this._userThinInstanceBuffersStorage.sizes[e],delete this._userThinInstanceBuffersStorage.vertexBuffers[e]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[e]=t,this._userThinInstanceBuffersStorage.strides[e]=i,this._userThinInstanceBuffersStorage.sizes[e]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new r.R(this.getEngine(),t,e,!s,!1,i,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])))},s.e.prototype.thinInstanceBufferUpdated=function(e){"matrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.matrixBuffer?.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount)):"previousMatrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.previousMatrixBuffer?.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)):(e===r.R.ColorKind&&(e=r.R.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&(this.thinInstanceAllowAutomaticStaticBufferRecreation&&!this._userThinInstanceBuffersStorage.vertexBuffers[e].isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(this._userThinInstanceBuffersStorage.data[e],0)))},s.e.prototype.thinInstancePartialBufferUpdate=function(e,t,i){"matrix"===e?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,i):(e===r.R.ColorKind&&(e=r.R.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(t,i))},s.e.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const e=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=n.uq.FromArray(e,16*t)}return this._thinInstanceDataStorage.worldMatrices},s.e.prototype.thinInstanceRefreshBoundingInfo=function(e=!1,t=!1,i=!1){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const s=this._thinInstanceDataStorage.boundingVectors;if(e||!this.rawBoundingInfo){s.length=0,this.refreshBoundingInfo(t,i);const e=this.getBoundingInfo();this.rawBoundingInfo=new a.j(e.minimum,e.maximum)}const r=this.getBoundingInfo(),o=this._thinInstanceDataStorage.matrixData;if(0===s.length)for(let e=0;e<r.boundingBox.vectors.length;++e)s.push(r.boundingBox.vectors[e].clone());n.AA.Vector3[0].setAll(Number.POSITIVE_INFINITY),n.AA.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(let e=0;e<this._thinInstanceDataStorage.instancesCount;++e){n.uq.FromArrayToRef(o,16*e,n.AA.Matrix[0]);for(let e=0;e<s.length;++e)n.Pq.TransformCoordinatesToRef(s[e],n.AA.Matrix[0],n.AA.Vector3[2]),n.AA.Vector3[0].minimizeInPlace(n.AA.Vector3[2]),n.AA.Vector3[1].maximizeInPlace(n.AA.Vector3[2])}r.reConstruct(n.AA.Vector3[0],n.AA.Vector3[1]),this._updateBoundingInfo()},s.e.prototype._thinInstanceRecreateBuffer=function(e,t=!0){"matrix"===e?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,t)):"previousMatrix"===e?this._scene.needsPreviousWorldMatrices&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,t)):(e===r.R.ColorKind&&(e=r.R.ColorInstanceKind),this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new r.R(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!t,!1,this._userThinInstanceBuffersStorage.strides[e],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))},s.e.prototype._thinInstanceUpdateBufferSize=function(e,t=1){e===r.R.ColorKind&&(e=r.R.ColorInstanceKind);const i="matrix"===e;if(!(i||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[e]))return;const s=i?16:this._userThinInstanceBuffersStorage.strides[e],n=i?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[e];let o=i?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[e];const a=(this._thinInstanceDataStorage.instancesCount+t)*s;let h=n;for(;h<a;)h*=2;if(!o||n!=h){if(o){const e=new Float32Array(h);e.set(o,0),o=e}else o=new Float32Array(h);i?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",o,!1),this._thinInstanceDataStorage.matrixData=o,this._thinInstanceDataStorage.matrixBufferSize=h,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",o,!1))):(this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.data[e]=o,this._userThinInstanceBuffersStorage.sizes[e]=h,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new r.R(this.getEngine(),o,e,!0,!1,s,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))}},s.e.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},s.e.prototype._disposeThinInstanceSpecificData=function(){this._thinInstanceDataStorage?.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},3788:(e,t,i)=>{"use strict";i.d(t,{h:()=>o});var s,r=i(3054);class n{get wrapU(){return this._cachedWrapU}set wrapU(e){this._cachedWrapU=e}get wrapV(){return this._cachedWrapV}set wrapV(e){this._cachedWrapV=e}get wrapR(){return this._cachedWrapR}set wrapR(e){this._cachedWrapR=e}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(e){this._comparisonFunction=e}get useMipMaps(){return this._useMipMaps}set useMipMaps(e){this._useMipMaps=e}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(e=1,t=1,i=1,s=1,r=2,n=0){return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=s,this.samplingMode=r,this._comparisonFunction=n,this}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}}!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.DepthStencil=12]="DepthStencil",e[e.CubeRawRGBD=13]="CubeRawRGBD",e[e.Depth=14]="Depth"}(s||(s={}));class o extends n{get useMipMaps(){return this.generateMipMaps}set useMipMaps(e){this.generateMipMaps=e}get uniqueId(){return this._uniqueId}_setUniqueId(e){this._uniqueId=e}getEngine(){return this._engine}get source(){return this._source}constructor(e,t,i=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new r.cP,this.onErrorObservable=new r.cP,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=e,this._source=t,this._uniqueId=o._Counter++,i||(this._hardwareTexture=e._createHardwareTexture())}incrementReferences(){this._references++}updateSize(e,t,i=1){this._engine.updateTextureDimensions(this,e,t,i),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const e=this.onRebuildCallback(this),t=t=>{t._swapAndDie(this,!1),this.isReady=e.isReady};return void(e.isAsync?e.proxy.then(t):t(e.proxy))}let e;switch(this.source){case 2:case 12:case 14:break;case 1:return void(e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(e=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case 10:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 11:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 4:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(e=>{e&&e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(e._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(e,t=!0){this._hardwareTexture?.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);const i=this._engine.getLoadedTexturesCache();let s=i.indexOf(this);-1!==s&&i.splice(s,1),s=i.indexOf(e),-1===s&&i.push(e)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}o._Counter=0},3836:(e,t,i)=>{"use strict";var s=i(4499),r=i(6678),n=i(376),o=i(9707);e.exports=o||s.call(n,r)},3841:e=>{"use strict";e.exports=EvalError},3846:(e,t,i)=>{"use strict";i.d(t,{Zp:()=>r,mx:()=>a,tT:()=>o});var s=i(4049);class r{}r.POINTERDOWN=1,r.POINTERUP=2,r.POINTERMOVE=4,r.POINTERWHEEL=8,r.POINTERPICK=16,r.POINTERTAP=32,r.POINTERDOUBLETAP=64;class n{constructor(e,t){this.type=e,this.event=t}}class o extends n{constructor(e,t,i,r){super(e,t),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new s.I9(i,r)}}class a extends n{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(e,t,i,s=null){super(e,t),this._pickInfo=i,this._inputManager=s}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},3888:e=>{"use strict";e.exports=Math.max},3897:(e,t,i)=>{"use strict";var s=i(3943);e.exports=function(e){return s(e)||0===e?e:e<0?-1:1}},3943:e=>{"use strict";e.exports=Number.isNaN||function(e){return e!=e}},3950:e=>{"use strict";e.exports=ReferenceError},3966:()=>{},4049:(e,t,i)=>{"use strict";i.d(t,{AA:()=>f,I9:()=>c,IU:()=>d,PT:()=>_,Pq:()=>u,uq:()=>p});var s=i(7761),r=i(959),n=i(5686),o=i(3405),a=i(1497),h=i(8857);const l=e=>parseInt(e.toString().replace(/\W/g,""));class c{constructor(e=0,t=0){this.x=e,this.y=t}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let e=l(this.x);return e=397*e^l(this.y),e}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,this}fromArray(e,t=0){return c.FromArrayToRef(e,t,this),this}asArray(){return[this.x,this.y]}copyFrom(e){return this.x=e.x,this.y=e.y,this}copyFromFloats(e,t){return this.x=e,this.y=t,this}set(e,t){return this.copyFromFloats(e,t)}setAll(e){return this.copyFromFloats(e,e)}add(e){return new c(this.x+e.x,this.y+e.y)}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t}addInPlace(e){return this.x+=e.x,this.y+=e.y,this}addInPlaceFromFloats(e,t){return this.x+=e,this.y+=t,this}addVector3(e){return new c(this.x+e.x,this.y+e.y)}subtract(e){return new c(this.x-e.x,this.y-e.y)}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this}multiply(e){return new c(this.x*e.x,this.y*e.y)}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByFloats(e,t){return new c(this.x*e,this.y*t)}divide(e){return new c(this.x/e.x,this.y/e.y)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t}divideInPlace(e){return this.x=this.x/e.x,this.y=this.y/e.y,this}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.x,e.y)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.x,e.y)}minimizeInPlaceFromFloats(e,t){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this}maximizeInPlaceFromFloats(e,t){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this}subtractFromFloats(e,t){return new c(this.x-e,this.y-t)}subtractFromFloatsToRef(e,t,i){return i.x=this.x-e,i.y=this.y-t,i}negate(){return new c(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(e){return e.x=-this.x,e.y=-this.y,e}scaleInPlace(e){return this.x*=e,this.y*=e,this}scale(e){return new c(this.x*e,this.y*e)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t}equals(e){return e&&this.x===e.x&&this.y===e.y}equalsWithEpsilon(e,t=s.bH){return e&&(0,h.WithinEpsilon)(this.x,e.x,t)&&(0,h.WithinEpsilon)(this.y,e.y,t)}equalsToFloats(e,t){return this.x===e&&this.y===t}floor(){return new c(Math.floor(this.x),Math.floor(this.y))}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e}fract(){return new c(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e}rotateToRef(e,t){const i=Math.cos(e),s=Math.sin(e),r=i*this.x-s*this.y,n=s*this.x+i*this.y;return t.x=r,t.y=n,t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new c;return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return 0===t&&(e.x=this.x,e.y=this.y),this.scaleToRef(1/t,e)}clone(){return new c(this.x,this.y)}dot(e){return this.x*e.x+this.y*e.y}static Zero(){return new c(0,0)}static One(){return new c(1,1)}static Random(e=0,t=1){return new c((0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats((0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t))}static get ZeroReadOnly(){return c._ZeroReadOnly}static FromArray(e,t=0){return new c(e[t],e[t+1])}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i}static FromFloatsToRef(e,t,i){return i.copyFromFloats(e,t),i}static CatmullRom(e,t,i,s,r){const n=r*r,o=r*n,a=.5*(2*t.x+(-e.x+i.x)*r+(2*e.x-5*t.x+4*i.x-s.x)*n+(-e.x+3*t.x-3*i.x+s.x)*o),h=.5*(2*t.y+(-e.y+i.y)*r+(2*e.y-5*t.y+4*i.y-s.y)*n+(-e.y+3*t.y-3*i.y+s.y)*o);return new c(a,h)}static ClampToRef(e,t,i,s){return s.x=(0,h.Clamp)(e.x,t.x,i.x),s.y=(0,h.Clamp)(e.y,t.y,i.y),s}static Clamp(e,t,i){const s=(0,h.Clamp)(e.x,t.x,i.x),r=(0,h.Clamp)(e.y,t.y,i.y);return new c(s,r)}static Hermite(e,t,i,s,r){const n=r*r,o=r*n,a=2*o-3*n+1,h=-2*o+3*n,l=o-2*n+r,u=o-n,d=e.x*a+i.x*h+t.x*l+s.x*u,_=e.y*a+i.y*h+t.y*l+s.y*u;return new c(d,_)}static Hermite1stDerivative(e,t,i,s,r){return this.Hermite1stDerivativeToRef(e,t,i,s,r,new c)}static Hermite1stDerivativeToRef(e,t,i,s,r,n){const o=r*r;return n.x=6*(o-r)*e.x+(3*o-4*r+1)*t.x+6*(-o+r)*i.x+(3*o-2*r)*s.x,n.y=6*(o-r)*e.y+(3*o-4*r+1)*t.y+6*(-o+r)*i.y+(3*o-2*r)*s.y,n}static Lerp(e,t,i){return c.LerpToRef(e,t,i,new c)}static LerpToRef(e,t,i,s){return s.x=e.x+(t.x-e.x)*i,s.y=e.y+(t.y-e.y)*i,s}static Dot(e,t){return e.x*t.x+e.y*t.y}static Normalize(e){return c.NormalizeToRef(e,new c)}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Minimize(e,t){const i=e.x<t.x?e.x:t.x,s=e.y<t.y?e.y:t.y;return new c(i,s)}static Maximize(e,t){const i=e.x>t.x?e.x:t.x,s=e.y>t.y?e.y:t.y;return new c(i,s)}static Transform(e,t){return c.TransformToRef(e,t,new c)}static TransformToRef(e,t,i){const s=t.m,r=e.x*s[0]+e.y*s[4]+s[12],n=e.x*s[1]+e.y*s[5]+s[13];return i.x=r,i.y=n,i}static PointInTriangle(e,t,i,s){const r=.5*(-i.y*s.x+t.y*(-i.x+s.x)+t.x*(i.y-s.y)+i.x*s.y),n=r<0?-1:1,o=(t.y*s.x-t.x*s.y+(s.y-t.y)*e.x+(t.x-s.x)*e.y)*n,a=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*n;return o>0&&a>0&&o+a<2*r*n}static Distance(e,t){return Math.sqrt(c.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,s=e.y-t.y;return i*i+s*s}static Center(e,t){return c.CenterToRef(e,t,new c)}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)}static DistanceOfPointFromSegment(e,t,i){const s=c.DistanceSquared(t,i);if(0===s)return c.Distance(e,t);const r=i.subtract(t),n=Math.max(0,Math.min(1,c.Dot(e.subtract(t),r)/s)),o=t.add(r.multiplyByFloats(n,n));return c.Distance(e,o)}}c._V8PerformanceHack=new c(.5,.5),c._ZeroReadOnly=c.Zero(),Object.defineProperties(c.prototype,{dimension:{value:[2]},rank:{value:1}});class u{get x(){return this._x}set x(e){this._x=e,this._isDirty=!0}get y(){return this._y}set y(e){this._y=e,this._isDirty=!0}get z(){return this._z}set z(e){this._z=e,this._isDirty=!0}constructor(e=0,t=0,i=0){this._isDirty=!0,this._x=e,this._y=t,this._z=i}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Vector3"}getHashCode(){let e=l(this._x);return e=397*e^l(this._y),e=397*e^l(this._z),e}asArray(){return[this._x,this._y,this._z]}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this}fromArray(e,t=0){return u.FromArrayToRef(e,t,this),this}toQuaternion(){return _.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._isDirty=!0,this}addInPlaceFromFloats(e,t,i){return this._x+=e,this._y+=t,this._z+=i,this._isDirty=!0,this}add(e){return new u(this._x+e._x,this._y+e._y,this._z+e._z)}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._isDirty=!0,t}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._isDirty=!0,this}subtract(e){return new u(this._x-e._x,this._y-e._y,this._z-e._z)}subtractToRef(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)}subtractFromFloats(e,t,i){return new u(this._x-e,this._y-t,this._z-i)}subtractFromFloatsToRef(e,t,i,s){return s._x=this._x-e,s._y=this._y-t,s._z=this._z-i,s._isDirty=!0,s}negate(){return new u(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(e){return e._x=-1*this._x,e._y=-1*this._y,e._z=-1*this._z,e._isDirty=!0,e}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._isDirty=!0,this}scale(e){return new u(this._x*e,this._y*e,this._z*e)}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._isDirty=!0,t}getNormalToRef(e){const t=this.length();let i=Math.acos(this.y/t);const s=Math.atan2(this.z,this.x);i>Math.PI/2?i-=Math.PI/2:i+=Math.PI/2;const r=t*Math.sin(i)*Math.cos(s),n=t*Math.cos(i),o=t*Math.sin(i)*Math.sin(s);return e.set(r,n,o),e}applyRotationQuaternionToRef(e,t){const i=this._x,s=this._y,r=this._z,n=e._x,o=e._y,a=e._z,h=e._w,l=2*(o*r-a*s),c=2*(a*i-n*r),u=2*(n*s-o*i);return t._x=i+h*l+o*u-a*c,t._y=s+h*c+a*l-n*u,t._z=r+h*u+n*c-o*l,t._isDirty=!0,t}applyRotationQuaternionInPlace(e){return this.applyRotationQuaternionToRef(e,this)}applyRotationQuaternion(e){return this.applyRotationQuaternionToRef(e,new u)}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._isDirty=!0,t}projectOnPlane(e,t){return this.projectOnPlaneToRef(e,t,new u)}projectOnPlaneToRef(e,t,i){const s=e.normal,r=e.d,n=g.Vector3[0];this.subtractToRef(t,n),n.normalize();const o=u.Dot(n,s);if(Math.abs(o)<1e-10)i.setAll(1/0);else{const e=-(u.Dot(t,s)+r)/o,a=n.scaleInPlace(e);t.addToRef(a,i)}return i}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z}equalsWithEpsilon(e,t=s.bH){return e&&(0,h.WithinEpsilon)(this._x,e._x,t)&&(0,h.WithinEpsilon)(this._y,e._y,t)&&(0,h.WithinEpsilon)(this._z,e._z,t)}equalsToFloats(e,t,i){return this._x===e&&this._y===t&&this._z===i}multiplyInPlace(e){return this._x*=e._x,this._y*=e._y,this._z*=e._z,this._isDirty=!0,this}multiply(e){return this.multiplyByFloats(e._x,e._y,e._z)}multiplyToRef(e,t){return t._x=this._x*e._x,t._y=this._y*e._y,t._z=this._z*e._z,t._isDirty=!0,t}multiplyByFloats(e,t,i){return new u(this._x*e,this._y*t,this._z*i)}divide(e){return new u(this._x/e._x,this._y/e._y,this._z/e._z)}divideToRef(e,t){return t._x=this._x/e._x,t._y=this._y/e._y,t._z=this._z/e._z,t._isDirty=!0,t}divideInPlace(e){return this._x=this._x/e._x,this._y=this._y/e._y,this._z=this._z/e._z,this._isDirty=!0,this}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)}minimizeInPlaceFromFloats(e,t,i){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),i<this._z&&(this.z=i),this}maximizeInPlaceFromFloats(e,t,i){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),i>this._z&&(this.z=i),this}isNonUniformWithinEpsilon(e){const t=Math.abs(this._x),i=Math.abs(this._y);if(!(0,h.WithinEpsilon)(t,i,e))return!0;const s=Math.abs(this._z);return!(0,h.WithinEpsilon)(t,s,e)||!(0,h.WithinEpsilon)(i,s,e)}get isNonUniform(){const e=Math.abs(this._x);return e!==Math.abs(this._y)||e!==Math.abs(this._z)}floorToRef(e){return e._x=Math.floor(this._x),e._y=Math.floor(this._y),e._z=Math.floor(this._z),e._isDirty=!0,e}floor(){return new u(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(e){return e._x=this.x-Math.floor(this._x),e._y=this.y-Math.floor(this._y),e._z=this.z-Math.floor(this._z),e._isDirty=!0,e}fract(){return new u(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z==0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(e){if("xyz"===(e=e.toLowerCase()))return this;const t=g.Vector3[0].copyFrom(this);return this.x=t[e[0]],this.y=t[e[1]],this.z=t[e[2]],this}rotateByQuaternionToRef(e,t){return e.toRotationMatrix(g.Matrix[0]),u.TransformCoordinatesToRef(this,g.Matrix[0],t),t}rotateByQuaternionAroundPointToRef(e,t,i){return this.subtractToRef(t,g.Vector3[0]),g.Vector3[0].rotateByQuaternionToRef(e,g.Vector3[0]),t.addToRef(g.Vector3[0],i),i}cross(e){return u.CrossToRef(this,e,new u)}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}normalizeToNew(){return this.normalizeToRef(new u)}normalizeToRef(e){const t=this.length();return 0===t||1===t?(e._x=this._x,e._y=this._y,e._z=this._z,e._isDirty=!0,e):this.scaleToRef(1/t,e)}clone(){return new u(this._x,this._y,this._z)}copyFrom(e){return this.copyFromFloats(e._x,e._y,e._z)}copyFromFloats(e,t,i){return this._x=e,this._y=t,this._z=i,this._isDirty=!0,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this._x=this._y=this._z=e,this._isDirty=!0,this}static GetClipFactor(e,t,i,s){const r=u.Dot(e,i);return(r-s)/(r-u.Dot(t,i))}static GetAngleBetweenVectors(e,t,i){const s=e.normalizeToRef(g.Vector3[1]),r=t.normalizeToRef(g.Vector3[2]);let n=u.Dot(s,r);n=(0,h.Clamp)(n,-1,1);const o=Math.acos(n),a=g.Vector3[3];return u.CrossToRef(s,r,a),u.Dot(a,i)>0?isNaN(o)?0:o:isNaN(o)?-Math.PI:-Math.acos(n)}static GetAngleBetweenVectorsOnPlane(e,t,i){g.Vector3[0].copyFrom(e);const s=g.Vector3[0];g.Vector3[1].copyFrom(t);const r=g.Vector3[1];g.Vector3[2].copyFrom(i);const n=g.Vector3[2],o=g.Vector3[3],a=g.Vector3[4];s.normalize(),r.normalize(),n.normalize(),u.CrossToRef(n,s,o),u.CrossToRef(o,n,a);const l=Math.atan2(u.Dot(r,o),u.Dot(r,a));return(0,h.NormalizeRadians)(l)}static PitchYawRollToMoveBetweenPointsToRef(e,t,i){const s=f.Vector3[0];return t.subtractToRef(e,s),i._y=Math.atan2(s.x,s.z)||0,i._x=Math.atan2(Math.sqrt(s.x**2+s.z**2),s.y)||0,i._z=0,i._isDirty=!0,i}static PitchYawRollToMoveBetweenPoints(e,t){const i=u.Zero();return u.PitchYawRollToMoveBetweenPointsToRef(e,t,i)}static SlerpToRef(e,t,i,r){i=(0,h.Clamp)(i,0,1);const n=g.Vector3[0],o=g.Vector3[1];n.copyFrom(e);const a=n.length();n.normalizeFromLength(a),o.copyFrom(t);const l=o.length();o.normalizeFromLength(l);const c=u.Dot(n,o);let d,_;if(c<1-s.bH){const e=Math.acos(c),t=1/Math.sin(e);d=Math.sin((1-i)*e)*t,_=Math.sin(i*e)*t}else d=1-i,_=i;return n.scaleInPlace(d),o.scaleInPlace(_),r.copyFrom(n).addInPlace(o),r.scaleInPlace((0,h.Lerp)(a,l,i)),r}static SmoothToRef(e,t,i,s,r){return u.SlerpToRef(e,t,0===s?1:i/s,r),r}static FromArray(e,t=0){return new u(e[t],e[t+1],e[t+2])}static FromFloatArray(e,t){return u.FromArray(e,t)}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._isDirty=!0,i}static FromFloatArrayToRef(e,t,i){return u.FromArrayToRef(e,t,i)}static FromFloatsToRef(e,t,i,s){return s.copyFromFloats(e,t,i),s}static Zero(){return new u(0,0,0)}static One(){return new u(1,1,1)}static Up(){return new u(0,1,0)}static get UpReadOnly(){return u._UpReadOnly}static get DownReadOnly(){return u._DownReadOnly}static get RightReadOnly(){return u._RightReadOnly}static get LeftReadOnly(){return u._LeftReadOnly}static get LeftHandedForwardReadOnly(){return u._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return u._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return u._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return u._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return u._ZeroReadOnly}static get OneReadOnly(){return u._OneReadOnly}static Down(){return new u(0,-1,0)}static Forward(e=!1){return new u(0,0,e?-1:1)}static Backward(e=!1){return new u(0,0,e?1:-1)}static Right(){return new u(1,0,0)}static Left(){return new u(-1,0,0)}static Random(e=0,t=1){return new u((0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats((0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t))}static TransformCoordinates(e,t){const i=u.Zero();return u.TransformCoordinatesToRef(e,t,i),i}static TransformCoordinatesToRef(e,t,i){return u.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformCoordinatesFromFloatsToRef(e,t,i,s,r){const n=s.m,o=e*n[0]+t*n[4]+i*n[8]+n[12],a=e*n[1]+t*n[5]+i*n[9]+n[13],h=e*n[2]+t*n[6]+i*n[10]+n[14],l=1/(e*n[3]+t*n[7]+i*n[11]+n[15]);return r._x=o*l,r._y=a*l,r._z=h*l,r._isDirty=!0,r}static TransformNormal(e,t){const i=u.Zero();return u.TransformNormalToRef(e,t,i),i}static TransformNormalToRef(e,t,i){return this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformNormalFromFloatsToRef(e,t,i,s,r){const n=s.m;return r._x=e*n[0]+t*n[4]+i*n[8],r._y=e*n[1]+t*n[5]+i*n[9],r._z=e*n[2]+t*n[6]+i*n[10],r._isDirty=!0,r}static CatmullRom(e,t,i,s,r){const n=r*r,o=r*n,a=.5*(2*t._x+(-e._x+i._x)*r+(2*e._x-5*t._x+4*i._x-s._x)*n+(-e._x+3*t._x-3*i._x+s._x)*o),h=.5*(2*t._y+(-e._y+i._y)*r+(2*e._y-5*t._y+4*i._y-s._y)*n+(-e._y+3*t._y-3*i._y+s._y)*o),l=.5*(2*t._z+(-e._z+i._z)*r+(2*e._z-5*t._z+4*i._z-s._z)*n+(-e._z+3*t._z-3*i._z+s._z)*o);return new u(a,h,l)}static Clamp(e,t,i){const s=new u;return u.ClampToRef(e,t,i,s),s}static ClampToRef(e,t,i,s){let r=e._x;r=r>i._x?i._x:r,r=r<t._x?t._x:r;let n=e._y;n=n>i._y?i._y:n,n=n<t._y?t._y:n;let o=e._z;return o=o>i._z?i._z:o,o=o<t._z?t._z:o,s.copyFromFloats(r,n,o),s}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static Hermite(e,t,i,s,r){const n=r*r,o=r*n,a=2*o-3*n+1,h=-2*o+3*n,l=o-2*n+r,c=o-n,d=e._x*a+i._x*h+t._x*l+s._x*c,_=e._y*a+i._y*h+t._y*l+s._y*c,p=e._z*a+i._z*h+t._z*l+s._z*c;return new u(d,_,p)}static Hermite1stDerivative(e,t,i,s,r){const n=new u;return this.Hermite1stDerivativeToRef(e,t,i,s,r,n),n}static Hermite1stDerivativeToRef(e,t,i,s,r,n){const o=r*r;return n._x=6*(o-r)*e._x+(3*o-4*r+1)*t._x+6*(-o+r)*i._x+(3*o-2*r)*s._x,n._y=6*(o-r)*e._y+(3*o-4*r+1)*t._y+6*(-o+r)*i._y+(3*o-2*r)*s._y,n._z=6*(o-r)*e._z+(3*o-4*r+1)*t._z+6*(-o+r)*i._z+(3*o-2*r)*s._z,n._isDirty=!0,n}static Lerp(e,t,i){const s=new u(0,0,0);return u.LerpToRef(e,t,i,s),s}static LerpToRef(e,t,i,s){return s._x=e._x+(t._x-e._x)*i,s._y=e._y+(t._y-e._y)*i,s._z=e._z+(t._z-e._z)*i,s._isDirty=!0,s}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z}static Cross(e,t){const i=new u;return u.CrossToRef(e,t,i),i}static CrossToRef(e,t,i){const s=e._y*t._z-e._z*t._y,r=e._z*t._x-e._x*t._z,n=e._x*t._y-e._y*t._x;return i.copyFromFloats(s,r,n),i}static Normalize(e){const t=u.Zero();return u.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Project(e,t,i,s){const r=new u;return u.ProjectToRef(e,t,i,s,r),r}static ProjectToRef(e,t,i,s,r){const n=s.width,o=s.height,h=s.x,l=s.y,c=g.Matrix[1],d=a.q.LastCreatedEngine?.isNDCHalfZRange,_=d?1:.5,f=d?0:.5;p.FromValuesToRef(n/2,0,0,0,0,-o/2,0,0,0,0,_,0,h+n/2,o/2+l,f,1,c);const m=g.Matrix[0];return t.multiplyToRef(i,m),m.multiplyToRef(c,m),u.TransformCoordinatesToRef(e,m,r),r}static Reflect(e,t){return this.ReflectToRef(e,t,new u)}static ReflectToRef(e,t,i){const s=f.Vector3[0];return s.copyFrom(t).scaleInPlace(2*u.Dot(e,t)),i.copyFrom(e).subtractInPlace(s)}static _UnprojectFromInvertedMatrixToRef(e,t,i){u.TransformCoordinatesToRef(e,t,i);const s=t.m,r=e._x*s[3]+e._y*s[7]+e._z*s[11]+s[15];return(0,h.WithinEpsilon)(r,1)&&i.scaleInPlace(1/r),i}static UnprojectFromTransform(e,t,i,s,r){return this.Unproject(e,t,i,s,r,p.IdentityReadOnly)}static Unproject(e,t,i,s,r,n){const o=new u;return u.UnprojectToRef(e,t,i,s,r,n,o),o}static UnprojectToRef(e,t,i,s,r,n,o){return u.UnprojectFloatsToRef(e._x,e._y,e._z,t,i,s,r,n,o),o}static UnprojectFloatsToRef(e,t,i,s,r,n,o,h,l){const c=g.Matrix[0];n.multiplyToRef(o,c),c.multiplyToRef(h,c),c.invert();const d=g.Vector3[0];return d.x=e/s*2-1,d.y=-(t/r*2-1),a.q.LastCreatedEngine?.isNDCHalfZRange?d.z=i:d.z=2*i-1,u._UnprojectFromInvertedMatrixToRef(d,c,l),l}static Minimize(e,t){const i=new u;return i.copyFrom(e),i.minimizeInPlace(t),i}static Maximize(e,t){const i=new u;return i.copyFrom(e),i.maximizeInPlace(t),i}static Distance(e,t){return Math.sqrt(u.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e._x-t._x,s=e._y-t._y,r=e._z-t._z;return i*i+s*s+r*r}static ProjectOnTriangleToRef(e,t,i,r,n){const o=g.Vector3[0],a=g.Vector3[1],l=g.Vector3[2],c=g.Vector3[3],d=g.Vector3[4];i.subtractToRef(t,o),r.subtractToRef(t,a),r.subtractToRef(i,l);const _=o.length(),p=a.length(),f=l.length();if(_<s.bH||p<s.bH||f<s.bH)return n.copyFrom(t),u.Distance(e,t);e.subtractToRef(t,d),u.CrossToRef(o,a,c);const m=c.length();if(m<s.bH)return n.copyFrom(t),u.Distance(e,t);c.normalizeFromLength(m);let b=d.length();if(b<s.bH)return n.copyFrom(t),0;d.normalizeFromLength(b);const v=u.Dot(c,d),T=g.Vector3[5],y=g.Vector3[6];T.copyFrom(c).scaleInPlace(-b*v),y.copyFrom(e).addInPlace(T);const x=g.Vector3[4],A=g.Vector3[5],C=g.Vector3[7],S=g.Vector3[8];x.copyFrom(o).scaleInPlace(1/_),S.copyFrom(a).scaleInPlace(1/p),x.addInPlace(S).scaleInPlace(-1),A.copyFrom(o).scaleInPlace(-1/_),S.copyFrom(l).scaleInPlace(1/f),A.addInPlace(S).scaleInPlace(-1),C.copyFrom(l).scaleInPlace(-1/f),S.copyFrom(a).scaleInPlace(-1/p),C.addInPlace(S).scaleInPlace(-1);const E=g.Vector3[9];let R;E.copyFrom(y).subtractInPlace(t),u.CrossToRef(x,E,S),R=u.Dot(S,c);const P=R;E.copyFrom(y).subtractInPlace(i),u.CrossToRef(A,E,S),R=u.Dot(S,c);const I=R;E.copyFrom(y).subtractInPlace(r),u.CrossToRef(C,E,S),R=u.Dot(S,c);const M=R,w=g.Vector3[10];let O,B;P>0&&I<0?(w.copyFrom(o),O=t,B=i):I>0&&M<0?(w.copyFrom(l),O=i,B=r):(w.copyFrom(a).scaleInPlace(-1),O=r,B=t);const D=g.Vector3[9],F=g.Vector3[4];if(O.subtractToRef(y,S),B.subtractToRef(y,D),u.CrossToRef(S,D,F),!(u.Dot(F,c)<0))return n.copyFrom(y),Math.abs(b*v);const L=g.Vector3[5];u.CrossToRef(w,F,L),L.normalize();const N=g.Vector3[9];N.copyFrom(O).subtractInPlace(y);const k=N.length();if(k<s.bH)return n.copyFrom(O),u.Distance(e,O);N.normalizeFromLength(k);const U=u.Dot(L,N),V=g.Vector3[7];V.copyFrom(y).addInPlace(L.scaleInPlace(k*U)),S.copyFrom(V).subtractInPlace(O),b=w.length(),w.normalizeFromLength(b);let G=u.Dot(S,w)/Math.max(b,s.bH);return G=(0,h.Clamp)(G,0,1),V.copyFrom(O).addInPlace(w.scaleInPlace(G*b)),n.copyFrom(V),u.Distance(e,V)}static Center(e,t){return u.CenterToRef(e,t,u.Zero())}static CenterToRef(e,t,i){return i.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)}static RotationFromAxis(e,t,i){const s=new u;return u.RotationFromAxisToRef(e,t,i,s),s}static RotationFromAxisToRef(e,t,i,s){const r=g.Quaternion[0];return _.RotationQuaternionFromAxisToRef(e,t,i,r),r.toEulerAnglesToRef(s),s}}u._V8PerformanceHack=new u(.5,.5,.5),u._UpReadOnly=u.Up(),u._DownReadOnly=u.Down(),u._LeftHandedForwardReadOnly=u.Forward(!1),u._RightHandedForwardReadOnly=u.Forward(!0),u._LeftHandedBackwardReadOnly=u.Backward(!1),u._RightHandedBackwardReadOnly=u.Backward(!0),u._RightReadOnly=u.Right(),u._LeftReadOnly=u.Left(),u._ZeroReadOnly=u.Zero(),u._OneReadOnly=u.One(),Object.defineProperties(u.prototype,{dimension:{value:[3]},rank:{value:1}});class d{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let e=l(this.x);return e=397*e^l(this.y),e=397*e^l(this.z),e=397*e^l(this.w),e}asArray(){return[this.x,this.y,this.z,this.w]}toArray(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this}fromArray(e,t=0){return d.FromArrayToRef(e,t,this),this}addInPlace(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addInPlaceFromFloats(e,t,i,s){return this.x+=e,this.y+=t,this.z+=i,this.w+=s,this}add(e){return new d(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,t}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subtract(e){return new d(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,t}subtractFromFloats(e,t,i,s){return new d(this.x-e,this.y-t,this.z-i,this.w-s)}subtractFromFloatsToRef(e,t,i,s,r){return r.x=this.x-e,r.y=this.y-t,r.z=this.z-i,r.w=this.w-s,r}negate(){return new d(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(e){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=-this.w,e}scaleInPlace(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}scale(e){return new d(this.x*e,this.y*e,this.z*e,this.w*e)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,t}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,t}equals(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}equalsWithEpsilon(e,t=s.bH){return e&&(0,h.WithinEpsilon)(this.x,e.x,t)&&(0,h.WithinEpsilon)(this.y,e.y,t)&&(0,h.WithinEpsilon)(this.z,e.z,t)&&(0,h.WithinEpsilon)(this.w,e.w,t)}equalsToFloats(e,t,i,s){return this.x===e&&this.y===t&&this.z===i&&this.w===s}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiply(e){return new d(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,t}multiplyByFloats(e,t,i,s){return new d(this.x*e,this.y*t,this.z*i,this.w*s)}divide(e){return new d(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,t}divideInPlace(e){return this.divideToRef(e,this)}minimizeInPlace(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this}maximizeInPlace(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this}minimizeInPlaceFromFloats(e,t,i,s){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this.z=Math.min(i,this.z),this.w=Math.min(s,this.w),this}maximizeInPlaceFromFloats(e,t,i,s){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this.z=Math.max(i,this.z),this.w=Math.max(s,this.w),this}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e.z=Math.floor(this.z),e.w=Math.floor(this.w),e}floor(){return new d(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e.z=this.z-Math.floor(this.z),e.w=this.w-Math.floor(this.w),e}fract(){return new d(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}normalizeToNew(){return this.normalizeToRef(new d)}normalizeToRef(e){const t=this.length();return 0===t||1===t?(e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e):this.scaleToRef(1/t,e)}toVector3(){return new u(this.x,this.y,this.z)}clone(){return new d(this.x,this.y,this.z,this.w)}copyFrom(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}copyFromFloats(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}set(e,t,i,s){return this.copyFromFloats(e,t,i,s)}setAll(e){return this.x=this.y=this.z=this.w=e,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}static FromArray(e,t){return t||(t=0),new d(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3],i}static FromFloatArrayToRef(e,t,i){return d.FromArrayToRef(e,t,i),i}static FromFloatsToRef(e,t,i,s,r){return r.x=e,r.y=t,r.z=i,r.w=s,r}static Zero(){return new d(0,0,0,0)}static One(){return new d(1,1,1,1)}static Random(e=0,t=1){return new d((0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t))}static RandomToRef(e=0,t=1,i){return i.x=(0,h.RandomRange)(e,t),i.y=(0,h.RandomRange)(e,t),i.z=(0,h.RandomRange)(e,t),i.w=(0,h.RandomRange)(e,t),i}static Clamp(e,t,i){return d.ClampToRef(e,t,i,new d)}static ClampToRef(e,t,i,s){return s.x=(0,h.Clamp)(e.x,t.x,i.x),s.y=(0,h.Clamp)(e.y,t.y,i.y),s.z=(0,h.Clamp)(e.z,t.z,i.z),s.w=(0,h.Clamp)(e.w,t.w,i.w),s}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static get ZeroReadOnly(){return d._ZeroReadOnly}static Normalize(e){return d.NormalizeToRef(e,new d)}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Minimize(e,t){const i=new d;return i.copyFrom(e),i.minimizeInPlace(t),i}static Maximize(e,t){const i=new d;return i.copyFrom(e),i.maximizeInPlace(t),i}static Distance(e,t){return Math.sqrt(d.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z,n=e.w-t.w;return i*i+s*s+r*r+n*n}static Center(e,t){return d.CenterToRef(e,t,new d)}static CenterToRef(e,t,i){return i.x=(e.x+t.x)/2,i.y=(e.y+t.y)/2,i.z=(e.z+t.z)/2,i.w=(e.w+t.w)/2,i}static TransformCoordinates(e,t){return d.TransformCoordinatesToRef(e,t,new d)}static TransformCoordinatesToRef(e,t,i){return d.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformCoordinatesFromFloatsToRef(e,t,i,s,r){const n=s.m,o=e*n[0]+t*n[4]+i*n[8]+n[12],a=e*n[1]+t*n[5]+i*n[9]+n[13],h=e*n[2]+t*n[6]+i*n[10]+n[14],l=e*n[3]+t*n[7]+i*n[11]+n[15];return r.x=o,r.y=a,r.z=h,r.w=l,r}static TransformNormal(e,t){return d.TransformNormalToRef(e,t,new d)}static TransformNormalToRef(e,t,i){const s=t.m,r=e.x*s[0]+e.y*s[4]+e.z*s[8],n=e.x*s[1]+e.y*s[5]+e.z*s[9],o=e.x*s[2]+e.y*s[6]+e.z*s[10];return i.x=r,i.y=n,i.z=o,i.w=e.w,i}static TransformNormalFromFloatsToRef(e,t,i,s,r,n){const o=r.m;return n.x=e*o[0]+t*o[4]+i*o[8],n.y=e*o[1]+t*o[5]+i*o[9],n.z=e*o[2]+t*o[6]+i*o[10],n.w=s,n}static FromVector3(e,t=0){return new d(e._x,e._y,e._z,t)}static Dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}}d._V8PerformanceHack=new d(.5,.5,.5,.5),d._ZeroReadOnly=d.Zero(),Object.defineProperties(d.prototype,{dimension:{value:[4]},rank:{value:1}});class _{get x(){return this._x}set x(e){this._x=e,this._isDirty=!0}get y(){return this._y}set y(e){this._y=e,this._isDirty=!0}get z(){return this._z}set z(e){this._z=e,this._isDirty=!0}get w(){return this._w}set w(e){this._w=e,this._isDirty=!0}constructor(e=0,t=0,i=0,s=1){this._isDirty=!0,this._x=e,this._y=t,this._z=i,this._w=s}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let e=l(this._x);return e=397*e^l(this._y),e=397*e^l(this._z),e=397*e^l(this._w),e}asArray(){return[this._x,this._y,this._z,this._w]}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,this}fromArray(e,t=0){return _.FromArrayToRef(e,t,this)}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w}equalsWithEpsilon(e,t=s.bH){return e&&(0,h.WithinEpsilon)(this._x,e._x,t)&&(0,h.WithinEpsilon)(this._y,e._y,t)&&(0,h.WithinEpsilon)(this._z,e._z,t)&&(0,h.WithinEpsilon)(this._w,e._w,t)}clone(){return new _(this._x,this._y,this._z,this._w)}copyFrom(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._isDirty=!0,this}copyFromFloats(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._isDirty=!0,this}set(e,t,i,s){return this.copyFromFloats(e,t,i,s)}setAll(e){return this.copyFromFloats(e,e,e,e)}add(e){return new _(this._x+e._x,this._y+e._y,this._z+e._z,this._w+e._w)}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this._isDirty=!0,this}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._w=this._w+e._w,t._isDirty=!0,t}addInPlaceFromFloats(e,t,i,s){return this._x+=e,this._y+=t,this._z+=i,this._w+=s,this._isDirty=!0,this}subtractToRef(e,t){return t._x=this._x-e._x,t._y=this._y-e._y,t._z=this._z-e._z,t._w=this._w-e._w,t._isDirty=!0,t}subtractFromFloats(e,t,i,s){return this.subtractFromFloatsToRef(e,t,i,s,new _)}subtractFromFloatsToRef(e,t,i,s,r){return r._x=this._x-e,r._y=this._y-t,r._z=this._z-i,r._w=this._w-s,r._isDirty=!0,r}subtract(e){return new _(this._x-e._x,this._y-e._y,this._z-e._z,this._w-e._w)}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this._isDirty=!0,this}scale(e){return new _(this._x*e,this._y*e,this._z*e,this._w*e)}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._w=this._w*e,t._isDirty=!0,t}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._w*=e,this._isDirty=!0,this}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._w+=this._w*e,t._isDirty=!0,t}multiply(e){const t=new _(0,0,0,1);return this.multiplyToRef(e,t),t}multiplyToRef(e,t){const i=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,s=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,r=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,n=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(i,s,r,n),t}multiplyInPlace(e){return this.multiplyToRef(e,this)}multiplyByFloats(e,t,i,s){return this._x*=e,this._y*=t,this._z*=i,this._w*=s,this._isDirty=!0,this}divide(e){throw new ReferenceError("Can not divide a quaternion")}divideToRef(e,t){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(e){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new _)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(e){return e._x=-this._x,e._y=-this._y,e._z=-this._z,e._w=-this._w,e._isDirty=!0,e}equalsToFloats(e,t,i,s){return this._x===e&&this._y===t&&this._z===i&&this._w===s}floorToRef(e){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(e){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),e}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new _(-this._x,-this._y,-this._z,this._w)}invert(){const e=this.conjugate(),t=this.lengthSquared();return 0==t||1==t||e.scaleInPlace(1/t),e}invertInPlace(){this.conjugateInPlace();const e=this.lengthSquared();return 0==e||1==e||this.scaleInPlace(1/e),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new _(0,0,0,1);return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return 0===t||1===t?e.copyFromFloats(this._x,this._y,this._z,this._w):this.scaleToRef(1/t,e)}toEulerAngles(){const e=u.Zero();return this.toEulerAnglesToRef(e),e}toEulerAnglesToRef(e){const t=this._z,i=this._x,s=this._y,r=this._w,n=s*t-i*r,o=.4999999;if(n<-o)e._y=2*Math.atan2(s,r),e._x=Math.PI/2,e._z=0,e._isDirty=!0;else if(n>o)e._y=2*Math.atan2(s,r),e._x=-Math.PI/2,e._z=0,e._isDirty=!0;else{const o=r*r,a=t*t,h=i*i,l=s*s;e._z=Math.atan2(2*(i*s+t*r),-a-h+l+o),e._x=Math.asin(-2*n),e._y=Math.atan2(2*(t*i+s*r),a-h-l+o),e._isDirty=!0}return e}toAlphaBetaGammaToRef(e){const t=this._z,i=this._x,s=this._y,r=this._w,n=Math.sqrt(i*i+s*s),o=Math.sqrt(t*t+r*r),a=2*Math.atan2(n,o),h=2*Math.atan2(t,r),l=2*Math.atan2(s,i),c=(h+l)/2,u=(h-l)/2;return e.set(u,a,c),e}toRotationMatrix(e){return p.FromQuaternionToRef(this,e),e}fromRotationMatrix(e){return _.FromRotationMatrixToRef(e,this),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}static FromRotationMatrix(e){const t=new _;return _.FromRotationMatrixToRef(e,t),t}static FromRotationMatrixToRef(e,t){const i=e.m,s=i[0],r=i[4],n=i[8],o=i[1],a=i[5],h=i[9],l=i[2],c=i[6],u=i[10],d=s+a+u;let _;return d>0?(_=.5/Math.sqrt(d+1),t._w=.25/_,t._x=(c-h)*_,t._y=(n-l)*_,t._z=(o-r)*_,t._isDirty=!0):s>a&&s>u?(_=2*Math.sqrt(1+s-a-u),t._w=(c-h)/_,t._x=.25*_,t._y=(r+o)/_,t._z=(n+l)/_,t._isDirty=!0):a>u?(_=2*Math.sqrt(1+a-s-u),t._w=(n-l)/_,t._x=(r+o)/_,t._y=.25*_,t._z=(h+c)/_,t._isDirty=!0):(_=2*Math.sqrt(1+u-s-a),t._w=(o-r)/_,t._x=(n+l)/_,t._y=(h+c)/_,t._z=.25*_,t._isDirty=!0),t}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w}static AreClose(e,t,i=.1){const s=_.Dot(e,t);return 1-s*s<=i}static SmoothToRef(e,t,i,s,r){let n=0===s?1:i/s;return n=(0,h.Clamp)(n,0,1),_.SlerpToRef(e,t,n,r),r}static Zero(){return new _(0,0,0,0)}static Inverse(e){return new _(-e._x,-e._y,-e._z,e._w)}static InverseToRef(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t}static Identity(){return new _(0,0,0,1)}static IsIdentity(e){return e&&0===e._x&&0===e._y&&0===e._z&&1===e._w}static RotationAxis(e,t){return _.RotationAxisToRef(e,t,new _)}static RotationAxisToRef(e,t,i){i._w=Math.cos(t/2);const s=Math.sin(t/2)/e.length();return i._x=e._x*s,i._y=e._y*s,i._z=e._z*s,i._isDirty=!0,i}static FromArray(e,t){return t||(t=0),new _(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._w=e[t+3],i._isDirty=!0,i}static FromFloatsToRef(e,t,i,s,r){return r.copyFromFloats(e,t,i,s),r}static FromEulerAngles(e,t,i){const s=new _;return _.RotationYawPitchRollToRef(t,e,i,s),s}static FromEulerAnglesToRef(e,t,i,s){return _.RotationYawPitchRollToRef(t,e,i,s),s}static FromEulerVector(e){const t=new _;return _.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t}static FromEulerVectorToRef(e,t){return _.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t}static FromUnitVectorsToRef(e,t,i,r=s.bH){const n=u.Dot(e,t)+1;return n<r?Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0,0):i.set(0,-e.z,e.y,0):(u.CrossToRef(e,t,f.Vector3[0]),i.set(f.Vector3[0].x,f.Vector3[0].y,f.Vector3[0].z,n)),i.normalize()}static RotationYawPitchRoll(e,t,i){const s=new _;return _.RotationYawPitchRollToRef(e,t,i,s),s}static RotationYawPitchRollToRef(e,t,i,s){const r=.5*i,n=.5*t,o=.5*e,a=Math.sin(r),h=Math.cos(r),l=Math.sin(n),c=Math.cos(n),u=Math.sin(o),d=Math.cos(o);return s._x=d*l*h+u*c*a,s._y=u*c*h-d*l*a,s._z=d*c*a-u*l*h,s._w=d*c*h+u*l*a,s._isDirty=!0,s}static RotationAlphaBetaGamma(e,t,i){const s=new _;return _.RotationAlphaBetaGammaToRef(e,t,i,s),s}static RotationAlphaBetaGammaToRef(e,t,i,s){const r=.5*(i+e),n=.5*(i-e),o=.5*t;return s._x=Math.cos(n)*Math.sin(o),s._y=Math.sin(n)*Math.sin(o),s._z=Math.sin(r)*Math.cos(o),s._w=Math.cos(r)*Math.cos(o),s._isDirty=!0,s}static RotationQuaternionFromAxis(e,t,i){const s=new _(0,0,0,0);return _.RotationQuaternionFromAxisToRef(e,t,i,s),s}static RotationQuaternionFromAxisToRef(e,t,i,s){const r=g.Matrix[0];return e=e.normalizeToRef(g.Vector3[0]),t=t.normalizeToRef(g.Vector3[1]),i=i.normalizeToRef(g.Vector3[2]),p.FromXYZAxesToRef(e,t,i,r),_.FromRotationMatrixToRef(r,s),s}static FromLookDirectionLH(e,t){const i=new _;return _.FromLookDirectionLHToRef(e,t,i),i}static FromLookDirectionLHToRef(e,t,i){const s=g.Matrix[0];return p.LookDirectionLHToRef(e,t,s),_.FromRotationMatrixToRef(s,i),i}static FromLookDirectionRH(e,t){const i=new _;return _.FromLookDirectionRHToRef(e,t,i),i}static FromLookDirectionRHToRef(e,t,i){const s=g.Matrix[0];return p.LookDirectionRHToRef(e,t,s),_.FromRotationMatrixToRef(s,i)}static Slerp(e,t,i){const s=_.Identity();return _.SlerpToRef(e,t,i,s),s}static SlerpToRef(e,t,i,s){let r,n,o=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,a=!1;if(o<0&&(a=!0,o=-o),o>.999999)n=1-i,r=a?-i:i;else{const e=Math.acos(o),t=1/Math.sin(e);n=Math.sin((1-i)*e)*t,r=a?-Math.sin(i*e)*t:Math.sin(i*e)*t}return s._x=n*e._x+r*t._x,s._y=n*e._y+r*t._y,s._z=n*e._z+r*t._z,s._w=n*e._w+r*t._w,s._isDirty=!0,s}static Hermite(e,t,i,s,r){const n=r*r,o=r*n,a=2*o-3*n+1,h=-2*o+3*n,l=o-2*n+r,c=o-n,u=e._x*a+i._x*h+t._x*l+s._x*c,d=e._y*a+i._y*h+t._y*l+s._y*c,p=e._z*a+i._z*h+t._z*l+s._z*c,g=e._w*a+i._w*h+t._w*l+s._w*c;return new _(u,d,p,g)}static Hermite1stDerivative(e,t,i,s,r){const n=new _;return this.Hermite1stDerivativeToRef(e,t,i,s,r,n),n}static Hermite1stDerivativeToRef(e,t,i,s,r,n){const o=r*r;return n._x=6*(o-r)*e._x+(3*o-4*r+1)*t._x+6*(-o+r)*i._x+(3*o-2*r)*s._x,n._y=6*(o-r)*e._y+(3*o-4*r+1)*t._y+6*(-o+r)*i._y+(3*o-2*r)*s._y,n._z=6*(o-r)*e._z+(3*o-4*r+1)*t._z+6*(-o+r)*i._z+(3*o-2*r)*s._z,n._w=6*(o-r)*e._w+(3*o-4*r+1)*t._w+6*(-o+r)*i._w+(3*o-2*r)*s._w,n._isDirty=!0,n}static Normalize(e){const t=_.Zero();return _.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Clamp(e,t,i){const s=new _;return _.ClampToRef(e,t,i,s),s}static ClampToRef(e,t,i,s){return s.copyFromFloats((0,h.Clamp)(e.x,t.x,i.x),(0,h.Clamp)(e.y,t.y,i.y),(0,h.Clamp)(e.z,t.z,i.z),(0,h.Clamp)(e.w,t.w,i.w))}static Random(e=0,t=1){return new _((0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats((0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t),(0,h.RandomRange)(e,t))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(e,t){return Math.sqrt(_.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z,n=e.w-t.w;return i*i+s*s+r*r+n*n}static Center(e,t){return _.CenterToRef(e,t,_.Zero())}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)}}_._V8PerformanceHack=new _(.5,.5,.5,.5),Object.defineProperties(_.prototype,{dimension:{value:[4]},rank:{value:1}});class p{static get Use64Bits(){return o.I.MatrixUse64Bits}get m(){return this._m}markAsUpdated(){this.updateFlag=p._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(e,t=!1,i=!1,s=!0){this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=!this._isIdentity&&t,this._isIdentity3x2Dirty=!this._isIdentity3x2&&s}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,o.I.MatrixTrackPrecisionChange&&o.I.MatrixTrackedMatrices.push(this),this._m=new o.I.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const e=this._m,t=e[0],i=e[1],s=e[2],r=e[3],n=e[4],o=e[5],a=e[6],h=e[7],l=e[8],c=e[9],u=e[10],d=e[11],_=e[12],p=e[13],g=e[14],f=e[15],m=u*f-g*d,b=c*f-p*d,v=c*g-p*u,T=l*f-_*d,y=l*g-u*_,x=l*p-_*c;return t*+(o*m-a*b+h*v)+i*-(n*m-a*T+h*y)+s*+(n*b-o*T+h*x)+r*-(n*v-o*y+a*x)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(e=null,t=0){if(!e)return this._m;const i=this._m;for(let s=0;s<16;s++)e[t+s]=i[s];return this}asArray(){return this._m}fromArray(e,t=0){return p.FromArrayToRef(e,t,this)}copyFromFloats(...e){return p.FromArrayToRef(e,0,this)}set(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=e[i];return this.markAsUpdated(),this}setAll(e){const t=this._m;for(let i=0;i<16;i++)t[i]=e;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return p.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(e){const t=new p;return this.addToRef(e,t),t}addToRef(e,t){const i=this._m,s=t._m,r=e.m;for(let e=0;e<16;e++)s[e]=i[e]+r[e];return t.markAsUpdated(),t}addToSelf(e){const t=this._m,i=e.m;return t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],t[3]+=i[3],t[4]+=i[4],t[5]+=i[5],t[6]+=i[6],t[7]+=i[7],t[8]+=i[8],t[9]+=i[9],t[10]+=i[10],t[11]+=i[11],t[12]+=i[12],t[13]+=i[13],t[14]+=i[14],t[15]+=i[15],this.markAsUpdated(),this}addInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]+=i[e];return this.markAsUpdated(),this}addInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]+=e[i];return this.markAsUpdated(),this}subtract(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]-=i[e];return this.markAsUpdated(),this}subtractToRef(e,t){const i=this._m,s=e.m,r=t._m;for(let e=0;e<16;e++)r[e]=i[e]-s[e];return t.markAsUpdated(),t}subtractInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]-=i[e];return this.markAsUpdated(),this}subtractFromFloats(...e){return this.subtractFromFloatsToRef(...e,new p)}subtractFromFloatsToRef(...e){const t=e.pop(),i=this._m,s=t._m,r=e;for(let e=0;e<16;e++)s[e]=i[e]-r[e];return t.markAsUpdated(),t}invertToRef(e){if(!0===this._isIdentity)return p.IdentityToRef(e),e;const t=this._m,i=t[0],s=t[1],r=t[2],n=t[3],o=t[4],a=t[5],h=t[6],l=t[7],c=t[8],u=t[9],d=t[10],_=t[11],g=t[12],f=t[13],m=t[14],b=t[15],v=d*b-m*_,T=u*b-f*_,y=u*m-f*d,x=c*b-g*_,A=c*m-d*g,C=c*f-g*u,S=+(a*v-h*T+l*y),E=-(o*v-h*x+l*A),R=+(o*T-a*x+l*C),P=-(o*y-a*A+h*C),I=i*S+s*E+r*R+n*P;if(0===I)return e.copyFrom(this),e;const M=1/I,w=h*b-m*l,O=a*b-f*l,B=a*m-f*h,D=o*b-g*l,F=o*m-g*h,L=o*f-g*a,N=h*_-d*l,k=a*_-u*l,U=a*d-u*h,V=o*_-c*l,G=o*d-c*h,z=o*u-c*a,H=-(s*v-r*T+n*y),W=+(i*v-r*x+n*A),X=-(i*T-s*x+n*C),q=+(i*y-s*A+r*C),Q=+(s*w-r*O+n*B),K=-(i*w-r*D+n*F),Y=+(i*O-s*D+n*L),j=-(i*B-s*F+r*L),Z=-(s*N-r*k+n*U),$=+(i*N-r*V+n*G),J=-(i*k-s*V+n*z),ee=+(i*U-s*G+r*z);return p.FromValuesToRef(S*M,H*M,Q*M,Z*M,E*M,W*M,K*M,$*M,R*M,X*M,Y*M,J*M,P*M,q*M,j*M,ee*M,e),e}addAtIndex(e,t){return this._m[e]+=t,this.markAsUpdated(),this}multiplyAtIndex(e,t){return this._m[e]*=t,this.markAsUpdated(),this}setTranslationFromFloats(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this.markAsUpdated(),this}addTranslationFromFloats(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this.markAsUpdated(),this}setTranslation(e){return this.setTranslationFromFloats(e._x,e._y,e._z)}getTranslation(){return new u(this._m[12],this._m[13],this._m[14])}getTranslationToRef(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],e}removeRotationAndScaling(){const e=this.m;return p.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e[12],e[13],e[14],e[15],this),this._updateIdentityStatus(0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]),this}copyFrom(e){e.copyToArray(this._m);const t=e;return this.updateFlag=t.updateFlag,this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this}copyToArray(e,t=0){const i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this}multiply(e){const t=new p;return this.multiplyToRef(e,t),t}multiplyInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]*=i[e];return this.markAsUpdated(),this}multiplyByFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e[i];return this.markAsUpdated(),this}multiplyByFloatsToRef(...e){const t=e.pop(),i=this._m,s=t._m,r=e;for(let e=0;e<16;e++)s[e]=i[e]*r[e];return t.markAsUpdated(),t}multiplyToRef(e,t){return this._isIdentity?(t.copyFrom(e),t):e._isIdentity?(t.copyFrom(this),t):(this.multiplyToArray(e,t._m,0),t.markAsUpdated(),t)}multiplyToArray(e,t,i){const s=this._m,r=e.m,n=s[0],o=s[1],a=s[2],h=s[3],l=s[4],c=s[5],u=s[6],d=s[7],_=s[8],p=s[9],g=s[10],f=s[11],m=s[12],b=s[13],v=s[14],T=s[15],y=r[0],x=r[1],A=r[2],C=r[3],S=r[4],E=r[5],R=r[6],P=r[7],I=r[8],M=r[9],w=r[10],O=r[11],B=r[12],D=r[13],F=r[14],L=r[15];return t[i]=n*y+o*S+a*I+h*B,t[i+1]=n*x+o*E+a*M+h*D,t[i+2]=n*A+o*R+a*w+h*F,t[i+3]=n*C+o*P+a*O+h*L,t[i+4]=l*y+c*S+u*I+d*B,t[i+5]=l*x+c*E+u*M+d*D,t[i+6]=l*A+c*R+u*w+d*F,t[i+7]=l*C+c*P+u*O+d*L,t[i+8]=_*y+p*S+g*I+f*B,t[i+9]=_*x+p*E+g*M+f*D,t[i+10]=_*A+p*R+g*w+f*F,t[i+11]=_*C+p*P+g*O+f*L,t[i+12]=m*y+b*S+v*I+T*B,t[i+13]=m*x+b*E+v*M+T*D,t[i+14]=m*A+b*R+v*w+T*F,t[i+15]=m*C+b*P+v*O+T*L,this}divide(e){return this.divideToRef(e,new p)}divideToRef(e,t){const i=this._m,s=e.m,r=t._m;for(let e=0;e<16;e++)r[e]=i[e]/s[e];return t.markAsUpdated(),t}divideInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]/=i[e];return this.markAsUpdated(),this}minimizeInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]=Math.min(t[e],i[e]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}maximizeInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]=Math.min(t[e],i[e]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new p)}negateInPlace(){const e=this._m;for(let t=0;t<16;t++)e[t]=-e[t];return this.markAsUpdated(),this}negateToRef(e){const t=this._m,i=e._m;for(let e=0;e<16;e++)i[e]=-t[e];return e.markAsUpdated(),e}equals(e){const t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;const i=this.m,s=t.m;return i[0]===s[0]&&i[1]===s[1]&&i[2]===s[2]&&i[3]===s[3]&&i[4]===s[4]&&i[5]===s[5]&&i[6]===s[6]&&i[7]===s[7]&&i[8]===s[8]&&i[9]===s[9]&&i[10]===s[10]&&i[11]===s[11]&&i[12]===s[12]&&i[13]===s[13]&&i[14]===s[14]&&i[15]===s[15]}equalsWithEpsilon(e,t=0){const i=this._m,s=e.m;for(let e=0;e<16;e++)if(!(0,h.WithinEpsilon)(i[e],s[e],t))return!1;return!0}equalsToFloats(...e){const t=this._m;for(let i=0;i<16;i++)if(t[i]!=e[i])return!1;return!0}floor(){return this.floorToRef(new p)}floorToRef(e){const t=this._m,i=e._m;for(let e=0;e<16;e++)i[e]=Math.floor(t[e]);return e.markAsUpdated(),e}fract(){return this.fractToRef(new p)}fractToRef(e){const t=this._m,i=e._m;for(let e=0;e<16;e++)i[e]=t[e]-Math.floor(t[e]);return e.markAsUpdated(),e}clone(){const e=new p;return e.copyFrom(this),e}getClassName(){return"Matrix"}getHashCode(){let e=l(this._m[0]);for(let t=1;t<16;t++)e=397*e^l(this._m[t]);return e}decomposeToTransformNode(e){return e.rotationQuaternion=e.rotationQuaternion||new _,this.decompose(e.scaling,e.rotationQuaternion,e.position)}decompose(e,t,i,s,r=!0){if(this._isIdentity)return i&&i.setAll(0),e&&e.setAll(1),t&&t.copyFromFloats(0,0,0,1),!0;const n=this._m;if(i&&i.copyFromFloats(n[12],n[13],n[14]),(e=e||g.Vector3[0]).x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),e.y=Math.sqrt(n[4]*n[4]+n[5]*n[5]+n[6]*n[6]),e.z=Math.sqrt(n[8]*n[8]+n[9]*n[9]+n[10]*n[10]),s){const t=(r?s.absoluteScaling.x:s.scaling.x)<0?-1:1,i=(r?s.absoluteScaling.y:s.scaling.y)<0?-1:1,n=(r?s.absoluteScaling.z:s.scaling.z)<0?-1:1;e.x*=t,e.y*=i,e.z*=n}else this.determinant()<=0&&(e.y*=-1);if(0===e._x||0===e._y||0===e._z)return t&&t.copyFromFloats(0,0,0,1),!1;if(t){const i=1/e._x,s=1/e._y,r=1/e._z;p.FromValuesToRef(n[0]*i,n[1]*i,n[2]*i,0,n[4]*s,n[5]*s,n[6]*s,0,n[8]*r,n[9]*r,n[10]*r,0,0,0,0,1,g.Matrix[0]),_.FromRotationMatrixToRef(g.Matrix[0],t)}return!0}getRow(e){if(e<0||e>3)return null;const t=4*e;return new d(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])}getRowToRef(e,t){if(e>=0&&e<=3){const i=4*e;t.x=this._m[i+0],t.y=this._m[i+1],t.z=this._m[i+2],t.w=this._m[i+3]}return t}setRow(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)}transpose(){const e=new p;return p.TransposeToRef(this,e),e}transposeToRef(e){return p.TransposeToRef(this,e),e}setRowFromFloats(e,t,i,s,r){if(e<0||e>3)return this;const n=4*e;return this._m[n+0]=t,this._m[n+1]=i,this._m[n+2]=s,this._m[n+3]=r,this.markAsUpdated(),this}scale(e){const t=new p;return this.scaleToRef(e,t),t}scaleToRef(e,t){for(let i=0;i<16;i++)t._m[i]=this._m[i]*e;return t.markAsUpdated(),t}scaleAndAddToRef(e,t){for(let i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t.markAsUpdated(),t}scaleInPlace(e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e;return this.markAsUpdated(),this}toNormalMatrix(e){const t=g.Matrix[0];this.invertToRef(t),t.transposeToRef(e);const i=e._m;return p.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,e),e}getRotationMatrix(){const e=new p;return this.getRotationMatrixToRef(e),e}getRotationMatrixToRef(e){const t=g.Vector3[0];if(!this.decompose(t))return p.IdentityToRef(e),e;const i=this._m,s=1/t._x,r=1/t._y,n=1/t._z;return p.FromValuesToRef(i[0]*s,i[1]*s,i[2]*s,0,i[4]*r,i[5]*r,i[6]*r,0,i[8]*n,i[9]*n,i[10]*n,0,0,0,0,1,e),e}toggleModelMatrixHandInPlace(){const e=this._m;return e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const e=this._m;return e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this.markAsUpdated(),this}static FromArray(e,t=0){const i=new p;return p.FromArrayToRef(e,t,i),i}static FromArrayToRef(e,t,i){for(let s=0;s<16;s++)i._m[s]=e[s+t];return i.markAsUpdated(),i}static FromFloat32ArrayToRefScaled(e,t,i,s){return s._m[0]=e[0+t]*i,s._m[1]=e[1+t]*i,s._m[2]=e[2+t]*i,s._m[3]=e[3+t]*i,s._m[4]=e[4+t]*i,s._m[5]=e[5+t]*i,s._m[6]=e[6+t]*i,s._m[7]=e[7+t]*i,s._m[8]=e[8+t]*i,s._m[9]=e[9+t]*i,s._m[10]=e[10+t]*i,s._m[11]=e[11+t]*i,s._m[12]=e[12+t]*i,s._m[13]=e[13+t]*i,s._m[14]=e[14+t]*i,s._m[15]=e[15+t]*i,s.markAsUpdated(),s}static get IdentityReadOnly(){return p._IdentityReadOnly}static FromValuesToRef(e,t,i,s,r,n,o,a,h,l,c,u,d,_,p,g,f){const m=f._m;m[0]=e,m[1]=t,m[2]=i,m[3]=s,m[4]=r,m[5]=n,m[6]=o,m[7]=a,m[8]=h,m[9]=l,m[10]=c,m[11]=u,m[12]=d,m[13]=_,m[14]=p,m[15]=g,f.markAsUpdated()}static FromValues(e,t,i,s,r,n,o,a,h,l,c,u,d,_,g,f){const m=new p,b=m._m;return b[0]=e,b[1]=t,b[2]=i,b[3]=s,b[4]=r,b[5]=n,b[6]=o,b[7]=a,b[8]=h,b[9]=l,b[10]=c,b[11]=u,b[12]=d,b[13]=_,b[14]=g,b[15]=f,m.markAsUpdated(),m}static Compose(e,t,i){const s=new p;return p.ComposeToRef(e,t,i,s),s}static ComposeToRef(e,t,i,s){const r=s._m,n=t._x,o=t._y,a=t._z,h=t._w,l=n+n,c=o+o,u=a+a,d=n*l,_=n*c,p=n*u,g=o*c,f=o*u,m=a*u,b=h*l,v=h*c,T=h*u,y=e._x,x=e._y,A=e._z;return r[0]=(1-(g+m))*y,r[1]=(_+T)*y,r[2]=(p-v)*y,r[3]=0,r[4]=(_-T)*x,r[5]=(1-(d+m))*x,r[6]=(f+b)*x,r[7]=0,r[8]=(p+v)*A,r[9]=(f-b)*A,r[10]=(1-(d+g))*A,r[11]=0,r[12]=i._x,r[13]=i._y,r[14]=i._z,r[15]=1,s.markAsUpdated(),s}static Identity(){const e=p.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e._updateIdentityStatus(!0),e}static IdentityToRef(e){return p.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(!0),e}static Zero(){const e=p.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return e._updateIdentityStatus(!1),e}static RotationX(e){const t=new p;return p.RotationXToRef(e,t),t}static Invert(e){const t=new p;return e.invertToRef(t),t}static RotationXToRef(e,t){const i=Math.sin(e),s=Math.cos(e);return p.FromValuesToRef(1,0,0,0,0,s,i,0,0,-i,s,0,0,0,0,1,t),t._updateIdentityStatus(1===s&&0===i),t}static RotationY(e){const t=new p;return p.RotationYToRef(e,t),t}static RotationYToRef(e,t){const i=Math.sin(e),s=Math.cos(e);return p.FromValuesToRef(s,0,-i,0,0,1,0,0,i,0,s,0,0,0,0,1,t),t._updateIdentityStatus(1===s&&0===i),t}static RotationZ(e){const t=new p;return p.RotationZToRef(e,t),t}static RotationZToRef(e,t){const i=Math.sin(e),s=Math.cos(e);return p.FromValuesToRef(s,i,0,0,-i,s,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(1===s&&0===i),t}static RotationAxis(e,t){const i=new p;return p.RotationAxisToRef(e,t,i),i}static RotationAxisToRef(e,t,i){const s=Math.sin(-t),r=Math.cos(-t),n=1-r;e=e.normalizeToRef(g.Vector3[0]);const o=i._m;return o[0]=e._x*e._x*n+r,o[1]=e._x*e._y*n-e._z*s,o[2]=e._x*e._z*n+e._y*s,o[3]=0,o[4]=e._y*e._x*n+e._z*s,o[5]=e._y*e._y*n+r,o[6]=e._y*e._z*n-e._x*s,o[7]=0,o[8]=e._z*e._x*n-e._y*s,o[9]=e._z*e._y*n+e._x*s,o[10]=e._z*e._z*n+r,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,i.markAsUpdated(),i}static RotationAlignToRef(e,t,i,r=!1){const n=u.Dot(t,e),o=i._m;if(n<-1+s.bH)o[0]=-1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r?1:-1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r?-1:1,o[11]=0;else{const i=u.Cross(t,e),s=1/(1+n);o[0]=i._x*i._x*s+n,o[1]=i._y*i._x*s-i._z,o[2]=i._z*i._x*s+i._y,o[3]=0,o[4]=i._x*i._y*s+i._z,o[5]=i._y*i._y*s+n,o[6]=i._z*i._y*s-i._x,o[7]=0,o[8]=i._x*i._z*s-i._y,o[9]=i._y*i._z*s+i._x,o[10]=i._z*i._z*s+n,o[11]=0}return o[12]=0,o[13]=0,o[14]=0,o[15]=1,i.markAsUpdated(),i}static RotationYawPitchRoll(e,t,i){const s=new p;return p.RotationYawPitchRollToRef(e,t,i,s),s}static RotationYawPitchRollToRef(e,t,i,s){return _.RotationYawPitchRollToRef(e,t,i,g.Quaternion[0]),g.Quaternion[0].toRotationMatrix(s),s}static Scaling(e,t,i){const s=new p;return p.ScalingToRef(e,t,i,s),s}static ScalingToRef(e,t,i,s){return p.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1,s),s._updateIdentityStatus(1===e&&1===t&&1===i),s}static Translation(e,t,i){const s=new p;return p.TranslationToRef(e,t,i,s),s}static TranslationToRef(e,t,i,s){return p.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1,s),s._updateIdentityStatus(0===e&&0===t&&0===i),s}static Lerp(e,t,i){const s=new p;return p.LerpToRef(e,t,i,s),s}static LerpToRef(e,t,i,s){const r=s._m,n=e.m,o=t.m;for(let e=0;e<16;e++)r[e]=n[e]*(1-i)+o[e]*i;return s.markAsUpdated(),s}static DecomposeLerp(e,t,i){const s=new p;return p.DecomposeLerpToRef(e,t,i,s),s}static DecomposeLerpToRef(e,t,i,s){const r=g.Vector3[0],n=g.Quaternion[0],o=g.Vector3[1];e.decompose(r,n,o);const a=g.Vector3[2],h=g.Quaternion[1],l=g.Vector3[3];t.decompose(a,h,l);const c=g.Vector3[4];u.LerpToRef(r,a,i,c);const d=g.Quaternion[2];_.SlerpToRef(n,h,i,d);const f=g.Vector3[5];return u.LerpToRef(o,l,i,f),p.ComposeToRef(c,d,f,s),s}static LookAtLH(e,t,i){const s=new p;return p.LookAtLHToRef(e,t,i,s),s}static LookAtLHToRef(e,t,i,s){const r=g.Vector3[0],n=g.Vector3[1],o=g.Vector3[2];t.subtractToRef(e,o),o.normalize(),u.CrossToRef(i,o,r);const a=r.lengthSquared();0===a?r.x=1:r.normalizeFromLength(Math.sqrt(a)),u.CrossToRef(o,r,n),n.normalize();const h=-u.Dot(r,e),l=-u.Dot(n,e),c=-u.Dot(o,e);return p.FromValuesToRef(r._x,n._x,o._x,0,r._y,n._y,o._y,0,r._z,n._z,o._z,0,h,l,c,1,s),s}static LookAtRH(e,t,i){const s=new p;return p.LookAtRHToRef(e,t,i,s),s}static LookAtRHToRef(e,t,i,s){const r=g.Vector3[0],n=g.Vector3[1],o=g.Vector3[2];e.subtractToRef(t,o),o.normalize(),u.CrossToRef(i,o,r);const a=r.lengthSquared();0===a?r.x=1:r.normalizeFromLength(Math.sqrt(a)),u.CrossToRef(o,r,n),n.normalize();const h=-u.Dot(r,e),l=-u.Dot(n,e),c=-u.Dot(o,e);return p.FromValuesToRef(r._x,n._x,o._x,0,r._y,n._y,o._y,0,r._z,n._z,o._z,0,h,l,c,1,s),s}static LookDirectionLH(e,t){const i=new p;return p.LookDirectionLHToRef(e,t,i),i}static LookDirectionLHToRef(e,t,i){const s=g.Vector3[0];s.copyFrom(e),s.scaleInPlace(-1);const r=g.Vector3[1];return u.CrossToRef(t,s,r),p.FromValuesToRef(r._x,r._y,r._z,0,t._x,t._y,t._z,0,s._x,s._y,s._z,0,0,0,0,1,i),i}static LookDirectionRH(e,t){const i=new p;return p.LookDirectionRHToRef(e,t,i),i}static LookDirectionRHToRef(e,t,i){const s=g.Vector3[2];return u.CrossToRef(t,e,s),p.FromValuesToRef(s._x,s._y,s._z,0,t._x,t._y,t._z,0,e._x,e._y,e._z,0,0,0,0,1,i),i}static OrthoLH(e,t,i,s,r){const n=new p;return p.OrthoLHToRef(e,t,i,s,n,r),n}static OrthoLHToRef(e,t,i,s,r,n){const o=2/e,a=2/t,h=2/(s-i),l=-(s+i)/(s-i);return p.FromValuesToRef(o,0,0,0,0,a,0,0,0,0,h,0,0,0,l,1,r),n&&r.multiplyToRef(m,r),r._updateIdentityStatus(1===o&&1===a&&1===h&&0===l),r}static OrthoOffCenterLH(e,t,i,s,r,n,o){const a=new p;return p.OrthoOffCenterLHToRef(e,t,i,s,r,n,a,o),a}static OrthoOffCenterLHToRef(e,t,i,s,r,n,o,a){const h=2/(t-e),l=2/(s-i),c=2/(n-r),u=-(n+r)/(n-r),d=(e+t)/(e-t),_=(s+i)/(i-s);return p.FromValuesToRef(h,0,0,0,0,l,0,0,0,0,c,0,d,_,u,1,o),a&&o.multiplyToRef(m,o),o.markAsUpdated(),o}static ObliqueOffCenterLHToRef(e,t,i,s,r,n,o,a,h,l,c){const u=-o*Math.cos(a),d=-o*Math.sin(a);return p.TranslationToRef(0,0,-h,g.Matrix[1]),p.FromValuesToRef(1,0,0,0,0,1,0,0,u,d,1,0,0,0,0,1,g.Matrix[0]),g.Matrix[1].multiplyToRef(g.Matrix[0],g.Matrix[0]),p.TranslationToRef(0,0,h,g.Matrix[1]),g.Matrix[0].multiplyToRef(g.Matrix[1],g.Matrix[0]),p.OrthoOffCenterLHToRef(e,t,i,s,r,n,l,c),g.Matrix[0].multiplyToRef(l,l),l}static OrthoOffCenterRH(e,t,i,s,r,n,o){const a=new p;return p.OrthoOffCenterRHToRef(e,t,i,s,r,n,a,o),a}static OrthoOffCenterRHToRef(e,t,i,s,r,n,o,a){return p.OrthoOffCenterLHToRef(e,t,i,s,r,n,o,a),o._m[10]*=-1,o}static ObliqueOffCenterRHToRef(e,t,i,s,r,n,o,a,h,l,c){const u=o*Math.cos(a),d=o*Math.sin(a);return p.TranslationToRef(0,0,h,g.Matrix[1]),p.FromValuesToRef(1,0,0,0,0,1,0,0,u,d,1,0,0,0,0,1,g.Matrix[0]),g.Matrix[1].multiplyToRef(g.Matrix[0],g.Matrix[0]),p.TranslationToRef(0,0,-h,g.Matrix[1]),g.Matrix[0].multiplyToRef(g.Matrix[1],g.Matrix[0]),p.OrthoOffCenterRHToRef(e,t,i,s,r,n,l,c),g.Matrix[0].multiplyToRef(l,l),l}static PerspectiveLH(e,t,i,s,r,n=0){const o=new p,a=2*i/e,h=2*i/t,l=(s+i)/(s-i),c=-2*s*i/(s-i),u=Math.tan(n);return p.FromValuesToRef(a,0,0,0,0,h,0,u,0,0,l,1,0,0,c,0,o),r&&o.multiplyToRef(m,o),o._updateIdentityStatus(!1),o}static PerspectiveFovLH(e,t,i,s,r,n=0,o=!1){const a=new p;return p.PerspectiveFovLHToRef(e,t,i,s,a,!0,r,n,o),a}static PerspectiveFovLHToRef(e,t,i,s,r,n=!0,o,a=0,h=!1){const l=i,c=s,u=1/Math.tan(.5*e),d=n?u/t:u,_=n?u:u*t,g=h&&0===l?-1:0!==c?(c+l)/(c-l):1,f=h&&0===l?2*c:0!==c?-2*c*l/(c-l):-2*l,b=Math.tan(a);return p.FromValuesToRef(d,0,0,0,0,_,0,b,0,0,g,1,0,0,f,0,r),o&&r.multiplyToRef(m,r),r._updateIdentityStatus(!1),r}static PerspectiveFovReverseLHToRef(e,t,i,s,r,n=!0,o,a=0){const h=1/Math.tan(.5*e),l=n?h/t:h,c=n?h:h*t,u=Math.tan(a);return p.FromValuesToRef(l,0,0,0,0,c,0,u,0,0,-i,1,0,0,1,0,r),o&&r.multiplyToRef(m,r),r._updateIdentityStatus(!1),r}static PerspectiveFovRH(e,t,i,s,r,n=0,o=!1){const a=new p;return p.PerspectiveFovRHToRef(e,t,i,s,a,!0,r,n,o),a}static PerspectiveFovRHToRef(e,t,i,s,r,n=!0,o,a=0,h=!1){const l=i,c=s,u=1/Math.tan(.5*e),d=n?u/t:u,_=n?u:u*t,g=h&&0===l?1:0!==c?-(c+l)/(c-l):-1,f=h&&0===l?2*c:0!==c?-2*c*l/(c-l):-2*l,b=Math.tan(a);return p.FromValuesToRef(d,0,0,0,0,_,0,b,0,0,g,-1,0,0,f,0,r),o&&r.multiplyToRef(m,r),r._updateIdentityStatus(!1),r}static PerspectiveFovReverseRHToRef(e,t,i,s,r,n=!0,o,a=0){const h=1/Math.tan(.5*e),l=n?h/t:h,c=n?h:h*t,u=Math.tan(a);return p.FromValuesToRef(l,0,0,0,0,c,0,u,0,0,-i,-1,0,0,-1,0,r),o&&r.multiplyToRef(m,r),r._updateIdentityStatus(!1),r}static GetFinalMatrix(e,t,i,s,r,n){const o=e.width,a=e.height,h=e.x,l=e.y,c=p.FromValues(o/2,0,0,0,0,-a/2,0,0,0,0,n-r,0,h+o/2,a/2+l,r,1),u=new p;return t.multiplyToRef(i,u),u.multiplyToRef(s,u),u.multiplyToRef(c,u)}static GetAsMatrix2x2(e){const t=e.m,i=[t[0],t[1],t[4],t[5]];return o.I.MatrixUse64Bits?i:new Float32Array(i)}static GetAsMatrix3x3(e){const t=e.m,i=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return o.I.MatrixUse64Bits?i:new Float32Array(i)}static Transpose(e){const t=new p;return p.TransposeToRef(e,t),t}static TransposeToRef(e,t){const i=e.m,s=i[0],r=i[4],n=i[8],o=i[12],a=i[1],h=i[5],l=i[9],c=i[13],u=i[2],d=i[6],_=i[10],p=i[14],g=i[3],f=i[7],m=i[11],b=i[15],v=t._m;return v[0]=s,v[1]=r,v[2]=n,v[3]=o,v[4]=a,v[5]=h,v[6]=l,v[7]=c,v[8]=u,v[9]=d,v[10]=_,v[11]=p,v[12]=g,v[13]=f,v[14]=m,v[15]=b,t.markAsUpdated(),t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty),t}static Reflection(e){const t=new p;return p.ReflectionToRef(e,t),t}static ReflectionToRef(e,t){e.normalize();const i=e.normal.x,s=e.normal.y,r=e.normal.z,n=-2*i,o=-2*s,a=-2*r;return p.FromValuesToRef(n*i+1,o*i,a*i,0,n*s,o*s+1,a*s,0,n*r,o*r,a*r+1,0,n*e.d,o*e.d,a*e.d,1,t),t}static FromXYZAxesToRef(e,t,i,s){return p.FromValuesToRef(e._x,e._y,e._z,0,t._x,t._y,t._z,0,i._x,i._y,i._z,0,0,0,0,1,s),s}static FromQuaternionToRef(e,t){const i=e._x*e._x,s=e._y*e._y,r=e._z*e._z,n=e._x*e._y,o=e._z*e._w,a=e._z*e._x,h=e._y*e._w,l=e._y*e._z,c=e._x*e._w;return t._m[0]=1-2*(s+r),t._m[1]=2*(n+o),t._m[2]=2*(a-h),t._m[3]=0,t._m[4]=2*(n-o),t._m[5]=1-2*(r+i),t._m[6]=2*(l+c),t._m[7]=0,t._m[8]=2*(a+h),t._m[9]=2*(l-c),t._m[10]=1-2*(s+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t.markAsUpdated(),t}}p._UpdateFlagSeed=0,p._IdentityReadOnly=p.Identity(),Object.defineProperties(p.prototype,{dimension:{value:[4,4]},rank:{value:2}});class g{}g.Vector3=(0,r.ln)(11,u.Zero),g.Matrix=(0,r.ln)(2,p.Identity),g.Quaternion=(0,r.ln)(3,_.Zero);class f{}f.Vector2=(0,r.ln)(3,c.Zero),f.Vector3=(0,r.ln)(13,u.Zero),f.Vector4=(0,r.ln)(3,d.Zero),f.Quaternion=(0,r.ln)(3,_.Zero),f.Matrix=(0,r.ln)(8,p.Identity),(0,n.Y5)("BABYLON.Vector2",c),(0,n.Y5)("BABYLON.Vector3",u),(0,n.Y5)("BABYLON.Vector4",d),(0,n.Y5)("BABYLON.Matrix",p);const m=p.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},4054:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Dispose:()=>d,DumpData:()=>u,DumpDataAsync:()=>c,DumpFramebuffer:()=>l,DumpTools:()=>_});var s=i(1077),r=i(9732),n=i(8857),o=i(1497);let a,h=null;async function l(e,t,i,s,r="image/png",n,o){const a=await i.readPixels(0,0,e,t);u(e,t,new Uint8Array(a.buffer),s,r,n,!0,void 0,o)}function c(e,t,i,s="image/png",r,n=!1,o=!1,a){return new Promise((h=>{u(e,t,i,(e=>h(e)),s,r,n,o,a)}))}function u(e,t,l,c,u="image/png",_,p=!1,g=!1,f){(async function(){return h||(h=new Promise(((e,t)=>{let r,n=null;const h={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(i.bind(i,8499)).then((({ThinEngine:l})=>{const c=o.q.Instances.length;try{r=new OffscreenCanvas(100,100),n=new l(r,!1,h)}catch(e){c<o.q.Instances.length&&o.q.Instances.pop()?.dispose(),r=document.createElement("canvas"),n=new l(r,!1,h)}o.q.Instances.pop(),o.q.OnEnginesDisposedObservable.add((e=>{n&&e!==n&&!n.isDisposed&&0===o.q.Instances.length&&d()})),n.getCaps().parallelShaderCompile=void 0;const u=new s.J(n);i.e(9762).then(i.bind(i,9762)).then((({passPixelShader:i})=>{if(!n)return void t("Engine is not defined");const o=new s.$({engine:n,name:i.name,fragmentShader:i.shader,samplerNames:["textureSampler"]});a={canvas:r,engine:n,renderer:u,wrapper:o},e(a)}))})).catch(t)}))),await h})().then((i=>{if(i.engine.setSize(e,t,!0),l instanceof Float32Array){const e=new Uint8Array(l.length);let t=l.length;for(;t--;){const i=l[t];e[t]=Math.round(255*(0,n.Clamp)(i))}l=e}const s=i.engine.createRawTexture(l,e,t,5,!1,!p,1);i.renderer.setViewport(),i.renderer.applyEffectWrapper(i.wrapper),i.wrapper.effect._bindTexture("textureSampler",s),i.renderer.draw(),g?r.S0.ToBlob(i.canvas,(e=>{const t=new FileReader;t.onload=e=>{const t=e.target.result;c&&c(t)},t.readAsArrayBuffer(e)}),u,f):r.S0.EncodeScreenshotCanvasData(i.canvas,c,u,_,f),s.dispose()}))}function d(){a?(a.wrapper.dispose(),a.renderer.dispose(),a.engine.dispose()):h?.then((e=>{e.wrapper.dispose(),e.renderer.dispose(),e.engine.dispose()})),h=null,a=null}const _={DumpData:u,DumpDataAsync:c,DumpFramebuffer:l,Dispose:d};r.S0.DumpData=u,r.S0.DumpDataAsync=c,r.S0.DumpFramebuffer=l},4245:(e,t,i)=>{"use strict";i.d(t,{w:()=>p});var s=i(4754),r=i(1425),n=i(3054),o=i(4049),a=i(2450),h=i(4537),l=i(979),c=i(5686),u=i(976),d=i(1663),_=i(1077);u.$.prototype.setTextureFromPostProcess=function(e,t,i){let s=null;t&&(t._forcedOutputTexture?s=t._forcedOutputTexture:t._textures.data[t._currentRenderTextureInd]&&(s=t._textures.data[t._currentRenderTextureInd])),this._bindTexture(e,s?.texture??null,i)},u.$.prototype.setTextureFromPostProcessOutput=function(e,t,i){this._bindTexture(e,t?._outputTexture?.texture??null,i)},a.M.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},a.M.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)};class p{static get ForceGLSL(){return _.$.ForceGLSL}static set ForceGLSL(e){_.$.ForceGLSL=e}static RegisterShaderCodeProcessing(e,t){_.$.RegisterShaderCodeProcessing(e,t)}get name(){return this._effectWrapper.name}set name(e){this._effectWrapper.name=e}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(e){this._effectWrapper.alphaMode=e}get samples(){return this._samples}set samples(e){this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach((e=>{e.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))}set onSizeChanged(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)}set onApply(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(e){this._forcedOutputTexture=e}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(e,t,i,s,a,h,l=1,c,u,d=null,g=0,f="postprocess",m,b=!1,v=5,T,y){this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new r.L(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new o.I9(1,1),this._texelSize=o.I9.Zero(),this.onActivateObservable=new n.cP,this.onSizeChangedObservable=new n.cP,this.onApplyObservable=new n.cP,this.onBeforeRenderObservable=new n.cP,this.onAfterRenderObservable=new n.cP;let x,A=1,C=null;if(i&&!Array.isArray(i)){const e=i;i=e.uniforms??null,s=e.samplers??null,A=e.size??1,h=e.camera??null,l=e.samplingMode??1,c=e.engine,u=e.reusable,d=Array.isArray(e.defines)?e.defines.join("\n"):e.defines??null,g=e.textureType??0,f=e.vertexUrl??"postprocess",m=e.indexParameters,b=e.blockCompilation??!1,v=e.textureFormat??5,T=e.shaderLanguage??0,C=e.uniformBuffers??null,y=e.extraInitializations,x=e.effectWrapper}else a&&(A="number"==typeof a?a:{width:a.width,height:a.height});const S=!!x;if(this._effectWrapper=x??new _.$({name:e,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:t,engine:c||h?.getScene().getEngine(),uniforms:i,samplers:s,uniformBuffers:C,defines:d,vertexUrl:f,indexParameters:m,blockCompilation:!0,shaderLanguage:T,extraInitializations:void 0}),this.name=e,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=h?(this._camera=h,this._scene=h.getScene(),h.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):c&&(this._engine=c,this._engine.postProcesses.push(this)),this._options=A,this.renderTargetSamplingMode=l||1,this._reusable=u||!1,this._textureType=g,this._textureFormat=v,this._shaderLanguage=T||0,this._samplers=s||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=f,this._parameters=i||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=C||[],this._indexParameters=m,!S){this._webGPUReady=1===this._shaderLanguage;const e=[];this._gatherImports(this._engine.isWebGPU&&!p.ForceGLSL,e),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(b,d,y,e)}}_gatherImports(e=!1,t){e&&this._webGPUReady?t.push(Promise.all([i.e(7653).then(i.bind(i,7653))])):t.push(Promise.all([Promise.resolve().then(i.bind(i,242))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this}useOwnOutput(){0==this._textures.length&&(this._textures=new r.L(2)),this._shareOutputWithPostProcess=null}updateEffect(e=null,t=null,i=null,s,r,n,o,a){this._effectWrapper.updateEffect(e,t,i,s,r,n,o,a),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(e,t,i=0){for(let s=0;s<this._textureCache.length;s++)if(this._textureCache[s].texture.width===e.width&&this._textureCache[s].texture.height===e.height&&this._textureCache[s].postProcessChannel===i&&this._textureCache[s].texture._generateDepthBuffer===t.generateDepthBuffer&&this._textureCache[s].texture.samples===t.samples)return this._textureCache[s].texture;const s=this._engine.createRenderTargetTexture(e,t);return this._textureCache.push({texture:s,postProcessChannel:i,lastUsedRenderId:-1}),s}_flushTextureCache(){const e=this._renderId;for(let t=this._textureCache.length-1;t>=0;t--)if(e-this._textureCache[t].lastUsedRenderId>100){let e=!1;for(let i=0;i<this._textures.length;i++)if(this._textures.data[i]===this._textureCache[t].texture){e=!0;break}e||(this._textureCache[t].texture.dispose(),this._textureCache.splice(t,1))}}resize(e,t,i=null,s=!1,r=!1){this._textures.length>0&&this._textures.reset(),this.width=e,this.height=t;let n=null;if(i)for(let e=0;e<i._postProcesses.length;e++)if(null!==i._postProcesses[e]){n=i._postProcesses[e];break}const o={width:this.width,height:this.height},a={generateMipMaps:s,generateDepthBuffer:r||n===this,generateStencilBuffer:(r||n===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(o,a,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(o,a,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let e;if(this._shareOutputWithPostProcess)e=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)e=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let t;e=this.inputTexture;for(let i=0;i<this._textureCache.length;i++)if(this._textureCache[i].texture===e){t=this._textureCache[i];break}t&&(t.lastUsedRenderId=this._renderId)}return e}activate(e,t=null,i){const s=null===e||void 0!==e.cameraRigMode?e||this._camera:null,r=s?.getScene()??e,n=r.getEngine(),o=n.getCaps().maxTextureSize,a=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,h=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0;let l=this._options.width||a,c=this._options.height||h;const u=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let _=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const e=n.currentViewport;e&&(l*=e.width,c*=e.height)}(u||this.alwaysForcePOT)&&(this._options.width||(l=n.needPOTTextures?(0,d.R)(l,o,this.scaleMode):l),this._options.height||(c=n.needPOTTextures?(0,d.R)(c,o,this.scaleMode):c)),this.width===l&&this.height===c&&(_=this._getTarget())||this.resize(l,c,s,u,i),this._textures.forEach((e=>{e.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(e,this.samples)})),this._flushTextureCache(),this._renderId++}return _||(_=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(a/l,h/c),this._engine.bindFramebuffer(_,0,a,h,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(_,0,void 0,void 0,this.forceFullscreenViewport)),this._engine._debugInsertMarker?.(`post process ${this.name} input`),this.onActivateObservable.notifyObservers(s),this.autoClear&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:r.clearColor,r._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),_}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let e;return this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),e=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",e?.texture),this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let e=this._textureCache.length-1;e>=0;e--)this._textureCache[e].texture.dispose();this._textureCache.length=0}setPrePassRenderer(e){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=e.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(e){let t;if(e=e||this._camera,this._disposeTextures(),this._scene&&(t=this._scene.postProcesses.indexOf(this),-1!==t&&this._scene.postProcesses.splice(t,1)),this._parentContainer){const e=this._parentContainer.postProcesses.indexOf(this);e>-1&&this._parentContainer.postProcesses.splice(e,1),this._parentContainer=null}if(t=this._engine.postProcesses.indexOf(this),-1!==t&&this._engine.postProcesses.splice(t,1),e){if(e.detachPostProcess(this),t=e._postProcesses.indexOf(this),0===t&&e._postProcesses.length>0){const e=this._camera._getFirstPostProcess();e&&e.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const e=l.p.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return e.customType="BABYLON."+this.getClassName(),e.cameraId=t?t.id:null,e.reusable=this._reusable,e.textureType=this._textureType,e.fragmentUrl=this._fragmentUrl,e.parameters=this._parameters,e.samplers=this._samplers,e.uniformBuffers=this._uniformBuffers,e.options=this._options,e.defines=this._postProcessDefines,e.textureFormat=this._textureFormat,e.vertexUrl=this._vertexUrl,e.indexParameters=this._indexParameters,e}clone(){const e=this.serialize();e._engine=this._engine,e.cameraId=null;const t=p.Parse(e,this._scene,"");return t?(t.onActivateObservable=this.onActivateObservable.clone(),t.onSizeChangedObservable=this.onSizeChangedObservable.clone(),t.onApplyObservable=this.onApplyObservable.clone(),t.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),t.onAfterRenderObservable=this.onAfterRenderObservable.clone(),t._prePassEffectConfiguration=this._prePassEffectConfiguration,t):null}static Parse(e,t,i){const s=(0,c.n9)(e.customType);if(!s||!s._Parse)return null;const r=t?t.getCameraById(e.cameraId):null;return s._Parse(e,r,t,i)}static _Parse(e,t,i,s){return l.p.Parse((()=>new p(e.name,e.fragmentUrl,e.parameters,e.samplers,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable,e.defines,e.textureType,e.vertexUrl,e.indexParameters,!1,e.textureFormat)),e,i,s)}}(0,s.Cg)([(0,h.lK)()],p.prototype,"uniqueId",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"name",null),(0,s.Cg)([(0,h.lK)()],p.prototype,"width",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"height",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"renderTargetSamplingMode",void 0),(0,s.Cg)([(0,h.qK)()],p.prototype,"clearColor",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"autoClear",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"forceAutoClearInAlphaMode",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"alphaMode",null),(0,s.Cg)([(0,h.lK)()],p.prototype,"alphaConstants",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"enablePixelPerfectMode",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"forceFullscreenViewport",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"scaleMode",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"alwaysForcePOT",void 0),(0,s.Cg)([(0,h.lK)("samples")],p.prototype,"_samples",void 0),(0,s.Cg)([(0,h.lK)()],p.prototype,"adaptScaleToCurrentViewport",void 0),(0,c.Y5)("BABYLON.PostProcess",p)},4271:(e,t,i)=>{"use strict";i.d(t,{B:()=>r,v:()=>s});class s{}s.NAME_EFFECTLAYER="EffectLayer",s.NAME_LAYER="Layer",s.NAME_LENSFLARESYSTEM="LensFlareSystem",s.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",s.NAME_PARTICLESYSTEM="ParticleSystem",s.NAME_GAMEPAD="Gamepad",s.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",s.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",s.NAME_PREPASSRENDERER="PrePassRenderer",s.NAME_DEPTHRENDERER="DepthRenderer",s.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",s.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",s.NAME_SPRITE="Sprite",s.NAME_SUBSURFACE="SubSurface",s.NAME_OUTLINERENDERER="Outline",s.NAME_PROCEDURALTEXTURE="ProceduralTexture",s.NAME_SHADOWGENERATOR="ShadowGenerator",s.NAME_OCTREE="Octree",s.NAME_PHYSICSENGINE="PhysicsEngine",s.NAME_AUDIO="Audio",s.NAME_FLUIDRENDERER="FluidRenderer",s.NAME_IBLCDFGENERATOR="iblCDFGenerator",s.STEP_ISREADYFORMESH_EFFECTLAYER=0,s.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,s.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,s.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,s.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,s.STEP_BEFORECAMERADRAW_PREPASS=0,s.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,s.STEP_BEFORECAMERADRAW_LAYER=2,s.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,s.STEP_BEFORERENDERTARGETDRAW_LAYER=1,s.STEP_BEFORERENDERINGMESH_PREPASS=0,s.STEP_BEFORERENDERINGMESH_OUTLINE=1,s.STEP_AFTERRENDERINGMESH_PREPASS=0,s.STEP_AFTERRENDERINGMESH_OUTLINE=1,s.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,s.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,s.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,s.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,s.STEP_BEFORECLEAR_PREPASS=1,s.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,s.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,s.STEP_AFTERRENDERTARGETDRAW_LAYER=1,s.STEP_AFTERCAMERADRAW_PREPASS=0,s.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,s.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,s.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,s.STEP_AFTERCAMERADRAW_LAYER=4,s.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,s.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,s.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,s.STEP_AFTERRENDER_AUDIO=0,s.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,s.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,s.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,s.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,s.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,s.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,s.STEP_POINTERMOVE_SPRITE=0,s.STEP_POINTERDOWN_SPRITE=0,s.STEP_POINTERUP_SPRITE=0;class r extends Array{constructor(e){super(...e)}static Create(){return Object.create(r.prototype)}registerStep(e,t,i){let s=0,r=Number.MAX_VALUE;for(;s<this.length&&(r=this[s].index,!(e<r));s++);this.splice(s,0,{index:e,component:t,action:i.bind(t)})}clear(){this.length=0}}},4272:e=>{"use strict";var t=Object.prototype.hasOwnProperty,i="~";function s(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function n(e,t,s,n,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new r(s,n||e,o),h=i?i+t:t;return e._events[h]?e._events[h].fn?e._events[h]=[e._events[h],a]:e._events[h].push(a):(e._events[h]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,s,r=[];if(0===this._eventsCount)return r;for(s in e=this._events)t.call(e,s)&&r.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=i?i+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,n=s.length,o=new Array(n);r<n;r++)o[r]=s[r].fn;return o},a.prototype.listenerCount=function(e){var t=i?i+e:e,s=this._events[t];return s?s.fn?1:s.length:0},a.prototype.emit=function(e,t,s,r,n,o){var a=i?i+e:e;if(!this._events[a])return!1;var h,l,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,s),!0;case 4:return c.fn.call(c.context,t,s,r),!0;case 5:return c.fn.call(c.context,t,s,r,n),!0;case 6:return c.fn.call(c.context,t,s,r,n,o),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,_=c.length;for(l=0;l<_;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,s);break;case 4:c[l].fn.call(c[l].context,t,s,r);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},a.prototype.on=function(e,t,i){return n(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return n(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,s,r){var n=i?i+e:e;if(!this._events[n])return this;if(!t)return o(this,n),this;var a=this._events[n];if(a.fn)a.fn!==t||r&&!a.once||s&&a.context!==s||o(this,n);else{for(var h=0,l=[],c=a.length;h<c;h++)(a[h].fn!==t||r&&!a[h].once||s&&a[h].context!==s)&&l.push(a[h]);l.length?this._events[n]=1===l.length?l[0]:l:o(this,n)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&o(this,t)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a},4292:(e,t,i)=>{"use strict";i.d(t,{b:()=>u});var s=i(4754),r=i(4049),n=i(4537),o=i(3054),a=i(1497),h=i(2213),l=i(979);class c{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new o.cP,this._onClonedObservable=new o.cP}}class u{static AddNodeConstructor(e,t){this._NodeConstructors[e]=t}static Construct(e,t,i,s){const r=this._NodeConstructors[e];return r?r(t,i,s):null}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(e){this._nodeDataStorage._doNotSerialize=e}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(e){if(this._parentNode===e)return;const t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(e){e.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getClassName(){return"Node"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(e,t=null,i=!0){this._isDirty=!1,this._nodeDataStorage=new c,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new o.cP,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=r.uq.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new o.cP,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||a.q.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),i&&this._addToSceneRootNodes()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(e,t=!1){return-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((()=>{e.attach(this)})):e.attach(this),this._behaviors.push(e)),this}removeBehavior(e){const t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(e){for(const t of this._behaviors)if(t.name===e)return t;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(e){!e&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(e,t=!0){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_updateCache(e){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(e=!1){return this._nodeDataStorage._isReady}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(e=!0){return!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((e=>{e._syncParentEnabledState()}))}setEnabled(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e))}isDescendantOf(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))}_getDescendants(e,t=!1,i){if(this._children)for(let s=0;s<this._children.length;s++){const r=this._children[s];i&&!i(r)||e.push(r),t||r._getDescendants(e,!1,i)}}getDescendants(e,t){const i=[];return this._getDescendants(i,e,t),i}getChildMeshes(e,t){const i=[];return this._getDescendants(i,e,(e=>(!t||t(e))&&void 0!==e.cullingStrategy)),i}getChildren(e,t=!0){return this.getDescendants(t,e)}_setReady(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(e){for(let t=0;t<this.animations.length;t++){const i=this.animations[t];if(i.name===e)return i}return null}createAnimationRange(e,t,i){if(!this._ranges[e]){this._ranges[e]=u._AnimationRangeFactory(e,t,i);for(let s=0,r=this.animations.length;s<r;s++)this.animations[s]&&this.animations[s].createRange(e,t,i)}}deleteAnimationRange(e,t=!0){for(let i=0,s=this.animations.length;i<s;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}clone(e,t,i){const s=l.p.Clone((()=>new u(e,this.getScene())),this);if(t&&(s.parent=t),!i){const t=this.getDescendants(!0);for(let i=0;i<t.length;i++){const r=t[i];r.clone(e+"."+r.name,s)}}return s}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}beginAnimation(e,t,i,s){const r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,i,s):null}serializeAnimationRanges(){const e=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const s={};s.name=t,s.from=i.from,s.to=i.to,e.push(s)}return e}computeWorldMatrix(e){return this._worldMatrix||(this._worldMatrix=r.uq.Identity()),this._worldMatrix}dispose(e,t=!1){if(this._nodeDataStorage._isDisposed=!0,!e){const i=this.getDescendants(!0);for(const s of i)s.dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const e of this._behaviors)e.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(e,t,i){if(t.ranges)for(let i=0;i<t.ranges.length;i++){const s=t.ranges[i];e.createAnimationRange(s.name,s.from,s.to)}}getHierarchyBoundingVectors(e=!0,t=null){let i,s;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);const n=this;if(n.getBoundingInfo&&n.subMeshes){const e=n.getBoundingInfo();i=e.boundingBox.minimumWorld.clone(),s=e.boundingBox.maximumWorld.clone()}else i=new r.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new r.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e){const e=this.getDescendants(!1);for(const n of e){const e=n;if(e.computeWorldMatrix(!0),t&&!t(e))continue;if(!e.getBoundingInfo||0===e.getTotalVertices())continue;const o=e.getBoundingInfo().boundingBox,a=o.minimumWorld,h=o.maximumWorld;r.Pq.CheckExtends(a,i,s),r.Pq.CheckExtends(h,i,s)}}return{min:i,max:s}}}u._AnimationRangeFactory=(e,t,i)=>{throw(0,h.n)("AnimationRange")},u._NodeConstructors={},(0,s.Cg)([(0,n.lK)()],u.prototype,"name",void 0),(0,s.Cg)([(0,n.lK)()],u.prototype,"id",void 0),(0,s.Cg)([(0,n.lK)()],u.prototype,"uniqueId",void 0),(0,s.Cg)([(0,n.lK)()],u.prototype,"state",void 0),(0,s.Cg)([(0,n.lK)()],u.prototype,"metadata",void 0)},4313:(e,t,i)=>{"use strict";var s=Function.prototype.call,r=Object.prototype.hasOwnProperty,n=i(4499);e.exports=n.call(s,r)},4361:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),i=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(var s in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(e,t);if(42!==n.value||!0!==n.enumerable)return!1}return!0}},4366:(e,t,i)=>{"use strict";var s=i(8158),r=i(3054),n=i(4049),o=i(6618);class a{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(e,t,i,s){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._animation=t,this._target=e,this._scene=i,this._host=s,this._activeTargets=[],t._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===o.X5.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=n.uq.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const e={frame:0,value:this._minValue};this._keys.splice(0,0,e)}if(this._target instanceof Array){let e=0;for(const t of this._target)this._preparePath(t,e),this._getOriginalValues(e),e++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const r=t.getEvents();r&&r.length>0&&r.forEach((e=>{this._events.push(e._clone())})),this._enableBlending=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(e,t=0){const i=this._animation.targetPropertyPath;if(i.length>1){let s=e;for(let e=0;e<i.length-1;e++){const t=i[e];if(s=s[t],void 0===s)throw new Error(`Invalid property (${t}) in property path (${i.join(".")})`)}this._targetPath=i[i.length-1],this._activeTargets[t]=s}else this._targetPath=i[0],this._activeTargets[t]=e;if(void 0===this._activeTargets[t][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${i.join(".")})`)}get animation(){return this._animation}reset(e=!1){if(e)if(this._target instanceof Array){let e=0;for(const t of this._target)void 0!==this._originalValue[e]&&this._setValue(t,this._activeTargets[e],this._originalValue[e],-1,e),e++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let e=0;e<this._events.length;e++)this._events[e].isDone=!1}isStopped(){return this._stopped}dispose(){const e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)}setValue(e,t){if(this._targetIsArray)for(let i=0;i<this._target.length;i++){const s=this._target[i];this._setValue(s,this._activeTargets[i],e,t,i)}else this._setValue(this._target,this._directTarget,e,t,0)}_getOriginalValues(e=0){let t;const i=this._activeTargets[e];t=i.getLocalMatrix&&"_matrix"===this._targetPath?i.getLocalMatrix():i[this._targetPath],t&&t.clone?this._originalValue[e]=t.clone():this._originalValue[e]=t}_registerTargetForLateAnimationBinding(e,t){const i=e.target;this._scene._registeredForLateAnimationBindings.pushNoDuplicate(i),i._lateAnimationHolders||(i._lateAnimationHolders={}),i._lateAnimationHolders[e.targetPath]||(i._lateAnimationHolders[e.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:t}),e.isAdditive?(i._lateAnimationHolders[e.targetPath].additiveAnimations.push(e),i._lateAnimationHolders[e.targetPath].totalAdditiveWeight+=e.weight):(i._lateAnimationHolders[e.targetPath].animations.push(e),i._lateAnimationHolders[e.targetPath].totalWeight+=e.weight)}_setValue(e,t,i,s,r){if(this._currentActiveTarget=t,this._weight=s,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const e=t[this._targetPath];e.clone?this._originalBlendValue=e.clone():this._originalBlendValue=e}this._originalBlendValue.m?o.X5.AllowMatrixDecomposeForInterpolation?this._currentValue?n.uq.DecomposeLerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=n.uq.DecomposeLerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue?n.uq.LerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=n.uq.Lerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue=o.X5._UniversalLerp(this._originalBlendValue,i,this._blendingFactor);const s=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=s}else this._currentValue?this._currentValue.copyFrom?this._currentValue.copyFrom(i):this._currentValue=i:this._currentValue=i?.clone?i.clone():i;-1!==s?this._registerTargetForLateAnimationBinding(this,this._originalValue[r]):this._animationState.loopMode===o.X5.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[r],t[this._targetPath]):t[this._targetPath]=this._originalValue[r]+this._currentValue:t[this._targetPath]=this._currentValue,e.markAsDirty&&e.markAsDirty(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(e,t=-1){const i=this._animation.getKeys();e<i[0].frame?e=i[0].frame:e>i[i.length-1].frame&&(e=i[i.length-1].frame);const s=this._events;if(s.length)for(let t=0;t<s.length;t++)s[t].onlyOnce||(s[t].isDone=s[t].frame<e);this._currentFrame=e;const r=this._animation._interpolate(e,this._animationState);this.setValue(r,t)}_prepareForSpeedRatioChange(e){const t=this._previousElapsedTime*(this._animation.framePerSecond*e)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-t}animate(e,t,i,s,r,n=-1){const a=this._animation,h=a.targetPropertyPath;if(!h||h.length<1)return this._stopped=!0,!1;let l=!0;(t<this._minFrame||t>this._maxFrame)&&(t=this._minFrame),(i<this._minFrame||i>this._maxFrame)&&(i=this._maxFrame);const c=i-t;let u,d=e*(a.framePerSecond*r)/1e3+this._absoluteFrameOffset,_=0,p=!1;const g=s&&this._animationState.loopMode===o.X5.ANIMATIONLOOPMODE_YOYO;if(g){const e=(d-t)/c,i=Math.sin(e*Math.PI);d=Math.abs(i)*c+t;const s=i>=0?1:-1;this._yoyoDirection!==s&&(p=!0),this._yoyoDirection=s}if(this._previousElapsedTime=e,this._previousAbsoluteFrame=d,!s&&i>=t&&(d>=c&&r>0||d<=0&&r<0))l=!1,_=a._getKeyValue(this._maxValue);else if(!s&&t>=i&&(d<=c&&r<0||d>=0&&r>0))l=!1,_=a._getKeyValue(this._minValue);else if(this._animationState.loopMode!==o.X5.ANIMATIONLOOPMODE_CYCLE){const e=i.toString()+t.toString();if(!this._offsetsCache[e]){this._animationState.repeatCount=0,this._animationState.loopMode=o.X5.ANIMATIONLOOPMODE_CYCLE;const s=a._interpolate(t,this._animationState),r=a._interpolate(i,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),a.dataType){case o.X5.ANIMATIONTYPE_FLOAT:this._offsetsCache[e]=r-s;break;case o.X5.ANIMATIONTYPE_QUATERNION:case o.X5.ANIMATIONTYPE_VECTOR3:case o.X5.ANIMATIONTYPE_VECTOR2:case o.X5.ANIMATIONTYPE_SIZE:case o.X5.ANIMATIONTYPE_COLOR3:this._offsetsCache[e]=r.subtract(s)}this._highLimitsCache[e]=r}_=this._highLimitsCache[e],u=this._offsetsCache[e]}if(void 0===u)switch(a.dataType){case o.X5.ANIMATIONTYPE_FLOAT:u=0;break;case o.X5.ANIMATIONTYPE_QUATERNION:u=o.s$;break;case o.X5.ANIMATIONTYPE_VECTOR3:u=o.y4;break;case o.X5.ANIMATIONTYPE_VECTOR2:u=o.rq;break;case o.X5.ANIMATIONTYPE_SIZE:u=o.vF;break;case o.X5.ANIMATIONTYPE_COLOR3:u=o.eA;break;case o.X5.ANIMATIONTYPE_COLOR4:u=o.nl}let f;if(this._host&&this._host.syncRoot){const e=this._host.syncRoot;f=t+c*((e.masterFrame-e.fromFrame)/(e.toFrame-e.fromFrame))}else f=d>0&&t>i||d<0&&t<i?l&&0!==c?i+d%c:t:l&&0!==c?t+d%c:i;const m=this._events;if(!g&&(r>0&&this.currentFrame>f||r<0&&this.currentFrame<f)||g&&p){this._onLoop();for(let e=0;e<m.length;e++)m[e].onlyOnce||(m[e].isDone=!1);this._animationState.key=r>0?0:a.getKeys().length-1}this._currentFrame=f,this._animationState.repeatCount=0===c?0:d/c|0,this._animationState.highLimitValue=_,this._animationState.offsetValue=u;const b=a._interpolate(f,this._animationState);if(this.setValue(b,n),m.length)for(let e=0;e<m.length;e++)if(c>=0&&f>=m[e].frame&&m[e].frame>=t||c<0&&f<=m[e].frame&&m[e].frame<=t){const t=m[e];t.isDone||(t.onlyOnce&&(m.splice(e,1),e--),t.isDone=!0,t.action(f))}return l||(this._stopped=!0),l}}var h,l,c=i(8827);class u{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(e){this._weight=-1!==e?Math.min(Math.max(e,0),1):-1}get speedRatio(){return this._speedRatio}set speedRatio(e){for(let t=0;t<this._runtimeAnimations.length;t++)this._runtimeAnimations[t]._prepareForSpeedRatioChange(e);this._speedRatio=e,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(e,t,i=0,s=100,n=!1,o=1,a,h,l,c=!1,u=0){this.target=t,this.fromFrame=i,this.toFrame=s,this.loopAnimation=n,this.onAnimationEnd=a,this.onAnimationLoop=l,this.isAdditive=c,this.playOrder=u,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._previousWeight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new r.cP,this.onAnimationLoopObservable=new r.cP,this._scene=e,h&&this.appendAnimations(t,h),this._speedRatio=o,e._activeAnimatables.push(this)}syncWith(e){if(this._syncRoot=e,e){const e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(e,t){for(let i=0;i<t.length;i++){const s=t[i],r=new a(e,s,this._scene,this);r._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(r)}}getAnimationByTargetProperty(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i].animation;return null}getRuntimeAnimationByTargetProperty(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i];return null}reset(){const e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)t[i].animation.enableBlending=!0,t[i].animation.blendingSpeed=e}disableBlending(){const e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].animation.enableBlending=!1}goToFrame(e,t=!1){const i=this._runtimeAnimations;if(i[0]){const t=i[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??i[0].currentFrame;const s=0===this.speedRatio?0:(e-this._frameToSyncFromJump)/t*1e3/this.speedRatio;this._manualJumpDelay=-s}for(let s=0;s<i.length;s++)i[s].goToFrame(e,t?this._weight:-1);this._goToFrame=e}get paused(){return this._paused}pause(){this._paused||(this._paused=!0)}restart(){this._paused=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(e,t,i=!1,s=!1){if(e||t){const r=this._scene._activeAnimatables.indexOf(this);if(r>-1){const n=this._runtimeAnimations;for(let i=n.length-1;i>=0;i--){const s=n[i];e&&s.animation.name!=e||t&&!t(s.target)||(s.dispose(),n.splice(i,1))}0==n.length&&(i||this._scene._activeAnimatables.splice(r,1),s||this._raiseOnAnimationEnd())}}else{const e=this._scene._activeAnimatables.indexOf(this);if(e>-1){i||this._scene._activeAnimatables.splice(e,1);const t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].dispose();this._runtimeAnimations.length=0,s||this._raiseOnAnimationEnd()}}}waitAsync(){return new Promise((e=>{this.onAnimationEndObservable.add((()=>{e(this)}),void 0,void 0,this,!0)}))}_animate(e){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight&&0===this._previousWeight)return!0;this._previousWeight=this._weight;let t=!1;const i=this._runtimeAnimations;let s;for(s=0;s<i.length;s++){const r=i[s].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);t=t||r}if(this.animationStarted=t,!t){if(this.disposeOnEnd)for(s=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(s,1),s=0;s<i.length;s++)i[s].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return t}}function d(e){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return e.originalValue;let t=1;const i=n.AA.Vector3[0],s=n.AA.Vector3[1],r=n.AA.Quaternion[0];let o=0;const a=e.animations[0],h=e.originalValue;let l=1,c=!1;if(e.totalWeight<1)l=1-e.totalWeight,h.decompose(s,r,i);else{if(o=1,t=e.totalWeight,l=a.weight/t,1==l){if(!e.totalAdditiveWeight)return a.currentValue;c=!0}a.currentValue.decompose(s,r,i)}if(!c){s.scaleInPlace(l),i.scaleInPlace(l),r.scaleInPlace(l);for(let a=o;a<e.animations.length;a++){const o=e.animations[a];if(0===o.weight)continue;l=o.weight/t;const h=n.AA.Vector3[2],c=n.AA.Vector3[3],u=n.AA.Quaternion[1];o.currentValue.decompose(c,u,h),c.scaleAndAddToRef(l,s),u.scaleAndAddToRef(n.PT.Dot(r,u)>0?l:-l,r),h.scaleAndAddToRef(l,i)}r.normalize()}for(let t=0;t<e.additiveAnimations.length;t++){const o=e.additiveAnimations[t];if(0===o.weight)continue;const a=n.AA.Vector3[2],h=n.AA.Vector3[3],l=n.AA.Quaternion[1];o.currentValue.decompose(h,l,a),h.multiplyToRef(s,h),n.Pq.LerpToRef(s,h,o.weight,s),r.multiplyToRef(l,l),n.PT.SlerpToRef(r,l,o.weight,r),a.scaleAndAddToRef(o.weight,i)}const u=a?a._animationState.workValue:n.AA.Matrix[0].clone();return n.uq.ComposeToRef(s,r,i,u),u}function _(e,t){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return t;const i=e.animations[0],s=e.originalValue;let r=t;if(0===e.totalWeight&&e.totalAdditiveWeight>0)r.copyFrom(s);else if(1===e.animations.length){if(n.PT.SlerpToRef(s,i.currentValue,Math.min(1,e.totalWeight),r),0===e.totalAdditiveWeight)return r}else if(e.animations.length>1){let i,o,a=1;if(e.totalWeight<1){const t=1-e.totalWeight;i=[],o=[],i.push(s),o.push(t)}else{if(2===e.animations.length&&(n.PT.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,t),0===e.totalAdditiveWeight))return t;i=[],o=[],a=e.totalWeight}for(let t=0;t<e.animations.length;t++){const s=e.animations[t];i.push(s.currentValue),o.push(s.weight/a)}let h=0;for(let e=0;e<i.length;)e?(h+=o[e],n.PT.SlerpToRef(r,i[e],o[e]/h,r),e++):(n.PT.SlerpToRef(i[e],i[e+1],o[e+1]/(o[e]+o[e+1]),t),r=t,h=o[e]+o[e+1],e+=2)}for(let t=0;t<e.additiveAnimations.length;t++){const i=e.additiveAnimations[t];0!==i.weight&&(r.multiplyToRef(i.currentValue,n.AA.Quaternion[0]),n.PT.SlerpToRef(r,n.AA.Quaternion[0],i.weight,r))}return r}h=i(8836).Z,(l=s.$)&&(l.prototype.copyAnimationRange=function(e,t,i,s=!1,r=null){0===this.animations.length&&(this.animations.push(new o.X5(this.name,"_matrix",e.animations[0].framePerSecond,o.X5.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const n=e.animations[0].getRange(t);if(!n)return!1;const a=n.from,h=n.to,l=e.animations[0].getKeys(),c=e.length,u=e.getParent(),d=this.getParent(),_=s&&u&&c&&this.length&&c!==this.length,p=_&&d&&u?d.length/u.length:1,g=s&&!d&&r&&(1!==r.x||1!==r.y||1!==r.z),f=this.animations[0].getKeys();let m,b,v;for(let e=0,t=l.length;e<t;e++)m=l[e],m.frame>=a&&m.frame<=h&&(s?(v=m.value.clone(),_?(b=v.getTranslation(),v.setTranslation(b.scaleInPlace(p))):g&&r?(b=v.getTranslation(),v.setTranslation(b.multiplyInPlace(r))):v=m.value):v=m.value,f.push({frame:m.frame+i,value:v}));return this.animations[0].createRange(t,a+i,h+i),!0}),h&&(h.prototype._animate=function(e){if(!this.animationsEnabled)return;const t=c.j.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}this.deltaTime=void 0!==e?e:this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=t;const i=this._activeAnimatables;if(0===i.length)return;this._animationTime+=this.deltaTime;const s=this._animationTime;for(let e=0;e<i.length;e++){const t=i[e];!t._animate(s)&&t.disposeOnEnd&&e--}!function(e){if(e._registeredForLateAnimationBindings.length){for(let t=0;t<e._registeredForLateAnimationBindings.length;t++){const i=e._registeredForLateAnimationBindings.data[t];for(const e in i._lateAnimationHolders){const t=i._lateAnimationHolders[e],s=t.animations[0],r=t.originalValue;if(null==r)continue;const a=o.X5.AllowMatrixDecomposeForInterpolation&&r.m;let h=i[e];if(a)h=d(t);else if(void 0!==r.w)h=_(t,h||n.PT.Identity());else{let e=0,i=1;const n=s&&s._animationState.loopMode===o.X5.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(t.totalWeight<1)h=n?r.clone?r.clone():r:s&&r.scale?r.scale(1-t.totalWeight):s?r*(1-t.totalWeight):r.clone?r.clone():r;else if(s){i=t.totalWeight;const o=s.weight/i;h=1!==o?s.currentValue.scale?s.currentValue.scale(o):s.currentValue*o:s.currentValue,n&&(h.addToRef?h.addToRef(r,h):h+=r),e=1}for(let s=e;s<t.animations.length;s++){const e=t.animations[s],r=e.weight/i;r&&(e.currentValue.scaleAndAddToRef?e.currentValue.scaleAndAddToRef(r,h):h+=e.currentValue*r)}for(let e=0;e<t.additiveAnimations.length;e++){const i=t.additiveAnimations[e],s=i.weight;s&&(i.currentValue.scaleAndAddToRef?i.currentValue.scaleAndAddToRef(s,h):h+=i.currentValue*s)}}i[e]=h}i._lateAnimationHolders={}}e._registeredForLateAnimationBindings.reset()}}(this)},h.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((e,t)=>e.playOrder-t.playOrder))},h.prototype.beginWeightedAnimation=function(e,t,i,s=1,r,n=1,o,a,h,l,c=!1){const u=this.beginAnimation(e,t,i,r,n,o,a,!1,h,l,c);return u.weight=s,u},h.prototype.beginAnimation=function(e,t,i,s,r=1,n,o,a=!0,h,l,c=!1){if(r<0){const e=t;t=i,i=e,r=-r}t>i&&(r=-r),a&&this.stopAnimation(e,void 0,h),o||(o=new u(this,e,t,i,s,r,n,void 0,l,c));const d=!h||h(e);if(e.animations&&d&&o.appendAnimations(e,e.animations),e.getAnimatables){const c=e.getAnimatables();for(let e=0;e<c.length;e++)this.beginAnimation(c[e],t,i,s,r,n,o,a,h,l)}return o.reset(),o},h.prototype.beginHierarchyAnimation=function(e,t,i,s,r,n=1,o,a,h=!0,l,c,u=!1){const d=e.getDescendants(t),_=[];_.push(this.beginAnimation(e,i,s,r,n,o,a,h,l,void 0,u));for(const e of d)_.push(this.beginAnimation(e,i,s,r,n,o,a,h,l,void 0,u));return _},h.prototype.beginDirectAnimation=function(e,t,i,s,r,n=1,o,a,h=!1){if(n<0){const e=i;i=s,s=e,n=-n}return i>s&&(n=-n),new u(this,e,i,s,r,n,o,t,a,h)},h.prototype.beginDirectHierarchyAnimation=function(e,t,i,s,r,n,o,a,h,l=!1){const c=e.getDescendants(t),u=[];u.push(this.beginDirectAnimation(e,i,s,r,n,o,a,h,l));for(const e of c)u.push(this.beginDirectAnimation(e,i,s,r,n,o,a,h,l));return u},h.prototype.getAnimatableByTarget=function(e){for(let t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},h.prototype.getAllAnimatablesByTarget=function(e){const t=[];for(let i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].target===e&&t.push(this._activeAnimatables[i]);return t},h.prototype.stopAnimation=function(e,t,i){const s=this.getAllAnimatablesByTarget(e);for(const e of s)e.stop(t,i)},h.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const e of this.animationGroups)e.stop()})},4459:(e,t,i)=>{"use strict";i.d(t,{F:()=>l});var s=i(4754),r=i(4537),n=i(9642),o=i(4049),a=i(7761),h=i(6871);i(4292).b.AddNodeConstructor("TargetCamera",((e,t)=>()=>new l(e,o.Pq.Zero(),t)));class l extends n.i{constructor(e,t,i,s=!0){super(e,t,i,s),this._tmpUpVector=o.Pq.Zero(),this._tmpTargetVector=o.Pq.Zero(),this.cameraDirection=new o.Pq(0,0,0),this.cameraRotation=new o.I9(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new o.PT,this.rotation=new o.Pq(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=o.Pq.Zero(),this._initialFocalDistance=1,this._viewMatrix=o.uq.Zero(),this._camMatrix=o.uq.Zero(),this._cameraTransformMatrix=o.uq.Zero(),this._cameraRotationMatrix=o.uq.Zero(),this._referencePoint=new o.Pq(0,0,1),this._transformedReferencePoint=o.Pq.Zero(),this._deferredPositionUpdate=new o.Pq,this._deferredRotationQuaternionUpdate=new o.PT,this._deferredRotationUpdate=new o.Pq,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=o.Pq.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(e){this.getWorldMatrix();const t=o.AA.Vector3[0],i=o.AA.Vector3[1];return i.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(i,t),t.scaleInPlace(e),this.globalPosition.add(t)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const e=this.lockedTarget;e.computeWorldMatrix().getTranslationToRef(e.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new o.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new o.PT(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(e){e||super._updateCache();const t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))}setTarget(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=a.bH),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),o.uq.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const t=e.subtract(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&o.PT.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(e){this.setTarget(e)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(o.AA.Matrix[0]),o.Pq.TransformNormalToRef(this.cameraDirection,o.AA.Matrix[0],o.AA.Vector3[0]),this._deferredPositionUpdate.addInPlace(o.AA.Vector3[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate)}_checkInputs(){const e=this.invertRotation?-this.inverseRotationSpeed:1,t=this._decideIfNeedsToMove(),i=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.copyFrom(this.rotation),this._deferredPositionUpdate.copyFrom(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.copyFrom(this.rotationQuaternion),t&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*e,this._deferredRotationUpdate.y+=this.cameraRotation.y*e,!this.noRotationConstraint){const e=1.570796;this._deferredRotationUpdate.x>e&&(this._deferredRotationUpdate.x=e),this._deferredRotationUpdate.x<-e&&(this._deferredRotationUpdate.x=-e)}this._deferOnly?this._deferredUpdated=!0:this.rotation.copyFrom(this._deferredRotationUpdate),this.rotationQuaternion&&this._deferredRotationUpdate.lengthSquared()&&(o.PT.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate))}t&&(Math.abs(this.cameraDirection.x)<this.speed*a.bH&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*a.bH&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*a.bH&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*a.bH&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*a.bH&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):o.uq.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return o.Pq.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),o.Pq.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?h._0.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(o.PT.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),h._0.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(e,t,i){if(this.ignoreParentScaling){if(this.parent){const s=this.parent.getWorldMatrix();o.Pq.TransformCoordinatesToRef(e,s,this._globalPosition),o.Pq.TransformCoordinatesToRef(t,s,this._tmpTargetVector),o.Pq.TransformNormalToRef(i,s,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(t),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?o.uq.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):o.uq.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?o.uq.LookAtRHToRef(e,t,i,this._viewMatrix):o.uq.LookAtLHToRef(e,t,i,this._viewMatrix),this.parent){const e=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(e,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)}createRigCamera(e,t){if(this.cameraRigMode!==n.i.RIG_MODE_NONE){const t=new l(e,this.position.clone(),this.getScene());return t.isRigCamera=!0,t.rigParent=this,this.cameraRigMode===n.i.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new o.PT),t._cameraRigParams={},t.rotationQuaternion=new o.PT),t.mode=this.mode,t.orthoLeft=this.orthoLeft,t.orthoRight=this.orthoRight,t.orthoTop=this.orthoTop,t.orthoBottom=this.orthoBottom,t}return null}_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case n.i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case n.i.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.i.RIG_MODE_STEREOSCOPIC_INTERLACED:{const i=this.cameraRigMode===n.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,s=this.cameraRigMode===n.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*s,t);break}case n.i.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(e,t){this.getTarget().subtractToRef(this.position,l._TargetFocalPoint),l._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const i=l._TargetFocalPoint.addInPlace(this.position);o.uq.TranslationToRef(-i.x,-i.y,-i.z,l._TargetTransformMatrix),l._TargetTransformMatrix.multiplyToRef(o.uq.RotationAxis(t.upVector,e),l._RigCamTransformMatrix),o.uq.TranslationToRef(i.x,i.y,i.z,l._TargetTransformMatrix),l._RigCamTransformMatrix.multiplyToRef(l._TargetTransformMatrix,l._RigCamTransformMatrix),o.Pq.TransformCoordinatesToRef(this.position,l._RigCamTransformMatrix,t.position),t.setTarget(i)}getClassName(){return"TargetCamera"}}l._RigCamTransformMatrix=new o.uq,l._TargetTransformMatrix=new o.uq,l._TargetFocalPoint=new o.Pq,(0,s.Cg)([(0,r.lK)()],l.prototype,"ignoreParentScaling",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"updateUpVectorFromRotation",void 0),(0,s.Cg)([(0,r.P_)()],l.prototype,"rotation",void 0),(0,s.Cg)([(0,r.lK)()],l.prototype,"speed",void 0),(0,s.Cg)([(0,r.xG)("lockedTargetId")],l.prototype,"lockedTarget",void 0)},4499:(e,t,i)=>{"use strict";var s=i(5845);e.exports=Function.prototype.bind||s},4513:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.bakedVertexAnimationDeclaration="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;uniform vec2 bakedVertexAnimationTextureSizeInverted;uniform vec4 bakedVertexAnimationSettings;uniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{float offset=index*4.0;float frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;float dx=bakedVertexAnimationTextureSizeInverted.x;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));return mat4(m0,m1,m2,m3);}\n#endif\n"},4526:(e,t,i)=>{"use strict";i.r(t),i.d(t,{_ENVTextureLoader:()=>r});var s=i(2036);class r{constructor(){this.supportCascades=!1}loadCubeData(e,t,i,r,n){if(Array.isArray(e))return;const o=(0,s.cU)(e);if(o){t.width=o.width,t.height=o.width;try{(0,s.ow)(t,o),(0,s.o5)(t,e,o).then((()=>{t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),r&&r()}),(e=>{n?.("Can not upload environment levels",e)}))}catch(e){n?.("Can not upload environment file",e)}}else n&&n("Can not parse the environment file",null)}loadData(){throw".env not supported in 2d."}}},4537:(e,t,i)=>{"use strict";i.d(t,{$z:()=>n,Cx:()=>b,GG:()=>m,P_:()=>u,WM:()=>c,Y9:()=>l,bR:()=>f,jT:()=>h,lK:()=>o,n1:()=>g,qK:()=>p,uM:()=>a,wL:()=>_,xG:()=>d});var s=i(6706);function r(e,t){return(i,r)=>{const n=(0,s.B)(i);n[r]||(n[r]={type:e,sourceName:t})}}function n(e,t=null){return function(e,t=null){return(i,s)=>{const r=t||"_"+s;Object.defineProperty(i,s,{get:function(){return this[r]},set:function(t){"function"==typeof this.equals&&this.equals(t)||this[r]!==t&&(this[r]=t,i[e].apply(this))},enumerable:!0,configurable:!0})}}(e,t)}function o(e){return r(0,e)}function a(e){return r(1,e)}function h(e){return r(2,e)}function l(e){return r(3,e)}function c(e){return r(4,e)}function u(e){return r(5,e)}function d(e){return r(6,e)}function _(e){return r(7,e)}function p(e){return r(8,e)}function g(e){return r(9,e)}function f(e){return r(10,e)}function m(e){return r(12,e)}function b(e,t,i,s){const r=i.value;i.value=(...i)=>{let n=r;if("undefined"!=typeof _native&&_native[t]){const e=_native[t];n=s?(...t)=>s(...t)?e(...t):r(...t):e}return e[t]=n,n(...i)}}b.filter=function(e){return(t,i,s)=>b(t,i,s,e)}},4564:(e,t,i)=>{"use strict";i.d(t,{i:()=>f});var s=i(4754),r=i(4537),n=i(9732),o=i(3054),a=i(1497),h=i(9593),l=i(7893),c=i(3039),u=i(2050),d=i(2558),_=i(979);class p{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(e){this._func=e}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef=e}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask=e}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail=e}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail=e}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass=e}get mask(){return this._mask}set mask(e){this._mask=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}getClassName(){return"MaterialStencilState"}copyTo(e){_.p.Clone((()=>e),this)}serialize(){return _.p.Serialize(this)}parse(e,t,i){_.p.Parse((()=>this),e,t,i)}}(0,s.Cg)([(0,r.lK)()],p.prototype,"func",null),(0,s.Cg)([(0,r.lK)()],p.prototype,"funcRef",null),(0,s.Cg)([(0,r.lK)()],p.prototype,"funcMask",null),(0,s.Cg)([(0,r.lK)()],p.prototype,"opStencilFail",null),(0,s.Cg)([(0,r.lK)()],p.prototype,"opDepthFail",null),(0,s.Cg)([(0,r.lK)()],p.prototype,"opStencilDepthPass",null),(0,s.Cg)([(0,r.lK)()],p.prototype,"mask",null),(0,s.Cg)([(0,r.lK)()],p.prototype,"enabled",null);var g=i(5241);class f{get _supportGlowLayer(){return!1}set _glowModeEnabled(e){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(e){if(this._alpha===e)return;const t=this._alpha;this._alpha=e,1!==t&&1!==e||this.markAsDirty(f.MiscDirtyFlag+f.PrePassDirtyFlag)}get alpha(){return this._alpha}set backFaceCulling(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(f.TextureDirtyFlag))}get backFaceCulling(){return this._backFaceCulling}set cullBackFaces(e){this._cullBackFaces!==e&&(this._cullBackFaces=e,this.markAsDirty(f.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.markDirty())}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new o.cP),this._onBindObservable}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new o.cP),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new o.cP),this._onEffectCreatedObservable}set alphaMode(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(f.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(f.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case f.WireFrameFillMode:case f.LineListDrawMode:case f.LineLoopDrawMode:case f.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(e){this.fillMode=e?f.WireFrameFillMode:f.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case f.PointFillMode:case f.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(e){this.fillMode=e?f.PointFillMode:f.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(f.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){const t=this.getScene().getEngine().getCaps().fragmentDepthSupported;e&&!t&&c.V.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(e){this._drawWrapper=e}constructor(e,t,i,s=!1){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new o.cP,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new p,this._useUBO=!1,this._fillMode=f.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=e;const r=t||a.q.LastCreatedScene;r&&(this._scene=r,this._dirtyCallbacks={},this._forceGLSL=s,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=e||n.S0.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new d.E(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new l.D(this._scene.getEngine(),void 0,void 0,e),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,this._createUniformBuffer(),i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),f.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){const e=this.getScene().getEngine();this._uniformBuffer?.dispose(),e.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new l.D(e,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new l.D(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(e){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.markDirty(),this.checkReadyOnlyOnce=!0}unfreeze(){this.markDirty(),this.checkReadyOnlyOnce=!1}isReady(e,t){return!0}isReadyForSubMesh(e,t,i){const s=t.materialDefines;return!!s&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=s,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}getScene(){return this._scene}_getEffectiveOrientation(e){return null!==this.sideOrientation?this.sideOrientation:e.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===f.MATERIAL_ALPHABLEND||this._transparencyMode===f.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===f.MATERIAL_ALPHATEST||this._transparencyMode===f.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===f.MATERIAL_OPAQUE||this._transparencyMode===f.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(e){return this._hasTransparencyMode?this._transparencyModeIsBlend:e.visibility<1||!this._disableAlphaBlending&&(e.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(e){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}markDirty(e=!1){const t=this.getScene().meshes;for(const i of t)if(i.subMeshes)for(const t of i.subMeshes)if(t.getMaterial()===this)for(const i of t._drawWrappers)i&&this._materialContext===i.materialContext&&(i._wasPreviouslyReady=!1,i._wasPreviouslyUsingInstances=null,i._forceRebindOnNextCall=e);e&&this.markAsDirty(f.AllDirtyFlag)}_preBind(e,t=null){const i=this._scene.getEngine(),s=(null==t?this.sideOrientation:t)===f.ClockWiseSideOrientation;return i.enableEffect(e||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,s,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),s}bind(e,t){}buildUniformLayout(){const e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(8,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(e,t,i){const s=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),s._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(e){}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}bindEyePosition(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}_afterBind(e,t=null,i){if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,(0,g._8)(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){const e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){const e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(0!==this.depthFunction){const e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}}unbind(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState),this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(e){return null}_clonePlugins(e,t){const i={};if(this._serializePlugins(i),f._ParsePlugins(i,e,this._scene,t),this.pluginManager)for(const t of this.pluginManager._plugins){const i=e.pluginManager.getPlugin(t.name);i&&t.copyTo(i)}}getBindedMeshes(){if(this.meshMap){const e=[];for(const t in this.meshMap){const i=this.meshMap[t];i&&e.push(i)}return e}return this._scene.meshes.filter((e=>e.material===this))}forceCompilation(e,t,i,s){const r={clipPlane:!1,useInstances:!1,...i},n=this.getScene(),o=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const a=()=>{if(!this._scene||!this._scene.getEngine())return;const i=n.clipPlane;if(r.clipPlane&&(n.clipPlane=new u.Z(0,0,0,1)),this._storeEffectOnSubMeshes){let i=!0,n=null;if(e.subMeshes){const t=new h.K(0,0,0,0,0,e,void 0,!1,!1);t.materialDefines&&(t.materialDefines._renderId=-1),this.isReadyForSubMesh(e,t,r.useInstances)||(t.effect&&t.effect.getCompilationError()&&t.effect.allFallbacksProcessed()?n=t.effect.getCompilationError():(i=!1,setTimeout(a,16)))}i&&(this.allowShaderHotSwapping=o,n&&s&&s(n),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=o,t&&t(this)):setTimeout(a,16);r.clipPlane&&(n.clipPlane=i)};a()}forceCompilationAsync(e,t){return new Promise(((i,s)=>{this.forceCompilation(e,(()=>{i()}),t,(e=>{s(e)}))}))}markAsDirty(e){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(f._DirtyCallbackArray.length=0,e&f.TextureDirtyFlag&&f._DirtyCallbackArray.push(f._TextureDirtyCallBack),e&f.LightDirtyFlag&&f._DirtyCallbackArray.push(f._LightsDirtyCallBack),e&f.FresnelDirtyFlag&&f._DirtyCallbackArray.push(f._FresnelDirtyCallBack),e&f.AttributesDirtyFlag&&f._DirtyCallbackArray.push(f._AttributeDirtyCallBack),e&f.MiscDirtyFlag&&f._DirtyCallbackArray.push(f._MiscDirtyCallBack),e&f.PrePassDirtyFlag&&f._DirtyCallbackArray.push(f._PrePassDirtyCallBack),f._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(f._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}resetDrawCache(){const e=this.getScene().meshes;for(const t of e)if(t.subMeshes)for(const e of t.subMeshes)e.getMaterial()===this&&e.resetDrawCache()}_markAllSubMeshesAsDirty(e){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.getScene().meshes;for(const i of t)if(i.subMeshes)for(const t of i.subMeshes)if(t.getMaterial(!1)===this)for(const i of t._drawWrappers)i&&i.defines&&i.defines.markAllAsDirty&&this._materialContext===i.materialContext&&e(i.defines)}_markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(f._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(f._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(f._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(f._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(f._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(f._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(f._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(f._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(f._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(f._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const e=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.onDisposeObservable.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)}))}}setPrePassRenderer(e){return!1}dispose(e,t,i){const s=this.getScene();if(s.stopAnimation(this),s.freeProcessedMaterials(),s.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const e=this._parentContainer.materials.indexOf(this);e>-1&&this._parentContainer.materials.splice(e,1),this._parentContainer=null}if(!0!==i)if(this.meshMap)for(const e in this.meshMap){const t=this.meshMap[e];this._disposeMeshResources(t)}else{const e=s.meshes;for(const t of e)this._disposeMeshResources(t)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(e){if(!e)return;const t=e.geometry,i=e._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(e.subMeshes&&i)for(const s of e.subMeshes){const e=s._drawWrappers;for(let r=0;r<e.length;r++){const n=e[r]?.effect;n&&(i[r]===this&&(t?._releaseVertexArrayObject(n),s._removeDrawWrapper(r,!0,!0)))}}}else t?._releaseVertexArrayObject(this._drawWrapper.effect);e.material!==this||e.sourceMesh||(e.material=null)}serialize(){const e=_.p.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,this._serializePlugins(e),e}_serializePlugins(e){if(e.plugins={},this.pluginManager)for(const t of this.pluginManager._plugins)t.doNotSerialize||(e.plugins[t.getClassName()]=t.serialize())}static Parse(e,t,i){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return c.V.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";const s=n.S0.Instantiate(e.customType).Parse(e,t,i);return s._loadedUniqueId=e.uniqueId,s}static _ParsePlugins(e,t,i,s){if(e.plugins)for(const r in e.plugins){const o=e.plugins[r];let a=t.pluginManager?.getPlugin(o.name);if(!a){const e=n.S0.Instantiate("BABYLON."+r);e&&(a=new e(t))}a?.parse(o,i,s)}}}f.TriangleFillMode=0,f.WireFrameFillMode=1,f.PointFillMode=2,f.PointListDrawMode=3,f.LineListDrawMode=4,f.LineLoopDrawMode=5,f.LineStripDrawMode=6,f.TriangleStripDrawMode=7,f.TriangleFanDrawMode=8,f.ClockWiseSideOrientation=0,f.CounterClockWiseSideOrientation=1,f.TextureDirtyFlag=1,f.LightDirtyFlag=2,f.FresnelDirtyFlag=4,f.AttributesDirtyFlag=8,f.MiscDirtyFlag=16,f.PrePassDirtyFlag=32,f.AllDirtyFlag=63,f.MATERIAL_OPAQUE=0,f.MATERIAL_ALPHATEST=1,f.MATERIAL_ALPHABLEND=2,f.MATERIAL_ALPHATESTANDBLEND=3,f.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,f.MATERIAL_NORMALBLENDMETHOD_RNM=1,f.OnEventObservable=new o.cP,f._AllDirtyCallBack=e=>e.markAllAsDirty(),f._ImageProcessingDirtyCallBack=e=>e.markAsImageProcessingDirty(),f._TextureDirtyCallBack=e=>e.markAsTexturesDirty(),f._FresnelDirtyCallBack=e=>e.markAsFresnelDirty(),f._MiscDirtyCallBack=e=>e.markAsMiscDirty(),f._PrePassDirtyCallBack=e=>e.markAsPrePassDirty(),f._LightsDirtyCallBack=e=>e.markAsLightDirty(),f._AttributeDirtyCallBack=e=>e.markAsAttributesDirty(),f._FresnelAndMiscDirtyCallBack=e=>{f._FresnelDirtyCallBack(e),f._MiscDirtyCallBack(e)},f._TextureAndMiscDirtyCallBack=e=>{f._TextureDirtyCallBack(e),f._MiscDirtyCallBack(e)},f._DirtyCallbackArray=[],f._RunDirtyCallBacks=e=>{for(const t of f._DirtyCallbackArray)t(e)},(0,s.Cg)([(0,r.lK)()],f.prototype,"id",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"uniqueId",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"name",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"metadata",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"checkReadyOnEveryCall",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"checkReadyOnlyOnce",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"state",void 0),(0,s.Cg)([(0,r.lK)("alpha")],f.prototype,"_alpha",void 0),(0,s.Cg)([(0,r.lK)("backFaceCulling")],f.prototype,"_backFaceCulling",void 0),(0,s.Cg)([(0,r.lK)("cullBackFaces")],f.prototype,"_cullBackFaces",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"sideOrientation",void 0),(0,s.Cg)([(0,r.lK)("alphaMode")],f.prototype,"_alphaMode",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"_needDepthPrePass",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"disableDepthWrite",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"disableColorWrite",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"forceDepthWrite",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"depthFunction",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"separateCullingPass",void 0),(0,s.Cg)([(0,r.lK)("fogEnabled")],f.prototype,"_fogEnabled",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"pointSize",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"zOffset",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"zOffsetUnits",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"pointsCloud",null),(0,s.Cg)([(0,r.lK)()],f.prototype,"fillMode",null),(0,s.Cg)([(0,r.lK)()],f.prototype,"useLogarithmicDepth",null),(0,s.Cg)([(0,r.lK)()],f.prototype,"transparencyMode",null)},4670:e=>{"use strict";e.exports=Math.min},4754:(e,t,i)=>{"use strict";function s(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}i.d(t,{Cg:()=>s}),Object.create,Object.create},4796:(e,t,i)=>{"use strict";i.d(t,{l:()=>s});class s{static GetShadersRepository(e=0){return 0===e?s.ShadersRepository:s.ShadersRepositoryWGSL}static GetShadersStore(e=0){return 0===e?s.ShadersStore:s.ShadersStoreWGSL}static GetIncludesShadersStore(e=0){return 0===e?s.IncludesShadersStore:s.IncludesShadersStoreWGSL}}s.ShadersRepository="src/Shaders/",s.ShadersStore={},s.IncludesShadersStore={},s.ShadersRepositoryWGSL="src/ShadersWGSL/",s.ShadersStoreWGSL={},s.IncludesShadersStoreWGSL={}},4822:e=>{"use strict";e.exports=Math.abs},4837:(e,t,i)=>{"use strict";i.d(t,{Cf:()=>s,bu:()=>n,tG:()=>r});class s extends Error{}s._setPrototypeOf=Object.setPrototypeOf||((e,t)=>(e.__proto__=t,e));const r={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class n extends s{constructor(e,t,i){super(e),this.errorCode=t,this.innerError=i,this.name="RuntimeError",s._setPrototypeOf(this,n.prototype)}}},4871:(e,t,i)=>{"use strict";i.d(t,{O:()=>l,Q:()=>c});var s=i(4049),r=i(3086);const n=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],o=[()=>1,e=>e.y,e=>e.z,e=>e.x,e=>e.x*e.y,e=>e.y*e.z,e=>3*e.z*e.z-1,e=>e.x*e.z,e=>e.x*e.x-e.y*e.y],a=(e,t)=>n[e]*o[e](t),h=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class l{constructor(){this.preScaled=!1,this.l00=s.Pq.Zero(),this.l1_1=s.Pq.Zero(),this.l10=s.Pq.Zero(),this.l11=s.Pq.Zero(),this.l2_2=s.Pq.Zero(),this.l2_1=s.Pq.Zero(),this.l20=s.Pq.Zero(),this.l21=s.Pq.Zero(),this.l22=s.Pq.Zero()}addLight(e,t,i){r.AA.Vector3[0].set(t.r,t.g,t.b);const s=r.AA.Vector3[0],n=r.AA.Vector3[1];s.scaleToRef(i,n),n.scaleToRef(a(0,e),r.AA.Vector3[2]),this.l00.addInPlace(r.AA.Vector3[2]),n.scaleToRef(a(1,e),r.AA.Vector3[2]),this.l1_1.addInPlace(r.AA.Vector3[2]),n.scaleToRef(a(2,e),r.AA.Vector3[2]),this.l10.addInPlace(r.AA.Vector3[2]),n.scaleToRef(a(3,e),r.AA.Vector3[2]),this.l11.addInPlace(r.AA.Vector3[2]),n.scaleToRef(a(4,e),r.AA.Vector3[2]),this.l2_2.addInPlace(r.AA.Vector3[2]),n.scaleToRef(a(5,e),r.AA.Vector3[2]),this.l2_1.addInPlace(r.AA.Vector3[2]),n.scaleToRef(a(6,e),r.AA.Vector3[2]),this.l20.addInPlace(r.AA.Vector3[2]),n.scaleToRef(a(7,e),r.AA.Vector3[2]),this.l21.addInPlace(r.AA.Vector3[2]),n.scaleToRef(a(8,e),r.AA.Vector3[2]),this.l22.addInPlace(r.AA.Vector3[2])}scaleInPlace(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(h[0]),this.l1_1.scaleInPlace(h[1]),this.l10.scaleInPlace(h[2]),this.l11.scaleInPlace(h[3]),this.l2_2.scaleInPlace(h[4]),this.l2_1.scaleInPlace(h[5]),this.l20.scaleInPlace(h[6]),this.l21.scaleInPlace(h[7]),this.l22.scaleInPlace(h[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(n[0]),this.l1_1.scaleInPlace(n[1]),this.l10.scaleInPlace(n[2]),this.l11.scaleInPlace(n[3]),this.l2_2.scaleInPlace(n[4]),this.l2_1.scaleInPlace(n[5]),this.l20.scaleInPlace(n[6]),this.l21.scaleInPlace(n[7]),this.l22.scaleInPlace(n[8])}updateFromArray(e){return s.Pq.FromArrayToRef(e[0],0,this.l00),s.Pq.FromArrayToRef(e[1],0,this.l1_1),s.Pq.FromArrayToRef(e[2],0,this.l10),s.Pq.FromArrayToRef(e[3],0,this.l11),s.Pq.FromArrayToRef(e[4],0,this.l2_2),s.Pq.FromArrayToRef(e[5],0,this.l2_1),s.Pq.FromArrayToRef(e[6],0,this.l20),s.Pq.FromArrayToRef(e[7],0,this.l21),s.Pq.FromArrayToRef(e[8],0,this.l22),this}updateFromFloatsArray(e){return s.Pq.FromFloatsToRef(e[0],e[1],e[2],this.l00),s.Pq.FromFloatsToRef(e[3],e[4],e[5],this.l1_1),s.Pq.FromFloatsToRef(e[6],e[7],e[8],this.l10),s.Pq.FromFloatsToRef(e[9],e[10],e[11],this.l11),s.Pq.FromFloatsToRef(e[12],e[13],e[14],this.l2_2),s.Pq.FromFloatsToRef(e[15],e[16],e[17],this.l2_1),s.Pq.FromFloatsToRef(e[18],e[19],e[20],this.l20),s.Pq.FromFloatsToRef(e[21],e[22],e[23],this.l21),s.Pq.FromFloatsToRef(e[24],e[25],e[26],this.l22),this}static FromArray(e){return(new l).updateFromArray(e)}static FromPolynomial(e){const t=new l;return t.l00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),t.l1_1=e.y.scale(.977204),t.l10=e.z.scale(.977204),t.l11=e.x.scale(.977204),t.l2_2=e.xy.scale(1.16538),t.l2_1=e.yz.scale(1.16538),t.l20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),t.l21=e.zx.scale(1.16538),t.l22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),t.l1_1.scaleInPlace(-1),t.l11.scaleInPlace(-1),t.l2_1.scaleInPlace(-1),t.l21.scaleInPlace(-1),t.scaleInPlace(Math.PI),t}}class c{constructor(){this.x=s.Pq.Zero(),this.y=s.Pq.Zero(),this.z=s.Pq.Zero(),this.xx=s.Pq.Zero(),this.yy=s.Pq.Zero(),this.zz=s.Pq.Zero(),this.xy=s.Pq.Zero(),this.yz=s.Pq.Zero(),this.zx=s.Pq.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=l.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(e){r.AA.Vector3[0].copyFromFloats(e.r,e.g,e.b);const t=r.AA.Vector3[0];this.xx.addInPlace(t),this.yy.addInPlace(t),this.zz.addInPlace(t)}scaleInPlace(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)}updateFromHarmonics(e){return this._harmonics=e,this.x.copyFrom(e.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(e.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(e.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(e.l00),r.AA.Vector3[0].copyFrom(e.l20).scaleInPlace(.247708),r.AA.Vector3[1].copyFrom(e.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(r.AA.Vector3[0]).addInPlace(r.AA.Vector3[1]),this.yy.copyFrom(e.l00),this.yy.scaleInPlace(.886277).subtractInPlace(r.AA.Vector3[0]).subtractInPlace(r.AA.Vector3[1]),this.zz.copyFrom(e.l00),r.AA.Vector3[0].copyFrom(e.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(r.AA.Vector3[0]),this.yz.copyFrom(e.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(e.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(e.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(e){return(new c).updateFromHarmonics(e)}static FromArray(e){const t=new c;return s.Pq.FromArrayToRef(e[0],0,t.x),s.Pq.FromArrayToRef(e[1],0,t.y),s.Pq.FromArrayToRef(e[2],0,t.z),s.Pq.FromArrayToRef(e[3],0,t.xx),s.Pq.FromArrayToRef(e[4],0,t.yy),s.Pq.FromArrayToRef(e[5],0,t.zz),s.Pq.FromArrayToRef(e[6],0,t.yz),s.Pq.FromArrayToRef(e[7],0,t.zx),s.Pq.FromArrayToRef(e[8],0,t.xy),t}}},4920:(e,t,i)=>{"use strict";function s(){return"undefined"!=typeof window}function r(){return"undefined"!=typeof navigator}function n(){return"undefined"!=typeof document}function o(e){let t="",i=e.firstChild;for(;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t}i.d(t,{BA:()=>s,Nf:()=>n,XD:()=>r,Zl:()=>o})},4923:(e,t,i)=>{"use strict";var s="undefined"!=typeof Symbol&&Symbol,r=i(4361);e.exports=function(){return"function"==typeof s&&"function"==typeof Symbol&&"symbol"==typeof s("foo")&&"symbol"==typeof Symbol("bar")&&r()}},4951:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AnimationGroup:()=>h,TargetedAnimation:()=>a});var s=i(6618),r=i(3054),n=i(1497),o=i(641);i(4366);class a{getClassName(){return"TargetedAnimation"}serialize(){const e={};return e.animation=this.animation.serialize(),e.targetId=this.target.id,e}}class h{get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this.syncWithMask(!0))}syncWithMask(e=!1){if(this.mask||e){this._numActiveAnimatables=0;for(let e=0;e<this._animatables.length;++e){const t=this._animatables[e];!this.mask||this.mask.disabled||this.mask.retainsTarget(t.target.name)?(this._numActiveAnimatables++,t.paused&&t.restart()):t.paused||t.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let e=0;e<this._animatables.length;++e){const t=this._animatables[e];this.mask.retainsTarget(t.target.name)||(t.stop(),this._animatables.splice(e,1),--e)}for(let e=0;e<this._targetedAnimations.length;e++){const t=this._targetedAnimations[e];this.mask.retainsTarget(t.target.name)||(this._targetedAnimations.splice(e,1),--e)}}}get from(){return this._from}set from(e){if(this._from!==e){this._from=e;for(let e=0;e<this._animatables.length;e++)this._animatables[e].fromFrame=this._from}}get to(){return this._to}set to(e){if(this._to!==e){this._to=e;for(let e=0;e<this._animatables.length;e++)this._animatables[e].toFrame=this._to}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(e){if(this._speedRatio!==e){this._speedRatio=e;for(let e=0;e<this._animatables.length;e++)this._animatables[e].speedRatio=this._speedRatio}}get loopAnimation(){return this._loopAnimation}set loopAnimation(e){if(this._loopAnimation!==e){this._loopAnimation=e;for(let e=0;e<this._animatables.length;e++)this._animatables[e].loopAnimation=this._loopAnimation}}get isAdditive(){return this._isAdditive}set isAdditive(e){if(this._isAdditive!==e){this._isAdditive=e;for(let e=0;e<this._animatables.length;e++)this._animatables[e].isAdditive=this._isAdditive}}get weight(){return this._weight}set weight(e){this._weight!==e&&(this._weight=e,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(e){if(this._playOrder!==e&&(this._playOrder=e,this._animatables.length>0)){for(let e=0;e<this._animatables.length;e++)this._animatables[e].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(e){if(this._enableBlending!==e&&(this._enableBlending=e,null!==e))for(let t=0;t<this._targetedAnimations.length;++t)this._targetedAnimations[t].animation.enableBlending=e}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(e){if(this._blendingSpeed!==e&&(this._blendingSpeed=e,null!==e))for(let t=0;t<this._targetedAnimations.length;++t)this._targetedAnimations[t].animation.blendingSpeed=e}getLength(e,t){return e=e??this._from,((t=t??this._to)-e)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}static MergeAnimationGroups(e,t=!0,i=!1,s){if(0===e.length)return null;s=s??e[0].weight;let r=Number.MAX_VALUE,n=-Number.MAX_VALUE;if(i)for(const t of e)t.from<r&&(r=t.from),t.to>n&&(n=t.to);const o=new h(e[0].name+"_merged",e[0]._scene,s);for(const s of e){i&&s.normalize(r,n);for(const e of s.targetedAnimations)o.addTargetedAnimation(e.animation,e.target);t&&s.dispose()}return o}constructor(e,t=null,i=-1,s=0){this.name=e,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new r.cP,this.onAnimationLoopObservable=new r.cP,this.onAnimationGroupLoopObservable=new r.cP,this.onAnimationGroupEndObservable=new r.cP,this.onAnimationGroupPauseObservable=new r.cP,this.onAnimationGroupPlayObservable=new r.cP,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=t||n.q.LastCreatedScene,this._weight=i,this._playOrder=s,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(e,t){const i=new a;i.animation=e,i.target=t;const s=e.getKeys();return this._from>s[0].frame&&(this._from=s[0].frame),this._to<s[s.length-1].frame&&(this._to=s[s.length-1].frame),null!==this._enableBlending&&(e.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(e.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(i),this._shouldStart=!0,i}removeTargetedAnimation(e){for(let t=this._targetedAnimations.length-1;t>-1;t--)this._targetedAnimations[t].animation===e&&this._targetedAnimations.splice(t,1)}normalize(e=null,t=null){null==e&&(e=this._from),null==t&&(t=this._to);for(let i=0;i<this._targetedAnimations.length;i++){const s=this._targetedAnimations[i].animation.getKeys(),r=s[0],n=s[s.length-1];if(r.frame>e){const t={frame:e,value:r.value,inTangent:r.inTangent,outTangent:r.outTangent,interpolation:r.interpolation};s.splice(0,0,t)}if(n.frame<t){const e={frame:t,value:n.value,inTangent:n.inTangent,outTangent:n.outTangent,interpolation:n.interpolation};s.push(e)}}return this._from=e,this._to=t,this}_processLoop(e,t,i){e.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(t),this._animationLoopFlags[i]||(this._animationLoopFlags[i]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(e=!1,t=1,i,s,r){if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=e,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let n=0;n<this._targetedAnimations.length;n++){const o=this._targetedAnimations[n],a=this._scene.beginDirectAnimation(o.target,[o.animation],void 0!==i?i:this._from,void 0!==s?s:this._to,e,t,void 0,void 0,void 0!==r?r:this._isAdditive);a.weight=this._weight,a.playOrder=this._playOrder,a.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(o),this._checkAnimationGroupEnded(a)},this._processLoop(a,o,n),this._animatables.push(a)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=t,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let e=0;e<this._animatables.length;e++)this._animatables[e].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(e){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==e&&(this.loopAnimation=e),this.restart()):(this.stop(),this.start(e,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let e=0;e<this._animatables.length;e++)this._animatables[e].reset();return this}restart(){if(!this._isStarted)return this;for(let e=0;e<this._animatables.length;e++)this._animatables[e].restart();return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(e=!1){if(!this._isStarted)return this;const t=this._animatables.slice();for(let i=0;i<t.length;i++)t[i].stop(void 0,void 0,!0,e);let i=0;for(let t=0;t<this._scene._activeAnimatables.length;t++){const s=this._scene._activeAnimatables[t];s._runtimeAnimations.length>0?this._scene._activeAnimatables[i++]=s:e&&this._checkAnimationGroupEnded(s,e)}return this._scene._activeAnimatables.length=i,this._isStarted=!1,this}setWeightForAllAnimatables(e){for(let t=0;t<this._animatables.length;t++)this._animatables[t].weight=e;return this}syncAllAnimationsWith(e){for(let t=0;t<this._animatables.length;t++)this._animatables[t].syncWith(e);return this}goToFrame(e,t=!1){if(!this._isStarted)return this;for(let i=0;i<this._animatables.length;i++)this._animatables[i].goToFrame(e,t);return this}getCurrentFrame(){return this.animatables[0]?.masterFrame||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const e=this._scene.animationGroups.indexOf(this);if(e>-1&&this._scene.animationGroups.splice(e,1),this._parentContainer){const e=this._parentContainer.animationGroups.indexOf(this);e>-1&&this._parentContainer.animationGroups.splice(e,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(e,t=!1){const i=this._animatables.indexOf(e);i>-1&&this._animatables.splice(i,1),this._animatables.length===this._targetedAnimations.length-this._numActiveAnimatables&&(this._isStarted=!1,t||this.onAnimationGroupEndObservable.notifyObservers(this),this._animatables.length=0)}clone(e,t,i=!1){const s=new h(e||this.name,this._scene,this._weight,this._playOrder);s._from=this.from,s._to=this.to,s._speedRatio=this.speedRatio,s._loopAnimation=this.loopAnimation,s._isAdditive=this.isAdditive,s._enableBlending=this.enableBlending,s._blendingSpeed=this.blendingSpeed,s.metadata=this.metadata,s.mask=this.mask;for(const e of this._targetedAnimations)s.addTargetedAnimation(i?e.animation.clone():e.animation,t?t(e.target):e.target);return s}serialize(){const e={};e.name=this.name,e.from=this.from,e.to=this.to,e.speedRatio=this.speedRatio,e.loopAnimation=this.loopAnimation,e.isAdditive=this.isAdditive,e.weight=this.weight,e.playOrder=this.playOrder,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,e.targetedAnimations=[];for(let t=0;t<this.targetedAnimations.length;t++){const i=this.targetedAnimations[t];e.targetedAnimations[t]=i.serialize()}return o.Y&&o.Y.HasTags(this)&&(e.tags=o.Y.GetTags(this)),this.metadata&&(e.metadata=this.metadata),e}static Parse(e,t){const i=new h(e.name,t,e.weight,e.playOrder);for(let r=0;r<e.targetedAnimations.length;r++){const n=e.targetedAnimations[r],o=s.X5.Parse(n.animation),a=n.targetId;if("influence"===n.animation.property){const e=t.getMorphTargetById(a);e&&i.addTargetedAnimation(o,e)}else{const e=t.getNodeById(a);null!=e&&i.addTargetedAnimation(o,e)}}return o.Y&&o.Y.AddTagsTo(i,e.tags),null!==e.from&&null!==e.to&&i.normalize(e.from,e.to),void 0!==e.speedRatio&&(i._speedRatio=e.speedRatio),void 0!==e.loopAnimation&&(i._loopAnimation=e.loopAnimation),void 0!==e.isAdditive&&(i._isAdditive=e.isAdditive),void 0!==e.weight&&(i._weight=e.weight),void 0!==e.playOrder&&(i._playOrder=e.playOrder),void 0!==e.enableBlending&&(i._enableBlending=e.enableBlending),void 0!==e.blendingSpeed&&(i._blendingSpeed=e.blendingSpeed),void 0!==e.metadata&&(i.metadata=e.metadata),i}static MakeAnimationAdditive(e,t,i,r=!1,n){let o;o="object"==typeof t?t:{referenceFrame:t,range:i,cloneOriginalAnimationGroup:r,clonedAnimationName:n};let a=e;o.cloneOriginalAnimationGroup&&(a=e.clone(o.clonedAnimationGroupName||a.name));const h=a.targetedAnimations;for(let e=0;e<h.length;e++){const t=h[e];t.animation=s.X5.MakeAnimationAdditive(t.animation,o)}if(a.isAdditive=!0,o.clipKeys){let e=Number.MAX_VALUE,t=-Number.MAX_VALUE;const i=a.targetedAnimations;for(let s=0;s<i.length;s++){const r=i[s].animation.getKeys();e>r[0].frame&&(e=r[0].frame),t<r[r.length-1].frame&&(t=r[r.length-1].frame)}a._from=e,a._to=t}return a}static ClipKeys(e,t,i,s,r){const n=e.clone(s||e.name);return h.ClipKeysInPlace(n,t,i,r)}static ClipKeysInPlace(e,t,i,s){return h.ClipInPlace(e,t,i,s,!1)}static ClipFrames(e,t,i,s,r){const n=e.clone(s||e.name);return h.ClipFramesInPlace(n,t,i,r)}static ClipFramesInPlace(e,t,i,s){return h.ClipInPlace(e,t,i,s,!0)}static ClipInPlace(e,t,i,s,r=!1){let n=Number.MAX_VALUE,o=-Number.MAX_VALUE;const a=e.targetedAnimations;for(let e=0;e<a.length;e++){const h=a[e],l=s?h.animation:h.animation.clone();r&&(l.createKeyForFrame(t),l.createKeyForFrame(i));const c=l.getKeys(),u=[];let d=Number.MAX_VALUE;for(let e=0;e<c.length;e++){const s=c[e];if(!r&&e>=t&&e<=i||r&&s.frame>=t&&s.frame<=i){const e={frame:s.frame,value:s.value.clone?s.value.clone():s.value,inTangent:s.inTangent,outTangent:s.outTangent,interpolation:s.interpolation,lockedTangent:s.lockedTangent};d===Number.MAX_VALUE&&(d=e.frame),e.frame-=d,u.push(e)}}0!==u.length?(n>u[0].frame&&(n=u[0].frame),o<u[u.length-1].frame&&(o=u[u.length-1].frame),l.setKeys(u,!0),h.animation=l):(a.splice(e,1),e--)}return e._from=n,e._to=o,e}getClassName(){return"AnimationGroup"}toString(e){let t="Name: "+this.name;return t+=", type: "+this.getClassName(),e&&(t+=", from: "+this._from,t+=", to: "+this._to,t+=", isStarted: "+this._isStarted,t+=", speedRatio: "+this._speedRatio,t+=", targetedAnimations length: "+this._targetedAnimations.length,t+=", animatables length: "+this._animatables),t}}},4982:(e,t,i)=>{"use strict";i.d(t,{n:()=>s});class s{get underlyingResource(){return null}constructor(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=s._Counter++}}s._Counter=0},5098:(e,t,i)=>{"use strict";i.d(t,{F:()=>o,_:()=>r});let s=[];class r{static SetImmediate(e){0===s.length&&setTimeout((()=>{const e=s;s=[];for(const t of e)t()}),1),s.push(e)}}function n(e,t,i){try{if(e())return t(),!0}catch(e){return i?.(e),!0}return!1}const o=(e,t,i,s=16,r=3e4,o=!0,a)=>{if(o&&n(e,t,i))return null;const h=setInterval((()=>{n(e,t,i)?clearInterval(h):(r-=s)<0&&(clearInterval(h),i?.(new Error("Operation timed out after maximum retries. "+(a||"")),!0))}),s);return()=>clearInterval(h)}},5230:e=>{"use strict";function t(e,t,s){s=s||2;var n,o,a,h,u,d,p,g=t&&t.length,f=g?t[0]*s:e.length,m=i(e,0,f,s,!0),b=[];if(!m||m.next===m.prev)return b;if(g&&(m=function(e,t,s,r){var n,o,a,h=[];for(n=0,o=t.length;n<o;n++)(a=i(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),h.push(_(a));for(h.sort(l),n=0;n<h.length;n++)s=c(h[n],s);return s}(e,t,m,s)),e.length>80*s){n=a=e[0],o=h=e[1];for(var v=s;v<f;v+=s)(u=e[v])<n&&(n=u),(d=e[v+1])<o&&(o=d),u>a&&(a=u),d>h&&(h=d);p=0!==(p=Math.max(a-n,h-o))?32767/p:0}return r(m,b,s,n,o,p,0),b}function i(e,t,i,s,r){var n,o;if(r===E(e,t,i,s)>0)for(n=t;n<i;n+=s)o=A(n,e[n],e[n+1],o);else for(n=i-s;n>=t;n-=s)o=A(n,e[n],e[n+1],o);return o&&m(o,o.next)&&(C(o),o=o.next),o}function s(e,t){if(!e)return e;t||(t=e);var i,s=e;do{if(i=!1,s.steiner||!m(s,s.next)&&0!==f(s.prev,s,s.next))s=s.next;else{if(C(s),(s=t=s.prev)===s.next)break;i=!0}}while(i||s!==t);return t}function r(e,t,i,l,c,u,_){if(e){!_&&u&&function(e,t,i,s){var r=e;do{0===r.z&&(r.z=d(r.x,r.y,t,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,s,r,n,o,a,h,l=1;do{for(i=e,e=null,n=null,o=0;i;){for(o++,s=i,a=0,t=0;t<l&&(a++,s=s.nextZ);t++);for(h=l;a>0||h>0&&s;)0!==a&&(0===h||!s||i.z<=s.z)?(r=i,i=i.nextZ,a--):(r=s,s=s.nextZ,h--),n?n.nextZ=r:e=r,r.prevZ=n,n=r;i=s}n.nextZ=null,l*=2}while(o>1)}(r)}(e,l,c,u);for(var p,g,f=e;e.prev!==e.next;)if(p=e.prev,g=e.next,u?o(e,l,c,u):n(e))t.push(p.i/i|0),t.push(e.i/i|0),t.push(g.i/i|0),C(e),e=g.next,f=g.next;else if((e=g)===f){_?1===_?r(e=a(s(e),t,i),t,i,l,c,u,2):2===_&&h(e,t,i,l,c,u):r(s(e),t,i,l,c,u,1);break}}}function n(e){var t=e.prev,i=e,s=e.next;if(f(t,i,s)>=0)return!1;for(var r=t.x,n=i.x,o=s.x,a=t.y,h=i.y,l=s.y,c=r<n?r<o?r:o:n<o?n:o,u=a<h?a<l?a:l:h<l?h:l,d=r>n?r>o?r:o:n>o?n:o,_=a>h?a>l?a:l:h>l?h:l,g=s.next;g!==t;){if(g.x>=c&&g.x<=d&&g.y>=u&&g.y<=_&&p(r,a,n,h,o,l,g.x,g.y)&&f(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function o(e,t,i,s){var r=e.prev,n=e,o=e.next;if(f(r,n,o)>=0)return!1;for(var a=r.x,h=n.x,l=o.x,c=r.y,u=n.y,_=o.y,g=a<h?a<l?a:l:h<l?h:l,m=c<u?c<_?c:_:u<_?u:_,b=a>h?a>l?a:l:h>l?h:l,v=c>u?c>_?c:_:u>_?u:_,T=d(g,m,t,i,s),y=d(b,v,t,i,s),x=e.prevZ,A=e.nextZ;x&&x.z>=T&&A&&A.z<=y;){if(x.x>=g&&x.x<=b&&x.y>=m&&x.y<=v&&x!==r&&x!==o&&p(a,c,h,u,l,_,x.x,x.y)&&f(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,A.x>=g&&A.x<=b&&A.y>=m&&A.y<=v&&A!==r&&A!==o&&p(a,c,h,u,l,_,A.x,A.y)&&f(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;x&&x.z>=T;){if(x.x>=g&&x.x<=b&&x.y>=m&&x.y<=v&&x!==r&&x!==o&&p(a,c,h,u,l,_,x.x,x.y)&&f(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;A&&A.z<=y;){if(A.x>=g&&A.x<=b&&A.y>=m&&A.y<=v&&A!==r&&A!==o&&p(a,c,h,u,l,_,A.x,A.y)&&f(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function a(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!m(n,o)&&b(n,r,r.next,o)&&y(n,o)&&y(o,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(o.i/i|0),C(r),C(r.next),r=e=o),r=r.next}while(r!==e);return s(r)}function h(e,t,i,n,o,a){var h=e;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&g(h,l)){var c=x(h,l);return h=s(h,h.next),c=s(c,c.next),r(h,t,i,n,o,a,0),void r(c,t,i,n,o,a,0)}l=l.next}h=h.next}while(h!==e)}function l(e,t){return e.x-t.x}function c(e,t){var i=function(e,t){var i,s=t,r=e.x,n=e.y,o=-1/0;do{if(n<=s.y&&n>=s.next.y&&s.next.y!==s.y){var a=s.x+(n-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=r&&a>o&&(o=a,i=s.x<s.next.x?s:s.next,a===r))return i}s=s.next}while(s!==t);if(!i)return null;var h,l=i,c=i.x,d=i.y,_=1/0;s=i;do{r>=s.x&&s.x>=c&&r!==s.x&&p(n<d?r:o,n,c,d,n<d?o:r,n,s.x,s.y)&&(h=Math.abs(n-s.y)/(r-s.x),y(s,e)&&(h<_||h===_&&(s.x>i.x||s.x===i.x&&u(i,s)))&&(i=s,_=h)),s=s.next}while(s!==l);return i}(e,t);if(!i)return t;var r=x(i,e);return s(r,r.next),s(i,i.next)}function u(e,t){return f(e.prev,e,t.prev)<0&&f(t.next,e,e.next)<0}function d(e,t,i,s,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function p(e,t,i,s,r,n,o,a){return(r-o)*(t-a)>=(e-o)*(n-a)&&(e-o)*(s-a)>=(i-o)*(t-a)&&(i-o)*(n-a)>=(r-o)*(s-a)}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&b(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(y(e,t)&&y(t,e)&&function(e,t){var i=e,s=!1,r=(e.x+t.x)/2,n=(e.y+t.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==e);return s}(e,t)&&(f(e.prev,e,t.prev)||f(e,t.prev,t))||m(e,t)&&f(e.prev,e,e.next)>0&&f(t.prev,t,t.next)>0)}function f(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,i,s){var r=T(f(e,t,i)),n=T(f(e,t,s)),o=T(f(i,s,e)),a=T(f(i,s,t));return r!==n&&o!==a||!(0!==r||!v(e,i,t))||!(0!==n||!v(e,s,t))||!(0!==o||!v(i,e,s))||!(0!==a||!v(i,t,s))}function v(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function T(e){return e>0?1:e<0?-1:0}function y(e,t){return f(e.prev,e,e.next)<0?f(e,t,e.next)>=0&&f(e,e.prev,t)>=0:f(e,t,e.prev)<0||f(e,e.next,t)<0}function x(e,t){var i=new S(e.i,e.x,e.y),s=new S(t.i,t.x,t.y),r=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function A(e,t,i,s){var r=new S(e,t,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,i,s){for(var r=0,n=t,o=i-s;n<i;n+=s)r+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return r}e.exports=t,e.exports.default=t,t.deviation=function(e,t,i,s){var r=t&&t.length,n=r?t[0]*i:e.length,o=Math.abs(E(e,0,n,i));if(r)for(var a=0,h=t.length;a<h;a++){var l=t[a]*i,c=a<h-1?t[a+1]*i:e.length;o-=Math.abs(E(e,l,c,i))}var u=0;for(a=0;a<s.length;a+=3){var d=s[a]*i,_=s[a+1]*i,p=s[a+2]*i;u+=Math.abs((e[d]-e[p])*(e[_+1]-e[d+1])-(e[d]-e[_])*(e[p+1]-e[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},t.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},s=0,r=0;r<e.length;r++){for(var n=0;n<e[r].length;n++)for(var o=0;o<t;o++)i.vertices.push(e[r][n][o]);r>0&&(s+=e[r-1].length,i.holes.push(s))}return i}},5241:(e,t,i)=>{"use strict";i.d(t,{Bb:()=>L,DL:()=>c,Dk:()=>d,ER:()=>C,IF:()=>_,J2:()=>v,N4:()=>B,Nc:()=>O,OR:()=>I,RL:()=>x,VO:()=>w,Y7:()=>D,YT:()=>m,Yy:()=>u,_8:()=>f,az:()=>R,c4:()=>S,f$:()=>T,fm:()=>E,mA:()=>b,nR:()=>g,ni:()=>A,qB:()=>M,te:()=>p});var s=i(3039),r=i(451),n=i(1497),o=i(5549),a=i(8042);const h=r.v9.Black(),l={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function c(e,t,i){if(!e||e.LOGARITHMICDEPTH||e.indexOf&&e.indexOf("LOGARITHMICDEPTH")>=0){const e=i.activeCamera;1===e.mode&&s.V.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(e.maxZ+1)/Math.LN2))}}function u(e,t,i,s=!1){i&&e.fogEnabled&&(!t||t.applyFog)&&0!==e.fogMode&&(i.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),s?(e.fogColor.toLinearSpaceToRef(h,e.getEngine().useExactSrgbConversions),i.setColor3("vFogColor",h)):i.setColor3("vFogColor",e.fogColor))}function d(e,t,i,s,r,n,o,a,h,c){const u=e.numMaxInfluencers||e.numInfluencers;return u<=0?0:(t.push("#define MORPHTARGETS"),e.hasPositions&&t.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),e.hasNormals&&t.push("#define MORPHTARGETTEXTURE_HASNORMALS"),e.hasTangents&&t.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),e.hasUVs&&t.push("#define MORPHTARGETTEXTURE_HASUVS"),e.hasUV2s&&t.push("#define MORPHTARGETTEXTURE_HASUV2S"),e.hasColors&&t.push("#define MORPHTARGETTEXTURE_HASCOLORS"),e.supportsPositions&&r&&t.push("#define MORPHTARGETS_POSITION"),e.supportsNormals&&n&&t.push("#define MORPHTARGETS_NORMAL"),e.supportsTangents&&o&&t.push("#define MORPHTARGETS_TANGENT"),e.supportsUVs&&a&&t.push("#define MORPHTARGETS_UV"),e.supportsUV2s&&h&&t.push("#define MORPHTARGETS_UV2"),e.supportsColors&&c&&t.push("#define MORPHTARGETS_COLOR"),t.push("#define NUM_MORPH_INFLUENCERS "+u),e.isUsingTextureForTargets&&t.push("#define MORPHTARGETS_TEXTURE"),l.NUM_MORPH_INFLUENCERS=u,l.NORMAL=n,l.TANGENT=o,l.UV=a,l.UV2=h,l.COLOR=c,_(i,s,l,r),u)}function _(e,t,i,r=!0){const o=i.NUM_MORPH_INFLUENCERS;if(o>0&&n.q.LastCreatedEngine){const a=n.q.LastCreatedEngine.getCaps().maxVertexAttribs,h=t.morphTargetManager;if(h?.isUsingTextureForTargets)return;const l=h&&h.supportsPositions&&r,c=h&&h.supportsNormals&&i.NORMAL,u=h&&h.supportsTangents&&i.TANGENT,d=h&&h.supportsUVs&&i.UV1,_=h&&h.supportsUV2s&&i.UV2,p=h&&h.supportsColors&&i.COLOR;for(let i=0;i<o;i++)l&&e.push("position"+i),c&&e.push("normal"+i),u&&e.push("tangent"+i),d&&e.push("uv_"+i),_&&e.push("uv2_"+i),p&&e.push("color"+i),e.length>a&&s.V.Error("Cannot add more vertex attributes for mesh "+t.name)}}function p(e,t=!1){e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}function g(e,t){const i=e.morphTargetManager;e&&i&&t.setFloatArray("morphTargetInfluences",i.influences)}function f(e,t){t.bindToEffect(e,"Scene")}function m(e,t,i){t._needUVs=!0,t[i]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(t[i+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[i+"DIRECTUV"]=0}function b(e,t,i){const s=e.getTextureMatrix();t.updateMatrix(i+"Matrix",s)}function v(e,t,i){i.BAKED_VERTEX_ANIMATION_TEXTURE&&i.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}function T(e,t,i){var s;if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){const r=e.skeleton;if(r.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){const i=r.getTransformMatrixTexture(e);t.setTexture("boneSampler",i),t.setFloat("boneTextureWidth",4*(r.bones.length+1))}else{const n=r.getTransformMatrices(e);n&&(t.setMatrices("mBones",n),i&&e.getScene().prePassRenderer&&e.getScene().prePassRenderer.getIndex(2)&&(i.previousBones[e.uniqueId]||(i.previousBones[e.uniqueId]=n.slice()),t.setMatrices("mPreviousBones",i.previousBones[e.uniqueId]),s=n,i.previousBones[e.uniqueId].set(s)))}}}function y(e,t,i,s,r,n=!0){e._bindLight(t,i,s,r,n)}function x(e,t,i,s,r=4){const n=Math.min(t.lightSources.length,r);for(let r=0;r<n;r++)y(t.lightSources[r],r,e,i,"boolean"==typeof s?s:s.SPECULARTERM,t.receiveShadows)}function A(e,t,i,s){i.NUM_BONE_INFLUENCERS>0&&(s.addCPUSkinningFallback(0,t),e.push("matricesIndices"),e.push("matricesWeights"),i.NUM_BONE_INFLUENCERS>4&&(e.push("matricesIndicesExtra"),e.push("matricesWeightsExtra")))}function C(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&p(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push("instanceColor")}function S(e,t,i=4,s=0){let r=0;for(let n=0;n<i&&e["LIGHT"+n];n++)n>0&&(r=s+n,t.addFallback(r,"LIGHT"+n)),e.SHADOWS||(e["SHADOW"+n]&&t.addFallback(s,"SHADOW"+n),e["SHADOWPCF"+n]&&t.addFallback(s,"SHADOWPCF"+n),e["SHADOWPCSS"+n]&&t.addFallback(s,"SHADOWPCSS"+n),e["SHADOWPOISSON"+n]&&t.addFallback(s,"SHADOWPOISSON"+n),e["SHADOWESM"+n]&&t.addFallback(s,"SHADOWESM"+n),e["SHADOWCLOSEESM"+n]&&t.addFallback(s,"SHADOWCLOSEESM"+n));return r++}function E(e,t,i,s,r,n,o,a=!1){o._areMiscDirty&&(o.LOGARITHMICDEPTH=i,o.POINTSIZE=s,o.FOG=r&&function(e,t){return t.fogEnabled&&e.applyFog&&0!==t.fogMode}(e,t),o.NONUNIFORMSCALING=e.nonUniformScaling,o.ALPHATEST=n,o.DECAL_AFTER_DETAIL=a)}function R(e,t,i,s,r=4,n=!1){if(!i._areLightsDirty)return i._needNormals;let o=0;const a={needNormals:i._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!n)for(const n of t.lightSources)if(P(e,t,n,o,i,s,a),o++,o===r)break;i.SPECULARTERM=a.specularEnabled,i.SHADOWS=a.shadowEnabled;for(let e=o;e<r;e++)void 0!==i["LIGHT"+e]&&(i["LIGHT"+e]=!1,i["HEMILIGHT"+e]=!1,i["POINTLIGHT"+e]=!1,i["DIRLIGHT"+e]=!1,i["SPOTLIGHT"+e]=!1,i["AREALIGHT"+e]=!1,i["SHADOW"+e]=!1,i["SHADOWCSM"+e]=!1,i["SHADOWCSMDEBUG"+e]=!1,i["SHADOWCSMNUM_CASCADES"+e]=!1,i["SHADOWCSMUSESHADOWMAXZ"+e]=!1,i["SHADOWCSMNOBLEND"+e]=!1,i["SHADOWCSM_RIGHTHANDED"+e]=!1,i["SHADOWPCF"+e]=!1,i["SHADOWPCSS"+e]=!1,i["SHADOWPOISSON"+e]=!1,i["SHADOWESM"+e]=!1,i["SHADOWCLOSEESM"+e]=!1,i["SHADOWCUBE"+e]=!1,i["SHADOWLOWQUALITY"+e]=!1,i["SHADOWMEDIUMQUALITY"+e]=!1);const h=e.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(a.needRebuild=!0),i.SHADOWFLOAT=a.shadowEnabled&&(h.textureFloatRender&&h.textureFloatLinearFiltering||h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&i.rebuild(),a.needNormals}function P(e,t,i,s,r,n,a){switch(a.needNormals=!0,void 0===r["LIGHT"+s]&&(a.needRebuild=!0),r["LIGHT"+s]=!0,r["SPOTLIGHT"+s]=!1,r["HEMILIGHT"+s]=!1,r["POINTLIGHT"+s]=!1,r["DIRLIGHT"+s]=!1,r["AREALIGHT"+s]=!1,i.prepareLightSpecificDefines(r,s),r["LIGHT_FALLOFF_PHYSICAL"+s]=!1,r["LIGHT_FALLOFF_GLTF"+s]=!1,r["LIGHT_FALLOFF_STANDARD"+s]=!1,i.falloffType){case o.c.FALLOFF_GLTF:r["LIGHT_FALLOFF_GLTF"+s]=!0;break;case o.c.FALLOFF_PHYSICAL:r["LIGHT_FALLOFF_PHYSICAL"+s]=!0;break;case o.c.FALLOFF_STANDARD:r["LIGHT_FALLOFF_STANDARD"+s]=!0}if(n&&!i.specular.equalsFloats(0,0,0)&&(a.specularEnabled=!0),r["SHADOW"+s]=!1,r["SHADOWCSM"+s]=!1,r["SHADOWCSMDEBUG"+s]=!1,r["SHADOWCSMNUM_CASCADES"+s]=!1,r["SHADOWCSMUSESHADOWMAXZ"+s]=!1,r["SHADOWCSMNOBLEND"+s]=!1,r["SHADOWCSM_RIGHTHANDED"+s]=!1,r["SHADOWPCF"+s]=!1,r["SHADOWPCSS"+s]=!1,r["SHADOWPOISSON"+s]=!1,r["SHADOWESM"+s]=!1,r["SHADOWCLOSEESM"+s]=!1,r["SHADOWCUBE"+s]=!1,r["SHADOWLOWQUALITY"+s]=!1,r["SHADOWMEDIUMQUALITY"+s]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&i.shadowEnabled){const t=i.getShadowGenerator(e.activeCamera)??i.getShadowGenerator();if(t){const e=t.getShadowMap();e&&e.renderList&&e.renderList.length>0&&(a.shadowEnabled=!0,t.prepareDefines(r,s))}}i.lightmapMode!=o.c.LIGHTMAP_DEFAULT?(a.lightmapMode=!0,r["LIGHTMAPEXCLUDED"+s]=!0,r["LIGHTMAPNOSPECULAR"+s]=i.lightmapMode==o.c.LIGHTMAP_SHADOWSONLY):(r["LIGHTMAPEXCLUDED"+s]=!1,r["LIGHTMAPNOSPECULAR"+s]=!1)}function I(e,t,i,s,r,n=null,o=!1){let h=D(e,s);!1!==n&&(h=(0,a.Eq)(i,e,s)),s.DEPTHPREPASS!==!t.getColorWrite()&&(s.DEPTHPREPASS=!s.DEPTHPREPASS,h=!0),s.INSTANCES!==r&&(s.INSTANCES=r,h=!0),s.THIN_INSTANCES!==o&&(s.THIN_INSTANCES=o,h=!0),h&&s.markAsUnprocessed()}function M(e,t,i,s,r=!1,n=!0,o=!0){if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent("normal"),t._needNormals&&e.isVerticesDataPresent("tangent")&&(t.TANGENT=!0);for(let i=1;i<=6;++i)t["UV"+i]=!!t._needUVs&&e.isVerticesDataPresent(`uv${1===i?"":i}`);if(i){const i=e.useVertexColors&&e.isVerticesDataPresent("color");t.VERTEXCOLOR=i,t.VERTEXALPHA=e.hasVertexAlpha&&i&&n}return e.isVerticesDataPresent("instanceColor")&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),s&&function(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;const i=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&i)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!i&&void 0;const s=e.getScene().prePassRenderer;if(s&&s.enabled){const i=-1===s.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=i}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,void 0!==t.BONETEXTURE&&(t.BONETEXTURE=!1)}(e,t),r&&function(e,t){const i=e.morphTargetManager;i?(t.MORPHTARGETS_UV=i.supportsUVs&&t.UV1,t.MORPHTARGETS_UV2=i.supportsUV2s&&t.UV2,t.MORPHTARGETS_TANGENT=i.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=i.supportsNormals&&t.NORMAL,t.MORPHTARGETS_POSITION=i.supportsPositions,t.MORPHTARGETS_COLOR=i.supportsColors,t.MORPHTARGETTEXTURE_HASUVS=i.hasUVs,t.MORPHTARGETTEXTURE_HASUV2S=i.hasUV2s,t.MORPHTARGETTEXTURE_HASTANGENTS=i.hasTangents,t.MORPHTARGETTEXTURE_HASNORMALS=i.hasNormals,t.MORPHTARGETTEXTURE_HASPOSITIONS=i.hasPositions,t.MORPHTARGETTEXTURE_HASCOLORS=i.hasColors,t.NUM_MORPH_INFLUENCERS=i.numMaxInfluencers||i.numInfluencers,t.MORPHTARGETS=t.NUM_MORPH_INFLUENCERS>0,t.MORPHTARGETS_TEXTURE=i.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_UV2=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_POSITION=!1,t.MORPHTARGETS_COLOR=!1,t.MORPHTARGETTEXTURE_HASUVS=!1,t.MORPHTARGETTEXTURE_HASUV2S=!1,t.MORPHTARGETTEXTURE_HASTANGENTS=!1,t.MORPHTARGETTEXTURE_HASNORMALS=!1,t.MORPHTARGETTEXTURE_HASPOSITIONS=!1,t.MORPHTARGETTEXTURE_HAS_COLORS=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}(e,t),o&&function(e,t){const i=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!i||!i.isEnabled)}(e,t),!0}function w(e,t){if(e.activeCamera){const i=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=i&&t.markAsUnprocessed()}}function O(e,t,i){const s=t.ORDER_INDEPENDENT_TRANSPARENCY,r=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&i,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,s===t.ORDER_INDEPENDENT_TRANSPARENCY&&r===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()}function B(e,t,i){const s=t.PREPASS;if(!t._arePrePassDirty)return;const r=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&i){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount,t.PREPASS_NORMAL_WORLDSPACE=e.prePassRenderer.generateNormalsInWorldSpace,t.PREPASS_COLOR=!0,t.PREPASS_COLOR_INDEX=0;for(let i=0;i<r.length;i++){const s=e.prePassRenderer.getIndex(r[i].type);-1!==s?(t[r[i].define]=!0,t[r[i].index]=s):t[r[i].define]=!1}}else{t.PREPASS=!1;for(let e=0;e<r.length;e++)t[r[e].define]=!1}t.PREPASS!=s&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}function D(e,t){let i=!1;if(e.activeCamera){const s=t.CAMERA_ORTHOGRAPHIC?1:0,r=t.CAMERA_PERSPECTIVE?1:0,n=1===e.activeCamera.mode?1:0,o=0===e.activeCamera.mode?1:0;(s^n||r^o)&&(t.CAMERA_ORTHOGRAPHIC=1===n,t.CAMERA_PERSPECTIVE=1===o,i=!0)}return i}function F(e,t,i,s,r=null,n=!1,o=!1){r&&r.push("Light"+e),n||(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightWidth"+e,"vLightHeight"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),i.push("shadowTexture"+e),i.push("depthTexture"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),s&&(i.push("projectionLightTexture"+e),t.push("textureProjectionMatrix"+e)),o&&i.push("iesLightTexture"+e))}function L(e,t,i,s=4){let r,n;if(e.uniformsNames){const o=e;r=o.uniformsNames,n=o.uniformBuffersNames,t=o.samplers,i=o.defines,s=o.maxSimultaneousLights||0}else r=e,t||(t=[]);for(let e=0;e<s&&i["LIGHT"+e];e++)F(e,r,t,i["PROJECTEDLIGHTTEXTURE"+e],n,!1,i["IESLIGHTTEXTURE"+e]);i.NUM_MORPH_INFLUENCERS&&(r.push("morphTargetInfluences"),r.push("morphTargetCount")),i.BAKED_VERTEX_ANIMATION_TEXTURE&&(r.push("bakedVertexAnimationSettings"),r.push("bakedVertexAnimationTextureSizeInverted"),r.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}},5326:(e,t,i)=>{"use strict";i.d(t,{DDSTools:()=>p});var s=i(8857),r=i(3039),n=i(1901),o=i(1498);i(1011);const a=131072,h=131072;function l(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const c=l("DXT1"),u=l("DXT3"),d=l("DXT5"),_=l("DX10");class p{static GetDDSInfo(e){const t=new Int32Array(e.buffer,e.byteOffset,31),i=new Int32Array(e.buffer,e.byteOffset,35);let s=1;t[2]&a&&(s=Math.max(1,t[7]));const r=t[21],n=r===_?i[32]:0;let o=0;switch(r){case 113:o=2;break;case 116:o=1;break;case _:if(10===n){o=2;break}if(2===n){o=1;break}}return{width:t[4],height:t[3],mipmapCount:s,isFourCC:!(4&~t[20]),isRGB:!(64&~t[20]),isLuminance:(t[20]&h)===h,isCube:!(512&~t[28]),isCompressed:r===c||r===u||r===d,dxgiFormat:n,textureType:o}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,t,i,s,r,n){const a=new Float32Array(s),h=new Uint16Array(r,i);let l=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const s=4*(t+i*e);a[l]=(0,o.SX)(h[s]),a[l+1]=(0,o.SX)(h[s+1]),a[l+2]=(0,o.SX)(h[s+2]),p.StoreLODInAlphaChannel?a[l+3]=n:a[l+3]=(0,o.SX)(h[s+3]),l+=4}return a}static _GetHalfFloatRGBAArrayBuffer(e,t,i,s,r,n){if(p.StoreLODInAlphaChannel){const a=new Uint16Array(s),h=new Uint16Array(r,i);let l=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const s=4*(t+i*e);a[l]=h[s],a[l+1]=h[s+1],a[l+2]=h[s+2],a[l+3]=(0,o.LZ)(n),l+=4}return a}return new Uint16Array(r,i,s)}static _GetFloatRGBAArrayBuffer(e,t,i,s,r,n){if(p.StoreLODInAlphaChannel){const o=new Float32Array(s),a=new Float32Array(r,i);let h=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const s=4*(t+i*e);o[h]=a[s],o[h+1]=a[s+1],o[h+2]=a[s+2],o[h+3]=n,h+=4}return o}return new Float32Array(r,i,s)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,t,i,s,r,n){const a=new Uint16Array(s),h=new Float32Array(r,i);let l=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++)a[l]=(0,o.LZ)(h[l]),a[l+1]=(0,o.LZ)(h[l+1]),a[l+2]=(0,o.LZ)(h[l+2]),p.StoreLODInAlphaChannel?a[l+3]=(0,o.LZ)(n):a[l+3]=(0,o.LZ)(h[l+3]),l+=4;return a}static _GetFloatAsUIntRGBAArrayBuffer(e,t,i,r,n,o){const a=new Uint8Array(r),h=new Float32Array(n,i);let l=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const r=4*(t+i*e);a[l]=255*(0,s.Clamp)(h[r]),a[l+1]=255*(0,s.Clamp)(h[r+1]),a[l+2]=255*(0,s.Clamp)(h[r+2]),p.StoreLODInAlphaChannel?a[l+3]=o:a[l+3]=255*(0,s.Clamp)(h[r+3]),l+=4}return a}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,t,i,r,n,a){const h=new Uint8Array(r),l=new Uint16Array(n,i);let c=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const r=4*(t+i*e);h[c]=255*(0,s.Clamp)((0,o.SX)(l[r])),h[c+1]=255*(0,s.Clamp)((0,o.SX)(l[r+1])),h[c+2]=255*(0,s.Clamp)((0,o.SX)(l[r+2])),p.StoreLODInAlphaChannel?h[c+3]=a:h[c+3]=255*(0,s.Clamp)((0,o.SX)(l[r+3])),c+=4}return h}static _GetRGBAArrayBuffer(e,t,i,s,r,n,o,a,h){const l=new Uint8Array(s),c=new Uint8Array(r,i);let u=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const s=4*(t+i*e);l[u]=c[s+n],l[u+1]=c[s+o],l[u+2]=c[s+a],l[u+3]=c[s+h],u+=4}return l}static _ExtractLongWordOrder(e){return 0===e||255===e||-16777216===e?0:1+p._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,t,i,s,r,n,o,a){const h=new Uint8Array(s),l=new Uint8Array(r,i);let c=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const s=3*(t+i*e);h[c]=l[s+n],h[c+1]=l[s+o],h[c+2]=l[s+a],c+=3}return h}static _GetLuminanceArrayBuffer(e,t,i,s,r){const n=new Uint8Array(s),o=new Uint8Array(r,i);let a=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const s=t+i*e;n[a]=o[s],a++}return n}static UploadDDSLevels(e,t,i,s,o,h,l=-1,g,f=!0){let m=null;s.sphericalPolynomial&&(m=[]);const b=!!e.getCaps().s3tc;t.generateMipMaps=o;const v=new Int32Array(i.buffer,i.byteOffset,31);let T,y,x,A,C,S,E,R=0,P=0,I=1;if(542327876!==v[0])return void r.V.Error("Invalid magic number in DDS header");if(!s.isFourCC&&!s.isRGB&&!s.isLuminance)return void r.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(s.isCompressed&&!b)return void r.V.Error("Compressed textures are not supported on this platform.");let M=v[22];A=v[1]+4;let w=!1;if(s.isFourCC)switch(T=v[21],T){case c:I=8,P=33777;break;case u:I=16,P=33778;break;case d:I=16,P=33779;break;case 113:w=!0,M=64;break;case 116:w=!0,M=128;break;case _:{A+=20;let e=!1;switch(s.dxgiFormat){case 10:w=!0,M=64,e=!0;break;case 2:w=!0,M=128,e=!0;break;case 88:s.isRGB=!0,s.isFourCC=!1,M=32,e=!0}if(e)break}default:return void r.V.Error(["Unsupported FourCC code:",(O=T,String.fromCharCode(255&O,O>>8&255,O>>16&255,O>>24&255))])}var O;const B=p._ExtractLongWordOrder(v[23]),D=p._ExtractLongWordOrder(v[24]),F=p._ExtractLongWordOrder(v[25]),L=p._ExtractLongWordOrder(v[26]);w&&(P=e._getRGBABufferInternalSizedFormat(s.textureType)),S=1,v[2]&a&&!1!==o&&(S=Math.max(1,v[7]));const N=g||0,k=e.getCaps();for(let r=N;r<h;r++){for(y=v[4],x=v[3],E=0;E<S;++E){if(-1===l||l===E){const n=-1===l?E:0;if(!s.isCompressed&&s.isFourCC){t.format=5,R=y*x*4;let s=null;if(e._badOS||e._badDesktopOS||!k.textureHalfFloat&&!k.textureFloat)128===M?(s=p._GetFloatAsUIntRGBAArrayBuffer(y,x,i.byteOffset+A,R,i.buffer,n),m&&0==n&&m.push(p._GetFloatRGBAArrayBuffer(y,x,i.byteOffset+A,R,i.buffer,n))):64===M&&(s=p._GetHalfFloatAsUIntRGBAArrayBuffer(y,x,i.byteOffset+A,R,i.buffer,n),m&&0==n&&m.push(p._GetHalfFloatAsFloatRGBAArrayBuffer(y,x,i.byteOffset+A,R,i.buffer,n))),t.type=0;else{const e=k.textureFloat&&(f&&k.textureFloatLinearFiltering||!f),r=k.textureHalfFloat&&(f&&k.textureHalfFloatLinearFiltering||!f),o=(128===M||64===M&&!r)&&e?1:(64===M||128===M&&!e)&&r?2:0;let a,h=null;if(128===M)switch(o){case 1:a=p._GetFloatRGBAArrayBuffer,h=null;break;case 2:a=p._GetFloatAsHalfFloatRGBAArrayBuffer,h=p._GetFloatRGBAArrayBuffer;break;case 0:a=p._GetFloatAsUIntRGBAArrayBuffer,h=p._GetFloatRGBAArrayBuffer}else switch(o){case 1:a=p._GetHalfFloatAsFloatRGBAArrayBuffer,h=null;break;case 2:a=p._GetHalfFloatRGBAArrayBuffer,h=p._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:a=p._GetHalfFloatAsUIntRGBAArrayBuffer,h=p._GetHalfFloatAsFloatRGBAArrayBuffer}t.type=o,s=a(y,x,i.byteOffset+A,R,i.buffer,n),m&&0==n&&m.push(h?h(y,x,i.byteOffset+A,R,i.buffer,n):s)}s&&e._uploadDataToTextureDirectly(t,s,r,n)}else if(s.isRGB)t.type=0,24===M?(t.format=4,R=y*x*3,C=p._GetRGBArrayBuffer(y,x,i.byteOffset+A,R,i.buffer,B,D,F),e._uploadDataToTextureDirectly(t,C,r,n)):(t.format=5,R=y*x*4,C=p._GetRGBAArrayBuffer(y,x,i.byteOffset+A,R,i.buffer,B,D,F,L),e._uploadDataToTextureDirectly(t,C,r,n));else if(s.isLuminance){const s=e._getUnpackAlignement(),o=y;R=Math.floor((y+s-1)/s)*s*(x-1)+o,C=p._GetLuminanceArrayBuffer(y,x,i.byteOffset+A,R,i.buffer),t.format=1,t.type=0,e._uploadDataToTextureDirectly(t,C,r,n)}else R=Math.max(4,y)/4*Math.max(4,x)/4*I,C=new Uint8Array(i.buffer,i.byteOffset+A,R),t.type=0,e._uploadCompressedDataToTextureDirectly(t,P,y,x,C,r,n)}A+=M?y*x*(M/8):R,y*=.5,x*=.5,y=Math.max(1,y),x=Math.max(1,x)}if(void 0!==g)break}m&&m.length>0?s.sphericalPolynomial=n.d.ConvertCubeMapToSphericalPolynomial({size:v[4],right:m[0],left:m[1],up:m[2],down:m[3],front:m[4],back:m[5],format:5,type:1,gammaSpace:!1}):s.sphericalPolynomial=void 0}}p.StoreLODInAlphaChannel=!1},5364:(e,t,i)=>{"use strict";var s=i(769),r=Object.prototype.hasOwnProperty,n=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var i=t&&t.plainObjects?{__proto__:null}:{},s=0;s<e.length;++s)void 0!==e[s]&&(i[s]=e[s]);return i},h=1024;e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,i){return e[i]=t[i],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],i=[],s=0;s<t.length;++s)for(var r=t[s],o=r.obj[r.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],c=o[l];"object"==typeof c&&null!==c&&-1===i.indexOf(c)&&(t.push({obj:o,prop:l}),i.push(c))}return function(e){for(;e.length>1;){var t=e.pop(),i=t.obj[t.prop];if(n(i)){for(var s=[],r=0;r<i.length;++r)void 0!==i[r]&&s.push(i[r]);t.obj[t.prop]=s}}}(t),e},decode:function(e,t,i){var s=e.replace(/\+/g," ");if("iso-8859-1"===i)return s.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(s)}catch(e){return s}},encode:function(e,t,i,r,n){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===i)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var l="",c=0;c<a.length;c+=h){for(var u=a.length>=h?a.slice(c,c+h):a,d=[],_=0;_<u.length;++_){var p=u.charCodeAt(_);45===p||46===p||95===p||126===p||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||n===s.RFC1738&&(40===p||41===p)?d[d.length]=u.charAt(_):p<128?d[d.length]=o[p]:p<2048?d[d.length]=o[192|p>>6]+o[128|63&p]:p<55296||p>=57344?d[d.length]=o[224|p>>12]+o[128|p>>6&63]+o[128|63&p]:(_+=1,p=65536+((1023&p)<<10|1023&u.charCodeAt(_)),d[d.length]=o[240|p>>18]+o[128|p>>12&63]+o[128|p>>6&63]+o[128|63&p])}l+=d.join("")}return l},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(n(e)){for(var i=[],s=0;s<e.length;s+=1)i.push(t(e[s]));return i}return t(e)},merge:function e(t,i,s){if(!i)return t;if("object"!=typeof i&&"function"!=typeof i){if(n(t))t.push(i);else{if(!t||"object"!=typeof t)return[t,i];(s&&(s.plainObjects||s.allowPrototypes)||!r.call(Object.prototype,i))&&(t[i]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(i);var o=t;return n(t)&&!n(i)&&(o=a(t,s)),n(t)&&n(i)?(i.forEach((function(i,n){if(r.call(t,n)){var o=t[n];o&&"object"==typeof o&&i&&"object"==typeof i?t[n]=e(o,i,s):t.push(i)}else t[n]=i})),t):Object.keys(i).reduce((function(t,n){var o=i[n];return r.call(t,n)?t[n]=e(t[n],o,s):t[n]=o,t}),o)}}},5432:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.packingFunctions="vec4 pack(float depth)\n{const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\nfloat unpack(vec4 color)\n{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}"},5549:(e,t,i)=>{"use strict";i.d(t,{c:()=>s});class s{static CompareLightsPriority(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}}s.FALLOFF_DEFAULT=0,s.FALLOFF_PHYSICAL=1,s.FALLOFF_GLTF=2,s.FALLOFF_STANDARD=3,s.LIGHTMAP_DEFAULT=0,s.LIGHTMAP_SPECULAR=1,s.LIGHTMAP_SHADOWSONLY=2,s.INTENSITYMODE_AUTOMATIC=0,s.INTENSITYMODE_LUMINOUSPOWER=1,s.INTENSITYMODE_LUMINOUSINTENSITY=2,s.INTENSITYMODE_ILLUMINANCE=3,s.INTENSITYMODE_LUMINANCE=4,s.LIGHTTYPEID_POINTLIGHT=0,s.LIGHTTYPEID_DIRECTIONALLIGHT=1,s.LIGHTTYPEID_SPOTLIGHT=2,s.LIGHTTYPEID_HEMISPHERICLIGHT=3,s.LIGHTTYPEID_RECT_AREALIGHT=4},5686:(e,t,i)=>{"use strict";i.d(t,{Y5:()=>r,n9:()=>n});const s={};function r(e,t){s[e]=t}function n(e){return s[e]}},5743:(e,t,i)=>{"use strict";i.d(t,{h:()=>r});class s{constructor(e){this._pendingActions=new Array,this._workerInfos=e.map((e=>({workerPromise:Promise.resolve(e),idle:!0})))}dispose(){for(const e of this._workerInfos)e.workerPromise.then((e=>{e.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(e){this._executeOnIdleWorker(e)||this._pendingActions.push(e)}_executeOnIdleWorker(e){for(const t of this._workerInfos)if(t.idle)return this._execute(t,e),!0;return!1}_execute(e,t){e.idle=!1,e.workerPromise.then((i=>{t(i,(()=>{const t=this._pendingActions.shift();t?this._execute(e,t):e.idle=!0}))}))}}class r extends s{constructor(e,t,i=r.DefaultOptions){super([]),this._maxWorkers=e,this._createWorkerAsync=t,this._options=i}push(e){if(!this._executeOnIdleWorker(e))if(this._workerInfos.length<this._maxWorkers){const t={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(t),this._execute(t,e)}else this._pendingActions.push(e)}_execute(e,t){e.timeoutId&&(clearTimeout(e.timeoutId),delete e.timeoutId),super._execute(e,((i,s)=>{t(i,(()=>{s(),e.idle&&(e.timeoutId=setTimeout((()=>{e.workerPromise.then((e=>{e.terminate()}));const t=this._workerInfos.indexOf(e);-1!==t&&this._workerInfos.splice(t,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}r.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},5786:e=>{"use strict";e.exports=Math.round},5826:(e,t,i)=>{"use strict";i.d(t,{_:()=>r,i:()=>s});const s="Z2xURg",r={name:"gltf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:e=>-1!==e.indexOf("asset")&&-1!==e.indexOf("version")||e.startsWith("data:base64,"+s)||e.startsWith("data:;base64,"+s)||e.startsWith("data:application/octet-stream;base64,"+s)||e.startsWith("data:model/gltf-binary;base64,"+s)}},5845:e=>{"use strict";var t=Object.prototype.toString,i=Math.max,s=function(e,t){for(var i=[],s=0;s<e.length;s+=1)i[s]=e[s];for(var r=0;r<t.length;r+=1)i[r+e.length]=t[r];return i};e.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==t.apply(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var n,o=function(e){for(var t=[],i=1,s=0;i<e.length;i+=1,s+=1)t[s]=e[i];return t}(arguments),a=i(0,r.length-o.length),h=[],l=0;l<a;l++)h[l]="$"+l;if(n=Function("binder","return function ("+function(e){for(var t="",i=0;i<e.length;i+=1)t+=e[i],i+1<e.length&&(t+=",");return t}(h)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof n){var t=r.apply(this,s(o,arguments));return Object(t)===t?t:this}return r.apply(e,s(o,arguments))})),r.prototype){var c=function(){};c.prototype=r.prototype,n.prototype=new c,c.prototype=null}return n}},5879:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.bonesVertex="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n"},5923:(e,t,i)=>{"use strict";i.d(t,{J:()=>s});class s{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)}addCPUSkinningFallback(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;const i=this._mesh.getScene();for(let e=0;e<i.meshes.length;e++){const s=i.meshes[e];if(s.material){if(s.computeBonesUsingShaders&&0!==s.numBoneInfluencers)if(s.material.getEffect()===t)s.computeBonesUsingShaders=!1;else if(s.subMeshes)for(const e of s.subMeshes)if(e.effect===t){s.computeBonesUsingShaders=!1;break}}else!this._mesh.material&&s.computeBonesUsingShaders&&s.numBoneInfluencers>0&&(s.computeBonesUsingShaders=!1)}}else{const t=this._defines[this._currentRank];if(t)for(let i=0;i<t.length;i++)e=e.replace("#define "+t[i],"");this._currentRank++}return e}}},5990:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.clipPlaneVertexDeclaration="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n"},6013:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.morphTargetsVertexGlobal="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n"},6042:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.morphTargetsVertex="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\n#if {X}==0\nfor (int i=0; i<NUM_MORPH_INFLUENCERS; i++) {if (i>=morphTargetCount) break;vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;\n#ifdef MORPHTARGETS_POSITION\npositionUpdated+=(readVector3FromRawSampler(i,vertexID)-position)*morphTargetInfluences[i];\n#endif\n#ifdef MORPHTARGETTEXTURE_HASPOSITIONS\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler(i,vertexID) -normal)*morphTargetInfluences[i];\n#endif\n#ifdef MORPHTARGETTEXTURE_HASNORMALS\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler(i,vertexID).xy-uv)*morphTargetInfluences[i];\n#endif\n#ifdef MORPHTARGETTEXTURE_HASUVS\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler(i,vertexID) -tangent.xyz)*morphTargetInfluences[i];\n#endif\n#ifdef MORPHTARGETTEXTURE_HASTANGENTS\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV2\nuv2Updated+=(readVector3FromRawSampler(i,vertexID).xy-uv2)*morphTargetInfluences[i];\n#endif\n#ifdef MORPHTARGETTEXTURE_HASUV2S\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_COLOR\ncolorUpdated+=(readVector4FromRawSampler(i,vertexID)-color)*morphTargetInfluences[i];\n#endif\n}\n#endif\n#else\n#ifdef MORPHTARGETS_POSITION\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV2\nuv2Updated+=(uv2_{X}-uv2)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_COLOR\ncolorUpdated+=(color{X}-color)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n"},6152:(e,t,i)=>{"use strict";var s=i(1588),r=i(9548),n=i(1724);e.exports=s?function(e){return s(e)}:r?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return r(e)}:n?function(e){return n(e)}:null},6190:e=>{"use strict";e.exports=RangeError},6296:e=>{"use strict";e.exports=SyntaxError},6433:e=>{"use strict";e.exports=Object.getOwnPropertyDescriptor},6486:(e,t,i)=>{"use strict";i.d(t,{Y:()=>W});var s=i(4754),r=i(4537),n=i(35),o=i(3736);let a=0;const h=e=>{if(!e.environmentBRDFTexture){const t=e.useDelayedTextureLoading;e.useDelayedTextureLoading=!1;const i=e._blockEntityCollection;e._blockEntityCollection=!1;const s=n.g.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+a++,e,!0,!1,n.g.BILINEAR_SAMPLINGMODE);e._blockEntityCollection=i;const r=e.getEngine().getLoadedTexturesCache(),h=r.indexOf(s.getInternalTexture());-1!==h&&r.splice(h,1),s.isRGBD=!0,s.wrapU=n.g.CLAMP_ADDRESSMODE,s.wrapV=n.g.CLAMP_ADDRESSMODE,e.environmentBRDFTexture=s,e.useDelayedTextureLoading=t,o.G.ExpandRGBDTexture(s);const l=e.getEngine().onContextRestoredObservable.add((()=>{s.isRGBD=!0;const t=e.onBeforeRenderObservable.add((()=>{s.isReady()&&(e.onBeforeRenderObservable.remove(t),o.G.ExpandRGBDTexture(s))}))}));e.onDisposeObservable.add((()=>{e.getEngine().onContextRestoredObservable.remove(l)}))}return e.environmentBRDFTexture};var l=i(451),c=i(3039),u=i(1425),d=i(8836),_=i(4049),p=i(766),g=i(2596),f=i(1243);class m extends g.M{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0}}class b extends f.y{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(e,t=!0){super(e,"PBRBRDF",90,new m,t),this._useEnergyConservation=b.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=b.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=b.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=b.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=b.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=b.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=b.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=b.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=b.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=b.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16],this._enable(!0)}prepareDefines(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,e.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance}getClassName(){return"PBRBRDFConfiguration"}}b.DEFAULT_USE_ENERGY_CONSERVATION=!0,b.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,b.DEFAULT_USE_SPHERICAL_HARMONICS=!0,b.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,b.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsMiscDirty")],b.prototype,"useEnergyConservation",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsMiscDirty")],b.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsMiscDirty")],b.prototype,"useSphericalHarmonics",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsMiscDirty")],b.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsMiscDirty")],b.prototype,"mixIblRadianceWithIrradiance",void 0);var v=i(2793),T=i(3550),y=i(4564),x=i(7638),A=i(879),C=(i(1146),i(5923)),S=i(5241);class E extends g.M{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class R extends f.y{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,t=!0){super(e,"PBRClearCoat",100,new E,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=R._DefaultIndexOfRefraction,this.indexOfRefraction=R._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=l.v9.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t,i){if(!this._isEnabled)return!0;const s=this._material._disableBumpMap;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&A.h.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&A.h.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(i.getCaps().standardDerivatives&&this._bumpTexture&&A.h.ClearCoatBumpTextureEnabled&&!s&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&A.h.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.CLEARCOAT=!0,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&A.h.ClearCoatTextureEnabled?(0,S.YT)(this._texture,e,"CLEARCOAT_TEXTURE"):e.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&A.h.ClearCoatTextureEnabled?(0,S.YT)(this._textureRoughness,e,"CLEARCOAT_TEXTURE_ROUGHNESS"):e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&A.h.ClearCoatBumpTextureEnabled?(0,S.YT)(this._bumpTexture,e,"CLEARCOAT_BUMP"):e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===R._DefaultIndexOfRefraction,this._isTintEnabled?(e.CLEARCOAT_TINT=!0,this._tintTexture&&A.h.ClearCoatTintTextureEnabled?((0,S.YT)(this._tintTexture,e,"CLEARCOAT_TINT_TEXTURE"),e.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):e.CLEARCOAT_TINT_TEXTURE=!1):(e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1))):(e.CLEARCOAT=!1,e.CLEARCOAT_TEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.CLEARCOAT_DEFAULTIOR=!1,e.CLEARCOAT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,e.CLEARCOAT_BUMPDIRECTUV=0,e.CLEARCOAT_REMAP_F0=!1,e.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(e,t,i,s){if(!this._isEnabled)return;const r=s.materialDefines,n=this._material.isFrozen,o=this._material._disableBumpMap,a=this._material._invertNormalMapX,h=this._material._invertNormalMapY;if(!e.useUbo||!n||!e.isSync){(this._texture||this._textureRoughness)&&A.h.ClearCoatTextureEnabled&&(e.updateFloat4("vClearCoatInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&(0,S.mA)(this._texture,e,"clearCoat"),this._textureRoughness&&!r.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,S.mA)(this._textureRoughness,e,"clearCoatRoughness")),this._bumpTexture&&i.getCaps().standardDerivatives&&A.h.ClearCoatTextureEnabled&&!o&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,S.mA)(this._bumpTexture,e,"clearCoatBump"),t._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",a?1:-1,h?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",a?-1:1,h?-1:1)),this._tintTexture&&A.h.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,S.mA)(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);const s=1-this._indexOfRefraction,n=1+this._indexOfRefraction,l=Math.pow(-s/n,2),c=1/this._indexOfRefraction;e.updateFloat4("vClearCoatRefractionParams",l,c,s,n),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}t.texturesEnabled&&(this._texture&&A.h.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!r.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&A.h.ClearCoatTextureEnabled&&e.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&i.getCaps().standardDerivatives&&A.h.ClearCoatBumpTextureEnabled&&!o&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&A.h.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(e){return this._texture===e||this._textureRoughness===e||this._bumpTexture===e||this._tintTexture===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose(),this._bumpTexture?.dispose(),this._tintTexture?.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(e,t,i){return e.CLEARCOAT_BUMP&&t.addFallback(i++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&t.addFallback(i++,"CLEARCOAT_TINT"),e.CLEARCOAT&&t.addFallback(i++,"CLEARCOAT"),i}getSamplers(e){e.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}R._DefaultIndexOfRefraction=1.5,(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isEnabled",void 0),(0,s.Cg)([(0,r.lK)()],R.prototype,"intensity",void 0),(0,s.Cg)([(0,r.lK)()],R.prototype,"roughness",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"indexOfRefraction",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"texture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"useRoughnessFromMainTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"textureRoughness",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"remapF0OnInterfaceChange",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"bumpTexture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isTintEnabled",void 0),(0,s.Cg)([(0,r.jT)()],R.prototype,"tintColor",void 0),(0,s.Cg)([(0,r.lK)()],R.prototype,"tintColorAtDistance",void 0),(0,s.Cg)([(0,r.lK)()],R.prototype,"tintThickness",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"tintTexture",void 0);class P extends g.M{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class I extends f.y{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,t=!0){super(e,"PBRIridescence",110,new P,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.minimumThickness=I._DefaultMinimumThickness,this.maximumThickness=I._DefaultMaximumThickness,this.indexOfRefraction=I._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&A.h.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&A.h.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.IRIDESCENCE=!0,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&A.h.IridescenceTextureEnabled?(0,S.YT)(this._texture,e,"IRIDESCENCE_TEXTURE"):e.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&A.h.IridescenceTextureEnabled?(0,S.YT)(this._thicknessTexture,e,"IRIDESCENCE_THICKNESS_TEXTURE"):e.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(e.IRIDESCENCE=!1,e.IRIDESCENCE_TEXTURE=!1,e.IRIDESCENCE_THICKNESS_TEXTURE=!1,e.IRIDESCENCE_TEXTUREDIRECTUV=0,e.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||((this._texture||this._thicknessTexture)&&A.h.IridescenceTextureEnabled&&(e.updateFloat4("vIridescenceInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._thicknessTexture?.coordinatesIndex??0,this._thicknessTexture?.level??0),this._texture&&(0,S.mA)(this._texture,e,"iridescence"),this._thicknessTexture&&(0,S.mA)(this._thicknessTexture,e,"iridescenceThickness")),e.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),t.texturesEnabled&&(this._texture&&A.h.IridescenceTextureEnabled&&e.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&A.h.IridescenceTextureEnabled&&e.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(e){return this._texture===e||this._thicknessTexture===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._thicknessTexture&&e.push(this._thicknessTexture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture)}dispose(e){e&&(this._texture?.dispose(),this._thicknessTexture?.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(e,t,i){return e.IRIDESCENCE&&t.addFallback(i++,"IRIDESCENCE"),i}getSamplers(e){e.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}I._DefaultMinimumThickness=100,I._DefaultMaximumThickness=400,I._DefaultIndexOfRefraction=1.3,(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isEnabled",void 0),(0,s.Cg)([(0,r.lK)()],I.prototype,"intensity",void 0),(0,s.Cg)([(0,r.lK)()],I.prototype,"minimumThickness",void 0),(0,s.Cg)([(0,r.lK)()],I.prototype,"maximumThickness",void 0),(0,s.Cg)([(0,r.lK)()],I.prototype,"indexOfRefraction",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"texture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"thicknessTexture",void 0);class M extends g.M{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class w extends f.y{set angle(e){this.direction.x=Math.cos(e),this.direction.y=Math.sin(e)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(e,t=!0){super(e,"PBRAnisotropic",110,new M,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new _.I9(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16]}isReadyForSubMesh(e,t){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&A.h.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(e,t,i){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!i.isVerticesDataPresent(p.R.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&A.h.AnisotropicTextureEnabled?(0,S.YT)(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1),e._areMiscDirty&&(e.ANISOTROPIC_LEGACY=this._legacy)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1,e.ANISOTROPIC_TEXTUREDIRECTUV=0,e.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||(this._texture&&A.h.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,S.mA)(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),t.texturesEnabled&&this._texture&&A.h.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){e&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(e,t,i){return e.ANISOTROPIC&&t.addFallback(i++,"ANISOTROPIC"),i}getSamplers(e){e.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(e,t,i){super.parse(e,t,i),void 0===e.legacy&&(this.legacy=!0)}}(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isEnabled",void 0),(0,s.Cg)([(0,r.lK)()],w.prototype,"intensity",void 0),(0,s.Cg)([(0,r.WM)()],w.prototype,"direction",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"texture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsMiscDirty")],w.prototype,"legacy",void 0);class O extends g.M{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class B extends f.y{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,t=!0){super(e,"Sheen",120,new O,t),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=l.v9.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&A.h.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&A.h.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.SHEEN=!0,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e.SHEEN_ROUGHNESS=null!==this._roughness,e.SHEEN_ALBEDOSCALING=this._albedoScaling,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&A.h.SheenTextureEnabled?((0,S.YT)(this._texture,e,"SHEEN_TEXTURE"),e.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):e.SHEEN_TEXTURE=!1,this._textureRoughness&&A.h.SheenTextureEnabled?(0,S.YT)(this._textureRoughness,e,"SHEEN_TEXTURE_ROUGHNESS"):e.SHEEN_TEXTURE_ROUGHNESS=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_GAMMATEXTURE=!1,e.SHEEN_TEXTUREDIRECTUV=0,e.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(e,t,i,s){if(!this._isEnabled)return;const r=s.materialDefines,n=this._material.isFrozen;e.useUbo&&n&&e.isSync||((this._texture||this._textureRoughness)&&A.h.SheenTextureEnabled&&(e.updateFloat4("vSheenInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&(0,S.mA)(this._texture,e,"sheen"),this._textureRoughness&&!r.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,S.mA)(this._textureRoughness,e,"sheenRoughness")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&e.updateFloat("vSheenRoughness",this._roughness)),t.texturesEnabled&&(this._texture&&A.h.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture),this._textureRoughness&&!r.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&A.h.SheenTextureEnabled&&e.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(e){return this._texture===e||this._textureRoughness===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness)}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(e,t,i){return e.SHEEN&&t.addFallback(i++,"SHEEN"),i}getSamplers(e){e.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"isEnabled",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"linkSheenWithAlbedo",void 0),(0,s.Cg)([(0,r.lK)()],B.prototype,"intensity",void 0),(0,s.Cg)([(0,r.jT)()],B.prototype,"color",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"texture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useRoughnessFromMainTexture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"roughness",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"textureRoughness",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"albedoScaling",void 0);class D extends g.M{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class F extends f.y{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(e){this._scene.enableSubSurfaceForPrePass()&&e&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(e))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(e){this._volumeIndexOfRefraction=e>=1?e:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(e,t=!0){super(e,"PBRSubSurface",130,new D,t),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=l.v9.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=l.v9.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=e.getScene(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=e._dirtyCallbacks[32]}isReadyForSubMesh(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._thicknessTexture&&A.h.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&A.h.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&A.h.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const e=this._getRefractionTexture(t);if(e&&A.h.RefractionTextureEnabled&&!e.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return e.SUBSURFACE=!1,e.SS_DISPERSION=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,e.SS_HAS_THICKNESS=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,e.SS_REFRACTIONMAP_3D=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(e.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(e._areTexturesDirty){if(e.SUBSURFACE=!0,e.SS_DISPERSION=this._isDispersionEnabled,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_SCATTERING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_HAS_THICKNESS=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,e._areTexturesDirty&&t.texturesEnabled&&(this._thicknessTexture&&A.h.ThicknessTextureEnabled&&(0,S.YT)(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&A.h.RefractionIntensityTextureEnabled&&(0,S.YT)(this._refractionIntensityTexture,e,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&A.h.TranslucencyIntensityTextureEnabled&&(0,S.YT)(this._translucencyIntensityTexture,e,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&A.h.TranslucencyColorTextureEnabled&&(0,S.YT)(this._translucencyColorTexture,e,"SS_TRANSLUCENCYCOLOR_TEXTURE")),e.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!=0,e.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&t.texturesEnabled){const i=this._getRefractionTexture(t);i&&A.h.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=i.isCube,e.SS_GAMMAREFRACTION=i.gammaSpace,e.SS_RGBDREFRACTION=i.isRGBD,e.SS_LINEARSPECULARREFRACTION=i.linearSpecularLOD,e.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&i.isCube?!i.invertZ:i.invertZ,e.SS_LODINREFRACTIONALPHA=i.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,e.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=i.isCube&&i.boundingBoxSize,e.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(e.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(e,t,i,s){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)e.updateFloat2("vThicknessParam",0,0);else{s.getRenderingMesh().getWorldMatrix().decompose(_.AA.Vector3[0]);const t=Math.max(Math.abs(_.AA.Vector3[0].x),Math.abs(_.AA.Vector3[0].y),Math.abs(_.AA.Vector3[0].z));e.updateFloat2("vThicknessParam",this.minimumThickness*t,(this.maximumThickness-this.minimumThickness)*t)}}bindForSubMesh(e,t,i,s){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const r=s.materialDefines,n=this._material.isFrozen,o=this._material.realTimeFiltering,a=r.LODBASEDMICROSFURACE,h=this._getRefractionTexture(t);if(!e.useUbo||!n||!e.isSync){if(this._thicknessTexture&&A.h.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,S.mA)(this._thicknessTexture,e,"thickness")),this._refractionIntensityTexture&&A.h.RefractionIntensityTextureEnabled&&r.SS_REFRACTIONINTENSITY_TEXTURE&&(e.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,S.mA)(this._refractionIntensityTexture,e,"refractionIntensity")),this._translucencyColorTexture&&A.h.TranslucencyColorTextureEnabled&&r.SS_TRANSLUCENCYCOLOR_TEXTURE&&(e.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,S.mA)(this._translucencyColorTexture,e,"translucencyColor")),this._translucencyIntensityTexture&&A.h.TranslucencyIntensityTextureEnabled&&r.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(e.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,S.mA)(this._translucencyIntensityTexture,e,"translucencyIntensity")),h&&A.h.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",h.getRefractionTextureMatrix());let t=1;h.isCube||h.depth&&(t=h.depth);const i=h.getSize().width,s=this.volumeIndexOfRefraction;if(e.updateFloat4("vRefractionInfos",h.level,1/s,t,this._invertRefractionY?-1:1),e.updateFloat4("vRefractionMicrosurfaceInfos",i,h.lodGenerationScale,h.lodGenerationOffset,1/this.indexOfRefraction),o&&e.updateFloat2("vRefractionFilteringInfo",i,Math.log2(i)),h.boundingBoxSize){const t=h;e.updateVector3("vRefractionPosition",t.boundingBoxPosition),e.updateVector3("vRefractionSize",t.boundingBoxSize)}}this._isScatteringEnabled&&e.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),e.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),e.updateFloat("dispersion",this.dispersion)}t.texturesEnabled&&(this._thicknessTexture&&A.h.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&A.h.RefractionIntensityTextureEnabled&&r.SS_REFRACTIONINTENSITY_TEXTURE&&e.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&A.h.TranslucencyIntensityTextureEnabled&&r.SS_TRANSLUCENCYINTENSITY_TEXTURE&&e.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&A.h.TranslucencyColorTextureEnabled&&r.SS_TRANSLUCENCYCOLOR_TEXTURE&&e.setTexture("translucencyColorSampler",this._translucencyColorTexture),h&&A.h.RefractionTextureEnabled&&(a?e.setTexture("refractionSampler",h):(e.setTexture("refractionSampler",h._lodTextureMid||h),e.setTexture("refractionSamplerLow",h._lodTextureLow||h),e.setTexture("refractionSamplerHigh",h._lodTextureHigh||h))))}_getRefractionTexture(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(e){A.h.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)}hasTexture(e){return this._thicknessTexture===e||this._refractionTexture===e||this._refractionIntensityTexture===e||this._translucencyIntensityTexture===e||this._translucencyColorTexture===e}hasRenderTargetTextures(){return!!(A.h.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture),this._translucencyColorTexture&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&e.push(this._translucencyIntensityTexture)}getAnimatables(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&e.push(this._translucencyIntensityTexture)}dispose(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(e,t,i){return e.SS_SCATTERING&&t.addFallback(i++,"SS_SCATTERING"),e.SS_TRANSLUCENCY&&t.addFallback(i++,"SS_TRANSLUCENCY"),i}getSamplers(e){e.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isRefractionEnabled",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isTranslucencyEnabled",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isDispersionEnabled",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markScenePrePassDirty")],F.prototype,"isScatteringEnabled",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"refractionIntensity",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"translucencyIntensity",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"useAlbedoToTintRefraction",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"useAlbedoToTintTranslucency",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"thicknessTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"refractionTexture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"indexOfRefraction",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"_volumeIndexOfRefraction",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"volumeIndexOfRefraction",null),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"invertRefractionY",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"linkRefractionWithTransparency",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"minimumThickness",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"maximumThickness",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"useThicknessAsDepth",void 0),(0,s.Cg)([(0,r.jT)()],F.prototype,"tintColor",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"tintColorAtDistance",void 0),(0,s.Cg)([(0,r.lK)()],F.prototype,"dispersion",void 0),(0,s.Cg)([(0,r.jT)()],F.prototype,"diffusionDistance",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useMaskFromThicknessTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"refractionIntensityTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"translucencyIntensityTexture",void 0),(0,s.Cg)([(0,r.jT)()],F.prototype,"translucencyColor",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"translucencyColorTexture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useGltfStyleTextures",void 0);var L=i(3564),N=i(8042),k=i(8884);const U={effect:null,subMesh:null};class V extends g.M{constructor(e){super(e),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASEWEIGHT=!1,this.BASEWEIGHTDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class G extends x.E{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(e){this._realTimeFiltering=e,this.markAsDirty(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(e){this._realTimeFilteringQuality=e,this.markAsDirty(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(e,t,i=!1){super(e,t,void 0,i||G.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new _.IU(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=G.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=l.v9.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new l.v9(0,0,0),this._albedoColor=new l.v9(1,1,1),this._baseWeight=1,this._reflectivityColor=new l.v9(1,1,1),this._reflectionColor=new l.v9(1,1,1),this._emissiveColor=new l.v9(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=G.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new u.L(16),this._globalAmbientColor=new l.v9(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new b(this),this.clearCoat=new R(this),this.iridescence=new I(this),this.anisotropy=new w(this),this.sheen=new B(this),this.subSurface=new F(this),this.detailMap=new L.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),A.h.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=h(this.getScene()),this.prePassConfiguration=new v.J}get hasRenderTargetTextures(){return!!(A.h.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){return this._transparencyMode===G.PBRMATERIAL_OPAQUE||this._transparencyMode===G.PBRMATERIAL_ALPHATEST||this.subSurface?.disableAlphaBlending}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.subSurface?.disableAlphaBlending&&this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===G.PBRMATERIAL_ALPHATEST)}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==G.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(e,t,i){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const s=t._drawWrapper;if(s.effect&&this.isFrozen&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new V(this._eventInfo.defineNames));const r=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const n=this.getScene(),o=n.getEngine();if(r._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,n.texturesEnabled)){if(this._albedoTexture&&A.h.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&A.h.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&A.h.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&A.h.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const e=this._getReflectionTexture();if(e&&A.h.ReflectionTextureEnabled){if(!e.isReadyOrNotBlocking())return!1;if(e.irradianceTexture){if(!e.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!e.sphericalPolynomial&&e.getInternalTexture()?._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&A.h.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&A.h.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(A.h.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(o.getCaps().standardDerivatives&&this._bumpTexture&&A.h.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&A.h.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=r,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(r._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(r.AREALIGHTUSED)for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1;o.getCaps().standardDerivatives||e.isVerticesDataPresent(p.R.NormalKind)||(e.createNormals(!0),c.V.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));const a=t.effect,h=r._areLightsDisposed;let l=this._prepareEffect(e,r,this.onCompiled,this.onError,i,null,t.getRenderingMesh().hasThinInstances),u=!1;if(l)if(this._onEffectCreatedObservable&&(U.effect=l,U.subMesh=t,this._onEffectCreatedObservable.notifyObservers(U)),this.allowShaderHotSwapping&&a&&!l.isReady()){if(l=a,r.markAsUnprocessed(),u=this.isFrozen,h)return r._areLightsDisposed=!0,!1}else n.resetCachedMaterial(),t.setEffect(l,r,this._materialContext);return!(!t.effect||!t.effect.isReady()||(r._renderId=n.getRenderId(),s._wasPreviouslyReady=!u,s._wasPreviouslyUsingInstances=!!i,this._checkScenePerformancePriority(),0))}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(e,t,s=null,r=null,n=null,o=null,a){if(this._prepareDefines(e,t,n,o,a),!t.isDirty)return null;t.markAsProcessed();const h=this.getScene().getEngine(),l=new C.J;let c=0;t.USESPHERICALINVERTEX&&l.addFallback(c++,"USESPHERICALINVERTEX"),t.FOG&&l.addFallback(c,"FOG"),t.SPECULARAA&&l.addFallback(c,"SPECULARAA"),t.POINTSIZE&&l.addFallback(c,"POINTSIZE"),t.LOGARITHMICDEPTH&&l.addFallback(c,"LOGARITHMICDEPTH"),t.PARALLAX&&l.addFallback(c,"PARALLAX"),t.PARALLAX_RHS&&l.addFallback(c,"PARALLAX_RHS"),t.PARALLAXOCCLUSION&&l.addFallback(c++,"PARALLAXOCCLUSION"),t.ENVIRONMENTBRDF&&l.addFallback(c++,"ENVIRONMENTBRDF"),t.TANGENT&&l.addFallback(c++,"TANGENT"),t.BUMP&&l.addFallback(c++,"BUMP"),c=(0,S.c4)(t,l,this._maxSimultaneousLights,c++),t.SPECULARTERM&&l.addFallback(c++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&l.addFallback(c++,"USESPHERICALFROMREFLECTIONMAP"),t.USEIRRADIANCEMAP&&l.addFallback(c++,"USEIRRADIANCEMAP"),t.LIGHTMAP&&l.addFallback(c++,"LIGHTMAP"),t.NORMAL&&l.addFallback(c++,"NORMAL"),t.AMBIENT&&l.addFallback(c++,"AMBIENT"),t.EMISSIVE&&l.addFallback(c++,"EMISSIVE"),t.VERTEXCOLOR&&l.addFallback(c++,"VERTEXCOLOR"),t.MORPHTARGETS&&l.addFallback(c++,"MORPHTARGETS"),t.MULTIVIEW&&l.addFallback(0,"MULTIVIEW");const u=[p.R.PositionKind];t.NORMAL&&u.push(p.R.NormalKind),t.TANGENT&&u.push(p.R.TangentKind);for(let e=1;e<=6;++e)t["UV"+e]&&u.push(`uv${1===e?"":e}`);t.VERTEXCOLOR&&u.push(p.R.ColorKind),(0,S.ni)(u,e,t,l),(0,S.ER)(u,t),(0,S.IF)(u,e,t),(0,S.J2)(u,e,t);let d="pbr";const _=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],g=["albedoSampler","baseWeightSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],f=["Material","Scene","Mesh"],m={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=l,this._eventInfo.fallbackRank=c,this._eventInfo.defines=t,this._eventInfo.uniforms=_,this._eventInfo.attributes=u,this._eventInfo.samplers=g,this._eventInfo.uniformBuffersNames=f,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=m,this._callbackPluginEventGeneric(128,this._eventInfo),k.m.AddUniformsAndSamplers(_,g),v.J.AddUniforms(_),v.J.AddSamplers(g),(0,N.TV)(_),T.p&&(T.p.PrepareUniforms(_,t),T.p.PrepareSamplers(g,t)),(0,S.Bb)({uniformsNames:_,uniformBuffersNames:f,samplers:g,defines:t,maxSimultaneousLights:this._maxSimultaneousLights});const b={};this.customShaderNameResolve&&(d=this.customShaderNameResolve(d,_,f,g,t,u,b));const y=t.toString(),x=h.createEffect(d,{attributes:u,uniformsNames:_,uniformBuffersNames:f,samplers:g,defines:y,fallbacks:l,onCompiled:s,onError:r,indexParameters:m,processFinalCode:b.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:t.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([i.e(8699),i.e(6476)]).then(i.bind(i,4095)),Promise.all([i.e(9676),i.e(3991)]).then(i.bind(i,3991))]):await Promise.all([i.e(3086).then(i.bind(i,705)),Promise.all([i.e(2988),i.e(8826)]).then(i.bind(i,8826))]),this._shadersLoaded=!0}},h);return this._eventInfo.customCode=void 0,x}_prepareDefines(e,t,i=null,s=null,r=!1){const o=this.getScene(),a=o.getEngine();(0,S.az)(o,e,t,!0,this._maxSimultaneousLights,this._disableLighting),t._needNormals=!0,(0,S.VO)(o,t);const h=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if((0,S.N4)(o,t,this.canRenderToMRT&&!h),(0,S.Nc)(o,t,h),k.m.PrepareDefines(a.currentRenderPassId,e,t),t.METALLICWORKFLOW=this.isMetallicWorkflow(),t._areTexturesDirty){t._needUVs=!1;for(let e=1;e<=6;++e)t["MAINUV"+e]=!1;if(o.texturesEnabled){t.ALBEDODIRECTUV=0,t.BASEWEIGHTDIRECTUV=0,t.AMBIENTDIRECTUV=0,t.OPACITYDIRECTUV=0,t.EMISSIVEDIRECTUV=0,t.REFLECTIVITYDIRECTUV=0,t.MICROSURFACEMAPDIRECTUV=0,t.METALLIC_REFLECTANCEDIRECTUV=0,t.REFLECTANCEDIRECTUV=0,t.BUMPDIRECTUV=0,t.LIGHTMAPDIRECTUV=0,a.getCaps().textureLOD&&(t.LODBASEDMICROSFURACE=!0),this._albedoTexture&&A.h.DiffuseTextureEnabled?((0,S.YT)(this._albedoTexture,t,"ALBEDO"),t.GAMMAALBEDO=this._albedoTexture.gammaSpace):t.ALBEDO=!1,this._baseWeightTexture&&A.h.BaseWeightTextureEnabled?(0,S.YT)(this._baseWeightTexture,t,"BASEWEIGHT"):t.BASEWEIGHT=!1,this._ambientTexture&&A.h.AmbientTextureEnabled?((0,S.YT)(this._ambientTexture,t,"AMBIENT"),t.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):t.AMBIENT=!1,this._opacityTexture&&A.h.OpacityTextureEnabled?((0,S.YT)(this._opacityTexture,t,"OPACITY"),t.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):t.OPACITY=!1;const e=this._getReflectionTexture();if(e&&A.h.ReflectionTextureEnabled){switch(t.REFLECTION=!0,t.GAMMAREFLECTION=e.gammaSpace,t.RGBDREFLECTION=e.isRGBD,t.LODINREFLECTIONALPHA=e.lodLevelInAlpha,t.LINEARSPECULARREFLECTION=e.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(t.NUM_SAMPLES=""+this.realTimeFilteringQuality,a._features.needTypeSuffixInShaderConstants&&(t.NUM_SAMPLES=t.NUM_SAMPLES+"u"),t.REALTIME_FILTERING=!0,this.getScene().iblCdfGenerator&&(t.IBL_CDF_FILTERING=!0)):t.REALTIME_FILTERING=!1,t.INVERTCUBICMAP=e.coordinatesMode===n.g.INVCUBIC_MODE,t.REFLECTIONMAP_3D=e.isCube,t.REFLECTIONMAP_OPPOSITEZ=t.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!e.invertZ:e.invertZ,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.coordinatesMode){case n.g.EXPLICIT_MODE:t.REFLECTIONMAP_EXPLICIT=!0;break;case n.g.PLANAR_MODE:t.REFLECTIONMAP_PLANAR=!0;break;case n.g.PROJECTION_MODE:t.REFLECTIONMAP_PROJECTION=!0;break;case n.g.SKYBOX_MODE:t.REFLECTIONMAP_SKYBOX=!0;break;case n.g.SPHERICAL_MODE:t.REFLECTIONMAP_SPHERICAL=!0;break;case n.g.EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case n.g.FIXED_EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case n.g.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case n.g.CUBIC_MODE:case n.g.INVCUBIC_MODE:default:t.REFLECTIONMAP_CUBIC=!0,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!!e.boundingBoxSize}e.coordinatesMode!==n.g.SKYBOX_MODE&&(e.irradianceTexture?(t.USEIRRADIANCEMAP=!0,t.USESPHERICALFROMREFLECTIONMAP=!1,t.USESPHERICALINVERTEX=!1):e.isCube&&(t.USESPHERICALFROMREFLECTIONMAP=!0,t.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||a.getCaps().maxVaryingVectors<=8?t.USESPHERICALINVERTEX=!1:t.USESPHERICALINVERTEX=!0))}else t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.USESPHERICALFROMREFLECTIONMAP=!1,t.USEIRRADIANCEMAP=!1,t.USESPHERICALINVERTEX=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&A.h.LightmapTextureEnabled?((0,S.YT)(this._lightmapTexture,t,"LIGHTMAP"),t.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,t.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,t.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):t.LIGHTMAP=!1,this._emissiveTexture&&A.h.EmissiveTextureEnabled?((0,S.YT)(this._emissiveTexture,t,"EMISSIVE"),t.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):t.EMISSIVE=!1,A.h.SpecularTextureEnabled?(this._metallicTexture?((0,S.YT)(this._metallicTexture,t,"REFLECTIVITY"),t.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,t.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,t.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,t.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,t.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,S.YT)(this._reflectivityTexture,t,"REFLECTIVITY"),t.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,t.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,t.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):t.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(t.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,S.YT)(this._metallicReflectanceTexture,t,"METALLIC_REFLECTANCE"),t.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):t.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,S.YT)(this._reflectanceTexture,t,"REFLECTANCE"),t.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):t.REFLECTANCE=!1):(t.METALLIC_REFLECTANCE=!1,t.REFLECTANCE=!1),this._microSurfaceTexture?(0,S.YT)(this._microSurfaceTexture,t,"MICROSURFACEMAP"):t.MICROSURFACEMAP=!1):(t.REFLECTIVITY=!1,t.MICROSURFACEMAP=!1),a.getCaps().standardDerivatives&&this._bumpTexture&&A.h.BumpTextureEnabled&&!this._disableBumpMap?((0,S.YT)(this._bumpTexture,t,"BUMP"),this._useParallax&&this._albedoTexture&&A.h.DiffuseTextureEnabled?(t.PARALLAX=!0,t.PARALLAX_RHS=o.useRightHandedSystem,t.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):t.PARALLAX=!1,t.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(t.BUMP=!1,t.PARALLAX=!1,t.PARALLAX_RHS=!1,t.PARALLAXOCCLUSION=!1,t.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&A.h.ReflectionTextureEnabled?(t.ENVIRONMENTBRDF=!0,t.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(t.ENVIRONMENTBRDF=!1,t.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?t.ALPHAFROMALBEDO=!0:t.ALPHAFROMALBEDO=!1}t.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===G.LIGHTFALLOFF_STANDARD?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===G.LIGHTFALLOFF_GLTF?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!0):(t.USEPHYSICALLIGHTFALLOFF=!0,t.USEGLTFLIGHTFALLOFF=!1),t.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?t.TWOSIDEDLIGHTING=!0:t.TWOSIDEDLIGHTING=!1,t.SPECULARAA=a.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(t._areTexturesDirty||t._areMiscDirty)&&(t.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1==0?".":""}`,t.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,t.ALPHABLEND=this.needAlphaBlendingForMesh(e),t.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,t.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),t._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(t),t.FORCENORMALFORWARD=this._forceNormalForward,t.RADIANCEOCCLUSION=this._useRadianceOcclusion,t.HORIZONOCCLUSION=this._useHorizonOcclusion,t._areMiscDirty&&((0,S.fm)(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),t,this._applyDecalMapAfterDetailMap),t.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(p.R.NormalKind),t.DEBUGMODE=this._debugMode),(0,S.OR)(o,a,this,t,!!i,s,r),this._eventInfo.defines=t,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,S.qB)(e,t,!0,!0,!0,this._transparencyMode!==G.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(e,t,i){const s={clipPlane:!1,useInstances:!1,...i};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo),(()=>{if(this._breakShaderLoadedCheck)return;const i=new V(this._eventInfo.defineNames),r=this._prepareEffect(e,i,void 0,void 0,s.useInstances,s.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(U.effect=r,U.subMesh=null,this._onEffectCreatedObservable.notifyObservers(U)),r.isReady()?t&&t(this):r.onCompileObservable.add((()=>{t&&t(this)}))})()}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vBaseWeightInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionFilteringInfo",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("baseWeightMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("baseWeight",1),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vAmbientColor",3),e.addUniform("vDebugMode",2),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),e.addUniform("vReflectanceInfos",2),e.addUniform("reflectanceMatrix",16),e.addUniform("vSphericalL00",3),e.addUniform("vSphericalL1_1",3),e.addUniform("vSphericalL10",3),e.addUniform("vSphericalL11",3),e.addUniform("vSphericalL2_2",3),e.addUniform("vSphericalL2_1",3),e.addUniform("vSphericalL20",3),e.addUniform("vSphericalL21",3),e.addUniform("vSphericalL22",3),e.addUniform("vSphericalX",3),e.addUniform("vSphericalY",3),e.addUniform("vSphericalZ",3),e.addUniform("vSphericalXX_ZZ",3),e.addUniform("vSphericalYY_ZZ",3),e.addUniform("vSphericalZZ",3),e.addUniform("vSphericalXY",3),e.addUniform("vSphericalYZ",3),e.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(e,t,i){const s=this.getScene(),r=i.materialDefines;if(!r)return;const n=i.effect;if(!n)return;this._activeEffect=n,t.getMeshUniformBuffer().bindToEffect(n,"Mesh"),t.transferToEffect(e);const o=s.getEngine();this._uniformBuffer.bindToEffect(n,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,s,t,e,this.isFrozen),k.m.Bind(o.currentRenderPassId,this._activeEffect,t,e),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),r.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const a=this._mustRebind(s,n,i,t.visibility);(0,S.f$)(t,this._activeEffect,this.prePassConfiguration);let h=null;const c=this._uniformBuffer;if(a){if(this.bindViewProjection(n),h=this._getReflectionTexture(),!c.useUbo||!this.isFrozen||!c.isSync||i._drawWrapper._forceRebindOnNextCall){if(s.texturesEnabled){if(this._albedoTexture&&A.h.DiffuseTextureEnabled&&(c.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,S.mA)(this._albedoTexture,c,"albedo")),this._baseWeightTexture&&A.h.BaseWeightTextureEnabled&&(c.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,S.mA)(this._baseWeightTexture,c,"baseWeight")),this._ambientTexture&&A.h.AmbientTextureEnabled&&(c.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,S.mA)(this._ambientTexture,c,"ambient")),this._opacityTexture&&A.h.OpacityTextureEnabled&&(c.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,S.mA)(this._opacityTexture,c,"opacity")),h&&A.h.ReflectionTextureEnabled){if(c.updateMatrix("reflectionMatrix",h.getReflectionTextureMatrix()),c.updateFloat2("vReflectionInfos",h.level,0),h.boundingBoxSize){const e=h;c.updateVector3("vReflectionPosition",e.boundingBoxPosition),c.updateVector3("vReflectionSize",e.boundingBoxSize)}if(this.realTimeFiltering){const e=h.getSize().width;c.updateFloat2("vReflectionFilteringInfo",e,Math.log2(e))}if(!r.USEIRRADIANCEMAP){const e=h.sphericalPolynomial;if(r.USESPHERICALFROMREFLECTIONMAP&&e)if(r.SPHERICAL_HARMONICS){const t=e.preScaledHarmonics;c.updateVector3("vSphericalL00",t.l00),c.updateVector3("vSphericalL1_1",t.l1_1),c.updateVector3("vSphericalL10",t.l10),c.updateVector3("vSphericalL11",t.l11),c.updateVector3("vSphericalL2_2",t.l2_2),c.updateVector3("vSphericalL2_1",t.l2_1),c.updateVector3("vSphericalL20",t.l20),c.updateVector3("vSphericalL21",t.l21),c.updateVector3("vSphericalL22",t.l22)}else c.updateFloat3("vSphericalX",e.x.x,e.x.y,e.x.z),c.updateFloat3("vSphericalY",e.y.x,e.y.y,e.y.z),c.updateFloat3("vSphericalZ",e.z.x,e.z.y,e.z.z),c.updateFloat3("vSphericalXX_ZZ",e.xx.x-e.zz.x,e.xx.y-e.zz.y,e.xx.z-e.zz.z),c.updateFloat3("vSphericalYY_ZZ",e.yy.x-e.zz.x,e.yy.y-e.zz.y,e.yy.z-e.zz.z),c.updateFloat3("vSphericalZZ",e.zz.x,e.zz.y,e.zz.z),c.updateFloat3("vSphericalXY",e.xy.x,e.xy.y,e.xy.z),c.updateFloat3("vSphericalYZ",e.yz.x,e.yz.y,e.yz.z),c.updateFloat3("vSphericalZX",e.zx.x,e.zx.y,e.zx.z)}c.updateFloat3("vReflectionMicrosurfaceInfos",h.getSize().width,h.lodGenerationScale,h.lodGenerationOffset)}this._emissiveTexture&&A.h.EmissiveTextureEnabled&&(c.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,S.mA)(this._emissiveTexture,c,"emissive")),this._lightmapTexture&&A.h.LightmapTextureEnabled&&(c.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,S.mA)(this._lightmapTexture,c,"lightmap")),A.h.SpecularTextureEnabled&&(this._metallicTexture?(c.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,S.mA)(this._metallicTexture,c,"reflectivity")):this._reflectivityTexture&&(c.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,S.mA)(this._reflectivityTexture,c,"reflectivity")),this._metallicReflectanceTexture&&(c.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,S.mA)(this._metallicReflectanceTexture,c,"metallicReflectance")),this._reflectanceTexture&&r.REFLECTANCE&&(c.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,S.mA)(this._reflectanceTexture,c,"reflectance")),this._microSurfaceTexture&&(c.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,S.mA)(this._microSurfaceTexture,c,"microSurfaceSampler"))),this._bumpTexture&&o.getCaps().standardDerivatives&&A.h.BumpTextureEnabled&&!this._disableBumpMap&&(c.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,S.mA)(this._bumpTexture,c,"bump"),s._mirroredCameraPosition?c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&c.updateFloat("pointSize",this.pointSize),r.METALLICWORKFLOW){l.IG.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,l.IG.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,c.updateColor4("vReflectivityColor",l.IG.Color3[0],1);const e=this.subSurface?._indexOfRefraction??1.5,t=1,i=Math.pow((e-t)/(e+t),2);this._metallicReflectanceColor.scaleToRef(i*this._metallicF0Factor,l.IG.Color3[0]);const s=this._metallicF0Factor;c.updateColor4("vMetallicReflectanceFactors",l.IG.Color3[0],s)}else c.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);c.updateColor3("vEmissiveColor",A.h.EmissiveTextureEnabled?this._emissiveColor:l.v9.BlackReadOnly),c.updateColor3("vReflectionColor",this._reflectionColor),!r.SS_REFRACTION&&this.subSurface?._linkRefractionWithTransparency?c.updateColor4("vAlbedoColor",this._albedoColor,1):c.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),c.updateFloat("baseWeight",this._baseWeight),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*s.environmentIntensity,this._lightingInfos.w=this._specularIntensity,c.updateVector4("vLightingIntensity",this._lightingInfos),s.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),c.updateColor3("vAmbientColor",this._globalAmbientColor),c.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(s.texturesEnabled){if(this._albedoTexture&&A.h.DiffuseTextureEnabled&&c.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&A.h.BaseWeightTextureEnabled&&c.setTexture("baseWeightSampler",this._baseWeightTexture),this._ambientTexture&&A.h.AmbientTextureEnabled&&c.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&A.h.OpacityTextureEnabled&&c.setTexture("opacitySampler",this._opacityTexture),h&&A.h.ReflectionTextureEnabled){r.LODBASEDMICROSFURACE?c.setTexture("reflectionSampler",h):(c.setTexture("reflectionSampler",h._lodTextureMid||h),c.setTexture("reflectionSamplerLow",h._lodTextureLow||h),c.setTexture("reflectionSamplerHigh",h._lodTextureHigh||h)),r.USEIRRADIANCEMAP&&c.setTexture("irradianceSampler",h.irradianceTexture);const e=this.getScene().iblCdfGenerator;this.realTimeFiltering&&e&&c.setTexture("icdfSampler",e.getIcdfTexture())}r.ENVIRONMENTBRDF&&c.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&A.h.EmissiveTextureEnabled&&c.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&A.h.LightmapTextureEnabled&&c.setTexture("lightmapSampler",this._lightmapTexture),A.h.SpecularTextureEnabled&&(this._metallicTexture?c.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&c.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&c.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&r.REFLECTANCE&&c.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&c.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&o.getCaps().standardDerivatives&&A.h.BumpTextureEnabled&&!this._disableBumpMap&&c.setTexture("bumpSampler",this._bumpTexture)}this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(n),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,N.gS)(this._activeEffect,this,s),this.bindEyePosition(n)}else s.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!a&&this.isFrozen||(s.lightsEnabled&&!this._disableLighting&&(0,S.RL)(s,t,this._activeEffect,r,this._maxSimultaneousLights),(s.fogEnabled&&t.applyFog&&s.fogMode!==d.Z.FOGMODE_NONE||h||this.subSurface.refractionTexture||t.receiveShadows||r.PREPASS)&&this.bindView(n),(0,S.Yy)(s,t,this._activeEffect,!0),r.NUM_MORPH_INFLUENCERS&&(0,S.nR)(t,this._activeEffect),r.BAKED_VERTEX_ANIMATION_TEXTURE&&t.bakedVertexAnimationManager?.bind(n,r.INSTANCES),this._imageProcessingConfiguration.bind(this._activeEffect),(0,S.DL)(r,this._activeEffect,s)),this._afterBind(t,this._activeEffect,i),c.update()}getAnimatables(){const e=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&e.push(this._baseWeightTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&e.push(this._microSurfaceTexture),e}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture}getActiveTextures(){const e=super.getActiveTextures();return this._albedoTexture&&e.push(this._albedoTexture),this._baseWeightTexture&&e.push(this._baseWeightTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),e}hasTexture(e){return!!super.hasTexture(e)||this._albedoTexture===e||this._baseWeightTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._reflectivityTexture===e||this._metallicTexture===e||this._metallicReflectanceTexture===e||this._reflectanceTexture===e||this._microSurfaceTexture===e||this._bumpTexture===e||this._lightmapTexture===e}setPrePassRenderer(){if(!this.subSurface?.isScatteringEnabled)return!1;const e=this.getScene().enableSubSurfaceForPrePass();return e&&(e.enabled=!0),!0}dispose(e,t){this._breakShaderLoadedCheck=!0,t&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._albedoTexture?.dispose(),this._baseWeightTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._metallicTexture?.dispose(),this._reflectivityTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._metallicReflectanceTexture?.dispose(),this._reflectanceTexture?.dispose(),this._microSurfaceTexture?.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}}G.PBRMATERIAL_OPAQUE=y.i.MATERIAL_OPAQUE,G.PBRMATERIAL_ALPHATEST=y.i.MATERIAL_ALPHATEST,G.PBRMATERIAL_ALPHABLEND=y.i.MATERIAL_ALPHABLEND,G.PBRMATERIAL_ALPHATESTANDBLEND=y.i.MATERIAL_ALPHATESTANDBLEND,G.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,G.LIGHTFALLOFF_PHYSICAL=0,G.LIGHTFALLOFF_GLTF=1,G.LIGHTFALLOFF_STANDARD=2,G.ForceGLSL=!1,(0,s.Cg)([(0,r.n1)()],G.prototype,"_imageProcessingConfiguration",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsMiscDirty")],G.prototype,"debugMode",void 0);var z=i(5686),H=i(979);class W extends G{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(e){this.subSurface.indexOfRefraction=e}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(e){this.subSurface.invertRefractionY=e}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===G.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?G.LIGHTFALLOFF_PHYSICAL:G.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===G.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?G.LIGHTFALLOFF_GLTF:G.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}constructor(e,t,i=!1){super(e,t,i),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=W.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=l.v9.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new l.v9(0,0,0),this.albedoColor=new l.v9(1,1,1),this.baseWeight=1,this.reflectivityColor=new l.v9(1,1,1),this.reflectionColor=new l.v9(1,1,1),this.emissiveColor=new l.v9(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=h(this.getScene())}getClassName(){return"PBRMaterial"}clone(e,t=!0,i=""){const s=H.p.Clone((()=>new W(e,this.getScene())),this,{cloneTexturesOnlyOnce:t});return s.id=e,s.name=e,this.stencil.copyTo(s.stencil),this._clonePlugins(s,i),s}serialize(){const e=super.serialize();return e.customType="BABYLON.PBRMaterial",e}static Parse(e,t,i){const s=H.p.Parse((()=>new W(e.name,t)),e,t,i);return e.stencil&&s.stencil.parse(e.stencil,t,i),y.i._ParsePlugins(e,s,t,i),e.clearCoat&&s.clearCoat.parse(e.clearCoat,t,i),e.anisotropy&&s.anisotropy.parse(e.anisotropy,t,i),e.brdf&&s.brdf.parse(e.brdf,t,i),e.sheen&&s.sheen.parse(e.sheen,t,i),e.subSurface&&s.subSurface.parse(e.subSurface,t,i),e.iridescence&&s.iridescence.parse(e.iridescence,t,i),s}}W.PBRMATERIAL_OPAQUE=G.PBRMATERIAL_OPAQUE,W.PBRMATERIAL_ALPHATEST=G.PBRMATERIAL_ALPHATEST,W.PBRMATERIAL_ALPHABLEND=G.PBRMATERIAL_ALPHABLEND,W.PBRMATERIAL_ALPHATESTANDBLEND=G.PBRMATERIAL_ALPHATESTANDBLEND,W.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=G.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"directIntensity",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"emissiveIntensity",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"environmentIntensity",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"specularIntensity",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"disableBumpMap",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"albedoTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"baseWeightTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"ambientTexture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"ambientTextureStrength",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],W.prototype,"opacityTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"reflectionTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"emissiveTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"reflectivityTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"metallicTexture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"metallic",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"roughness",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"metallicF0Factor",void 0),(0,s.Cg)([(0,r.jT)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"metallicReflectanceColor",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"metallicReflectanceTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"reflectanceTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"microSurfaceTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"bumpTexture",void 0),(0,s.Cg)([(0,r.uM)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty",null)],W.prototype,"lightmapTexture",void 0),(0,s.Cg)([(0,r.jT)("ambient"),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"ambientColor",void 0),(0,s.Cg)([(0,r.jT)("albedo"),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"albedoColor",void 0),(0,s.Cg)([(0,r.lK)("baseWeight"),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"baseWeight",void 0),(0,s.Cg)([(0,r.jT)("reflectivity"),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"reflectivityColor",void 0),(0,s.Cg)([(0,r.jT)("reflection"),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"reflectionColor",void 0),(0,s.Cg)([(0,r.jT)("emissive"),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"emissiveColor",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"microSurface",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useLightmapAsShadowmap",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],W.prototype,"useAlphaFromAlbedoTexture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],W.prototype,"forceAlphaTest",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],W.prototype,"alphaCutOff",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useSpecularOverAlpha",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useAmbientInGrayScale",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,s.Cg)([(0,r.lK)()],W.prototype,"usePhysicalLightFalloff",null),(0,s.Cg)([(0,r.lK)()],W.prototype,"useGLTFLightFalloff",null),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useRadianceOverAlpha",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useObjectSpaceNormalMap",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useParallax",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useParallaxOcclusion",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"parallaxScaleBias",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsLightsDirty")],W.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"forceIrradianceInFragment",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsLightsDirty")],W.prototype,"maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"invertNormalMapX",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"invertNormalMapY",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"twoSidedLighting",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useAlphaFresnel",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useLinearAlphaFresnel",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"environmentBRDFTexture",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"forceNormalForward",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"enableSpecularAntiAliasing",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useHorizonOcclusion",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useRadianceOcclusion",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsMiscDirty")],W.prototype,"unlit",void 0),(0,s.Cg)([(0,r.lK)(),(0,r.$z)("_markAllSubMeshesAsMiscDirty")],W.prototype,"applyDecalMapAfterDetailMap",void 0),(0,z.Y5)("BABYLON.PBRMaterial",W)},6523:(e,t,i)=>{"use strict";i.d(t,{B:()=>s});class s{static get ForceFullSceneLoadingForIncremental(){return s._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){s._ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return s._ShowLoadingScreen}static set ShowLoadingScreen(e){s._ShowLoadingScreen=e}static get loggingLevel(){return s._LoggingLevel}static set loggingLevel(e){s._LoggingLevel=e}static get CleanBoneMatrixWeights(){return s._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){s._CleanBoneMatrixWeights=e}}s._ForceFullSceneLoadingForIncremental=!1,s._ShowLoadingScreen=!0,s._CleanBoneMatrixWeights=!1,s._LoggingLevel=0},6618:(e,t,i)=>{"use strict";i.d(t,{X5:()=>v,eA:()=>f,nl:()=>m,rq:()=>p,s$:()=>d,vF:()=>g,y4:()=>_});var s=i(4049),r=i(451),n=i(8857),o=i(5686),a=i(1513),h=i(4292),l=i(2687),c=i(2276),u=i(979);const d=Object.freeze(new s.PT(0,0,0,0)),_=Object.freeze(s.Pq.Zero()),p=Object.freeze(s.I9.Zero()),g=Object.freeze(l.o.Zero()),f=Object.freeze(r.v9.Black()),m=Object.freeze(new r.ov(0,0,0,0)),b={key:0,repeatCount:0,loopMode:2};class v{static _PrepareAnimation(e,t,i,n,o,a,h,c){let u;if(!isNaN(parseFloat(o))&&isFinite(o)?u=v.ANIMATIONTYPE_FLOAT:o instanceof s.PT?u=v.ANIMATIONTYPE_QUATERNION:o instanceof s.Pq?u=v.ANIMATIONTYPE_VECTOR3:o instanceof s.I9?u=v.ANIMATIONTYPE_VECTOR2:o instanceof r.v9?u=v.ANIMATIONTYPE_COLOR3:o instanceof r.ov?u=v.ANIMATIONTYPE_COLOR4:o instanceof l.o&&(u=v.ANIMATIONTYPE_SIZE),null==u)return null;const d=new v(e,t,i,u,h),_=[{frame:0,value:o},{frame:n,value:a}];return d.setKeys(_),void 0!==c&&d.setEasingFunction(c),d}static CreateAnimation(e,t,i,s){const r=new v(e+"Animation",e,i,t,v.ANIMATIONLOOPMODE_CONSTANT);return r.setEasingFunction(s),r}static CreateAndStartAnimation(e,t,i,s,r,n,o,a,h,l,c){const u=v._PrepareAnimation(e,i,s,r,n,o,a,h);return u?(t.getScene&&(c=t.getScene()),c?c.beginDirectAnimation(t,[u],0,r,u.loopMode!==v.ANIMATIONLOOPMODE_CONSTANT,1,l):null):null}static CreateAndStartHierarchyAnimation(e,t,i,s,r,n,o,a,h,l,c){const u=v._PrepareAnimation(e,s,r,n,o,a,h,l);return u?t.getScene().beginDirectHierarchyAnimation(t,i,[u],0,n,1===u.loopMode,1,c):null}static CreateMergeAndStartAnimation(e,t,i,s,r,n,o,a,h,l){const c=v._PrepareAnimation(e,i,s,r,n,o,a,h);return c?(t.animations.push(c),t.getScene().beginAnimation(t,0,r,1===c.loopMode,1,l)):null}static MakeAnimationAdditive(e,t,i,r=!1,n){let o;o="object"==typeof t?t:{referenceFrame:t??0,range:i,cloneOriginalAnimation:r,clonedAnimationName:n};let a=e;if(o.cloneOriginalAnimation&&(a=e.clone(),a.name=o.clonedAnimationName||a.name),!a._keys.length)return a;const h=o.referenceFrame&&o.referenceFrame>=0?o.referenceFrame:0;let l=0;const c=a._keys[0];let u=a._keys.length-1;const d=a._keys[u],_={referenceValue:c.value,referencePosition:s.AA.Vector3[0],referenceQuaternion:s.AA.Quaternion[0],referenceScaling:s.AA.Vector3[1],keyPosition:s.AA.Vector3[2],keyQuaternion:s.AA.Quaternion[1],keyScaling:s.AA.Vector3[3]};let p=c.frame,g=d.frame;if(o.range){const e=a.getRange(o.range);e&&(p=e.from,g=e.to)}else p=o.fromFrame??p,g=o.toFrame??g;if(p!==c.frame&&(l=a.createKeyForFrame(p)),g!==d.frame&&(u=a.createKeyForFrame(g)),1===a._keys.length){const e=a._getKeyValue(a._keys[0]);_.referenceValue=e.clone?e.clone():e}else if(h<=c.frame){const e=a._getKeyValue(c.value);_.referenceValue=e.clone?e.clone():e}else if(h>=d.frame){const e=a._getKeyValue(d.value);_.referenceValue=e.clone?e.clone():e}else{b.key=0;const e=a._interpolate(h,b);_.referenceValue=e.clone?e.clone():e}a.dataType===v.ANIMATIONTYPE_QUATERNION?_.referenceValue.normalize().conjugateInPlace():a.dataType===v.ANIMATIONTYPE_MATRIX&&(_.referenceValue.decompose(_.referenceScaling,_.referenceQuaternion,_.referencePosition),_.referenceQuaternion.normalize().conjugateInPlace());let f=Number.MAX_VALUE;const m=o.clipKeys?[]:null;for(let e=l;e<=u;e++){let t=a._keys[e];if((m||o.cloneOriginalAnimation)&&(t={frame:t.frame,value:t.value.clone?t.value.clone():t.value,inTangent:t.inTangent,outTangent:t.outTangent,interpolation:t.interpolation,lockedTangent:t.lockedTangent},m&&(f===Number.MAX_VALUE&&(f=t.frame),t.frame-=f,m.push(t))),!e||a.dataType===v.ANIMATIONTYPE_FLOAT||t.value!==c.value)switch(a.dataType){case v.ANIMATIONTYPE_MATRIX:t.value.decompose(_.keyScaling,_.keyQuaternion,_.keyPosition),_.keyPosition.subtractInPlace(_.referencePosition),_.keyScaling.divideInPlace(_.referenceScaling),_.referenceQuaternion.multiplyToRef(_.keyQuaternion,_.keyQuaternion),s.uq.ComposeToRef(_.keyScaling,_.keyQuaternion,_.keyPosition,t.value);break;case v.ANIMATIONTYPE_QUATERNION:_.referenceValue.multiplyToRef(t.value,t.value);break;case v.ANIMATIONTYPE_VECTOR2:case v.ANIMATIONTYPE_VECTOR3:case v.ANIMATIONTYPE_COLOR3:case v.ANIMATIONTYPE_COLOR4:t.value.subtractToRef(_.referenceValue,t.value);break;case v.ANIMATIONTYPE_SIZE:t.value.width-=_.referenceValue.width,t.value.height-=_.referenceValue.height;break;default:t.value-=_.referenceValue}}return m&&a.setKeys(m,!0),a}static TransitionTo(e,t,i,s,r,n,o,a=null){if(o<=0)return i[e]=t,a&&a(),null;const h=r*(o/1e3);n.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:h,value:t}]),i.animations||(i.animations=[]),i.animations.push(n);const l=s.beginAnimation(i,0,h,!1);return l.onAnimationEnd=a,l}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const e of this._runtimeAnimations)if(!e.isStopped())return!0;return!1}constructor(e,t,i,s,r,n){this.name=e,this.targetProperty=t,this.framePerSecond=i,this.dataType=s,this.loopMode=r,this.enableBlending=n,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=s,this.loopMode=void 0===r?v.ANIMATIONLOOPMODE_CYCLE:r,this.uniqueId=v._UniqueIdGenerator++}toString(e){let t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";let e=!0;for(const i in this._ranges)e&&(t+=", ",e=!1),t+=i;t+="}"}return t}addEvent(e){this._events.push(e),this._events.sort(((e,t)=>e.frame-t.frame))}removeEvents(e){for(let t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)}getEvents(){return this._events}createRange(e,t,i){this._ranges[e]||(this._ranges[e]=new a.K(e,t,i))}deleteRange(e,t=!0){const i=this._ranges[e];if(i){if(t){const e=i.from,t=i.to;for(let i=this._keys.length-1;i>=0;i--)this._keys[i].frame>=e&&this._keys[i].frame<=t&&this._keys.splice(i,1)}this._ranges[e]=null}}getRange(e){return this._ranges[e]}getKeys(){return this._keys}getHighestFrame(){let e=0;for(let t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e}getEasingFunction(){return this._easingFunction}setEasingFunction(e){this._easingFunction=e}floatInterpolateFunction(e,t,i){return(0,n.Lerp)(e,t,i)}floatInterpolateFunctionWithTangents(e,t,i,s,r){return(0,n.Hermite)(e,t,i,s,r)}quaternionInterpolateFunction(e,t,i){return s.PT.Slerp(e,t,i)}quaternionInterpolateFunctionWithTangents(e,t,i,r,n){return s.PT.Hermite(e,t,i,r,n).normalize()}vector3InterpolateFunction(e,t,i){return s.Pq.Lerp(e,t,i)}vector3InterpolateFunctionWithTangents(e,t,i,r,n){return s.Pq.Hermite(e,t,i,r,n)}vector2InterpolateFunction(e,t,i){return s.I9.Lerp(e,t,i)}vector2InterpolateFunctionWithTangents(e,t,i,r,n){return s.I9.Hermite(e,t,i,r,n)}sizeInterpolateFunction(e,t,i){return l.o.Lerp(e,t,i)}color3InterpolateFunction(e,t,i){return r.v9.Lerp(e,t,i)}color3InterpolateFunctionWithTangents(e,t,i,s,n){return r.v9.Hermite(e,t,i,s,n)}color4InterpolateFunction(e,t,i){return r.ov.Lerp(e,t,i)}color4InterpolateFunctionWithTangents(e,t,i,s,n){return r.ov.Hermite(e,t,i,s,n)}_getKeyValue(e){return"function"==typeof e?e():e}evaluate(e){return b.key=0,this._interpolate(e,b)}_interpolate(e,t,i=!1){if(t.loopMode===v.ANIMATIONLOOPMODE_CONSTANT&&t.repeatCount>0)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;const s=this._keys,r=s.length;let n=t.key;for(;n>=0&&e<s[n].frame;)--n;for(;n+1<=r-1&&e>=s[n+1].frame;)++n;if(t.key=n,n<0)return i?void 0:this._getKeyValue(s[0].value);if(n+1>r-1)return i?void 0:this._getKeyValue(s[r-1].value);const o=s[n],a=s[n+1];if(i&&(e===o.frame||e===a.frame))return;const h=this._getKeyValue(o.value),l=this._getKeyValue(a.value);if(1===o.interpolation)return a.frame>e?h:l;const c=void 0!==o.outTangent&&void 0!==a.inTangent,u=a.frame-o.frame;let b=(e-o.frame)/u;const T=o.easingFunction||this.getEasingFunction();switch(null!==T&&(b=T.ease(b)),this.dataType){case v.ANIMATIONTYPE_FLOAT:{const e=c?this.floatInterpolateFunctionWithTangents(h,o.outTangent*u,l,a.inTangent*u,b):this.floatInterpolateFunction(h,l,b);switch(t.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return e;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(t.offsetValue??0)*t.repeatCount+e}break}case v.ANIMATIONTYPE_QUATERNION:{const e=c?this.quaternionInterpolateFunctionWithTangents(h,o.outTangent.scale(u),l,a.inTangent.scale(u),b):this.quaternionInterpolateFunction(h,l,b);switch(t.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return e;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.addInPlace((t.offsetValue||d).scale(t.repeatCount))}return e}case v.ANIMATIONTYPE_VECTOR3:{const e=c?this.vector3InterpolateFunctionWithTangents(h,o.outTangent.scale(u),l,a.inTangent.scale(u),b):this.vector3InterpolateFunction(h,l,b);switch(t.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return e;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.add((t.offsetValue||_).scale(t.repeatCount))}break}case v.ANIMATIONTYPE_VECTOR2:{const e=c?this.vector2InterpolateFunctionWithTangents(h,o.outTangent.scale(u),l,a.inTangent.scale(u),b):this.vector2InterpolateFunction(h,l,b);switch(t.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return e;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.add((t.offsetValue||p).scale(t.repeatCount))}break}case v.ANIMATIONTYPE_SIZE:switch(t.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(h,l,b);case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(h,l,b).add((t.offsetValue||g).scale(t.repeatCount))}break;case v.ANIMATIONTYPE_COLOR3:{const e=c?this.color3InterpolateFunctionWithTangents(h,o.outTangent.scale(u),l,a.inTangent.scale(u),b):this.color3InterpolateFunction(h,l,b);switch(t.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return e;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.add((t.offsetValue||f).scale(t.repeatCount))}break}case v.ANIMATIONTYPE_COLOR4:{const e=c?this.color4InterpolateFunctionWithTangents(h,o.outTangent.scale(u),l,a.inTangent.scale(u),b):this.color4InterpolateFunction(h,l,b);switch(t.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return e;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return e.add((t.offsetValue||m).scale(t.repeatCount))}break}case v.ANIMATIONTYPE_MATRIX:switch(t.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return v.AllowMatricesInterpolation?this.matrixInterpolateFunction(h,l,b,t.workValue):h;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return h}}return 0}matrixInterpolateFunction(e,t,i,r){return v.AllowMatrixDecomposeForInterpolation?r?(s.uq.DecomposeLerpToRef(e,t,i,r),r):s.uq.DecomposeLerp(e,t,i):r?(s.uq.LerpToRef(e,t,i,r),r):s.uq.Lerp(e,t,i)}clone(){const e=new v(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(const t in this._ranges){const i=this._ranges[t];i&&(e._ranges[t]=i.clone())}}return e}setKeys(e,t=!1){this._keys=t?e:e.slice(0)}createKeyForFrame(e){b.key=0;const t=this._interpolate(e,b,!0);if(!t)return this._keys[b.key].frame===e?b.key:b.key+1;const i={frame:e,value:t.clone?t.clone():t};return this._keys.splice(b.key+1,0,i),b.key+1}serialize(){const e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;const t=this.dataType;e.keys=[];const i=this.getKeys();for(let s=0;s<i.length;s++){const r=i[s],n={};switch(n.frame=r.frame,t){case v.ANIMATIONTYPE_FLOAT:n.values=[r.value],void 0!==r.inTangent&&n.values.push(r.inTangent),void 0!==r.outTangent&&(void 0===r.inTangent&&n.values.push(void 0),n.values.push(r.outTangent)),void 0!==r.interpolation&&(void 0===r.inTangent&&n.values.push(void 0),void 0===r.outTangent&&n.values.push(void 0),n.values.push(r.interpolation));break;case v.ANIMATIONTYPE_QUATERNION:case v.ANIMATIONTYPE_MATRIX:case v.ANIMATIONTYPE_VECTOR3:case v.ANIMATIONTYPE_COLOR3:case v.ANIMATIONTYPE_COLOR4:n.values=r.value.asArray(),null!=r.inTangent&&n.values.push(r.inTangent.asArray()),null!=r.outTangent&&(void 0===r.inTangent&&n.values.push(void 0),n.values.push(r.outTangent.asArray())),void 0!==r.interpolation&&(void 0===r.inTangent&&n.values.push(void 0),void 0===r.outTangent&&n.values.push(void 0),n.values.push(r.interpolation))}e.keys.push(n)}e.ranges=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const s={};s.name=t,s.from=i.from,s.to=i.to,e.ranges.push(s)}return e}static _UniversalLerp(e,t,i){const s=e.constructor;return s.Lerp?s.Lerp(e,t,i):s.Slerp?s.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t}static Parse(e){const t=new v(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),i=e.dataType,n=[];let o,a;for(e.enableBlending&&(t.enableBlending=e.enableBlending),e.blendingSpeed&&(t.blendingSpeed=e.blendingSpeed),a=0;a<e.keys.length;a++){const t=e.keys[a];let h,l,c;switch(i){case v.ANIMATIONTYPE_FLOAT:o=t.values[0],t.values.length>=2&&(h=t.values[1]),t.values.length>=3&&(l=t.values[2]),t.values.length>=4&&(c=t.values[3]);break;case v.ANIMATIONTYPE_QUATERNION:if(o=s.PT.FromArray(t.values),t.values.length>=8){const e=s.PT.FromArray(t.values.slice(4,8));e.equals(s.PT.Zero())||(h=e)}if(t.values.length>=12){const e=s.PT.FromArray(t.values.slice(8,12));e.equals(s.PT.Zero())||(l=e)}t.values.length>=13&&(c=t.values[12]);break;case v.ANIMATIONTYPE_MATRIX:o=s.uq.FromArray(t.values),t.values.length>=17&&(c=t.values[16]);break;case v.ANIMATIONTYPE_COLOR3:o=r.v9.FromArray(t.values),t.values[3]&&(h=r.v9.FromArray(t.values[3])),t.values[4]&&(l=r.v9.FromArray(t.values[4])),t.values[5]&&(c=t.values[5]);break;case v.ANIMATIONTYPE_COLOR4:o=r.ov.FromArray(t.values),t.values[4]&&(h=r.ov.FromArray(t.values[4])),t.values[5]&&(l=r.ov.FromArray(t.values[5])),t.values[6]&&(c=r.ov.FromArray(t.values[6]));break;case v.ANIMATIONTYPE_VECTOR3:default:o=s.Pq.FromArray(t.values),t.values[3]&&(h=s.Pq.FromArray(t.values[3])),t.values[4]&&(l=s.Pq.FromArray(t.values[4])),t.values[5]&&(c=t.values[5])}const u={};u.frame=t.frame,u.value=o,null!=h&&(u.inTangent=h),null!=l&&(u.outTangent=l),null!=c&&(u.interpolation=c),n.push(u)}if(t.setKeys(n),e.ranges)for(a=0;a<e.ranges.length;a++)o=e.ranges[a],t.createRange(o.name,o.from,o.to);return t}static AppendSerializedAnimations(e,t){u.p.AppendSerializedAnimations(e,t)}static ParseFromFileAsync(e,t){return new Promise(((i,s)=>{const r=new c.u;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){let t=JSON.parse(r.responseText);if(t.animations&&(t=t.animations),t.length){const e=[];for(const i of t)e.push(this.Parse(i));i(e)}else{const s=this.Parse(t);e&&(s.name=e),i(s)}}else s("Unable to load the animation")})),r.open("GET",t),r.send()}))}static ParseFromSnippetAsync(e){return new Promise(((t,i)=>{const s=new c.u;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const i=JSON.parse(JSON.parse(s.responseText).jsonPayload);if(i.animations){const s=JSON.parse(i.animations),r=[];for(const t of s.animations){const i=this.Parse(t);i.snippetId=e,r.push(i)}t(r)}else{const s=JSON.parse(i.animation),r=this.Parse(s);r.snippetId=e,t(r)}}else i("Unable to load the snippet "+e)})),s.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),s.send()}))}}v._UniqueIdGenerator=0,v.AllowMatricesInterpolation=!1,v.AllowMatrixDecomposeForInterpolation=!0,v.SnippetUrl="https://snippet.babylonjs.com",v.ANIMATIONTYPE_FLOAT=0,v.ANIMATIONTYPE_VECTOR3=1,v.ANIMATIONTYPE_QUATERNION=2,v.ANIMATIONTYPE_MATRIX=3,v.ANIMATIONTYPE_COLOR3=4,v.ANIMATIONTYPE_COLOR4=7,v.ANIMATIONTYPE_VECTOR2=5,v.ANIMATIONTYPE_SIZE=6,v.ANIMATIONLOOPMODE_RELATIVE=0,v.ANIMATIONLOOPMODE_CYCLE=1,v.ANIMATIONLOOPMODE_CONSTANT=2,v.ANIMATIONLOOPMODE_YOYO=4,v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,v.CreateFromSnippetAsync=v.ParseFromSnippetAsync,(0,o.Y5)("BABYLON.Animation",v),h.b._AnimationRangeFactory=(e,t,i)=>new a.K(e,t,i)},6632:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var s=i(4754),r=i(4537),n=i(4049),o=i(4292),a=i(9838),h=i(470),l=i(5686);o.b.AddNodeConstructor("Light_Type_1",((e,t)=>()=>new c(e,n.Pq.Zero(),t)));class c extends h.p{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(e){this._orthoLeft=e}get orthoRight(){return this._orthoRight}set orthoRight(e){this._orthoRight=e}get orthoTop(){return this._orthoTop}set orthoTop(e){this._orthoTop=e}get orthoBottom(){return this._orthoBottom}set orthoBottom(e){this._orthoBottom=e}constructor(e,t,i){super(e,i),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=t.scale(-1),this.direction=t}getClassName(){return"DirectionalLight"}getTypeID(){return a.v.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(e,t,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,i)}_setDefaultFixedFrustumShadowProjectionMatrix(e){const t=this.getScene().activeCamera;t&&n.uq.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,e,this.getScene().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(e,t,i){const s=this.getScene().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const e=n.Pq.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let s=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let o=0;o<i.length;o++){const a=i[o];if(!a)continue;const h=a.getBoundingInfo().boundingBox;for(let i=0;i<h.vectorsWorld.length;i++)n.Pq.TransformCoordinatesToRef(h.vectorsWorld[i],t,e),e.x<this._orthoLeft&&(this._orthoLeft=e.x),e.y<this._orthoBottom&&(this._orthoBottom=e.y),e.x>this._orthoRight&&(this._orthoRight=e.x),e.y>this._orthoTop&&(this._orthoTop=e.y),this.autoCalcShadowZBounds&&(e.z<s&&(s=e.z),e.z>r&&(r=e.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=s,this._shadowMaxZ=r)}const r=this._orthoRight-this._orthoLeft,o=this._orthoTop-this._orthoBottom,a=void 0!==this.shadowMinZ?this.shadowMinZ:s?.minZ||0,h=void 0!==this.shadowMaxZ?this.shadowMaxZ:s?.maxZ||1e4,l=this.getScene().getEngine().useReverseDepthBuffer;n.uq.OrthoOffCenterLHToRef(this._orthoLeft-r*this.shadowOrthoScale,this._orthoRight+r*this.shadowOrthoScale,this._orthoBottom-o*this.shadowOrthoScale,this._orthoTop+o*this.shadowOrthoScale,l?h:a,l?a:h,e,this.getScene().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)}transferToNodeMaterialEffect(e,t){return this.computeTransformedInformation()?(e.setFloat3(t,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(t,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(e){const t=this._scene.getEngine();return!t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}getDepthMaxZ(e){const t=this._scene.getEngine();return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}prepareLightSpecificDefines(e,t){e["DIRLIGHT"+t]=!0}}(0,s.Cg)([(0,r.lK)()],c.prototype,"shadowFrustumSize",null),(0,s.Cg)([(0,r.lK)()],c.prototype,"shadowOrthoScale",null),(0,s.Cg)([(0,r.lK)()],c.prototype,"autoUpdateExtends",void 0),(0,s.Cg)([(0,r.lK)()],c.prototype,"autoCalcShadowZBounds",void 0),(0,s.Cg)([(0,r.lK)("orthoLeft")],c.prototype,"_orthoLeft",void 0),(0,s.Cg)([(0,r.lK)("orthoRight")],c.prototype,"_orthoRight",void 0),(0,s.Cg)([(0,r.lK)("orthoTop")],c.prototype,"_orthoTop",void 0),(0,s.Cg)([(0,r.lK)("orthoBottom")],c.prototype,"_orthoBottom",void 0),(0,l.Y5)("BABYLON.DirectionalLight",c)},6661:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.bonesDeclaration="#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;attribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;attribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform highp sampler2D boneSampler;uniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{float offset=index *4.0;float dx=1.0/boneTextureWidth;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));return mat4(m0,m1,m2,m3);}\n#endif\n#endif\n#endif\n"},6678:e=>{"use strict";e.exports=Function.prototype.apply},6679:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});var s=i(4982);class r extends s.n{constructor(e){super(),this._buffer=e}get underlyingResource(){return this._buffer}}},6706:(e,t,i)=>{"use strict";i.d(t,{B:()=>n,K:()=>o});const s={},r={};function n(e){const t=e.getClassName();return r[t]||(r[t]={}),r[t]}function o(e){const t=e.getClassName();if(s[t])return s[t];s[t]={};const i=s[t];let n=e,o=t;for(;o;){const e=r[o];for(const t in e)i[t]=e[t];let t,s=!1;do{if(t=Object.getPrototypeOf(n),!t.getClassName){s=!0;break}if(t.getClassName()!==o)break;n=t}while(t);if(s)break;o=t.getClassName(),n=t}return i}},6758:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var s=i(4049),r=i(3039),n=i(9039),o=i(9176),a=i(1651),h=i(2282),l=i(766),c=i(9732),u=i(5686);o.e._instancedMeshFactory=(e,t)=>{const i=new d(e,t);if(t.instancedBuffers){i.instancedBuffers={};for(const e in t.instancedBuffers)i.instancedBuffers[e]=t.instancedBuffers[e]}return i};class d extends n.u{constructor(e,t){super(e,t.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,t.addInstance(this),this._sourceMesh=t,this._unIndexed=t._unIndexed,this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.animations=t.animations.slice();for(const e of t.getAnimationRanges())null!=e&&this.createAnimationRange(e.name,e.from,e.to);this.infiniteDistance=t.infiniteDistance,this.setPivotMatrix(t.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(e){this._sourceMesh?.receiveShadows!==e&&c.S0.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(e){this._sourceMesh?.material!==e&&c.S0.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(e){this._sourceMesh?.visibility!==e&&c.S0.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(e){this._sourceMesh?.skeleton!==e&&c.S0.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&r.V.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(e){return this._sourceMesh.createInstance(e)}isReady(e=!1){return this._sourceMesh.isReady(e,!0)}getVerticesData(e,t,i){return this._sourceMesh.getVerticesData(e,t,i)}copyVerticesData(e,t){this._sourceMesh.copyVerticesData(e,t)}setVerticesData(e,t,i,s){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,s),this.sourceMesh}updateVerticesData(e,t,i,s){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,s),this.sourceMesh}setIndices(e,t=null){return this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh}isVerticesDataPresent(e){return this._sourceMesh.isVerticesDataPresent(e)}getIndices(){return this._sourceMesh.getIndices()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let i;i="object"==typeof e?e:{applySkeleton:e,applyMorph:t};const s=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getData(i,null,l.R.PositionKind),s),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(e,t){if(super._activate(e,t),this._sourceMesh.subMeshes||r.V.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==h.V.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new s.uq);const e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,s.AA.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(s.AA.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(e){if(!e)return this;const t=this.sourceMesh.getLODLevels();if(t&&0!==t.length){const t=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(e){return this.sourceMesh._preActivateForIntermediateRendering(e)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(e,t=null,i,s){const r=(s||this._sourceMesh).createInstance(e);if(a.r.DeepCopy(this,r,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!i)for(let e=0;e<this.getScene().meshes.length;e++){const t=this.getScene().meshes[e];t.parent===this&&t.clone(t.name,r)}return r.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(r),r}dispose(e,t=!1){this._sourceMesh.removeInstance(this),super.dispose(e,t)}_serializeAsParent(e){super._serializeAsParent(e),e.parentId=this._sourceMesh.uniqueId,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(e=null,t,i){const s=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);s&&i&&i(this,s);for(const e of this.getChildTransformNodes(!0))e.instantiateHierarchy(s,t,i);return s}}o.e.prototype.registerInstancedBuffer=function(e,t){if(this._userInstancedBuffersStorage?.vertexBuffers[e]?.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const e of this.instances)e.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new l.R(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0);for(const t of this.instances)t.instancedBuffers[e]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},o.e.prototype._processInstancedBuffers=function(e,t){const i=e?e.length:0;for(const s in this.instancedBuffers){let r=this._userInstancedBuffersStorage.sizes[s];const n=this._userInstancedBuffersStorage.strides[s],o=(i+1)*n;for(;r<o;)r*=2;this._userInstancedBuffersStorage.data[s].length!=r&&(this._userInstancedBuffersStorage.data[s]=new Float32Array(r),this._userInstancedBuffersStorage.sizes[s]=r,this._userInstancedBuffersStorage.vertexBuffers[s]&&(this._userInstancedBuffersStorage.vertexBuffers[s].dispose(),this._userInstancedBuffersStorage.vertexBuffers[s]=null));const a=this._userInstancedBuffersStorage.data[s];let h=0;if(t){const e=this.instancedBuffers[s];e.toArray?e.toArray(a,h):e.copyToArray?e.copyToArray(a,h):a[h]=e,h+=n}for(let t=0;t<i;t++){const i=e[t].instancedBuffers[s];i.toArray?i.toArray(a,h):i.copyToArray?i.copyToArray(a,h):a[h]=i,h+=n}this._userInstancedBuffersStorage.vertexBuffers[s]?this._userInstancedBuffersStorage.vertexBuffers[s].updateDirectly(a,0):(this._userInstancedBuffersStorage.vertexBuffers[s]=new l.R(this.getEngine(),this._userInstancedBuffersStorage.data[s],s,!0,!1,n,!0),this._invalidateInstanceVertexArrayObject())}},o.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},o.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,u.Y5)("BABYLON.InstancedMesh",d)},6791:(e,t,i)=>{"use strict";i.r(t),i.d(t,{depthVertexShader:()=>o});var s=i(4796);i(6661),i(4513),i(2165),i(9676),i(5990),i(3240);s.l.IncludesShadersStore.pointCloudVertexDeclaration="#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",i(6013),i(6042),i(9020),i(5879),i(321),i(1328),i(9877);const r="depthVertexShader",n="attribute vec3 position;\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform mat4 viewProjection;uniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;uniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#ifdef STORE_CAMERASPACE_Z\nuniform mat4 view;varying vec4 vViewPos;\n#endif\n#include<pointCloudVertexDeclaration>\nvarying float vDepthMetric;\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{vec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#ifdef UV2\nvec2 uv2Updated=uv2;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#include<clipPlaneVertex>\ngl_Position=viewProjection*worldPos;\n#ifdef STORE_CAMERASPACE_Z\nvViewPos=view*worldPos;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric=((-gl_Position.z+depthValues.x)/(depthValues.y));\n#else\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#endif\n#endif\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2Updated,1.0,0.0));\n#endif\n#endif\n#include<pointCloudVertex>\n}\n";s.l.ShadersStore[r]=n;const o={name:r,shader:n}},6863:(e,t,i)=>{"use strict";i.d(t,{F:()=>S});var s=i(4754),r=i(4537),n=i(1425),o=i(8836),a=i(451),h=i(766),l=i(2793),c=i(3550),u=i(4564),d=i(2596),_=i(7638),p=i(35),g=i(5686),f=i(879),m=i(5923),b=i(3564),v=i(8042),T=i(5241),y=i(979),x=i(8884);const A={effect:null,subMesh:null};class C extends d.M{constructor(e){super(e),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(e){const t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const i of t)this[i]=i===e}}class S extends _.E{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}get canRenderToMRT(){return!0}constructor(e,t,i=!1){super(e,t,void 0,i||S.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new a.v9(0,0,0),this.diffuseColor=new a.v9(1,1,1),this.specularColor=new a.v9(1,1,1),this.emissiveColor=new a.v9(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new n.L(16),this._globalAmbientColor=new a.v9(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new b.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new l.J,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),S.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),S.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(S.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(S.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}getClassName(){return"StandardMaterial"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===u.i.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==u.i.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(e,t,s=!1){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const r=t._drawWrapper;if(r.effect&&this.isFrozen&&r._wasPreviouslyReady&&r._wasPreviouslyUsingInstances===s)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new C(this._eventInfo.defineNames));const n=this.getScene(),o=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const a=n.getEngine();o._needNormals=(0,T.az)(n,e,o,!0,this._maxSimultaneousLights,this._disableLighting),(0,T.VO)(n,o);const u=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if((0,T.N4)(n,o,this.canRenderToMRT&&!u),(0,T.Nc)(n,o,u),x.m.PrepareDefines(a.currentRenderPassId,e,o),o._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,o._needUVs=!1;for(let e=1;e<=6;++e)o["MAINUV"+e]=!1;if(n.texturesEnabled){if(o.DIFFUSEDIRECTUV=0,o.BUMPDIRECTUV=0,o.AMBIENTDIRECTUV=0,o.OPACITYDIRECTUV=0,o.EMISSIVEDIRECTUV=0,o.SPECULARDIRECTUV=0,o.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&S.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,T.YT)(this._diffuseTexture,o,"DIFFUSE")}else o.DIFFUSE=!1;if(this._ambientTexture&&S.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,T.YT)(this._ambientTexture,o,"AMBIENT")}else o.AMBIENT=!1;if(this._opacityTexture&&S.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,T.YT)(this._opacityTexture,o,"OPACITY"),o.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else o.OPACITY=!1;if(this._reflectionTexture&&S.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(o._needNormals=!0,o.REFLECTION=!0,o.ROUGHNESS=this._roughness>0,o.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,o.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===p.g.INVCUBIC_MODE,o.REFLECTIONMAP_3D=this._reflectionTexture.isCube,o.REFLECTIONMAP_OPPOSITEZ=o.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,o.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case p.g.EXPLICIT_MODE:o.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case p.g.PLANAR_MODE:o.setReflectionMode("REFLECTIONMAP_PLANAR");break;case p.g.PROJECTION_MODE:o.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case p.g.SKYBOX_MODE:o.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case p.g.SPHERICAL_MODE:o.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case p.g.EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case p.g.FIXED_EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case p.g.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:o.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case p.g.CUBIC_MODE:case p.g.INVCUBIC_MODE:default:o.setReflectionMode("REFLECTIONMAP_CUBIC")}o.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else o.REFLECTION=!1,o.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&S.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,T.YT)(this._emissiveTexture,o,"EMISSIVE")}else o.EMISSIVE=!1;if(this._lightmapTexture&&S.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,T.YT)(this._lightmapTexture,o,"LIGHTMAP"),o.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,o.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else o.LIGHTMAP=!1;if(this._specularTexture&&S.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,T.YT)(this._specularTexture,o,"SPECULAR"),o.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else o.SPECULAR=!1;if(n.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&S.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,T.YT)(this._bumpTexture,o,"BUMP"),o.PARALLAX=this._useParallax,o.PARALLAX_RHS=n.useRightHandedSystem,o.PARALLAXOCCLUSION=this._useParallaxOcclusion,o.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else o.BUMP=!1,o.PARALLAX=!1,o.PARALLAX_RHS=!1,o.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&S.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;o._needUVs=!0,o.REFRACTION=!0,o.REFRACTIONMAP_3D=this._refractionTexture.isCube,o.RGBDREFRACTION=this._refractionTexture.isRGBD,o.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else o.REFRACTION=!1;o.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else o.DIFFUSE=!1,o.AMBIENT=!1,o.OPACITY=!1,o.REFLECTION=!1,o.EMISSIVE=!1,o.LIGHTMAP=!1,o.BUMP=!1,o.REFRACTION=!1;o.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),o.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,o.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,o.SPECULAROVERALPHA=this._useSpecularOverAlpha,o.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,o.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,o.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=o,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(o._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(o),o.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,o.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(o._areFresnelDirty&&(S.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(o.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,o.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,o.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,o.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,o.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,o.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,o._needNormals=!0,o.FRESNEL=!0):o.FRESNEL=!1),o.AREALIGHTUSED)for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1;(0,T.fm)(e,n,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),o,this._applyDecalMapAfterDetailMap),(0,T.OR)(n,a,this,o,s,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=o,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,T.qB)(e,o,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let d=!1;if(o.isDirty){const s=o._areLightsDisposed;o.markAsProcessed();const r=new m.J;o.REFLECTION&&r.addFallback(0,"REFLECTION"),o.SPECULAR&&r.addFallback(0,"SPECULAR"),o.BUMP&&r.addFallback(0,"BUMP"),o.PARALLAX&&r.addFallback(1,"PARALLAX"),o.PARALLAX_RHS&&r.addFallback(1,"PARALLAX_RHS"),o.PARALLAXOCCLUSION&&r.addFallback(0,"PARALLAXOCCLUSION"),o.SPECULAROVERALPHA&&r.addFallback(0,"SPECULAROVERALPHA"),o.FOG&&r.addFallback(1,"FOG"),o.POINTSIZE&&r.addFallback(0,"POINTSIZE"),o.LOGARITHMICDEPTH&&r.addFallback(0,"LOGARITHMICDEPTH"),(0,T.c4)(o,r,this._maxSimultaneousLights),o.SPECULARTERM&&r.addFallback(0,"SPECULARTERM"),o.DIFFUSEFRESNEL&&r.addFallback(1,"DIFFUSEFRESNEL"),o.OPACITYFRESNEL&&r.addFallback(2,"OPACITYFRESNEL"),o.REFLECTIONFRESNEL&&r.addFallback(3,"REFLECTIONFRESNEL"),o.EMISSIVEFRESNEL&&r.addFallback(4,"EMISSIVEFRESNEL"),o.FRESNEL&&r.addFallback(4,"FRESNEL"),o.MULTIVIEW&&r.addFallback(0,"MULTIVIEW");const u=[h.R.PositionKind];o.NORMAL&&u.push(h.R.NormalKind),o.TANGENT&&u.push(h.R.TangentKind);for(let e=1;e<=6;++e)o["UV"+e]&&u.push(`uv${1===e?"":e}`);o.VERTEXCOLOR&&u.push(h.R.ColorKind),(0,T.ni)(u,e,o,r),(0,T.ER)(u,o),(0,T.IF)(u,e,o),(0,T.J2)(u,e,o);let _="default";const p=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],g=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],f=["Material","Scene","Mesh"],b={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:o.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=r,this._eventInfo.fallbackRank=0,this._eventInfo.defines=o,this._eventInfo.uniforms=p,this._eventInfo.attributes=u,this._eventInfo.samplers=g,this._eventInfo.uniformBuffersNames=f,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=b,this._callbackPluginEventGeneric(128,this._eventInfo),x.m.AddUniformsAndSamplers(p,g),l.J.AddUniforms(p),l.J.AddSamplers(g),c.p&&(c.p.PrepareUniforms(p,o),c.p.PrepareSamplers(g,o)),(0,T.Bb)({uniformsNames:p,uniformBuffersNames:f,samplers:g,defines:o,maxSimultaneousLights:this._maxSimultaneousLights}),(0,v.TV)(p);const y={};this.customShaderNameResolve&&(_=this.customShaderNameResolve(_,p,f,g,o,u,y));const C=o.toString(),S=t.effect;let E=n.getEngine().createEffect(_,{attributes:u,uniformsNames:p,uniformBuffersNames:f,samplers:g,defines:C,fallbacks:r,onCompiled:this.onCompiled,onError:this.onError,indexParameters:b,processFinalCode:y.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:o.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([i.e(8699),i.e(2481)]).then(i.bind(i,2481)),Promise.all([i.e(9676),i.e(3921)]).then(i.bind(i,3921))]):await Promise.all([i.e(6482).then(i.bind(i,6482)),Promise.all([i.e(2988),i.e(9148)]).then(i.bind(i,9148))]),this._shadersLoaded=!0}},a);if(this._eventInfo.customCode=void 0,E)if(this._onEffectCreatedObservable&&(A.effect=E,A.subMesh=t,this._onEffectCreatedObservable.notifyObservers(A)),this.allowShaderHotSwapping&&S&&!E.isReady()){if(E=S,o.markAsUnprocessed(),d=this.isFrozen,s)return o._areLightsDisposed=!0,!1}else n.resetCachedMaterial(),t.setEffect(E,o,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(o._renderId=n.getRenderId(),r._wasPreviouslyReady=!d,r._wasPreviouslyUsingInstances=s,this._checkScenePerformancePriority(),0))}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(e,t,i){const s=this.getScene(),r=i.materialDefines;if(!r)return;const n=i.effect;if(!n)return;this._activeEffect=n,t.getMeshUniformBuffer().bindToEffect(n,"Mesh"),t.transferToEffect(e),this._uniformBuffer.bindToEffect(n,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,s,t,e,this.isFrozen),x.m.Bind(s.getEngine().currentRenderPassId,this._activeEffect,t,e),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),r.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const h=this._mustRebind(s,n,i,t.visibility);(0,T.f$)(t,n);const l=this._uniformBuffer;if(h){if(this.bindViewProjection(n),!l.useUbo||!this.isFrozen||!l.isSync||i._drawWrapper._forceRebindOnNextCall){if(S.FresnelEnabled&&r.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(l.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),l.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&l.updateColor4("opacityParts",new a.v9(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(l.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),l.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(l.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),l.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(l.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),l.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),s.texturesEnabled){if(this._diffuseTexture&&S.DiffuseTextureEnabled&&(l.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,T.mA)(this._diffuseTexture,l,"diffuse")),this._ambientTexture&&S.AmbientTextureEnabled&&(l.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,T.mA)(this._ambientTexture,l,"ambient")),this._opacityTexture&&S.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,T.mA)(this._opacityTexture,l,"opacity")),this._hasAlphaChannel()&&l.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&S.ReflectionTextureEnabled){if(l.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),l.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const e=this._reflectionTexture;l.updateVector3("vReflectionPosition",e.boundingBoxPosition),l.updateVector3("vReflectionSize",e.boundingBoxSize)}}else l.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&S.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,T.mA)(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&S.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,T.mA)(this._lightmapTexture,l,"lightmap")),this._specularTexture&&S.SpecularTextureEnabled&&(l.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,T.mA)(this._specularTexture,l,"specular")),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&S.BumpTextureEnabled&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,T.mA)(this._bumpTexture,l,"bump"),s._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&S.RefractionTextureEnabled){let e=1;if(this._refractionTexture.isCube||(l.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(e=this._refractionTexture.depth)),l.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,e,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const e=this._refractionTexture;l.updateVector3("vRefractionPosition",e.boundingBoxPosition),l.updateVector3("vRefractionSize",e.boundingBoxSize)}}}this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),l.updateColor4("vSpecularColor",this.specularColor,this.specularPower),l.updateColor3("vEmissiveColor",S.EmissiveTextureEnabled?this.emissiveColor:a.v9.BlackReadOnly),l.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),s.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),l.updateColor3("vAmbientColor",this._globalAmbientColor)}s.texturesEnabled&&(this._diffuseTexture&&S.DiffuseTextureEnabled&&n.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&S.AmbientTextureEnabled&&n.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&S.OpacityTextureEnabled&&n.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&S.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?n.setTexture("reflectionCubeSampler",this._reflectionTexture):n.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&S.EmissiveTextureEnabled&&n.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&S.LightmapTextureEnabled&&n.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&S.SpecularTextureEnabled&&n.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&S.BumpTextureEnabled&&n.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&S.RefractionTextureEnabled&&(this._refractionTexture.isCube?n.setTexture("refractionCubeSampler",this._refractionTexture):n.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(n),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,v.gS)(n,this,s),this.bindEyePosition(n)}else s.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!h&&this.isFrozen||(s.lightsEnabled&&!this._disableLighting&&(0,T.RL)(s,t,n,r,this._maxSimultaneousLights),(s.fogEnabled&&t.applyFog&&s.fogMode!==o.Z.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||r.PREPASS)&&this.bindView(n),(0,T.Yy)(s,t,n),r.NUM_MORPH_INFLUENCERS&&(0,T.nR)(t,n),r.BAKED_VERTEX_ANIMATION_TEXTURE&&t.bakedVertexAnimationManager?.bind(n,r.INSTANCES),this.useLogarithmicDepth&&(0,T.DL)(r,n,s),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect,i),l.update()}getAnimatables(){const e=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}getActiveTextures(){const e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}hasTexture(e){return!!super.hasTexture(e)||this._diffuseTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._specularTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this._refractionTexture===e}dispose(e,t){t&&(this._diffuseTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._specularTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._refractionTexture?.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}clone(e,t=!0,i=""){const s=y.p.Clone((()=>new S(e,this.getScene())),this,{cloneTexturesOnlyOnce:t});return s.name=e,s.id=e,this.stencil.copyTo(s.stencil),this._clonePlugins(s,i),s}static Parse(e,t,i){const s=y.p.Parse((()=>new S(e.name,t)),e,t,i);return e.stencil&&s.stencil.parse(e.stencil,t,i),u.i._ParsePlugins(e,s,t,i),s}static get DiffuseTextureEnabled(){return f.h.DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){f.h.DiffuseTextureEnabled=e}static get DetailTextureEnabled(){return f.h.DetailTextureEnabled}static set DetailTextureEnabled(e){f.h.DetailTextureEnabled=e}static get AmbientTextureEnabled(){return f.h.AmbientTextureEnabled}static set AmbientTextureEnabled(e){f.h.AmbientTextureEnabled=e}static get OpacityTextureEnabled(){return f.h.OpacityTextureEnabled}static set OpacityTextureEnabled(e){f.h.OpacityTextureEnabled=e}static get ReflectionTextureEnabled(){return f.h.ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){f.h.ReflectionTextureEnabled=e}static get EmissiveTextureEnabled(){return f.h.EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){f.h.EmissiveTextureEnabled=e}static get SpecularTextureEnabled(){return f.h.SpecularTextureEnabled}static set SpecularTextureEnabled(e){f.h.SpecularTextureEnabled=e}static get BumpTextureEnabled(){return f.h.BumpTextureEnabled}static set BumpTextureEnabled(e){f.h.BumpTextureEnabled=e}static get LightmapTextureEnabled(){return f.h.LightmapTextureEnabled}static set LightmapTextureEnabled(e){f.h.LightmapTextureEnabled=e}static get RefractionTextureEnabled(){return f.h.RefractionTextureEnabled}static set RefractionTextureEnabled(e){f.h.RefractionTextureEnabled=e}static get ColorGradingTextureEnabled(){return f.h.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){f.h.ColorGradingTextureEnabled=e}static get FresnelEnabled(){return f.h.FresnelEnabled}static set FresnelEnabled(e){f.h.FresnelEnabled=e}}S.ForceGLSL=!1,(0,s.Cg)([(0,r.uM)("diffuseTexture")],S.prototype,"_diffuseTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"diffuseTexture",void 0),(0,s.Cg)([(0,r.uM)("ambientTexture")],S.prototype,"_ambientTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTexture",void 0),(0,s.Cg)([(0,r.uM)("opacityTexture")],S.prototype,"_opacityTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"opacityTexture",void 0),(0,s.Cg)([(0,r.uM)("reflectionTexture")],S.prototype,"_reflectionTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionTexture",void 0),(0,s.Cg)([(0,r.uM)("emissiveTexture")],S.prototype,"_emissiveTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveTexture",void 0),(0,s.Cg)([(0,r.uM)("specularTexture")],S.prototype,"_specularTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"specularTexture",void 0),(0,s.Cg)([(0,r.uM)("bumpTexture")],S.prototype,"_bumpTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,s.Cg)([(0,r.uM)("lightmapTexture")],S.prototype,"_lightmapTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"lightmapTexture",void 0),(0,s.Cg)([(0,r.uM)("refractionTexture")],S.prototype,"_refractionTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"refractionTexture",void 0),(0,s.Cg)([(0,r.jT)("ambient")],S.prototype,"ambientColor",void 0),(0,s.Cg)([(0,r.jT)("diffuse")],S.prototype,"diffuseColor",void 0),(0,s.Cg)([(0,r.jT)("specular")],S.prototype,"specularColor",void 0),(0,s.Cg)([(0,r.jT)("emissive")],S.prototype,"emissiveColor",void 0),(0,s.Cg)([(0,r.lK)()],S.prototype,"specularPower",void 0),(0,s.Cg)([(0,r.lK)("useAlphaFromDiffuseTexture")],S.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"useAlphaFromDiffuseTexture",void 0),(0,s.Cg)([(0,r.lK)("useEmissiveAsIllumination")],S.prototype,"_useEmissiveAsIllumination",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useEmissiveAsIllumination",void 0),(0,s.Cg)([(0,r.lK)("linkEmissiveWithDiffuse")],S.prototype,"_linkEmissiveWithDiffuse",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"linkEmissiveWithDiffuse",void 0),(0,s.Cg)([(0,r.lK)("useSpecularOverAlpha")],S.prototype,"_useSpecularOverAlpha",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useSpecularOverAlpha",void 0),(0,s.Cg)([(0,r.lK)("useReflectionOverAlpha")],S.prototype,"_useReflectionOverAlpha",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useReflectionOverAlpha",void 0),(0,s.Cg)([(0,r.lK)("disableLighting")],S.prototype,"_disableLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],S.prototype,"disableLighting",void 0),(0,s.Cg)([(0,r.lK)("useObjectSpaceNormalMap")],S.prototype,"_useObjectSpaceNormalMap",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useObjectSpaceNormalMap",void 0),(0,s.Cg)([(0,r.lK)("useParallax")],S.prototype,"_useParallax",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallax",void 0),(0,s.Cg)([(0,r.lK)("useParallaxOcclusion")],S.prototype,"_useParallaxOcclusion",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallaxOcclusion",void 0),(0,s.Cg)([(0,r.lK)()],S.prototype,"parallaxScaleBias",void 0),(0,s.Cg)([(0,r.lK)("roughness")],S.prototype,"_roughness",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"roughness",void 0),(0,s.Cg)([(0,r.lK)()],S.prototype,"indexOfRefraction",void 0),(0,s.Cg)([(0,r.lK)()],S.prototype,"invertRefractionY",void 0),(0,s.Cg)([(0,r.lK)()],S.prototype,"alphaCutOff",void 0),(0,s.Cg)([(0,r.lK)("useLightmapAsShadowmap")],S.prototype,"_useLightmapAsShadowmap",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLightmapAsShadowmap",void 0),(0,s.Cg)([(0,r.Y9)("diffuseFresnelParameters")],S.prototype,"_diffuseFresnelParameters",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"diffuseFresnelParameters",void 0),(0,s.Cg)([(0,r.Y9)("opacityFresnelParameters")],S.prototype,"_opacityFresnelParameters",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsFresnelAndMiscDirty")],S.prototype,"opacityFresnelParameters",void 0),(0,s.Cg)([(0,r.Y9)("reflectionFresnelParameters")],S.prototype,"_reflectionFresnelParameters",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"reflectionFresnelParameters",void 0),(0,s.Cg)([(0,r.Y9)("refractionFresnelParameters")],S.prototype,"_refractionFresnelParameters",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"refractionFresnelParameters",void 0),(0,s.Cg)([(0,r.Y9)("emissiveFresnelParameters")],S.prototype,"_emissiveFresnelParameters",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"emissiveFresnelParameters",void 0),(0,s.Cg)([(0,r.lK)("useReflectionFresnelFromSpecular")],S.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsFresnelDirty")],S.prototype,"useReflectionFresnelFromSpecular",void 0),(0,s.Cg)([(0,r.lK)("useGlossinessFromSpecularMapAlpha")],S.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,s.Cg)([(0,r.lK)("maxSimultaneousLights")],S.prototype,"_maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsLightsDirty")],S.prototype,"maxSimultaneousLights",void 0),(0,s.Cg)([(0,r.lK)("invertNormalMapX")],S.prototype,"_invertNormalMapX",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapX",void 0),(0,s.Cg)([(0,r.lK)("invertNormalMapY")],S.prototype,"_invertNormalMapY",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapY",void 0),(0,s.Cg)([(0,r.lK)("twoSidedLighting")],S.prototype,"_twoSidedLighting",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"twoSidedLighting",void 0),(0,s.Cg)([(0,r.lK)("applyDecalMapAfterDetailMap")],S.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,s.Cg)([(0,r.$z)("_markAllSubMeshesAsMiscDirty")],S.prototype,"applyDecalMapAfterDetailMap",void 0),(0,g.Y5)("BABYLON.StandardMaterial",S),o.Z.DefaultMaterialFactory=e=>new S("default material",e)},6871:(e,t,i)=>{"use strict";i.d(t,{_0:()=>o});var s,r,n=i(4049);!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(s||(s={}));class o{}o.X=new n.Pq(1,0,0),o.Y=new n.Pq(0,1,0),o.Z=new n.Pq(0,0,1),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(r||(r={}))},7230:(e,t,i)=>{"use strict";i.d(t,{Qz:()=>o,fj:()=>n});var s,r=i(3054);function n(e){let t=0;const i=Date.now();e.observableParameters=e.observableParameters??{};const s=e.contextObservable.add((r=>{const n=Date.now();t=n-i;const o={startTime:i,currentTime:n,deltaTime:t,completeRate:t/e.timeout,payload:r};e.onTick&&e.onTick(o),e.breakCondition&&e.breakCondition()&&(e.contextObservable.remove(s),e.onAborted&&e.onAborted(o)),t>=e.timeout&&(e.contextObservable.remove(s),e.onEnded&&e.onEnded(o))}),e.observableParameters.mask,e.observableParameters.insertFirst,e.observableParameters.scope);return s}!function(e){e[e.INIT=0]="INIT",e[e.STARTED=1]="STARTED",e[e.ENDED=2]="ENDED"}(s||(s={}));class o{constructor(e){this.onEachCountObservable=new r.cP,this.onTimerAbortedObservable=new r.cP,this.onTimerEndedObservable=new r.cP,this.onStateChangedObservable=new r.cP,this._observer=null,this._breakOnNextTick=!1,this._tick=e=>{const t=Date.now();this._timer=t-this._startTime;const i={startTime:this._startTime,currentTime:t,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:e},s=this._breakOnNextTick||this._breakCondition(i);s||this._timer>=this._timeToEnd?this._stop(i,s):this.onEachCountObservable.notifyObservers(i)},this._setState(0),this._contextObservable=e.contextObservable,this._observableParameters=e.observableParameters??{},this._breakCondition=e.breakCondition??(()=>!1),this._timeToEnd=e.timeout,e.onEnded&&this.onTimerEndedObservable.add(e.onEnded),e.onTick&&this.onEachCountObservable.add(e.onTick),e.onAborted&&this.onTimerAbortedObservable.add(e.onAborted)}set breakCondition(e){this._breakCondition=e}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(e=this._timeToEnd){if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=e,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(e){this._state=e,this.onStateChangedObservable.notifyObservers(this._state)}_stop(e,t=!1){this._contextObservable.remove(this._observer),this._setState(2),t?this.onTimerAbortedObservable.notifyObservers(e):this.onTimerEndedObservable.notifyObservers(e)}}},7291:(e,t,i)=>{"use strict";i.d(t,{N:()=>R});var s=i(3788),r=i(1497),n=i(8499),o=i(8827);class a{constructor(e=30){this._enabled=!0,this._rollingFrameTime=new h(e)}sampleFrame(e=o.j.Now){if(this._enabled){if(null!=this._lastFrameTimeMs){const t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class h{constructor(e){this._samples=new Array(e),this.reset()}add(e){let t;if(this.isSaturated()){const e=this._samples[this._pos];t=e-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(e-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length}history(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;const t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(e){const t=this._samples.length;return(e%t+t)%t}}var l=i(6679),c=i(3039),u=i(9202);n.ThinEngine.prototype.setAlphaMode=function(e,t=!1){if(this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}else if(!t){const t=0===e;this.depthCullingState.depthMask!==t&&(this.depthCullingState.depthMask=t)}};var d=i(1663);function _(e,t,i,s){let r,n=1;1===s?r=new Float32Array(t*i*4):2===s?(r=new Uint16Array(t*i*4),n=15360):r=7===s?new Uint32Array(t*i*4):new Uint8Array(t*i*4);for(let s=0;s<t;s++)for(let o=0;o<i;o++){const i=3*(o*t+s),a=4*(o*t+s);r[a+0]=e[i+0],r[a+1]=e[i+1],r[a+2]=e[i+2],r[a+3]=n}return r}function p(e){return function(t,i,r,n,o,a,h,l,c=null,u=0){const d=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,_=e?10:11,p=new s.h(this,_);p.baseWidth=i,p.baseHeight=r,p.baseDepth=n,p.width=i,p.height=r,p.depth=n,p.format=o,p.type=u,p.generateMipMaps=a,p.samplingMode=l,e?p.is3D=!0:p.is2DArray=!0,this._doNotHandleContextLost||(p._bufferView=t),e?this.updateRawTexture3D(p,t,o,h,c,u):this.updateRawTexture2DArray(p,t,o,h,c,u),this._bindTextureDirectly(d,p,!0);const g=this._getSamplingParameters(l,a);return this._gl.texParameteri(d,this._gl.TEXTURE_MAG_FILTER,g.mag),this._gl.texParameteri(d,this._gl.TEXTURE_MIN_FILTER,g.min),a&&this._gl.generateMipmap(d),this._bindTextureDirectly(d,null),this._internalTexturesCache.push(p),p}}function g(e){return function(t,i,s,r,n=null,o=0){const a=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,h=this._getWebGLTextureType(o),l=this._getInternalFormat(s),c=this._getRGBABufferInternalSizedFormat(o,s);this._bindTextureDirectly(a,t,!0),this._unpackFlipY(void 0===r||!!r),this._doNotHandleContextLost||(t._bufferView=i,t.format=s,t.invertY=r,t._compression=n),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&i?this._gl.compressedTexImage3D(a,0,this.getCaps().s3tc[n],t.width,t.height,t.depth,0,i):this._gl.texImage3D(a,0,c,t.width,t.height,t.depth,0,l,h,i),t.generateMipMaps&&this._gl.generateMipmap(a),this._bindTextureDirectly(a,null),t.isReady=!0}}n.ThinEngine.prototype.updateRawTexture=function(e,t,i,s,r=null,n=0,o=!1){if(!e)return;const a=this._getRGBABufferInternalSizedFormat(n,i,o),h=this._getInternalFormat(i),l=this._getWebGLTextureType(n);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===s||!!s),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.type=n,e.invertY=s,e._compression=r),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[r],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,e.width,e.height,0,h,l,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0},n.ThinEngine.prototype.createRawTexture=function(e,t,i,r,n,o,a,h=null,l=0,c=0,u=!1){const d=new s.h(this,3);d.baseWidth=t,d.baseHeight=i,d.width=t,d.height=i,d.format=r,d.generateMipMaps=n,d.samplingMode=a,d.invertY=o,d._compression=h,d.type=l,d._useSRGBBuffer=this._getUseSRGBBuffer(u,!n),this._doNotHandleContextLost||(d._bufferView=e),this.updateRawTexture(d,e,r,o,h,l,d._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,d,!0);const _=this._getSamplingParameters(a,n);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,_.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,_.min),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(d),d},n.ThinEngine.prototype.createRawCubeTexture=function(e,t,i,r,n,o,a,h=null){const l=this._gl,u=new s.h(this,8);u.isCube=!0,u.format=i,u.type=r,this._doNotHandleContextLost||(u._bufferViewArray=e);const _=this._getWebGLTextureType(r);let p=this._getInternalFormat(i);p===l.RGB&&(p=l.RGBA),_!==l.FLOAT||this._caps.textureFloatLinearFiltering?_!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?_!==l.FLOAT||this._caps.textureFloatRender?_!==l.HALF_FLOAT||this._caps.colorBufferFloat||(n=!1,c.V.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(n=!1,c.V.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(n=!1,a=1,c.V.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(n=!1,a=1,c.V.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const g=t,f=g;if(u.width=g,u.height=f,u.invertY=o,u._compression=h,!this.needPOTTextures||(0,d.L8)(u.width)&&(0,d.L8)(u.height)||(n=!1),e)this.updateRawCubeTexture(u,e,i,r,o,h);else{const e=this._getRGBABufferInternalSizedFormat(r),t=0;this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,u,!0);for(let i=0;i<6;i++)h?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+i,t,this.getCaps().s3tc[h],u.width,u.height,0,void 0):l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+i,t,e,u.width,u.height,0,p,_,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,u,!0),e&&n&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const m=this._getSamplingParameters(a,n);return l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,m.mag),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,m.min),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null),u.generateMipMaps=n,u.samplingMode=a,u.isReady=!0,u},n.ThinEngine.prototype.updateRawCubeTexture=function(e,t,i,s,r,n=null,o=0){e._bufferViewArray=t,e.format=i,e.type=s,e.invertY=r,e._compression=n;const a=this._gl,h=this._getWebGLTextureType(s);let l=this._getInternalFormat(i);const c=this._getRGBABufferInternalSizedFormat(s);let u=!1;l===a.RGB&&(l=a.RGBA,u=!0),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===r||!!r),e.width%4!=0&&a.pixelStorei(a.UNPACK_ALIGNMENT,1);for(let i=0;i<6;i++){let r=t[i];n?a.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+i,o,this.getCaps().s3tc[n],e.width,e.height,0,r):(u&&(r=_(r,e.width,e.height,s)),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+i,o,c,e.width,e.height,0,l,h,r))}(!this.needPOTTextures||(0,d.L8)(e.width)&&(0,d.L8)(e.height))&&e.generateMipMaps&&0===o&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},n.ThinEngine.prototype.createRawCubeTextureFromUrl=function(e,t,i,s,r,n,o,a,h=null,l=null,c=3,u=!1){const d=this._gl,p=this.createRawCubeTexture(null,i,s,r,!n,u,c,null);t?.addPendingData(p),p.url=e,p.isReady=!1,this._internalTexturesCache.push(p);const g=e=>{if(!p._hardwareTexture)return;const i=p.width,n=o(e);if(n){if(a){const e=this._getWebGLTextureType(r);let t=this._getInternalFormat(s);const o=this._getRGBABufferInternalSizedFormat(r);let h=!1;t===d.RGB&&(t=d.RGBA,h=!0),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,p,!0),this._unpackFlipY(!1);const l=a(n);for(let s=0;s<l.length;s++){const n=i>>s;for(let i=0;i<6;i++){let a=l[s][i];h&&(a=_(a,n,n,r)),d.texImage2D(i,s,o,n,n,0,t,e,a)}}this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(p,n,s,r,u);p.isReady=!0,t?.removePendingData(p),p.onLoadedObservable.notifyObservers(p),p.onLoadedObservable.clear(),h&&h()}};return this._loadFile(e,(e=>{g(e)}),void 0,t?.offlineProvider,!0,((e,i)=>{t?.removePendingData(p),l&&e&&l(e.status+" "+e.statusText,i)})),p},n.ThinEngine.prototype.createRawTexture2DArray=p(!1),n.ThinEngine.prototype.createRawTexture3D=p(!0),n.ThinEngine.prototype.updateRawTexture2DArray=g(!1),n.ThinEngine.prototype.updateRawTexture3D=g(!0);var f=i(8615);n.ThinEngine.prototype._readTexturePixelsSync=function(e,t,i,s=-1,r=0,n=null,o=!0,a=!1,h=0,l=0){const c=this._gl;if(!c)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const e=c.createFramebuffer();if(!e)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=e}c.bindFramebuffer(c.FRAMEBUFFER,this._dummyFramebuffer),s>-1?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+s,e._hardwareTexture?.underlyingResource,r):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,e._hardwareTexture?.underlyingResource,r);let u=void 0!==e.type?this._getWebGLTextureType(e.type):c.UNSIGNED_BYTE;return a?n||(n=(0,f.kZ)(e.type,4*t*i)):u===c.UNSIGNED_BYTE?(n||(n=new Uint8Array(4*t*i)),u=c.UNSIGNED_BYTE):(n||(n=new Float32Array(4*t*i)),u=c.FLOAT),o&&this.flushFramebuffer(),c.readPixels(h,l,t,i,c.RGBA,u,n),c.bindFramebuffer(c.FRAMEBUFFER,this._currentFramebuffer),n},n.ThinEngine.prototype._readTexturePixels=function(e,t,i,s=-1,r=0,n=null,o=!0,a=!1,h=0,l=0){return Promise.resolve(this._readTexturePixelsSync(e,t,i,s,r,n,o,a,h,l))},i(1386),n.ThinEngine.prototype._createDepthStencilCubeTexture=function(e,t){const i=new s.h(this,12);if(i.isCube=!0,1===this.webGLVersion)return c.V.Error("Depth cube texture is not supported by WebGL 1."),i;const r={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t},n=this._gl;this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,i,!0),this._setupDepthStencilTexture(i,e,r.bilinearFiltering,r.comparisonFunction);for(let t=0;t<6;t++)r.generateStencil?n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,n.DEPTH24_STENCIL8,e,e,0,n.DEPTH_STENCIL,n.UNSIGNED_INT_24_8,null):n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,n.DEPTH_COMPONENT24,e,e,0,n.DEPTH_COMPONENT,n.UNSIGNED_INT,null);return this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(i),i},n.ThinEngine.prototype._setCubeMapTextureParams=function(e,t,i){const s=this._gl;s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,t?s.LINEAR_MIPMAP_LINEAR:s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),e.samplingMode=t?3:2,t&&this.getCaps().textureMaxLevel&&void 0!==i&&i>0&&(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAX_LEVEL,i),e._maxLodLevel=i),this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null)},n.ThinEngine.prototype.createCubeTexture=function(e,t,i,s,r=null,n=null,o,a=null,h=!1,l=0,u=0,_=null,p,g=!1,f=null){const m=this._gl;return this.createCubeTextureBase(e,t,i,!!s,r,n,o,a,h,l,u,_,(e=>this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,e,!0)),((e,t)=>{const i=this.needPOTTextures?(0,d.R)(t[0].width,this._caps.maxCubemapTextureSize):t[0].width,n=i,a=[m.TEXTURE_CUBE_MAP_POSITIVE_X,m.TEXTURE_CUBE_MAP_POSITIVE_Y,m.TEXTURE_CUBE_MAP_POSITIVE_Z,m.TEXTURE_CUBE_MAP_NEGATIVE_X,m.TEXTURE_CUBE_MAP_NEGATIVE_Y,m.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(!1);const h=o?this._getInternalFormat(o,e._useSRGBBuffer):e._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:m.RGBA;let l=o?this._getInternalFormat(o):m.RGBA;e._useSRGBBuffer&&1===this.webGLVersion&&(l=h);for(let e=0;e<a.length;e++)if(t[e].width!==i||t[e].height!==n){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void c.V.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=i,this._workingCanvas.height=n,this._workingContext.drawImage(t[e],0,0,t[e].width,t[e].height,0,0,i,n),m.texImage2D(a[e],0,h,l,m.UNSIGNED_BYTE,this._workingCanvas)}else m.texImage2D(a[e],0,h,l,m.UNSIGNED_BYTE,t[e]);s||m.generateMipmap(m.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(e,!s),e.width=i,e.height=n,e.isReady=!0,o&&(e.format=o),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()}),!!g,f)},n.ThinEngine.prototype.generateMipMapsForCubemap=function(e,t=!0){if(e.generateMipMaps){const i=this._gl;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)}};var m=i(9576);class b{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(e,t=!0){t&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=e,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,e&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,m.$l)(e.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){return this._textures?.[0]??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(e){if(!this._textures)return-1;const t=this._textures[e],i=this._layerIndices?.[e]??0,s=this._faceIndices?.[e]??0;return t.isCube?6*i+s:t.is3D?0:i}get samples(){return this._samples}setSamples(e,t=!0,i=!1){if(this.samples===e&&!i)return e;const s=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,e,t):this._engine.updateRenderTargetTextureSampleCount(this,e);return this._samples=e,s}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(e,t,i,s,r){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=e,this._isCube=t,this._size=i,this._engine=s,this._depthStencilTexture=null,this.label=r}setTextures(e){Array.isArray(e)?this._textures=e:this._textures=e?[e]:null}setTexture(e,t=0,i=!0){this._textures||(this._textures=[]),this._textures[t]!==e&&(this._textures[t]&&i&&this._textures[t].dispose(),this._textures[t]=e)}setLayerAndFaceIndices(e,t){this._layerIndices=e,this._faceIndices=t}setLayerAndFaceIndex(e=0,t,i){this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==t&&t>=0&&(this._layerIndices[e]=t),void 0!==i&&i>=0&&(this._faceIndices[e]=i)}createDepthStencilTexture(e=0,t=!0,i=!1,s=1,r=14,n){return this._depthStencilTexture?.dispose(),this._depthStencilTextureWithStencil=i,this._depthStencilTextureLabel=n,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:i,isCube:this._isCube,samples:s,depthTextureFormat:r,label:n},this),this._depthStencilTexture}_shareDepth(e){this.shareDepth(e)}shareDepth(e){this._depthStencilTexture&&(e._depthStencilTexture&&e._depthStencilTexture.dispose(),e._depthStencilTexture=this._depthStencilTexture,e._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(e){this.texture&&this.texture._swapAndDie(e),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let e=null;if(this._isMulti){const t=this.textures;if(t&&t.length>0){let i=!1,s=t.length,r=-1;const n=t[t.length-1]._source;14!==n&&12!==n||(i=!0,r=t[t.length-1].format,s--);const o=[],a=[],h=[],l=[],c=[],u=[],d=[],_={};for(let e=0;e<s;++e){const i=t[e];o.push(i.samplingMode),a.push(i.type),h.push(i.format),void 0!==_[i.uniqueId]?(l.push(-1),d.push(0)):(_[i.uniqueId]=e,i.is2DArray?(l.push(35866),d.push(i.depth)):i.isCube?(l.push(34067),d.push(0)):i.is3D?(l.push(32879),d.push(i.depth)):(l.push(3553),d.push(0))),this._faceIndices&&c.push(this._faceIndices[e]??0),this._layerIndices&&u.push(this._layerIndices[e]??0)}const p={samplingModes:o,generateMipMaps:t[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:i,depthTextureFormat:r,types:a,formats:h,textureCount:s,targetTypes:l,faceIndex:c,layerIndex:u,layerCounts:d,label:this.label},g={width:this.width,height:this.height,depth:this.depth};e=this._engine.createMultipleRenderTarget(g,p);for(let i=0;i<s;++i){if(-1!==l[i])continue;const s=_[t[i].uniqueId];e.setTexture(e.textures[s],i)}}}else{const t={};if(t.generateDepthBuffer=this._generateDepthBuffer,t.generateMipMaps=this.texture?.generateMipMaps??!1,t.generateStencilBuffer=this._generateStencilBuffer,t.samplingMode=this.texture?.samplingMode,t.type=this.texture?.type,t.format=this.texture?.format,t.noColorAttachment=!this._textures,t.label=this.label,this.isCube)e=this._engine.createRenderTargetCubeTexture(this.width,t);else{const i={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?this.texture?.depth:void 0};e=this._engine.createRenderTargetTexture(i,t)}e.texture&&(e.texture.isReady=!0)}return e}_swapRenderTargetWrapper(e){if(this._textures&&e._textures)for(let t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(e._textures[t],!1),e._textures[t].isReady=!0;this._depthStencilTexture&&e._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(e._depthStencilTexture),e._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const e=this._cloneRenderTargetWrapper();if(e){if(this._depthStencilTexture){const t=this._depthStencilTexture.samplingMode,i=this._depthStencilTexture.format,s=2===t||3===t||11===t;e.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,s,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,i,this._depthStencilTextureLabel)}this.samples>1&&e.setSamples(this.samples),e._swapRenderTargetWrapper(this),e.dispose()}}releaseTextures(){if(this._textures)for(let e=0;e<this._textures.length;++e)this._textures[e].dispose();this._textures=null}dispose(e=!1){e||(this._depthStencilTexture?.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)}}class v extends b{setDepthStencilTexture(e,t=!0){if(super.setDepthStencilTexture(e,t),!e)return;const i=this._engine,s=this._context,r=e._hardwareTexture;if(r&&e._autoMSAAManagement&&this._MSAAFramebuffer){const t=i._currentFramebuffer;i._bindUnboundFramebuffer(this._MSAAFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,(0,m.$l)(e.format)?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,s.RENDERBUFFER,r.getMSAARenderBuffer()),i._bindUnboundFramebuffer(t)}}constructor(e,t,i,s,r){super(e,t,i,s),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=r}_cloneRenderTargetWrapper(){let e=null;return this._colorTextureArray&&this._depthStencilTextureArray?(e=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),e.texture.isReady=!0):e=super._cloneRenderTargetWrapper(),e}_swapRenderTargetWrapper(e){super._swapRenderTargetWrapper(e),e._framebuffer=this._framebuffer,e._depthStencilBuffer=this._depthStencilBuffer,e._MSAAFramebuffer=this._MSAAFramebuffer,e._colorTextureArray=this._colorTextureArray,e._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(e=0,t=!0,i=!1,s=1,r=14,n){if(this._depthStencilBuffer){const e=this._engine,t=e._currentFramebuffer,i=this._context;e._bindUnboundFramebuffer(this._framebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,null),e._bindUnboundFramebuffer(t),i.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(e,t,i,s,r,n)}shareDepth(e){super.shareDepth(e);const t=this._context,i=this._depthStencilBuffer,s=e._MSAAFramebuffer||e._framebuffer,r=this._engine;e._depthStencilBuffer&&e._depthStencilBuffer!==i&&t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=i;const n=e._generateStencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;r._bindUnboundFramebuffer(s),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,i),r._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(e,t=0,i,s=0){const r=e._hardwareTexture;if(!r)return;const n=this._framebuffer,o=this._engine,a=o._currentFramebuffer;let h;if(o._bindUnboundFramebuffer(n),o.webGLVersion>1){const n=this._context;h=n["COLOR_ATTACHMENT"+t],e.is2DArray||e.is3D?(i=i??this.layerIndices?.[t]??0,n.framebufferTextureLayer(n.FRAMEBUFFER,h,r.underlyingResource,s,i)):e.isCube?(i=i??this.faceIndices?.[t]??0,n.framebufferTexture2D(n.FRAMEBUFFER,h,n.TEXTURE_CUBE_MAP_POSITIVE_X+i,r.underlyingResource,s)):n.framebufferTexture2D(n.FRAMEBUFFER,h,n.TEXTURE_2D,r.underlyingResource,s)}else{const e=this._context;h=e["COLOR_ATTACHMENT"+t+"_WEBGL"];const n=void 0!==i?e.TEXTURE_CUBE_MAP_POSITIVE_X+i:e.TEXTURE_2D;e.framebufferTexture2D(e.FRAMEBUFFER,h,n,r.underlyingResource,s)}if(e._autoMSAAManagement&&this._MSAAFramebuffer){const e=this._context;o._bindUnboundFramebuffer(this._MSAAFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,h,e.RENDERBUFFER,r.getMSAARenderBuffer())}o._bindUnboundFramebuffer(a)}setTexture(e,t=0,i=!0){super.setTexture(e,t,i),this._bindTextureRenderTarget(e,t)}setLayerAndFaceIndices(e,t){if(super.setLayerAndFaceIndices(e,t),!this.textures||!this.layerIndices||!this.faceIndices)return;const i=this._attachments?.length??this.textures.length;for(let e=0;e<i;e++){const t=this.textures[e];t&&(t.is2DArray||t.is3D?this._bindTextureRenderTarget(t,e,this.layerIndices[e]):t.isCube?this._bindTextureRenderTarget(t,e,this.faceIndices[e]):this._bindTextureRenderTarget(t,e))}}setLayerAndFaceIndex(e=0,t,i){if(super.setLayerAndFaceIndex(e,t,i),!this.textures||!this.layerIndices||!this.faceIndices)return;const s=this.textures[e];s.is2DArray||s.is3D?this._bindTextureRenderTarget(this.textures[e],e,this.layerIndices[e]):s.isCube&&this._bindTextureRenderTarget(this.textures[e],e,this.faceIndices[e])}resolveMSAATextures(){const e=this._engine,t=e._currentFramebuffer;e._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),e._bindUnboundFramebuffer(t)}dispose(e=this._disposeOnlyFramebuffers){const t=this._context;e||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(t.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(t.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(t.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(e)}}var T=i(976);T.$.prototype.createDepthStencilTexture=function(e,t,i){if(t.isCube){const i=e.width||e;return this._createDepthStencilCubeTexture(i,t)}return this._createDepthStencilTexture(e,t,i)},n.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(e,t,i){const s=new v(e,t,i,this,this._gl);return this._renderTargetWrapperCache.push(s),s},n.ThinEngine.prototype.createRenderTargetTexture=function(e,t){const i=this._createHardwareRenderTargetWrapper(!1,!1,e);let s,r,n=!0,o=!1,a=!1,h=1;void 0!==t&&"object"==typeof t&&(n=t.generateDepthBuffer??!0,o=!!t.generateStencilBuffer,a=!!t.noColorAttachment,s=t.colorAttachment,h=t.samples??1,r=t.label);const l=s||(a?null:this._createInternalTexture(e,t,!0,5)),c=e.width||e,u=e.height||e,d=this._currentFramebuffer,_=this._gl,p=_.createFramebuffer();if(this._bindUnboundFramebuffer(p),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(o,n,c,u),!l||l.is2DArray||l.is3D||_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,l._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(d),i.label=r??"RenderTargetWrapper",i._framebuffer=p,i._generateDepthBuffer=n,i._generateStencilBuffer=o,i.setTextures(l),s){if(i._samples=s.samples,s.samples>1){const e=s._hardwareTexture.getMSAARenderBuffer(0);i._MSAAFramebuffer=_.createFramebuffer(),this._bindUnboundFramebuffer(i._MSAAFramebuffer),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.RENDERBUFFER,e),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(i,h);return i},n.ThinEngine.prototype._createDepthStencilTexture=function(e,t,i){const r=this._gl,n=e.layers||0,o=e.depth||0;let a=r.TEXTURE_2D;0!==n?a=r.TEXTURE_2D_ARRAY:0!==o&&(a=r.TEXTURE_3D);const h=new s.h(this,12);if(h.label=t.label,!this._caps.depthTextureExtension)return c.V.Error("Depth texture is not supported by your browser or hardware."),h;const l={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t};if(this._bindTextureDirectly(a,h,!0),this._setupDepthStencilTexture(h,e,0!==l.comparisonFunction&&l.bilinearFiltering,l.comparisonFunction,l.samples),void 0!==l.depthTextureFormat){if(15!==l.depthTextureFormat&&16!==l.depthTextureFormat&&17!==l.depthTextureFormat&&13!==l.depthTextureFormat&&14!==l.depthTextureFormat&&18!==l.depthTextureFormat)return c.V.Error(`Depth texture ${l.depthTextureFormat} format is not supported.`),h;h.format=l.depthTextureFormat}else h.format=l.generateStencil?13:16;const u=(0,m.$l)(h.format),d=this._getWebGLTextureTypeFromDepthTextureFormat(h.format),_=u?r.DEPTH_STENCIL:r.DEPTH_COMPONENT,p=this._getInternalFormatFromDepthTextureFormat(h.format,!0,u);return h.is2DArray?r.texImage3D(a,0,p,h.width,h.height,n,0,_,d,null):h.is3D?r.texImage3D(a,0,p,h.width,h.height,o,0,_,d,null):r.texImage2D(a,0,p,h.width,h.height,0,_,d,null),this._bindTextureDirectly(a,null),this._internalTexturesCache.push(h),i._depthStencilBuffer&&(r.deleteRenderbuffer(i._depthStencilBuffer),i._depthStencilBuffer=null),this._bindUnboundFramebuffer(i._MSAAFramebuffer??i._framebuffer),i._generateStencilBuffer=u,i._depthStencilTextureWithStencil=u,i._depthStencilBuffer=this._setupFramebufferDepthAttachments(i._generateStencilBuffer,i._generateDepthBuffer,i.width,i.height,i.samples,h.format),this._bindUnboundFramebuffer(null),h},n.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;const i=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(i.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null);const s=e.texture?._hardwareTexture;if(s?.releaseMSAARenderBuffers(),e.texture&&t>1&&"function"==typeof i.renderbufferStorageMultisample){const r=i.createFramebuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=r,this._bindUnboundFramebuffer(e._MSAAFramebuffer);const n=this._createRenderBuffer(e.texture.width,e.texture.height,t,-1,this._getRGBABufferInternalSizedFormat(e.texture.type,e.texture.format,e.texture._useSRGBBuffer),i.COLOR_ATTACHMENT0,!1);if(!n)throw new Error("Unable to create multi sampled framebuffer");s?.addMSAARenderBuffer(n)}this._bindUnboundFramebuffer(e._MSAAFramebuffer??e._framebuffer),e.texture&&(e.texture.samples=t),e._samples=t;const r=e._depthStencilTexture?e._depthStencilTexture.format:void 0;return e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t,r),this._bindUnboundFramebuffer(null),t},n.ThinEngine.prototype._setupDepthStencilTexture=function(e,t,i,s,r=1){const n=t.width??t,o=t.height??t,a=t.layers||0,h=t.depth||0;e.baseWidth=n,e.baseHeight=o,e.width=n,e.height=o,e.is2DArray=a>0,e.depth=a||h,e.isReady=!0,e.samples=r,e.generateMipMaps=!1,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=s;const l=this._gl,c=this._getTextureTarget(e),u=this._getSamplingParameters(e.samplingMode,!1);l.texParameteri(c,l.TEXTURE_MAG_FILTER,u.mag),l.texParameteri(c,l.TEXTURE_MIN_FILTER,u.min),l.texParameteri(c,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(c,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===s?(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,515),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,s),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE)))},n.ThinEngine.prototype.setDepthStencilTexture=function(e,t,i,s){void 0!==e&&(t&&(this._boundUniforms[e]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0,s):this._setTexture(e,null,void 0,void 0,s))},n.ThinEngine.prototype.createRenderTargetCubeTexture=function(e,t){const i=this._createHardwareRenderTargetWrapper(!1,!0,e),r={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...t};r.generateStencilBuffer=r.generateDepthBuffer&&r.generateStencilBuffer,(1!==r.type||this._caps.textureFloatLinearFiltering)&&(2!==r.type||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=1);const n=this._gl,o=new s.h(this,5);this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,o,!0);const a=this._getSamplingParameters(r.samplingMode,r.generateMipMaps);1!==r.type||this._caps.textureFloat||(r.type=0,c.V.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,a.mag),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,a.min),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);for(let t=0;t<6;t++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this._getRGBABufferInternalSizedFormat(r.type,r.format),e,e,0,this._getInternalFormat(r.format),this._getWebGLTextureType(r.type),null);const h=n.createFramebuffer();return this._bindUnboundFramebuffer(h),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(r.generateStencilBuffer,r.generateDepthBuffer,e,e),r.generateMipMaps&&n.generateMipmap(n.TEXTURE_CUBE_MAP),this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),i._framebuffer=h,i._generateDepthBuffer=r.generateDepthBuffer,i._generateStencilBuffer=r.generateStencilBuffer,o.width=e,o.height=e,o.isReady=!0,o.isCube=!0,o.samples=1,o.generateMipMaps=r.generateMipMaps,o.samplingMode=r.samplingMode,o.type=r.type,o.format=r.format,this._internalTexturesCache.push(o),i.setTextures(o),i};var y=i(4871),x=i(3113);n.ThinEngine.prototype.createPrefilteredCubeTexture=function(e,t,r,n,o=null,a=null,h,l=null,u=!0){return this.createCubeTexture(e,t,null,!1,(async e=>{if(!e)return void(o&&o(null));const a=e.texture;if(u?e.info.sphericalPolynomial&&(a._sphericalPolynomial=e.info.sphericalPolynomial):a._sphericalPolynomial=new y.Q,a._source=9,this.getCaps().textureLOD)return void(o&&o(a));const h=this._gl,l=e.width;if(!l)return;const{DDSTools:d}=await Promise.resolve().then(i.bind(i,5326)),_=[];for(let i=0;i<3;i++){const o=1-i/2,u=n,p=Math.log2(l)*r+n,g=u+(p-u)*o,f=Math.round(Math.min(Math.max(g,0),p)),m=new s.h(this,2);if(m.type=a.type,m.format=a.format,m.width=Math.pow(2,Math.max(Math.log2(l)-f,0)),m.height=m.width,m.isCube=!0,m._cachedWrapU=0,m._cachedWrapV=0,this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,m,!0),m.samplingMode=2,h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),e.isDDS){const t=e.info,i=e.data;this._unpackFlipY(t.isCompressed),d.UploadDDSLevels(this,m,i,t,!0,6,f)}else c.V.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null);const b=new x.t(t);b._isCube=!0,b._texture=m,m.isReady=!0,_.push(b)}a._lodTextureHigh=_[2],a._lodTextureMid=_[1],a._lodTextureLow=_[0],o&&o(a)}),a,h,l,u,r,n)},n.ThinEngine.prototype.createUniformBuffer=function(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create uniform buffer");const s=new l.A(i);return this.bindUniformBuffer(s),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),s.references=1,s},n.ThinEngine.prototype.createDynamicUniformBuffer=function(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create dynamic uniform buffer");const s=new l.A(i);return this.bindUniformBuffer(s),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),s.references=1,s},n.ThinEngine.prototype.updateUniformBuffer=function(e,t,i,s){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===s?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+s)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+s)),this.bindUniformBuffer(null)},n.ThinEngine.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},n.ThinEngine.prototype.bindUniformBufferBase=function(e,t,i){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},n.ThinEngine.prototype.bindUniformBlock=function(e,t,i){const s=e.program,r=this._gl.getUniformBlockIndex(s,t);4294967295!==r&&this._gl.uniformBlockBinding(s,r,i)};var A=i(4920);function C(e){if(e.requestPointerLock){const t=e.requestPointerLock();t instanceof Promise?t.then((()=>{e.focus()})).catch((()=>{})):e.focus()}}T.$.prototype.displayLoadingUI=function(){if(!(0,A.BA)())return;const e=this.loadingScreen;e&&e.displayLoadingUI()},T.$.prototype.hideLoadingUI=function(){if(!(0,A.BA)())return;const e=this._loadingScreen;e&&e.hideLoadingUI()},Object.defineProperty(T.$.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=T.$.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(T.$.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(T.$.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),T.$.prototype.getInputElement=function(){return this._renderingCanvas},T.$.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},T.$.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},T.$.prototype.getAspectRatio=function(e,t=!1){const i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},T.$.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},T.$.prototype._verifyPointerLock=function(){this._onPointerLockChange?.()},T.$.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}},T.$.prototype.getInputElement=function(){return this._renderingCanvas},T.$.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},T.$.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},T.$.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},T.$.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},T.$.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},T.$.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},T.$.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},T.$.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},T.$.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},T.$.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},T.$.prototype.getStencilMask=function(){return this._stencilState.stencilMask},T.$.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},T.$.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},T.$.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},T.$.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},T.$.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},T.$.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},T.$.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},T.$.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},T.$.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},T.$.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},T.$.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},T.$.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},T.$.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},T.$.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},T.$.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},T.$.prototype.setAlphaConstants=function(e,t,i,s){this._alphaState.setAlphaBlendConstants(e,t,i,s)},T.$.prototype.getAlphaMode=function(){return this._alphaMode},T.$.prototype.getAlphaEquation=function(){return this._alphaEquation},T.$.prototype.getRenderPassNames=function(){return this._renderPassNames},T.$.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},T.$.prototype.createRenderPassId=function(e){const t=++T.$._RenderPassIdCounter;return this._renderPassNames[t]=e??"NONAME",t},T.$.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(let t=0;t<this.scenes.length;++t){const i=this.scenes[t];for(let t=0;t<i.meshes.length;++t){const s=i.meshes[t];if(s.subMeshes)for(let t=0;t<s.subMeshes.length;++t)s.subMeshes[t]._removeDrawWrapper(e)}}};var S=i(1994),E=(i(2507),i(5098));class R extends n.ThinEngine{static get NpmPackage(){return T.$.NpmPackage}static get Version(){return T.$.Version}static get Instances(){return r.q.Instances}static get LastCreatedEngine(){return r.q.LastCreatedEngine}static get LastCreatedScene(){return r.q.LastCreatedScene}static DefaultLoadingScreenFactory(e){return T.$.DefaultLoadingScreenFactory(e)}get _supportsHardwareTextureRescaling(){return!!R._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(e,t,i,s=!1){super(e,t,i,s),this.customAnimationFrameRequester=null,this._performanceMonitor=new a,this._drawCalls=new S.A,e&&(this._features.supportRenderPasses=!0,i=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(e){super._sharedInit(e),function(e,t,i){e._onCanvasFocus=()=>{e.onCanvasFocusObservable.notifyObservers(e)},e._onCanvasBlur=()=>{e.onCanvasBlurObservable.notifyObservers(e)},e._onCanvasContextMenu=t=>{e.disableContextMenu&&t.preventDefault()},t.addEventListener("focus",e._onCanvasFocus),t.addEventListener("blur",e._onCanvasBlur),t.addEventListener("contextmenu",e._onCanvasContextMenu),e._onBlur=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.disable(),e._windowIsBackground=!0},e._onFocus=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.enable(),e._windowIsBackground=!1},e._onCanvasPointerOut=i=>{document.elementFromPoint(i.clientX,i.clientY)!==t&&e.onCanvasPointerOutObservable.notifyObservers(i)};const s=e.getHostWindow();s&&"function"==typeof s.addEventListener&&(s.addEventListener("blur",e._onBlur),s.addEventListener("focus",e._onFocus)),t.addEventListener("pointerout",e._onCanvasPointerOut),i.doNotHandleTouchAction||function(e){e&&e.setAttribute&&(e.setAttribute("touch-action","none"),e.style.touchAction="none",e.style.webkitTapHighlightColor="transparent")}(t),!T.$.audioEngine&&i.audioEngine&&T.$.AudioEngineFactory&&(T.$.audioEngine=T.$.AudioEngineFactory(e.getRenderingCanvas(),e.getAudioContext(),e.getAudioDestination())),(0,A.Nf)()&&(e._onFullscreenChange=()=>{e.isFullscreen=!!document.fullscreenElement,e.isFullscreen&&e._pointerLockRequested&&t&&C(t)},document.addEventListener("fullscreenchange",e._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",e._onFullscreenChange,!1),e._onPointerLockChange=()=>{e.isPointerLock=document.pointerLockElement===t},document.addEventListener("pointerlockchange",e._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",e._onPointerLockChange,!1)),e.enableOfflineSupport=void 0!==T.$.OfflineProviderFactory,e._deterministicLockstep=!!i.deterministicLockstep,e._lockstepMaxSteps=i.lockstepMaxSteps||0,e._timeStep=i.timeStep||1/60}(this,e,this._creationOptions)}resizeImageBitmap(e,t,i){return function(e,t,i,s){const r=e.createCanvas(i,s).getContext("2d");if(!r)throw new Error("Unable to get 2d context for resizeImageBitmap");return r.drawImage(t,0,0),r.getImageData(0,0,i,s).data}(this,e,t,i)}_createImageBitmapFromSource(e,t){return function(e,t,i){return new Promise(((s,r)=>{const n=new Image;n.onload=()=>{n.decode().then((()=>{e.createImageBitmap(n,i).then((e=>{s(e)}))}))},n.onerror=()=>{r(`Error loading image ${n.src}`)},n.src=t}))}(this,e,t)}switchFullscreen(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}enterFullscreen(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&function(e){const t=e.requestFullscreen||e.webkitRequestFullscreen;t&&t.call(e)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const e=document;document.exitFullscreen?document.exitFullscreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen()}()}setDitheringState(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(e,t,i,s){const r=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,s),r}scissorClear(e,t,i,s,r){this.enableScissor(e,t,i,s),this.clear(r,!0,!0,!0),this.disableScissor()}enableScissor(e,t,i,s){const r=this._gl;r.enable(r.SCISSOR_TEST),r.scissor(e,t,i,s)}disableScissor(){const e=this._gl;e.disable(e.SCISSOR_TEST)}_loadFileAsync(e,t,i){return new Promise(((s,r)=>{this._loadFile(e,(e=>{s(e)}),void 0,t,i,((e,t)=>{r(t)}))}))}getVertexShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null}getFragmentShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const e of this.scenes)e.resetCachedMaterial(),e._rebuildGeometries();for(const e of this._virtualScenes)e.resetCachedMaterial(),e._rebuildGeometries();super._rebuildBuffers()}getFontOffset(e){return function(e){const t=document.createElement("span");t.textContent="Hg",t.style.font=e;const i=document.createElement("div");i.style.display="inline-block",i.style.width="1px",i.style.height="0px",i.style.verticalAlign="bottom";const s=document.createElement("div");s.style.whiteSpace="nowrap",s.appendChild(t),s.appendChild(i),document.body.appendChild(s);let r=0,n=0;try{n=i.getBoundingClientRect().top-t.getBoundingClientRect().top,i.style.verticalAlign="baseline",r=i.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(s)}return{ascent:r,height:n,descent:n-r}}(e)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:e}=this.customAnimationFrameRequester;e&&e(this.customAnimationFrameRequester.requestID)}}else super._cancelFrame()}_renderLoop(e){this._processFrame(e),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&C(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}beginFrame(){this._measureFps(),super.beginFrame()}_deletePipelineContext(e){const t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),super._deletePipelineContext(e)}createShaderProgram(e,t,i,s,r,n=null){r=r||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const o=super.createShaderProgram(e,t,i,s,r,n);return this.onAfterShaderCompilationObservable.notifyObservers(this),o}_createShaderProgram(e,t,i,s,r=null){const n=s.createProgram();if(e.program=n,!n)throw new Error("Unable to create program");if(s.attachShader(n,t),s.attachShader(n,i),this.webGLVersion>1&&r){const t=this.createTransformFeedback();this.bindTransformFeedback(t),this.setTranformFeedbackVaryings(n,r),e.transformFeedback=t}return s.linkProgram(n),this.webGLVersion>1&&r&&this.bindTransformFeedback(null),e.context=s,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),n}_releaseTexture(e){super._releaseTexture(e)}_releaseRenderTargetWrapper(e){super._releaseRenderTargetWrapper(e),this.scenes.forEach((t=>{t.postProcesses.forEach((t=>{t._outputTexture===e&&(t._outputTexture=null)})),t.cameras.forEach((t=>{t._postProcesses.forEach((t=>{t&&t._outputTexture===e&&(t._outputTexture=null)}))}))}))}_rescaleTexture(e,t,i,s,r){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const n=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&R._RescalePostProcessFactory&&(this._rescalePostProcess=R._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const o=()=>{this._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};let o=i;o||(o=this.scenes[this.scenes.length-1]),o.postProcessManager.directRender([this._rescalePostProcess],n,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,s,0,0,t.width,t.height,0),this.unBindFramebuffer(n),n.dispose(),r&&r()},a=this._rescalePostProcess.getEffect();a?a.executeWhenCompiled(o):this._rescalePostProcess.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled(o)}))}}wrapWebGLTexture(e,t=!1,i=3,r=0,n=0){const o=new u.d(e,this._gl),a=new s.h(this,0,!0);return a._hardwareTexture=o,a.baseWidth=r,a.baseHeight=n,a.width=r,a.height=n,a.isReady=!0,a.useMipMaps=t,this.updateTextureSamplingMode(i,a),a}_uploadImageToTexture(e,t,i=0,s=0){const r=this._gl,n=this._getWebGLTextureType(e.type),o=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,o),h=e.isCube?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D;this._bindTextureDirectly(h,e,!0),this._unpackFlipY(e.invertY);let l=r.TEXTURE_2D;e.isCube&&(l=r.TEXTURE_CUBE_MAP_POSITIVE_X+i),r.texImage2D(l,s,a,o,n,t),this._bindTextureDirectly(h,null,!0)}updateTextureComparisonFunction(e,t){if(1===this.webGLVersion)return void c.V.Error("WebGL 1 does not support texture comparison.");const i=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}createInstancesBuffer(e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");const i=new l.A(t);return i.capacity=e,this.bindArrayBuffer(i),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),i.references=1,i}deleteInstancesBuffer(e){this._gl.deleteBuffer(e)}_clientWaitAsync(e,t=0,i=10){const s=this._gl;return new Promise(((r,n)=>{(0,E.F)((()=>{const i=s.clientWaitSync(e,t,0);if(i==s.WAIT_FAILED)throw new Error("clientWaitSync failed");return i!=s.TIMEOUT_EXPIRED}),r,n,i)}))}_readPixelsAsync(e,t,i,s,r,n,o){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const a=this._gl,h=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,h),a.bufferData(a.PIXEL_PACK_BUFFER,o.byteLength,a.STREAM_READ),a.readPixels(e,t,i,s,r,n,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);const l=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return l?(a.flush(),this._clientWaitAsync(l,0,10).then((()=>(a.deleteSync(l),a.bindBuffer(a.PIXEL_PACK_BUFFER,h),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,o),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(h),o)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(e,t){1===r.q.Instances.length&&T.$.audioEngine&&(T.$.audioEngine.dispose(),T.$.audioEngine=null);const i=e.getHostWindow();i&&"function"==typeof i.removeEventListener&&(i.removeEventListener("blur",e._onBlur),i.removeEventListener("focus",e._onFocus)),t&&(t.removeEventListener("focus",e._onCanvasFocus),t.removeEventListener("blur",e._onCanvasBlur),t.removeEventListener("pointerout",e._onCanvasPointerOut),t.removeEventListener("contextmenu",e._onCanvasContextMenu)),(0,A.Nf)()&&(document.removeEventListener("fullscreenchange",e._onFullscreenChange),document.removeEventListener("mozfullscreenchange",e._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",e._onFullscreenChange),document.removeEventListener("msfullscreenchange",e._onFullscreenChange),document.removeEventListener("pointerlockchange",e._onPointerLockChange),document.removeEventListener("mspointerlockchange",e._onPointerLockChange),document.removeEventListener("mozpointerlockchange",e._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",e._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}R.ALPHA_DISABLE=0,R.ALPHA_ADD=1,R.ALPHA_COMBINE=2,R.ALPHA_SUBTRACT=3,R.ALPHA_MULTIPLY=4,R.ALPHA_MAXIMIZED=5,R.ALPHA_ONEONE=6,R.ALPHA_PREMULTIPLIED=7,R.ALPHA_PREMULTIPLIED_PORTERDUFF=8,R.ALPHA_INTERPOLATE=9,R.ALPHA_SCREENMODE=10,R.DELAYLOADSTATE_NONE=0,R.DELAYLOADSTATE_LOADED=1,R.DELAYLOADSTATE_LOADING=2,R.DELAYLOADSTATE_NOTLOADED=4,R.NEVER=512,R.ALWAYS=519,R.LESS=513,R.EQUAL=514,R.LEQUAL=515,R.GREATER=516,R.GEQUAL=518,R.NOTEQUAL=517,R.KEEP=7680,R.REPLACE=7681,R.INCR=7682,R.DECR=7683,R.INVERT=5386,R.INCR_WRAP=34055,R.DECR_WRAP=34056,R.TEXTURE_CLAMP_ADDRESSMODE=0,R.TEXTURE_WRAP_ADDRESSMODE=1,R.TEXTURE_MIRROR_ADDRESSMODE=2,R.TEXTUREFORMAT_ALPHA=0,R.TEXTUREFORMAT_LUMINANCE=1,R.TEXTUREFORMAT_LUMINANCE_ALPHA=2,R.TEXTUREFORMAT_RGB=4,R.TEXTUREFORMAT_RGBA=5,R.TEXTUREFORMAT_RED=6,R.TEXTUREFORMAT_R=6,R.TEXTUREFORMAT_R16_UNORM=33322,R.TEXTUREFORMAT_RG16_UNORM=33324,R.TEXTUREFORMAT_RGB16_UNORM=32852,R.TEXTUREFORMAT_RGBA16_UNORM=32859,R.TEXTUREFORMAT_R16_SNORM=36760,R.TEXTUREFORMAT_RG16_SNORM=36761,R.TEXTUREFORMAT_RGB16_SNORM=36762,R.TEXTUREFORMAT_RGBA16_SNORM=36763,R.TEXTUREFORMAT_RG=7,R.TEXTUREFORMAT_RED_INTEGER=8,R.TEXTUREFORMAT_R_INTEGER=8,R.TEXTUREFORMAT_RG_INTEGER=9,R.TEXTUREFORMAT_RGB_INTEGER=10,R.TEXTUREFORMAT_RGBA_INTEGER=11,R.TEXTURETYPE_UNSIGNED_BYTE=0,R.TEXTURETYPE_UNSIGNED_INT=0,R.TEXTURETYPE_FLOAT=1,R.TEXTURETYPE_HALF_FLOAT=2,R.TEXTURETYPE_BYTE=3,R.TEXTURETYPE_SHORT=4,R.TEXTURETYPE_UNSIGNED_SHORT=5,R.TEXTURETYPE_INT=6,R.TEXTURETYPE_UNSIGNED_INTEGER=7,R.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,R.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,R.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,R.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,R.TEXTURETYPE_UNSIGNED_INT_24_8=12,R.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,R.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,R.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,R.TEXTURE_NEAREST_SAMPLINGMODE=1,R.TEXTURE_BILINEAR_SAMPLINGMODE=2,R.TEXTURE_TRILINEAR_SAMPLINGMODE=3,R.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,R.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,R.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,R.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,R.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,R.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,R.TEXTURE_NEAREST_LINEAR=7,R.TEXTURE_NEAREST_NEAREST=1,R.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,R.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,R.TEXTURE_LINEAR_LINEAR=2,R.TEXTURE_LINEAR_NEAREST=12,R.TEXTURE_EXPLICIT_MODE=0,R.TEXTURE_SPHERICAL_MODE=1,R.TEXTURE_PLANAR_MODE=2,R.TEXTURE_CUBIC_MODE=3,R.TEXTURE_PROJECTION_MODE=4,R.TEXTURE_SKYBOX_MODE=5,R.TEXTURE_INVCUBIC_MODE=6,R.TEXTURE_EQUIRECTANGULAR_MODE=7,R.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,R.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,R.SCALEMODE_FLOOR=1,R.SCALEMODE_NEAREST=2,R.SCALEMODE_CEILING=3},7329:(e,t,i)=>{"use strict";i.d(t,{w:()=>s});class s{constructor(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}}},7336:(e,t,i)=>{"use strict";i.d(t,{b:()=>d});var s=i(4754),r=i(4537),n=i(9732),o=i(4049),a=i(3113),h=i(35),l=i(5686),c=i(3054),u=i(979);i(1011);class d extends a.t{set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(o.uq.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(e,t,i){let s="";return e.forEach((e=>s+=e)),new d(s,t,null,i,e)}static CreateFromPrefilteredData(e,t,i=null,s=!0){const r=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;const n=new d(e,t,null,!1,null,null,null,void 0,!0,i,s);return t.useDelayedTextureLoading=r,n}constructor(e,t,i=null,s=!1,r=null,n=null,a=null,l=5,u=!1,d=null,_=!1,p=.8,g=0,f,m){super(t),this.onLoadObservable=new c.cP,this.boundingBoxPosition=o.Pq.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new o.uq,this._buffer=null,this.name=e,this.url=e,this._noMipmap=s,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=o.uq.Identity(),this.coordinatesMode=h.g.CUBIC_MODE;let b=null,v=null;null===i||Array.isArray(i)?(this._noMipmap=s,this._format=l,this._createPolynomials=_,b=i,this._loaderOptions=f,this._useSRGBBuffer=m,this._lodScale=p,this._lodOffset=g):(b=i.extensions??null,this._noMipmap=i.noMipmap??!1,r=i.files??null,v=i.buffer??null,this._format=i.format??5,u=i.prefiltered??!1,d=i.forcedExtension??null,this._createPolynomials=i.createPolynomials??!1,this._lodScale=i.lodScale??.8,this._lodOffset=i.lodOffset??0,this._loaderOptions=i.loaderOptions,this._useSRGBBuffer=i.useSRGBBuffer,n=i.onLoad??null,a=i.onError??null),(e||r)&&this.updateURL(e,d,n,u,a,b,this.getScene()?.useDelayedTextureLoading,r,v)}getClassName(){return"CubeTexture"}updateURL(e,t=null,i=null,s=!1,r=null,n=null,o=!1,a=null,h=null){this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,t&&(this._forcedExtension=t);const l=e.lastIndexOf("."),c=t||(l>-1?e.substring(l).toLowerCase():""),u=0===c.indexOf(".dds"),d=0===c.indexOf(".env"),_=0===c.indexOf(".basis");if(d?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=s,s&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),a)this._files=a;else if(_||d||u||n||(n=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,n){for(let t=0;t<n.length;t++)this._files.push(e+n[t]);this._extensions=n}this._buffer=h,o?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=r):this._loadTexture(i,r)}delayLoad(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){if(e.updateFlag===this._textureMatrix.updateFlag)return;if(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene()?.markAllMaterialsAsDirty(1,(e=>-1!==e.getActiveTextures().indexOf(this))),this._textureMatrix=e,!this.getScene()?.useRightHandedSystem)return;const t=o.AA.Vector3[0],i=o.AA.Quaternion[0],s=o.AA.Vector3[1];this._textureMatrix.decompose(t,i,s),i.z*=-1,i.w*=-1,o.uq.ComposeToRef(t,i,s,this._textureMatrixRefraction)}getRefractionTextureMatrix(){return this.getScene()?.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(e=null,t=null){const i=this.getScene(),s=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const r=()=>{this.onLoadObservable.notifyObservers(this),s&&(s.dispose(),this.getScene()?.markAllMaterialsAsDirty(1)),e&&e()},o=(e,i)=>{this._loadingError=!0,this._errorObject={message:e,exception:i},t&&t(e,i),h.g.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?n.S0.SetImmediate((()=>r())):this._texture.onLoadedObservable.add((()=>r())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,e,o,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,e,o,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),this._texture?.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(e,t,i){const s=u.p.Parse((()=>{let s=!1;return e.prefiltered&&(s=e.prefiltered),new d(i+(e.url??e.name),t,e.extensions,!1,e.files||null,null,null,void 0,s,e.forcedExtension)}),e,t);if(e.boundingBoxPosition&&(s.boundingBoxPosition=o.Pq.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(s.boundingBoxSize=o.Pq.FromArray(e.boundingBoxSize)),e.animations)for(let t=0;t<e.animations.length;t++){const i=e.animations[t],r=(0,l.n9)("BABYLON.Animation");r&&s.animations.push(r.Parse(i))}return s}clone(){let e=0;const t=u.p.Clone((()=>{const t=new d(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return e=t.uniqueId,t}),this);return t.uniqueId=e,t}}(0,s.Cg)([(0,r.lK)()],d.prototype,"url",void 0),(0,s.Cg)([(0,r.P_)()],d.prototype,"boundingBoxPosition",void 0),(0,s.Cg)([(0,r.P_)()],d.prototype,"boundingBoxSize",null),(0,s.Cg)([(0,r.lK)("rotationY")],d.prototype,"rotationY",null),(0,s.Cg)([(0,r.lK)("files")],d.prototype,"_files",void 0),(0,s.Cg)([(0,r.lK)("forcedExtension")],d.prototype,"_forcedExtension",void 0),(0,s.Cg)([(0,r.lK)("extensions")],d.prototype,"_extensions",void 0),(0,s.Cg)([(0,r.GG)("textureMatrix")],d.prototype,"_textureMatrix",void 0),(0,s.Cg)([(0,r.GG)("textureMatrixRefraction")],d.prototype,"_textureMatrixRefraction",void 0),h.g._CubeTextureParser=d.Parse,(0,l.Y5)("BABYLON.CubeTexture",d)},7472:(e,t,i)=>{var s;!function(){"use strict";var r=function(){this.init()};r.prototype={init:function(){var e=this||n;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||n;if(e=parseFloat(e),t.ctx||_(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,n.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var s=t._howls[i]._getSoundIds(),r=0;r<s.length;r++){var o=t._howls[i]._soundById(s[r]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||n;t.ctx||_(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,n.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var s=t._howls[i]._getSoundIds(),r=0;r<s.length;r++){var o=t._howls[i]._soundById(s[r]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},stop:function(){for(var e=this||n,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||n,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,_()),e},codecs:function(e){return(this||n)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||n;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||n,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var i=t.canPlayType("audio/mpeg;").replace(/^no$/,""),s=e._navigator?e._navigator.userAgent:"",r=s.match(/OPR\/(\d+)/g),o=r&&parseInt(r[0].split("/")[1],10)<33,a=-1!==s.indexOf("Safari")&&-1===s.indexOf("Chrome"),h=s.match(/Version\/(.*?) /),l=a&&h&&parseInt(h[1],10)<15;return e._codecs={mp3:!(o||!i&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(l||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(l||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||n;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(i){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var s=new Audio;s._unlocked=!0,e._releaseHtml5Audio(s)}catch(i){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var n=e._howls[r]._getSoundIds(),o=0;o<n.length;o++){var a=e._howls[r]._soundById(n[o]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var h=e.ctx.createBufferSource();h.buffer=e._scratchBuffer,h.connect(e.ctx.destination),void 0===h.start?h.noteOn(0):h.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),h.onended=function(){h.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var i=0;i<e._howls.length;i++)e._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||n;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||n;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&n.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var i=0;i<e._howls[t]._sounds.length;i++)if(!e._howls[t]._sounds[i]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&n.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var n=new r,o=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(e){var t=this;return n.ctx||_(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=n.usingWebAudio&&!t._html5,void 0!==n.ctx&&n.ctx&&n.autoUnlock&&n._unlockAudio(),n._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(n.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var i=0;i<e._src.length;i++){var s,r;if(e._format&&e._format[i])s=e._format[i];else{if("string"!=typeof(r=e._src[i])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(s=/^data:audio\/([^;,]+);/i.exec(r))||(s=/\.([^.]+)$/.exec(r.split("?",1)[0])),s&&(s=s[1].toLowerCase())}if(s||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),s&&n.codecs(s)){t=e._src[i];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&l(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var i=this,s=null;if("number"==typeof e)s=e,e=null;else{if("string"==typeof e&&"loaded"===i._state&&!i._sprite[e])return null;if(void 0===e&&(e="__default",!i._playLock)){for(var r=0,o=0;o<i._sounds.length;o++)i._sounds[o]._paused&&!i._sounds[o]._ended&&(r++,s=i._sounds[o]._id);1===r?e=null:s=null}}var a=s?i._soundById(s):i._inactiveSound();if(!a)return null;if(s&&!e&&(e=a._sprite||"__default"),"loaded"!==i._state){a._sprite=e,a._ended=!1;var h=a._id;return i._queue.push({event:"play",action:function(){i.play(h)}}),h}if(s&&!a._paused)return t||i._loadQueue("play"),a._id;i._webAudio&&n._autoResume();var l=Math.max(0,a._seek>0?a._seek:i._sprite[e][0]/1e3),c=Math.max(0,(i._sprite[e][0]+i._sprite[e][1])/1e3-l),u=1e3*c/Math.abs(a._rate),d=i._sprite[e][0]/1e3,_=(i._sprite[e][0]+i._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var p=function(){a._paused=!1,a._seek=l,a._start=d,a._stop=_,a._loop=!(!a._loop&&!i._sprite[e][2])};if(!(l>=_)){var g=a._node;if(i._webAudio){var f=function(){i._playLock=!1,p(),i._refreshBuffer(a);var e=a._muted||i._muted?0:a._volume;g.gain.setValueAtTime(e,n.ctx.currentTime),a._playStart=n.ctx.currentTime,void 0===g.bufferSource.start?a._loop?g.bufferSource.noteGrainOn(0,l,86400):g.bufferSource.noteGrainOn(0,l,c):a._loop?g.bufferSource.start(0,l,86400):g.bufferSource.start(0,l,c),u!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),u)),t||setTimeout((function(){i._emit("play",a._id),i._loadQueue()}),0)};"running"===n.state&&"interrupted"!==n.ctx.state?f():(i._playLock=!0,i.once("resume",f),i._clearTimer(a._id))}else{var m=function(){g.currentTime=l,g.muted=a._muted||i._muted||n._muted||g.muted,g.volume=a._volume*n.volume(),g.playbackRate=a._rate;try{var s=g.play();if(s&&"undefined"!=typeof Promise&&(s instanceof Promise||"function"==typeof s.then)?(i._playLock=!0,p(),s.then((function(){i._playLock=!1,g._unlocked=!0,t?i._loadQueue():i._emit("play",a._id)})).catch((function(){i._playLock=!1,i._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):t||(i._playLock=!1,p(),i._emit("play",a._id)),g.playbackRate=a._rate,g.paused)return void i._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),u):(i._endTimers[a._id]=function(){i._ended(a),g.removeEventListener("ended",i._endTimers[a._id],!1)},g.addEventListener("ended",i._endTimers[a._id],!1))}catch(e){i._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=i._src,g.load());var b=window&&window.ejecta||!g.readyState&&n._navigator.isCocoonJS;if(g.readyState>=3||b)m();else{i._playLock=!0,i._state="loading";var v=function(){i._state="loaded",m(),g.removeEventListener(n._canPlayEvent,v,!1)};g.addEventListener(n._canPlayEvent,v,!1),i._clearTimer(a._id)}}return a._id}i._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var i=t._getSoundIds(e),s=0;s<i.length;s++){t._clearTimer(i[s]);var r=t._soundById(i[s]);if(r&&!r._paused&&(r._seek=t.seek(i[s]),r._rateSeek=0,r._paused=!0,t._stopFade(i[s]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(e)}}),i;for(var s=i._getSoundIds(e),r=0;r<s.length;r++){i._clearTimer(s[r]);var n=i._soundById(s[r]);n&&(n._seek=n._start||0,n._rateSeek=0,n._paused=!0,n._ended=!0,i._stopFade(s[r]),n._node&&(i._webAudio?n._node.bufferSource&&(void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),i._cleanBuffer(n._node)):isNaN(n._node.duration)&&n._node.duration!==1/0||(n._node.currentTime=n._start||0,n._node.pause(),n._node.duration===1/0&&i._clearSound(n._node))),t||i._emit("stop",n._id))}return i},mute:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(e,t)}}),i;if(void 0===t){if("boolean"!=typeof e)return i._muted;i._muted=e}for(var s=i._getSoundIds(t),r=0;r<s.length;r++){var o=i._soundById(s[r]);o&&(o._muted=e,o._interval&&i._stopFade(o._id),i._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,n.ctx.currentTime):o._node&&(o._node.muted=!!n._muted||e),i._emit("mute",o._id))}return i},volume:function(){var e,t,i,s=this,r=arguments;if(0===r.length)return s._volume;if(1===r.length||2===r.length&&void 0===r[1]?s._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):e=parseFloat(r[0]):r.length>=2&&(e=parseFloat(r[0]),t=parseInt(r[1],10)),!(void 0!==e&&e>=0&&e<=1))return(i=t?s._soundById(t):s._sounds[0])?i._volume:0;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"volume",action:function(){s.volume.apply(s,r)}}),s;void 0===t&&(s._volume=e),t=s._getSoundIds(t);for(var o=0;o<t.length;o++)(i=s._soundById(t[o]))&&(i._volume=e,r[2]||s._stopFade(t[o]),s._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(e,n.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=e*n.volume()),s._emit("volume",i._id));return s},fade:function(e,t,i,s){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"fade",action:function(){r.fade(e,t,i,s)}}),r;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),i=parseFloat(i),r.volume(e,s);for(var o=r._getSoundIds(s),a=0;a<o.length;a++){var h=r._soundById(o[a]);if(h){if(s||r._stopFade(o[a]),r._webAudio&&!h._muted){var l=n.ctx.currentTime,c=l+i/1e3;h._volume=e,h._node.gain.setValueAtTime(e,l),h._node.gain.linearRampToValueAtTime(t,c)}r._startFadeInterval(h,e,t,i,o[a],void 0===s)}}return r},_startFadeInterval:function(e,t,i,s,r,n){var o=this,a=t,h=i-t,l=Math.abs(h/.01),c=Math.max(4,l>0?s/l:s),u=Date.now();e._fadeTo=i,e._interval=setInterval((function(){var r=(Date.now()-u)/s;u=Date.now(),a+=h*r,a=Math.round(100*a)/100,a=h<0?Math.max(i,a):Math.min(i,a),o._webAudio?e._volume=a:o.volume(a,e._id,!0),n&&(o._volume=a),(i<t&&a<=i||i>t&&a>=i)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(i,e._id),o._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this,i=t._soundById(e);return i&&i._interval&&(t._webAudio&&i._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(i._interval),i._interval=null,t.volume(i._fadeTo,e),i._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,i,s=this,r=arguments;if(0===r.length)return s._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(i=s._soundById(parseInt(r[0],10)))&&i._loop;e=r[0],s._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var n=s._getSoundIds(t),o=0;o<n.length;o++)(i=s._soundById(n[o]))&&(i._loop=e,s._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=e,e&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,s.playing(n[o])&&(s.pause(n[o],!0),s.play(n[o],!0)))));return s},rate:function(){var e,t,i,s=this,r=arguments;if(0===r.length?t=s._sounds[0]._id:1===r.length?s._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):e=parseFloat(r[0]):2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10)),"number"!=typeof e)return(i=s._soundById(t))?i._rate:s._rate;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"rate",action:function(){s.rate.apply(s,r)}}),s;void 0===t&&(s._rate=e),t=s._getSoundIds(t);for(var o=0;o<t.length;o++)if(i=s._soundById(t[o])){s.playing(t[o])&&(i._rateSeek=s.seek(t[o]),i._playStart=s._webAudio?n.ctx.currentTime:i._playStart),i._rate=e,s._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(e,n.ctx.currentTime):i._node&&(i._node.playbackRate=e);var a=s.seek(t[o]),h=1e3*((s._sprite[i._sprite][0]+s._sprite[i._sprite][1])/1e3-a)/Math.abs(i._rate);!s._endTimers[t[o]]&&i._paused||(s._clearTimer(t[o]),s._endTimers[t[o]]=setTimeout(s._ended.bind(s,i),h)),s._emit("rate",i._id)}return s},seek:function(){var e,t,i=this,s=arguments;if(0===s.length?i._sounds.length&&(t=i._sounds[0]._id):1===s.length?i._getSoundIds().indexOf(s[0])>=0?t=parseInt(s[0],10):i._sounds.length&&(t=i._sounds[0]._id,e=parseFloat(s[0])):2===s.length&&(e=parseFloat(s[0]),t=parseInt(s[1],10)),void 0===t)return 0;if("number"==typeof e&&("loaded"!==i._state||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,s)}}),i;var r=i._soundById(t);if(r){if(!("number"==typeof e&&e>=0)){if(i._webAudio){var o=i.playing(t)?n.ctx.currentTime-r._playStart:0,a=r._rateSeek?r._rateSeek-r._seek:0;return r._seek+(a+o*Math.abs(r._rate))}return r._node.currentTime}var h=i.playing(t);h&&i.pause(t,!0),r._seek=e,r._ended=!1,i._clearTimer(t),i._webAudio||!r._node||isNaN(r._node.duration)||(r._node.currentTime=e);var l=function(){h&&i.play(t,!0),i._emit("seek",t)};if(h&&!i._webAudio){var c=function(){i._playLock?setTimeout(c,0):l()};setTimeout(c,0)}else l()}return i},playing:function(e){var t=this;if("number"==typeof e){var i=t._soundById(e);return!!i&&!i._paused}for(var s=0;s<t._sounds.length;s++)if(!t._sounds[s]._paused)return!0;return!1},duration:function(e){var t=this,i=t._duration,s=t._soundById(e);return s&&(i=t._sprite[s._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,i=0;i<t.length;i++)t[i]._paused||e.stop(t[i]._id),e._webAudio||(e._clearSound(t[i]._node),t[i]._node.removeEventListener("error",t[i]._errorFn,!1),t[i]._node.removeEventListener(n._canPlayEvent,t[i]._loadFn,!1),t[i]._node.removeEventListener("ended",t[i]._endFn,!1),n._releaseHtml5Audio(t[i]._node)),delete t[i]._node,e._clearTimer(t[i]._id);var s=n._howls.indexOf(e);s>=0&&n._howls.splice(s,1);var r=!0;for(i=0;i<n._howls.length;i++)if(n._howls[i]._src===e._src||e._src.indexOf(n._howls[i]._src)>=0){r=!1;break}return h&&r&&delete h[e._src],n.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,i,s){var r=this["_on"+e];return"function"==typeof t&&r.push(s?{id:i,fn:t,once:s}:{id:i,fn:t}),this},off:function(e,t,i){var s=this,r=s["_on"+e],n=0;if("number"==typeof t&&(i=t,t=null),t||i)for(n=0;n<r.length;n++){var o=i===r[n].id;if(t===r[n].fn&&o||!t&&o){r.splice(n,1);break}}else if(e)s["_on"+e]=[];else{var a=Object.keys(s);for(n=0;n<a.length;n++)0===a[n].indexOf("_on")&&Array.isArray(s[a[n]])&&(s[a[n]]=[])}return s},once:function(e,t,i){return this.on(e,t,i,1),this},_emit:function(e,t,i){for(var s=this,r=s["_on"+e],n=r.length-1;n>=0;n--)r[n].id&&r[n].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,i)}.bind(s,r[n].fn),0),r[n].once&&s.off(e,r[n].fn,r[n].id));return s._loadQueue(e),s},_loadQueue:function(e){var t=this;if(t._queue.length>0){var i=t._queue[0];i.event===e&&(t._queue.shift(),t._loadQueue()),e||i.action()}return t},_ended:function(e){var t=this,i=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var s=!(!e._loop&&!t._sprite[i][2]);if(t._emit("end",e._id),!t._webAudio&&s&&t.stop(e._id,!0).play(e._id),t._webAudio&&s){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=n.ctx.currentTime;var r=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),r)}return t._webAudio&&!s&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),n._autoSuspend()),t._webAudio||s||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var i=t._soundById(e);i&&i._node&&i._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,i=0;i<t._sounds.length;i++)if(e===t._sounds[i]._id)return t._sounds[i];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new a(e)},_drain:function(){var e=this,t=e._pool,i=0,s=0;if(!(e._sounds.length<t)){for(s=0;s<e._sounds.length;s++)e._sounds[s]._ended&&i++;for(s=e._sounds.length-1;s>=0;s--){if(i<=t)return;e._sounds[s]._ended&&(e._webAudio&&e._sounds[s]._node&&e._sounds[s]._node.disconnect(0),e._sounds.splice(s,1),i--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],i=0;i<this._sounds.length;i++)t.push(this._sounds[i]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=h[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,n.ctx.currentTime),this},_cleanBuffer:function(e){var t=n._navigator&&n._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return this;if(n._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=n._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(n._navigator&&n._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,i=n._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),e._node.gain.setValueAtTime(i,n.ctx.currentTime),e._node.paused=!0,e._node.connect(n.masterGain)):n.noAudio||(e._node=n._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=i*n.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(n._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var h={},l=function(e){var t=e._src;if(h[t])return e._duration=h[t].duration,void d(e);if(/^data:[^;]+;base64,/.test(t)){for(var i=atob(t.split(",")[1]),s=new Uint8Array(i.length),r=0;r<i.length;++r)s[r]=i.charCodeAt(r);u(s.buffer,e)}else{var n=new XMLHttpRequest;n.open(e._xhr.method,t,!0),n.withCredentials=e._xhr.withCredentials,n.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){n.setRequestHeader(t,e._xhr.headers[t])})),n.onload=function(){var t=(n.status+"")[0];"0"===t||"2"===t||"3"===t?u(n.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+n.status+".")},n.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete h[t],e.load())},c(n)}},c=function(e){try{e.send()}catch(t){e.onerror()}},u=function(e,t){var i=function(){t._emit("loaderror",null,"Decoding audio data failed.")},s=function(e){e&&t._sounds.length>0?(h[t._src]=e,d(t,e)):i()};"undefined"!=typeof Promise&&1===n.ctx.decodeAudioData.length?n.ctx.decodeAudioData(e).then(s).catch(i):n.ctx.decodeAudioData(e,s,i)},d=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},_=function(){if(n.usingWebAudio){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(e){n.usingWebAudio=!1}n.ctx||(n.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),t=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=t?parseInt(t[1],10):null;if(e&&i&&i<9){var s=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());n._navigator&&!s&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.setValueAtTime(n._muted?0:n._volume,n.ctx.currentTime),n.masterGain.connect(n.ctx.destination)),n._setup()}};void 0===(s=function(){return{Howler:n,Howl:o}}.apply(t,[]))||(e.exports=s),t.Howler=n,t.Howl=o,void 0!==i.g?(i.g.HowlerGlobal=r,i.g.Howler=n,i.g.Howl=o,i.g.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=r,window.Howler=n,window.Howl=o,window.Sound=a)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var i=t._howls.length-1;i>=0;i--)t._howls[i].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,i){var s=this;return s.ctx&&s.ctx.listener?(t="number"!=typeof t?s._pos[1]:t,i="number"!=typeof i?s._pos[2]:i,"number"!=typeof e?s._pos:(s._pos=[e,t,i],void 0!==s.ctx.listener.positionX?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]),s)):s},HowlerGlobal.prototype.orientation=function(e,t,i,s,r,n){var o=this;if(!o.ctx||!o.ctx.listener)return o;var a=o._orientation;return t="number"!=typeof t?a[1]:t,i="number"!=typeof i?a[2]:i,s="number"!=typeof s?a[3]:s,r="number"!=typeof r?a[4]:r,n="number"!=typeof n?a[5]:n,"number"!=typeof e?a:(o._orientation=[e,t,i,s,r,n],void 0!==o.ctx.listener.forwardX?(o.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(n,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(e,t,i,s,r,n),o)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var i=this;return i._orientation=t.orientation||[1,0,0],i._stereo=t.stereo||null,i._pos=t.pos||null,i._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},i._onstereo=t.onstereo?[{fn:t.onstereo}]:[],i._onpos=t.onpos?[{fn:t.onpos}]:[],i._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,i){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"stereo",action:function(){s.stereo(e,i)}}),s;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0]}for(var n=s._getSoundIds(i),o=0;o<n.length;o++){var a=s._soundById(n[o]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,r),"spatial"===r?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),s._emit("stereo",a._id)}}return s},Howl.prototype.pos=function(e,i,s,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"pos",action:function(){n.pos(e,i,s,r)}}),n;if(i="number"!=typeof i?0:i,s="number"!=typeof s?-.5:s,void 0===r){if("number"!=typeof e)return n._pos;n._pos=[e,i,s]}for(var o=n._getSoundIds(r),a=0;a<o.length;a++){var h=n._soundById(o[a]);if(h){if("number"!=typeof e)return h._pos;h._pos=[e,i,s],h._node&&(h._panner&&!h._panner.pan||t(h,"spatial"),void 0!==h._panner.positionX?(h._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setPosition(e,i,s)),n._emit("pos",h._id)}}return n},Howl.prototype.orientation=function(e,i,s,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"orientation",action:function(){n.orientation(e,i,s,r)}}),n;if(i="number"!=typeof i?n._orientation[1]:i,s="number"!=typeof s?n._orientation[2]:s,void 0===r){if("number"!=typeof e)return n._orientation;n._orientation=[e,i,s]}for(var o=n._getSoundIds(r),a=0;a<o.length;a++){var h=n._soundById(o[a]);if(h){if("number"!=typeof e)return h._orientation;h._orientation=[e,i,s],h._node&&(h._panner||(h._pos||(h._pos=n._pos||[0,0,-.5]),t(h,"spatial")),void 0!==h._panner.orientationX?(h._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setOrientation(e,i,s)),n._emit("orientation",h._id)}}return n},Howl.prototype.pannerAttr=function(){var e,i,s,r=this,n=arguments;if(!r._webAudio)return r;if(0===n.length)return r._pannerAttr;if(1===n.length){if("object"!=typeof n[0])return(s=r._soundById(parseInt(n[0],10)))?s._pannerAttr:r._pannerAttr;e=n[0],void 0===i&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:r._panningModel})}else 2===n.length&&(e=n[0],i=parseInt(n[1],10));for(var o=r._getSoundIds(i),a=0;a<o.length;a++)if(s=r._soundById(o[a])){var h=s._pannerAttr;h={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:h.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:h.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:h.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:h.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:h.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:h.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:h.panningModel};var l=s._panner;l||(s._pos||(s._pos=r._pos||[0,0,-.5]),t(s,"spatial"),l=s._panner),l.coneInnerAngle=h.coneInnerAngle,l.coneOuterAngle=h.coneOuterAngle,l.coneOuterGain=h.coneOuterGain,l.distanceModel=h.distanceModel,l.maxDistance=h.maxDistance,l.refDistance=h.refDistance,l.rolloffFactor=h.rolloffFactor,l.panningModel=h.panningModel}return r},Sound.prototype.init=function(e){return function(){var t=this,i=t._parent;t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,e.call(this),t._stereo?i.stereo(t._stereo):t._pos&&i.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,i=t._parent;return t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,t._stereo?i.stereo(t._stereo):t._pos?i.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,i._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()},7473:(e,t,i)=>{"use strict";i.d(t,{D:()=>r});var s=i(4049);class r{static ConvertPanoramaToCubemap(e,t,i,s,r=!1){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=t*i*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(s,this.FACE_FRONT,e,t,i,r),back:this.CreateCubemapTexture(s,this.FACE_BACK,e,t,i,r),left:this.CreateCubemapTexture(s,this.FACE_LEFT,e,t,i,r),right:this.CreateCubemapTexture(s,this.FACE_RIGHT,e,t,i,r),up:this.CreateCubemapTexture(s,this.FACE_UP,e,t,i,r),down:this.CreateCubemapTexture(s,this.FACE_DOWN,e,t,i,r),size:s,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(e,t,i,s,r,n=!1){const o=new ArrayBuffer(e*e*4*3),a=new Float32Array(o),h=n?Math.max(1,Math.round(s/4/e)):1,l=1/h,c=l*l,u=t[1].subtract(t[0]).scale(l/e),d=t[3].subtract(t[2]).scale(l/e),_=1/e;let p=0;for(let n=0;n<e;n++)for(let o=0;o<h;o++){let o=t[0],g=t[2];for(let t=0;t<e;t++)for(let l=0;l<h;l++){const h=g.subtract(o).scale(p).add(o);h.normalize();const l=this.CalcProjectionSpherical(h,i,s,r);a[n*e*3+3*t+0]+=l.r*c,a[n*e*3+3*t+1]+=l.g*c,a[n*e*3+3*t+2]+=l.b*c,o=o.add(u),g=g.add(d)}p+=_*l}return a}static CalcProjectionSpherical(e,t,i,s){let r=Math.atan2(e.z,e.x);const n=Math.acos(e.y);for(;r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;let o=r/Math.PI;const a=n/Math.PI;o=.5*o+.5;let h=Math.round(o*i);h<0?h=0:h>=i&&(h=i-1);let l=Math.round(a*s);l<0?l=0:l>=s&&(l=s-1);const c=s-l-1;return{r:t[c*i*3+3*h+0],g:t[c*i*3+3*h+1],b:t[c*i*3+3*h+2]}}}r.FACE_LEFT=[new s.Pq(-1,-1,-1),new s.Pq(1,-1,-1),new s.Pq(-1,1,-1),new s.Pq(1,1,-1)],r.FACE_RIGHT=[new s.Pq(1,-1,1),new s.Pq(-1,-1,1),new s.Pq(1,1,1),new s.Pq(-1,1,1)],r.FACE_FRONT=[new s.Pq(1,-1,-1),new s.Pq(1,-1,1),new s.Pq(1,1,-1),new s.Pq(1,1,1)],r.FACE_BACK=[new s.Pq(-1,-1,1),new s.Pq(-1,-1,-1),new s.Pq(-1,1,1),new s.Pq(-1,1,-1)],r.FACE_DOWN=[new s.Pq(1,1,-1),new s.Pq(1,1,1),new s.Pq(-1,1,-1),new s.Pq(-1,1,1)],r.FACE_UP=[new s.Pq(-1,-1,-1),new s.Pq(-1,-1,1),new s.Pq(1,-1,-1),new s.Pq(1,-1,1)]},7484:(e,t,i)=>{"use strict";i.d(t,{i:()=>n});var s=i(959),r=i(4049);class n{constructor(e,t,i){this.center=r.Pq.Zero(),this.centerWorld=r.Pq.Zero(),this.minimum=r.Pq.Zero(),this.maximum=r.Pq.Zero(),this.reConstruct(e,t,i)}reConstruct(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);const s=r.Pq.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*s,this._update(i||r.uq.IdentityReadOnly)}scale(e){const t=this.radius*e,i=n._TmpVector3,s=i[0].setAll(t),r=this.center.subtractToRef(s,i[1]),o=this.center.addToRef(s,i[2]);return this.reConstruct(r,o,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{r.Pq.TransformCoordinatesToRef(this.center,e,this.centerWorld);const t=n._TmpVector3[0];r.Pq.TransformNormalFromFloatsToRef(1,1,1,e,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius}}isInFrustum(e){const t=this.centerWorld,i=this.radiusWorld;for(let s=0;s<6;s++)if(e[s].dotCoordinate(t)<=-i)return!1;return!0}isCenterInFrustum(e){const t=this.centerWorld;for(let i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0}intersectsPoint(e){const t=r.Pq.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}static Intersects(e,t){const i=r.Pq.DistanceSquared(e.centerWorld,t.centerWorld),s=e.radiusWorld+t.radiusWorld;return!(s*s<i)}static CreateFromCenterAndRadius(e,t,i){this._TmpVector3[0].copyFrom(e),this._TmpVector3[1].copyFromFloats(0,0,t),this._TmpVector3[2].copyFrom(e),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const s=new n(this._TmpVector3[0],this._TmpVector3[2]);return s._worldMatrix=i||r.uq.Identity(),s}}n._TmpVector3=(0,s.mI)(3,r.Pq.Zero)},7539:e=>{"use strict";var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}e.exports=t},7634:(e,t,i)=>{"use strict";function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}i.d(t,{z:()=>s})},7638:(e,t,i)=>{"use strict";i.d(t,{E:()=>n});var s=i(4049),r=i(4564);class n extends r.i{constructor(e,t,i=!0,r=!1){super(e,t,void 0,r),this._normalMatrix=new s.uq,this._storeEffectOnSubMeshes=i}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(e,t){return!!e&&(!this._storeEffectOnSubMeshes||!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t))}_isReadyForSubMesh(e){const t=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!t||t._renderId!==this.getScene().getRenderId())}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindOnlyNormalMatrix(e){this._activeEffect.setMatrix("normalMatrix",e)}bind(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])}_afterBind(e,t=null,i){super._afterBind(e,t,i),this.getScene()._cachedEffect=t,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(e,t,i,s=1){return i._drawWrapper._forceRebindOnNextCall||e.isCachedMaterialInvalid(this,t,s)}dispose(e,t,i){this._activeEffect=void 0,super.dispose(e,t,i)}}},7761:(e,t,i)=>{"use strict";i.d(t,{a6:()=>n,bH:()=>o,rv:()=>s,tk:()=>r});const s=1/2.2,r=2.2,n=(1+Math.sqrt(5))/2,o=.001},7893:(e,t,i)=>{"use strict";i.d(t,{D:()=>n});var s=i(3039),r=i(9732);class n{constructor(e,t,i,s,r=!1){this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||r,this._dynamic=i,this._name=s??"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(e){let t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){const e=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;const i=this._uniformLocationPointer-e;for(let e=0;e<i;e++)this._data.push(0)}}addUniform(e,t,i=0){if(this._noUBO)return;if(void 0!==this._uniformLocations[e])return;let s;if(i>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:i},16==t?t*=i:t=t*i+(4-t)*i,s=[];for(let e=0;e<t;e++)s.push(0)}else{if(t instanceof Array)s=t,t=s.length;else{s=[];for(let e=0;e<t;e++)s.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(let e=0;e<t;e++)this._data.push(s[e]);this._needSync=!0}addMatrix(e,t){this.addUniform(e,Array.prototype.slice.call(t.asArray()))}addFloat2(e,t,i){const s=[t,i];this.addUniform(e,s)}addFloat3(e,t,i,s){const r=[t,i,s];this.addUniform(e,r)}addColor3(e,t){const i=[t.r,t.g,t.b];this.addUniform(e,i)}addColor4(e,t,i){const s=[t.r,t.g,t.b,i];this.addUniform(e,s)}addVector3(e,t){const i=[t.x,t.y,t.z];this.addUniform(e,i)}addMatrix3x3(e){this.addUniform(e,12)}addMatrix2x2(e){this.addUniform(e,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const e=[];let t=0;for(const i in this._uniformLocations)if(e.push(i),10==++t)break;return e.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(e,t){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}_copyBuffer(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(n._UpdatedUbosInFrame[this._name]||(n._UpdatedUbosInFrame[this._name]=0),n._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(e,t,i){this._checkNewFrame();let r=this._uniformLocations[e];if(void 0===r){if(this._buffer)return void s.V.Error("Cannot add an uniform after UBO has been created. uniformName="+e);this.addUniform(e,i),r=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(let e=0;e<i;e++)this._bufferData[r+e]=t[e];else{let e=!1;for(let s=0;s<i;s++)(16===i&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[r+s]!==Math.fround(t[s]))&&(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[r+s]=t[s]);this._needSync=this._needSync||e}}updateUniformArray(e,t,i){this._checkNewFrame();const n=this._uniformLocations[e];if(void 0===n)return void s.V.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const o=this._uniformArraySizes[e];if(this._dynamic)for(let e=0;e<i;e++)this._bufferData[n+e]=t[e];else{let e=!1,s=0,a=0;for(let h=0;h<i;h++)if(this._bufferData[n+4*a+s]!==r.S0.FloatRound(t[h])&&(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[n+4*a+s]=t[h]),s++,s===o.strideSize){for(;s<4;s++)this._bufferData[n+4*a+s]=0;s=0,a++}this._needSync=this._needSync||e}}_cacheMatrix(e,t){this._checkNewFrame();const i=this._valueCache[e],s=t.updateFlag;return(void 0===i||i!==s)&&(this._valueCache[e]=s,!0)}_updateMatrix3x3ForUniform(e,t){for(let e=0;e<3;e++)n._TempBuffer[4*e]=t[3*e],n._TempBuffer[4*e+1]=t[3*e+1],n._TempBuffer[4*e+2]=t[3*e+2],n._TempBuffer[4*e+3]=0;this.updateUniform(e,n._TempBuffer,12)}_updateMatrix3x3ForEffect(e,t){this._currentEffect.setMatrix3x3(e,t)}_updateMatrix2x2ForEffect(e,t){this._currentEffect.setMatrix2x2(e,t)}_updateMatrix2x2ForUniform(e,t){for(let e=0;e<2;e++)n._TempBuffer[4*e]=t[2*e],n._TempBuffer[4*e+1]=t[2*e+1],n._TempBuffer[4*e+2]=0,n._TempBuffer[4*e+3]=0;this.updateUniform(e,n._TempBuffer,8)}_updateFloatForEffect(e,t){this._currentEffect.setFloat(e,t)}_updateFloatForUniform(e,t){n._TempBuffer[0]=t,this.updateUniform(e,n._TempBuffer,1)}_updateFloat2ForEffect(e,t,i,s=""){this._currentEffect.setFloat2(e+s,t,i)}_updateFloat2ForUniform(e,t,i){n._TempBuffer[0]=t,n._TempBuffer[1]=i,this.updateUniform(e,n._TempBuffer,2)}_updateFloat3ForEffect(e,t,i,s,r=""){this._currentEffect.setFloat3(e+r,t,i,s)}_updateFloat3ForUniform(e,t,i,s){n._TempBuffer[0]=t,n._TempBuffer[1]=i,n._TempBuffer[2]=s,this.updateUniform(e,n._TempBuffer,3)}_updateFloat4ForEffect(e,t,i,s,r,n=""){this._currentEffect.setFloat4(e+n,t,i,s,r)}_updateFloat4ForUniform(e,t,i,s,r){n._TempBuffer[0]=t,n._TempBuffer[1]=i,n._TempBuffer[2]=s,n._TempBuffer[3]=r,this.updateUniform(e,n._TempBuffer,4)}_updateFloatArrayForEffect(e,t){this._currentEffect.setFloatArray(e,t)}_updateFloatArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateArrayForEffect(e,t){this._currentEffect.setArray(e,t)}_updateArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateIntArrayForEffect(e,t){this._currentEffect.setIntArray(e,t)}_updateIntArrayForUniform(e,t){n._TempBufferInt32View.set(t),this.updateUniformArray(e,n._TempBuffer,t.length)}_updateUIntArrayForEffect(e,t){this._currentEffect.setUIntArray(e,t)}_updateUIntArrayForUniform(e,t){n._TempBufferUInt32View.set(t),this.updateUniformArray(e,n._TempBuffer,t.length)}_updateMatrixForEffect(e,t){this._currentEffect.setMatrix(e,t)}_updateMatrixForUniform(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.asArray(),16)}_updateMatricesForEffect(e,t){this._currentEffect.setMatrices(e,t)}_updateMatricesForUniform(e,t){this.updateUniform(e,t,t.length)}_updateVector3ForEffect(e,t){this._currentEffect.setVector3(e,t)}_updateVector3ForUniform(e,t){n._TempBuffer[0]=t.x,n._TempBuffer[1]=t.y,n._TempBuffer[2]=t.z,this.updateUniform(e,n._TempBuffer,3)}_updateVector4ForEffect(e,t){this._currentEffect.setVector4(e,t)}_updateVector4ForUniform(e,t){n._TempBuffer[0]=t.x,n._TempBuffer[1]=t.y,n._TempBuffer[2]=t.z,n._TempBuffer[3]=t.w,this.updateUniform(e,n._TempBuffer,4)}_updateColor3ForEffect(e,t,i=""){this._currentEffect.setColor3(e+i,t)}_updateColor3ForUniform(e,t){n._TempBuffer[0]=t.r,n._TempBuffer[1]=t.g,n._TempBuffer[2]=t.b,this.updateUniform(e,n._TempBuffer,3)}_updateColor4ForEffect(e,t,i,s=""){this._currentEffect.setColor4(e+s,t,i)}_updateDirectColor4ForEffect(e,t,i=""){this._currentEffect.setDirectColor4(e+i,t)}_updateColor4ForUniform(e,t,i){n._TempBuffer[0]=t.r,n._TempBuffer[1]=t.g,n._TempBuffer[2]=t.b,n._TempBuffer[3]=i,this.updateUniform(e,n._TempBuffer,4)}_updateDirectColor4ForUniform(e,t){n._TempBuffer[0]=t.r,n._TempBuffer[1]=t.g,n._TempBuffer[2]=t.b,n._TempBuffer[3]=t.a,this.updateUniform(e,n._TempBuffer,4)}_updateIntForEffect(e,t,i=""){this._currentEffect.setInt(e+i,t)}_updateIntForUniform(e,t){n._TempBufferInt32View[0]=t,this.updateUniform(e,n._TempBuffer,1)}_updateInt2ForEffect(e,t,i,s=""){this._currentEffect.setInt2(e+s,t,i)}_updateInt2ForUniform(e,t,i){n._TempBufferInt32View[0]=t,n._TempBufferInt32View[1]=i,this.updateUniform(e,n._TempBuffer,2)}_updateInt3ForEffect(e,t,i,s,r=""){this._currentEffect.setInt3(e+r,t,i,s)}_updateInt3ForUniform(e,t,i,s){n._TempBufferInt32View[0]=t,n._TempBufferInt32View[1]=i,n._TempBufferInt32View[2]=s,this.updateUniform(e,n._TempBuffer,3)}_updateInt4ForEffect(e,t,i,s,r,n=""){this._currentEffect.setInt4(e+n,t,i,s,r)}_updateInt4ForUniform(e,t,i,s,r){n._TempBufferInt32View[0]=t,n._TempBufferInt32View[1]=i,n._TempBufferInt32View[2]=s,n._TempBufferInt32View[3]=r,this.updateUniform(e,n._TempBuffer,4)}_updateUIntForEffect(e,t,i=""){this._currentEffect.setUInt(e+i,t)}_updateUIntForUniform(e,t){n._TempBufferUInt32View[0]=t,this.updateUniform(e,n._TempBuffer,1)}_updateUInt2ForEffect(e,t,i,s=""){this._currentEffect.setUInt2(e+s,t,i)}_updateUInt2ForUniform(e,t,i){n._TempBufferUInt32View[0]=t,n._TempBufferUInt32View[1]=i,this.updateUniform(e,n._TempBuffer,2)}_updateUInt3ForEffect(e,t,i,s,r=""){this._currentEffect.setUInt3(e+r,t,i,s)}_updateUInt3ForUniform(e,t,i,s){n._TempBufferUInt32View[0]=t,n._TempBufferUInt32View[1]=i,n._TempBufferUInt32View[2]=s,this.updateUniform(e,n._TempBuffer,3)}_updateUInt4ForEffect(e,t,i,s,r,n=""){this._currentEffect.setUInt4(e+n,t,i,s,r)}_updateUInt4ForUniform(e,t,i,s,r){n._TempBufferUInt32View[0]=t,n._TempBufferUInt32View[1]=i,n._TempBufferUInt32View[2]=s,n._TempBufferUInt32View[3]=r,this.updateUniform(e,n._TempBuffer,4)}setTexture(e,t){this._currentEffect.setTexture(e,t)}setTextureArray(e,t){this._currentEffect.setTextureArray(e,t)}bindTexture(e,t){this._currentEffect._bindTexture(e,t)}updateUniformDirectly(e,t){this.updateUniform(e,t,t.length),this.update()}bindToEffect(e,t){this._currentEffect=e,this._currentEffectName=t}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(e){if(!this._buffers)return this._buffer===e;for(let t=0;t<this._buffers.length;++t)if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0;return!1}dispose(){if(this._noUBO)return;const e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let e=0;e<this._buffers.length;++e){const t=this._buffers[e][0];this._engine._releaseBuffer(t)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}n._UpdatedUbosInFrame={},n._MAX_UNIFORM_SIZE=256,n._TempBuffer=new Float32Array(n._MAX_UNIFORM_SIZE),n._TempBufferInt32View=new Int32Array(n._TempBuffer.buffer),n._TempBufferUInt32View=new Uint32Array(n._TempBuffer.buffer)},7904:(e,t,i)=>{"use strict";i.d(t,{Bu:()=>n,TB:()=>s,W0:()=>r});class s{}s.KEYDOWN=1,s.KEYUP=2;class r{constructor(e,t){this.type=e,this.event=t}}class n extends r{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(e){this.skipOnKeyboardObservable=e}constructor(e,t){super(e,t),this.type=e,this.event=t,this.skipOnKeyboardObservable=!1}}},7960:e=>{"use strict";e.exports=Object},7963:e=>{"use strict";e.exports={}},8042:(e,t,i)=>{"use strict";function s(e){-1===e.indexOf("vClipPlane")&&e.push("vClipPlane"),-1===e.indexOf("vClipPlane2")&&e.push("vClipPlane2"),-1===e.indexOf("vClipPlane3")&&e.push("vClipPlane3"),-1===e.indexOf("vClipPlane4")&&e.push("vClipPlane4"),-1===e.indexOf("vClipPlane5")&&e.push("vClipPlane5"),-1===e.indexOf("vClipPlane6")&&e.push("vClipPlane6")}function r(e,t,i){const s=!!(e.clipPlane??t.clipPlane),r=!!(e.clipPlane2??t.clipPlane2),n=!!(e.clipPlane3??t.clipPlane3),o=!!(e.clipPlane4??t.clipPlane4),a=!!(e.clipPlane5??t.clipPlane5),h=!!(e.clipPlane6??t.clipPlane6);s&&i.push("#define CLIPPLANE"),r&&i.push("#define CLIPPLANE2"),n&&i.push("#define CLIPPLANE3"),o&&i.push("#define CLIPPLANE4"),a&&i.push("#define CLIPPLANE5"),h&&i.push("#define CLIPPLANE6")}function n(e,t,i){let s=!1;const r=!!(e.clipPlane??t.clipPlane),n=!!(e.clipPlane2??t.clipPlane2),o=!!(e.clipPlane3??t.clipPlane3),a=!!(e.clipPlane4??t.clipPlane4),h=!!(e.clipPlane5??t.clipPlane5),l=!!(e.clipPlane6??t.clipPlane6);return i.CLIPPLANE!==r&&(i.CLIPPLANE=r,s=!0),i.CLIPPLANE2!==n&&(i.CLIPPLANE2=n,s=!0),i.CLIPPLANE3!==o&&(i.CLIPPLANE3=o,s=!0),i.CLIPPLANE4!==a&&(i.CLIPPLANE4=a,s=!0),i.CLIPPLANE5!==h&&(i.CLIPPLANE5=h,s=!0),i.CLIPPLANE6!==l&&(i.CLIPPLANE6=l,s=!0),s}function o(e,t,i){let s=t.clipPlane??i.clipPlane;a(e,"vClipPlane",s),s=t.clipPlane2??i.clipPlane2,a(e,"vClipPlane2",s),s=t.clipPlane3??i.clipPlane3,a(e,"vClipPlane3",s),s=t.clipPlane4??i.clipPlane4,a(e,"vClipPlane4",s),s=t.clipPlane5??i.clipPlane5,a(e,"vClipPlane5",s),s=t.clipPlane6??i.clipPlane6,a(e,"vClipPlane6",s)}function a(e,t,i){i&&e.setFloat4(t,i.normal.x,i.normal.y,i.normal.z,i.d)}i.d(t,{Eq:()=>n,TV:()=>s,gS:()=>o,tv:()=>r})},8058:(e,t,i)=>{"use strict";i.d(t,{W:()=>s});const s={name:"stl",extensions:{".stl":{isBinary:!0}}}},8158:(e,t,i)=>{"use strict";i.d(t,{$:()=>o});var s=i(4049),r=i(959),n=i(4292);class o extends n.b{get _matrix(){return this._compose(),this._localMatrix}set _matrix(e){(e.updateFlag!==this._localMatrix.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose())}constructor(e,t,i=null,r=null,n=null,o=null,a=null){super(e,t.getScene(),!1),this.name=e,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=t,this._localMatrix=r?.clone()??s.uq.Identity(),this._restMatrix=n??this._localMatrix.clone(),this._bindMatrix=o??this._localMatrix.clone(),this._index=a,this._absoluteMatrix=new s.uq,this._absoluteBindMatrix=new s.uq,this._absoluteInverseBindMatrix=new s.uq,this._finalMatrix=new s.uq,t.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(e){this.setParent(e)}setParent(e,t=!0){if(this.parent!==e){if(this.parent){const e=this.parent.children.indexOf(this);-1!==e&&this.parent.children.splice(e,1)}this._parentNode=e,this.parent&&this.parent.children.push(this),t&&this._updateAbsoluteBindMatrices(),this.markAsDirty()}}getLocalMatrix(){return this._compose(),this._localMatrix}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(e){this._restMatrix.copyFrom(e)}setRestPose(e){this.setRestMatrix(e)}getBindPose(){return this.getBindMatrix()}setBindMatrix(e){this.updateMatrix(e)}setBindPose(e){this.setBindMatrix(e)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const e=s.AA.Vector3[0],t=s.AA.Quaternion[0],i=s.AA.Vector3[1];this.getRestMatrix().decompose(e,t,i),this._linkedTransformNode.position.copyFrom(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??s.PT.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(t),this._linkedTransformNode.scaling.copyFrom(e)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this._localPosition}set position(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(e){this.setRotation(e)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(e){this.setRotationQuaternion(e)}get scaling(){return this.getScale()}set scaling(e){this.setScale(e)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=s.Pq.Zero(),this._localRotation=s.PT.Zero(),this._localPosition=s.Pq.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,s.uq.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)}updateMatrix(e,t=!0,i=!0){this._bindMatrix.copyFrom(e),t&&this._updateAbsoluteBindMatrices(),i?this._matrix=e:this.markAsDirty()}_updateAbsoluteBindMatrices(e,t=!0){if(e||(e=this._bindMatrix),this.parent?e.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.copyFrom(e),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),t)for(let e=0;e<this.children.length;e++)this.children[e]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}markAsDirty(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.markAsDirty(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.markAsDirty(),this._needToDecompose=!0}_updatePosition(e,t=0,i,r=!0){const n=this.getLocalMatrix();if(0==t)r?(n.addAtIndex(12,e.x),n.addAtIndex(13,e.y),n.addAtIndex(14,e.z)):n.setTranslationFromFloats(e.x,e.y,e.z);else{let t=null;i&&(t=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=o._TmpMats[0],h=o._TmpVecs[0];this.parent?i&&t?(a.copyFrom(this.parent.getAbsoluteMatrix()),a.multiplyToRef(t,a)):a.copyFrom(this.parent.getAbsoluteMatrix()):s.uq.IdentityToRef(a),r&&a.setTranslationFromFloats(0,0,0),a.invert(),s.Pq.TransformCoordinatesToRef(e,a,h),r?(n.addAtIndex(12,h.x),n.addAtIndex(13,h.y),n.addAtIndex(14,h.z)):n.setTranslationFromFloats(h.x,h.y,h.z)}this._markAsDirtyAndDecompose()}translate(e,t=0,i){this._updatePosition(e,t,i,!0)}setPosition(e,t=0,i){this._updatePosition(e,t,i,!1)}setAbsolutePosition(e,t){this.setPosition(e,1,t)}scale(e,t,i,r=!1){const n=this.getLocalMatrix(),a=o._TmpMats[0];s.uq.ScalingToRef(e,t,i,a),a.multiplyToRef(n,n),a.invert();for(const s of this.children){const r=s.getLocalMatrix();r.multiplyToRef(a,r),r.multiplyAtIndex(12,e),r.multiplyAtIndex(13,t),r.multiplyAtIndex(14,i),s._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(const s of this.children)s.scale(e,t,i,r)}setScale(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(e){this._decompose(),e.copyFrom(this._localScaling)}setYawPitchRoll(e,t,i,r=0,n){if(0===r){const a=o._TmpQuat;return s.PT.RotationYawPitchRollToRef(e,t,i,a),void this.setRotationQuaternion(a,r,n)}const a=o._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,n))return;const h=o._TmpMats[1];s.uq.RotationYawPitchRollToRef(e,t,i,h),a.multiplyToRef(h,h),this._rotateWithMatrix(h,r,n)}rotate(e,t,i=0,r){const n=o._TmpMats[0];n.setTranslationFromFloats(0,0,0),s.uq.RotationAxisToRef(e,t,n),this._rotateWithMatrix(n,i,r)}setAxisAngle(e,t,i=0,r){if(0===i){const n=o._TmpQuat;return s.PT.RotationAxisToRef(e,t,n),void this.setRotationQuaternion(n,i,r)}const n=o._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,r))return;const a=o._TmpMats[1];s.uq.RotationAxisToRef(e,t,a),n.multiplyToRef(a,a),this._rotateWithMatrix(a,i,r)}setRotation(e,t=0,i){this.setYawPitchRoll(e.y,e.x,e.z,t,i)}setRotationQuaternion(e,t=0,i){if(0===t)return this._decompose(),this._localRotation.copyFrom(e),void this._markAsDirtyAndCompose();const r=o._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,i))return;const n=o._TmpMats[1];s.uq.FromQuaternionToRef(e,n),r.multiplyToRef(n,n),this._rotateWithMatrix(n,t,i)}setRotationMatrix(e,t=0,i){if(0===t){const r=o._TmpQuat;return s.PT.FromRotationMatrixToRef(e,r),void this.setRotationQuaternion(r,t,i)}const r=o._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,i))return;const n=o._TmpMats[1];n.copyFrom(e),r.multiplyToRef(e,n),this._rotateWithMatrix(n,t,i)}_rotateWithMatrix(e,t=0,i){const s=this.getLocalMatrix(),r=s.m[12],n=s.m[13],a=s.m[14],h=this.getParent(),l=o._TmpMats[3],c=o._TmpMats[4];h&&1==t?(i?(l.copyFrom(i.getWorldMatrix()),h.getAbsoluteMatrix().multiplyToRef(l,l)):l.copyFrom(h.getAbsoluteMatrix()),c.copyFrom(l),c.invert(),s.multiplyToRef(l,s),s.multiplyToRef(e,s),s.multiplyToRef(c,s)):1==t&&i?(l.copyFrom(i.getWorldMatrix()),c.copyFrom(l),c.invert(),s.multiplyToRef(l,s),s.multiplyToRef(e,s),s.multiplyToRef(c,s)):s.multiplyToRef(e,s),s.setTranslationFromFloats(r,n,a),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(e,t){const i=o._TmpMats[2];return e.copyFrom(this.getAbsoluteMatrix()),t?(e.multiplyToRef(t.getWorldMatrix(),e),s.uq.ScalingToRef(t.scaling.x,t.scaling.y,t.scaling.z,i)):s.uq.IdentityToRef(i),e.invert(),!isNaN(e.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(i,e),!0)}getPosition(e=0,t=null){const i=s.Pq.Zero();return this.getPositionToRef(e,t,i),i}getPositionToRef(e=0,t,i){if(0==e){const e=this.getLocalMatrix();i.x=e.m[12],i.y=e.m[13],i.z=e.m[14]}else{let e=null;t&&(e=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let s=o._TmpMats[0];t&&e?(s.copyFrom(this.getAbsoluteMatrix()),s.multiplyToRef(e,s)):s=this.getAbsoluteMatrix(),i.x=s.m[12],i.y=s.m[13],i.z=s.m[14]}}getAbsolutePosition(e=null){const t=s.Pq.Zero();return this.getPositionToRef(1,e,t),t}getAbsolutePositionToRef(e,t){this.getPositionToRef(1,e,t)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.copyFrom(this._localMatrix);const e=this._skeleton.getPoseMatrix();e&&this._absoluteMatrix.multiplyToRef(e,this._absoluteMatrix)}const e=this.children,t=e.length;for(let i=0;i<t;i++)e[i].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}getDirection(e,t=null){const i=s.Pq.Zero();return this.getDirectionToRef(e,t,i),i}getDirectionToRef(e,t=null,i){let r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=o._TmpMats[0];n.copyFrom(this.getAbsoluteMatrix()),t&&r&&n.multiplyToRef(r,n),s.Pq.TransformNormalToRef(e,n,i),i.normalize()}getRotation(e=0,t=null){const i=s.Pq.Zero();return this.getRotationToRef(e,t,i),i}getRotationToRef(e=0,t=null,i){const s=o._TmpQuat;this.getRotationQuaternionToRef(e,t,s),s.toEulerAnglesToRef(i)}getRotationQuaternion(e=0,t=null){const i=s.PT.Identity();return this.getRotationQuaternionToRef(e,t,i),i}getRotationQuaternionToRef(e=0,t=null,i){if(0==e)this._decompose(),i.copyFrom(this._localRotation);else{const e=o._TmpMats[0],s=this.getAbsoluteMatrix();t?s.multiplyToRef(t.getWorldMatrix(),e):e.copyFrom(s),e.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyAtIndex(1,this._scalingDeterminant),e.multiplyAtIndex(2,this._scalingDeterminant),e.decompose(void 0,i,void 0)}}getRotationMatrix(e=0,t){const i=s.uq.Identity();return this.getRotationMatrixToRef(e,t,i),i}getRotationMatrixToRef(e=0,t,i){if(0==e)this.getLocalMatrix().getRotationMatrixToRef(i);else{const e=o._TmpMats[0],s=this.getAbsoluteMatrix();t?s.multiplyToRef(t.getWorldMatrix(),e):e.copyFrom(s),e.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyAtIndex(1,this._scalingDeterminant),e.multiplyAtIndex(2,this._scalingDeterminant),e.getRotationMatrixToRef(i)}}getAbsolutePositionFromLocal(e,t=null){const i=s.Pq.Zero();return this.getAbsolutePositionFromLocalToRef(e,t,i),i}getAbsolutePositionFromLocalToRef(e,t=null,i){let r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=o._TmpMats[0];n.copyFrom(this.getAbsoluteMatrix()),t&&r&&n.multiplyToRef(r,n),s.Pq.TransformCoordinatesToRef(e,n,i)}getLocalPositionFromAbsolute(e,t=null){const i=s.Pq.Zero();return this.getLocalPositionFromAbsoluteToRef(e,t,i),i}getLocalPositionFromAbsoluteToRef(e,t=null,i){let r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=o._TmpMats[0];n.copyFrom(this.getAbsoluteMatrix()),t&&r&&n.multiplyToRef(r,n),n.invert(),s.Pq.TransformCoordinatesToRef(e,n,i)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const e=this._skeleton.bones.indexOf(this);if(-1!==e&&this._skeleton.bones.splice(e,1),this._parentNode&&this._parentNode.children){const e=this._parentNode.children,t=e.indexOf(this);-1!==t&&e.splice(t,1)}super.dispose()}}o._TmpVecs=(0,r.mI)(2,s.Pq.Zero),o._TmpQuat=s.PT.Identity(),o._TmpMats=(0,r.mI)(5,s.uq.Identity)},8243:(e,t,i)=>{"use strict";i.d(t,{Y:()=>s});class s{}s.AUTOSAMPLERSUFFIX="Sampler",s.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",s.ALPHA_DISABLE=0,s.ALPHA_ADD=1,s.ALPHA_COMBINE=2,s.ALPHA_SUBTRACT=3,s.ALPHA_MULTIPLY=4,s.ALPHA_MAXIMIZED=5,s.ALPHA_ONEONE=6,s.ALPHA_PREMULTIPLIED=7,s.ALPHA_PREMULTIPLIED_PORTERDUFF=8,s.ALPHA_INTERPOLATE=9,s.ALPHA_SCREENMODE=10,s.ALPHA_ONEONE_ONEONE=11,s.ALPHA_ALPHATOCOLOR=12,s.ALPHA_REVERSEONEMINUS=13,s.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,s.ALPHA_ONEONE_ONEZERO=15,s.ALPHA_EXCLUSION=16,s.ALPHA_LAYER_ACCUMULATE=17,s.ALPHA_EQUATION_ADD=0,s.ALPHA_EQUATION_SUBSTRACT=1,s.ALPHA_EQUATION_REVERSE_SUBTRACT=2,s.ALPHA_EQUATION_MAX=3,s.ALPHA_EQUATION_MIN=4,s.ALPHA_EQUATION_DARKEN=5,s.DELAYLOADSTATE_NONE=0,s.DELAYLOADSTATE_LOADED=1,s.DELAYLOADSTATE_LOADING=2,s.DELAYLOADSTATE_NOTLOADED=4,s.NEVER=512,s.ALWAYS=519,s.LESS=513,s.EQUAL=514,s.LEQUAL=515,s.GREATER=516,s.GEQUAL=518,s.NOTEQUAL=517,s.KEEP=7680,s.ZERO=0,s.REPLACE=7681,s.INCR=7682,s.DECR=7683,s.INVERT=5386,s.INCR_WRAP=34055,s.DECR_WRAP=34056,s.TEXTURE_CLAMP_ADDRESSMODE=0,s.TEXTURE_WRAP_ADDRESSMODE=1,s.TEXTURE_MIRROR_ADDRESSMODE=2,s.TEXTURE_CREATIONFLAG_STORAGE=1,s.TEXTUREFORMAT_ALPHA=0,s.TEXTUREFORMAT_LUMINANCE=1,s.TEXTUREFORMAT_LUMINANCE_ALPHA=2,s.TEXTUREFORMAT_RGB=4,s.TEXTUREFORMAT_RGBA=5,s.TEXTUREFORMAT_RED=6,s.TEXTUREFORMAT_R=6,s.TEXTUREFORMAT_R16_UNORM=33322,s.TEXTUREFORMAT_RG16_UNORM=33324,s.TEXTUREFORMAT_RGB16_UNORM=32852,s.TEXTUREFORMAT_RGBA16_UNORM=32859,s.TEXTUREFORMAT_R16_SNORM=36760,s.TEXTUREFORMAT_RG16_SNORM=36761,s.TEXTUREFORMAT_RGB16_SNORM=36762,s.TEXTUREFORMAT_RGBA16_SNORM=36763,s.TEXTUREFORMAT_RG=7,s.TEXTUREFORMAT_RED_INTEGER=8,s.TEXTUREFORMAT_R_INTEGER=8,s.TEXTUREFORMAT_RG_INTEGER=9,s.TEXTUREFORMAT_RGB_INTEGER=10,s.TEXTUREFORMAT_RGBA_INTEGER=11,s.TEXTUREFORMAT_BGRA=12,s.TEXTUREFORMAT_DEPTH24_STENCIL8=13,s.TEXTUREFORMAT_DEPTH32_FLOAT=14,s.TEXTUREFORMAT_DEPTH16=15,s.TEXTUREFORMAT_DEPTH24=16,s.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,s.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,s.TEXTUREFORMAT_STENCIL8=19,s.TEXTUREFORMAT_UNDEFINED=4294967295,s.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,s.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,s.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,s.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,s.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,s.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,s.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,s.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,s.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,s.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,s.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,s.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,s.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,s.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,s.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,s.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,s.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,s.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,s.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,s.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,s.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,s.TEXTURETYPE_UNSIGNED_BYTE=0,s.TEXTURETYPE_UNSIGNED_INT=0,s.TEXTURETYPE_FLOAT=1,s.TEXTURETYPE_HALF_FLOAT=2,s.TEXTURETYPE_BYTE=3,s.TEXTURETYPE_SHORT=4,s.TEXTURETYPE_UNSIGNED_SHORT=5,s.TEXTURETYPE_INT=6,s.TEXTURETYPE_UNSIGNED_INTEGER=7,s.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,s.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,s.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,s.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,s.TEXTURETYPE_UNSIGNED_INT_24_8=12,s.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,s.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,s.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,s.TEXTURETYPE_UNDEFINED=16,s.TEXTURE_2D=3553,s.TEXTURE_2D_ARRAY=35866,s.TEXTURE_CUBE_MAP=34067,s.TEXTURE_CUBE_MAP_ARRAY=3735928559,s.TEXTURE_3D=32879,s.TEXTURE_NEAREST_SAMPLINGMODE=1,s.TEXTURE_NEAREST_NEAREST=1,s.TEXTURE_BILINEAR_SAMPLINGMODE=2,s.TEXTURE_LINEAR_LINEAR=2,s.TEXTURE_TRILINEAR_SAMPLINGMODE=3,s.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,s.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,s.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,s.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,s.TEXTURE_NEAREST_LINEAR=7,s.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,s.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,s.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,s.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,s.TEXTURE_LINEAR_NEAREST=12,s.TEXTURE_EXPLICIT_MODE=0,s.TEXTURE_SPHERICAL_MODE=1,s.TEXTURE_PLANAR_MODE=2,s.TEXTURE_CUBIC_MODE=3,s.TEXTURE_PROJECTION_MODE=4,s.TEXTURE_SKYBOX_MODE=5,s.TEXTURE_INVCUBIC_MODE=6,s.TEXTURE_EQUIRECTANGULAR_MODE=7,s.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,s.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,s.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,s.TEXTURE_FILTERING_QUALITY_HIGH=64,s.TEXTURE_FILTERING_QUALITY_MEDIUM=16,s.TEXTURE_FILTERING_QUALITY_LOW=8,s.SCALEMODE_FLOOR=1,s.SCALEMODE_NEAREST=2,s.SCALEMODE_CEILING=3,s.MATERIAL_TextureDirtyFlag=1,s.MATERIAL_LightDirtyFlag=2,s.MATERIAL_FresnelDirtyFlag=4,s.MATERIAL_AttributesDirtyFlag=8,s.MATERIAL_MiscDirtyFlag=16,s.MATERIAL_PrePassDirtyFlag=32,s.MATERIAL_AllDirtyFlag=63,s.MATERIAL_TriangleFillMode=0,s.MATERIAL_WireFrameFillMode=1,s.MATERIAL_PointFillMode=2,s.MATERIAL_PointListDrawMode=3,s.MATERIAL_LineListDrawMode=4,s.MATERIAL_LineLoopDrawMode=5,s.MATERIAL_LineStripDrawMode=6,s.MATERIAL_TriangleStripDrawMode=7,s.MATERIAL_TriangleFanDrawMode=8,s.MATERIAL_ClockWiseSideOrientation=0,s.MATERIAL_CounterClockWiseSideOrientation=1,s.ACTION_NothingTrigger=0,s.ACTION_OnPickTrigger=1,s.ACTION_OnLeftPickTrigger=2,s.ACTION_OnRightPickTrigger=3,s.ACTION_OnCenterPickTrigger=4,s.ACTION_OnPickDownTrigger=5,s.ACTION_OnDoublePickTrigger=6,s.ACTION_OnPickUpTrigger=7,s.ACTION_OnPickOutTrigger=16,s.ACTION_OnLongPressTrigger=8,s.ACTION_OnPointerOverTrigger=9,s.ACTION_OnPointerOutTrigger=10,s.ACTION_OnEveryFrameTrigger=11,s.ACTION_OnIntersectionEnterTrigger=12,s.ACTION_OnIntersectionExitTrigger=13,s.ACTION_OnKeyDownTrigger=14,s.ACTION_OnKeyUpTrigger=15,s.PARTICLES_BILLBOARDMODE_Y=2,s.PARTICLES_BILLBOARDMODE_ALL=7,s.PARTICLES_BILLBOARDMODE_STRETCHED=8,s.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,s.MESHES_CULLINGSTRATEGY_STANDARD=0,s.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,s.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,s.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,s.SCENELOADER_NO_LOGGING=0,s.SCENELOADER_MINIMAL_LOGGING=1,s.SCENELOADER_SUMMARY_LOGGING=2,s.SCENELOADER_DETAILED_LOGGING=3,s.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,s.PREPASS_POSITION_TEXTURE_TYPE=1,s.PREPASS_VELOCITY_TEXTURE_TYPE=2,s.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,s.PREPASS_COLOR_TEXTURE_TYPE=4,s.PREPASS_DEPTH_TEXTURE_TYPE=5,s.PREPASS_NORMAL_TEXTURE_TYPE=6,s.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,s.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,s.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,s.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,s.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,s.PREPASS_ALBEDO_TEXTURE_TYPE=12,s.BUFFER_CREATIONFLAG_READ=1,s.BUFFER_CREATIONFLAG_WRITE=2,s.BUFFER_CREATIONFLAG_READWRITE=3,s.BUFFER_CREATIONFLAG_UNIFORM=4,s.BUFFER_CREATIONFLAG_VERTEX=8,s.BUFFER_CREATIONFLAG_INDEX=16,s.BUFFER_CREATIONFLAG_STORAGE=32,s.BUFFER_CREATIONFLAG_INDIRECT=64,s.RENDERPASS_MAIN=0,s.INPUT_ALT_KEY=18,s.INPUT_CTRL_KEY=17,s.INPUT_META_KEY1=91,s.INPUT_META_KEY2=92,s.INPUT_META_KEY3=93,s.INPUT_SHIFT_KEY=16,s.SNAPSHOTRENDERING_STANDARD=0,s.SNAPSHOTRENDERING_FAST=1,s.PERSPECTIVE_CAMERA=0,s.ORTHOGRAPHIC_CAMERA=1,s.FOVMODE_VERTICAL_FIXED=0,s.FOVMODE_HORIZONTAL_FIXED=1,s.RIG_MODE_NONE=0,s.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,s.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,s.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,s.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,s.RIG_MODE_STEREOSCOPIC_INTERLACED=14,s.RIG_MODE_VR=20,s.RIG_MODE_CUSTOM=22,s.MAX_SUPPORTED_UV_SETS=6,s.GL_ALPHA_EQUATION_ADD=32774,s.GL_ALPHA_EQUATION_MIN=32775,s.GL_ALPHA_EQUATION_MAX=32776,s.GL_ALPHA_EQUATION_SUBTRACT=32778,s.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,s.GL_ALPHA_FUNCTION_SRC=768,s.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,s.GL_ALPHA_FUNCTION_SRC_ALPHA=770,s.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,s.GL_ALPHA_FUNCTION_DST_ALPHA=772,s.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,s.GL_ALPHA_FUNCTION_DST_COLOR=774,s.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,s.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,s.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,s.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,s.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,s.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,s.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,s.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,s.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,s.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,s.SnippetUrl="https://snippet.babylonjs.com",s.FOGMODE_NONE=0,s.FOGMODE_EXP=1,s.FOGMODE_EXP2=2,s.FOGMODE_LINEAR=3,s.BYTE=5120,s.UNSIGNED_BYTE=5121,s.SHORT=5122,s.UNSIGNED_SHORT=5123,s.INT=5124,s.UNSIGNED_INT=5125,s.FLOAT=5126,s.PositionKind="position",s.NormalKind="normal",s.TangentKind="tangent",s.UVKind="uv",s.UV2Kind="uv2",s.UV3Kind="uv3",s.UV4Kind="uv4",s.UV5Kind="uv5",s.UV6Kind="uv6",s.ColorKind="color",s.ColorInstanceKind="instanceColor",s.MatricesIndicesKind="matricesIndices",s.MatricesWeightsKind="matricesWeights",s.MatricesIndicesExtraKind="matricesIndicesExtra",s.MatricesWeightsExtraKind="matricesWeightsExtra",s.ShadowMinZ=0,s.ShadowMaxZ=1e4},8421:(e,t,i)=>{"use strict";i.d(t,{b8:()=>h,cD:()=>a});var s=i(4754),r=i(4049),n=i(4537);class o{static extractMinAndMaxIndexed(e,t,i,s,r,n){for(let o=i;o<i+s;o++){const i=3*t[o],s=e[i],a=e[i+1],h=e[i+2];r.minimizeInPlaceFromFloats(s,a,h),n.maximizeInPlaceFromFloats(s,a,h)}}static extractMinAndMax(e,t,i,s,r,n){for(let o=t,a=t*s;o<t+i;o++,a+=s){const t=e[a],i=e[a+1],s=e[a+2];r.minimizeInPlaceFromFloats(t,i,s),n.maximizeInPlaceFromFloats(t,i,s)}}}function a(e,t,i,s,n=null){const a=new r.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new r.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return o.extractMinAndMaxIndexed(e,t,i,s,a,h),n&&(a.x-=a.x*n.x+n.y,a.y-=a.y*n.x+n.y,a.z-=a.z*n.x+n.y,h.x+=h.x*n.x+n.y,h.y+=h.y*n.x+n.y,h.z+=h.z*n.x+n.y),{minimum:a,maximum:h}}function h(e,t,i,s=null,n){const a=new r.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new r.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n||(n=3),o.extractMinAndMax(e,t,i,n,a,h),s&&(a.x-=a.x*s.x+s.y,a.y-=a.y*s.x+s.y,a.z-=a.z*s.x+s.y,h.x+=h.x*s.x+s.y,h.y+=h.y*s.x+s.y,h.z+=h.z*s.x+s.y),{minimum:a,maximum:h}}(0,s.Cg)([n.Cx.filter(((...[e,t])=>!Array.isArray(e)&&!Array.isArray(t)))],o,"extractMinAndMaxIndexed",null),(0,s.Cg)([n.Cx.filter(((...[e])=>!Array.isArray(e)))],o,"extractMinAndMax",null)},8442:(e,t,i)=>{"use strict";i.d(t,{X:()=>n});var s=i(766),r=i(3054);class n{constructor(e){this._vertexBuffers={},this.onBeforeRenderObservable=new r.cP,this._scene=e}_prepareBuffers(){if(this._vertexBuffers[s.R.PositionKind])return;const e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[s.R.PositionKind]=new s.R(this._scene.getEngine(),e,s.R.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}_rebuild(){const e=this._vertexBuffers[s.R.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}_prepareFrame(e=null,t=null){const i=this._scene.activeCamera;return!(!i||!(t=t||i._postProcesses.filter((e=>null!=e)))||0===t.length||!this._scene.postProcessesEnabled||(t[0].activate(i,e,null!=t),0))}directRender(e,t=null,i=!1,s=0,r=0,n=!1){const o=this._scene.getEngine();for(let a=0;a<e.length;a++){a<e.length-1?e[a+1].activate(this._scene.activeCamera||this._scene,t?.texture):(t?o.bindFramebuffer(t,s,void 0,void 0,i,r):n||o.restoreDefaultFramebuffer(),o._debugInsertMarker?.(`post process ${e[a].name} output`));const h=e[a],l=h.apply();l&&(h.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,l),o.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(l))}o.setDepthBuffer(!0),o.setDepthWrite(!0)}_finalizeFrame(e,t,i,s,r=!1){const n=this._scene.activeCamera;if(!n)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(s=s||n._postProcesses.filter((e=>null!=e))).length||!this._scene.postProcessesEnabled)return;const o=this._scene.getEngine();for(let a=0,h=s.length;a<h;a++){const l=s[a];if(a<h-1?l._outputTexture=s[a+1].activate(n,t?.texture):(t?(o.bindFramebuffer(t,i,void 0,void 0,r),l._outputTexture=t):(o.restoreDefaultFramebuffer(),l._outputTexture=null),o._debugInsertMarker?.(`post process ${s[a].name} output`)),e)break;const c=l.apply();c&&(l.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,c),o.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(c))}o.setDepthBuffer(!0),o.setDepthWrite(!0),o.setAlphaMode(0)}dispose(){const e=this._vertexBuffers[s.R.PositionKind];e&&(e.dispose(),this._vertexBuffers[s.R.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},8499:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ThinEngine:()=>v});var s=i(1126),r=i(3039),n=i(4920);class o{constructor(){this.shaderLanguage=0}postProcessor(e,t,i,s,r){if(r.drawBuffersExtensionDisabled){const t=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;e=e.replace(t,"")}return e}}const a=/(flat\s)?\s*varying\s*.*/;class h{constructor(){this.shaderLanguage=0}attributeProcessor(e){return e.replace("attribute","in")}varyingCheck(e,t){return a.test(e)}varyingProcessor(e,t){return e.replace("varying",t?"in":"out")}postProcessor(e,t,i){const s=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),i){const t=-1!==e.search(/layout *\(location *= *0\) *out/g);e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(s||t?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e}}var l=i(6679),c=i(1663),u=i(976),d=i(9202),_=i(3788),p=i(2450),g=i(8615),f=i(1601),m=i(9576);class b{}class v extends u.${get name(){return this._name}set name(e){this._name=e}get version(){return this._webGLVersion}static get ShadersRepository(){return p.M.ShadersRepository}static set ShadersRepository(e){p.M.ShadersRepository=e}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(e,t,i,n){if(i=i||{},super(t??i.antialias,i,n),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!e)return;let a=null;if(e.getContext){if(a=e,void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.xrCompatible&&(i.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const e=navigator.userAgent;for(const t of v.ExceptionList){const s=t.key,r=t.targets;if(new RegExp(s).test(e)){if(t.capture&&t.captureConstraint){const i=t.capture,s=t.captureConstraint,r=new RegExp(i).exec(e);if(r&&r.length>0&&parseInt(r[r.length-1])>=s)continue}for(const e of r)switch(e){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":i.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,s.Cm)(this._gl)}:(this._onContextLost=e=>{e.preventDefault(),this._contextWasLost=!0,(0,s.Cm)(this._gl),r.V.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},a.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference=i.powerPreference||"high-performance"),a.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(i.xrCompatible=!1),!i.disableWebGL2Support)try{this._gl=a.getContext("webgl2",i)||a.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(e){}if(!this._gl){if(!a)throw new Error("The provided canvas is null or undefined.");try{this._gl=a.getContext("webgl",i)||a.getContext("experimental-webgl",i)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,a=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const t=this._gl.getContextAttributes();t&&(i.stencil=t.stencil)}this._sharedInit(a),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let e=0;e<this._caps.maxVertexAttribs;e++)this._currentBufferPointers[e]=new b;this._shaderProcessor=this.webGLVersion>1?new h:new o;const l=`Babylon.js v${v.Version}`;r.V.Log(l+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",l);const c=(0,s.N5)(this._gl);c.validateShaderPrograms=this.validateShaderPrograms,c.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(e){return null}areAllEffectsReady(){for(const e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const e=this._gl.getExtension("WEBGL_draw_buffers");if(null!==e){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=e.drawBuffersWEBGL.bind(e),this._caps.maxDrawBuffers=this._gl.getParameter(e.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let t=0;t<16;t++)this._gl["COLOR_ATTACHMENT"+t+"_WEBGL"]=e["COLOR_ATTACHMENT"+t+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const e=this._gl.getExtension("WEBGL_depth_texture");null!=e&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=e.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const e=this._gl.getExtension("OES_vertex_array_object");null!=e&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=e.createVertexArrayOES.bind(e),this._gl.bindVertexArray=e.bindVertexArrayOES.bind(e),this._gl.deleteVertexArray=e.deleteVertexArrayOES.bind(e))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const e=this._gl.getExtension("ANGLE_instanced_arrays");null!=e?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),this._gl.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),this._gl.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const e=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),t=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);e&&t&&(this._caps.highPrecisionShaderSupported=0!==e.precision&&0!==t.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const e=this._gl.getExtension("EXT_blend_minmax");null!=e&&(this._caps.blendMinMax=!0,this._gl.MAX=e.MAX_EXT,this._gl.MIN=e.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const e=this._gl.getExtension("EXT_sRGB");null!=e&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:e.SRGB_EXT,SRGB8:e.SRGB_ALPHA_EXT,SRGB8_ALPHA8:e.SRGB_ALPHA_EXT})}if(this._creationOptions){const e=this._creationOptions.forceSRGBBufferSupportState;void 0!==e&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&e)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let e=0;e<this._maxSimultaneousTextures;e++)this._nextFreeTextureSlots.push(e);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"==typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const e=this.getGlInfo();return e&&e.renderer?e.renderer:""}getRenderWidth(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(e,t,i,s=!1){const r=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=r;let n=0;if(t&&e){let t=!0;if(this._currentRenderTarget){const i=this._currentRenderTarget.texture?.format;if(8===i||9===i||10===i||11===i){const i=this._currentRenderTarget.texture?.type;7===i||5===i?(v._TempClearColorUint32[0]=255*e.r,v._TempClearColorUint32[1]=255*e.g,v._TempClearColorUint32[2]=255*e.b,v._TempClearColorUint32[3]=255*e.a,this._gl.clearBufferuiv(this._gl.COLOR,0,v._TempClearColorUint32),t=!1):(v._TempClearColorInt32[0]=255*e.r,v._TempClearColorInt32[1]=255*e.g,v._TempClearColorInt32[2]=255*e.b,v._TempClearColorInt32[3]=255*e.a,this._gl.clearBufferiv(this._gl.COLOR,0,v._TempClearColorInt32),t=!1)}}t&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT)}i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),s&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)}_viewport(e,t,i,s){e===this._viewportCached.x&&t===this._viewportCached.y&&i===this._viewportCached.z&&s===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=s,this._gl.viewport(e,t,i,s))}endFrame(){super.endFrame(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(e,t=0,i,s,n,o=0,a=0){const h=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(h._framebuffer);const l=this._gl;e.isMulti||(e.is2DArray||e.is3D?(l.framebufferTextureLayer(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,e.texture._hardwareTexture?.underlyingResource,o,a),h._currentLOD=o):e.isCube?l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.texture._hardwareTexture?.underlyingResource,o):h._currentLOD!==o&&(l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,e.texture._hardwareTexture?.underlyingResource,o),h._currentLOD=o));const c=e._depthStencilTexture;if(c){e.is3D&&(e.texture.width===c.width&&e.texture.height===c.height&&e.texture.depth===c.depth||r.V.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const i=e._depthStencilTextureWithStencil?l.DEPTH_STENCIL_ATTACHMENT:l.DEPTH_ATTACHMENT;e.is2DArray||e.is3D?l.framebufferTextureLayer(l.FRAMEBUFFER,i,c._hardwareTexture?.underlyingResource,o,a):e.isCube?l.framebufferTexture2D(l.FRAMEBUFFER,i,l.TEXTURE_CUBE_MAP_POSITIVE_X+t,c._hardwareTexture?.underlyingResource,o):l.framebufferTexture2D(l.FRAMEBUFFER,i,l.TEXTURE_2D,c._hardwareTexture?.underlyingResource,o)}h._MSAAFramebuffer&&this._bindUnboundFramebuffer(h._MSAAFramebuffer),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,i,s):(i||(i=e.width,o&&(i/=Math.pow(2,o))),s||(s=e.height,o&&(s/=Math.pow(2,o))),this._viewport(0,0,i,s)),this.wipeCaches()}setState(e,t=0,i,s=!1,r,n,o=0){(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e);const a=this.cullBackFaces??r??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==a||i)&&(this._depthCullingState.cullFace=a),this.setZOffset(t),this.setZOffsetUnits(o);const h=s?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==h||i)&&(this._depthCullingState.frontFace=h),this._stencilStateComposer.stencilMaterial=n}_bindUnboundFramebuffer(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(e){const t=this._getTextureTarget(e);this._bindTextureDirectly(t,e,!0),this._gl.generateMipmap(t),this._bindTextureDirectly(t,null)}unBindFramebuffer(e,t=!1,i){const s=e;this._currentRenderTarget=null,s.disableAutomaticMSAAResolve||(e.isMulti?this.resolveMultiFramebuffer(e):this.resolveFramebuffer(e)),t||(e.isMulti?this.generateMipMapsMultiFramebuffer(e):this.generateMipMapsFramebuffer(e)),i&&(s._MSAAFramebuffer&&this._bindUnboundFramebuffer(s._framebuffer),i()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(e){e.isMulti||!e.texture?.generateMipMaps||e.isCube||this.generateMipmaps(e.texture)}resolveFramebuffer(e){const t=e,i=this._gl;if(!t._MSAAFramebuffer||t.isMulti)return;let s=t.resolveMSAAColors?i.COLOR_BUFFER_BIT:0;s|=t._generateDepthBuffer&&t.resolveMSAADepth?i.DEPTH_BUFFER_BIT:0,s|=t._generateStencilBuffer&&t.resolveMSAAStencil?i.STENCIL_BUFFER_BIT:0,i.bindFramebuffer(i.READ_FRAMEBUFFER,t._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,t._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,s,i.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(e,t,i){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)}_createVertexBuffer(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");const s=new l.A(i);return this.bindArrayBuffer(s),"number"!=typeof e?e instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t),s.capacity=4*e.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),s.capacity=e.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(e),t),s.capacity=e),this._resetVertexBufferBinding(),s.references=1,s}createDynamicVertexBuffer(e,t){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(e,t,i){const s=this._gl.createBuffer(),r=new l.A(s);if(!s)throw new Error("Unable to create index buffer");this.bindIndexBuffer(r);const n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),r.references=1,r.is32Bits=4===n.BYTES_PER_ELEMENT,r}_normalizeIndexData(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(let t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)}bindArrayBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)}bindUniformBlock(e,t,i){const s=e.program,r=this._gl.getUniformBlockIndex(s,t);this._gl.uniformBlockBinding(s,r,i)}bindIndexBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)}updateArrayBuffer(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)}_vertexAttribPointer(e,t,i,s,r,n,o){const a=this._currentBufferPointers[t];if(!a)return;let h=!1;a.active?(a.buffer!==e&&(a.buffer=e,h=!0),a.size!==i&&(a.size=i,h=!0),a.type!==s&&(a.type=s,h=!0),a.normalized!==r&&(a.normalized=r,h=!0),a.stride!==n&&(a.stride=n,h=!0),a.offset!==o&&(a.offset=o,h=!0)):(h=!0,a.active=!0,a.index=t,a.size=i,a.type=s,a.normalized=r,a.stride=n,a.offset=o,a.buffer=e),(h||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),s===this._gl.UNSIGNED_INT||s===this._gl.INT?this._gl.vertexAttribIPointer(t,i,s,n,o):this._gl.vertexAttribPointer(t,i,s,r,n,o))}_bindIndexBufferWithCache(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)}_bindVertexBuffersAttributes(e,t,i){const s=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let r=0;r<s.length;r++){const n=t.getAttributeLocation(r);if(n>=0){const t=s[r];let o=null;if(i&&(o=i[t]),o||(o=e[t]),!o)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);const a=o.getBuffer();a&&(this._vertexAttribPointer(a,n,o.getSize(),o.type,o.normalized,o.byteStride,o.byteOffset),o.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,o.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(a))))}}}recordVertexArrayObject(e,t,i,s){const r=this._gl.createVertexArray();if(!r)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(r),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,s),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),r}bindVertexArrayObject(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(e,t,i,s,r){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==r){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r;const t=r.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let n=0;for(let o=0;o<t;o++)if(o<i.length){const t=r.getAttributeLocation(o);t>=0&&(this._gl.enableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!0,this._vertexAttribPointer(e,t,i[o],this._gl.FLOAT,!1,s,n)),n+=4*i[o]}}this._bindIndexBufferWithCache(t)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(e,t,i,s){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===i||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,s)),this._bindIndexBufferWithCache(t)}unbindInstanceAttributes(){let e;for(let t=0,i=this._currentInstanceLocations.length;t<i;t++){const i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));const s=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(s,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(e){this._gl.deleteVertexArray(e)}_releaseBuffer(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)}_deleteBuffer(e){this._gl.deleteBuffer(e.underlyingResource)}updateAndBindInstancesBuffer(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index)this.bindInstancesBuffer(e,i,!0);else for(let t=0;t<4;t++){const s=i[t];this._vertexAttribArraysEnabled[s]||(this._gl.enableVertexAttribArray(s),this._vertexAttribArraysEnabled[s]=!0),this._vertexAttribPointer(e,s,4,this._gl.FLOAT,!1,64,16*t),this._gl.vertexAttribDivisor(s,1),this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(e)}}bindInstancesBuffer(e,t,i=!0){this.bindArrayBuffer(e);let s=0;if(i)for(let e=0;e<t.length;e++)s+=4*t[e].attributeSize;for(let i=0;i<t.length;i++){const r=t[i];void 0===r.index&&(r.index=this._currentEffect.getAttributeLocationByName(r.attributeName)),r.index<0||(this._vertexAttribArraysEnabled[r.index]||(this._gl.enableVertexAttribArray(r.index),this._vertexAttribArraysEnabled[r.index]=!0),this._vertexAttribPointer(e,r.index,r.attributeSize,r.attributeType||this._gl.FLOAT,r.normalized||!1,s,r.offset),this._gl.vertexAttribDivisor(r.index,void 0===r.divisor?1:r.divisor),this._currentInstanceLocations.push(r.index),this._currentInstanceBuffers.push(e))}}disableInstanceAttributeByName(e){if(!this._currentEffect)return;const t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}disableInstanceAttribute(e){let t,i=!1;for(;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),i=!0,t=this._currentInstanceLocations.indexOf(e);i&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))}disableAttributeByIndex(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}draw(e,t,i,s){this.drawElementsType(e?0:1,t,i,s)}drawPointClouds(e,t,i){this.drawArraysType(2,e,t,i)}drawUnIndexed(e,t,i,s){this.drawArraysType(e?0:1,t,i,s)}drawElementsType(e,t,i,s){this.applyStates(),this._reportDrawCall();const r=this._drawMode(e),n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;s?this._gl.drawElementsInstanced(r,i,n,t*o,s):this._gl.drawElements(r,i,n,t*o)}drawArraysType(e,t,i,s){this.applyStates(),this._reportDrawCall();const r=this._drawMode(e);s?this._gl.drawArraysInstanced(r,t,i,s):this._gl.drawArrays(r,t,i)}_drawMode(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(e){this._compiledEffects[e._key]&&delete this._compiledEffects[e._key];const t=e.getPipelineContext();t&&this._deletePipelineContext(t)}_deletePipelineContext(e){const t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,(0,f.mO)(t),this._gl&&this._gl.deleteProgram(t.program))}_getGlobalDefines(e){return(0,g.xt)(e,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(e,t,i,r,n,o,a,h,l,c=0,u){const d="string"==typeof e?e:e.vertexToken||e.vertexSource||e.vertexElement||e.vertex,_="string"==typeof e?e:e.fragmentToken||e.fragmentSource||e.fragmentElement||e.fragment,g=this._getGlobalDefines(),f=void 0!==t.attributes;let m=n??t.defines??"";g&&(m+=g);const b=d+"+"+_+"@"+m;if(this._compiledEffects[b]){const e=this._compiledEffects[b];return a&&e.isReady()&&a(e),e._refCount++,e}this._gl&&(0,s.N5)(this._gl);const v=new p.M(e,t,f?this:i,r,this,n,o,a,h,l,b,t.shaderLanguage??c,t.extraInitializationsAsync??u);return this._compiledEffects[b]=v,v}_getShaderSource(e){return this._gl.getShaderSource(e)}createRawShaderProgram(e,t,i,r,n=null){const o=(0,s.N5)(this._gl);return o._contextWasLost=this._contextWasLost,o.validateShaderPrograms=this.validateShaderPrograms,(0,s.kf)(e,t,i,r||this._gl,n)}createShaderProgram(e,t,i,r,n,o=null){const a=(0,s.N5)(this._gl);return a._contextWasLost=this._contextWasLost,a.validateShaderPrograms=this.validateShaderPrograms,(0,s.EX)(e,t,i,r,n||this._gl,o)}inlineShaderCode(e){return e}createPipelineContext(e){this._gl&&((0,s.N5)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile);const t=(0,s.GX)(this._gl,e);return t.engine=this,t}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(e){return(0,s.tg)(e,this._gl,this.validateShaderPrograms)}_preparePipelineContext(e,t,i,r,n,o,a,h,l,c,u){const d=(0,s.N5)(this._gl);return d._contextWasLost=this._contextWasLost,d.validateShaderPrograms=this.validateShaderPrograms,d._createShaderProgramInjection=this._createShaderProgram.bind(this),d.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),d.createShaderProgramInjection=this.createShaderProgram.bind(this),d.loadFileInjection=this._loadFile.bind(this),(0,s.YM)(e,t,i,r,n,o,a,h,l,c,u)}_createShaderProgram(e,t,i,r,n=null){return(0,s.tI)(e,t,i,r,n)}_isRenderingStateCompiled(e){return!this._isDisposed&&(0,s.A5)(e,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(e,t){(0,s.bS)(e,t)}getUniforms(e,t){const i=new Array,s=e;for(let e=0;e<t.length;e++)i.push(this._gl.getUniformLocation(s.program,t[e]));return i}getAttributes(e,t){const i=[],s=e;for(let e=0;e<t.length;e++)try{i.push(this._gl.getAttribLocation(s.program,t[e]))}catch(e){i.push(-1)}return i}enableEffect(e){(e=null!==e&&function(e){return void 0===e.getPipelineContext}(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))}setInt(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)}setInt2(e,t,i){return!!e&&(this._gl.uniform2i(e,t,i),!0)}setInt3(e,t,i,s){return!!e&&(this._gl.uniform3i(e,t,i,s),!0)}setInt4(e,t,i,s,r){return!!e&&(this._gl.uniform4i(e,t,i,s,r),!0)}setIntArray(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)}setIntArray2(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2iv(e,t),0))}setIntArray3(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3iv(e,t),0))}setIntArray4(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4iv(e,t),0))}setUInt(e,t){return!!e&&(this._gl.uniform1ui(e,t),!0)}setUInt2(e,t,i){return!!e&&(this._gl.uniform2ui(e,t,i),!0)}setUInt3(e,t,i,s){return!!e&&(this._gl.uniform3ui(e,t,i,s),!0)}setUInt4(e,t,i,s,r){return!!e&&(this._gl.uniform4ui(e,t,i,s,r),!0)}setUIntArray(e,t){return!!e&&(this._gl.uniform1uiv(e,t),!0)}setUIntArray2(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2uiv(e,t),0))}setUIntArray3(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3uiv(e,t),0))}setUIntArray4(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4uiv(e,t),0))}setArray(e,t){return!(!e||t.length<1||(this._gl.uniform1fv(e,t),0))}setArray2(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2fv(e,t),0))}setArray3(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3fv(e,t),0))}setArray4(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4fv(e,t),0))}setMatrices(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)}setMatrix3x3(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)}setMatrix2x2(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)}setFloat(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)}setFloat2(e,t,i){return!!e&&(this._gl.uniform2f(e,t,i),!0)}setFloat3(e,t,i,s){return!!e&&(this._gl.uniform3f(e,t,i,s),!0)}setFloat4(e,t,i,s,r){return!!e&&(this._gl.uniform4f(e,t,i,s,r),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const e=this._colorWrite;this._gl.colorMask(e,e,e,e)}}wipeCaches(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(e,t){const i=this._gl;let s=i.NEAREST,r=i.NEAREST;switch(e){case 11:s=i.LINEAR,r=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 3:s=i.LINEAR,r=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 8:s=i.NEAREST,r=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 4:s=i.NEAREST,r=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 5:s=i.NEAREST,r=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 6:s=i.NEAREST,r=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 7:s=i.NEAREST,r=i.LINEAR;break;case 1:s=i.NEAREST,r=i.NEAREST;break;case 9:s=i.LINEAR,r=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 10:s=i.LINEAR,r=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 2:s=i.LINEAR,r=i.LINEAR;break;case 12:s=i.LINEAR,r=i.NEAREST}return{min:r,mag:s}}_createTexture(){const e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e}_createHardwareTexture(){return new d.d(this._createTexture(),this._gl)}_createInternalTexture(e,t,i=!0,s=0){let n,o=!1,a=!1,h=0,l=3,c=5,u=!1,d=1,p=!1,g=0;void 0!==t&&"object"==typeof t?(o=!!t.generateMipMaps,a=!!t.createMipMaps,h=void 0===t.type?0:t.type,l=void 0===t.samplingMode?3:t.samplingMode,c=void 0===t.format?5:t.format,u=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer,d=t.samples??1,n=t.label,p=!!t.createMSAATexture,g=t.comparisonFunction||0):o=!!t,u&&(u=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==h||this._caps.textureFloatLinearFiltering)&&(2!==h||this._caps.textureHalfFloatLinearFiltering)||(l=1),1!==h||this._caps.textureFloat||(h=0,r.V.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const f=(0,m.vl)(c),b=(0,m.$l)(c),v=this._gl,T=new _.h(this,s),y=e.width||e,x=e.height||e,A=e.depth||0,C=e.layers||0,S=this._getSamplingParameters(l,(o||a)&&!f),E=0!==C?v.TEXTURE_2D_ARRAY:0!==A?v.TEXTURE_3D:v.TEXTURE_2D,R=f?this._getInternalFormatFromDepthTextureFormat(c,!0,b):this._getRGBABufferInternalSizedFormat(h,c,u),P=f?b?v.DEPTH_STENCIL:v.DEPTH_COMPONENT:this._getInternalFormat(c),I=f?this._getWebGLTextureTypeFromDepthTextureFormat(c):this._getWebGLTextureType(h);if(this._bindTextureDirectly(E,T),0!==C?(T.is2DArray=!0,v.texImage3D(E,0,R,y,x,C,0,P,I,null)):0!==A?(T.is3D=!0,v.texImage3D(E,0,R,y,x,A,0,P,I,null)):v.texImage2D(E,0,R,y,x,0,P,I,null),v.texParameteri(E,v.TEXTURE_MAG_FILTER,S.mag),v.texParameteri(E,v.TEXTURE_MIN_FILTER,S.min),v.texParameteri(E,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(E,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),f&&this.webGLVersion>1&&(0===g?(v.texParameteri(E,v.TEXTURE_COMPARE_FUNC,515),v.texParameteri(E,v.TEXTURE_COMPARE_MODE,v.NONE)):(v.texParameteri(E,v.TEXTURE_COMPARE_FUNC,g),v.texParameteri(E,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE))),(o||a)&&this._gl.generateMipmap(E),this._bindTextureDirectly(E,null),T._useSRGBBuffer=u,T.baseWidth=y,T.baseHeight=x,T.width=y,T.height=x,T.depth=C||A,T.isReady=!0,T.samples=d,T.generateMipMaps=o,T.samplingMode=l,T.type=h,T.format=c,T.label=n,T.comparisonFunction=g,this._internalTexturesCache.push(T),p){let e=null;if(e=(0,m.vl)(T.format)?this._setupFramebufferDepthAttachments((0,m.$l)(T.format),19!==T.format,T.width,T.height,d,T.format,!0):this._createRenderBuffer(T.width,T.height,d,-1,this._getRGBABufferInternalSizedFormat(T.type,T.format,T._useSRGBBuffer),-1),!e)throw new Error("Unable to create render buffer");T._autoMSAAManagement=!0;let t=T._hardwareTexture;t||(t=T._hardwareTexture=this._createHardwareTexture()),t.addMSAARenderBuffer(e)}return T}_getUseSRGBBuffer(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||t)}createTexture(e,t,i,s,r=3,n=null,o=null,a=null,h=null,l=null,c=null,u,d,p,g){return this._createTextureBase(e,t,i,s,r,n,o,((...e)=>this._prepareWebGLTexture(...e,l)),((e,t,i,r,n,o)=>{const a=this._gl,h=i.width===e&&i.height===t;n._creationFlags=p??0;const l=this._getTexImageParametersForCreateTexture(n.format,n._useSRGBBuffer);if(h)return a.texImage2D(a.TEXTURE_2D,0,l.internalFormat,l.format,l.type,i),!1;const c=this._caps.maxTextureSize;if(i.width>c||i.height>c||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext||(this._workingCanvas.width=e,this._workingCanvas.height=t,this._workingContext.drawImage(i,0,0,i.width,i.height,0,0,e,t),a.texImage2D(a.TEXTURE_2D,0,l.internalFormat,l.format,l.type,this._workingCanvas),n.width=e,n.height=t,1));{const e=new _.h(this,2);this._bindTextureDirectly(a.TEXTURE_2D,e,!0),a.texImage2D(a.TEXTURE_2D,0,l.internalFormat,l.format,l.type,i),this._rescaleTexture(e,n,s,l.format,(()=>{this._releaseTexture(e),this._bindTextureDirectly(a.TEXTURE_2D,n,!0),o()}))}return!0}),a,h,l,c,u,d,g)}_getTexImageParametersForCreateTexture(e,t){let i,s;return 1===this.webGLVersion?(i=this._getInternalFormat(e,t),s=i):(i=this._getInternalFormat(e,!1),s=this._getRGBABufferInternalSizedFormat(0,e,t)),{internalFormat:s,format:i,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(e,t,i,s,r){}_unpackFlipY(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(e,t,i=!1){const s=this._getTextureTarget(t),r=this._getSamplingParameters(e,t.useMipMaps||i);this._setTextureParameterInteger(s,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(s,this._gl.TEXTURE_MIN_FILTER,r.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(s)),this._bindTextureDirectly(s,null),t.samplingMode=e}updateTextureDimensions(e,t,i,s=1){}updateTextureWrappingMode(e,t,i=null,s=null){const r=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(r,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==i&&(this._setTextureParameterInteger(r,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&null!==s&&(this._setTextureParameterInteger(r,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(s),e),e._cachedWrapR=s),this._bindTextureDirectly(r,null)}_uploadCompressedDataToTextureDirectly(e,t,i,s,r,n=0,o=0){const a=this._gl;let h=a.TEXTURE_2D;if(e.isCube&&(h=a.TEXTURE_CUBE_MAP_POSITIVE_X+n),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=a.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(h,o,t,i,s,0,r)}_uploadDataToTextureDirectly(e,t,i=0,s=0,r,n=!1){const o=this._gl,a=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format),l=void 0===r?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(r,e._useSRGBBuffer);this._unpackFlipY(e.invertY);let c=o.TEXTURE_2D;e.isCube&&(c=o.TEXTURE_CUBE_MAP_POSITIVE_X+i);const u=Math.round(Math.log(e.width)*Math.LOG2E),d=Math.round(Math.log(e.height)*Math.LOG2E),_=n?e.width:Math.pow(2,Math.max(u-s,0)),p=n?e.height:Math.pow(2,Math.max(d-s,0));o.texImage2D(c,s,l,_,p,0,h,a,t)}updateTextureData(e,t,i,s,r,n,o=0,a=0,h=!1){const l=this._gl,c=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);let d=l.TEXTURE_2D,_=l.TEXTURE_2D;e.isCube&&(_=l.TEXTURE_CUBE_MAP_POSITIVE_X+o,d=l.TEXTURE_CUBE_MAP),this._bindTextureDirectly(d,e,!0),l.texSubImage2D(_,a,i,s,r,n,u,c,t),h&&this._gl.generateMipmap(_),this._bindTextureDirectly(d,null)}_uploadArrayBufferViewToTexture(e,t,i=0,s=0){const r=this._gl,n=e.isCube?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D;this._bindTextureDirectly(n,e,!0),this._uploadDataToTextureDirectly(e,t,i,s),this._bindTextureDirectly(n,null,!0)}_prepareWebGLTextureContinuation(e,t,i,s,r){const n=this._gl;if(!n)return;const o=this._getSamplingParameters(r,!i);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,o.mag),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,o.min),i||s||n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null),t&&t.removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}_prepareWebGLTexture(e,t,i,s,r,n,o,a,h,l){const u=this.getCaps().maxTextureSize,d=Math.min(u,this.needPOTTextures?(0,c.R)(s.width,u):s.width),_=Math.min(u,this.needPOTTextures?(0,c.R)(s.height,u):s.height),p=this._gl;p&&(e._hardwareTexture?(this._bindTextureDirectly(p.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===r||!!r),e.baseWidth=s.width,e.baseHeight=s.height,e.width=d,e.height=_,e.isReady=!0,e.type=-1!==e.type?e.type:0,e.format=-1!==e.format?e.format:l??(".jpg"!==t||e._useSRGBBuffer?5:4),a(d,_,s,t,e,(()=>{this._prepareWebGLTextureContinuation(e,i,n,o,h)}))||this._prepareWebGLTextureContinuation(e,i,n,o,h)):i&&i.removePendingData(e))}_getInternalFormatFromDepthTextureFormat(e,t,i){const s=this._gl;if(!t)return s.STENCIL_INDEX8;let r=i?s.DEPTH_STENCIL:s.DEPTH_COMPONENT;return this.webGLVersion>1?15===e?r=s.DEPTH_COMPONENT16:16===e?r=s.DEPTH_COMPONENT24:17===e||13===e?r=i?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24:14===e?r=s.DEPTH_COMPONENT32F:18===e&&(r=i?s.DEPTH32F_STENCIL8:s.DEPTH_COMPONENT32F):r=s.DEPTH_COMPONENT16,r}_getWebGLTextureTypeFromDepthTextureFormat(e){const t=this._gl;let i=t.UNSIGNED_INT;return 15===e?i=t.UNSIGNED_SHORT:17===e||13===e?i=t.UNSIGNED_INT_24_8:14===e?i=t.FLOAT:18===e?i=t.FLOAT_32_UNSIGNED_INT_24_8_REV:19===e&&(i=t.UNSIGNED_BYTE),i}_setupFramebufferDepthAttachments(e,t,i,s,r=1,n,o=!1){const a=this._gl;n=n??(e?13:14);const h=this._getInternalFormatFromDepthTextureFormat(n,t,e);return e&&t?this._createRenderBuffer(i,s,r,a.DEPTH_STENCIL,h,o?-1:a.DEPTH_STENCIL_ATTACHMENT):t?this._createRenderBuffer(i,s,r,h,h,o?-1:a.DEPTH_ATTACHMENT):e?this._createRenderBuffer(i,s,r,h,h,o?-1:a.STENCIL_ATTACHMENT):null}_createRenderBuffer(e,t,i,s,r,n,o=!0){const a=this._gl.createRenderbuffer();return this._updateRenderBuffer(a,e,t,i,s,r,n,o)}_updateRenderBuffer(e,t,i,s,r,n,o,a=!0){const h=this._gl;return h.bindRenderbuffer(h.RENDERBUFFER,e),s>1&&h.renderbufferStorageMultisample?h.renderbufferStorageMultisample(h.RENDERBUFFER,s,n,t,i):h.renderbufferStorage(h.RENDERBUFFER,r,t,i),-1!==o&&h.framebufferRenderbuffer(h.FRAMEBUFFER,o,h.RENDERBUFFER,e),a&&h.bindRenderbuffer(h.RENDERBUFFER,null),e}_releaseTexture(e){this._deleteTexture(e._hardwareTexture),this.unbindAllTextures();const t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()}_deleteTexture(e){e?.release()}_setProgram(e){this._currentProgram!==e&&((0,s.C5)(e,this._gl),this._currentProgram=e)}bindSamplers(e){const t=e.getPipelineContext();this._setProgram(t.program);const i=e.getSamplers();for(let t=0;t<i.length;t++){const s=e.getUniform(i[t]);s&&(this._boundUniforms[t]=s)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(e,t,i=!1,s=!1){let n=!1;const o=t&&t._associatedChannel>-1;if(i&&o&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||s){if(this._activateCurrentTexture(),t&&t.isMultiview)throw r.V.Error(["_bindTextureDirectly called with a multiview texture!",e,t]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,t?._hardwareTexture?.underlyingResource??null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else i&&(n=!0,this._activateCurrentTexture());return o&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n}_bindTexture(e,t,i){if(void 0===e)return;t&&(t._associatedChannel=e),this._activeChannel=e;const s=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(s,t)}unbindAllTextures(){for(let e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(e,t,i,s){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))}_bindSamplerUniformToChannel(e,t){const i=this._boundUniforms[e];i&&i._currentState!==t&&(this._gl.uniform1i(i,t),i._currentState=t)}_getTextureWrapMode(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(e,t,i=!1,s=!1,r=""){if(!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video){this._activeChannel=e;const i=t.getInternalTexture();i&&(i._associatedChannel=e),t.update()}else if(4===t.delayLoadState)return t.delayLoad(),!1;let n;n=s?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!i&&n&&(n._associatedChannel=e);let o=!0;this._boundTexturesCache[e]===n&&(i||this._bindSamplerUniformToChannel(n._associatedChannel,e),o=!1),this._activeChannel=e;const a=this._getTextureTarget(n);if(o&&this._bindTextureDirectly(a,n,i),n&&!n.isMultiview){if(n.isCube&&n._cachedCoordinatesMode!==t.coordinatesMode){n._cachedCoordinatesMode=t.coordinatesMode;const e=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=e,t.wrapV=e}n._cachedWrapU!==t.wrapU&&(n._cachedWrapU=t.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),n)),n._cachedWrapV!==t.wrapV&&(n._cachedWrapV=t.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),n)),n.is3D&&n._cachedWrapR!==t.wrapR&&(n._cachedWrapR=t.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),n)),this._setAnisotropicLevel(a,n,t.anisotropicFilteringLevel)}return!0}setTextureArray(e,t,i,s){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(let t=0;t<i.length;t++){const s=i[t].getInternalTexture();s?(this._textureUnits[t]=e+t,s._associatedChannel=e+t):this._textureUnits[t]=-1}this._gl.uniform1iv(t,this._textureUnits);for(let e=0;e<i.length;e++)this._setTexture(this._textureUnits[e],i[e],!0)}}_setAnisotropicLevel(e,t,i){const s=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(i=1),s&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)}_setTextureParameterFloat(e,t,i,s){this._bindTextureDirectly(e,s,!0,!0),this._gl.texParameterf(e,t,i)}_setTextureParameterInteger(e,t,i,s){s&&this._bindTextureDirectly(e,s,!0,!0),this._gl.texParameteri(e,t,i)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else for(let e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){(0,n.BA)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose&&this._gl.getExtension("WEBGL_lose_context")?.loseContext(),(0,s.Cm)(this._gl)}attachContextLostEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)}attachContextRestoredEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(e){const t=this._gl;for(;t.getError()!==t.NO_ERROR;);let i=!0;const s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&n===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);const e=t.RGBA,s=t.UNSIGNED_BYTE,r=new Uint8Array(4);t.readPixels(0,0,1,1,e,s,r),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(s),t.deleteFramebuffer(r),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i}_getWebGLTextureType(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(e,t=!1){let i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:i=this._gl.RED;break;case 7:case 33324:case 36761:i=this._gl.RG;break;case 4:case 32852:case 36762:i=t?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER}return i}_getRGBABufferInternalSizedFormat(e,t,i=!1){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(e,t,i,s,r=!0,n=!0){const o=r?4:3,a=r?this._gl.RGBA:this._gl.RGB,h=new Uint8Array(s*i*o);return n&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,s,a,this._gl.UNSIGNED_BYTE,h),Promise.resolve(h)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const e=u.$._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const e=u.$._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}v._TempClearColorUint32=new Uint32Array(4),v._TempClearColorInt32=new Int32Array(4),v.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],v._ConcatenateShader=g.iL,v._IsSupported=null,v._HasMajorPerformanceCaveat=null},8527:(e,t,i)=>{var s="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,n=s&&r&&"function"==typeof r.get?r.get:null,o=s&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,h=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=a&&h&&"function"==typeof h.get?h.get:null,c=a&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,_="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,g=Object.prototype.toString,f=Function.prototype.toString,m=String.prototype.match,b=String.prototype.slice,v=String.prototype.replace,T=String.prototype.toUpperCase,y=String.prototype.toLowerCase,x=RegExp.prototype.test,A=Array.prototype.concat,C=Array.prototype.join,S=Array.prototype.slice,E=Math.floor,R="function"==typeof BigInt?BigInt.prototype.valueOf:null,P=Object.getOwnPropertySymbols,I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,M="function"==typeof Symbol&&"object"==typeof Symbol.iterator,w="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,O=Object.prototype.propertyIsEnumerable,B=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function D(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||x.call(/e/,t))return t;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var s=e<0?-E(-e):E(e);if(s!==e){var r=String(s),n=b.call(t,r.length+1);return v.call(r,i,"$&_")+"."+v.call(v.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(t,i,"$&_")}var F=i(3966),L=F.custom,N=W(L)?L:null,k={__proto__:null,double:'"',single:"'"},U={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function V(e,t,i){var s=i.quoteStyle||t,r=k[s];return r+e+r}function G(e){return v.call(String(e),/"/g,"&quot;")}function z(e){return!("[object Array]"!==Q(e)||w&&"object"==typeof e&&w in e)}function H(e){return!("[object RegExp]"!==Q(e)||w&&"object"==typeof e&&w in e)}function W(e){if(M)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!I)return!1;try{return I.call(e),!0}catch(e){}return!1}e.exports=function e(t,s,r,a){var h=s||{};if(q(h,"quoteStyle")&&!q(k,h.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(q(h,"maxStringLength")&&("number"==typeof h.maxStringLength?h.maxStringLength<0&&h.maxStringLength!==1/0:null!==h.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var g=!q(h,"customInspect")||h.customInspect;if("boolean"!=typeof g&&"symbol"!==g)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(q(h,"indent")&&null!==h.indent&&"\t"!==h.indent&&!(parseInt(h.indent,10)===h.indent&&h.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(q(h,"numericSeparator")&&"boolean"!=typeof h.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var T=h.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return Y(t,h);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var x=String(t);return T?D(t,x):x}if("bigint"==typeof t){var E=String(t)+"n";return T?D(t,E):E}var P=void 0===h.depth?5:h.depth;if(void 0===r&&(r=0),r>=P&&P>0&&"object"==typeof t)return z(t)?"[Array]":"[Object]";var L,U=function(e,t){var i;if("\t"===e.indent)i="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;i=C.call(Array(e.indent+1)," ")}return{base:i,prev:C.call(Array(t+1),i)}}(h,r);if(void 0===a)a=[];else if(K(a,t)>=0)return"[Circular]";function X(t,i,s){if(i&&(a=S.call(a)).push(i),s){var n={depth:h.depth};return q(h,"quoteStyle")&&(n.quoteStyle=h.quoteStyle),e(t,n,r+1,a)}return e(t,h,r+1,a)}if("function"==typeof t&&!H(t)){var j=function(e){if(e.name)return e.name;var t=m.call(f.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),ie=te(t,X);return"[Function"+(j?": "+j:" (anonymous)")+"]"+(ie.length>0?" { "+C.call(ie,", ")+" }":"")}if(W(t)){var se=M?v.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(t);return"object"!=typeof t||M?se:Z(se)}if((L=t)&&"object"==typeof L&&("undefined"!=typeof HTMLElement&&L instanceof HTMLElement||"string"==typeof L.nodeName&&"function"==typeof L.getAttribute)){for(var re="<"+y.call(String(t.nodeName)),ne=t.attributes||[],oe=0;oe<ne.length;oe++)re+=" "+ne[oe].name+"="+V(G(ne[oe].value),"double",h);return re+=">",t.childNodes&&t.childNodes.length&&(re+="..."),re+"</"+y.call(String(t.nodeName))+">"}if(z(t)){if(0===t.length)return"[]";var ae=te(t,X);return U&&!function(e){for(var t=0;t<e.length;t++)if(K(e[t],"\n")>=0)return!1;return!0}(ae)?"["+ee(ae,U)+"]":"[ "+C.call(ae,", ")+" ]"}if(function(e){return!("[object Error]"!==Q(e)||w&&"object"==typeof e&&w in e)}(t)){var he=te(t,X);return"cause"in Error.prototype||!("cause"in t)||O.call(t,"cause")?0===he.length?"["+String(t)+"]":"{ ["+String(t)+"] "+C.call(he,", ")+" }":"{ ["+String(t)+"] "+C.call(A.call("[cause]: "+X(t.cause),he),", ")+" }"}if("object"==typeof t&&g){if(N&&"function"==typeof t[N]&&F)return F(t,{depth:P-r});if("symbol"!==g&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!n||!e||"object"!=typeof e)return!1;try{n.call(e);try{l.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var le=[];return o&&o.call(t,(function(e,i){le.push(X(i,t,!0)+" => "+X(e,t))})),J("Map",n.call(t),le,U)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e);try{n.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ce=[];return c&&c.call(t,(function(e){ce.push(X(e,t))})),J("Set",l.call(t),ce,U)}if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e,u);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return $("WeakMap");if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{u.call(e,u)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return $("WeakSet");if(function(e){if(!_||!e||"object"!=typeof e)return!1;try{return _.call(e),!0}catch(e){}return!1}(t))return $("WeakRef");if(function(e){return!("[object Number]"!==Q(e)||w&&"object"==typeof e&&w in e)}(t))return Z(X(Number(t)));if(function(e){if(!e||"object"!=typeof e||!R)return!1;try{return R.call(e),!0}catch(e){}return!1}(t))return Z(X(R.call(t)));if(function(e){return!("[object Boolean]"!==Q(e)||w&&"object"==typeof e&&w in e)}(t))return Z(p.call(t));if(function(e){return!("[object String]"!==Q(e)||w&&"object"==typeof e&&w in e)}(t))return Z(X(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&t===globalThis||void 0!==i.g&&t===i.g)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==Q(e)||w&&"object"==typeof e&&w in e)}(t)&&!H(t)){var ue=te(t,X),de=B?B(t)===Object.prototype:t instanceof Object||t.constructor===Object,_e=t instanceof Object?"":"null prototype",pe=!de&&w&&Object(t)===t&&w in t?b.call(Q(t),8,-1):_e?"Object":"",ge=(de||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(pe||_e?"["+C.call(A.call([],pe||[],_e||[]),": ")+"] ":"");return 0===ue.length?ge+"{}":U?ge+"{"+ee(ue,U)+"}":ge+"{ "+C.call(ue,", ")+" }"}return String(t)};var X=Object.prototype.hasOwnProperty||function(e){return e in this};function q(e,t){return X.call(e,t)}function Q(e){return g.call(e)}function K(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,s=e.length;i<s;i++)if(e[i]===t)return i;return-1}function Y(e,t){if(e.length>t.maxStringLength){var i=e.length-t.maxStringLength,s="... "+i+" more character"+(i>1?"s":"");return Y(b.call(e,0,t.maxStringLength),t)+s}var r=U[t.quoteStyle||"single"];return r.lastIndex=0,V(v.call(v.call(e,r,"\\$1"),/[\x00-\x1f]/g,j),"single",t)}function j(e){var t=e.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return i?"\\"+i:"\\x"+(t<16?"0":"")+T.call(t.toString(16))}function Z(e){return"Object("+e+")"}function $(e){return e+" { ? }"}function J(e,t,i,s){return e+" ("+t+") {"+(s?ee(i,s):C.call(i,", "))+"}"}function ee(e,t){if(0===e.length)return"";var i="\n"+t.prev+t.base;return i+C.call(e,","+i)+"\n"+t.prev}function te(e,t){var i=z(e),s=[];if(i){s.length=e.length;for(var r=0;r<e.length;r++)s[r]=q(e,r)?t(e[r],e):""}var n,o="function"==typeof P?P(e):[];if(M){n={};for(var a=0;a<o.length;a++)n["$"+o[a]]=o[a]}for(var h in e)q(e,h)&&(i&&String(Number(h))===h&&h<e.length||M&&n["$"+h]instanceof Symbol||(x.call(/[^\w$]/,h)?s.push(t(h,e)+": "+t(e[h],e)):s.push(h+": "+t(e[h],e))));if("function"==typeof P)for(var l=0;l<o.length;l++)O.call(e,o[l])&&s.push("["+t(o[l])+"]: "+t(e[o[l]],e));return s}},8551:(e,t,i)=>{"use strict";i.d(t,{I:()=>r});var s=i(35);class r extends s.g{constructor(e,t,i,r,n,o=!0,a=!1,h=3,l=0,c,u,d){super(null,n,!o,a,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c),this.format=r,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==l||(h=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==l||(h=1),this._texture=this._engine.createRawTexture(e,t,i,r,o,a,h,null,l,c??0,u??!1),this.wrapU=s.g.CLAMP_ADDRESSMODE,this.wrapV=s.g.CLAMP_ADDRESSMODE,this._waitingForData=!!d&&!e)}update(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const e=new r(null,this.getSize().width,this.getSize().height,this.format,this.getScene(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return e._texture=this._texture,this._texture.incrementReferences(),e}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(e,t,i,s,n=!0,o=!1,a=3){return new r(e,t,i,1,s,n,o,a)}static CreateLuminanceAlphaTexture(e,t,i,s,n=!0,o=!1,a=3){return new r(e,t,i,2,s,n,o,a)}static CreateAlphaTexture(e,t,i,s,n=!0,o=!1,a=3){return new r(e,t,i,0,s,n,o,a)}static CreateRGBTexture(e,t,i,s,n=!0,o=!1,a=3,h=0,l=0,c=!1){return new r(e,t,i,4,s,n,o,a,h,l,c)}static CreateRGBATexture(e,t,i,s,n=!0,o=!1,a=3,h=0,l=0,c=!1,u=!1){return new r(e,t,i,5,s,n,o,a,h,l,c,u)}static CreateRGBAStorageTexture(e,t,i,s,n=!0,o=!1,a=3,h=0,l=!1){return new r(e,t,i,5,s,n,o,a,h,1,l)}static CreateRTexture(e,t,i,n,o=!0,a=!1,h=s.g.TRILINEAR_SAMPLINGMODE,l=1){return new r(e,t,i,6,n,o,a,h,l)}static CreateRStorageTexture(e,t,i,n,o=!0,a=!1,h=s.g.TRILINEAR_SAMPLINGMODE,l=1){return new r(e,t,i,6,n,o,a,h,l,1)}}},8615:(e,t,i)=>{"use strict";i.d(t,{W0:()=>o,iL:()=>n,kZ:()=>h,sg:()=>r,xt:()=>a});var s=i(2213);i(4920);const r={};function n(e,t,i=""){return i+(t?t+"\n":"")+e}function o(e,t,i,n,o,a,h){const l=h||r.loadFile;if(l)return l(e,t,i,n,o,a);throw(0,s.n)("FileTools")}function a(e,t,i,s){if(e)return t?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,i?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(s?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return t&&(e+="#define IS_NDC_HALF_ZRANGE"),i&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),s&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}function h(e,t,i=!1,s){switch(e){case 3:{const e=(ArrayBuffer,new Int8Array(t));return s&&e.set(new Int8Array(s)),e}case 0:{const e=(ArrayBuffer,new Uint8Array(t));return s&&e.set(new Uint8Array(s)),e}case 4:{const e=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(i?t/2:t);return s&&e.set(new Int16Array(s)),e}case 5:case 8:case 9:case 10:case 2:{const e=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(i?t/2:t);return s&&e.set(new Uint16Array(s)),e}case 6:{const e=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(i?t/4:t);return s&&e.set(new Int32Array(s)),e}case 7:case 11:case 12:case 13:case 14:case 15:{const e=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(i?t/4:t);return s&&e.set(new Uint32Array(s)),e}case 1:{const e=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(i?t/4:t);return s&&e.set(new Float32Array(s)),e}}const r=(ArrayBuffer,new Uint8Array(t));return s&&r.set(new Uint8Array(s)),r}},8795:(e,t,i)=>{"use strict";i.d(t,{rX:()=>s});let s=!1},8827:(e,t,i)=>{"use strict";i.d(t,{j:()=>r});var s=i(4920);class r{static get Now(){return(0,s.BA)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},8836:(e,t,i)=>{"use strict";i.d(t,{Z:()=>$});var s=i(9732),r=i(8827),n=i(3054),o=i(1425);class a{constructor(){this._count=0,this._data={}}copyFrom(e){this.clear(),e.forEach(((e,t)=>this.add(e,t)))}get(e){const t=this._data[e];if(void 0!==t)return t}getOrAddWithFactory(e,t){let i=this.get(e);return void 0!==i||(i=t(e),i&&this.add(e,i)),i}getOrAdd(e,t){const i=this.get(e);return void 0!==i?i:(this.add(e,t),t)}contains(e){return void 0!==this._data[e]}add(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)}set(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)}getAndRemove(e){const t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null}remove(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(e){for(const t in this._data)e(t,this._data[t])}first(e){for(const t in this._data){const i=e(t,this._data[t]);if(i)return i}return null}}var h=i(641),l=i(4049),c=i(3550),u=i(7893),d=i(109);class _{constructor(e,t,i,s,r,n){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=s,this.sourceEvent=r,this.additionalData=n}static CreateNew(e,t,i){const s=e.getScene();return new _(e,s.pointerX,s.pointerY,s.meshUnderPointer||e,t,i)}static CreateNewFromSprite(e,t,i,s){return new _(e,t.pointerX,t.pointerY,t.meshUnderPointer,i,s)}static CreateNewFromScene(e,t){return new _(null,e.pointerX,e.pointerY,e.meshUnderPointer,t)}static CreateNewFromPrimitive(e,t,i,s){return new _(e,t.x,t.y,null,i,s)}}var p=i(8442),g=i(117),f=i(4271),m=i(4920),b=i(1497),v=i(2213),T=i(3846);class y{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const e in y.Triggers)if(Object.prototype.hasOwnProperty.call(y.Triggers,e))return!0;return!1}static get HasPickTriggers(){for(const e in y.Triggers)if(Object.prototype.hasOwnProperty.call(y.Triggers,e)){const t=parseInt(e);if(t>=1&&t<=7)return!0}return!1}static HasSpecificTrigger(e){for(const t in y.Triggers)if(Object.prototype.hasOwnProperty.call(y.Triggers,t)&&parseInt(t)===e)return!0;return!1}}y.Triggers={};var x,A,C,S,E,R,P,I=i(7904);!function(e){e[e.Generic=0]="Generic",e[e.Keyboard=1]="Keyboard",e[e.Mouse=2]="Mouse",e[e.Touch=3]="Touch",e[e.DualShock=4]="DualShock",e[e.Xbox=5]="Xbox",e[e.Switch=6]="Switch",e[e.DualSense=7]="DualSense"}(x||(x={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.Move=12]="Move"}(A||(A={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.DeltaHorizontal=10]="DeltaHorizontal",e[e.DeltaVertical=11]="DeltaVertical"}(C||(C={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(S||(S={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Create=8]="Create",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(E||(E={})),function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.LT=6]="LT",e[e.RT=7]="RT",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.LStickXAxis=17]="LStickXAxis",e[e.LStickYAxis=18]="LStickYAxis",e[e.RStickXAxis=19]="RStickXAxis",e[e.RStickYAxis=20]="RStickYAxis"}(R||(R={})),function(e){e[e.B=0]="B",e[e.A=1]="A",e[e.Y=2]="Y",e[e.X=3]="X",e[e.L=4]="L",e[e.R=5]="R",e[e.ZL=6]="ZL",e[e.ZR=7]="ZR",e[e.Minus=8]="Minus",e[e.Plus=9]="Plus",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.Capture=17]="Capture",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(P||(P={}));var M=i(9169);class w{static CreateDeviceEvent(e,t,i,s,r,n,o){switch(e){case x.Keyboard:return this._CreateKeyboardEvent(i,s,r,n);case x.Mouse:if(i===A.MouseWheelX||i===A.MouseWheelY||i===A.MouseWheelZ)return this._CreateWheelEvent(e,t,i,s,r,n);case x.Touch:return this._CreatePointerEvent(e,t,i,s,r,n,o);default:throw`Unable to generate event for device ${x[e]}`}}static _CreatePointerEvent(e,t,i,s,r,n,o){const a=this._CreateMouseEvent(e,t,i,s,r,n);e===x.Mouse?(a.deviceType=x.Mouse,a.pointerId=1,a.pointerType="mouse"):(a.deviceType=x.Touch,a.pointerId=o??t,a.pointerType="touch");let h=0;return h+=r.pollInput(e,t,A.LeftClick),h+=2*r.pollInput(e,t,A.RightClick),h+=4*r.pollInput(e,t,A.MiddleClick),a.buttons=h,i===A.Move?a.type="pointermove":i>=A.LeftClick&&i<=A.RightClick&&(a.type=1===s?"pointerdown":"pointerup",a.button=i-2),a}static _CreateWheelEvent(e,t,i,s,r,n){const o=this._CreateMouseEvent(e,t,i,s,r,n);switch(o.pointerId=1,o.type="wheel",o.deltaMode=M.s.DOM_DELTA_PIXEL,o.deltaX=0,o.deltaY=0,o.deltaZ=0,i){case A.MouseWheelX:o.deltaX=s;break;case A.MouseWheelY:o.deltaY=s;break;case A.MouseWheelZ:o.deltaZ=s}return o}static _CreateMouseEvent(e,t,i,s,r,n){const o=this._CreateEvent(n),a=r.pollInput(e,t,A.Horizontal),h=r.pollInput(e,t,A.Vertical);return n?(o.movementX=0,o.movementY=0,o.offsetX=o.movementX-n.getBoundingClientRect().x,o.offsetY=o.movementY-n.getBoundingClientRect().y):(o.movementX=r.pollInput(e,t,10),o.movementY=r.pollInput(e,t,11),o.offsetX=0,o.offsetY=0),this._CheckNonCharacterKeys(o,r),o.clientX=a,o.clientY=h,o.x=a,o.y=h,o.deviceType=e,o.deviceSlot=t,o.inputIndex=i,o}static _CreateKeyboardEvent(e,t,i,s){const r=this._CreateEvent(s);return this._CheckNonCharacterKeys(r,i),r.deviceType=x.Keyboard,r.deviceSlot=0,r.inputIndex=e,r.type=1===t?"keydown":"keyup",r.key=String.fromCharCode(e),r.keyCode=e,r}static _CheckNonCharacterKeys(e,t){const i=t.isDeviceAvailable(x.Keyboard),s=i&&1===t.pollInput(x.Keyboard,0,18),r=i&&1===t.pollInput(x.Keyboard,0,17),n=i&&(1===t.pollInput(x.Keyboard,0,91)||1===t.pollInput(x.Keyboard,0,92)||1===t.pollInput(x.Keyboard,0,93)),o=i&&1===t.pollInput(x.Keyboard,0,16);e.altKey=s,e.ctrlKey=r,e.metaKey=n,e.shiftKey=o}static _CreateEvent(e){const t={preventDefault:()=>{}};return t.target=e,t}}class O{constructor(e,t,i){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,((e,t,s,r)=>{const n=w.CreateDeviceEvent(e,t,s,r,this);i(e,t,n)})):this._createDummyNativeInput()}pollInput(e,t,i){return this._nativeInput.pollInput(e,t,i)}isDeviceAvailable(e){return e===x.Mouse||e===x.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const B=Object.keys(A).length/2;class D{constructor(e,t,i,r){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=s.S0.IsSafari(),this._usingMacOS=(0,m.XD)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=e=>{},this._keyboardUpEvent=e=>{},this._keyboardBlurEvent=e=>{},this._pointerMoveEvent=e=>{},this._pointerDownEvent=e=>{},this._pointerUpEvent=e=>{},this._pointerCancelEvent=e=>{},this._pointerCancelTouch=e=>{},this._pointerLeaveEvent=e=>{},this._pointerWheelEvent=e=>{},this._pointerBlurEvent=e=>{},this._pointerMacOSChromeOutEvent=e=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,m.XD)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,m.XD)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=e=>{},this._gamepadDisconnectedEvent=e=>{},this._eventPrefix=s.S0.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=i,this._onInputChanged=r,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(e,t,i){const r=this._inputs[e][t];if(!r)throw`Unable to find device ${x[e]}`;e>=x.DualShock&&e<=x.DualSense&&this._updateDevice(e,t,i);const n=r[i];if(void 0===n)throw`Unable to find input ${i} for device ${x[e]} in slot ${t}`;return i===A.Move&&s.S0.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),n}isDeviceAvailable(e){return void 0!==this._inputs[e]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const e=this?._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs)for(const e of this._inputs)if(e)for(const t in e){const i=e[+t];if(i)for(let e=0;e<i.length;e++)i[e]=0}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const e=navigator.getGamepads();for(const t of e)t&&this._addGamePad(t)}"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(x.Mouse,0,0,0)}_addGamePad(e){const t=this._getGamepadDeviceType(e.id),i=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,i,e.buttons.length+e.axes.length),this._gamepads[i]=t}_addPointerDevice(e,t,i,s){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,B);const r=this._inputs[e][t];r[0]=i,r[1]=s}_registerDevice(e,t,i){if(void 0===t)throw`Unable to register device ${x[e]} to undefined slot.`;if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){const s=new Array(i);s.fill(0),this._inputs[e][t]=s,this._onDeviceConnected(e,t)}}_unregisterDevice(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))}_handleKeyActions(){this._keyboardDownEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(x.Keyboard,0,255));const t=this._inputs[x.Keyboard][0];if(t){t[e.keyCode]=1;const i=e;i.inputIndex=e.keyCode,this._usingMacOS&&e.metaKey&&"Meta"!==e.key&&(this._metaKeys.includes(e.keyCode)||this._metaKeys.push(e.keyCode)),this._onInputChanged(x.Keyboard,0,i)}},this._keyboardUpEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(x.Keyboard,0,255));const t=this._inputs[x.Keyboard][0];if(t){t[e.keyCode]=0;const i=e;if(i.inputIndex=e.keyCode,this._usingMacOS&&"Meta"===e.key&&this._metaKeys.length>0){for(const e of this._metaKeys){const i=w.CreateDeviceEvent(x.Keyboard,0,e,0,this,this._elementToAttachTo);t[e]=0,this._onInputChanged(x.Keyboard,0,i)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(x.Keyboard,0,i)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const e=this._inputs[x.Keyboard][0];for(let t=0;t<e.length;t++)if(0!==e[t]){e[t]=0;const i=w.CreateDeviceEvent(x.Keyboard,0,t,0,this,this._elementToAttachTo);this._onInputChanged(x.Keyboard,0,i)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,m.XD)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let e=0;e<this._maxTouchPoints;e++)this._activeTouchIds[e]=-1;this._pointerMoveEvent=e=>{const t=this._getPointerType(e);let i=t===x.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===x.Touch&&-1===i){const r=this._activeTouchIds.indexOf(-1);if(!(r>=0))return void s.S0.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);i=r,this._activeTouchIds[r]=e.pointerId,this._onDeviceConnected(t,i)}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]||this._addPointerDevice(t,i,e.clientX,e.clientY);const r=this._inputs[t][i];if(r){const s=e;s.inputIndex=A.Move,r[A.Horizontal]=e.clientX,r[A.Vertical]=e.clientY,t===x.Touch&&0===r[A.LeftClick]&&(r[A.LeftClick]=1),void 0===e.pointerId&&(e.pointerId=this._mouseId),this._onInputChanged(t,i,s),this._usingSafari||-1===e.button||(s.inputIndex=e.button+2,r[e.button+2]=r[e.button+2]?0:1,this._onInputChanged(t,i,s))}},this._pointerDownEvent=e=>{const t=this._getPointerType(e);let i=t===x.Mouse?0:e.pointerId;if(t===x.Touch){let t=this._activeTouchIds.indexOf(e.pointerId);if(-1===t&&(t=this._activeTouchIds.indexOf(-1)),!(t>=0))return void s.S0.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);i=t,this._activeTouchIds[t]=e.pointerId}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]?t===x.Touch&&this._onDeviceConnected(t,i):this._addPointerDevice(t,i,e.clientX,e.clientY);const r=this._inputs[t][i];if(r){const s=r[A.Horizontal],n=r[A.Vertical];if(t===x.Mouse){if(void 0===e.pointerId&&(e.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(e){}}else if(e.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(e.pointerId)}catch(e){}r[A.Horizontal]=e.clientX,r[A.Vertical]=e.clientY,r[e.button+2]=1;const o=e;o.inputIndex=e.button+2,this._onInputChanged(t,i,o),s===e.clientX&&n===e.clientY||(o.inputIndex=A.Move,this._onInputChanged(t,i,o))}},this._pointerUpEvent=e=>{const t=this._getPointerType(e),i=t===x.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===x.Touch){if(-1===i)return;this._activeTouchIds[i]=-1}const s=this._inputs[t]?.[i];if(s&&0!==s[e.button+2]){const r=s[A.Horizontal],n=s[A.Vertical];s[A.Horizontal]=e.clientX,s[A.Vertical]=e.clientY,s[e.button+2]=0;const o=e;void 0===e.pointerId&&(e.pointerId=this._mouseId),r===e.clientX&&n===e.clientY||(o.inputIndex=A.Move,this._onInputChanged(t,i,o)),o.inputIndex=e.button+2,t===x.Mouse&&this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):e.pointerId&&this._elementToAttachTo.hasPointerCapture?.(e.pointerId)&&this._elementToAttachTo.releasePointerCapture(e.pointerId),this._onInputChanged(t,i,o),t===x.Touch&&this._onDeviceDisconnected(t,i)}},this._pointerCancelTouch=e=>{const t=this._activeTouchIds.indexOf(e);if(-1===t)return;this._elementToAttachTo.hasPointerCapture?.(e)&&this._elementToAttachTo.releasePointerCapture(e),this._inputs[x.Touch][t][A.LeftClick]=0;const i=w.CreateDeviceEvent(x.Touch,t,A.LeftClick,0,this,this._elementToAttachTo,e);this._onInputChanged(x.Touch,t,i),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(x.Touch,t)},this._pointerCancelEvent=e=>{if("mouse"===e.pointerType){const e=this._inputs[x.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=A.LeftClick;t<=A.BrowserForward;t++)if(1===e[t]){e[t]=0;const i=w.CreateDeviceEvent(x.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(x.Mouse,0,i)}}else this._pointerCancelTouch(e.pointerId)},this._pointerLeaveEvent=e=>{"pen"===e.pointerType&&this._pointerCancelTouch(e.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let e=!1;const t=function(){};try{const i=Object.defineProperty({},"passive",{get:function(){e=!0}});this._elementToAttachTo.addEventListener("test",t,i),this._elementToAttachTo.removeEventListener("test",t,i)}catch(e){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(x.Mouse)){const e=this._inputs[x.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=A.LeftClick;t<=A.BrowserForward;t++)if(1===e[t]){e[t]=0;const i=w.CreateDeviceEvent(x.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(x.Mouse,0,i)}}if(this.isDeviceAvailable(x.Touch)){const e=this._inputs[x.Touch];for(let t=0;t<this._activeTouchIds.length;t++){const i=this._activeTouchIds[t];if(this._elementToAttachTo.hasPointerCapture?.(i)&&this._elementToAttachTo.releasePointerCapture(i),-1!==i&&1===e[t]?.[A.LeftClick]){e[t][A.LeftClick]=0;const s=w.CreateDeviceEvent(x.Touch,t,A.LeftClick,0,this,this._elementToAttachTo,i);this._onInputChanged(x.Touch,t,s),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(x.Touch,t)}}}},this._pointerWheelEvent=e=>{const t=x.Mouse;this._inputs[t]||(this._inputs[t]=[]),this._inputs[t][0]||(this._pointerActive=!0,this._registerDevice(t,0,B));const i=this._inputs[t][0];if(i){i[A.MouseWheelX]=e.deltaX||0,i[A.MouseWheelY]=e.deltaY||e.wheelDelta||0,i[A.MouseWheelZ]=e.deltaZ||0;const s=e;void 0===e.pointerId&&(e.pointerId=this._mouseId),0!==i[A.MouseWheelX]&&(s.inputIndex=A.MouseWheelX,this._onInputChanged(t,0,s)),0!==i[A.MouseWheelY]&&(s.inputIndex=A.MouseWheelY,this._onInputChanged(t,0,s)),0!==i[A.MouseWheelZ]&&(s.inputIndex=A.MouseWheelZ,this._onInputChanged(t,0,s))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=e=>{e.buttons>1&&this._pointerCancelEvent(e)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!e&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(x.Mouse)){const e=this._inputs[x.Mouse][0];e[A.MouseWheelX]=0,e[A.MouseWheelY]=0,e[A.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=e=>{this._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=e=>{if(this._gamepads){const t=this._getGamepadDeviceType(e.gamepad.id),i=e.gamepad.index;this._unregisterDevice(t,i),delete this._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(e,t,i){const s=navigator.getGamepads()[t];if(s&&e===this._gamepads[t]){const r=this._inputs[e][t];i>=s.buttons.length?r[i]=s.axes[i-s.buttons.length].valueOf():r[i]=s.buttons[i].value}}_getGamepadDeviceType(e){return-1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?x.DualSense:x.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?x.Xbox:-1!==e.indexOf("057e")?x.Switch:x.Generic}_getPointerType(e){let t=x.Mouse;return("touch"===e.pointerType||"pen"===e.pointerType||e.touches)&&(t=x.Touch),t}}class F{constructor(e,t,i=0){this.deviceType=t,this.deviceSlot=i,this.onInputChangedObservable=new n.cP,this._deviceInputSystem=e}getInput(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)}}class L{constructor(e){this._registeredManagers=new Array,this._refCount=0,this.registerManager=e=>{for(let t=0;t<this._devices.length;t++){const i=this._devices[t];for(const s in i){const i=+s;e._addDevice(new F(this._deviceInputSystem,t,i))}}this._registeredManagers.push(e)},this.unregisterManager=e=>{const t=this._registeredManagers.indexOf(e);t>-1&&this._registeredManagers.splice(t,1)};const t=Object.keys(x).length/2;this._devices=new Array(t);const i=(e,t)=>{this._devices[e]||(this._devices[e]=new Array),this._devices[e][t]||(this._devices[e][t]=t);for(const i of this._registeredManagers){const s=new F(this._deviceInputSystem,e,t);i._addDevice(s)}},s=(e,t)=>{this._devices[e]?.[t]&&delete this._devices[e][t];for(const i of this._registeredManagers)i._removeDevice(e,t)},r=(e,t,i)=>{if(i)for(const s of this._registeredManagers)s._onInputChanged(e,t,i)};"undefined"!=typeof _native?this._deviceInputSystem=new O(i,s,r):this._deviceInputSystem=new D(e,i,s,r)}dispose(){this._deviceInputSystem.dispose()}}class N{getDeviceSource(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null}getDeviceSources(e){return this._devices[e]?this._devices[e].filter((e=>!!e)):[]}constructor(e){const t=Object.keys(x).length/2;this._devices=new Array(t),this._firstDevice=new Array(t),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new L(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new n.cP((e=>{for(const t of this._devices)if(t)for(const i of t)i&&this.onDeviceConnectedObservable.notifyObserver(e,i)})),this.onDeviceDisconnectedObservable=new n.cP,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}_addDevice(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)}_removeDevice(e,t){const i=this._devices[e]?.[t];this.onDeviceDisconnectedObservable.notifyObservers(i),this._devices[e]?.[t]&&delete this._devices[e][t],this._updateFirstDevices(e)}_onInputChanged(e,t,i){this._devices[e]?.[t]?.onInputChangedObservable.notifyObservers(i)}_updateFirstDevices(e){switch(e){case x.Keyboard:case x.Mouse:this._firstDevice[e]=0;break;case x.Touch:case x.DualSense:case x.DualShock:case x.Xbox:case x.Switch:case x.Generic:{delete this._firstDevice[e];const t=this._devices[e];if(t)for(let i=0;i<t.length;i++)if(t[i]){this._firstDevice[e]=i;break}break}}}}var k=i(2631);class U{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(e){this._singleClick=e}set doubleClick(e){this._doubleClick=e}set hasSwiped(e){this._hasSwiped=e}set ignore(e){this._ignore=e}}class V{constructor(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new l.I9(0,0),this._previousStartingPointerPosition=new l.I9(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||b.q.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}get unTranslatedPointer(){return new l.I9(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(e){this._pointerX=e}get pointerY(){return this._pointerY}set pointerY(e){this._pointerY=e}_updatePointerPosition(e){const t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(e,t){const i=this._scene,s=i.getEngine(),r=s.getInputElement();r&&(r.tabIndex=s.canvasTabIndex,i.doNotHandleCursors||(r.style.cursor=i.defaultCursor)),this._setCursorAndPointerOverMesh(e,t,i);for(const s of i._pointerMoveStage){e=e||this._pickMove(t);const i=!!e?.pickedMesh;e=s.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,r)}const n=t.inputIndex>=A.MouseWheelX&&t.inputIndex<=A.MouseWheelZ?T.Zp.POINTERWHEEL:T.Zp.POINTERMOVE;let o;i.onPointerMove&&(e=e||this._pickMove(t),i.onPointerMove(t,e,n)),e?(o=new T.mx(n,t,e),this._setRayOnPointerInfo(e,t)):(o=new T.mx(n,t,null,this),this._movePointerInfo=o),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(o,n)}_setRayOnPointerInfo(e,t){const i=this._scene;e&&k.h._IsPickingAvailable&&(e.ray||(e.ray=i.createPickingRay(t.offsetX,t.offsetY,l.uq.Identity(),i.activeCamera)))}_addCameraPointerObserver(e,t){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,t)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(e,t,i){const s=this._scene,r=new T.tT(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(r.originalPickingInfo=e,r.ray=e.ray,"xr-near"===t.pointerType&&e.originMesh&&(r.nearInteractionPickingInfo=e)),s.onPrePointerObservable.notifyObservers(r,i),!!r.skipOnPointerObservable}_pickMove(e){const t=this._scene,i=t.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerMovePredicate,t.pointerMoveFastCheck,t.cameraToUseForPointers,t.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(i,e,t),i}_setCursorAndPointerOverMesh(e,t,i){const s=i.getEngine().getInputElement();if(e?.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,t.pointerId,e,t),!i.doNotHandleCursors&&s&&this._pointerOverMesh){const e=this._pointerOverMesh._getActionManagerForTrigger();e&&e.hasPointerTriggers&&(s.style.cursor=e.hoverCursor||i.hoverCursor)}}else this.setPointerOverMesh(null,t.pointerId,e,t)}simulatePointerMove(e,t){const i=new PointerEvent("pointermove",t);i.inputIndex=A.Move,this._checkPrePointerObservable(e,i,T.Zp.POINTERMOVE)||this._processPointerMove(e,i)}simulatePointerDown(e,t){const i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,this._checkPrePointerObservable(e,i,T.Zp.POINTERDOWN)||this._processPointerDown(e,i)}_processPointerDown(e,t){const i=this._scene;if(e?.pickedMesh){this._pickedDownMesh=e.pickedMesh;const s=e.pickedMesh._getActionManagerForTrigger();if(s){if(s.hasPickTriggers)switch(s.processTrigger(5,new _(e.pickedMesh,i.pointerX,i.pointerY,e.pickedMesh,t,e)),t.button){case 0:s.processTrigger(2,new _(e.pickedMesh,i.pointerX,i.pointerY,e.pickedMesh,t,e));break;case 1:s.processTrigger(4,new _(e.pickedMesh,i.pointerX,i.pointerY,e.pickedMesh,t,e));break;case 2:s.processTrigger(3,new _(e.pickedMesh,i.pointerX,i.pointerY,e.pickedMesh,t,e))}s.hasSpecificTrigger(8)&&window.setTimeout((()=>{const e=i.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,(e=>e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===this._pickedDownMesh),!1,i.cameraToUseForPointers);e?.pickedMesh&&s&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>V.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,s.processTrigger(8,_.CreateNew(e.pickedMesh,t)))}),V.LongPressDelay)}}else for(const s of i._pointerDownStage)e=s.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,!1);let s;const r=T.Zp.POINTERDOWN;e?(i.onPointerDown&&i.onPointerDown(t,e,r),s=new T.mx(r,t,e),this._setRayOnPointerInfo(e,t)):s=new T.mx(r,t,null,this),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(s,r)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(e,t,i){const s=new PointerEvent("pointerup",t);s.inputIndex=A.Move;const r=new U;i?r.doubleClick=!0:r.singleClick=!0,this._checkPrePointerObservable(e,s,T.Zp.POINTERUP)||this._processPointerUp(e,s,r)}_processPointerUp(e,t,i){const s=this._scene;if(e?.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(s.onPointerPick&&s.onPointerPick(t,e),i.singleClick&&!i.ignore&&s.onPointerObservable.observers.length>this._cameraObserverCount)){const i=T.Zp.POINTERPICK,r=new T.mx(i,t,e);this._setRayOnPointerInfo(e,t),s.onPointerObservable.notifyObservers(r,i)}const r=e.pickedMesh._getActionManagerForTrigger();if(r&&!i.ignore){r.processTrigger(7,_.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&r.processTrigger(1,_.CreateNew(e.pickedMesh,t,e));const s=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&s&&s.processTrigger(6,_.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(const r of s._pointerUpStage)e=r.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,i.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const e=this._pickedDownMesh._getActionManagerForTrigger(16);e&&e.processTrigger(16,_.CreateNew(this._pickedDownMesh,t))}if(!i.ignore){const r=new T.mx(T.Zp.POINTERUP,t,e);if(this._setRayOnPointerInfo(e,t),s.onPointerObservable.notifyObservers(r,T.Zp.POINTERUP),s.onPointerUp&&s.onPointerUp(t,e,T.Zp.POINTERUP),!i.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let r=0;if(i.singleClick?r=T.Zp.POINTERTAP:i.doubleClick&&(r=T.Zp.POINTERDOUBLETAP),r){const i=new T.mx(r,t,e);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(r)&&s.onPointerObservable.notifyObservers(i,r)}}}}isPointerCaptured(e=0){return this._pointerCaptures[e]}attachControl(e=!0,t=!0,i=!0,s=null){const r=this._scene,n=r.getEngine();s||(s=n.getInputElement()),this._alreadyAttached&&this.detachControl(),s&&(this._alreadyAttachedTo=s),this._deviceSourceManager=new N(n),this._initActionManager=e=>{if(!this._meshPickProceed){const t=r.skipPointerUpPicking||0===r._registeredActions&&!this._checkForPicking()&&!r.onPointerUp?null:r.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,r.pointerUpPredicate,r.pointerUpFastCheck,r.cameraToUseForPointers,r.pointerUpTrianglePredicate);this._currentPickResult=t,t&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return e},this._delayedSimpleClick=(e,t,i)=>{if((Date.now()-this._previousStartingPointerTime>V.DoubleClickDelay&&!this._doubleClickOccured||e!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,this._delayedClicks[e])){const t=this._delayedClicks[e].evt,i=T.Zp.POINTERTAP,s=new T.mx(i,t,this._currentPickResult);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(i)&&r.onPointerObservable.notifyObservers(s,i),this._delayedClicks[e]=null}},this._initClickEvent=(e,t,i,s)=>{const r=new U;this._currentPickResult=null;let n=null,o=e.hasSpecificMask(T.Zp.POINTERPICK)||t.hasSpecificMask(T.Zp.POINTERPICK)||e.hasSpecificMask(T.Zp.POINTERTAP)||t.hasSpecificMask(T.Zp.POINTERTAP)||e.hasSpecificMask(T.Zp.POINTERDOUBLETAP)||t.hasSpecificMask(T.Zp.POINTERDOUBLETAP);!o&&y&&(n=this._initActionManager(n,r),n&&(o=n.hasPickTriggers));let a=!1;if(o=o&&!this._isMultiTouchGesture,o){const o=i.button;if(r.hasSwiped=this._isPointerSwiping(),!r.hasSwiped){let h=!V.ExclusiveDoubleClickMode;if(h||(h=!e.hasSpecificMask(T.Zp.POINTERDOUBLETAP)&&!t.hasSpecificMask(T.Zp.POINTERDOUBLETAP),h&&!y.HasSpecificTrigger(6)&&(n=this._initActionManager(n,r),n&&(h=!n.hasSpecificTrigger(6)))),h)(Date.now()-this._previousStartingPointerTime>V.DoubleClickDelay||o!==this._previousButtonPressed)&&(r.singleClick=!0,s(r,this._currentPickResult),a=!0);else{const e={evt:i,clickInfo:r,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,o,r,s),V.DoubleClickDelay)};this._delayedClicks[o]=e}let l=e.hasSpecificMask(T.Zp.POINTERDOUBLETAP)||t.hasSpecificMask(T.Zp.POINTERDOUBLETAP);!l&&y.HasSpecificTrigger(6)&&(n=this._initActionManager(n,r),n&&(l=n.hasSpecificTrigger(6))),l&&(o===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<V.DoubleClickDelay&&!this._doubleClickOccured?(r.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=o,V.ExclusiveDoubleClickMode?(this._delayedClicks[o]&&(clearTimeout(this._delayedClicks[o]?.timeoutId),this._delayedClicks[o]=null),s(r,this._previousPickResult)):s(r,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,r.doubleClick=!0,r.ignore=!1,V.ExclusiveDoubleClickMode&&this._delayedClicks[o]&&(clearTimeout(this._delayedClicks[o]?.timeoutId),this._delayedClicks[o]=null),s(r,this._currentPickResult)),a=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=o))}}a||s(r,this._currentPickResult)},this._onPointerMove=e=>{if(this._updatePointerPosition(e),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>V.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>V.DragMovementThreshold),n.isPointerLock&&n._verifyPointerLock(),this._checkPrePointerObservable(null,e,e.inputIndex>=A.MouseWheelX&&e.inputIndex<=A.MouseWheelZ?T.Zp.POINTERWHEEL:T.Zp.POINTERMOVE))return;if(!r.cameraToUseForPointers&&!r.activeCamera)return;if(r.skipPointerMovePicking)return void this._processPointerMove(new d.G,e);r.pointerMovePredicate||(r.pointerMovePredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||r.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!r.cameraToUseForPointers||!!(r.cameraToUseForPointers.layerMask&e.layerMask)));const t=r._registeredActions>0||r.constantlyUpdateMeshUnderPointer?this._pickMove(e):null;this._processPointerMove(t,e)},this._onPointerDown=e=>{const t=this._activePointerIds.indexOf(-1);if(-1===t?this._activePointerIds.push(e.pointerId):this._activePointerIds[t]=e.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,V.ExclusiveDoubleClickMode)for(let t=0;t<this._delayedClicks.length;t++)if(this._delayedClicks[t])if(e.button===t)clearTimeout(this._delayedClicks[t]?.timeoutId);else{const e=this._delayedClicks[t].clickInfo;this._doubleClickOccured=!1,e.singleClick=!0,e.ignore=!1;const i=this._delayedClicks[t].evt,s=T.Zp.POINTERTAP,n=new T.mx(s,i,this._currentPickResult);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(s)&&r.onPointerObservable.notifyObservers(n,s),this._delayedClicks[t]=null}if(this._updatePointerPosition(e),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=e.button),r.preventDefaultOnPointerDown&&s&&(e.preventDefault(),s.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,e,T.Zp.POINTERDOWN))return;if(!r.cameraToUseForPointers&&!r.activeCamera)return;let i;this._pointerCaptures[e.pointerId]=!0,r.pointerDownPredicate||(r.pointerDownPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!r.cameraToUseForPointers||!!(r.cameraToUseForPointers.layerMask&e.layerMask))),this._pickedDownMesh=null,i=r.skipPointerDownPicking||0===r._registeredActions&&!this._checkForPicking()&&!r.onPointerDown?new d.G:r.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,r.pointerDownPredicate,r.pointerDownFastCheck,r.cameraToUseForPointers,r.pointerDownTrianglePredicate),this._processPointerDown(i,e)},this._onPointerUp=e=>{const t=this._activePointerIds.indexOf(e.pointerId);-1!==t&&(this._activePointerIds[t]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(e),r.preventDefaultOnPointerUp&&s&&(e.preventDefault(),s.focus()),this._initClickEvent(r.onPrePointerObservable,r.onPointerObservable,e,((t,i)=>{if(r.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!t.ignore)){if(this._checkPrePointerObservable(null,e,T.Zp.POINTERUP))return this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1));t.hasSwiped||(t.singleClick&&r.onPrePointerObservable.hasSpecificMask(T.Zp.POINTERTAP)&&this._checkPrePointerObservable(null,e,T.Zp.POINTERTAP)&&(this._skipPointerTap=!0),t.doubleClick&&r.onPrePointerObservable.hasSpecificMask(T.Zp.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,e,T.Zp.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[e.pointerId]?(0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1),(r.cameraToUseForPointers||r.activeCamera)&&(r.pointerUpPredicate||(r.pointerUpPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!r.cameraToUseForPointers||!!(r.cameraToUseForPointers.layerMask&e.layerMask))),!this._meshPickProceed&&(y&&y.HasTriggers||this._checkForPicking()||r.onPointerUp)&&this._initActionManager(null,t),i||(i=this._currentPickResult),this._processPointerUp(i,e,t),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=e=>{const t=I.TB.KEYDOWN;if(r.onPreKeyboardObservable.hasObservers()){const i=new I.Bu(t,e);if(r.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(r.onKeyboardObservable.hasObservers()){const i=new I.W0(t,e);r.onKeyboardObservable.notifyObservers(i,t)}r.actionManager&&r.actionManager.processTrigger(14,_.CreateNewFromScene(r,e))},this._onKeyUp=e=>{const t=I.TB.KEYUP;if(r.onPreKeyboardObservable.hasObservers()){const i=new I.Bu(t,e);if(r.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(r.onKeyboardObservable.hasObservers()){const i=new I.W0(t,e);r.onKeyboardObservable.notifyObservers(i,t)}r.actionManager&&r.actionManager.processTrigger(15,_.CreateNewFromScene(r,e))},this._deviceSourceManager.onDeviceConnectedObservable.add((s=>{s.deviceType===x.Mouse?s.onInputChangedObservable.add((r=>{this._originMouseEvent=r,r.inputIndex===A.LeftClick||r.inputIndex===A.MiddleClick||r.inputIndex===A.RightClick||r.inputIndex===A.BrowserBack||r.inputIndex===A.BrowserForward?t&&1===s.getInput(r.inputIndex)?this._onPointerDown(r):e&&0===s.getInput(r.inputIndex)&&this._onPointerUp(r):i&&(r.inputIndex===A.Move?this._onPointerMove(r):r.inputIndex!==A.MouseWheelX&&r.inputIndex!==A.MouseWheelY&&r.inputIndex!==A.MouseWheelZ||this._onPointerMove(r))})):s.deviceType===x.Touch?s.onInputChangedObservable.add((r=>{r.inputIndex===A.LeftClick&&(t&&1===s.getInput(r.inputIndex)?(this._onPointerDown(r),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):e&&0===s.getInput(r.inputIndex)&&(this._onPointerUp(r),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),i&&r.inputIndex===A.Move&&this._onPointerMove(r)})):s.deviceType===x.Keyboard&&s.onInputChangedObservable.add((e=>{"keydown"===e.type?this._onKeyDown(e):"keyup"===e.type&&this._onKeyUp(e)}))})),this._alreadyAttached=!0}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(e,t=0,i,s){if(!(this._meshUnderPointerId[t]!==e||e&&e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const r=this._meshUnderPointerId[t];let n;r&&(n=r._getActionManagerForTrigger(10),n&&n.processTrigger(10,new _(r,this._pointerX,this._pointerY,e,s,{pointerId:t}))),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,n=e._getActionManagerForTrigger(9),n&&n.processTrigger(9,new _(e,this._pointerX,this._pointerY,e,s,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:e,pointerId:t})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(e){this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null);for(const t in this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}}V.DragMovementThreshold=10,V.LongPressDelay=500,V.DoubleClickDelay=300,V.ExclusiveDoubleClickMode=!1;var G=i(1994),z=i(451),H=i(2610),W=i(9112),X=i(9649),q=i(5549),Q=i(959);class K{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var Y,j=i(3039),Z=i(5686);!function(e){e[e.BackwardCompatible=0]="BackwardCompatible",e[e.Intermediate=1]="Intermediate",e[e.Aggressive=2]="Aggressive"}(Y||(Y={}));class ${static DefaultMaterialFactory(e){throw(0,v.n)("StandardMaterial")}static CollisionCoordinatorFactory(){throw(0,v.n)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(e){e!==this._clearColor&&(this._clearColor=e,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(e){if(e!==this._performancePriority){switch(this._performancePriority=e,e){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(e)}}set forceWireframe(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.onEnvironmentTextureChangedObservable.notifyObservers(e),this.markAllMaterialsAsDirty(1))}getNodes(){let e=[];return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach((t=>e=e.concat(t.bones))),e}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set beforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))}set afterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))}set beforeCameraRender(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)}set afterCameraRender(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(e){this._pointerPickingConfiguration.pointerDownPredicate=e}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(e){this._pointerPickingConfiguration.pointerUpPredicate=e}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(e){this._pointerPickingConfiguration.pointerMovePredicate=e}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(e){this._pointerPickingConfiguration.pointerDownFastCheck=e}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(e){this._pointerPickingConfiguration.pointerUpFastCheck=e}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(e){this._pointerPickingConfiguration.pointerMoveFastCheck=e}get skipPointerMovePicking(){return this._pointerPickingConfiguration.skipPointerMovePicking}set skipPointerMovePicking(e){this._pointerPickingConfiguration.skipPointerMovePicking=e}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(e){this._pointerPickingConfiguration.skipPointerDownPicking=e}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(e){this._pointerPickingConfiguration.skipPointerUpPicking=e}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return V.DragMovementThreshold}static set DragMovementThreshold(e){V.DragMovementThreshold=e}static get LongPressDelay(){return V.LongPressDelay}static set LongPressDelay(e){V.LongPressDelay=e}static get DoubleClickDelay(){return V.DoubleClickDelay}static set DoubleClickDelay(e){V.DoubleClickDelay=e}static get ExclusiveDoubleClickMode(){return V.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(e){V.ExclusiveDoubleClickMode=e}bindEyePosition(e,t="vEyePosition",i=!1){const s=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera?.globalPosition??l.Pq.ZeroReadOnly,r=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return l.AA.Vector4[0].set(s.x,s.y,s.z,r?-1:1),e&&(i?e.setFloat3(t,l.AA.Vector4[0].x,l.AA.Vector4[0].y,l.AA.Vector4[0].z):e.setVector4(t,l.AA.Vector4[0])),l.AA.Vector4[0]}finalizeSceneUbo(){const e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e}set useRightHandedSystem(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(e){this._currentStepId=e}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(e){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),e&&(this._unObserveActiveCameras=(0,Q.lL)(e,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=e}get activeCamera(){return this._activeCamera}set activeCamera(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=$.DefaultMaterialFactory(this)),this._defaultMaterial}set defaultMaterial(e){this._defaultMaterial=e}set texturesEnabled(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(e){if(this._frameGraph)return this._frameGraph=e,void(e||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=e,e&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=$.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const e of this._transientComponents)e.register();this._transientComponents.length=0}}_addComponent(e){this._components.push(e),this._transientComponents.push(e);const t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)}_getComponent(e){for(const t of this._components)if(t.name===e)return t;return null}constructor(e,t){this._inputManager=new V(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.autoClear=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new z.ov(.2,.2,.3,1),this.onClearColorChangedObservable=new n.cP,this.ambientColor=new z.v9(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new n.cP,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.sounds=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.onDisposeObservable=new n.cP,this._onDisposeObserver=null,this.onBeforeRenderObservable=new n.cP,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new n.cP,this.onAfterRenderCameraObservable=new n.cP,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new n.cP,this.onAfterAnimationsObservable=new n.cP,this.onBeforeDrawPhaseObservable=new n.cP,this.onAfterDrawPhaseObservable=new n.cP,this.onReadyObservable=new n.cP,this.onBeforeCameraRenderObservable=new n.cP,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new n.cP,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new n.cP,this.onAfterActiveMeshesEvaluationObservable=new n.cP,this.onBeforeParticlesRenderingObservable=new n.cP,this.onAfterParticlesRenderingObservable=new n.cP,this.onDataLoadedObservable=new n.cP,this.onNewCameraAddedObservable=new n.cP,this.onCameraRemovedObservable=new n.cP,this.onNewLightAddedObservable=new n.cP,this.onLightRemovedObservable=new n.cP,this.onNewGeometryAddedObservable=new n.cP,this.onGeometryRemovedObservable=new n.cP,this.onNewTransformNodeAddedObservable=new n.cP,this.onTransformNodeRemovedObservable=new n.cP,this.onNewMeshAddedObservable=new n.cP,this.onMeshRemovedObservable=new n.cP,this.onNewSkeletonAddedObservable=new n.cP,this.onSkeletonRemovedObservable=new n.cP,this.onNewMaterialAddedObservable=new n.cP,this.onNewMultiMaterialAddedObservable=new n.cP,this.onMaterialRemovedObservable=new n.cP,this.onMultiMaterialRemovedObservable=new n.cP,this.onNewTextureAddedObservable=new n.cP,this.onTextureRemovedObservable=new n.cP,this.onBeforeRenderTargetsRenderObservable=new n.cP,this.onAfterRenderTargetsRenderObservable=new n.cP,this.onBeforeStepObservable=new n.cP,this.onAfterStepObservable=new n.cP,this.onActiveCameraChanged=new n.cP,this.onActiveCamerasChanged=new n.cP,this.onBeforeRenderingGroupObservable=new n.cP,this.onAfterRenderingGroupObservable=new n.cP,this.onMeshImportedObservable=new n.cP,this.onAnimationFileImportedObservable=new n.cP,this.onEnvironmentTextureChangedObservable=new n.cP,this.onMeshUnderPointerUpdatedObservable=new n.cP,this._registeredForLateAnimationBindings=new o.b(256),this._pointerPickingConfiguration=new K,this.onPrePointerObservable=new n.cP,this.onPointerObservable=new n.cP,this.onPreKeyboardObservable=new n.cP,this.onKeyboardObservable=new n.cP,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=$.FOGMODE_NONE,this.fogColor=new z.v9(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new l.Pq(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new o.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new G.A,this._activeIndices=new G.A,this._activeParticles=new G.A,this._activeBones=new G.A,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new o.L(256),this._processedMaterials=new o.L(256),this._renderTargets=new o.b(256),this._materialsRenderTargets=new o.b(256),this._activeParticleSystems=new o.L(256),this._activeSkeletons=new o.b(32),this._softwareSkinnedMeshes=new o.b(32),this._activeAnimatables=new Array,this._transformMatrix=l.uq.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=f.B.Create(),this._beforeClearStage=f.B.Create(),this._beforeRenderTargetClearStage=f.B.Create(),this._gatherRenderTargetsStage=f.B.Create(),this._gatherActiveCameraRenderTargetsStage=f.B.Create(),this._isReadyForMeshStage=f.B.Create(),this._beforeEvaluateActiveMeshStage=f.B.Create(),this._evaluateSubMeshStage=f.B.Create(),this._preActiveMeshStage=f.B.Create(),this._cameraDrawRenderTargetStage=f.B.Create(),this._beforeCameraDrawStage=f.B.Create(),this._beforeRenderTargetDrawStage=f.B.Create(),this._beforeRenderingGroupDrawStage=f.B.Create(),this._beforeRenderingMeshStage=f.B.Create(),this._afterRenderingMeshStage=f.B.Create(),this._afterRenderingGroupDrawStage=f.B.Create(),this._afterCameraDrawStage=f.B.Create(),this._afterCameraPostProcessStage=f.B.Create(),this._afterRenderTargetDrawStage=f.B.Create(),this._afterRenderTargetPostProcessStage=f.B.Create(),this._afterRenderStage=f.B.Create(),this._pointerMoveStage=f.B.Create(),this._pointerDownStage=f.B.Create(),this._pointerUpStage=f.B.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const i={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...t};e=this._engine=e||b.q.LastCreatedEngine,i.virtual?e._virtualScenes.push(this):(b.q._LastCreatedScene=this,e.scenes.push(this)),this._uid=null,this._renderingManager=new g.m(this),p.X&&(this.postProcessManager=new p.X(this)),(0,m.BA)()&&this.attachControl(),this._createUbo(),c.p&&(this._imageProcessingConfiguration=new c.p),this.setDefaultCandidateProviders(),i.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=i.useMaterialMeshMap,this.useClonedMeshMap=i.useClonedMeshMap,t&&t.virtual||e.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=e=>this._getDefaultSubMeshCandidates(e),this.getIntersectingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e),this.getCollidingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(e){this._inputManager.pointerX=e}get pointerY(){return this._inputManager.pointerY}set pointerY(e){this._inputManager.pointerY=e}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(e,t,i=1){return this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(e,t){return this._inputManager.simulatePointerMove(e,t),this}simulatePointerDown(e,t){return this._inputManager.simulatePointerDown(e,t),this}simulatePointerUp(e,t,i){return this._inputManager.simulatePointerUp(e,t,i),this}isPointerCaptured(e=0){return this._inputManager.isPointerCaptured(e)}attachControl(e=!0,t=!0,i=!0){this._inputManager.attachControl(e,t,i)}detachControl(){this._inputManager.detachControl()}isReady(e=!0){if(this._isDisposed)return!1;let t;const i=this.getEngine(),s=i.currentRenderPassId;i.currentRenderPassId=this.activeCamera?.renderPassId??s;let r=!0;for(this._pendingData.length>0&&(r=!1),this.prePassRenderer?.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&r&&(r=this.depthPeelingRenderer.isReady()),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),t=0;t<this.meshes.length;t++){const s=this.meshes[t];if(!s.subMeshes||0===s.subMeshes.length)continue;if(!s.isReady(!0)){r=!1;continue}const n=s.hasThinInstances||"InstancedMesh"===s.getClassName()||"InstancedLinesMesh"===s.getClassName()||i.getCaps().instancedArrays&&s.instances.length>0;for(const e of this._isReadyForMeshStage)e.action(s,n)||(r=!1);if(!e)continue;const o=s.material||this.defaultMaterial;if(o)if(o._storeEffectOnSubMeshes)for(const e of s.subMeshes){const t=e.getMaterial();t&&t.hasRenderTargetTextures&&null!=t.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(t)&&(this._processedMaterials.push(t),this._materialsRenderTargets.concatWithNoDuplicate(t.getRenderTargetTextures()))}else o.hasRenderTargetTextures&&null!=o.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(o)&&(this._processedMaterials.push(o),this._materialsRenderTargets.concatWithNoDuplicate(o.getRenderTargetTextures()))}if(e)for(t=0;t<this._materialsRenderTargets.length;++t)this._materialsRenderTargets.data[t].isReadyForRendering()||(r=!1);for(t=0;t<this.geometries.length;t++)2===this.geometries[t].delayLoadState&&(r=!1);if(this.activeCameras&&this.activeCameras.length>0)for(const e of this.activeCameras)e.isReady(!0)||(r=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(r=!1));for(const e of this.particleSystems)e.isReady()||(r=!1);if(this.layers)for(const e of this.layers)e.isReady()||(r=!1);return i.areAllEffectsReady()||(r=!1),i.currentRenderPassId=s,r}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(e){this.onBeforeRenderObservable.add(e)}unregisterBeforeRender(e){this.onBeforeRenderObservable.removeCallback(e)}registerAfterRender(e){this.onAfterRenderObservable.add(e)}unregisterAfterRender(e){this.onAfterRenderObservable.removeCallback(e)}_executeOnceBeforeRender(e){const t=()=>{e(),setTimeout((()=>{this.unregisterBeforeRender(t)}))};this.registerBeforeRender(t)}executeOnceBeforeRender(e,t){void 0!==t?setTimeout((()=>{this._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)}addPendingData(e){this._pendingData.push(e)}removePendingData(e){const t=this.isLoading,i=this._pendingData.indexOf(e);-1!==i&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(e,t=!1){this.onReadyObservable.addOnce(e),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)}whenReadyAsync(e=!1){return new Promise((t=>{this.executeWhenReady((()=>{t()}),e)}))}_checkIsReady(e=!1){return this._registerTransientComponents(),this.isReady(e)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(e)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=r.j.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(e,t,i,s){i||s||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?H.P.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=H.P.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(i,s):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(e){const t=new u.D(this._engine,void 0,!1,e??"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t}setSceneUniformBuffer(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return W.K.UniqueId}addMesh(e,t=!1){this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),s.S0.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(e)})),t&&e.getChildMeshes().forEach((e=>{this.addMesh(e)})))}removeMesh(e,t=!1){const i=this.meshes.indexOf(e);return-1!==i&&(this.meshes.splice(i,1),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((e=>{this.removeMesh(e)})),i}addTransformNode(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneTransformNodesArray||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))}removeTransformNode(e){const t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){const e=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=e,e._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t}removeSkeleton(e){const t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t}removeMorphTargetManager(e){const t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t}removeLight(e){const t=this.lights.indexOf(e);if(-1!==t){for(const t of this.meshes)t._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t}removeCamera(e){const t=this.cameras.indexOf(e);if(-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){const t=this.activeCameras.indexOf(e);-1!==t&&this.activeCameras.splice(t,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t}removeParticleSystem(e){const t=this.particleSystems.indexOf(e);return-1!==t&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t}removeAnimation(e){const t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t}stopAnimation(e,t,i){}removeAnimationGroup(e){const t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t}removeMultiMaterial(e){const t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t}removeMaterial(e){const t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){const e=this.materials[this.materials.length-1];this.materials[t]=e,e._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t}removeActionManager(e){const t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t}removeTexture(e){const t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t}addLight(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(const t of this.meshes)-1===t.lightSources.indexOf(e)&&(t.lightSources.push(e),t._resyncLightSources());s.S0.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(e)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(q.c.CompareLightsPriority)}addCamera(e){this._blockEntityCollection||(this.cameras.push(e),s.S0.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(e)})),e.parent||e._addToSceneRootNodes())}addSkeleton(e){this._blockEntityCollection||(this.skeletons.push(e),s.S0.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(e)})))}addParticleSystem(e){this._blockEntityCollection||this.particleSystems.push(e)}addAnimation(e){this._blockEntityCollection||this.animations.push(e)}addAnimationGroup(e){this._blockEntityCollection||this.animationGroups.push(e)}addMultiMaterial(e){this._blockEntityCollection||(this.multiMaterials.push(e),s.S0.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(e)})))}addMaterial(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneMaterialArray||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),s.S0.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(e)})))}addMorphTargetManager(e){this._blockEntityCollection||this.morphTargetManagers.push(e)}addGeometry(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))}addActionManager(e){this.actionManagers.push(e)}addTexture(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))}switchActiveCamera(e,t=!0){this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())}setActiveCameraById(e){const t=this.getCameraById(e);return t?(this.activeCamera=t,t):null}setActiveCameraByName(e){const t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null}getAnimationGroupByName(e){for(let t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null}_getMaterial(e,t){for(let e=0;e<this.materials.length;e++){const i=this.materials[e];if(t(i))return i}if(e)for(let e=0;e<this.multiMaterials.length;e++){const i=this.multiMaterials[e];if(t(i))return i}return null}getMaterialByUniqueID(e,t=!1){return this._getMaterial(t,(t=>t.uniqueId===e))}getMaterialById(e,t=!1){return this._getMaterial(t,(t=>t.id===e))}getMaterialByName(e,t=!1){return this._getMaterial(t,(t=>t.name===e))}getLastMaterialById(e,t=!1){for(let t=this.materials.length-1;t>=0;t--)if(this.materials[t].id===e)return this.materials[t];if(t)for(let t=this.multiMaterials.length-1;t>=0;t--)if(this.multiMaterials[t].id===e)return this.multiMaterials[t];return null}getTextureByUniqueId(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null}getTextureByName(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null}getCameraById(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null}getCameraByUniqueId(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null}getCameraByName(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null}getBoneById(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let t=0;t<i.bones.length;t++)if(i.bones[t].id===e)return i.bones[t]}return null}getBoneByName(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let t=0;t<i.bones.length;t++)if(i.bones[t].name===e)return i.bones[t]}return null}getLightByName(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null}getLightById(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null}getLightByUniqueId(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null}getParticleSystemById(e){for(let t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null}getGeometryById(e){for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null}_getGeometryByUniqueId(e){if(this._geometriesByUniqueId){const t=this._geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].uniqueId===e)return this.geometries[t];return null}pushGeometry(e,t){return!(!t&&this._getGeometryByUniqueId(e.uniqueId)||(this.addGeometry(e),s.S0.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(e)})),0))}removeGeometry(e){let t;if(this._geometriesByUniqueId){if(t=this._geometriesByUniqueId[e.uniqueId],void 0===t)return!1}else if(t=this.geometries.indexOf(e),t<0)return!1;if(t!==this.geometries.length-1){const e=this.geometries[this.geometries.length-1];e&&(this.geometries[t]=e,this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=t))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0}getGeometries(){return this.geometries}getMeshById(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null}getMeshesById(e){return this.meshes.filter((function(t){return t.id===e}))}getTransformNodeById(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getTransformNodeByUniqueId(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null}getTransformNodesById(e){return this.transformNodes.filter((function(t){return t.id===e}))}getMeshByUniqueId(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null}getLastMeshById(e){for(let t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null}getLastTransformNodeById(e){for(let t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getLastEntryById(e){let t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null}getNodeById(e){const t=this.getMeshById(e);if(t)return t;const i=this.getTransformNodeById(e);if(i)return i;const s=this.getLightById(e);if(s)return s;const r=this.getCameraById(e);if(r)return r;return this.getBoneById(e)||null}getNodeByName(e){const t=this.getMeshByName(e);if(t)return t;const i=this.getTransformNodeByName(e);if(i)return i;const s=this.getLightByName(e);if(s)return s;const r=this.getCameraByName(e);if(r)return r;return this.getBoneByName(e)||null}getMeshByName(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null}getTransformNodeByName(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null}getLastSkeletonById(e){for(let t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByUniqueId(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null}getSkeletonById(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByName(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null}getMorphTargetManagerById(e){for(let t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null}getMorphTargetById(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let t=0;t<i.numTargets;++t){const s=i.getTarget(t);if(s.id===e)return s}}return null}getMorphTargetByName(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let t=0;t<i.numTargets;++t){const s=i.getTarget(t);if(s.name===e)return s}}return null}getPostProcessByName(e){for(let t=0;t<this.postProcesses.length;++t){const i=this.postProcesses[t];if(i.name===e)return i}return null}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}get uid(){return this._uid||(this._uid=s.S0.RandomId()),this._uid}addExternalData(e,t){return this._externalData||(this._externalData=new a),this._externalData.add(e,t)}getExternalData(e){return this._externalData?this._externalData.get(e):null}getOrAddExternalDataWithFactory(e,t){return this._externalData||(this._externalData=new a),this._externalData.getOrAddWithFactory(e,t)}removeExternalData(e){return this._externalData.remove(e)}_evaluateSubMesh(e,t,i,s){if(s||e.isInFrustum(this._frustumPlanes)){for(const i of this._evaluateSubMeshStage)i.action(t,e);const i=e.getMaterial();null!=i&&(i.hasRenderTargetTextures&&null!=i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._materialsRenderTargets.concatWithNoDuplicate(i.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,i))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let e=0;e<this.textures.length;e++){const t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(e=!1,t,i,s=!0,r=!1){return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=r,this._skipEvaluateActiveMeshesCompletely=e,s)for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._freeze();t&&t()}else i&&i("No active camera found")})),this}unfreezeActiveMeshes(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(e){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>e.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)return void(this._activeMeshes.length>0&&(this.activeCamera?._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset()));if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const e=this._activeMeshes.length;for(let t=0;t<e;t++)this._activeMeshes.data[t].computeWorldMatrix()}if(this._activeParticleSystems){const e=this._activeParticleSystems.length;for(let t=0;t<e;t++)this._activeParticleSystems.data[t].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const e of this._beforeEvaluateActiveMeshStage)e.action();const e=this.getActiveMeshCandidates(),t=e.length;for(let i=0;i<t;i++){const t=e.data[i];let s=t._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(s?s[1]=-1:(s=[t,-1],t._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,s)),t.isBlocked)continue;if(this._totalVertices.addCount(t.getTotalVertices(),!1),!t.isReady()||!t.isEnabled()||t.scaling.hasAZeroComponent)continue;t.computeWorldMatrix(),t.actionManager&&t.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(t);let r=this.customLODSelector?this.customLODSelector(t,this.activeCamera):t.getLOD(this.activeCamera);if(s[0]=r,s[1]=this._frameId,null!=r&&(r!==t&&0!==r.billboardMode&&r.computeWorldMatrix(),t._preActivate(),t.isVisible&&t.visibility>0&&t.layerMask&this.activeCamera.layerMask&&(this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||t.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(t),this.activeCamera._activeMeshes.push(t),r!==t&&r._activate(this._renderId,!1);for(const e of this._preActiveMeshStage)e.action(t);t._activate(this._renderId,!1)&&(t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(r=t):r._internalAbstractMeshDataInfo._onlyForInstances=!1,r._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(t,r)),t._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let e=0;e<this.particleSystems.length;e++){const t=this.particleSystems[e];if(!t.isStarted()||!t.emitter)continue;const i=t.emitter;i.position&&!i.isEnabled()||(this._activeParticleSystems.push(t),t.animate(),this._renderingManager.dispatchParticles(t))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(e){this._skeletonsEnabled&&e.skeleton&&(this._activeSkeletons.pushNoDuplicate(e.skeleton)&&(e.skeleton.prepare(),this._activeBones.addCount(e.skeleton.bones.length,!1)),e.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(e)&&this.frameGraph&&e.applySkeleton(e.skeleton))}_activeMesh(e,t){this._prepareSkeleton(t);let i=e.hasInstances||e.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh;if(t&&t.subMeshes&&t.subMeshes.length>0){const s=this.getActiveSubMeshCandidates(t),r=s.length;i=i||1===r;for(let n=0;n<r;n++){const r=s.data[n];this._evaluateSubMesh(r,t,e,i)}}}updateTransformMatrix(e){const t=this.activeCamera;if(t)if(t._renderingMultiview){const i=t._rigCameras[0],s=t._rigCameras[1];this.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(e),s.getViewMatrix(),s.getProjectionMatrix(e))}else this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e))}_bindFrameBuffer(e,t=!0){this._useCurrentFrameBuffer||(e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),t&&this._clearFrameBuffer(e)}_clearFrameBuffer(e){if(e&&e._multiviewTexture);else if(e&&e.outputRenderTarget&&!e._renderingMultiview){const t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):t.skipInitialClear||e.isRightCamera||(this.autoClear&&this._engine.clear(t.clearColor||this._clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(e,t,i=!0){if(e&&e._skipRendering)return;const r=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(r.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&i){let t=!0;e._renderingMultiview&&e.outputRenderTarget&&(t=e.outputRenderTarget.skipInitialClear,this.autoClear&&(this._defaultFrameBufferCleared=!1,e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=t)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let e=0;e<this._softwareSkinnedMeshes.length;e++){const t=this._softwareSkinnedMeshes.data[e];t.applySkeleton(t.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const e of this._gatherActiveCameraRenderTargetsStage)e.action(this._renderTargets);let n=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){s.S0.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let e=0;e<this._renderTargets.length;e++){const t=this._renderTargets.data[e];if(t._shouldRender()){this._renderId++;const e=t.activeCamera&&t.activeCamera!==this.activeCamera;t.render(e,this.dumpNextRenderTargets),n=!0}}s.S0.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const e of this._cameraDrawRenderTargetStage)n=e.action(this.activeCamera)||n;this._intermediateRendering=!1}this._engine.currentRenderPassId=e.outputRenderTarget?.renderPassId??e.renderPassId??0,n&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||e._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const e of this._beforeCameraDrawStage)e.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),r.snapshotRendering&&1===r.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const e of this._afterCameraDrawStage)e.action(this.activeCamera);if(this.postProcessManager&&!e._multiviewTexture){const t=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,t)}for(const e of this._afterCameraPostProcessStage)e.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(e,t=!0){if(0===e.cameraRigMode||e._renderingMultiview)return e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(let t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)}_checkIntersections(){for(let e=0;e<this._meshesForIntersections.length;e++){const t=this._meshesForIntersections.data[e];if(t.actionManager)for(let e=0;t.actionManager&&e<t.actionManager.actions.length;e++){const i=t.actionManager.actions[e];if(12===i.trigger||13===i.trigger){const e=i.getTriggerParameter(),s=e.mesh?e.mesh:e,r=s.intersectsMesh(t,e.usePreciseIntersection),n=t._intersectionsInProgress.indexOf(s);r&&-1===n?12===i.trigger?(i._executeCurrent(_.CreateNew(t,void 0,s)),t._intersectionsInProgress.push(s)):13===i.trigger&&t._intersectionsInProgress.push(s):!r&&n>-1&&(13===i.trigger&&i._executeCurrent(_.CreateNew(t,void 0,s)),t.actionManager.hasSpecificTrigger(13,(e=>{const t=e.mesh?e.mesh:e;return s===t}))&&13!==i.trigger||t._intersectionsInProgress.splice(n,1))}}}}_advancePhysicsEngineStep(e){}_animate(e){}animate(){if(this._engine.isDeterministicLockStep()){let e=Math.max($.MinDeltaTime,Math.min(this._engine.getDeltaTime(),$.MaxDeltaTime))+this._timeAccumulator;const t=this._engine.getTimeStep(),i=1e3/t/1e3;let s=0;const r=this._engine.getLockstepMaxSteps();let n=Math.floor(e/t);for(n=Math.min(n,r);e>0&&s<n;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*i,this._animate(t),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,s++,e-=t;this._timeAccumulator=e<0?0:e}else{const e=this.useConstantAnimationDeltaTime?16:Math.max($.MinDeltaTime,Math.min(this._engine.getDeltaTime(),$.MaxDeltaTime));this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}}_clear(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this._clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(e){if(e?.outputRenderTarget&&!e?.isRigCamera&&(e.outputRenderTarget._cleared=!1),e?.rigCameras?.length)for(let t=0;t<e.rigCameras.length;++t){const i=e.rigCameras[t].outputRenderTarget;i&&(i._cleared=!1)}}resetDrawCache(e){if(this.meshes)for(const t of this.meshes)t.resetDrawCache(e)}_renderWithFrameGraph(e=!0,t=!1){if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),e)for(const e of this.cameras)if(e.update(),0!==e.cameraRigMode)for(let t=0;t<e._rigCameras.length;t++)e._rigCameras[t].update();for(const e of this._beforeClearStage)e.action();const i=this.getActiveMeshCandidates(),s=i.length;for(let e=0;e<s;e++){const t=i.data[e];t.isBlocked||(this._totalVertices.addCount(t.getTotalVertices(),!1),t.isReady()&&t.isEnabled()&&!t.scaling.hasAZeroComponent&&(t.computeWorldMatrix(),t.actionManager&&t.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(t)))}if(this.particlesEnabled)for(let e=0;e<this.particleSystems.length;e++){const t=this.particleSystems[e];if(!t.isStarted()||!t.emitter)continue;const i=t.emitter;i.position&&!i.isEnabled()||(this._activeParticleSystems.push(t),t.animate())}this.frameGraph?.execute()}render(e=!0,t=!1){if(!this.isDisposed){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),this.activeCameras?.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(const e of this._beforeCameraUpdateStage)e.action();if(e)if(this.activeCameras&&this.activeCameras.length>0)for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];if(t.update(),0!==t.cameraRigMode)for(let e=0;e<t._rigCameras.length;e++)t._rigCameras[e].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let e=0;e<this.activeCamera._rigCameras.length;e++)this.activeCamera._rigCameras[e].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(e,t);else{const e=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const t=this.activeCameras?.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){s.S0.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let i=0;i<this.customRenderTargets.length;i++){const s=this.customRenderTargets[i];if(s._shouldRender()){if(this._renderId++,this.activeCamera=s.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");e.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),s.render(t!==this.activeCamera,this.dumpNextRenderTargets)}}s.S0.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=t?.renderPassId??0,this.activeCamera=t,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const e of this._beforeClearStage)e.action();this._clearFrameBuffer(this.activeCamera);for(const e of this._gatherRenderTargetsStage)e.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let e=0;e<this.activeCameras.length;e++)this._processSubCameras(this.activeCameras[e],e>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const e of this._afterRenderStage)e.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let e=0;e<this._toBeDisposed.length;e++){const t=this._toBeDisposed[e];t&&t.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].freeze()}unfreezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].unfreeze()}dispose(){if(this.isDisposed)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((e=>{e.onAnimationEndObservable.clear(),e.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const e=this._activeRequests.slice();for(const t of e)t.abort();this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(e){j.V.Error("An error occurred while calling onDisposeObservable!",e)}if(this.detachControl(),this._engine.getInputElement())for(let e=0;e<this.cameras.length;e++)this.cameras[e].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(e=>e.dispose(!0))),this._disposeList(this.transformNodes,(e=>e.dispose(!0)));const t=this.cameras;this._disposeList(t),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let i=this._engine.scenes.indexOf(this);if(i>-1&&this._engine.scenes.splice(i,1),b.q._LastCreatedScene===this){b.q._LastCreatedScene=null;let e=b.q.Instances.length-1;for(;e>=0;){const t=b.q.Instances[e];if(t.scenes.length>0){b.q._LastCreatedScene=t.scenes[this._engine.scenes.length-1];break}e--}}i=this._engine._virtualScenes.indexOf(this),i>-1&&this._engine._virtualScenes.splice(i,1),this._engine.wipeCaches(!0),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(e,t){const i=e.slice(0);t=t??(e=>e.dispose());for(const e of i)t(e);e.length=0}get isDisposed(){return this._isDisposed}clearCachedVertexData(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e].geometry;t&&t.clearCachedData()}}cleanCachedTextureBuffer(){for(const e of this.textures)e._buffer&&(e._buffer=null)}getWorldExtends(e){const t=new l.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new l.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||(()=>!0),this.meshes.filter(e).forEach((e=>{if(e.computeWorldMatrix(!0),!e.subMeshes||0===e.subMeshes.length||e.infiniteDistance)return;const s=e.getBoundingInfo(),r=s.boundingBox.minimumWorld,n=s.boundingBox.maximumWorld;l.Pq.CheckExtends(r,t,i),l.Pq.CheckExtends(n,t,i)})),{min:t,max:i}}createPickingRay(e,t,i,s,r=!1){throw(0,v.n)("Ray")}createPickingRayToRef(e,t,i,s,r,n=!1,o=!1){throw(0,v.n)("Ray")}createPickingRayInCameraSpace(e,t,i){throw(0,v.n)("Ray")}createPickingRayInCameraSpaceToRef(e,t,i,s){throw(0,v.n)("Ray")}pick(e,t,i,s,r,n){const o=(0,v.n)("Ray",!0);return o&&j.V.Warn(o),new d.G}pickWithBoundingInfo(e,t,i,s,r){const n=(0,v.n)("Ray",!0);return n&&j.V.Warn(n),new d.G}pickWithRay(e,t,i,s){throw(0,v.n)("Ray")}multiPick(e,t,i,s,r){throw(0,v.n)("Ray")}multiPickWithRay(e,t,i){throw(0,v.n)("Ray")}setPointerOverMesh(e,t,i){this._inputManager.setPointerOverMesh(e,t,i)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const e of this._components)e.rebuild();for(const e of this.particleSystems)e.rebuild();if(this.spriteManagers)for(const e of this.spriteManagers)e.rebuild()}_rebuildTextures(){for(const e of this.textures)e._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(e,t,i){if(void 0===t)return e;const s=[];for(const r in e){const n=e[r];h.Y&&h.Y.MatchesQuery(n,t)&&(!i||i(n))&&s.push(n)}return s}getMeshesByTags(e,t){return this._getByTags(this.meshes,e,t)}getCamerasByTags(e,t){return this._getByTags(this.cameras,e,t)}getLightsByTags(e,t){return this._getByTags(this.lights,e,t)}getMaterialByTags(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}getTransformNodesByTags(e,t){return this._getByTags(this.transformNodes,e,t)}setRenderingOrder(e,t=null,i=null,s=null){this._renderingManager.setRenderingOrder(e,t,i,s)}setRenderingAutoClearDepthStencil(e,t,i=!0,s=!0){this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,s)}getAutoClearDepthStencilSetup(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)}_forceBlockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism=e}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(e,t){if(!this._blockMaterialDirtyMechanism)for(const i of this.materials)t&&!t(i)||i.markAsDirty(e)}_loadFile(e,t,i,s,r,n,o){const a=(0,X.zU)(e,t,i,s?this.offlineProvider:void 0,r,n,o);return this._activeRequests.push(a),a.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),a}_loadFileAsync(e,t,i,s,r){return new Promise(((n,o)=>{this._loadFile(e,(e=>{n(e)}),t,i,s,((e,t)=>{o(t)}),r)}))}_requestFile(e,t,i,s,r,n,o){const a=(0,X.sh)(e,t,i,s?this.offlineProvider:void 0,r,n,o);return this._activeRequests.push(a),a.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),a}_requestFileAsync(e,t,i,s,r){return new Promise(((n,o)=>{this._requestFile(e,(e=>{n(e)}),t,i,s,(e=>{o(e)}),r)}))}_readFile(e,t,i,s,r){const n=(0,X.NJ)(e,t,i,s,r);return this._activeRequests.push(n),n.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),n}_readFileAsync(e,t,i){return new Promise(((s,r)=>{this._readFile(e,(e=>{s(e)}),t,i,(e=>{r(e)}))}))}getPerfCollector(){throw(0,v.n)("performanceViewerSceneExtension")}setActiveCameraByID(e){return this.setActiveCameraById(e)}getMaterialByID(e){return this.getMaterialById(e)}getLastMaterialByID(e){return this.getLastMaterialById(e)}getTextureByUniqueID(e){return this.getTextureByUniqueId(e)}getCameraByID(e){return this.getCameraById(e)}getCameraByUniqueID(e){return this.getCameraByUniqueId(e)}getBoneByID(e){return this.getBoneById(e)}getLightByID(e){return this.getLightById(e)}getLightByUniqueID(e){return this.getLightByUniqueId(e)}getParticleSystemByID(e){return this.getParticleSystemById(e)}getGeometryByID(e){return this.getGeometryById(e)}getMeshByID(e){return this.getMeshById(e)}getMeshByUniqueID(e){return this.getMeshByUniqueId(e)}getLastMeshByID(e){return this.getLastMeshById(e)}getMeshesByID(e){return this.getMeshesById(e)}getTransformNodeByID(e){return this.getTransformNodeById(e)}getTransformNodeByUniqueID(e){return this.getTransformNodeByUniqueId(e)}getTransformNodesByID(e){return this.getTransformNodesById(e)}getNodeByID(e){return this.getNodeById(e)}getLastEntryByID(e){return this.getLastEntryById(e)}getLastSkeletonByID(e){return this.getLastSkeletonById(e)}}$.FOGMODE_NONE=0,$.FOGMODE_EXP=1,$.FOGMODE_EXP2=2,$.FOGMODE_LINEAR=3,$.MinDeltaTime=1,$.MaxDeltaTime=1e3,(0,Z.Y5)("BABYLON.Scene",$)},8857:(e,t,i)=>{"use strict";function s(e){return parseInt(e.toString().replace(/\W/g,""))}function r(e,t,i=1401298e-51){return Math.abs(e-t)<=i}function n(e,t){return e===t?e:Math.random()*(t-e)+e}function o(e,t,i){return e+(t-e)*i}function a(e,t,i){let s=g(t-e,360);return s>180&&(s-=360),e+s*u(i)}function h(e,t,i){let s=0;return s=e!=t?u((i-e)/(t-e)):0,s}function l(e,t,i,s,r){const n=r*r,o=r*n;return e*(2*o-3*n+1)+i*(-2*o+3*n)+t*(o-2*n+r)+s*(o-n)}function c(e,t,i,s,r){const n=r*r;return 6*(n-r)*e+(3*n-4*r+1)*t+6*(-n+r)*i+(3*n-2*r)*s}function u(e,t=0,i=1){return Math.min(i,Math.max(t,e))}function d(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function _(e){const t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()}function p(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;let t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}function g(e,t){return e-Math.floor(e/t)*t}function f(e,t,i){return(e-t)/(i-t)}function m(e,t,i){return e*(i-t)+t}function b(e,t){let i=g(t-e,360);return i>180&&(i-=360),i}function v(e,t){const i=g(e,2*t);return t-Math.abs(i-t)}function T(e,t,i){let s=u(i);return s=-2*s*s*s+3*s*s,t*s+e*(1-s)}function y(e,t,i){let s=0;return s=Math.abs(t-e)<=i?t:e+Math.sign(t-e)*i,s}function x(e,t,i){const s=b(e,t);let r=0;return r=-i<s&&s<i?t:y(e,t=e+s,i),r}function A(e,t,i){return(e-t)/(i-t)}function C(e,t,i){return(i-t)*e+t}function S(e,t){const i=e%t;return 0===i?t:S(t,i)}i.r(t),i.d(t,{Clamp:()=>u,DeltaAngle:()=>b,Denormalize:()=>m,ExtractAsInt:()=>s,Hermite:()=>l,Hermite1stDerivative:()=>c,HighestCommonFactor:()=>S,ILog2:()=>p,InverseLerp:()=>h,Lerp:()=>o,LerpAngle:()=>a,MoveTowards:()=>y,MoveTowardsAngle:()=>x,Normalize:()=>f,NormalizeRadians:()=>d,PercentToRange:()=>C,PingPong:()=>v,RandomRange:()=>n,RangeToPercent:()=>A,Repeat:()=>g,SmoothStep:()=>T,ToHex:()=>_,WithinEpsilon:()=>r})},8884:(e,t,i)=>{"use strict";i.d(t,{m:()=>n});var s,r=i(4049);!function(e){e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.MaxViewZ=2]="MaxViewZ"}(s||(s={}));class n{static CreateConfiguration(e){return n._Configurations[e]={defines:{},previousWorldMatrices:{},previousViewProjection:r.uq.Zero(),currentViewProjection:r.uq.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},n._Configurations[e]}static DeleteConfiguration(e){delete n._Configurations[e]}static GetConfiguration(e){return n._Configurations[e]}static AddUniformsAndSamplers(e,t){e.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(e,t){for(const i of t)if(i.subMeshes)for(const t of i.subMeshes)t._removeDrawWrapper(e)}static PrepareDefines(e,t,i){if(!i._arePrePassDirty)return;const s=n._Configurations[e];if(!s)return;i.PREPASS=!0,i.PREPASS_COLOR=!1,i.PREPASS_COLOR_INDEX=-1;let r=0;for(let e=0;e<n.GeometryTextureDescriptions.length;e++){const t=n.GeometryTextureDescriptions[e],o=t.define,a=t.defineIndex,h=s.defines[a];void 0!==h?(i[o]=!0,i[a]=h,r++):(i[o]=!1,delete i[a])}i.SCENE_MRT_COUNT=r,i.BONES_VELOCITY_ENABLED=t.useBones&&t.computeBonesUsingShaders&&t.skeleton&&!t.skeleton.isUsingTextureForMatrices&&-1===s.excludedSkinnedMesh.indexOf(t)}static Bind(e,t,i,s){const r=n._Configurations[e];if(r&&(void 0!==r.defines.PREPASS_VELOCITY_INDEX||void 0!==r.defines.PREPASS_VELOCITY_LINEAR_INDEX)){r.previousWorldMatrices[i.uniqueId]||(r.previousWorldMatrices[i.uniqueId]=s.clone());const e=i.getScene();r.previousViewProjection||(r.previousViewProjection=e.getTransformMatrix().clone(),r.currentViewProjection=e.getTransformMatrix().clone());const n=e.getEngine();if(r.currentViewProjection.updateFlag!==e.getTransformMatrix().updateFlag?(r.lastUpdateFrameId=n.frameId,r.previousViewProjection.copyFrom(r.currentViewProjection),r.currentViewProjection.copyFrom(e.getTransformMatrix())):r.lastUpdateFrameId!==n.frameId&&(r.lastUpdateFrameId=n.frameId,r.previousViewProjection.copyFrom(r.currentViewProjection)),t.setMatrix("previousWorld",r.previousWorldMatrices[i.uniqueId]),t.setMatrix("previousViewProjection",r.previousViewProjection),r.previousWorldMatrices[i.uniqueId]=s.clone(),i.useBones&&i.computeBonesUsingShaders&&i.skeleton){const e=i.skeleton;if(!e.isUsingTextureForMatrices||-1===t.getUniformIndex("boneTextureWidth")){const s=e.getTransformMatrices(i);s&&(r.previousBones[i.uniqueId]||(r.previousBones[i.uniqueId]=s.slice()),t.setMatrices("mPreviousBones",r.previousBones[i.uniqueId]),r.previousBones[i.uniqueId].set(s))}}}}}n.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],n._Configurations={}},8897:(e,t,i)=>{"use strict";var s,r=i(7960),n=i(219),o=i(3841),a=i(6190),h=i(3950),l=i(6296),c=i(1711),u=i(3221),d=i(4822),_=i(3700),p=i(3888),g=i(4670),f=i(9988),m=i(5786),b=i(3897),v=Function,T=function(e){try{return v('"use strict"; return ('+e+").constructor;")()}catch(e){}},y=i(1399),x=i(7539),A=function(){throw new c},C=y?function(){try{return A}catch(e){try{return y(arguments,"callee").get}catch(e){return A}}}():A,S=i(4923)(),E=i(6152),R=i(9548),P=i(1588),I=i(6678),M=i(376),w={},O="undefined"!=typeof Uint8Array&&E?E(Uint8Array):s,B={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?s:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?s:ArrayBuffer,"%ArrayIteratorPrototype%":S&&E?E([][Symbol.iterator]()):s,"%AsyncFromSyncIteratorPrototype%":s,"%AsyncFunction%":w,"%AsyncGenerator%":w,"%AsyncGeneratorFunction%":w,"%AsyncIteratorPrototype%":w,"%Atomics%":"undefined"==typeof Atomics?s:Atomics,"%BigInt%":"undefined"==typeof BigInt?s:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?s:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?s:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?s:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":n,"%eval%":eval,"%EvalError%":o,"%Float32Array%":"undefined"==typeof Float32Array?s:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?s:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?s:FinalizationRegistry,"%Function%":v,"%GeneratorFunction%":w,"%Int8Array%":"undefined"==typeof Int8Array?s:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?s:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?s:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":S&&E?E(E([][Symbol.iterator]())):s,"%JSON%":"object"==typeof JSON?JSON:s,"%Map%":"undefined"==typeof Map?s:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&S&&E?E((new Map)[Symbol.iterator]()):s,"%Math%":Math,"%Number%":Number,"%Object%":r,"%Object.getOwnPropertyDescriptor%":y,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?s:Promise,"%Proxy%":"undefined"==typeof Proxy?s:Proxy,"%RangeError%":a,"%ReferenceError%":h,"%Reflect%":"undefined"==typeof Reflect?s:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?s:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&S&&E?E((new Set)[Symbol.iterator]()):s,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?s:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":S&&E?E(""[Symbol.iterator]()):s,"%Symbol%":S?Symbol:s,"%SyntaxError%":l,"%ThrowTypeError%":C,"%TypedArray%":O,"%TypeError%":c,"%Uint8Array%":"undefined"==typeof Uint8Array?s:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?s:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?s:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?s:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?s:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?s:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?s:WeakSet,"%Function.prototype.call%":M,"%Function.prototype.apply%":I,"%Object.defineProperty%":x,"%Object.getPrototypeOf%":R,"%Math.abs%":d,"%Math.floor%":_,"%Math.max%":p,"%Math.min%":g,"%Math.pow%":f,"%Math.round%":m,"%Math.sign%":b,"%Reflect.getPrototypeOf%":P};if(E)try{null.error}catch(e){var D=E(E(e));B["%Error.prototype%"]=D}var F=function e(t){var i;if("%AsyncFunction%"===t)i=T("async function () {}");else if("%GeneratorFunction%"===t)i=T("function* () {}");else if("%AsyncGeneratorFunction%"===t)i=T("async function* () {}");else if("%AsyncGenerator%"===t){var s=e("%AsyncGeneratorFunction%");s&&(i=s.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=e("%AsyncGenerator%");r&&E&&(i=E(r.prototype))}return B[t]=i,i},L={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},N=i(4499),k=i(4313),U=N.call(M,Array.prototype.concat),V=N.call(I,Array.prototype.splice),G=N.call(M,String.prototype.replace),z=N.call(M,String.prototype.slice),H=N.call(M,RegExp.prototype.exec),W=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,X=/\\(\\)?/g,q=function(e,t){var i,s=e;if(k(L,s)&&(s="%"+(i=L[s])[0]+"%"),k(B,s)){var r=B[s];if(r===w&&(r=F(s)),void 0===r&&!t)throw new c("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:s,value:r}}throw new l("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new c("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new c('"allowMissing" argument must be a boolean');if(null===H(/^%?[^%]*%?$/,e))throw new l("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(e){var t=z(e,0,1),i=z(e,-1);if("%"===t&&"%"!==i)throw new l("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new l("invalid intrinsic syntax, expected opening `%`");var s=[];return G(e,W,(function(e,t,i,r){s[s.length]=i?G(r,X,"$1"):t||e})),s}(e),s=i.length>0?i[0]:"",r=q("%"+s+"%",t),n=r.name,o=r.value,a=!1,h=r.alias;h&&(s=h[0],V(i,U([0,1],h)));for(var u=1,d=!0;u<i.length;u+=1){var _=i[u],p=z(_,0,1),g=z(_,-1);if(('"'===p||"'"===p||"`"===p||'"'===g||"'"===g||"`"===g)&&p!==g)throw new l("property names with quotes must have matching quotes");if("constructor"!==_&&d||(a=!0),k(B,n="%"+(s+="."+_)+"%"))o=B[n];else if(null!=o){if(!(_ in o)){if(!t)throw new c("base intrinsic for "+e+" exists, but the property is not available.");return}if(y&&u+1>=i.length){var f=y(o,_);o=(d=!!f)&&"get"in f&&!("originalValue"in f.get)?f.get:o[_]}else d=k(o,_),o=o[_];d&&!a&&(B[n]=o)}}return o}},8908:(e,t,i)=>{"use strict";i.r(t),i.d(t,{_DDSTextureLoader:()=>n});var s=i(4871),r=i(5326);class n{constructor(){this.supportCascades=!0}loadCubeData(e,t,i,n){const o=t.getEngine();let a,h=!1,l=1e3;if(Array.isArray(e))for(let i=0;i<e.length;i++){const s=e[i];a=r.DDSTools.GetDDSInfo(s),t.width=a.width,t.height=a.height,h=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps,o._unpackFlipY(a.isCompressed),r.DDSTools.UploadDDSLevels(o,t,s,a,h,6,-1,i),a.isFourCC||1!==a.mipmapCount?l=a.mipmapCount-1:o.generateMipMapsForCubemap(t)}else{const n=e;a=r.DDSTools.GetDDSInfo(n),t.width=a.width,t.height=a.height,i&&(a.sphericalPolynomial=new s.Q),h=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps,o._unpackFlipY(a.isCompressed),r.DDSTools.UploadDDSLevels(o,t,n,a,h,6),a.isFourCC||1!==a.mipmapCount?l=a.mipmapCount-1:o.generateMipMapsForCubemap(t,!1)}o._setCubeMapTextureParams(t,h,l),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n({isDDS:!0,width:t.width,info:a,data:e,texture:t})}loadData(e,t,i){const s=r.DDSTools.GetDDSInfo(e),n=(s.isRGB||s.isLuminance||s.mipmapCount>1)&&t.generateMipMaps&&Math.max(s.width,s.height)>>s.mipmapCount-1==1;i(s.width,s.height,n,s.isFourCC,(()=>{r.DDSTools.UploadDDSLevels(t.getEngine(),t,e,s,n,1)}))}}},8931:function(e,t,i){var s;e=i.nmd(e),function(){t&&t.nodeType,e&&e.nodeType;var r="object"==typeof i.g&&i.g;r.global!==r&&r.window!==r&&r.self;var n,o=2147483647,a=36,h=/^xn--/,l=/[^\x20-\x7E]/,c=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},d=Math.floor,_=String.fromCharCode;function p(e){throw new RangeError(u[e])}function g(e,t){for(var i=e.length,s=[];i--;)s[i]=t(e[i]);return s}function f(e,t){var i=e.split("@"),s="";return i.length>1&&(s=i[0]+"@",e=i[1]),s+g((e=e.replace(c,".")).split("."),t).join(".")}function m(e){for(var t,i,s=[],r=0,n=e.length;r<n;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<n?56320==(64512&(i=e.charCodeAt(r++)))?s.push(((1023&t)<<10)+(1023&i)+65536):(s.push(t),r--):s.push(t);return s}function b(e){return g(e,(function(e){var t="";return e>65535&&(t+=_((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+_(e)})).join("")}function v(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function T(e,t,i){var s=0;for(e=i?d(e/700):e>>1,e+=d(e/t);e>455;s+=a)e=d(e/35);return d(s+36*e/(e+38))}function y(e){var t,i,s,r,n,h,l,c,u,_,g,f=[],m=e.length,v=0,y=128,x=72;for((i=e.lastIndexOf("-"))<0&&(i=0),s=0;s<i;++s)e.charCodeAt(s)>=128&&p("not-basic"),f.push(e.charCodeAt(s));for(r=i>0?i+1:0;r<m;){for(n=v,h=1,l=a;r>=m&&p("invalid-input"),((c=(g=e.charCodeAt(r++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:a)>=a||c>d((o-v)/h))&&p("overflow"),v+=c*h,!(c<(u=l<=x?1:l>=x+26?26:l-x));l+=a)h>d(o/(_=a-u))&&p("overflow"),h*=_;x=T(v-n,t=f.length+1,0==n),d(v/t)>o-y&&p("overflow"),y+=d(v/t),v%=t,f.splice(v++,0,y)}return b(f)}function x(e){var t,i,s,r,n,h,l,c,u,g,f,b,y,x,A,C=[];for(b=(e=m(e)).length,t=128,i=0,n=72,h=0;h<b;++h)(f=e[h])<128&&C.push(_(f));for(s=r=C.length,r&&C.push("-");s<b;){for(l=o,h=0;h<b;++h)(f=e[h])>=t&&f<l&&(l=f);for(l-t>d((o-i)/(y=s+1))&&p("overflow"),i+=(l-t)*y,t=l,h=0;h<b;++h)if((f=e[h])<t&&++i>o&&p("overflow"),f==t){for(c=i,u=a;!(c<(g=u<=n?1:u>=n+26?26:u-n));u+=a)A=c-g,x=a-g,C.push(_(v(g+A%x,0))),c=d(A/x);C.push(_(v(c,0))),n=T(i,y,s==r),i=0,++s}++i,++t}return C.join("")}n={version:"1.4.1",ucs2:{decode:m,encode:b},decode:y,encode:x,toASCII:function(e){return f(e,(function(e){return l.test(e)?"xn--"+x(e):e}))},toUnicode:function(e){return f(e,(function(e){return h.test(e)?y(e.slice(4).toLowerCase()):e}))}},void 0===(s=function(){return n}.call(t,i,t,e))||(e.exports=s)}()},8985:(e,t,i)=>{"use strict";var s=i(1088),r=i(2286),n=i(769);e.exports={formats:n,parse:r,stringify:s}},9020:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.instancesVertex="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,\npreviousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n"},9039:(e,t,i)=>{"use strict";i.d(t,{u:()=>A});var s=i(4754),r=i(3054),n=i(4049),o=i(766),a=i(2605),h=i(2282),l=i(109),c=i(1717),u=i(7893);class d{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new n.Pq(0,0,0),this._diffPositionForCollisions=new n.Pq(0,0,0),this._collisionResponse=!0}}var _=i(2213),p=i(8421),g=i(451),f=i(7761),m=i(6871),b=i(5686),v=i(4537),T=i(976);class y{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=n.Pq.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class x{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new y,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new d,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class A extends h.V{static get BILLBOARDMODE_NONE(){return h.V.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return h.V.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return h.V.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return h.V.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return h.V.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return h.V.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(e){return!!super._updateNonUniformScalingState(e)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(e){this._internalAbstractMeshDataInfo._rawBoundingInfo=e}set onCollide(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)}set onCollisionPositionChange(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(e){if(this._internalAbstractMeshDataInfo._visibility===e)return;const t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(1===t&&1!==e||1!==t&&1===e)&&this._markSubMeshesAsDirty((e=>{e.markAsMiscDirty(),e.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(e){this._internalAbstractMeshDataInfo._inheritVisibility=e}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let e=this._parentNode;for(;e;){const t=e.isVisible;if(void 0!==t)return t;e=e.parent}}return this._isVisible}set isVisible(e){this._isVisible=e}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(e){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=e}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(e){this._internalAbstractMeshDataInfo._renderingGroupId=e}get material(){return this._internalAbstractMeshDataInfo._material}set material(e){this._setMaterial(e)}_setMaterial(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(void 0,null==e),this._unBindEffect()))}getMaterialForRenderPass(e){return this._internalAbstractMeshDataInfo._materialForRenderPass?.[e]}setMaterialForRenderPass(e,t){this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const i=this._internalAbstractMeshDataInfo._materialForRenderPass[e];i?.meshMap?.[this.uniqueId]&&(i.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e}get lightSources(){return this._lightSources}set skeleton(e){const t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(e,t=null){switch(super(e,t,!1),this._internalAbstractMeshDataInfo=new x,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.cullingStrategy=A.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new r.cP,this.onCollisionPositionChangeObservable=new r.cP,this.onMaterialChangedObservable=new r.cP,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=g.v9.Red(),this.outlineWidth=.02,this.overlayColor=g.v9.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new n.Pq(.5,1,.5),this.ellipsoidOffset=new n.Pq(0,0,0),this.edgesWidth=1,this.edgesColor=new g.ov(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new r.cP,this._onCollisionPositionChange=(e,t,i=null)=>{t.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>T.$.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),i&&this.onCollideObservable.notifyObservers(i),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},(t=this.getScene()).addMesh(this),this._resyncLightSources(),this._uniformBuffer=new u.D(this.getScene().getEngine(),void 0,void 0,e,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),t.performancePriority){case 2:this.doNotSyncBoundingInfo=!0;case 1:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(e){const t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(e){let t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const i=this._internalAbstractMeshDataInfo._skeleton;return i&&(t+=", skeleton: "+i.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==h.V.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(e,t=!0){if(this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_rebuild(e=!1){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes){for(const e of this.subMeshes)e._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const e of this.getScene().lights)e.isEnabled()&&e.canAffectMesh(this)&&this._lightSources.push(e);this._markSubMeshesAsLightDirty()}_resyncLightSource(e){const t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);let s=!1;if(-1===i){if(!t)return;this._lightSources.push(e)}else{if(t)return;s=!0,this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty(s)}_unBindEffect(){for(const e of this.subMeshes)e.setEffect(null)}_removeLightSource(e,t){const i=this._lightSources.indexOf(e);-1!==i&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(t))}_markSubMeshesAsDirty(e){if(this.subMeshes)for(const t of this.subMeshes)for(let i=0;i<t._drawWrappers.length;++i){const s=t._drawWrappers[i];s&&s.defines&&s.defines.markAllAsDirty&&e(s.defines)}}_markSubMeshesAsLightDirty(e=!1){this._markSubMeshesAsDirty((t=>t.markAsLightDirty(e)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((e=>e.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((e=>e.markAsMiscDirty()))}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,super.markAsDirty(e),this._isDirty=!0,this}resetDrawCache(e,t=!1){if(this.subMeshes)for(const i of this.subMeshes)i.resetDrawCache(e,t)}get isBlocked(){return!1}getLOD(e){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}getIndices(){return null}getVerticesData(e){return null}setVerticesData(e,t,i,s){return this}updateVerticesData(e,t,i,s){return this}setIndices(e,t){return this}isVerticesDataPresent(e){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(e){return this._boundingInfo=e,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(e,t,i){return this._boundingInfo=new c.j(e,t,i),this._boundingInfo}normalizeToUnitCube(e=!0,t=!1,i){return super.normalizeToUnitCube(e,t,i)}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(o.R.MatricesIndicesKind)&&this.isVerticesDataPresent(o.R.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(e){}_activate(e,t){return this._renderId=e,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===h.V.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this}calcMovePOV(e,t,i){const s=new n.uq;(this.rotationQuaternion?this.rotationQuaternion:n.PT.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(s);const r=n.Pq.Zero(),o=this.definedFacingForward?-1:1;return n.Pq.TransformCoordinatesFromFloatsToRef(e*o,t,i*o,s,r),r}rotatePOV(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this}calcRotatePOV(e,t,i){const s=this.definedFacingForward?1:-1;return new n.Pq(e*s,t,i*s)}_refreshBoundingInfo(e,t){if(e){const i=(0,p.b8)(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new c.j(i.minimum,i.maximum)}if(this.subMeshes)for(let t=0;t<this.subMeshes.length;t++)this.subMeshes[t].refreshBoundingInfo(e);this._updateBoundingInfo()}_refreshBoundingInfoDirect(e){if(this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new c.j(e.minimum,e.maximum),this.subMeshes)for(let e=0;e<this.subMeshes.length;e++)this.subMeshes[e].refreshBoundingInfo(null);this._updateBoundingInfo()}static _ApplySkeleton(e,t,i,s,r,a,h){!function(e,t,i,s,r,a,h){const l=n.AA.Vector3[0],c=n.AA.Matrix[0],u=n.AA.Matrix[1],d=t===o.R.NormalKind?n.Pq.TransformNormalFromFloatsToRef:n.Pq.TransformCoordinatesFromFloatsToRef;for(let t=0,o=0;t<e.length;t+=3,o+=4){let _,p;for(c.reset(),_=0;_<4;_++)p=r[o+_],p>0&&(n.uq.FromFloat32ArrayToRefScaled(i,Math.floor(16*s[o+_]),p,u),c.addToSelf(u));if(a&&h)for(_=0;_<4;_++)p=h[o+_],p>0&&(n.uq.FromFloat32ArrayToRefScaled(i,Math.floor(16*a[o+_]),p,u),c.addToSelf(u));d(e[t],e[t+1],e[t+2],c,l),l.toArray(e,t)}}(e,t,i,s,r,a,h)}_getData(e,t,i=o.R.PositionKind){const s=e.cache,r=e=>{if(s){const t=s._vertexData||(s._vertexData={});return t[e]||this.copyVerticesData(e,t),t[e]}return this.getVerticesData(e)};if(t||(t=r(i)),!t)return null;if(s?(s._outputData?s._outputData.set(t):s._outputData=new Float32Array(t),t=s._outputData):(e.applyMorph&&this.morphTargetManager||e.applySkeleton&&this.skeleton)&&(t=t.slice()),e.applyMorph&&this.morphTargetManager&&function(e,t,i){let s=null;switch(t){case o.R.PositionKind:s=e=>e.getPositions();break;case o.R.NormalKind:s=e=>e.getNormals();break;case o.R.TangentKind:s=e=>e.getTangents();break;case o.R.UVKind:s=e=>e.getUVs();break;case o.R.UV2Kind:s=e=>e.getUV2s();break;case o.R.ColorKind:s=e=>e.getColors();break;default:return}for(let t=0;t<e.length;t++){let r=e[t];for(let n=0;n<i.numTargets;n++){const o=i.getTarget(n),a=o.influence;if(0!==a){const i=s(o);i&&(r+=(i[t]-e[t])*a)}}e[t]=r}}(t,i,this.morphTargetManager),e.applySkeleton&&this.skeleton){const e=r(o.R.MatricesIndicesKind),s=r(o.R.MatricesWeightsKind);if(s&&e){const n=this.numBoneInfluencers>4,a=n?r(o.R.MatricesIndicesExtraKind):null,h=n?r(o.R.MatricesWeightsExtraKind):null,l=this.skeleton.getTransformMatrices(this);A._ApplySkeleton(t,i,l,e,s,a,h)}}if(!1!==e.updatePositionsArray&&i===o.R.PositionKind){const e=this._internalAbstractMeshDataInfo._positions||[],i=e.length;if(e.length=t.length/3,i<e.length)for(let t=i;t<e.length;t++)e[t]=new n.Pq;for(let i=0,s=0;i<e.length;i++,s+=3)e[i].copyFromFloats(t[s],t[s+1],t[s+2]);this._internalAbstractMeshDataInfo._positions=e}return t}getNormalsData(e=!1,t=!1){return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},null,o.R.NormalKind)}getPositionData(e=!1,t=!1,i=null){return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},i,o.R.PositionKind)}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new c.j(n.Pq.Zero(),n.Pq.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(e){if(!this.subMeshes)return this;const t=this.subMeshes.length;for(let i=0;i<t;i++){const s=this.subMeshes[i];(t>1||!s.IsGlobal)&&s.updateBoundingInfo(e)}return this}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}isInFrustum(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)}isCompletelyInFrustum(e){return this.getBoundingInfo().isCompletelyInFrustum(e)}intersectsMesh(e,t=!1,i){const s=this.getBoundingInfo(),r=e.getBoundingInfo();if(s.intersects(r,t))return!0;if(i)for(const i of this.getChildMeshes())if(i.intersectsMesh(e,t,!0))return!0;return!1}intersectsPoint(e){return this.getBoundingInfo().intersectsPoint(e)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const t=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(e,t,i){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];const i=e.verticesStart,s=e.verticesStart+e.verticesCount;for(let r=i;r<s;r++)e._lastColliderWorldVertices.push(n.Pq.TransformCoordinates(this._positions[r],t))}return i._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),7===e.getMaterial()?.fillMode),this}_processCollisionsForSubMeshes(e,t){const i=this._scene.getCollidingSubMeshCandidates(this,e),s=i.length;for(let r=0;r<s;r++){const n=i.data[r];s>1&&!n._checkCollision(e)||this._collideForSubMesh(n,t,e)}return this}_shouldConvertRHS(){return!1}_checkCollision(e){if(!this.getBoundingInfo()._checkCollision(e))return this;const t=n.AA.Matrix[0],i=n.AA.Matrix[1];return n.uq.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,i),this._processCollisionsForSubMeshes(e,i),this}_generatePointsArray(){return!1}intersects(e,t,i,s=!1,r,o=!1){const a=new l.G,h=this.getClassName(),c="InstancedLinesMesh"===h||"LinesMesh"===h||"GreasedLineMesh"===h?this.intersectionThreshold:0,u=this.getBoundingInfo();if(!this.subMeshes)return a;if(!(o||e.intersectsSphere(u.boundingSphere,c)&&e.intersectsBox(u.boundingBox,c)))return a;if(s)return a.hit=!o,a.pickedMesh=o?null:this,a.distance=o?0:n.Pq.Distance(e.origin,u.boundingSphere.center),a.subMeshId=0,a;if(!this._generatePointsArray())return a;let d=null;const _=this._scene.getIntersectingSubMeshCandidates(this,e),p=_.length;let g=!1;for(let e=0;e<p;e++){const t=_.data[e].getMaterial();if(t&&(7==t.fillMode||0==t.fillMode||1==t.fillMode||2==t.fillMode||4==t.fillMode)){g=!0;break}}if(!g)return a.hit=!0,a.pickedMesh=this,a.distance=n.Pq.Distance(e.origin,u.boundingSphere.center),a.subMeshId=-1,a;for(let s=0;s<p;s++){const r=_.data[s];if(p>1&&!o&&!r.canIntersects(e))continue;const n=r.intersects(e,this._positions,this.getIndices(),t,i);if(n&&(t||!d||n.distance<d.distance)&&(d=n,d.subMeshId=s,t))break}if(d){const t=r??this.getWorldMatrix(),i=n.AA.Vector3[0],s=n.AA.Vector3[1];n.Pq.TransformCoordinatesToRef(e.origin,t,i),e.direction.scaleToRef(d.distance,s);const o=n.Pq.TransformNormal(s,t).addInPlace(i);return a.hit=!0,a.distance=n.Pq.Distance(i,o),a.pickedPoint=o,a.pickedMesh=this,a.bu=d.bu||0,a.bv=d.bv||0,a.subMeshFaceId=d.faceId,a.faceId=d.faceId+_.data[d.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),a.subMeshId=d.subMeshId,a}return a}clone(e,t,i){return null}releaseSubMeshes(e=!1){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose(e);else this.subMeshes=[];return this}dispose(e,t=!1){let i;const s=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),s.freeActiveMeshes(),s.freeRenderingGroups(),s.renderingManager.maintainStateBetweenFrames&&s.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((e=>e!==this&&e.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){const e=this._intersectionsInProgress[i],t=e._intersectionsInProgress.indexOf(this);e._intersectionsInProgress.splice(t,1)}this._intersectionsInProgress.length=0,s.lights.forEach((e=>{let t=e.includedOnlyMeshes.indexOf(this);-1!==t&&e.includedOnlyMeshes.splice(t,1),t=e.excludedMeshes.indexOf(this),-1!==t&&e.excludedMeshes.splice(t,1);const i=e.getShadowGenerators();if(i){const e=i.values();for(let i=e.next();!0!==i.done;i=e.next()){const e=i.value.getShadowMap();e&&e.renderList&&(t=e.renderList.indexOf(this),-1!==t&&e.renderList.splice(t,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const r=s.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,r.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),r.wipeCaches(),s.removeMesh(this),this._parentContainer){const e=this._parentContainer.meshes.indexOf(this);e>-1&&this._parentContainer.meshes.splice(e,1),this._parentContainer=null}if(t&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(i=0;i<s.particleSystems.length;i++)s.particleSystems[i].emitter===this&&(s.particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(e,t)}_initFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=[]),e.facetPositions||(e.facetPositions=[]),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(let t=0;t<e.facetNb;t++)e.facetNormals[t]=n.Pq.Zero(),e.facetPositions[t]=n.Pq.Zero();return e.facetDataEnabled=!0,this}updateFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();const t=this.getVerticesData(o.R.PositionKind),i=this.getIndices(),s=this.getVerticesData(o.R.NormalKind),r=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,i instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(i);else{let t=!1;for(let e=0;e<i.length;e++)if(i[e]>65535){t=!0;break}e.depthSortedIndices=t?new Uint32Array(i):new Uint16Array(i)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){const t=this.getScene().activeCamera;e.facetDepthSortFrom=t?t.position:n.Pq.Zero()}e.depthSortedFacets=[];for(let t=0;t<e.facetNb;t++){const i={ind:3*t,sqDistance:0};e.depthSortedFacets.push(i)}e.invertedMatrix=n.uq.Identity(),e.facetDepthSortOrigin=n.Pq.Zero()}e.bbSize.x=r.maximum.x-r.minimum.x>f.bH?r.maximum.x-r.minimum.x:f.bH,e.bbSize.y=r.maximum.y-r.minimum.y>f.bH?r.maximum.y-r.minimum.y:f.bH,e.bbSize.z=r.maximum.z-r.minimum.z>f.bH?r.maximum.z-r.minimum.z:f.bH;let h=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(h=h>e.bbSize.z?h:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/h),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/h),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/h),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=r,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),n.Pq.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,s&&a.P.ComputeNormals(t,i,s,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);const t=e.depthSortedIndices.length/3|0;for(let s=0;s<t;s++){const t=e.depthSortedFacets[s].ind;e.depthSortedIndices[3*s]=i[t],e.depthSortedIndices[3*s+1]=i[t+1],e.depthSortedIndices[3*s+2]=i[t+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals}getFacetLocalPositions(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions}getFacetLocalPartitioning(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning}getFacetPosition(e){const t=n.Pq.Zero();return this.getFacetPositionToRef(e,t),t}getFacetPositionToRef(e,t){const i=this.getFacetLocalPositions()[e],s=this.getWorldMatrix();return n.Pq.TransformCoordinatesToRef(i,s,t),this}getFacetNormal(e){const t=n.Pq.Zero();return this.getFacetNormalToRef(e,t),t}getFacetNormalToRef(e,t){const i=this.getFacetLocalNormals()[e];return n.Pq.TransformNormalToRef(i,this.getWorldMatrix(),t),this}getFacetsAtLocalCoordinates(e,t,i){const s=this.getBoundingInfo(),r=this._internalAbstractMeshDataInfo._facetData,n=Math.floor((e-s.minimum.x*r.partitioningBBoxRatio)*r.subDiv.X*r.partitioningBBoxRatio/r.bbSize.x),o=Math.floor((t-s.minimum.y*r.partitioningBBoxRatio)*r.subDiv.Y*r.partitioningBBoxRatio/r.bbSize.y),a=Math.floor((i-s.minimum.z*r.partitioningBBoxRatio)*r.subDiv.Z*r.partitioningBBoxRatio/r.bbSize.z);return n<0||n>r.subDiv.max||o<0||o>r.subDiv.max||a<0||a>r.subDiv.max?null:r.facetPartitioning[n+r.subDiv.max*o+r.subDiv.max*r.subDiv.max*a]}getClosestFacetAtCoordinates(e,t,i,s,r=!1,o=!0){const a=this.getWorldMatrix(),h=n.AA.Matrix[5];a.invertToRef(h);const l=n.AA.Vector3[8];n.Pq.TransformCoordinatesFromFloatsToRef(e,t,i,h,l);const c=this.getClosestFacetAtLocalCoordinates(l.x,l.y,l.z,s,r,o);return s&&n.Pq.TransformCoordinatesFromFloatsToRef(s.x,s.y,s.z,a,s),c}getClosestFacetAtLocalCoordinates(e,t,i,s,r=!1,n=!0){let o=null,a=0,h=0,l=0,c=0,u=0,d=0,_=0,p=0;const g=this.getFacetLocalPositions(),f=this.getFacetLocalNormals(),m=this.getFacetsAtLocalCoordinates(e,t,i);if(!m)return null;let b,v,T,y=Number.MAX_VALUE,x=y;for(let A=0;A<m.length;A++)b=m[A],v=f[b],T=g[b],c=(e-T.x)*v.x+(t-T.y)*v.y+(i-T.z)*v.z,(!r||r&&n&&c>=0||r&&!n&&c<=0)&&(c=v.x*T.x+v.y*T.y+v.z*T.z,u=-(v.x*e+v.y*t+v.z*i-c)/(v.x*v.x+v.y*v.y+v.z*v.z),d=e+v.x*u,_=t+v.y*u,p=i+v.z*u,a=d-e,h=_-t,l=p-i,x=a*a+h*h+l*l,x<y&&(y=x,o=b,s&&(s.x=d,s.y=_,s.z=p)));return o}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=[],e.facetNormals=[],e.facetPartitioning=new Array,e.facetParameters={},e.depthSortedIndices=new Uint32Array(0)),this}updateIndices(e,t,i=!1){return this}createNormals(e){const t=this.getVerticesData(o.R.PositionKind),i=this.getIndices();let s;return s=this.isVerticesDataPresent(o.R.NormalKind)?this.getVerticesData(o.R.NormalKind):[],a.P.ComputeNormals(t,i,s,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(o.R.NormalKind,s,e),this}async optimizeIndicesAsync(){const e=this.getIndices();if(!e)return this;const{OptimizeIndices:t}=await i.e(3585).then(i.bind(i,3585));return t(e),this.setIndices(e,this.getTotalVertices()),this}alignWithNormal(e,t){t||(t=m._0.Y);const i=n.AA.Vector3[0],s=n.AA.Vector3[1];return n.Pq.CrossToRef(t,e,s),n.Pq.CrossToRef(e,s,i),this.rotationQuaternion?n.PT.RotationQuaternionFromAxisToRef(i,e,s,this.rotationQuaternion):n.Pq.RotationFromAxisToRef(i,e,s,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,_.n)("EdgesRenderer")}enableEdgesRendering(e,t,i){throw(0,_.n)("EdgesRenderer")}getConnectedParticleSystems(){return this._scene.particleSystems.filter((e=>e.emitter===this))}}A.OCCLUSION_TYPE_NONE=0,A.OCCLUSION_TYPE_OPTIMISTIC=1,A.OCCLUSION_TYPE_STRICT=2,A.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,A.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,A.CULLINGSTRATEGY_STANDARD=0,A.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,A.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,A.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,s.Cg)([v.Cx.filter(((...[e,t,i,s,r])=>!(Array.isArray(e)||Array.isArray(t)||Array.isArray(i)||Array.isArray(s)||Array.isArray(r))))],A,"_ApplySkeleton",null),(0,b.Y5)("BABYLON.AbstractMesh",A)},9046:(e,t,i)=>{"use strict";i.d(t,{Hg:()=>a,Sv:()=>n,Ye:()=>o});var s=i(3039);const r=new Map,n=r;function o(e,t,i){a(e)&&s.V.Warn(`Extension with the name '${e}' already exists`),r.set(e,{isGLTFExtension:t,factory:i})}function a(e){return r.delete(e)}},9075:(e,t,i)=>{"use strict";var s=i(8897),r=i(3232),n=i(8527),o=i(9167),a=i(1711),h=s("%WeakMap%",!0),l=r("WeakMap.prototype.get",!0),c=r("WeakMap.prototype.set",!0),u=r("WeakMap.prototype.has",!0),d=r("WeakMap.prototype.delete",!0);e.exports=h?function(){var e,t,i={assert:function(e){if(!i.has(e))throw new a("Side channel does not contain "+n(e))},delete:function(i){if(h&&i&&("object"==typeof i||"function"==typeof i)){if(e)return d(e,i)}else if(o&&t)return t.delete(i);return!1},get:function(i){return h&&i&&("object"==typeof i||"function"==typeof i)&&e?l(e,i):t&&t.get(i)},has:function(i){return h&&i&&("object"==typeof i||"function"==typeof i)&&e?u(e,i):!!t&&t.has(i)},set:function(i,s){h&&i&&("object"==typeof i||"function"==typeof i)?(e||(e=new h),c(e,i,s)):o&&(t||(t=o()),t.set(i,s))}};return i}:o},9112:(e,t,i)=>{"use strict";i.d(t,{K:()=>s});class s{static get UniqueId(){const e=this._UniqueIdCounter;return this._UniqueIdCounter++,e}}s._UniqueIdCounter=1},9167:(e,t,i)=>{"use strict";var s=i(8897),r=i(3232),n=i(8527),o=i(1711),a=s("%Map%",!0),h=r("Map.prototype.get",!0),l=r("Map.prototype.set",!0),c=r("Map.prototype.has",!0),u=r("Map.prototype.delete",!0),d=r("Map.prototype.size",!0);e.exports=!!a&&function(){var e,t={assert:function(e){if(!t.has(e))throw new o("Side channel does not contain "+n(e))},delete:function(t){if(e){var i=u(e,t);return 0===d(e)&&(e=void 0),i}return!1},get:function(t){if(e)return h(e,t)},has:function(t){return!!e&&c(e,t)},set:function(t,i){e||(e=new a),l(e,t,i)}};return t}},9169:(e,t,i)=>{"use strict";var s;i.d(t,{s:()=>r}),function(e){e[e.PointerMove=0]="PointerMove",e[e.PointerDown=1]="PointerDown",e[e.PointerUp=2]="PointerUp"}(s||(s={}));class r{}r.DOM_DELTA_PIXEL=0,r.DOM_DELTA_LINE=1,r.DOM_DELTA_PAGE=2},9176:(e,t,i)=>{"use strict";i.d(t,{e:()=>O,Ez:()=>E});var s=i(3054),r=i(9732),n=i(1651),o=i(641),a=i(1345),h=i(9642),l=i(4049),c=i(451),u=i(4292),d=i(766),_=i(2605),p=i(108),g=i(9039),f=i(9593),m=i(4564),b=i(5686);class v extends m.i{get subMaterials(){return this._subMaterials}set subMaterials(e){this._subMaterials=e,this._hookArray(e)}getChildren(){return this.subMaterials}constructor(e,t){super(e,t,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().addMultiMaterial(this),this.subMaterials=[],this._storeEffectOnSubMeshes=!0}_hookArray(e){const t=e.push;e.push=(...i)=>{const s=t.apply(e,i);return this._markAllSubMeshesAsTexturesDirty(),s};const i=e.splice;e.splice=(t,s)=>{const r=i.apply(e,[t,s]);return this._markAllSubMeshesAsTexturesDirty(),r}}getSubMaterial(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]}getActiveTextures(){return super.getActiveTextures().concat(...this.subMaterials.map((e=>e?e.getActiveTextures():[])))}hasTexture(e){if(super.hasTexture(e))return!0;for(let t=0;t<this.subMaterials.length;t++)if(this.subMaterials[t]?.hasTexture(e))return!0;return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(e,t,i){for(let s=0;s<this.subMaterials.length;s++){const r=this.subMaterials[s];if(r){if(r._storeEffectOnSubMeshes){if(!r.isReadyForSubMesh(e,t,i))return!1;continue}if(!r.isReady(e))return!1}}return!0}clone(e,t){const i=new v(e,this.getScene());for(let s=0;s<this.subMaterials.length;s++){let r=null;const n=this.subMaterials[s];r=t&&n?n.clone(e+"-"+n.name):this.subMaterials[s],i.subMaterials.push(r)}return i}serialize(){const e={};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,o.Y&&(e.tags=o.Y.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(let t=0;t<this.subMaterials.length;t++){const i=this.subMaterials[t];i?(e.materialsUniqueIds.push(i.uniqueId),e.materials.push(i.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e}dispose(e,t,i){const s=this.getScene();if(!s)return;if(i)for(let i=0;i<this.subMaterials.length;i++){const s=this.subMaterials[i];s&&s.dispose(e,t)}const r=s.multiMaterials.indexOf(this);r>=0&&s.multiMaterials.splice(r,1),super.dispose(e,t)}static ParseMultiMaterial(e,t){const i=new v(e.name,t);return i.id=e.id,i._loadedUniqueId=e.uniqueId,o.Y&&o.Y.AddTagsTo(i,e.tags),e.materialsUniqueIds?i._waitingSubMaterialsUniqueIds=e.materialsUniqueIds:e.materials.forEach((e=>i.subMaterials.push(t.getLastMaterialById(e)))),i}}(0,b.Y5)("BABYLON.MultiMaterial",v);var T=i(6523),y=i(979),x=i(3039),A=i(2213),C=i(4271);class S{constructor(e,t){this.distanceOrScreenCoverage=e,this.mesh=t}}class E{}class R{constructor(){this.visibleInstances={},this.batchCache=new P,this.batchCacheReplacementModeInFrozenMode=new P,this.instancesBufferSize=2048}}class P{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class I{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class M{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const w={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class O extends g.u{static _GetDefaultSideOrientation(e){return e||O.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(e){this._internalMeshDataInfo._useLODScreenCoverage=e,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(d.R.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(d.R.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new s.cP),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new s.cP),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new s.cP),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new s.cP),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new s.cP),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(e){this._internalMeshDataInfo._forcedInstanceCount=e}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(e){this._internalMeshDataInfo._sideOrientation=e,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===e||!this._scene.useRightHandedSystem&&0===e}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(e){this.sideOrientation=e,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(e){this._internalMeshDataInfo._overrideRenderingFillMode=e}get material(){return this._internalAbstractMeshDataInfo._material}set material(e){e&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(e.sideOrientation=null),this._setMaterial(e)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(e){this._instanceDataStorage.manualUpdate=e}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(e){this._instanceDataStorage.previousManualUpdate=e}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(e){this._instanceDataStorage.forceMatrixUpdates=e}_copySource(e,t,i=!0,s=!1){const r=this.getScene();if(e._geometry&&e._geometry.applyToMesh(this),n.r.DeepCopy(e,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=e,r.useClonedMeshMap&&(e._internalMeshDataInfo.meshMap||(e._internalMeshDataInfo.meshMap={}),e._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=e._originalBuilderSideOrientation,this._creationDataStorage=e._creationDataStorage,e._ranges){const t=e._ranges;for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]&&this.createAnimationRange(e,t[e].from,t[e].to)}if(e.metadata&&e.metadata.clone?this.metadata=e.metadata.clone():this.metadata=e.metadata,this._internalMetadata=e._internalMetadata,o.Y&&o.Y.HasTags(e)&&o.Y.AddTagsTo(this,o.Y.GetTags(e,!0)),this.setEnabled(e.isEnabled(!1)),this.parent=e.parent,this.setPivotMatrix(e.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+e.id,this.material=e.material,!t){const r=e.getDescendants(!0);for(let e=0;e<r.length;e++){const n=r[e];n._isMesh?(w.parent=this,w.doNotCloneChildren=t,w.clonePhysicsImpostor=i,w.cloneThinInstances=s,n.clone(this.name+"."+n.name,w)):n.clone&&n.clone(this.name+"."+n.name,this)}}if(e.morphTargetManager&&(this.morphTargetManager=e.morphTargetManager),r.getPhysicsEngine){const t=r.getPhysicsEngine();if(i&&t)if(1===t.getPluginVersion()){const i=t.getImpostorForPhysicsObject(e);i&&(this.physicsImpostor=i.clone(this))}else 2===t.getPluginVersion()&&e.physicsBody&&e.physicsBody.clone(this)}for(let t=0;t<r.particleSystems.length;t++){const i=r.particleSystems[t];i.emitter===e&&i.clone(i.name,this)}if(this.skeleton=e.skeleton,s&&(e._thinInstanceDataStorage.matrixData?(this.thinInstanceSetBuffer("matrix",new Float32Array(e._thinInstanceDataStorage.matrixData),16,!e._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=e._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=e._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=e._thinInstanceDataStorage.matrixBufferSize,e._userThinInstanceBuffersStorage)){const t=e._userThinInstanceBuffersStorage;for(const e in t.data)this.thinInstanceSetBuffer(e,new Float32Array(t.data[e]),t.strides[e],!t.vertexBuffers?.[e]?.isUpdatable()),this._userThinInstanceBuffersStorage.sizes[e]=t.sizes[e]}this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}constructor(e,t=null,i=null,r=null,n,o=!0){super(e,t),this._internalMeshDataInfo=new M,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new R,this._thinInstanceDataStorage=new I,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=O.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,t=this.getScene(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(e,t,i)=>{e&&i&&(this._uniformBuffer?this.transferToEffect(t):i.bindOnlyWorldMatrix(t))};let a=null,h=!1;if(i&&void 0===i._addToSceneRootNodes){const e=i;a=e.parent??null,r=e.source??null,n=e.doNotCloneChildren??!1,o=e.clonePhysicsImpostor??!0,h=e.cloneThinInstances??!1}else a=i;r&&this._copySource(r,n,o,h),null!==a&&(this.parent=a),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=e=>{e.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new s.cP(this._internalMeshDataInfo._onMeshReadyObserverAdded),r&&r.onClonedObservable.notifyObservers(this)}instantiateHierarchy(e=null,t,i){const s=0===this.getTotalVertices()||t&&t.doNotInstantiate&&(!0===t.doNotInstantiate||t.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));s.parent=e||this.parent,s.position=this.position.clone(),s.scaling=this.scaling.clone(),this.rotationQuaternion?s.rotationQuaternion=this.rotationQuaternion.clone():s.rotation=this.rotation.clone(),i&&i(this,s);for(const e of this.getChildTransformNodes(!0))"InstancedMesh"===e.getClassName()&&"Mesh"===s.getClassName()&&e.sourceMesh===this?e.instantiateHierarchy(s,{doNotInstantiate:t&&t.doNotInstantiate||!1,newSourcedMesh:s},i):e.instantiateHierarchy(s,t,i);return s}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(e){let t=super.toString(e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);if(e)if(this._geometry){const e=this.getIndices(),i=this.getVerticesData(d.R.PositionKind);i&&e&&(t+=", flat shading: "+(i.length/3===e.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t}_unBindEffect(){super._unBindEffect();for(const e of this.instances)e._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((t,i)=>t.distanceOrScreenCoverage<i.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>i.distanceOrScreenCoverage?-e:0))}addLODLevel(e,t){if(t&&t._masterMesh)return x.V.Warn("You cannot use a mesh as LOD level twice"),this;const i=new S(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++){const s=t._LODLevels[i];if(s.distanceOrScreenCoverage===e)return s.mesh}return null}removeLODLevel(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this}getLOD(e,t){const i=this._internalMeshDataInfo;if(!i._LODLevels||0===i._LODLevels.length)return this;const s=t||this.getBoundingInfo().boundingSphere,r=e.mode===h.i.ORTHOGRAPHIC_CAMERA?e.minZ:s.centerWorld.subtract(e.globalPosition).length();let n=r,o=1;if(i._useLODScreenCoverage){const t=e.screenArea;let i=s.radiusWorld*e.minZ/r;i=i*i*Math.PI,n=i/t,o=-1}if(o*i._LODLevels[i._LODLevels.length-1].distanceOrScreenCoverage>o*n)return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this;for(let e=0;e<i._LODLevels.length;e++){const t=i._LODLevels[e];if(o*t.distanceOrScreenCoverage<o*n){if(t.mesh){if(4===t.mesh.delayLoadState)return t.mesh._checkDelayState(),this;if(2===t.mesh.delayLoadState)return this;t.mesh._preActivate(),t.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,t.mesh),t.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this}get geometry(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(e,t,i,s){if(!this._geometry)return null;let r=s?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e]?.getFloatData(this.instances.length+1,i||t&&1!==this._geometry.meshes.length);return r||(r=this._geometry.getVerticesData(e,t,i)),r}copyVerticesData(e,t){this._geometry&&this._geometry.copyVerticesData(e,t)}getVertexBuffer(e,t){return this._geometry?(t?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e])??this._geometry.getVertexBuffer(e):null}isVerticesDataPresent(e,t){return this._geometry?!t&&void 0!==this._userInstancedBuffersStorage?.vertexBuffers[e]||this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}isVertexBufferUpdatable(e,t){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(e);if(!t){const t=this._userInstancedBuffersStorage?.vertexBuffers[e];if(t)return t.isUpdatable()}return this._geometry.isVertexBufferUpdatable(e)}getVerticesDataKinds(e){if(!this._geometry){const e=[];return this._delayInfo&&this._delayInfo.forEach((function(t){e.push(t)})),e}const t=this._geometry.getVerticesDataKinds();if(!e&&this._userInstancedBuffersStorage)for(const e in this._userInstancedBuffersStorage.vertexBuffers)-1===t.indexOf(e)&&t.push(e);return t}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}getIndices(e,t){return this._geometry?this._geometry.getIndices(e,t):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(e=!1,t=!1){if(2===this.delayLoadState)return!1;if(!super.isReady(e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;const i=this.getEngine(),s=this.getScene(),r=t||i.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();const n=this.material||s.defaultMaterial;if(n)if(n._storeEffectOnSubMeshes)for(const e of this.subMeshes){const t=e.getMaterial();if(t)if(t._storeEffectOnSubMeshes){if(!t.isReadyForSubMesh(this,e,r))return!1}else if(!t.isReady(this,r))return!1}else if(!n.isReady(this,r))return!1;const o=i.currentRenderPassId;for(const e of this.lightSources){const t=e.getShadowGenerators();if(!t)continue;const s=t.values();for(let e=s.next();!0!==e.done;e=s.next()){const t=e.value;if(t&&(!t.getShadowMap()?.renderList||t.getShadowMap()?.renderList&&-1!==t.getShadowMap()?.renderList?.indexOf(this))){const e=t.getShadowMap().renderPassIds??[i.currentRenderPassId];for(let s=0;s<e.length;++s){i.currentRenderPassId=e[s];for(const e of this.subMeshes)if(!t.isReady(e,r,e.getMaterial()?.needAlphaBlendingForMesh(this)??!1))return i.currentRenderPassId=o,!1}i.currentRenderPassId=o}}}for(const e of this._internalMeshDataInfo._LODLevels)if(e.mesh&&!e.mesh.isReady(r))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}freezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(e){this._instanceDataStorage.overridenInstanceCount=e}_preActivate(){const e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this}_registerInstanceForRenderId(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let i;i="object"==typeof e?e:{applySkeleton:e,applyMorph:t};const s=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getData(i,null,d.R.PositionKind),s),this}_createGlobalSubMesh(e){const t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){const i=this.getIndices();if(!i)return null;const s=i.length;let r=!1;if(e)r=!0;else for(const e of this.subMeshes){if(e.indexStart+e.indexCount>s){r=!0;break}if(e.verticesStart+e.verticesCount>t){r=!0;break}}if(!r)return this.subMeshes[0]}return this.releaseSubMeshes(),new f.K(0,0,t,0,this.getTotalIndices()||t,this)}subdivide(e){if(e<1)return;const t=this.getTotalIndices();let i=t/e|0,s=0;for(;i%3!=0;)i++;this.releaseSubMeshes();for(let r=0;r<e&&!(s>=t);r++)f.K.CreateFromIndices(0,s,r===e-1?t-s:i,this,void 0,!1),s+=i;this.refreshBoundingInfo(),this.synchronizeInstances()}setVerticesData(e,t,i=!1,s){if(this._geometry)this._geometry.setVerticesData(e,t,i,s);else{const s=new _.P;s.set(t,e);const r=this.getScene();new p.V(p.V.RandomId(),r,s,i,this)}return this}removeVerticesData(e){this._geometry&&this._geometry.removeVerticesData(e)}markVerticesDataAsUpdatable(e,t=!0){const i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)}setVerticesBuffer(e,t=!0){return this._geometry||(this._geometry=p.V.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,null,t),this}updateVerticesData(e,t,i,s){return this._geometry?(s?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this}updateMeshPositions(e,t=!0){const i=this.getVerticesData(d.R.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(d.R.PositionKind,i,!1,!1),t){const e=this.getIndices(),t=this.getVerticesData(d.R.NormalKind);if(!t)return this;_.P.ComputeNormals(i,e,t),this.updateVerticesData(d.R.NormalKind,t,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const e=this._geometry,t=this._geometry.copy(p.V.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this}setIndexBuffer(e,t,i){let s=this._geometry;s||(s=new p.V(p.V.RandomId(),this.getScene(),void 0,void 0,this)),s.setIndexBuffer(e,t,i)}setIndices(e,t=null,i=!1,s=!1){if(this._geometry)this._geometry.setIndices(e,t,i,s);else{const t=new _.P;t.indices=e;const s=this.getScene();new p.V(p.V.RandomId(),s,t,i,this)}return this}updateIndices(e,t,i=!1){return this._geometry?(this._geometry.updateIndices(e,t,i),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(e,t,i,s=!0){if(!this._geometry)return this;const r=this.getScene().getEngine();let n;if(this._unIndexed)n=this._getRenderingFillMode(i)===m.i.WireFrameFillMode?e._getLinesIndexBuffer(this.getIndices(),r):null;else switch(this._getRenderingFillMode(i)){case m.i.PointFillMode:n=null;break;case m.i.WireFrameFillMode:n=e._getLinesIndexBuffer(this.getIndices(),r);break;default:case m.i.TriangleFillMode:n=this._geometry.getIndexBuffer()}return this._bindDirect(t,n,s)}_bindDirect(e,t,i=!0){return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(e),i&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(e,t,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(e,t),this):this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const s=this.getScene().getEngine();return this._unIndexed&&t!==m.i.WireFrameFillMode||t==m.i.PointFillMode?s.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||i):t==m.i.WireFrameFillMode?s.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||i):s.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||i),this}registerBeforeRender(e){return this.onBeforeRenderObservable.add(e),this}unregisterBeforeRender(e){return this.onBeforeRenderObservable.removeCallback(e),this}registerAfterRender(e){return this.onAfterRenderObservable.add(e),this}unregisterAfterRender(e){return this.onAfterRenderObservable.removeCallback(e),this}_getInstancesRenderList(e,t=!1){if(this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const i=this.getScene(),s=i._isInIntermediateRendering(),r=s?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,n=this._instanceDataStorage.batchCache;if(n.mustReturn=!1,n.renderSelf[e]=t||!r&&this.isEnabled()&&this.isVisible,n.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){const t=this._instanceDataStorage.visibleInstances,r=i.getRenderId(),o=s?t.intermediateDefaultRenderId:t.defaultRenderId;n.visibleInstances[e]=t[r],!n.visibleInstances[e]&&o&&(n.visibleInstances[e]=t[o])}return n.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==n.visibleInstances[e]&&void 0!==n.visibleInstances[e],this._instanceDataStorage.previousBatch=n,n}_updateInstancedBuffers(e,t,i,s,r,n){const o=t.visibleInstances[e._id],a=o?o.length:0,h=this._instanceDataStorage;let c=h.instancesBuffer,u=h.instancesPreviousBuffer,_=0,p=0;const g=t.renderSelf[e._id],f=!c||i!==h.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!h.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||h.isFrozen&&!f)p=(g?1:0)+a;else{const t=this.getWorldMatrix();if(g&&(this._scene.needsPreviousWorldMatrices&&(h.masterMeshPreviousWorldMatrix?(h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,_),h.masterMeshPreviousWorldMatrix.copyFrom(t)):(h.masterMeshPreviousWorldMatrix=t.clone(),h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,_))),t.copyToArray(h.instancesData,_),_+=16,p++),o){if(O.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&e.getMaterial()?.needAlphaBlendingForMesh(e.getRenderingMesh())){const e=this._scene.activeCamera.globalPosition;for(let t=0;t<o.length;t++){const i=o[t];i._distanceToCamera=l.Pq.Distance(i.getBoundingInfo().boundingSphere.centerWorld,e)}o.sort(((e,t)=>e._distanceToCamera>t._distanceToCamera?-1:e._distanceToCamera<t._distanceToCamera?1:0))}for(let e=0;e<o.length;e++){const t=o[e],i=t.getWorldMatrix();i.copyToArray(h.instancesData,_),this._scene.needsPreviousWorldMatrices&&(t._previousWorldMatrix?(t._previousWorldMatrix.copyToArray(h.instancesPreviousData,_),t._previousWorldMatrix.copyFrom(i)):(t._previousWorldMatrix=i.clone(),t._previousWorldMatrix.copyToArray(h.instancesPreviousData,_))),_+=16,p++}}}f?(c&&c.dispose(),u&&u.dispose(),c=new d.h(s,h.instancesData,!0,16,!1,!0),h.instancesBuffer=c,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=c.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=c.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=c.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=c.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(u=new d.h(s,h.instancesPreviousData,!0,16,!1,!0),h.instancesPreviousBuffer=u,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=u.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=u.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=u.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=u.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(c.updateDirectly(h.instancesData,0,p),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||u.updateDirectly(h.instancesPreviousData,0,p)),this._processInstancedBuffers(o,g),n&&void 0!==r&&(this.getScene()._activeIndices.addCount(e.indexCount*p,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(e,n,r),this._draw(e,r,p)),!this._scene.needsPreviousWorldMatrices||f||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||u.updateDirectly(h.instancesData,0,p)}_renderWithInstances(e,t,i,s,r){const n=i.visibleInstances[e._id],o=n?n.length:0,a=this._instanceDataStorage,h=a.instancesBufferSize,l=16*(o+1)*4;for(;a.instancesBufferSize<l;)a.instancesBufferSize*=2;return a.instancesData&&h==a.instancesBufferSize||(a.instancesData=new Float32Array(a.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!a.instancesPreviousData||h!=a.instancesBufferSize)&&(a.instancesPreviousData=new Float32Array(a.instancesBufferSize/4)),this._updateInstancedBuffers(e,i,h,r,t,s),r.unbindInstanceAttributes(),this}_renderWithThinInstances(e,t,i,s){const r=this._thinInstanceDataStorage?.instancesCount??0;this.getScene()._activeIndices.addCount(e.indexCount*r,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(e,i,t),this._draw(e,t,r),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,r):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),s.unbindInstanceAttributes()}_processInstancedBuffers(e,t){}_processRendering(e,t,i,s,r,n,o,a){const h=this.getScene(),l=h.getEngine();if(s=this._getRenderingFillMode(s),n&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,s,i,l),this;if(n)this._renderWithInstances(t,s,r,i,l);else{l._currentDrawContext&&(l._currentDrawContext.useInstancing=!1);let i=0;r.renderSelf[t._id]&&(o&&o(!1,e.getWorldMatrix(),a),i++,this._draw(t,s,this._instanceDataStorage.overridenInstanceCount));const n=r.visibleInstances[t._id];if(n){const e=n.length;i+=e;for(let i=0;i<e;i++){const e=n[i].getWorldMatrix();o&&o(!0,e,a),this._draw(t,s)}}h._activeIndices.addCount(t.indexCount*i,!1)}return this}_rebuild(e=!1){if(this._instanceDataStorage.instancesBuffer&&(e&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const t in this._userInstancedBuffersStorage.vertexBuffers){const i=this._userInstancedBuffersStorage.vertexBuffers[t];i&&(e&&i.dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(e)}_freeze(){if(this.subMeshes){for(let e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(e,t,i,s,r=!0){const n=this._scene.getEngine(),o=n.currentRenderPassId;if(void 0!==e&&(n.currentRenderPassId=e),s)(!r||r&&s.isInFrustum(this._scene._frustumPlanes))&&this.render(s,!!t,i);else for(let e=0;e<this.subMeshes.length;e++){const s=this.subMeshes[e];(!r||r&&s.isInFrustum(this._scene._frustumPlanes))&&this.render(s,!!t,i)}return void 0!==e&&(n.currentRenderPassId=o),this}directRender(){if(!this.subMeshes)return this;for(const e of this.subMeshes)this.render(e,!1);return this}render(e,t,i){const s=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const r=s.activeCameras?.length??0;if((r>1&&s.activeCamera===s.activeCameras[0]||r<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const n=this._getInstancesRenderList(e._id,!!i);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const o=s.getEngine();let a=0,h=null;this.ignoreCameraMaxZ&&s.activeCamera&&!s._isInIntermediateRendering()&&(a=s.activeCamera.maxZ,h=s.activeCamera,s.activeCamera.maxZ=0,s.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const l=e.getRenderingMesh(),c=n.hardwareInstancedRendering[e._id]||l.hasThinInstances||!!this._userInstancedBuffersStorage&&!e.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,u=this._instanceDataStorage,d=e.getMaterial();if(!d)return h&&(h.maxZ=a,s.updateTransformMatrix(!0)),this;if(u.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===d){if(d._storeEffectOnSubMeshes&&!e._drawWrapper?._wasPreviouslyReady||!d._storeEffectOnSubMeshes&&!d._getDrawWrapper()._wasPreviouslyReady)return h&&(h.maxZ=a,s.updateTransformMatrix(!0)),this}else{if(d._storeEffectOnSubMeshes){if(!d.isReadyForSubMesh(this,e,c))return h&&(h.maxZ=a,s.updateTransformMatrix(!0)),this}else if(!d.isReady(this,c))return h&&(h.maxZ=a,s.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=d}let _;t&&o.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),_=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?e._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const p=_?.effect??null;for(const t of s._beforeRenderingMeshStage)t.action(this,e,n,p);if(!_||!p)return h&&(h.maxZ=a,s.updateTransformMatrix(!0)),this;const g=i||this;let f;if(u.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)f=u.sideOrientation;else{const e=g._getWorldMatrixDeterminant();f=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),e<0&&(f=f===m.i.ClockWiseSideOrientation?m.i.CounterClockWiseSideOrientation:m.i.ClockWiseSideOrientation),u.sideOrientation=f}const b=this._internalMeshDataInfo._effectiveMaterial._preBind(_,f);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&o.setDepthWrite(!0);const v=this._internalMeshDataInfo._effectiveMaterial,T=v.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),c||this._bind(e,p,T,!1);const y=g.getWorldMatrix();v._storeEffectOnSubMeshes?v.bindForSubMesh(y,this,e):v.bind(y,this),!v.backFaceCulling&&v.separateCullingPass&&(o.setState(!0,v.zOffset,!1,!b,v.cullBackFaces,v.stencil,v.zOffsetUnits),this._processRendering(this,e,p,T,n,c,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),o.setState(!0,v.zOffset,!1,b,v.cullBackFaces,v.stencil,v.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,p,T,n,c,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const t of s._afterRenderingMeshStage)t.action(this,e,n,p);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),h&&(h.maxZ=a,s.updateTransformMatrix(!0)),2!==s.performancePriority||u.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(d.R.MatricesWeightsKind)&&(this.isVerticesDataPresent(d.R.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const e=this.getVerticesData(d.R.MatricesWeightsKind),t=e.length;for(let i=0;i<t;i+=4){const t=e[i]+e[i+1]+e[i+2]+e[i+3];if(0===t)e[i]=1;else{const s=1/t;e[i]*=s,e[i+1]*=s,e[i+2]*=s,e[i+3]*=s}}this.setVerticesData(d.R.MatricesWeightsKind,e)}_normalizeSkinWeightsAndExtra(){const e=this.getVerticesData(d.R.MatricesWeightsExtraKind),t=this.getVerticesData(d.R.MatricesWeightsKind),i=t.length;for(let s=0;s<i;s+=4){let i=t[s]+t[s+1]+t[s+2]+t[s+3];if(i+=e[s]+e[s+1]+e[s+2]+e[s+3],0===i)t[s]=1;else{const r=1/i;t[s]*=r,t[s+1]*=r,t[s+2]*=r,t[s+3]*=r,e[s]*=r,e[s+1]*=r,e[s+2]*=r,e[s+3]*=r}}this.setVerticesData(d.R.MatricesWeightsKind,t),this.setVerticesData(d.R.MatricesWeightsKind,e)}validateSkinning(){const e=this.getVerticesData(d.R.MatricesWeightsExtraKind),t=this.getVerticesData(d.R.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};const i=t.length;let s=0,r=0,n=0,o=0;const a=null===e?4:8,h=[];for(let e=0;e<=a;e++)h[e]=0;for(let l=0;l<i;l+=4){let i=t[l],c=i,u=0===c?0:1;for(let r=1;r<a;r++){const n=r<4?t[l+r]:e[l+r-4];n>i&&s++,0!==n&&u++,c+=n,i=n}if(h[u]++,u>n&&(n=u),0===c)r++;else{const i=1/c;let s=0;for(let r=0;r<a;r++)s+=r<4?Math.abs(t[l+r]-t[l+r]*i):Math.abs(e[l+r-4]-e[l+r-4]*i);s>.001&&o++}}const l=this.skeleton.bones.length,c=this.getVerticesData(d.R.MatricesIndicesKind),u=this.getVerticesData(d.R.MatricesIndicesExtraKind);let _=0;for(let e=0;e<i;e+=4)for(let t=0;t<a;t++){const i=t<4?c[e+t]:u[e+t-4];(i>=l||i<0)&&_++}return{skinned:!0,valid:0===r&&0===o&&0===_,report:"Number of Weights = "+i/4+"\nMaximum influences = "+n+"\nMissing Weights = "+r+"\nNot Sorted = "+s+"\nNot Normalized = "+o+"\nWeightCounts = ["+h+"]\nNumber of bones = "+l+"\nBad Bone Indices = "+_}}_checkDelayState(){const e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this}_queueLoad(e){e.addPendingData(this);const t=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return r.S0.LoadFile(this.delayLoadingFile,(t=>{t instanceof ArrayBuffer?this._delayLoadingFunction(t,this):this._delayLoadingFunction(JSON.parse(t),this),this.instances.forEach((e=>{e.refreshBoundingInfo(),e._syncSubMeshes()})),this.delayLoadState=1,e.removePendingData(this)}),(()=>{}),e.offlineProvider,t),this}isInFrustum(e){return 2!==this.delayLoadState&&!!super.isInFrustum(e)&&(this._checkDelayState(),!0)}setMaterialById(e){const t=this.getScene().materials;let i;for(i=t.length-1;i>-1;i--)if(t[i].id===e)return this.material=t[i],this;const s=this.getScene().multiMaterials;for(i=s.length-1;i>-1;i--)if(s[i].id===e)return this.material=s[i],this;return this}getAnimatables(){const e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e}bakeTransformIntoVertices(e){if(!this.isVerticesDataPresent(d.R.PositionKind))return this;const t=this.subMeshes.splice(0);this._resetPointsArrayCache();let i=this.getVerticesData(d.R.PositionKind);const s=l.Pq.Zero();let r;for(r=0;r<i.length;r+=3)l.Pq.TransformCoordinatesFromFloatsToRef(i[r],i[r+1],i[r+2],e,s).toArray(i,r);if(this.setVerticesData(d.R.PositionKind,i,this.getVertexBuffer(d.R.PositionKind).isUpdatable()),this.isVerticesDataPresent(d.R.NormalKind)){for(i=this.getVerticesData(d.R.NormalKind),r=0;r<i.length;r+=3)l.Pq.TransformNormalFromFloatsToRef(i[r],i[r+1],i[r+2],e,s).normalize().toArray(i,r);this.setVerticesData(d.R.NormalKind,i,this.getVertexBuffer(d.R.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(d.R.TangentKind)){for(i=this.getVerticesData(d.R.TangentKind),r=0;r<i.length;r+=4)l.Pq.TransformNormalFromFloatsToRef(i[r],i[r+1],i[r+2],e,s).normalize().toArray(i,r);this.setVerticesData(d.R.TangentKind,i,this.getVertexBuffer(d.R.TangentKind).isUpdatable())}return e.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this}bakeCurrentTransformIntoVertices(e=!0,t=!1){return t&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(e="",t=null,i,s=!0){if(t&&void 0===t._addToSceneRootNodes){const i=t;return w.source=this,w.doNotCloneChildren=i.doNotCloneChildren,w.clonePhysicsImpostor=i.clonePhysicsImpostor,w.cloneThinInstances=i.cloneThinInstances,new O(e,this.getScene(),w)}return new O(e,this.getScene(),t,this,i,s)}dispose(e,t=!1){this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),i._onBetweenPassObservable&&i._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(const e in i.meshMap){const t=i.meshMap[e];t&&(t._internalMeshDataInfo._source=null,i.meshMap[e]=void 0)}i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const e=this.getScene().meshes;for(const t of e){const e=t;e._internalMeshDataInfo&&e._internalMeshDataInfo._source&&e._internalMeshDataInfo._source===this&&(e._internalMeshDataInfo._source=null)}}i._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(e,t)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(e,t,i,s,n,o,a=!1,h){const l=this.getScene();return r.S0.LoadImage(e,(e=>{const r=e.width,h=e.height,l=this.getEngine().createCanvas(r,h).getContext("2d");l.drawImage(e,0,0);const c=l.getImageData(0,0,r,h).data;this.applyDisplacementMapFromBuffer(c,r,h,t,i,n,o,a),s&&s(this)}),h||(()=>{}),l.offlineProvider),this}applyDisplacementMapFromBuffer(e,t,i,s,r,n,o,a=!1){if(!this.isVerticesDataPresent(d.R.PositionKind)||!this.isVerticesDataPresent(d.R.NormalKind)||!this.isVerticesDataPresent(d.R.UVKind))return x.V.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const h=this.getVerticesData(d.R.PositionKind,!0,!0),c=this.getVerticesData(d.R.NormalKind),u=this.getVerticesData(d.R.UVKind);let p=l.Pq.Zero();const g=l.Pq.Zero(),f=l.I9.Zero();n=n||l.I9.Zero(),o=o||new l.I9(1,1);for(let a=0;a<h.length;a+=3){l.Pq.FromArrayToRef(h,a,p),l.Pq.FromArrayToRef(c,a,g),l.I9.FromArrayToRef(u,a/3*2,f);const d=4*((Math.abs(f.x*o.x+n.x%1)*(t-1)%t|0)+(Math.abs(f.y*o.y+n.y%1)*(i-1)%i|0)*t),_=e[d]/255*.3+e[d+1]/255*.59+e[d+2]/255*.11;g.normalize(),g.scaleInPlace(s+(r-s)*_),p=p.add(g),p.toArray(h,a)}return _.P.ComputeNormals(h,this.getIndices(),c),a?(this.setVerticesData(d.R.PositionKind,h),this.setVerticesData(d.R.NormalKind,c),this.setVerticesData(d.R.UVKind,u)):(this.updateVerticesData(d.R.PositionKind,h),this.updateVerticesData(d.R.NormalKind,c)),this}_getFlattenedNormals(e,t){const i=new Float32Array(3*e.length);let s=0;const r=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let n=0;n<e.length;n+=3){const o=l.Pq.FromArray(t,3*e[n]),a=l.Pq.FromArray(t,3*e[n+1]),h=l.Pq.FromArray(t,3*e[n+2]),c=o.subtract(a),u=h.subtract(a),d=l.Pq.Normalize(l.Pq.Cross(c,u));r&&d.scaleInPlace(-1);for(let e=0;e<3;e++)i[s++]=d.x,i[s++]=d.y,i[s++]=d.z}return i}_convertToUnIndexedMesh(e=!1){const t=this.getVerticesDataKinds().filter((e=>!this.getVertexBuffer(e)?.getIsInstanced())),i=this.getIndices(),s={},r=(e,t)=>{const s=new Float32Array(i.length*t);let r=0;for(let n=0;n<i.length;n++)for(let o=0;o<t;o++)s[r++]=e[i[n]*t+o];return s},n=this.getBoundingInfo(),o=this.geometry?this.subMeshes.slice(0):[];for(const e of t)s[e]=this.getVerticesData(e);for(const n of t){const t=this.getVertexBuffer(n),o=t.getSize();if(e&&n===d.R.NormalKind){const e=this._getFlattenedNormals(i,s[d.R.PositionKind]);this.setVerticesData(d.R.NormalKind,e,t.isUpdatable(),o)}else this.setVerticesData(n,r(s[n],o),t.isUpdatable(),o)}if(this.morphTargetManager){for(let t=0;t<this.morphTargetManager.numTargets;t++){const s=this.morphTargetManager.getTarget(t),n=s.getPositions();s.setPositions(r(n,3));const o=s.getNormals();o&&s.setNormals(e?this._getFlattenedNormals(i,n):r(o,3));const a=s.getTangents();a&&s.setTangents(r(a,3));const h=s.getUVs();h&&s.setUVs(r(h,2));const l=s.getColors();l&&s.setColors(r(l,4))}this.morphTargetManager.synchronize()}for(let e=0;e<i.length;e++)i[e]=e;this.setIndices(i),this._unIndexed=!0,this.releaseSubMeshes();for(const e of o){const t=e.getBoundingInfo();f.K.AddToMesh(e.materialIndex,e.indexStart,e.indexCount,e.indexStart,e.indexCount,this).setBoundingInfo(t)}return this.setBoundingInfo(n),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(e=!1){const t=_.P.ExtractFromMesh(this);let i;if(e&&this.isVerticesDataPresent(d.R.NormalKind)&&t.normals){for(i=0;i<t.normals.length;i++)t.normals[i]*=-1;this.setVerticesData(d.R.NormalKind,t.normals,this.isVertexBufferUpdatable(d.R.NormalKind))}if(t.indices){let e;for(i=0;i<t.indices.length;i+=3)e=t.indices[i+1],t.indices[i+1]=t.indices[i+2],t.indices[i+2]=e;this.setIndices(t.indices,null,this.isVertexBufferUpdatable(d.R.PositionKind),!0)}return this}increaseVertices(e=1){const t=_.P.ExtractFromMesh(this),i=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,s=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,r=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,n=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(i&&s){t.indices=i,t.positions=s,r&&(t.uvs=r),n&&(t.normals=n);const o=e+1,a=new Array;for(let e=0;e<o+1;e++)a[e]=new Array;let h,c;const u=new l.Pq(0,0,0),_=new l.Pq(0,0,0),p=new l.I9(0,0),g=new Array,f=new Array,m=new Array;let b,v,T,y=s.length;r&&(v=r.length),n&&(T=n.length);for(let e=0;e<i.length;e+=3){f[0]=i[e],f[1]=i[e+1],f[2]=i[e+2];for(let e=0;e<3;e++)if(h=f[e],c=f[(e+1)%3],void 0===m[h]&&void 0===m[c]?(m[h]=new Array,m[c]=new Array):(void 0===m[h]&&(m[h]=new Array),void 0===m[c]&&(m[c]=new Array)),void 0===m[h][c]&&void 0===m[c][h]){m[h][c]=[],u.x=(s[3*c]-s[3*h])/o,u.y=(s[3*c+1]-s[3*h+1])/o,u.z=(s[3*c+2]-s[3*h+2])/o,n&&(_.x=(n[3*c]-n[3*h])/o,_.y=(n[3*c+1]-n[3*h+1])/o,_.z=(n[3*c+2]-n[3*h+2])/o),r&&(p.x=(r[2*c]-r[2*h])/o,p.y=(r[2*c+1]-r[2*h+1])/o),m[h][c].push(h);for(let e=1;e<o;e++)m[h][c].push(s.length/3),s[y++]=s[3*h]+e*u.x,s[y++]=s[3*h+1]+e*u.y,s[y++]=s[3*h+2]+e*u.z,n&&(n[T++]=n[3*h]+e*_.x,n[T++]=n[3*h+1]+e*_.y,n[T++]=n[3*h+2]+e*_.z),r&&(r[v++]=r[2*h]+e*p.x,r[v++]=r[2*h+1]+e*p.y);m[h][c].push(c),m[c][h]=new Array,b=m[h][c].length;for(let e=0;e<b;e++)m[c][h][e]=m[h][c][b-1-e]}a[0][0]=i[e],a[1][0]=m[i[e]][i[e+1]][1],a[1][1]=m[i[e]][i[e+2]][1];for(let t=2;t<o;t++){a[t][0]=m[i[e]][i[e+1]][t],a[t][t]=m[i[e]][i[e+2]][t],u.x=(s[3*a[t][t]]-s[3*a[t][0]])/t,u.y=(s[3*a[t][t]+1]-s[3*a[t][0]+1])/t,u.z=(s[3*a[t][t]+2]-s[3*a[t][0]+2])/t,n&&(_.x=(n[3*a[t][t]]-n[3*a[t][0]])/t,_.y=(n[3*a[t][t]+1]-n[3*a[t][0]+1])/t,_.z=(n[3*a[t][t]+2]-n[3*a[t][0]+2])/t),r&&(p.x=(r[2*a[t][t]]-r[2*a[t][0]])/t,p.y=(r[2*a[t][t]+1]-r[2*a[t][0]+1])/t);for(let e=1;e<t;e++)a[t][e]=s.length/3,s[y++]=s[3*a[t][0]]+e*u.x,s[y++]=s[3*a[t][0]+1]+e*u.y,s[y++]=s[3*a[t][0]+2]+e*u.z,n&&(n[T++]=n[3*a[t][0]]+e*_.x,n[T++]=n[3*a[t][0]+1]+e*_.y,n[T++]=n[3*a[t][0]+2]+e*_.z),r&&(r[v++]=r[2*a[t][0]]+e*p.x,r[v++]=r[2*a[t][0]+1]+e*p.y)}a[o]=m[i[e+1]][i[e+2]],g.push(a[0][0],a[1][0],a[1][1]);for(let e=1;e<o;e++){let t;for(t=0;t<e;t++)g.push(a[e][t],a[e+1][t],a[e+1][t+1]),g.push(a[e][t],a[e+1][t+1],a[e][t+1]);g.push(a[e][t],a[e+1][t],a[e+1][t+1])}}t.indices=g,t.applyToMesh(this,this.isVertexBufferUpdatable(d.R.PositionKind))}else x.V.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const e=_.P.ExtractFromMesh(this),t=e.uvs,i=e.indices,s=e.positions,r=e.colors,n=e.matricesIndices,o=e.matricesWeights,a=e.matricesIndicesExtra,h=e.matricesWeightsExtra;if(void 0===i||void 0===s||null===i||null===s)x.V.Warn("VertexData contains empty entries");else{const l=new Array,c=new Array,u=new Array,p=new Array,g=new Array,f=new Array,m=new Array,b=new Array;let v=new Array,T=0;const y={};let x,A;for(let e=0;e<i.length;e+=3){A=[i[e],i[e+1],i[e+2]],v=[];for(let e=0;e<3;e++){v[e]="";for(let t=0;t<3;t++)Math.abs(s[3*A[e]+t])<1e-8&&(s[3*A[e]+t]=0),v[e]+=s[3*A[e]+t]+"|"}if(v[0]!=v[1]&&v[0]!=v[2]&&v[1]!=v[2])for(let e=0;e<3;e++){if(x=y[v[e]],void 0===x){y[v[e]]=T,x=T++;for(let t=0;t<3;t++)l.push(s[3*A[e]+t]);if(null!=r)for(let t=0;t<4;t++)p.push(r[4*A[e]+t]);if(null!=t)for(let i=0;i<2;i++)u.push(t[2*A[e]+i]);if(null!=n)for(let t=0;t<4;t++)g.push(n[4*A[e]+t]);if(null!=o)for(let t=0;t<4;t++)f.push(o[4*A[e]+t]);if(null!=a)for(let t=0;t<4;t++)m.push(a[4*A[e]+t]);if(null!=h)for(let t=0;t<4;t++)b.push(h[4*A[e]+t])}c.push(x)}}const C=new Array;_.P.ComputeNormals(l,c,C),e.positions=l,e.indices=c,e.normals=C,null!=t&&(e.uvs=u),null!=r&&(e.colors=p),null!=n&&(e.matricesIndices=g),null!=o&&(e.matricesWeights=f),null!=a&&(e.matricesIndicesExtra=m),null!=o&&(e.matricesWeightsExtra=b),e.applyToMesh(this,this.isVertexBufferUpdatable(d.R.PositionKind))}}static _instancedMeshFactory(e,t){throw(0,A.n)("InstancedMesh")}static _PhysicsImpostorParser(e,t,i){throw(0,A.n)("PhysicsImpostor")}createInstance(e){const t=O._instancedMeshFactory(e,this);return t.parent=this.parent,t}synchronizeInstances(){for(let e=0;e<this.instances.length;e++)this.instances[e]._syncSubMeshes();return this}optimizeIndices(e){const t=this.getIndices(),i=this.getVerticesData(d.R.PositionKind);if(!i||!t)return this;const s=[];for(let e=0;e<i.length;e+=3)s.push(l.Pq.FromArray(i,e));const n=[];return r.LV.SyncAsyncForLoop(s.length,40,(e=>{const t=s.length-1-e,i=s[t];for(let e=0;e<t;++e){const r=s[e];if(i.equals(r)){n[t]=e;break}}}),(()=>{for(let e=0;e<t.length;++e)t[e]=n[t[e]]||t[e];const i=this.subMeshes.slice(0);this.setIndices(t),this.subMeshes=i,e&&e(this)})),this}serialize(e={}){e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,e.type=this.getClassName(),o.Y&&o.Y.HasTags(this)&&(e.tags=o.Y.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.alwaysSelectAsActiveMesh=this.alwaysSelectAsActiveMesh,e.checkCollisions=this.checkCollisions,e.ellipsoid=this.ellipsoid.asArray(),e.ellipsoidOffset=this.ellipsoidOffset.asArray(),e.doNotSyncBoundingInfo=this.doNotSyncBoundingInfo,e.isBlocker=this.isBlocker,e.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(e),e.isUnIndexed=this.isUnIndexed;const t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.uniqueId,e.geometryId=t.id,e.subMeshes=[];for(let t=0;t<this.subMeshes.length;t++){const i=this.subMeshes[t];e.subMeshes.push({materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount,indexStart:i.indexStart,indexCount:i.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.uniqueId,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.uniqueId,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(C.v.NAME_PHYSICSENGINE)){const t=this.getPhysicsImpostor();t&&(e.physicsMass=t.getParam("mass"),e.physicsFriction=t.getParam("friction"),e.physicsRestitution=t.getParam("mass"),e.physicsImpostor=t.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(let t=0;t<this.instances.length;t++){const i=this.instances[t];if(i.doNotSerialize)continue;const s={name:i.name,id:i.id,isEnabled:i.isEnabled(!1),isVisible:i.isVisible,isPickable:i.isPickable,checkCollisions:i.checkCollisions,position:i.position.asArray(),scaling:i.scaling.asArray()};if(i.parent&&i.parent._serializeAsParent(s),i.rotationQuaternion?s.rotationQuaternion=i.rotationQuaternion.asArray():i.rotation&&(s.rotation=i.rotation.asArray()),this.getScene()._getComponent(C.v.NAME_PHYSICSENGINE)){const e=i.getPhysicsImpostor();e&&(s.physicsMass=e.getParam("mass"),s.physicsFriction=e.getParam("friction"),s.physicsRestitution=e.getParam("mass"),s.physicsImpostor=e.type)}i.metadata&&(s.metadata=i.metadata),i.actionManager&&(s.actions=i.actionManager.serialize(i.name)),e.instances.push(s),y.p.AppendSerializedAnimations(i,s),s.ranges=i.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const t={data:{},sizes:{},strides:{}};for(const e in this._userThinInstanceBuffersStorage.data)t.data[e]=Array.from(this._userThinInstanceBuffersStorage.data[e]),t.sizes[e]=this._userThinInstanceBuffersStorage.sizes[e],t.strides[e]=this._userThinInstanceBuffersStorage.strides[e];e.thinInstances.userThinInstance=t}return y.p.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name)),e}_syncGeometryWithMorphTargetManager(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();const e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return x.V.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(e.isUsingTextureForTargets)return;for(let t=0;t<e.numInfluencers;t++){const i=e.getActiveTarget(t),s=i.getPositions();if(!s)return void x.V.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(d.R.PositionKind+t,s,!1,3);const r=i.getNormals();r&&this.geometry.setVerticesData(d.R.NormalKind+t,r,!1,3);const n=i.getTangents();n&&this.geometry.setVerticesData(d.R.TangentKind+t,n,!1,3);const o=i.getUVs();o&&this.geometry.setVerticesData(d.R.UVKind+"_"+t,o,!1,2);const a=i.getUV2s();a&&this.geometry.setVerticesData(d.R.UV2Kind+"_"+t,a,!1,2);const h=i.getColors();h&&this.geometry.setVerticesData(d.R.ColorKind+t,h,!1,4)}}else{let e=0;for(;this.geometry.isVerticesDataPresent(d.R.PositionKind+e);)this.geometry.removeVerticesData(d.R.PositionKind+e),this.geometry.isVerticesDataPresent(d.R.NormalKind+e)&&this.geometry.removeVerticesData(d.R.NormalKind+e),this.geometry.isVerticesDataPresent(d.R.TangentKind+e)&&this.geometry.removeVerticesData(d.R.TangentKind+e),this.geometry.isVerticesDataPresent(d.R.UVKind+e)&&this.geometry.removeVerticesData(d.R.UVKind+"_"+e),this.geometry.isVerticesDataPresent(d.R.UV2Kind+e)&&this.geometry.removeVerticesData(d.R.UV2Kind+"_"+e),this.geometry.isVerticesDataPresent(d.R.ColorKind+e)&&this.geometry.removeVerticesData(d.R.ColorKind+e),e++}}static Parse(e,t,i){let s;if(s=e.type&&"LinesMesh"===e.type?O._LinesMeshParser(e,t):e.type&&"GroundMesh"===e.type?O._GroundMeshParser(e,t):e.type&&"GoldbergMesh"===e.type?O._GoldbergMeshParser(e,t):e.type&&"GreasedLineMesh"===e.type?O._GreasedLineMeshParser(e,t):e.type&&"TrailMesh"===e.type?O._TrailMeshParser(e,t):new O(e.name,t),s.id=e.id,s._waitingParsedUniqueId=e.uniqueId,o.Y&&o.Y.AddTagsTo(s,e.tags),s.position=l.Pq.FromArray(e.position),void 0!==e.metadata&&(s.metadata=e.metadata),e.rotationQuaternion?s.rotationQuaternion=l.PT.FromArray(e.rotationQuaternion):e.rotation&&(s.rotation=l.Pq.FromArray(e.rotation)),s.scaling=l.Pq.FromArray(e.scaling),e.localMatrix?s.setPreTransformMatrix(l.uq.FromArray(e.localMatrix)):e.pivotMatrix&&s.setPivotMatrix(l.uq.FromArray(e.pivotMatrix)),s.setEnabled(e.isEnabled),s.isVisible=e.isVisible,s.infiniteDistance=e.infiniteDistance,s.alwaysSelectAsActiveMesh=!!e.alwaysSelectAsActiveMesh,s.showBoundingBox=e.showBoundingBox,s.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(s.applyFog=e.applyFog),void 0!==e.pickable&&(s.isPickable=e.pickable),void 0!==e.alphaIndex&&(s.alphaIndex=e.alphaIndex),s.receiveShadows=e.receiveShadows,void 0!==e.billboardMode&&(s.billboardMode=e.billboardMode),void 0!==e.visibility&&(s.visibility=e.visibility),s.checkCollisions=e.checkCollisions,s.doNotSyncBoundingInfo=!!e.doNotSyncBoundingInfo,e.ellipsoid&&(s.ellipsoid=l.Pq.FromArray(e.ellipsoid)),e.ellipsoidOffset&&(s.ellipsoidOffset=l.Pq.FromArray(e.ellipsoidOffset)),null!=e.overrideMaterialSideOrientation&&(s.sideOrientation=e.overrideMaterialSideOrientation),void 0!==e.sideOrientation&&(s.sideOrientation=e.sideOrientation),void 0!==e.isBlocker&&(s.isBlocker=e.isBlocker),s._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(s._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),void 0!==e.parentId&&(s._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.actions&&(s._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(s.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(s.overlayColor=c.v9.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(s.renderOverlay=e.renderOverlay),s.isUnIndexed=!!e.isUnIndexed,s.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(s.delayLoadState=4,s.delayLoadingFile=i+e.delayLoadingFile,s.buildBoundingInfo(l.Pq.FromArray(e.boundingBoxMinimum),l.Pq.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(s._binaryInfo=e._binaryInfo),s._delayInfo=[],e.hasUVs&&s._delayInfo.push(d.R.UVKind),e.hasUVs2&&s._delayInfo.push(d.R.UV2Kind),e.hasUVs3&&s._delayInfo.push(d.R.UV3Kind),e.hasUVs4&&s._delayInfo.push(d.R.UV4Kind),e.hasUVs5&&s._delayInfo.push(d.R.UV5Kind),e.hasUVs6&&s._delayInfo.push(d.R.UV6Kind),e.hasColors&&s._delayInfo.push(d.R.ColorKind),e.hasMatricesIndices&&s._delayInfo.push(d.R.MatricesIndicesKind),e.hasMatricesWeights&&s._delayInfo.push(d.R.MatricesWeightsKind),s._delayLoadingFunction=p.V._ImportGeometry,T.B.ForceFullSceneLoadingForIncremental&&s._checkDelayState()):p.V._ImportGeometry(e,s),e.materialUniqueId?s._waitingMaterialId=e.materialUniqueId:e.materialId&&(s._waitingMaterialId=e.materialId),e.morphTargetManagerId>-1&&(s._waitingMorphTargetManagerId=e.morphTargetManagerId),void 0!==e.skeletonId&&null!==e.skeletonId&&(s.skeleton=t.getLastSkeletonById(e.skeletonId),e.numBoneInfluencers&&(s.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],r=(0,b.n9)("BABYLON.Animation");r&&s.animations.push(r.Parse(i))}u.b.ParseAnimationRanges(s,e,t)}if(e.autoAnimate&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?s.layerMask=Math.abs(parseInt(e.layerMask)):s.layerMask=268435455,e.physicsImpostor&&(s.physicsImpostor=O._PhysicsImpostorParser(t,s,e)),e.lodMeshIds&&(s._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(let i=0;i<e.instances.length;i++){const r=e.instances[i],n=s.createInstance(r.name);if(r.id&&(n.id=r.id),o.Y&&(r.tags?o.Y.AddTagsTo(n,r.tags):o.Y.AddTagsTo(n,e.tags)),n.position=l.Pq.FromArray(r.position),void 0!==r.metadata&&(n.metadata=r.metadata),void 0!==r.parentId&&(n._waitingParentId=r.parentId),void 0!==r.parentInstanceIndex&&(n._waitingParentInstanceIndex=r.parentInstanceIndex),void 0!==r.isEnabled&&null!==r.isEnabled&&n.setEnabled(r.isEnabled),void 0!==r.isVisible&&null!==r.isVisible&&(n.isVisible=r.isVisible),void 0!==r.isPickable&&null!==r.isPickable&&(n.isPickable=r.isPickable),r.rotationQuaternion?n.rotationQuaternion=l.PT.FromArray(r.rotationQuaternion):r.rotation&&(n.rotation=l.Pq.FromArray(r.rotation)),n.scaling=l.Pq.FromArray(r.scaling),null!=r.checkCollisions&&null!=r.checkCollisions&&(n.checkCollisions=r.checkCollisions),null!=r.pickable&&null!=r.pickable&&(n.isPickable=r.pickable),null!=r.showBoundingBox&&null!=r.showBoundingBox&&(n.showBoundingBox=r.showBoundingBox),null!=r.showSubMeshesBoundingBox&&null!=r.showSubMeshesBoundingBox&&(n.showSubMeshesBoundingBox=r.showSubMeshesBoundingBox),null!=r.alphaIndex&&null!=r.showSubMeshesBoundingBox&&(n.alphaIndex=r.alphaIndex),r.physicsImpostor&&(n.physicsImpostor=O._PhysicsImpostorParser(t,n,r)),void 0!==r.actions&&(n._waitingData.actions=r.actions),r.animations){for(let e=0;e<r.animations.length;e++){const t=r.animations[e],i=(0,b.n9)("BABYLON.Animation");i&&n.animations.push(i.Parse(t))}u.b.ParseAnimationRanges(n,r,t),r.autoAnimate&&t.beginAnimation(n,r.autoAnimateFrom,r.autoAnimateTo,r.autoAnimateLoop,r.autoAnimateSpeed||1)}}if(e.thinInstances){const t=e.thinInstances;if(s.thinInstanceEnablePicking=!!t.enablePicking,t.matrixData?(s.thinInstanceSetBuffer("matrix",new Float32Array(t.matrixData),16,!1),s._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,s._thinInstanceDataStorage.instancesCount=t.instancesCount):s._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,e.thinInstances.userThinInstance){const t=e.thinInstances.userThinInstance;for(const e in t.data)s.thinInstanceSetBuffer(e,new Float32Array(t.data[e]),t.strides[e],!1),s._userThinInstanceBuffersStorage.sizes[e]=t.sizes[e]}}return s}setPositionsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourcePositions){const t=this.getVerticesData(d.R.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(d.R.PositionKind)||this.setVerticesData(d.R.PositionKind,t,!0)}return e._sourcePositions}setNormalsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourceNormals){const t=this.getVerticesData(d.R.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(d.R.NormalKind)||this.setVerticesData(d.R.NormalKind,t,!0)}return e._sourceNormals}applySkeleton(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(d.R.PositionKind))return this;if(!this.isVerticesDataPresent(d.R.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(d.R.MatricesWeightsKind))return this;const t=this.isVerticesDataPresent(d.R.NormalKind),i=this._internalMeshDataInfo;if(!i._sourcePositions){const e=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=e}t&&!i._sourceNormals&&this.setNormalsForCPUSkinning();let s=this.getVerticesData(d.R.PositionKind);if(!s)return this;s instanceof Float32Array||(s=new Float32Array(s));let r=this.getVerticesData(d.R.NormalKind);if(t){if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r))}const n=this.getVerticesData(d.R.MatricesIndicesKind),o=this.getVerticesData(d.R.MatricesWeightsKind);if(!o||!n)return this;const a=this.numBoneInfluencers>4,h=a?this.getVerticesData(d.R.MatricesIndicesExtraKind):null,c=a?this.getVerticesData(d.R.MatricesWeightsExtraKind):null,u=e.getTransformMatrices(this),_=l.Pq.Zero(),p=new l.uq,g=new l.uq;let f,m=0;for(let e=0;e<s.length;e+=3,m+=4){let d;for(f=0;f<4;f++)d=o[m+f],d>0&&(l.uq.FromFloat32ArrayToRefScaled(u,Math.floor(16*n[m+f]),d,g),p.addToSelf(g));if(a)for(f=0;f<4;f++)d=c[m+f],d>0&&(l.uq.FromFloat32ArrayToRefScaled(u,Math.floor(16*h[m+f]),d,g),p.addToSelf(g));l.Pq.TransformCoordinatesFromFloatsToRef(i._sourcePositions[e],i._sourcePositions[e+1],i._sourcePositions[e+2],p,_),_.toArray(s,e),t&&(l.Pq.TransformNormalFromFloatsToRef(i._sourceNormals[e],i._sourceNormals[e+1],i._sourceNormals[e+2],p,_),_.toArray(r,e)),p.reset()}return this.updateVerticesData(d.R.PositionKind,s),t&&this.updateVerticesData(d.R.NormalKind,r),this}static MinMax(e){let t=null,i=null;return e.forEach((function(e){const s=e.getBoundingInfo().boundingBox;t&&i?(t.minimizeInPlace(s.minimumWorld),i.maximizeInPlace(s.maximumWorld)):(t=s.minimumWorld,i=s.maximumWorld)})),t&&i?{min:t,max:i}:{min:l.Pq.Zero(),max:l.Pq.Zero()}}static Center(e){const t=e instanceof Array?O.MinMax(e):e;return l.Pq.Center(t.min,t.max)}static MergeMeshes(e,t=!0,i,s,r,n){return(0,a.V1)(O._MergeMeshesCoroutine(e,t,i,s,r,n,!1))}static MergeMeshesAsync(e,t=!0,i,s,r,n){return(0,a.kj)(O._MergeMeshesCoroutine(e,t,i,s,r,n,!0),(0,a.VP)())}static*_MergeMeshesCoroutine(e,t=!0,i,s,r,n,o){if(0===(e=e.filter(Boolean)).length)return null;let a;if(!i){let t=0;for(a=0;a<e.length;a++)if(t+=e[a].getTotalVertices(),t>=65536)return x.V.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}n&&(r=!1);const h=new Array,l=new Array,c=new Array,u=e[0].sideOrientation;for(a=0;a<e.length;a++){const t=e[a];if(t.isAnInstance)return x.V.Warn("Cannot merge instance meshes."),null;if(u!==t.sideOrientation)return x.V.Warn("Cannot merge meshes with different sideOrientation values."),null;if(r&&c.push(t.getTotalIndices()),n)if(t.material){const e=t.material;if(e instanceof v){for(let t=0;t<e.subMaterials.length;t++)h.indexOf(e.subMaterials[t])<0&&h.push(e.subMaterials[t]);for(let i=0;i<t.subMeshes.length;i++)l.push(h.indexOf(e.subMaterials[t.subMeshes[i].materialIndex])),c.push(t.subMeshes[i].indexCount)}else{h.indexOf(e)<0&&h.push(e);for(let i=0;i<t.subMeshes.length;i++)l.push(h.indexOf(e)),c.push(t.subMeshes[i].indexCount)}}else for(let e=0;e<t.subMeshes.length;e++)l.push(0),c.push(t.subMeshes[e].indexCount)}const d=e[0],p=e=>{const t=e.computeWorldMatrix(!0);return{vertexData:_.P.ExtractFromMesh(e,!1,!1),transform:t}},{vertexData:g,transform:m}=p(d);o&&(yield);const b=new Array(e.length-1);for(let t=1;t<e.length;t++)b[t-1]=p(e[t]),o&&(yield);const T=g._mergeCoroutine(m,b,i,o,!t);let y=T.next();for(;!y.done;)o&&(yield),y=T.next();const A=y.value;s||(s=new O(d.name+"_merged",d.getScene()));const C=A._applyToCoroutine(s,void 0,o);let S=C.next();for(;!S.done;)o&&(yield),S=C.next();if(s.checkCollisions=d.checkCollisions,s.sideOrientation=d.sideOrientation,t)for(a=0;a<e.length;a++)e[a].dispose();if(r||n){s.releaseSubMeshes(),a=0;let e=0;for(;a<c.length;)f.K.CreateFromIndices(0,e,c[a],s,void 0,!1),e+=c[a],a++;for(const e of s.subMeshes)e.refreshBoundingInfo();s.computeWorldMatrix(!0)}if(n){const e=new v(d.name+"_merged",d.getScene());e.subMaterials=h;for(let e=0;e<s.subMeshes.length;e++)s.subMeshes[e].materialIndex=l[e];s.material=e}else s.material=d.material;return s}addInstance(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)}removeInstance(e){const t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){const e=this.instances[this.instances.length-1];this.instances[t]=e,e._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===m.i.CounterClockWiseSideOrientation}_getRenderingFillMode(e){const t=this.getScene();return t.forcePointsCloud?m.i.PointFillMode:t.forceWireframe?m.i.WireFrameFillMode:this.overrideRenderingFillMode??e}setMaterialByID(e){return this.setMaterialById(e)}static CreateRibbon(e,t,i,s,r,n,o,a,h){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(e,t,i,s,r,n){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(e,t,i,s,r){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(e,t,i,s,r,n){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(e,t,i,s){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(e,t,i,s,r,n,o,a,h){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(e,t,i,s,r,n,o){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(e,t,i,s,r,n,o,a,h,l){throw new Error("Import MeshBuilder to populate this function")}static CreateLines(e,t,i,s,r){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(e,t,i,s,r,n,o,a){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(e,t,i,s,r,n,o){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(e,t,i,s,r,n,o,a){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(e,t,i,s,r,n,o,a,h,l){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(e,t,i,s,r,n,o,a,h,l,c,u){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(e,t,i,s,r,n,o){throw new Error("Import MeshBuilder to populate this function")}static CreatePlane(e,t,i,s,r){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(e,t,i,s,r,n){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(e,t,i,s,r,n,o,a,h){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(e,t,i,s,r,n,o,a,h,l,c){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(e,t,i,s,r,n,o,a,h,l){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(e,t,i,s,r,n){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(e){throw new Error("Import MeshBuilder to populate this function")}}O.FRONTSIDE=_.P.FRONTSIDE,O.BACKSIDE=_.P.BACKSIDE,O.DOUBLESIDE=_.P.DOUBLESIDE,O.DEFAULTSIDE=_.P.DEFAULTSIDE,O.NO_CAP=0,O.CAP_START=1,O.CAP_END=2,O.CAP_ALL=3,O.NO_FLIP=0,O.FLIP_TILE=1,O.ROTATE_TILE=2,O.FLIP_ROW=3,O.ROTATE_ROW=4,O.FLIP_N_ROTATE_TILE=5,O.FLIP_N_ROTATE_ROW=6,O.CENTER=0,O.LEFT=1,O.RIGHT=2,O.TOP=3,O.BOTTOM=4,O.INSTANCEDMESH_SORT_TRANSPARENT=!1,O._GroundMeshParser=(e,t)=>{throw(0,A.n)("GroundMesh")},O._GoldbergMeshParser=(e,t)=>{throw(0,A.n)("GoldbergMesh")},O._LinesMeshParser=(e,t)=>{throw(0,A.n)("LinesMesh")},O._GreasedLineMeshParser=(e,t)=>{throw(0,A.n)("GreasedLineMesh")},O._GreasedLineRibbonMeshParser=(e,t)=>{throw(0,A.n)("GreasedLineRibbonMesh")},O._TrailMeshParser=(e,t)=>{throw(0,A.n)("TrailMesh")},(0,b.Y5)("BABYLON.Mesh",O)},9202:(e,t,i)=>{"use strict";i.d(t,{d:()=>s});class s{get underlyingResource(){return this._webGLTexture}constructor(e=null,t){if(this._MSAARenderBuffers=null,this._context=t,!e&&!(e=t.createTexture()))throw new Error("Unable to create webGL texture");this.set(e)}setUsage(){}set(e){this._webGLTexture=e}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(e){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(e)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const e of this._MSAARenderBuffers)this._context.deleteRenderbuffer(e);this._MSAARenderBuffers=null}}getMSAARenderBuffer(e=0){return this._MSAARenderBuffers?.[e]??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},9271:(e,t,i)=>{"use strict";i.d(t,{s:()=>b});var s=i(504),r=i(4754),n=i(4537),o=i(7904),a=i(4049),h=i(9732);class l{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(e){e=h.S0.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const i=t.event;if(!i.metaKey)if(t.type===o.TB.KEYDOWN)-1===this.keysUp.indexOf(i.keyCode)&&-1===this.keysDown.indexOf(i.keyCode)&&-1===this.keysLeft.indexOf(i.keyCode)&&-1===this.keysRight.indexOf(i.keyCode)&&-1===this.keysUpward.indexOf(i.keyCode)&&-1===this.keysDownward.indexOf(i.keyCode)&&-1===this.keysRotateLeft.indexOf(i.keyCode)&&-1===this.keysRotateRight.indexOf(i.keyCode)&&-1===this.keysRotateUp.indexOf(i.keyCode)&&-1===this.keysRotateDown.indexOf(i.keyCode)||(-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),e||i.preventDefault());else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){const t=this._keys.indexOf(i.keyCode);t>=0&&this._keys.splice(t,1),e||i.preventDefault()}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const i=this._keys[t],s=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?e._localDirection.copyFromFloats(-s,0,0):-1!==this.keysUp.indexOf(i)?e._localDirection.copyFromFloats(0,0,s):-1!==this.keysRight.indexOf(i)?e._localDirection.copyFromFloats(s,0,0):-1!==this.keysDown.indexOf(i)?e._localDirection.copyFromFloats(0,0,-s):-1!==this.keysUpward.indexOf(i)?e._localDirection.copyFromFloats(0,s,0):-1!==this.keysDownward.indexOf(i)?e._localDirection.copyFromFloats(0,-s,0):-1!==this.keysRotateLeft.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(i)&&(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x+=this._getLocalRotation()),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),a.Pq.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const e=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*e}}(0,r.Cg)([(0,n.lK)()],l.prototype,"keysUp",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"keysUpward",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"keysDown",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"keysDownward",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"keysLeft",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"keysRight",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"rotationSpeed",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"keysRotateLeft",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"keysRotateRight",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"keysRotateUp",void 0),(0,r.Cg)([(0,n.lK)()],l.prototype,"keysRotateDown",void 0),s.H.FreeCameraKeyboardMoveInput=l;var c=i(3054),u=i(3846);class d{constructor(e=!0){this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new c.cP,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(e){e=h.S0.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),i=t.getInputElement();this._pointerInput||(this._pointerInput=s=>{const r=s.event,n="touch"===r.pointerType;if(!this.touchEnabled&&n)return;if(s.type!==u.Zp.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const o=r.target;if(s.type===u.Zp.POINTERDOWN){if(n&&-1!==this._activePointerId||!n&&-1!==this._currentActiveButton)return;this._activePointerId=r.pointerId;try{o?.setPointerCapture(r.pointerId)}catch(e){}-1===this._currentActiveButton&&(this._currentActiveButton=r.button),this._previousPosition={x:r.clientX,y:r.clientY},e||(r.preventDefault(),i&&i.focus()),t.isPointerLock&&this._onMouseMove&&this._onMouseMove(s.event)}else if(s.type===u.Zp.POINTERUP){if(n&&this._activePointerId!==r.pointerId||!n&&this._currentActiveButton!==r.button)return;try{o?.releasePointerCapture(r.pointerId)}catch(e){}this._currentActiveButton=-1,this._previousPosition=null,e||r.preventDefault(),this._activePointerId=-1}else if(s.type===u.Zp.POINTERMOVE&&(this._activePointerId===r.pointerId||!n))if(t.isPointerLock&&this._onMouseMove)this._onMouseMove(s.event);else if(this._previousPosition){const t=this.camera._calculateHandednessMultiplier(),i=(r.clientX-this._previousPosition.x)*t,s=r.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=i/this.angularSensibility,this.camera.cameraRotation.x+=s/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:i,offsetY:s}),this._previousPosition={x:r.clientX,y:r.clientY},e||r.preventDefault()}}),this._onMouseMove=i=>{if(!t.isPointerLock)return;const s=this.camera._calculateHandednessMultiplier(),r=i.movementX*s;this.camera.cameraRotation.y+=r/this.angularSensibility;const n=i.movementY;this.camera.cameraRotation.x+=n/this.angularSensibility,this._previousPosition=null,e||i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,u.Zp.POINTERDOWN|u.Zp.POINTERUP|u.Zp.POINTERMOVE),i&&(this._contextMenuBind=e=>this.onContextMenu(e),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(e){e.preventDefault()}detachControl(){if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,r.Cg)([(0,n.lK)()],d.prototype,"buttons",void 0),(0,r.Cg)([(0,n.lK)()],d.prototype,"angularSensibility",void 0),s.H.FreeCameraMouseInput=d;var _,p=i(9169);class g{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new c.cP,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(e){e=h.S0.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==u.Zp.POINTERWHEEL)return;const i=t.event,s=i.deltaMode===p.s.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*s*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*s*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*s*i.deltaZ/this._normalize,i.preventDefault&&(e||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,u.Zp.POINTERWHEEL)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,r.Cg)([(0,n.lK)()],g.prototype,"wheelPrecisionX",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"wheelPrecisionY",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"wheelPrecisionZ",void 0),function(e){e[e.MoveRelative=0]="MoveRelative",e[e.RotateRelative=1]="RotateRelative",e[e.MoveScene=2]="MoveScene"}(_||(_={}));class f extends g{constructor(){super(...arguments),this._moveRelative=a.Pq.Zero(),this._rotateRelative=a.Pq.Zero(),this._moveScene=a.Pq.Zero(),this._wheelXAction=_.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=_.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(e){null===e&&this._wheelXAction!==_.MoveRelative||(this._wheelXAction=_.MoveRelative,this._wheelXActionCoordinate=e)}get wheelXMoveRelative(){return this._wheelXAction!==_.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(e){null===e&&this._wheelYAction!==_.MoveRelative||(this._wheelYAction=_.MoveRelative,this._wheelYActionCoordinate=e)}get wheelYMoveRelative(){return this._wheelYAction!==_.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(e){null===e&&this._wheelZAction!==_.MoveRelative||(this._wheelZAction=_.MoveRelative,this._wheelZActionCoordinate=e)}get wheelZMoveRelative(){return this._wheelZAction!==_.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(e){null===e&&this._wheelXAction!==_.RotateRelative||(this._wheelXAction=_.RotateRelative,this._wheelXActionCoordinate=e)}get wheelXRotateRelative(){return this._wheelXAction!==_.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(e){null===e&&this._wheelYAction!==_.RotateRelative||(this._wheelYAction=_.RotateRelative,this._wheelYActionCoordinate=e)}get wheelYRotateRelative(){return this._wheelYAction!==_.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(e){null===e&&this._wheelZAction!==_.RotateRelative||(this._wheelZAction=_.RotateRelative,this._wheelZActionCoordinate=e)}get wheelZRotateRelative(){return this._wheelZAction!==_.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(e){null===e&&this._wheelXAction!==_.MoveScene||(this._wheelXAction=_.MoveScene,this._wheelXActionCoordinate=e)}get wheelXMoveScene(){return this._wheelXAction!==_.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(e){null===e&&this._wheelYAction!==_.MoveScene||(this._wheelYAction=_.MoveScene,this._wheelYActionCoordinate=e)}get wheelYMoveScene(){return this._wheelYAction!==_.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(e){null===e&&this._wheelZAction!==_.MoveScene||(this._wheelZAction=_.MoveScene,this._wheelZActionCoordinate=e)}get wheelZMoveScene(){return this._wheelZAction!==_.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);const e=a.uq.Zero();this.camera.getViewMatrix().invertToRef(e);const t=a.Pq.Zero();a.Pq.TransformNormalToRef(this._moveRelative,e,t),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(t),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(e,t,i){if(0===e)return;if(null===t||null===i)return;let s=null;switch(t){case _.MoveRelative:s=this._moveRelative;break;case _.RotateRelative:s=this._rotateRelative;break;case _.MoveScene:s=this._moveScene}switch(i){case 0:s.set(e,0,0);break;case 1:s.set(0,e,0);break;case 2:s.set(0,0,e)}}}(0,r.Cg)([(0,n.lK)()],f.prototype,"wheelXMoveRelative",null),(0,r.Cg)([(0,n.lK)()],f.prototype,"wheelYMoveRelative",null),(0,r.Cg)([(0,n.lK)()],f.prototype,"wheelZMoveRelative",null),(0,r.Cg)([(0,n.lK)()],f.prototype,"wheelXRotateRelative",null),(0,r.Cg)([(0,n.lK)()],f.prototype,"wheelYRotateRelative",null),(0,r.Cg)([(0,n.lK)()],f.prototype,"wheelZRotateRelative",null),(0,r.Cg)([(0,n.lK)()],f.prototype,"wheelXMoveScene",null),(0,r.Cg)([(0,n.lK)()],f.prototype,"wheelYMoveScene",null),(0,r.Cg)([(0,n.lK)()],f.prototype,"wheelZMoveScene",null),s.H.FreeCameraMouseWheelInput=f;class m{constructor(e=!1){this.allowMouse=e,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=h.S0.IsSafari()}attachControl(e){e=h.S0.BackCompatCameraNoPreventDefault(arguments);let t=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const s=i.event,r="mouse"===s.pointerType||this._isSafari&&void 0===s.pointerType;if(this.allowMouse||!r)if(i.type===u.Zp.POINTERDOWN){if(e||s.preventDefault(),this._pointerPressed.push(s.pointerId),1!==this._pointerPressed.length)return;t={x:s.clientX,y:s.clientY}}else if(i.type===u.Zp.POINTERUP){e||s.preventDefault();const i=this._pointerPressed.indexOf(s.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;t=null,this._offsetX=null,this._offsetY=null}else if(i.type===u.Zp.POINTERMOVE){if(e||s.preventDefault(),!t)return;if(0!=this._pointerPressed.indexOf(s.pointerId))return;this._offsetX=s.clientX-t.x,this._offsetY=-(s.clientY-t.y)}}),this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,u.Zp.POINTERDOWN|u.Zp.POINTERUP|u.Zp.POINTERMOVE),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.addEventListener("blur",this._onLostFocus)}}detachControl(){if(this._pointerInput){if(this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const e=this.camera,t=e._calculateHandednessMultiplier();if(e.cameraRotation.y=t*this._offsetX/this.touchAngularSensibility,this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)e.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const t=e._computeLocalCameraSpeed(),i=new a.Pq(0,0,0!==this.touchMoveSensibility?t*this._offsetY/this.touchMoveSensibility:0);a.uq.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(a.Pq.TransformCoordinates(i,e._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,r.Cg)([(0,n.lK)()],m.prototype,"touchAngularSensibility",void 0),(0,r.Cg)([(0,n.lK)()],m.prototype,"touchMoveSensibility",void 0),s.H.FreeCameraTouchInput=m;class b extends s._{constructor(e){super(e),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new l),this}addMouse(e=!0){return this._mouseInput||(this._mouseInput=new d(e),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new f,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new m),this}clear(){super.clear(),this._mouseInput=null}}},9548:(e,t,i)=>{"use strict";var s=i(7960);e.exports=s.getPrototypeOf||null},9576:(e,t,i)=>{"use strict";function s(e){return 13===e||14===e||15===e||16===e||17===e||18===e||19===e}function r(e){return 13===e||17===e||18===e||19===e}i.d(t,{$l:()=>r,vl:()=>s})},9593:(e,t,i)=>{"use strict";i.d(t,{K:()=>h});var s=i(766),r=i(7329),n=i(1717),o=i(8421),a=i(2558);class h{get materialDefines(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:this._getDrawWrapper()?.defines}set materialDefines(e){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=e}_getDrawWrapper(e,t=!1){e=e??this._engine.currentRenderPassId;let i=this._drawWrappers[e];return!i&&t&&(this._drawWrappers[e]=i=new a.E(this._mesh.getScene().getEngine())),i}_removeDrawWrapper(e,t=!0,i=!1){t&&this._drawWrappers[e]?.dispose(i),this._drawWrappers[e]=void 0}get effect(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:this._getDrawWrapper()?.effect??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}setEffect(e,t=null,i,s=!0){const r=this._drawWrapper;r.setEffect(e,t,s),void 0!==i&&(r.materialContext=i),e||(r.defines=null,r.materialContext=void 0)}resetDrawCache(e,t=!1){if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e,!0,t);for(const e of this._drawWrappers)e?.dispose(t)}this._drawWrappers=[]}static AddToMesh(e,t,i,s,r,n,o,a=!0){return new h(e,t,i,s,r,n,o,a)}constructor(e,t,i,s,r,n,o,a=!0,h=!0){this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=s,this.indexCount=r,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=n,this._renderingMesh=o||n,h&&n.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=n.subMeshes.length-1,a&&(this.refreshBoundingInfo(),n.computeWorldMatrix(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(e){return this._boundingInfo=e,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){return(this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null)||this._renderingMesh}getMaterial(e=!0){const t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!t)return e?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(t)){const e=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this.resetDrawCache()),e}return t}_isMultiMaterial(e){return void 0!==e.getSubMaterial}refreshBoundingInfo(e=null){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(s.R.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const t=this._renderingMesh.getIndices();let i;if(0===this.indexStart&&this.indexCount===t.length){const e=this._renderingMesh.getBoundingInfo();i={minimum:e.minimum.clone(),maximum:e.maximum.clone()}}else i=(0,o.cD)(e,t,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new n.j(i.minimum,i.maximum),this}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}updateBoundingInfo(e){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}isInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)}isCompletelyInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(e,t){if(!this._linesIndexBuffer){const i=6*Math.floor(this.indexCount/3),s=this.verticesStart+this.verticesCount>65535?new Uint32Array(i):new Uint16Array(i);let r=0;if(0===e.length)for(let e=this.indexStart;e<this.indexStart+this.indexCount;e+=3)s[r++]=e,s[r++]=e+1,s[r++]=e+1,s[r++]=e+2,s[r++]=e+2,s[r++]=e;else for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)s[r++]=e[t],s[r++]=e[t+1],s[r++]=e[t+1],s[r++]=e[t+2],s[r++]=e[t+2],s[r++]=e[t];this._linesIndexBuffer=t.createIndexBuffer(s),this._linesIndexCount=s.length}return this._linesIndexBuffer}canIntersects(e){const t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)}intersects(e,t,i,s,r){const n=this.getMaterial();if(!n)return null;let o=3,a=!1;switch(n.fillMode){case 3:case 5:case 6:case 8:return null;case 7:o=1,a=!0}return 4===n.fillMode?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,s):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,s):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,s,r):this._intersectTriangles(e,t,i,o,a,s,r)}_intersectLines(e,t,i,s,n){let o=null;for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){const h=t[i[a]],l=t[i[a+1]],c=e.intersectionSegment(h,l,s);if(!(c<0)&&(n||!o||c<o.distance)&&(o=new r.w(null,null,c),o.faceId=a/2,n))break}return o}_intersectUnIndexedLines(e,t,i,s,n){let o=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=2){const a=t[i],h=t[i+1],l=e.intersectionSegment(a,h,s);if(!(l<0)&&(n||!o||l<o.distance)&&(o=new r.w(null,null,l),o.faceId=i/2,n))break}return o}_intersectTriangles(e,t,i,s,r,n,o){let a=null,h=-1;for(let l=this.indexStart;l<this.indexStart+this.indexCount-(3-s);l+=s){h++;const s=i[l],c=i[l+1],u=i[l+2];if(r&&4294967295===u){l+=2;continue}const d=t[s],_=t[c],p=t[u];if(!d||!_||!p)continue;if(o&&!o(d,_,p,e,s,c,u))continue;const g=e.intersectsTriangle(d,_,p);if(g){if(g.distance<0)continue;if((n||!a||g.distance<a.distance)&&(a=g,a.faceId=h,n))break}}return a}_intersectUnIndexedTriangles(e,t,i,s,r){let n=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=3){const o=t[i],a=t[i+1],h=t[i+2];if(r&&!r(o,a,h,e,-1,-1,-1))continue;const l=e.intersectsTriangle(o,a,h);if(l){if(l.distance<0)continue;if((s||!n||l.distance<n.distance)&&(n=l,n.faceId=i/3,s))break}}return n}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(e,t){const i=new h(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){const e=this.getBoundingInfo();if(!e)return i;i._boundingInfo=new n.j(e.minimum,e.maximum)}return i}dispose(e=!1){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const t=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(t,1),this.resetDrawCache(void 0,e)}getClassName(){return"SubMesh"}static CreateFromIndices(e,t,i,s,r,n=!0){let o=Number.MAX_VALUE,a=-Number.MAX_VALUE;const l=(r||s).getIndices();for(let e=t;e<t+i;e++){const t=l[e];t<o&&(o=t),t>a&&(a=t)}return new h(e,o,a-o+1,t,i,s,r,n)}}},9642:(e,t,i)=>{"use strict";i.d(t,{i:()=>f});var s=i(4754),r=i(4537),n=i(1425),o=i(9732),a=i(3054),h=i(4049),l=i(4292),c=i(3039),u=i(5686),d=i(2213),_=i(1956),p=i(2610),g=i(979);class f extends l.b{get position(){return this._position}set position(e){this._position=e}set upVector(e){this._upVector=e}get upVector(){return this._upVector}get screenArea(){let e=0,t=0;if(this.mode===f.PERSPECTIVE_CAMERA)this.fovMode===f.FOVMODE_VERTICAL_FIXED?(t=2*this.minZ*Math.tan(this.fov/2),e=this.getEngine().getAspectRatio(this)*t):(e=2*this.minZ*Math.tan(this.fov/2),t=e/this.getEngine().getAspectRatio(this));else{const i=this.getEngine().getRenderWidth()/2,s=this.getEngine().getRenderHeight()/2;e=(this.orthoRight??i)-(this.orthoLeft??-i),t=(this.orthoTop??s)-(this.orthoBottom??-s)}return e*t}set orthoLeft(e){this._orthoLeft=e;for(const t of this._rigCameras)t.orthoLeft=e}get orthoLeft(){return this._orthoLeft}set orthoRight(e){this._orthoRight=e;for(const t of this._rigCameras)t.orthoRight=e}get orthoRight(){return this._orthoRight}set orthoBottom(e){this._orthoBottom=e;for(const t of this._rigCameras)t.orthoBottom=e}get orthoBottom(){return this._orthoBottom}set orthoTop(e){this._orthoTop=e;for(const t of this._rigCameras)t.orthoTop=e}get orthoTop(){return this._orthoTop}set mode(e){this._mode=e;for(const t of this._rigCameras)t.mode=e}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(e,t,i,s=!0){super(e,i,!1),this._position=h.Pq.Zero(),this._upVector=h.Pq.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=f.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new _.L(0,0,1,1),this.layerMask=268435455,this.fovMode=f.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=f.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new a.cP,this.onProjectionMatrixChangedObservable=new a.cP,this.onAfterCheckInputsObservable=new a.cP,this.onRestoreStateObservable=new a.cP,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new h.uq,this._postProcesses=new Array,this._activeMeshes=new n.L(256),this._globalPosition=h.Pq.Zero(),this._computedViewMatrix=h.uq.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=h.uq.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=h.PT.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),s&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=t,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${e}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Camera"}toString(e){let t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}applyVerticalCorrection(){const e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}isReady(e=!1){if(e)for(const e of this._postProcesses)if(e&&!e.isReady())return!1;return super.isReady(e)}_initCache(){super._initCache(),this._cache.position=new h.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new h.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(e){e||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()}_isSynchronizedProjectionMatrix(){let e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;const t=this.getEngine();return this.mode===f.PERSPECTIVE_CAMERA?e=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(e=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight(),this.oblique&&(e=e&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),e}attachControl(e,t){}detachControl(e){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==f.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null}_cascadePostProcessesToRigCams(){const e=this._getFirstPostProcess();e&&e.markTextureDirty();for(let e=0,t=this._rigCameras.length;e<t;e++){const t=this._rigCameras[e],i=t._rigPostProcess;i?("pass"===i.getEffectName()&&(t.isIntermediate=0===this._postProcesses.length),t._postProcesses=this._postProcesses.slice(0).concat(i),i.markTextureDirty()):t._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(e,t=null){return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(c.V.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}detachPostProcess(e){const t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return h.uq.Identity()}getViewMatrix(e){return!e&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(e){if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const t=this.getEngine(),i=this.getScene(),s=t.useReverseDepthBuffer;if(this.mode===f.PERSPECTIVE_CAMERA){let e;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1),e=i.useRightHandedSystem?h.uq.PerspectiveFovRHToRef:h.uq.PerspectiveFovLHToRef,e(this.fov,t.getAspectRatio(this),s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===f.FOVMODE_VERTICAL_FIXED,t.isNDCHalfZRange,this.projectionPlaneTilt,s)}else{const e=t.getRenderWidth()/2,r=t.getRenderHeight()/2;i.useRightHandedSystem?this.oblique?h.uq.ObliqueOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-r,this.orthoTop??r,s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):h.uq.OrthoOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-r,this.orthoTop??r,s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange):this.oblique?h.uq.ObliqueOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-r,this.orthoTop??r,s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):h.uq.OrthoOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-r,this.orthoTop??r,s?this.maxZ:this.minZ,s?this.minZ:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=this.oblique?.angle,this._cache.obliqueLength=this.oblique?.length,this._cache.obliqueOffset=this.oblique?.offset,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(e){return(this.radius||(this.target?h.Pq.Distance(this.position,this.target):this.position.length()))+e}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?p.P.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=p.P.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(e,t=!1){if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){let t=!1;return this.rigCameras.forEach((i=>{i._updateFrustumPlanes(),t=t||e.isInFrustum(i._frustumPlanes)})),t}return e.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(e=100,t,i){throw(0,d.n)("Ray")}getForwardRayToRef(e,t=100,i,s){throw(0,d.n)("Ray")}dispose(e,t=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this._parentContainer){const e=this._parentContainer.cameras.indexOf(this);e>-1&&this._parentContainer.cameras.splice(e,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==f.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let e=this._postProcesses.length;for(;--e>=0;){const t=this._postProcesses[e];t&&t.dispose(this)}}let i=this.customRenderTargets.length;for(;--i>=0;)this.customRenderTargets[i].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(e,t)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(e,t){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=o.S0.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==f.RIG_MODE_NONE){const e=this.createRigCamera(this.name+"_L",0);e&&(e._isLeftCamera=!0);const t=this.createRigCamera(this.name+"_R",1);t&&(t._isRightCamera=!0),e&&t&&(this._rigCameras.push(e),this._rigCameras.push(t))}this._setRigMode(t),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(e){}_getVRProjectionMatrix(){return h.uq.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=o.S0.ToRadians(t/.0637))}createRigCamera(e,t){return null}_updateRigCameras(){for(let e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===f.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const e=g.p.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),g.p.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}clone(e,t=null){const i=g.p.Clone(f.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return i.name=e,i.parent=t,this.onClonedObservable.notifyObservers(i),i}getDirection(e){const t=h.Pq.Zero();return this.getDirectionToRef(e,t),t}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(e,t){h.Pq.TransformNormalToRef(e,this.getWorldMatrix(),t)}static GetConstructorFromName(e,t,i,s=0,r=!0){return l.b.Construct(e,t,i,{interaxial_distance:s,isStereoscopicSideBySide:r})||(()=>f._CreateDefaultParsedCamera(t,i))}computeWorldMatrix(){return this.getWorldMatrix()}static Parse(e,t){const i=e.type,s=f.GetConstructorFromName(i,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),r=g.p.Parse(s,e,t);if(void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),r.inputs&&(r.inputs.parse(e),r._setupInputs()),e.upVector&&(r.upVector=h.Pq.FromArray(e.upVector)),r.setPosition&&(r.position.copyFromFloats(0,0,0),r.setPosition(h.Pq.FromArray(e.position))),e.target&&r.setTarget&&r.setTarget(h.Pq.FromArray(e.target)),e.cameraRigMode){const t=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};r.setCameraRigMode(e.cameraRigMode,t)}if(e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],s=(0,u.n9)("BABYLON.Animation");s&&r.animations.push(s.Parse(i))}l.b.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&r.setEnabled(e.isEnabled),r}_calculateHandednessMultiplier(){let e=this.getScene().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),e}}f._CreateDefaultParsedCamera=(e,t)=>{throw(0,d.n)("UniversalCamera")},f.PERSPECTIVE_CAMERA=0,f.ORTHOGRAPHIC_CAMERA=1,f.FOVMODE_VERTICAL_FIXED=0,f.FOVMODE_HORIZONTAL_FIXED=1,f.RIG_MODE_NONE=0,f.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,f.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,f.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,f.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,f.RIG_MODE_STEREOSCOPIC_INTERLACED=14,f.RIG_MODE_VR=20,f.RIG_MODE_CUSTOM=22,f.ForceAttachControlToAlwaysPreventDefault=!1,(0,s.Cg)([(0,r.P_)("position")],f.prototype,"_position",void 0),(0,s.Cg)([(0,r.P_)("upVector")],f.prototype,"_upVector",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"orthoLeft",null),(0,s.Cg)([(0,r.lK)()],f.prototype,"orthoRight",null),(0,s.Cg)([(0,r.lK)()],f.prototype,"orthoBottom",null),(0,s.Cg)([(0,r.lK)()],f.prototype,"orthoTop",null),(0,s.Cg)([(0,r.lK)()],f.prototype,"fov",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"projectionPlaneTilt",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"minZ",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"maxZ",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"inertia",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"mode",null),(0,s.Cg)([(0,r.lK)()],f.prototype,"layerMask",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"fovMode",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"cameraRigMode",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"interaxialDistance",void 0),(0,s.Cg)([(0,r.lK)()],f.prototype,"isStereoscopicSideBySide",void 0)},9649:(e,t,i)=>{"use strict";i.d(t,{rz:()=>I,eC:()=>v,f2:()=>R,zU:()=>C,hX:()=>f,W$:()=>x,NJ:()=>A,sh:()=>S,M1:()=>T});var s=i(2276),r=i(4920),n=i(3054);class o{}o.FilesToLoad={};var a=i(4837),h=i(427),l=i(3299),c=i(1497),u=i(3039),d=i(5098),_=i(8615),p=i(976);const g=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class f extends a.bu{constructor(e,t){super(e,a.tG.LoadFileError),this.name="LoadFileError",a.Cf._setPrototypeOf(this,f.prototype),t instanceof s.u?this.request=t:this.file=t}}class m extends a.bu{constructor(e,t){super(e,a.tG.RequestFileError),this.request=t,this.name="RequestFileError",a.Cf._setPrototypeOf(this,m.prototype)}}class b extends a.bu{constructor(e,t){super(e,a.tG.ReadFileError),this.file=t,this.name="ReadFileError",a.Cf._setPrototypeOf(this,b.prototype)}}const v={DefaultRetryStrategy:class{static ExponentialBackoff(e=3,t=500){return(i,s,r)=>0!==s.status||r>=e||-1!==i.indexOf("file:")?-1:Math.pow(2,r)*t}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:e=>e.replace(/#/gm,"%23")},T=(e,t)=>{if((!e||0!==e.indexOf("data:"))&&v.CorsBehavior)if("string"==typeof v.CorsBehavior||v.CorsBehavior instanceof String)t.crossOrigin=v.CorsBehavior;else{const i=v.CorsBehavior(e);i&&(t.crossOrigin=i)}},y={getRequiredSize:null},x=(e,t,i,r,n="",a)=>{const l=c.q.LastCreatedEngine;if("undefined"==typeof HTMLImageElement&&!l?._features.forceBitmapOverHTMLImageElement)return i("LoadImage is only supported in web or BabylonNative environments."),null;let u,d=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(u=URL.createObjectURL(new Blob([e],{type:n})),d=!0):u=`data:${n};base64,`+(0,h.EL)(e):e instanceof Blob?(u=URL.createObjectURL(e),d=!0):(u=v.CleanUrl(e),u=v.PreprocessUrl(u));const _=t=>{if(i){const s=u||e.toString();i(`Error while trying to load image: ${0===s.indexOf("http")||s.length<=128?s:s.slice(0,128)+"..."}`,t)}};if(l?._features.forceBitmapOverHTMLImageElement)return C(u,(s=>{l.createImageBitmap(new Blob([s],{type:n}),{premultiplyAlpha:"none",...a}).then((e=>{t(e),d&&URL.revokeObjectURL(u)})).catch((t=>{i&&i("Error while trying to load image: "+e,t)}))}),void 0,r||void 0,!0,((e,t)=>{_(t)})),null;const p=new Image;if(y.getRequiredSize){const t=y.getRequiredSize(e);t.width&&(p.width=t.width),t.height&&(p.height=t.height)}T(u,p);const g=[],f=()=>{g.forEach((e=>{e.target.removeEventListener(e.name,e.handler)})),g.length=0};g.push({target:p,name:"load",handler:()=>{f(),t(p),d&&p.src&&URL.revokeObjectURL(p.src)}}),g.push({target:p,name:"error",handler:e=>{f(),_(e),d&&p.src&&URL.revokeObjectURL(p.src)}}),g.push({target:document,name:"securitypolicyviolation",handler:e=>{if(e.blockedURI!==p.src||"report"===e.disposition)return;f();const t=new Error(`CSP violation of policy ${e.effectiveDirective} ${e.blockedURI}. Current policy is ${e.originalPolicy}`);c.q.UseFallbackTexture=!1,_(t),d&&p.src&&URL.revokeObjectURL(p.src),p.src=""}}),g.forEach((e=>{e.target.addEventListener(e.name,e.handler)}));const m="blob:"===u.substring(0,5),b="data:"===u.substring(0,5),x=()=>{m||b||!s.u.IsCustomRequestAvailable?p.src=u:C(u,((e,t,i)=>{const s=new Blob([e],{type:!n&&i?i:n}),r=URL.createObjectURL(s);d=!0,p.src=r}),void 0,r||void 0,!0,((e,t)=>{_(t)}))};if(!m&&!b&&r&&r.enableTexturesOffline)r.open((()=>{r&&r.loadImage(u,p)}),x);else{if(-1!==u.indexOf("file:")){const e=decodeURIComponent(u.substring(5).toLowerCase());if(o.FilesToLoad[e]&&"undefined"!=typeof URL){try{let t;try{t=URL.createObjectURL(o.FilesToLoad[e])}catch(i){t=URL.createObjectURL(o.FilesToLoad[e])}p.src=t,d=!0}catch(e){p.src=""}return p}}x()}return p},A=(e,t,i,s,r)=>{const o=new FileReader,a={onCompleteObservable:new n.cP,abort:()=>o.abort()};return o.onloadend=()=>a.onCompleteObservable.notifyObservers(a),r&&(o.onerror=()=>{r(new b(`Unable to read ${e.name}`,e))}),o.onload=e=>{t(e.target.result)},i&&(o.onprogress=i),s?o.readAsArrayBuffer(e):o.readAsText(e),a},C=(e,t,i,s,r,a,h)=>{if(e.name)return A(e,t,i,r,a?e=>{a(void 0,e)}:void 0);const l=e;if(-1!==l.indexOf("file:")){let e=decodeURIComponent(l.substring(5).toLowerCase());0===e.indexOf("./")&&(e=e.substring(2));const s=o.FilesToLoad[e];if(s)return A(s,t,i,r,a?e=>a(void 0,new f(e.message,e.file)):void 0)}const{match:c,type:_}=P(l);if(c){const e={onCompleteObservable:new n.cP,abort:()=>()=>{}};try{const e=r?I(l):M(l);t(e,void 0,_)}catch(e){a?a(void 0,e):u.V.Error(e.message||"Failed to parse the Data URL")}return d._.SetImmediate((()=>{e.onCompleteObservable.notifyObservers(e)})),e}return S(l,((e,i)=>{t(e,i?.responseURL,i?.getResponseHeader("content-type"))}),i,s,r,a?e=>{a(e.request,new f(e.message,e.request))}:void 0,h)},S=(e,t,i,o,a,h,l)=>{e=v.CleanUrl(e),e=v.PreprocessUrl(e);const c=v.BaseUrl+e;let d=!1;const _={onCompleteObservable:new n.cP,abort:()=>d=!0},p=()=>{let e,n=new s.u,o=null;const p=()=>{n&&(i&&n.removeEventListener("progress",i),e&&n.removeEventListener("readystatechange",e),n.removeEventListener("loadend",g))};let g=()=>{p(),_.onCompleteObservable.notifyObservers(_),_.onCompleteObservable.clear(),i=void 0,e=null,g=null,h=void 0,l=void 0,t=void 0};_.abort=()=>{d=!0,g&&g(),n&&n.readyState!==(XMLHttpRequest.DONE||4)&&n.abort(),null!==o&&(clearTimeout(o),o=null),n=null};const f=e=>{const t=e.message||"Unknown error";h&&n?h(new m(t,n)):u.V.Error(t)},b=u=>{if(n){if(n.open("GET",c),l)try{l(n)}catch(e){return void f(e)}a&&(n.responseType="arraybuffer"),i&&n.addEventListener("progress",i),g&&n.addEventListener("loadend",g),e=()=>{if(!d&&n&&n.readyState===(XMLHttpRequest.DONE||4)){if(e&&n.removeEventListener("readystatechange",e),n.status>=200&&n.status<300||0===n.status&&(!(0,r.BA)()||E())){const e=a?n.response:n.responseText;if(null!==e){try{t&&t(e,n)}catch(e){f(e)}return}}const i=v.DefaultRetryStrategy;if(i){const e=i(c,n,u);if(-1!==e)return p(),n=new s.u,void(o=setTimeout((()=>b(u+1)),e))}const l=new m("Error status: "+n.status+" "+n.statusText+" - Unable to load "+c,n);h&&h(l)}},n.addEventListener("readystatechange",e),n.send()}};b(0)};if(o&&o.enableSceneOffline){const s=e=>{e&&e.status>400?h&&h(e):p()},r=()=>{o&&o.loadFile(v.BaseUrl+e,(e=>{!d&&t&&t(e),_.onCompleteObservable.notifyObservers(_)}),i?e=>{!d&&i&&i(e)}:void 0,s,a)};o.open(r,s)}else p();return _},E=()=>"undefined"!=typeof location&&"file:"===location.protocol,R=e=>g.test(e),P=e=>{const t=g.exec(e);return null===t||0===t.length?{match:!1,type:""}:{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function I(e){return(0,h.yS)(e.split(",")[1])}const M=e=>(0,h.AV)(e.split(",")[1]);let w;p.$._FileToolsLoadImage=x,_.sg.loadFile=C,l.J.loadFile=C,((e,t,i,s,r,n,o,a,h,l)=>{w={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:t,DefaultRetryStrategy:i.DefaultRetryStrategy,BaseUrl:i.BaseUrl,CorsBehavior:i.CorsBehavior,PreprocessUrl:i.PreprocessUrl,IsBase64DataUrl:s,IsFileURL:r,LoadFile:n,LoadImage:o,ReadFile:a,RequestFile:h,SetCorsBehavior:l},Object.defineProperty(w,"DefaultRetryStrategy",{get:function(){return i.DefaultRetryStrategy},set:function(e){i.DefaultRetryStrategy=e}}),Object.defineProperty(w,"BaseUrl",{get:function(){return i.BaseUrl},set:function(e){i.BaseUrl=e}}),Object.defineProperty(w,"PreprocessUrl",{get:function(){return i.PreprocessUrl},set:function(e){i.PreprocessUrl=e}}),Object.defineProperty(w,"CorsBehavior",{get:function(){return i.CorsBehavior},set:function(e){i.CorsBehavior=e}})})(I,M,v,R,E,C,x,A,S,T)},9676:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.morphTargetsVertexDeclaration="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\n#ifdef MORPHTARGETS_POSITION\nattribute vec3 position{X};\n#endif\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#ifdef MORPHTARGETS_UV2\nattribute vec2 uv2_{X};\n#endif\n#elif {X}==0\nuniform int morphTargetCount;\n#endif\n#endif\n"},9707:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},9732:(e,t,i)=>{"use strict";i.d(t,{LV:()=>m,S0:()=>f});var s=i(3054),r=i(4920),n=i(3039),o=i(1651),a=i(8827),h=i(2213),l=i(2276),c=i(1497),u=i(9649),d=i(5098),_=i(1183),p=i(7634),g=i(1663);class f{static get BaseUrl(){return u.eC.BaseUrl}static set BaseUrl(e){u.eC.BaseUrl=e}static get CleanUrl(){return u.eC.CleanUrl}static set CleanUrl(e){u.eC.CleanUrl=e}static IsAbsoluteUrl(e){return 0===e.indexOf("//")||-1!==e.indexOf("://")&&-1!==e.indexOf(".")&&-1!==e.indexOf("/")&&!(e.indexOf(":")>e.indexOf("/"))&&(e.indexOf("://")<e.indexOf(".")||0===e.indexOf("data:")||0===e.indexOf("blob:"))}static set ScriptBaseUrl(e){u.eC.ScriptBaseUrl=e}static get ScriptBaseUrl(){return u.eC.ScriptBaseUrl}static set CDNBaseUrl(e){f.ScriptBaseUrl=e,f.AssetBaseUrl=e}static set ScriptPreprocessUrl(e){u.eC.ScriptPreprocessUrl=e}static get ScriptPreprocessUrl(){return u.eC.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return u.eC.DefaultRetryStrategy}static set DefaultRetryStrategy(e){u.eC.DefaultRetryStrategy=e}static get CorsBehavior(){return u.eC.CorsBehavior}static set CorsBehavior(e){u.eC.CorsBehavior=e}static get UseFallbackTexture(){return c.q.UseFallbackTexture}static set UseFallbackTexture(e){c.q.UseFallbackTexture=e}static get RegisteredExternalClasses(){return _.n.RegisteredExternalClasses}static set RegisteredExternalClasses(e){_.n.RegisteredExternalClasses=e}static get fallbackTexture(){return c.q.FallbackTexture}static set fallbackTexture(e){c.q.FallbackTexture=e}static FetchToRef(e,t,i,s,r,n){const o=4*((Math.abs(e)*i%i|0)+(Math.abs(t)*s%s|0)*i);n.r=r[o]/255,n.g=r[o+1]/255,n.b=r[o+2]/255,n.a=r[o+3]/255}static Mix(e,t,i){return 0}static Instantiate(e){return _.n.Instantiate(e)}static SetImmediate(e){d._.SetImmediate(e)}static IsExponentOfTwo(e){return!0}static FloatRound(e){return Math.fround(e)}static GetFilename(e){const t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}static GetFolderPath(e,t=!1){const i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)}static ToDegrees(e){return 180*e/Math.PI}static ToRadians(e){return e*Math.PI/180}static SmoothAngleChange(e,t,i=.9){const s=this.ToRadians(e),r=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-i)*Math.sin(r)+i*Math.sin(s),(1-i)*Math.cos(r)+i*Math.cos(s)))}static MakeArray(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null}static GetPointerPrefix(e){return(0,r.BA)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(e,t){(0,u.M1)(e,t)}static SetReferrerPolicyBehavior(e,t){t.referrerPolicy=e}static get PreprocessUrl(){return u.eC.PreprocessUrl}static set PreprocessUrl(e){u.eC.PreprocessUrl=e}static LoadImage(e,t,i,s,r,n){return(0,u.W$)(e,t,i,s,r,n)}static LoadFile(e,t,i,s,r,n){return(0,u.zU)(e,t,i,s,r,n)}static LoadFileAsync(e,t=!0){return new Promise(((i,s)=>{(0,u.zU)(e,(e=>{i(e)}),void 0,void 0,t,((e,t)=>{s(t)}))}))}static GetAssetUrl(e){if(!e)return"";if(f.AssetBaseUrl&&e.startsWith(f._DefaultAssetsUrl)){const t="/"===f.AssetBaseUrl[f.AssetBaseUrl.length-1]?f.AssetBaseUrl.substring(0,f.AssetBaseUrl.length-1):f.AssetBaseUrl;return e.replace(f._DefaultAssetsUrl,t)}return e}static GetBabylonScriptURL(e,t){if(!e)return"";if(f.ScriptBaseUrl&&e.startsWith(f._DefaultCdnUrl)){const t="/"===f.ScriptBaseUrl[f.ScriptBaseUrl.length-1]?f.ScriptBaseUrl.substring(0,f.ScriptBaseUrl.length-1):f.ScriptBaseUrl;e=e.replace(f._DefaultCdnUrl,t)}return e=f.ScriptPreprocessUrl(e),t&&(e=f.GetAbsoluteUrl(e)),e}static LoadBabylonScript(e,t,i,s){e=f.GetBabylonScriptURL(e),f.LoadScript(e,t,i)}static LoadBabylonScriptAsync(e){return e=f.GetBabylonScriptURL(e),f.LoadScriptAsync(e)}static LoadScript(e,t,i,s,n=!1){if("function"==typeof importScripts){try{importScripts(e),t&&t()}catch(t){i?.(`Unable to load script '${e}' in worker`,t)}return}if(!(0,r.BA)())return void i?.(`Cannot load script '${e}' outside of a window or a worker`);const o=document.getElementsByTagName("head")[0],a=document.createElement("script");n?(a.setAttribute("type","module"),a.innerText=e):(a.setAttribute("type","text/javascript"),a.setAttribute("src",e)),s&&(a.id=s),a.onload=()=>{t&&t()},a.onerror=t=>{i&&i(`Unable to load script '${e}'`,t)},o.appendChild(a)}static LoadScriptAsync(e,t){return new Promise(((i,s)=>{this.LoadScript(e,(()=>{i()}),((e,t)=>{s(t||new Error(e))}),t)}))}static ReadFileAsDataURL(e,t,i){const r=new FileReader,n={onCompleteObservable:new s.cP,abort:()=>r.abort()};return r.onloadend=()=>{n.onCompleteObservable.notifyObservers(n)},r.onload=e=>{t(e.target.result)},r.onprogress=i,r.readAsDataURL(e),n}static ReadFile(e,t,i,s,r){return(0,u.NJ)(e,t,i,s,r)}static FileAsURL(e){const t=new Blob([e]);return window.URL.createObjectURL(t)}static Format(e,t=2){return e.toFixed(t)}static DeepCopy(e,t,i,s){o.r.DeepCopy(e,t,i,s)}static IsEmpty(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}static RegisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const s=t[i];e.addEventListener(s.name,s.handler,!1);try{window.parent&&window.parent.addEventListener(s.name,s.handler,!1)}catch(e){}}}static UnregisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const s=t[i];e.removeEventListener(s.name,s.handler);try{e.parent&&e.parent.removeEventListener(s.name,s.handler)}catch(e){}}}static async DumpFramebuffer(e,t,i,s,r="image/png",n,o){throw(0,h.n)("DumpTools")}static DumpData(e,t,i,s,r="image/png",n,o=!1,a=!1,l){throw(0,h.n)("DumpTools")}static DumpDataAsync(e,t,i,s="image/png",r,n=!1,o=!1,a){throw(0,h.n)("DumpTools")}static _IsOffScreenCanvas(e){return void 0!==e.convertToBlob}static ToBlob(e,t,i="image/png",s){f._IsOffScreenCanvas(e)||e.toBlob||(e.toBlob=function(e,t,i){setTimeout((()=>{const s=atob(this.toDataURL(t,i).split(",")[1]),r=s.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=s.charCodeAt(e);e(new Blob([n]))}))}),f._IsOffScreenCanvas(e)?e.convertToBlob({type:i,quality:s}).then((e=>t(e))):e.toBlob((function(e){t(e)}),i,s)}static DownloadBlob(e,t){if("download"in document.createElement("a")){if(!t){const e=new Date;t="screenshot_"+(e.getFullYear()+"-"+(e.getMonth()+1)).slice(2)+"-"+e.getDate()+"_"+e.getHours()+"-"+("0"+e.getMinutes()).slice(-2)+".png"}f.Download(e,t)}else if(e&&"undefined"!=typeof URL){const t=URL.createObjectURL(e),i=window.open("");if(!i)return;const s=i.document.createElement("img");s.onload=function(){URL.revokeObjectURL(t)},s.src=t,i.document.body.appendChild(s)}}static EncodeScreenshotCanvasData(e,t,i="image/png",s,r){if("string"!=typeof s&&t){if(t){if(f._IsOffScreenCanvas(e))return void e.convertToBlob({type:i,quality:r}).then((e=>{const i=new FileReader;i.readAsDataURL(e),i.onloadend=()=>{const e=i.result;t(e)}}));const s=e.toDataURL(i,r);t(s)}}else this.ToBlob(e,(function(e){e&&f.DownloadBlob(e,s),t&&t("")}),i,r)}static Download(e,t){if("undefined"==typeof URL)return;const i=window.URL.createObjectURL(e),s=document.createElement("a");document.body.appendChild(s),s.style.display="none",s.href=i,s.download=t,s.addEventListener("click",(()=>{s.parentElement&&s.parentElement.removeChild(s)})),s.click(),window.URL.revokeObjectURL(i)}static BackCompatCameraNoPreventDefault(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]}static CreateScreenshot(e,t,i,s,r="image/png",n=!1,o){throw(0,h.n)("ScreenshotTools")}static CreateScreenshotAsync(e,t,i,s="image/png",r){throw(0,h.n)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(e,t,i,s,r="image/png",n=1,o=!1,a,l=!1,c=!1,u=!0,d,_){throw(0,h.n)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(e,t,i,s="image/png",r=1,n=!1,o,a=!1,l=!1,c=!0,u,d){throw(0,h.n)("ScreenshotTools")}static RandomId(){return(0,p.z)()}static IsBase64(e){return(0,u.f2)(e)}static DecodeBase64(e){return(0,u.rz)(e)}static get errorsCount(){return n.V.errorsCount}static Log(e){n.V.Log(e)}static Warn(e){n.V.Warn(e)}static Error(e){n.V.Error(e)}static get LogCache(){return n.V.LogCache}static ClearLogCache(){n.V.ClearLogCache()}static set LogLevels(e){n.V.LogLevels=e}static set PerformanceLogLevel(e){return(e&f.PerformanceUserMarkLogLevel)===f.PerformanceUserMarkLogLevel?(f.StartPerformanceCounter=f._StartUserMark,void(f.EndPerformanceCounter=f._EndUserMark)):(e&f.PerformanceConsoleLogLevel)===f.PerformanceConsoleLogLevel?(f.StartPerformanceCounter=f._StartPerformanceConsole,void(f.EndPerformanceCounter=f._EndPerformanceConsole)):(f.StartPerformanceCounter=f._StartPerformanceCounterDisabled,void(f.EndPerformanceCounter=f._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(e,t){}static _EndPerformanceCounterDisabled(e,t){}static _StartUserMark(e,t=!0){if(!f._Performance){if(!(0,r.BA)())return;f._Performance=window.performance}t&&f._Performance.mark&&f._Performance.mark(e+"-Begin")}static _EndUserMark(e,t=!0){t&&f._Performance.mark&&(f._Performance.mark(e+"-End"),f._Performance.measure(e,e+"-Begin",e+"-End"))}static _StartPerformanceConsole(e,t=!0){t&&(f._StartUserMark(e,t),console.time&&console.time(e))}static _EndPerformanceConsole(e,t=!0){t&&(f._EndUserMark(e,t),console.timeEnd(e))}static get Now(){return a.j.Now}static GetClassName(e,t=!1){let i=null;return!t&&e.getClassName?i=e.getClassName():(e instanceof Object&&(i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),i||(i=typeof e)),i}static First(e,t){for(const i of e)if(t(i))return i;return null}static getFullClassName(e,t=!1){let i=null,s=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){const r=t?e:Object.getPrototypeOf(e);i=r.constructor.__bjsclassName__,s=r.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(null!=s?s+".":"")+i:null}static DelayAsync(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static IsSafari(){return!!(0,r.XD)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}f.AssetBaseUrl="",f.UseCustomRequestHeaders=!1,f.CustomRequestHeaders=l.u.CustomRequestHeaders,f.GetDOMTextContent=r.Zl,f._DefaultCdnUrl="https://cdn.babylonjs.com",f._DefaultAssetsUrl="https://assets.babylonjs.com/core",f.GetAbsoluteUrl="object"==typeof document?e=>{const t=document.createElement("a");return t.href=e,t.href}:"function"==typeof URL&&"object"==typeof location?e=>new URL(e,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},f.NoneLogLevel=n.V.NoneLogLevel,f.MessageLogLevel=n.V.MessageLogLevel,f.WarningLogLevel=n.V.WarningLogLevel,f.ErrorLogLevel=n.V.ErrorLogLevel,f.AllLogLevel=n.V.AllLogLevel,f.IsWindowObjectExist=r.BA,f.PerformanceNoneLogLevel=0,f.PerformanceUserMarkLogLevel=1,f.PerformanceConsoleLogLevel=2,f.StartPerformanceCounter=f._StartPerformanceCounterDisabled,f.EndPerformanceCounter=f._EndPerformanceCounterDisabled;class m{constructor(e,t,i,s=0){this.iterations=e,this.index=s-1,this._done=!1,this._fn=t,this._successCallback=i}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(e,t,i,s=0){const r=new m(e,t,i,s);return r.executeNext(),r}static SyncAsyncForLoop(e,t,i,s,r,n=0){return m.Run(Math.ceil(e/t),(s=>{r&&r()?s.breakLoop():setTimeout((()=>{for(let n=0;n<t;++n){const o=s.index*t+n;if(o>=e)break;if(i(o),r&&r()){s.breakLoop();break}}s.executeNext()}),n)}),s)}}f.Mix=g.zF,f.IsExponentOfTwo=g.L8,c.q.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},9838:(e,t,i)=>{"use strict";i.d(t,{v:()=>d});var s=i(4754),r=i(4537),n=i(4049),o=i(451),a=i(4292),h=i(7893),l=i(5686),c=i(5549),u=i(979);class d extends a.b{get range(){return this._range}set range(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(e){this._intensityMode=e,this._computePhotometricScale()}get radius(){return this._radius}set radius(e){this._radius=e,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(e){this._excludeWithLayerMask=e,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())}getViewMatrix(e){return null}getProjectionMatrix(e,t){return null}constructor(e,t){super(e,t,!1),this.diffuse=new o.v9(1,1,1),this.specular=new o.v9(1,1,1),this.falloffType=d.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=d.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new h.D(this.getScene().getEngine(),void 0,void 0,e),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(e,t){return this}_bindLight(e,t,i,s,r=!0){const n=e.toString();let a=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+n),this._renderId!==t.getRenderId()||this._lastUseSpecular!==s||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=s;const e=this.getScaledIntensity();this.transferToEffect(i,n),this.diffuse.scaleToRef(e,o.IG.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",o.IG.Color3[0],this.range,n),s&&(this.specular.scaleToRef(e,o.IG.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",o.IG.Color3[1],this.radius,n)),a=!0}if(this.transferTexturesToEffect(i,n),t.shadowsEnabled&&this.shadowEnabled&&r){const e=this.getShadowGenerator(t.activeCamera)??this.getShadowGenerator();e&&(e.bindShadowLight(n,i),a=!0)}a?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(e){let t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(e){super.setEnabled(e),this._resyncMeshes()}getShadowGenerator(e=null){return null===this._shadowGenerators?null:this._shadowGenerators.get(e)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return n.Pq.Zero()}canAffectMesh(e){return!(e&&(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e)||this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)||!(0===this.includeOnlyWithLayerMask||this.includeOnlyWithLayerMask&e.layerMask)||0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask))}dispose(e,t=!1){if(this._shadowGenerators){const e=this._shadowGenerators.values();for(let t=e.next();!0!==t.done;t=e.next())t.value.dispose();this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const e=this._parentContainer.lights.indexOf(this);e>-1&&this._parentContainer.lights.splice(e,1),this._parentContainer=null}for(const e of this.getScene().meshes)e._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(e,t)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(e,t=null){const i=d.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!i)return null;const s=u.p.Clone(i,this);return e&&(s.name=e),t&&(s.parent=t),s.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(s),s}serialize(){const e=u.p.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((t=>{e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((t=>{e.includedOnlyMeshesIds.push(t.id)}))),u.p.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}static GetConstructorFromName(e,t,i){return a.b.Construct("Light_Type_"+e,t,i)||null}static Parse(e,t){const i=d.GetConstructorFromName(e.type,e.name,t);if(!i)return null;const s=u.p.Parse(i,e,t);if(e.excludedMeshesIds&&(s._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(s._includedOnlyMeshesIds=e.includedOnlyMeshesIds),void 0!==e.parentId&&(s._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.falloffType&&(s.falloffType=e.falloffType),void 0!==e.lightmapMode&&(s.lightmapMode=e.lightmapMode),e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],r=(0,l.n9)("BABYLON.Animation");r&&s.animations.push(r.Parse(i))}a.b.ParseAnimationRanges(s,e,t)}return e.autoAnimate&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&s.setEnabled(e.isEnabled),s}_hookArrayForExcluded(e){const t=e.push;e.push=(...i)=>{const s=t.apply(e,i);for(const e of i)e._resyncLightSource(this);return s};const i=e.splice;e.splice=(t,s)=>{const r=i.apply(e,[t,s]);for(const e of r)e._resyncLightSource(this);return r};for(const t of e)t._resyncLightSource(this)}_hookArrayForIncludedOnly(e){const t=e.push;e.push=(...i)=>{const s=t.apply(e,i);return this._resyncMeshes(),s};const i=e.splice;e.splice=(t,s)=>{const r=i.apply(e,[t,s]);return this._resyncMeshes(),r},this._resyncMeshes()}_resyncMeshes(){for(const e of this.getScene().meshes)e._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const e of this.getScene().meshes)-1!==e.lightSources.indexOf(this)&&e._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let e=0;const t=this.getTypeID();let i=this.intensityMode;switch(i===d.INTENSITYMODE_AUTOMATIC&&(i=t===d.LIGHTTYPEID_DIRECTIONALLIGHT?d.INTENSITYMODE_ILLUMINANCE:d.INTENSITYMODE_LUMINOUSINTENSITY),t){case d.LIGHTTYPEID_POINTLIGHT:case d.LIGHTTYPEID_SPOTLIGHT:switch(i){case d.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case d.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case d.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case d.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case d.INTENSITYMODE_ILLUMINANCE:e=1;break;case d.INTENSITYMODE_LUMINANCE:{let t=this.radius;t=Math.max(t,.001),e=2*Math.PI*(1-Math.cos(t));break}}break;case d.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e}_reorderLightsInScene(){const e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()}_isReady(){return!0}}d.FALLOFF_DEFAULT=c.c.FALLOFF_DEFAULT,d.FALLOFF_PHYSICAL=c.c.FALLOFF_PHYSICAL,d.FALLOFF_GLTF=c.c.FALLOFF_GLTF,d.FALLOFF_STANDARD=c.c.FALLOFF_STANDARD,d.LIGHTMAP_DEFAULT=c.c.LIGHTMAP_DEFAULT,d.LIGHTMAP_SPECULAR=c.c.LIGHTMAP_SPECULAR,d.LIGHTMAP_SHADOWSONLY=c.c.LIGHTMAP_SHADOWSONLY,d.INTENSITYMODE_AUTOMATIC=c.c.INTENSITYMODE_AUTOMATIC,d.INTENSITYMODE_LUMINOUSPOWER=c.c.INTENSITYMODE_LUMINOUSPOWER,d.INTENSITYMODE_LUMINOUSINTENSITY=c.c.INTENSITYMODE_LUMINOUSINTENSITY,d.INTENSITYMODE_ILLUMINANCE=c.c.INTENSITYMODE_ILLUMINANCE,d.INTENSITYMODE_LUMINANCE=c.c.INTENSITYMODE_LUMINANCE,d.LIGHTTYPEID_POINTLIGHT=c.c.LIGHTTYPEID_POINTLIGHT,d.LIGHTTYPEID_DIRECTIONALLIGHT=c.c.LIGHTTYPEID_DIRECTIONALLIGHT,d.LIGHTTYPEID_SPOTLIGHT=c.c.LIGHTTYPEID_SPOTLIGHT,d.LIGHTTYPEID_HEMISPHERICLIGHT=c.c.LIGHTTYPEID_HEMISPHERICLIGHT,d.LIGHTTYPEID_RECT_AREALIGHT=c.c.LIGHTTYPEID_RECT_AREALIGHT,(0,s.Cg)([(0,r.jT)()],d.prototype,"diffuse",void 0),(0,s.Cg)([(0,r.jT)()],d.prototype,"specular",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"falloffType",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"intensity",void 0),(0,s.Cg)([(0,r.lK)()],d.prototype,"range",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"intensityMode",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"radius",null),(0,s.Cg)([(0,r.lK)()],d.prototype,"_renderPriority",void 0),(0,s.Cg)([(0,r.$z)("_reorderLightsInScene")],d.prototype,"renderPriority",void 0),(0,s.Cg)([(0,r.lK)("shadowEnabled")],d.prototype,"_shadowEnabled",void 0),(0,s.Cg)([(0,r.lK)("excludeWithLayerMask")],d.prototype,"_excludeWithLayerMask",void 0),(0,s.Cg)([(0,r.lK)("includeOnlyWithLayerMask")],d.prototype,"_includeOnlyWithLayerMask",void 0),(0,s.Cg)([(0,r.lK)("lightmapMode")],d.prototype,"_lightmapMode",void 0)},9877:(e,t,i)=>{"use strict";i(4796).l.IncludesShadersStore.pointCloudVertex="#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n"},9983:(e,t,i)=>{"use strict";var s=i(8931);function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var n=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(h),c=["%","/","?",";","#"].concat(l),u=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,_=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},f={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=i(8985);function b(e,t,i){if(e&&"object"==typeof e&&e instanceof r)return e;var s=new r;return s.parse(e,t,i),s}r.prototype.parse=function(e,t,i){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),o=-1!==r&&r<e.indexOf("#")?"?":"#",h=e.split(o);h[0]=h[0].replace(/\\/g,"/");var b=e=h.join(o);if(b=b.trim(),!i&&1===e.split("#").length){var v=a.exec(b);if(v)return this.path=b,this.href=b,this.pathname=v[1],v[2]?(this.search=v[2],this.query=t?m.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var T=n.exec(b);if(T){var y=(T=T[0]).toLowerCase();this.protocol=y,b=b.substr(T.length)}if(i||T||b.match(/^\/\/[^@/]+@[^@/]+/)){var x="//"===b.substr(0,2);!x||T&&g[T]||(b=b.substr(2),this.slashes=!0)}if(!g[T]&&(x||T&&!f[T])){for(var A,C,S=-1,E=0;E<u.length;E++)-1!==(R=b.indexOf(u[E]))&&(-1===S||R<S)&&(S=R);for(-1!==(C=-1===S?b.lastIndexOf("@"):b.lastIndexOf("@",S))&&(A=b.slice(0,C),b=b.slice(C+1),this.auth=decodeURIComponent(A)),S=-1,E=0;E<c.length;E++){var R;-1!==(R=b.indexOf(c[E]))&&(-1===S||R<S)&&(S=R)}-1===S&&(S=b.length),this.host=b.slice(0,S),b=b.slice(S),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var I=this.hostname.split(/\./),M=(E=0,I.length);E<M;E++){var w=I[E];if(w&&!w.match(d)){for(var O="",B=0,D=w.length;B<D;B++)w.charCodeAt(B)>127?O+="x":O+=w[B];if(!O.match(d)){var F=I.slice(0,E),L=I.slice(E+1),N=w.match(_);N&&(F.push(N[1]),L.unshift(N[2])),L.length&&(b="/"+L.join(".")+b),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=s.toASCII(this.hostname));var k=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+k,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!p[y])for(E=0,M=l.length;E<M;E++){var V=l[E];if(-1!==b.indexOf(V)){var G=encodeURIComponent(V);G===V&&(G=escape(V)),b=b.split(V).join(G)}}var z=b.indexOf("#");-1!==z&&(this.hash=b.substr(z),b=b.slice(0,z));var H=b.indexOf("?");if(-1!==H?(this.search=b.substr(H),this.query=b.substr(H+1),t&&(this.query=m.parse(this.query)),b=b.slice(0,H)):t&&(this.search="",this.query={}),b&&(this.pathname=b),f[y]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){k=this.pathname||"";var W=this.search||"";this.path=k+W}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",s=this.hash||"",r=!1,n="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(n=m.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||n&&"?"+n||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||f[t])&&!1!==r?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r||(r=""),s&&"#"!==s.charAt(0)&&(s="#"+s),o&&"?"!==o.charAt(0)&&(o="?"+o),t+r+(i=i.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(o=o.replace("#","%23"))+s},r.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if("string"==typeof e){var t=new r;t.parse(e,!1,!0),e=t}for(var i=new r,s=Object.keys(this),n=0;n<s.length;n++){var o=s[n];i[o]=this[o]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),h=0;h<a.length;h++){var l=a[h];"protocol"!==l&&(i[l]=e[l])}return f[i.protocol]&&i.hostname&&!i.pathname&&(i.pathname="/",i.path=i.pathname),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!f[e.protocol]){for(var c=Object.keys(e),u=0;u<c.length;u++){var d=c[u];i[d]=e[d]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||g[e.protocol])i.pathname=e.pathname;else{for(var _=(e.pathname||"").split("/");_.length&&!(e.host=_.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==_[0]&&_.unshift(""),_.length<2&&_.unshift(""),i.pathname=_.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var p=i.pathname||"",m=i.search||"";i.path=p+m}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var b=i.pathname&&"/"===i.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),T=v||b||i.host&&e.pathname,y=T,x=i.pathname&&i.pathname.split("/")||[],A=(_=e.pathname&&e.pathname.split("/")||[],i.protocol&&!f[i.protocol]);if(A&&(i.hostname="",i.port=null,i.host&&(""===x[0]?x[0]=i.host:x.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===_[0]?_[0]=e.host:_.unshift(e.host)),e.host=null),T=T&&(""===_[0]||""===x[0])),v)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,x=_;else if(_.length)x||(x=[]),x.pop(),x=x.concat(_),i.search=e.search,i.query=e.query;else if(null!=e.search)return A&&(i.host=x.shift(),i.hostname=i.host,(P=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=P.shift(),i.hostname=P.shift(),i.host=i.hostname)),i.search=e.search,i.query=e.query,null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!x.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var C=x.slice(-1)[0],S=(i.host||e.host||x.length>1)&&("."===C||".."===C)||""===C,E=0,R=x.length;R>=0;R--)"."===(C=x[R])?x.splice(R,1):".."===C?(x.splice(R,1),E++):E&&(x.splice(R,1),E--);if(!T&&!y)for(;E--;E)x.unshift("..");!T||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),S&&"/"!==x.join("/").substr(-1)&&x.push("");var P,I=""===x[0]||x[0]&&"/"===x[0].charAt(0);return A&&(i.hostname=I?"":x.length?x.shift():"",i.host=i.hostname,(P=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=P.shift(),i.hostname=P.shift(),i.host=i.hostname)),(T=T||i.host&&x.length)&&!I&&x.unshift(""),x.length>0?i.pathname=x.join("/"):(i.pathname=null,i.path=null),null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},r.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.qg=b,t.hd=function(e,t){return b(e,!1,!0).resolve(t)},t.GP=function(e){return"string"==typeof e&&(e=b(e)),e instanceof r?e.format():r.prototype.format.call(e)}},9988:e=>{"use strict";e.exports=Math.pow}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return r[e].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.m=r,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"==typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"==typeof i.then)return i}var r=Object.create(null);o.r(r);var n={};e=e||[null,t({}),t([]),t(t)];for(var a=2&s&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>n[e]=()=>i[e]));return n.default=()=>i,o.d(r,n),r},o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,i)=>(o.f[i](e,t),t)),[])),o.u=e=>e+".GameClient.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},s="GameClient:",o.l=(e,t,r,n)=>{if(i[e])i[e].push(t);else{var a,h;if(void 0!==r)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==s+r){a=u;break}}a||(h=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",s+r),a.src=e),i[e]=[t];var d=(t,s)=>{a.onerror=a.onload=null,clearTimeout(_);var r=i[e];if(delete i[e],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(s))),t)return t(s)},_=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),h&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var s=i.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=i[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={8792:0};o.f.j=(t,i)=>{var s=o.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var r=new Promise(((i,r)=>s=e[t]=[i,r]));i.push(s[2]=r);var n=o.p+o.u(t),a=new Error;o.l(n,(i=>{if(o.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var r=i&&("load"===i.type?"missing":i.type),n=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+n+")",a.name="ChunkLoadError",a.type=r,a.request=n,s[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var s,r,[n,a,h]=i,l=0;if(n.some((t=>0!==e[t]))){for(s in a)o.o(a,s)&&(o.m[s]=a[s]);h&&h(o)}for(t&&t(i);l<n.length;l++)r=n[l],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0},i=self.webpackChunkGameClient=self.webpackChunkGameClient||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a={};(()=>{"use strict";var e;o.r(a),o.d(a,{game:()=>eC,mathData:()=>iC,webGLSupported:()=>tC}),function(e){e.SingleZero="SingleZero",e.DoubleZero="DoubleZero"}(e||(e={}));var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},t(e,i)};function i(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}function s(e,t){var i,s,r,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(h){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(n=0)),n;)try{if(i=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,s=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!((r=(r=n.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){n.label=a[1];break}if(6===a[0]&&n.label<r[1]){n.label=r[1],r=a;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(a);break}r[2]&&n.ops.pop(),n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e],s=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}}function r(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],s=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function n(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var s,r,n=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return o}function h(e,t,i){if(i||2===arguments.length)for(var s,r=0,n=t.length;r<n;r++)!s&&r in t||(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}function l(e){return this instanceof l?(this.v=e,this):new l(e)}function c(e){return"function"==typeof e}function u(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var d=u((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function _(e,t){if(e){var i=e.indexOf(t);0<=i&&e.splice(i,1)}}var p=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,i,s,o;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var l=r(a),u=l.next();!u.done;u=l.next())u.value.remove(this)}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}else a.remove(this);var _=this.initialTeardown;if(c(_))try{_()}catch(e){o=e instanceof d?e.errors:[e]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var g=r(p),f=g.next();!f.done;f=g.next()){var b=f.value;try{m(b)}catch(e){o=null!=o?o:[],e instanceof d?o=h(h([],n(o)),n(e.errors)):o.push(e)}}}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}}if(o)throw new d(o)}},e.prototype.add=function(t){var i;if(t&&t!==this)if(this.closed)m(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&_(t,e)},e.prototype.remove=function(t){var i=this._finalizers;i&&_(i,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),g=p.EMPTY;function f(e){return e instanceof p||e&&"closed"in e&&c(e.remove)&&c(e.add)&&c(e.unsubscribe)}function m(e){c(e)?e():e.unsubscribe()}var b=null,v=null,T=void 0,y=!1,x=!1,A={setTimeout:function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var r=A.delegate;return(null==r?void 0:r.setTimeout)?r.setTimeout.apply(r,h([e,t],n(i))):setTimeout.apply(void 0,h([e,t],n(i)))},clearTimeout:function(e){var t=A.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function C(e){A.setTimeout((function(){if(!b)throw e;b(e)}))}function S(){}var E=R("C",void 0,void 0);function R(e,t,i){return{kind:e,value:t,error:i}}var P=null;function I(e){if(y){var t=!P;if(t&&(P={errorThrown:!1,error:null}),e(),t){var i=P,s=i.errorThrown,r=i.error;if(P=null,s)throw r}}else e()}var M=function(e){function t(t){var i=e.call(this)||this;return i.isStopped=!1,t?(i.destination=t,f(t)&&t.add(i)):i.destination=N,i}return i(t,e),t.create=function(e,t,i){return new D(e,t,i)},t.prototype.next=function(e){this.isStopped?L(function(e){return R("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?L(R("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?L(E,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(p),w=Function.prototype.bind;function O(e,t){return w.call(e,t)}var B=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){F(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){F(e)}else F(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){F(e)}},e}(),D=function(e){function t(t,i,s){var r,n,o=e.call(this)||this;return c(t)||!t?r={next:null!=t?t:void 0,error:null!=i?i:void 0,complete:null!=s?s:void 0}:o&&x?((n=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},r={next:t.next&&O(t.next,n),error:t.error&&O(t.error,n),complete:t.complete&&O(t.complete,n)}):r=t,o.destination=new B(r),o}return i(t,e),t}(M);function F(e){var t;y?(t=e,y&&P&&(P.errorThrown=!0,P.error=t)):C(e)}function L(e,t){var i=v;i&&A.setTimeout((function(){return i(e,t)}))}var N={closed:!0,next:S,error:function(e){throw e},complete:S},k="function"==typeof Symbol&&Symbol.observable||"@@observable";function U(e){return e}var V=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var i=new e;return i.source=this,i.operator=t,i},e.prototype.subscribe=function(e,t,i){var s,r=this,n=(s=e)&&s instanceof M||function(e){return e&&c(e.next)&&c(e.error)&&c(e.complete)}(s)&&f(s)?e:new D(e,t,i);return I((function(){var e=r,t=e.operator,i=e.source;n.add(t?t.call(n,i):i?r._subscribe(n):r._trySubscribe(n))})),n},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var i=this;return new(t=G(t))((function(t,s){var r=new D({next:function(t){try{e(t)}catch(e){s(e),r.unsubscribe()}},error:s,complete:t});i.subscribe(r)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[k]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(i=e).length?U:1===i.length?i[0]:function(e){return i.reduce((function(e,t){return t(e)}),e)})(this);var i},e.prototype.toPromise=function(e){var t=this;return new(e=G(e))((function(e,i){var s;t.subscribe((function(e){return s=e}),(function(e){return i(e)}),(function(){return e(s)}))}))},e.create=function(t){return new e(t)},e}();function G(e){var t;return null!==(t=null!=e?e:T)&&void 0!==t?t:Promise}var z,H,W=u((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),X=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return i(t,e),t.prototype.lift=function(e){var t=new q(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new W},t.prototype.next=function(e){var t=this;I((function(){var i,s;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var n=r(t.currentObservers),o=n.next();!o.done;o=n.next())o.value.next(e)}catch(e){i={error:e}}finally{try{o&&!o.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}}}}))},t.prototype.error=function(e){var t=this;I((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var i=t.observers;i.length;)i.shift().error(e)}}))},t.prototype.complete=function(){var e=this;I((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,i=this,s=i.hasError,r=i.isStopped,n=i.observers;return s||r?g:(this.currentObservers=null,n.push(e),new p((function(){t.currentObservers=null,_(n,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,i=t.hasError,s=t.thrownError,r=t.isStopped;i?e.error(s):r&&e.complete()},t.prototype.asObservable=function(){var e=new V;return e.source=this,e},t.create=function(e,t){return new q(e,t)},t}(V),q=function(e){function t(t,i){var s=e.call(this)||this;return s.destination=t,s.source=i,s}return i(t,e),t.prototype.next=function(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)},t.prototype.error=function(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:g},t}(X),Q=function(e){function t(t){var i=e.call(this)||this;return i._value=t,i}return i(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var i=e.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},t.prototype.getValue=function(){var e=this,t=e.hasError,i=e.thrownError,s=e._value;if(t)throw i;return this._throwIfClosed(),s},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(X);class K{}K.MAX_NUMBER=36,K.DOUBLE_ZERO_ID=100,K.NUMBERS_PER_ROW=3,K.NUMBERS_PER_COLUMN=12;class Y{static getNumberPosition(e){return{row:Math.floor((e-1)/K.NUMBERS_PER_ROW),col:(e-1)%K.NUMBERS_PER_ROW}}static getMinMaxNumbers(e){let t=e[0],i=e[0];return e.forEach((e=>{e.value<t.value&&(t=e),e.value>i.value&&(i=e)})),{min:t,max:i}}static greedyChangeSolution(e,t){const i=t[0];let s=Math.floor(e/i);do{let r=e-i*s;if(0==r)return new Map([[i,s]]);if(1==t.length)return null;const n=Y.greedyChangeSolution(r,t.slice(1));if(n)return s>0?new Map([[i,s],...Array.from(n.entries())]):n;s--}while(s>=0);return null}constructor(){}}class j{constructor(e,t){this.spot=e??(()=>{throw new Error("'spot' shold be defined and not null")})(),this.cents=t??(()=>{throw new Error("'cents' should be defined and not null")})()}equals(e){return!!e&&(e===this||e instanceof j&&e.spot===this.spot&&e.cents===this.cents)}toString(){return`Spot: ${this.spot.toString()}, Cents: ${this.cents}`}}!function(e){e.StraightUp="StraightUp",e.Split="Split",e.Street="Street",e.Corner="Corner",e.SixLine="SixLine",e.Red="Red",e.Black="Black",e.Low="Low",e.High="High",e.Even="Even",e.Odd="Odd",e.Column="Column",e.Dozen="Dozen",e.Basket="Basket"}(z||(z={}));class Z extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,Z.prototype)}}class $ extends Z{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,$.prototype)}}class J extends Z{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,J.prototype)}}class ee extends Z{constructor(e="Operation aborted"){super(e),this.name=ee.ErrorName,Object.setPrototypeOf(this,ee.prototype)}}ee.ErrorName="AbortError";class te{constructor(e){this.placedBets=e,this.totalBetCents=[...e.values()].reduce(((e,t)=>e+t.cents),0)}toJSONString(){const e={};for(const t of this.placedBets){const i=t.spot.type,s=te.BetTypeIdMap.indexOf(i),r=t.cents/100;switch(i){case z.Basket:case z.Black:case z.Even:case z.High:case z.Low:case z.Odd:case z.Red:e[s]=r;break;default:e[s]=[...e[s]??[],[t.spot.typeScropeUID,r]]}}const t=[];for(let i in e)t.push([+i,e[i]]);return JSON.stringify(t)}static fromJSON(e,t,i){const s=[];return e.forEach((e=>{const r=e[0],n=te.BetTypeIdMap[r],o=e[1];Array.isArray(o)?o.forEach((e=>{s.push(this.parsePlacedBet(n,e,i,t))})):s.push(this.parsePlacedBet(n,o,i,t))})),s.length>0?new te(s):te.Empty}static fromJSONString(e,t,i){return this.fromJSON(JSON.parse(e),t,i)}static parsePlacedBet(e,t,i,s){const r=Array.isArray(t)?t[1]:t,n=Math.floor(100*r),o=Array.isArray(t)?t[0]:-1;switch(e){case z.Basket:return new j(i.Basket??(()=>{throw new Z("Basket bet is not available")})(),n);case z.Red:return new j(i.RedBlack.Red,n);case z.Black:return new j(i.RedBlack.Black,n);case z.Low:return new j(i.LowHigh.Low,n);case z.High:return new j(i.LowHigh.High,n);case z.Odd:return new j(i.OddEven.Odd,n);case z.Even:return new j(i.OddEven.Even,n);case z.Column:return new j(i.Column.getWithUID(o),n);case z.Dozen:return new j(i.Dozen.getWithUID(o),n);case z.SixLine:return new j(i.SixLine.getWithUID(o),n);case z.Corner:return new j(i.Corner.getWithUID(o),n);case z.Street:return new j(i.Street.getWithUID(o),n);case z.Split:return new j(i.Split.getWithUID(o),n);case z.StraightUp:return new j(i.StraightUp.getWithUID(o),n);default:throw new Z(`Unsupported bet type: ${e}`)}}}te.Empty=new te([]),te.BetTypeIdMap=[z.StraightUp,z.Split,z.Street,z.Corner,z.Basket,z.SixLine,z.Red,z.Black,z.Low,z.High,z.Even,z.Odd,z.Column,z.Dozen],function(e){e.Ok="Ok",e.WarningPartialLimitedByTable="WarningPartialLimitedByTable",e.WarningPartialLimitedBySpot="WarningPartialLimitedBySpot",e.Cancelled="Cancelled",e.ErrorLowerThanTheMinBetForSpot="ErrorLowerThanTheMinBetForSpot",e.ErrorSpotMaxBetExceeded="ErrorSpotMaxBetExceeded",e.ErrorTotalMaxBetExceeded="ErrorTotalMaxBetExceeded",e.ErrorChipsDistributionNotFound="ErrorChipsDistributionNotFound",e.ErrorInsufficientFunds="ErrorInsufficientFunds"}(H||(H={}));class ie{constructor(e,t,i){this.status=e,this.addedCents=t??0,this.totalBetSpotCents=i??0}static Ok(e,t){return new ie(H.Ok,e,t)}static WarningPartialLimitedBySpot(e,t){return new ie(H.WarningPartialLimitedBySpot,e,t)}static WarningPartialLimitedByTable(e,t){return new ie(H.WarningPartialLimitedByTable,e,t)}}ie.ErrorInsufficientFunds=new ie(H.ErrorInsufficientFunds),ie.ErrorSpotMaxBetExceeded=new ie(H.ErrorSpotMaxBetExceeded),ie.ErrorTotalMaxBetExceeded=new ie(H.ErrorTotalMaxBetExceeded),ie.ErrorChipsDistributionNotFound=new ie(H.ErrorChipsDistributionNotFound),ie.ErrorLowerThanTheMinBetForSpot=new ie(H.ErrorLowerThanTheMinBetForSpot),ie.Cancelled=new ie(H.Cancelled);class se{constructor(e,t){this.placedBetsCollection=e,this.updatedSpots=t}}class re{constructor(e,t){this.trackRebet=e,this.trackReset=t}}class ne{constructor(e,t,i){this._history=[],this._updated=new X,this._undoAvailabilitySubject=new Q(!1),this._betConfiguration=e??(()=>{throw new Error("'betConfiguration' is required")})(),this._placedBets=new Map,this._historySettings=t,this._playerBalance=i}tryAddBet(e,t,i){const s=this.canAddBet(e,t,i);if(H.Ok!==s.status)return s;let r,n=this._placedBets.get(e);return r=new j(e,n?t+n.cents:t),this.addHistoryEntry(oe.betsPlaced([new j(e,t)])),this.updateAndNotifyPlacedBets(r),s}canAddBet(e,t,i){const s=this.currentTotalBet;if(s+t>this._playerBalance.centsValue)return ie.ErrorInsufficientFunds;const r=this._betConfiguration.betRangeForType.get(e.type);if(!r)throw new Z(`No bet limits found for spot ${e.type}`);const n=this.getBetSpotCents(e),o=this._betConfiguration.totalBetRange.max-s,a=r.max-n;if(!i){if(o<t)return ie.ErrorTotalMaxBetExceeded;if(a<t)return ie.ErrorSpotMaxBetExceeded}const h=Math.min(o,a,t),l=h<t,c=l&&o===h,u=l&&a===h;if(0===h)return c?ie.ErrorTotalMaxBetExceeded:ie.ErrorSpotMaxBetExceeded;if(!Y.greedyChangeSolution(n+h,this._betConfiguration.chipValuesAscending))return ie.ErrorChipsDistributionNotFound;const d=n+h;return c?ie.WarningPartialLimitedByTable(o,d):u?ie.WarningPartialLimitedBySpot(a,d):ie.Ok(t,d)}getBetSpotCents(e){const t=this._placedBets.get(e);return t?.cents??0}clearBetSpot(e){let t=this._placedBets.get(e);if(!t||0===t.cents)return!1;const i=t.cents,s=new j(e,0);return this.addHistoryEntry(oe.betsRemoved([new j(e,i)])),this.updateAndNotifyPlacedBets(s),!0}reset(e){if(0==this._placedBets.size)return;const t=this.getSnapshot().placedBets,i=t.map((e=>new j(e.spot,0)));this._placedBets.clear(),e?this.resetHistory():this._historySettings.trackReset&&this.addHistoryEntry(oe.betsRemoved(t)),i.length>0&&this._updated.next(new se(this,i))}getSnapshot(){const e=this._placedBets.values(),t=[];for(const i of e)i.cents>0&&t.push(i);return new te(t)}undo(){const e=this.removeLastFromHistory();e&&this.undoBetHistoryEntry(e)}tryApplySnapshot(e,t){const i=new Map,s=new Map;if(e.totalBetCents>this._playerBalance.centsValue)return H.ErrorInsufficientFunds;if(e.totalBetCents>this._betConfiguration.totalBetRange.max)return H.ErrorTotalMaxBetExceeded;for(let t=0;t<e.placedBets.length;t++){const i=e.placedBets[t],s=this._betConfiguration.betRangeForType.get(i.spot.type)||(()=>{throw new Z(`No bet limit for type ${i.spot.type}`)})();if(i.cents>s.max)return H.ErrorSpotMaxBetExceeded}t&&this.reset(!0),this._placedBets.forEach(((e,t)=>{i.set(t,e),s.set(t,new j(t,0))})),e.placedBets.forEach((e=>{s.set(e.spot,e)}));const r=new Map;s.forEach(((e,t)=>{const i=this._placedBets.get(t),s=i?e.cents-i.cents:e.cents;r.set(t,s),this._placedBets.set(t,e)})),this._historySettings.trackRebet&&this.addHistoryEntry(new oe(r));const n=[...s.values()];return this._updated.next(new se(this,n)),H.Ok}get currentTotalBet(){return[...this._placedBets.values()].reduce(((e,t)=>e+t.cents),0)}get updateObservable(){return this._updated}get undoAvailabilityObservable(){return this._undoAvailabilitySubject}resetHistory(){this._history.length>0&&(this._history.length=0,this._undoAvailabilitySubject.next(!1))}addHistoryEntry(e){this._history.push(e),1===this._history.length&&this._undoAvailabilitySubject.next(!0)}removeLastFromHistory(){if(0===this._history.length)return;const e=this._history.pop();return 0===this._history.length&&this._undoAvailabilitySubject.next(!1),e}undoBetHistoryEntry(e){let t=[];e.deltas.forEach(((e,i)=>{const s=this._placedBets.get(i),r=s?s.cents:0;if(r-e<0)throw new Error(`Can't undo bet on spot ${i}: current value ${r} is lower than reverted delta ${e}`);const n=new j(i,r-e);this._placedBets.set(n.spot,n),t.push(n)})),this._updated.next(new se(this,t))}updateAndNotifyPlacedBets(e){const t=Array.isArray(e)?e:[e];t.forEach((e=>{this._placedBets.set(e.spot,e)})),this._updated.next(new se(this,t))}}class oe{constructor(e){this.deltas=e}static betsPlaced(e){const t=new Map;return e.forEach((e=>{t.set(e.spot,e.cents)})),new oe(t)}static betsRemoved(e){const t=new Map;return e.forEach((e=>{t.set(e.spot,-e.cents)})),new oe(t)}}class ae{constructor(e){this._centsObservable=new Q(e)}get centsValue(){return this._centsObservable.value}set centsValue(e){this._centsObservable.next(e)}get centsObservable(){return this._centsObservable}}Symbol("czrRoulettePlayerBalance");class he extends ae{}var le=u((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function ce(e,t){var i="object"==typeof t;return new Promise((function(s,r){var n=new D({next:function(e){s(e),n.unsubscribe()},error:r,complete:function(){i?s(t.defaultValue):r(new le)}});e.subscribe(n)}))}var ue,de={now:function(){return(de.delegate||Date).now()},delegate:void 0},_e=function(e){function t(t,i,s){void 0===t&&(t=1/0),void 0===i&&(i=1/0),void 0===s&&(s=de);var r=e.call(this)||this;return r._bufferSize=t,r._windowTime=i,r._timestampProvider=s,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=i===1/0,r._bufferSize=Math.max(1,t),r._windowTime=Math.max(1,i),r}return i(t,e),t.prototype.next=function(t){var i=this,s=i.isStopped,r=i._buffer,n=i._infiniteTimeWindow,o=i._timestampProvider,a=i._windowTime;s||(r.push(t),!n&&r.push(o.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),i=this._infiniteTimeWindow,s=this._buffer.slice(),r=0;r<s.length&&!e.closed;r+=i?1:2)e.next(s[r]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,i=e._timestampProvider,s=e._buffer,r=e._infiniteTimeWindow,n=(r?1:2)*t;if(t<1/0&&n<s.length&&s.splice(0,s.length-n),!r){for(var o=i.now(),a=0,h=1;h<s.length&&s[h]<=o;h+=2)a=h;a&&s.splice(0,a+1)}},t}(X);class pe{constructor(){this._subject=new _e(1)}get observable(){return this._subject}get value(){return this._value}set value(e){this._value=e,this._subject.next(this._value)}}class ge{constructor(e,t){this.min=e,this.max=t}}class fe{constructor(e,t,i,s){this.totalBetRange=e??(()=>{throw new Z("'totalBetRange' is required")})();const r=[...t].sort(((e,t)=>e-t));this.chipValuesAscending=r??(()=>{throw new Z("'chipValues' is required")})(),this.defaultChip=i,this.betRangeForType=s??(()=>{throw new Z("'betRangeForType' is required")})();const n=Object.values(z).filter((e=>!s.has(e)));if(n&&n.length>0)throw new Z(`Bet range is missing for these bet types: [${n.join(",")}]`)}}class me{constructor(e){this._betConfigurationStore=e}execute(e){const t=new ge(e.totalBetLimits.minBet,e.totalBetLimits.maxBet),i=e.chips,s=i.includes(e.defaultChip)?e.defaultChip:i[0],r=new Map;r.set(z.StraightUp,this.toBetRange(e.limitsPerBetType.STRAIGHT)),r.set(z.Split,this.toBetRange(e.limitsPerBetType.SPLIT)),r.set(z.Street,this.toBetRange(e.limitsPerBetType.STREET)),r.set(z.Corner,this.toBetRange(e.limitsPerBetType.CORNER)),r.set(z.Basket,this.toBetRange(e.limitsPerBetType.BASKET)),r.set(z.SixLine,this.toBetRange(e.limitsPerBetType.LINE)),r.set(z.Column,this.toBetRange(e.limitsPerBetType.COLUMN)),r.set(z.Dozen,this.toBetRange(e.limitsPerBetType.DOZEN)),r.set(z.High,this.toBetRange(e.limitsPerBetType.LOWHIGH)),r.set(z.Low,this.toBetRange(e.limitsPerBetType.LOWHIGH)),r.set(z.Red,this.toBetRange(e.limitsPerBetType.REDBLACK)),r.set(z.Black,this.toBetRange(e.limitsPerBetType.REDBLACK)),r.set(z.Even,this.toBetRange(e.limitsPerBetType.ODDEVEN)),r.set(z.Odd,this.toBetRange(e.limitsPerBetType.ODDEVEN));const n=new fe(t,i,s,r);this._betConfigurationStore.value=n}toBetRange(e){return new ge(e.minBetAmount,e.maxBetAmount)}}class be{constructor(e,t){this._running=!1,this._clientEmitter=e??(()=>{throw new Error("'clientEmitter' is required")})(),this._playerBalance=t??(()=>{throw new Error("'playerBalance' is required")})()}start(){this._running||(this._running=!0,this._clientEmitter.addListener("FrameBalanceUpdate",this.onFrameBalanceUpdated.bind(this)))}stop(){this._running&&(this._running=!1,this._clientEmitter.removeListener("FrameBalanceUpdate",this.onFrameBalanceUpdated.bind(this)))}onFrameBalanceUpdated(e){this._playerBalance.centsValue=e}}class ve{constructor(e){this.url=e}}class Te{constructor(e,t){this._basePath=e,this._assetPathMap=t}resolveRelativePath(e){return new ve(`${this._basePath}/${e}`)}resolveAssetId(e){const t=this._assetPathMap.get(e);if(!t)throw new Z(`Could not resolve path for asset id '${e}'`);return this.resolveRelativePath(t)}}!function(e){e.portrait="portrait",e.landscape="landscape"}(ue||(ue={}));class ye{constructor(e){this.width=e.width,this.height=e.height,this.orientation=e.orientation,this.previousOrientation=e.previousOrientation,this.scale=e.scale,this.referenceSizeLandscape=e.referenceSizeLandscape}updatedClone(e){return{...this,...e}}}class xe{constructor(){this._handlers=new Set}onResize(e){this._lastResizeInfo=e,this._handlers.forEach((t=>{t.onResize(e)}))}register(e){if(e===this)throw new Z("Can't register resize handler to itself");this._handlers.add(e),this._lastResizeInfo&&e.onResize(this._lastResizeInfo.updatedClone({previousOrientation:void 0}))}unregister(e){this._handlers.delete(e)}}var Ae,Ce,Se,Ee,Re,Pe,Ie=o(8836),Me=o(7291);class we{constructor(e){this.name=e}toString(){return this.name}}class Oe extends we{constructor(e){super(e)}static _(e){return new Ae(e)}}Ae=Oe,Oe.Environment=Ae._("3DEnvironment"),Oe.MainScene=Ae._("MainScene"),Oe.MainSceneNoCamAnimation=Ae._("MainSceneNoCamAnimation"),Oe.Chip=Ae._("Chip");class Be extends we{}Be.Skybox=new Be("Skybox");class De extends we{static _(e){const t=new Ce(e);if(this._all.some((t=>t.name===e)))throw new Z(`Duplicated Texture asset id ${e}`);return this._all.push(t),t}}Ce=De,De._all=[],De.Felt_CPO_Green_SD=Ce._("Felt_CPO_Green_SD"),De.Felt_CPO_Blue_SD=Ce._("Felt_CPO_Blue_SD"),De.Felt_CPO_Gray_SD=Ce._("Felt_CPO_Gray_SD"),De.Felt_CPO_Red_SD=Ce._("Felt_CPO_Red_SD"),De.Felt_HSO_Blue_SD=Ce._("Felt_HSO_DarkBlue_SD"),De.Felt_HSO_Black_SD=Ce._("Felt_HSO_Black_SD"),De.Felt_HSO_Tan_SD=Ce._("Felt_HSO_Tan_SD"),De.Felt_HSO_Gold_SD=Ce._("Felt_HSO_Gold_SD"),De.Felt_SBK_Green_SD=Ce._("Felt_SBK_Green_SD"),De.Felt_SBK_Blue_SD=Ce._("Felt_SBK_Blue_SD"),De.Felt_SBK_Red_SD=Ce._("Felt_SBK_Red_SD"),De.Felt_SBK_Gold_SD=Ce._("Felt_SBK_Gold_SD"),De.BaseWoodTexture=Ce._("BaseWoodTexture"),De.Carpet=Ce._("Carpet");class Fe extends we{static get All(){return this._all}static get AllMusicTrackIDs(){return this._all.filter((e=>"music"===e.type))}static get AllSFXIDs(){return this._all.filter((e=>"sfx"===e.type))}static get AllVoiceIDs(){return this._all.filter((e=>"voice"===e.type))}static get AllMaleVoiceIDs(){return this._all.filter((e=>"voice"===e.type&&e.name.startsWith("VO_M_")))}static get AllFemaleVoiceIDs(){return this._all.filter((e=>"voice"===e.type&&e.name.startsWith("VO_F_")))}static get AllWelcomeIDs(){return[Se.VO_F_Welcome_EU_cpo,Se.VO_F_Welcome_EU_sbk,Se.VO_F_Welcome_EU_hso,Se.VO_F_Welcome_US_cpo,Se.VO_F_Welcome_US_sbk,Se.VO_F_Welcome_US_hso,Se.VO_M_Welcome_EU_cpo,Se.VO_M_Welcome_EU_sbk,Se.VO_M_Welcome_EU_hso,Se.VO_M_Welcome_US_cpo,Se.VO_M_Welcome_US_sbk,Se.VO_M_Welcome_US_hso]}static tryGetWithName(e){return this._all.find((t=>t.name===e))}constructor(e,t){super(e),this.type=t}static _sfx(e){return this._(e,"sfx")}static _music(e){return this._(e,"music")}static _vo(e){return this._(e,"voice")}static _(e,t){const i=new Se(e,t);return this._all.push(i),i}}Se=Fe,Fe._all=[],Fe.SFX_Spin_1=Se._sfx("SFX_Spin_1"),Fe.SFX_Spin_2=Se._sfx("SFX_Spin_2"),Fe.SFX_Spin_3=Se._sfx("SFX_Spin_3"),Fe.SFX_Spin_4=Se._sfx("SFX_Spin_4"),Fe.SFX_Spin_5=Se._sfx("SFX_Spin_5"),Fe.SFX_Spin_6=Se._sfx("SFX_Spin_6"),Fe.SFX_Spin_7=Se._sfx("SFX_Spin_7"),Fe.SFX_Spin_8=Se._sfx("SFX_Spin_8"),Fe.SFX_Spin_9=Se._sfx("SFX_Spin_9"),Fe.SFX_Spin_10=Se._sfx("SFX_Spin_10"),Fe.SFX_Spin_11=Se._sfx("SFX_Spin_11"),Fe.SFX_Spin_12=Se._sfx("SFX_Spin_12"),Fe.SFX_Spin_13=Se._sfx("SFX_Spin_13"),Fe.SFX_Spin_14=Se._sfx("SFX_Spin_14"),Fe.SFX_Spin_15=Se._sfx("SFX_Spin_15"),Fe.VO_F_1=Se._vo("VO_F_1"),Fe.VO_F_2=Se._vo("VO_F_2"),Fe.VO_F_3=Se._vo("VO_F_3"),Fe.VO_F_4=Se._vo("VO_F_4"),Fe.VO_F_5=Se._vo("VO_F_5"),Fe.VO_F_6=Se._vo("VO_F_6"),Fe.VO_F_7=Se._vo("VO_F_7"),Fe.VO_F_8=Se._vo("VO_F_8"),Fe.VO_F_9=Se._vo("VO_F_9"),Fe.VO_F_10=Se._vo("VO_F_10"),Fe.VO_F_11=Se._vo("VO_F_11"),Fe.VO_F_12=Se._vo("VO_F_12"),Fe.VO_F_13=Se._vo("VO_F_13"),Fe.VO_F_14=Se._vo("VO_F_14"),Fe.VO_F_15=Se._vo("VO_F_15"),Fe.VO_F_16=Se._vo("VO_F_16"),Fe.VO_F_17=Se._vo("VO_F_17"),Fe.VO_F_18=Se._vo("VO_F_18"),Fe.VO_F_19=Se._vo("VO_F_19"),Fe.VO_F_20=Se._vo("VO_F_20"),Fe.VO_F_21=Se._vo("VO_F_21"),Fe.VO_F_22=Se._vo("VO_F_22"),Fe.VO_F_23=Se._vo("VO_F_23"),Fe.VO_F_24=Se._vo("VO_F_24"),Fe.VO_F_25=Se._vo("VO_F_25"),Fe.VO_F_26=Se._vo("VO_F_26"),Fe.VO_F_27=Se._vo("VO_F_27"),Fe.VO_F_28=Se._vo("VO_F_28"),Fe.VO_F_29=Se._vo("VO_F_29"),Fe.VO_F_30=Se._vo("VO_F_30"),Fe.VO_F_31=Se._vo("VO_F_31"),Fe.VO_F_32=Se._vo("VO_F_32"),Fe.VO_F_33=Se._vo("VO_F_33"),Fe.VO_F_34=Se._vo("VO_F_34"),Fe.VO_F_35=Se._vo("VO_F_35"),Fe.VO_F_36=Se._vo("VO_F_36"),Fe.VO_F_0=Se._vo("VO_F_0"),Fe.VO_F_00=Se._vo("VO_F_00"),Fe.VO_F_Black=Se._vo("VO_F_Black"),Fe.VO_F_Red=Se._vo("VO_F_Red"),Fe.VO_F_Odd=Se._vo("VO_F_Odd"),Fe.VO_F_Even=Se._vo("VO_F_Even"),Fe.VO_F_Place_Your_Bets=Se._vo("VO_F_Place_Your_Bets"),Fe.VO_F_No_More_Bets=Se._vo("VO_F_No_More_Bets"),Fe.VO_F_Winner_Reg=Se._vo("VO_F_Winner_Reg"),Fe.VO_F_Winner_High=Se._vo("VO_F_Winner_High"),Fe.VO_F_Winner_Big=Se._vo("VO_F_Winner_Big"),Fe.VO_F_HereWeGo=Se._vo("VO_F_HereWeGo"),Fe.VO_F_Welcome_US_cpo=Se._vo("VO_F_Welcome_US_cpo"),Fe.VO_F_Welcome_US_sbk=Se._vo("VO_F_Welcome_US_sbk"),Fe.VO_F_Welcome_US_hso=Se._vo("VO_F_Welcome_US_hso"),Fe.VO_F_Welcome_EU_cpo=Se._vo("VO_F_Welcome_EU_cpo"),Fe.VO_F_Welcome_EU_sbk=Se._vo("VO_F_Welcome_EU_sbk"),Fe.VO_F_Welcome_EU_hso=Se._vo("VO_F_Welcome_EU_hso"),Fe.VO_M_1=Se._vo("VO_M_1"),Fe.VO_M_2=Se._vo("VO_M_2"),Fe.VO_M_3=Se._vo("VO_M_3"),Fe.VO_M_4=Se._vo("VO_M_4"),Fe.VO_M_5=Se._vo("VO_M_5"),Fe.VO_M_6=Se._vo("VO_M_6"),Fe.VO_M_7=Se._vo("VO_M_7"),Fe.VO_M_8=Se._vo("VO_M_8"),Fe.VO_M_9=Se._vo("VO_M_9"),Fe.VO_M_10=Se._vo("VO_M_10"),Fe.VO_M_11=Se._vo("VO_M_11"),Fe.VO_M_12=Se._vo("VO_M_12"),Fe.VO_M_13=Se._vo("VO_M_13"),Fe.VO_M_14=Se._vo("VO_M_14"),Fe.VO_M_15=Se._vo("VO_M_15"),Fe.VO_M_16=Se._vo("VO_M_16"),Fe.VO_M_17=Se._vo("VO_M_17"),Fe.VO_M_18=Se._vo("VO_M_18"),Fe.VO_M_19=Se._vo("VO_M_19"),Fe.VO_M_20=Se._vo("VO_M_20"),Fe.VO_M_21=Se._vo("VO_M_21"),Fe.VO_M_22=Se._vo("VO_M_22"),Fe.VO_M_23=Se._vo("VO_M_23"),Fe.VO_M_24=Se._vo("VO_M_24"),Fe.VO_M_25=Se._vo("VO_M_25"),Fe.VO_M_26=Se._vo("VO_M_26"),Fe.VO_M_27=Se._vo("VO_M_27"),Fe.VO_M_28=Se._vo("VO_M_28"),Fe.VO_M_29=Se._vo("VO_M_29"),Fe.VO_M_30=Se._vo("VO_M_30"),Fe.VO_M_31=Se._vo("VO_M_31"),Fe.VO_M_32=Se._vo("VO_M_32"),Fe.VO_M_33=Se._vo("VO_M_33"),Fe.VO_M_34=Se._vo("VO_M_34"),Fe.VO_M_35=Se._vo("VO_M_35"),Fe.VO_M_36=Se._vo("VO_M_36"),Fe.VO_M_0=Se._vo("VO_M_0"),Fe.VO_M_00=Se._vo("VO_M_00"),Fe.VO_M_Black=Se._vo("VO_M_Black"),Fe.VO_M_Red=Se._vo("VO_M_Red"),Fe.VO_M_Odd=Se._vo("VO_M_Odd"),Fe.VO_M_Even=Se._vo("VO_M_Even"),Fe.VO_M_Place_Your_Bets=Se._vo("VO_M_Place_Your_Bets"),Fe.VO_M_No_More_Bets=Se._vo("VO_M_No_More_Bets"),Fe.VO_M_Winner_Reg=Se._vo("VO_M_Winner_Reg"),Fe.VO_M_Winner_High=Se._vo("VO_M_Winner_High"),Fe.VO_M_Winner_Big=Se._vo("VO_M_Winner_Big"),Fe.VO_M_HereWeGo=Se._vo("VO_M_HereWeGo"),Fe.VO_M_Welcome_US_cpo=Se._vo("VO_M_Welcome_US_cpo"),Fe.VO_M_Welcome_US_sbk=Se._vo("VO_M_Welcome_US_sbk"),Fe.VO_M_Welcome_US_hso=Se._vo("VO_M_Welcome_US_hso"),Fe.VO_M_Welcome_EU_cpo=Se._vo("VO_M_Welcome_EU_cpo"),Fe.VO_M_Welcome_EU_sbk=Se._vo("VO_M_Welcome_EU_sbk"),Fe.VO_M_Welcome_EU_hso=Se._vo("VO_M_Welcome_EU_hso"),Fe.SFX_ChipSelect=Se._sfx("SFX_ChipSelect"),Fe.SFX_PlacedChipStack=Se._sfx("SFX_ChipStackPlaced"),Fe.SFX_Lose=Se._sfx("SFX_Lose"),Fe.SFX_Win=Se._sfx("SFX_Win"),Fe.SFX_WinBanner=Se._sfx("SFX_WinBanner"),Fe.SFX_PlacedSingleChip=Se._sfx("SFX_SingleChipPlaced"),Fe.SFX_ClearTable=Se._sfx("SFX_TableClear"),Fe.SFX_UI_Click=Se._sfx("SFX_UI_Click"),Fe.SFX_UI_MenuClose=Se._sfx("SFX_UI_MenuClose"),Fe.SFX_UI_MenuOpen=Se._sfx("SFX_UI_MenuOpen"),Fe.Music_Heavy=Se._music("Music_Heavy"),Fe.Music_Neon=Se._music("Music_Neon"),Fe.Music_Blues=Se._music("Music_Blues"),Fe.Music_Chill=Se._music("Music_Chill"),Fe.Music_Groovy=Se._music("Music_Groovy"),Fe.Music_Jazz=Se._music("Music_Jazz"),Fe.Music_Lounge=Se._music("Music_Lounge"),Fe.Music_Classical=Se._music("Music_Classical"),Fe.Music_CasinoAmbient=Se._music("Music_CasinoAmbient");class Le extends we{constructor(e){super(e)}static _(e){return new Ee(e)}}Ee=Le,Le.BallAnimations=Ee._("BallAnimations");class Ne extends we{constructor(e){super(e)}static _(e){if(this._all.find((t=>t.name===e)))throw new Z(`Duplicated image asset id: ${e}`);const t=new Re(e);return this._all.push(t),t}}Re=Ne,Ne._all=[],Ne.Splash_Demo_1=Re._("Splash_Demo_1"),Ne.Splash_Demo_2=Re._("Splash_Demo_2"),Ne.Splash_Demo_3=Re._("Splash_Demo_3"),Ne.Splash_Demo_Check=Re._("Splash_Demo_Check"),Ne.Splash_Demo_Btn_Agree=Re._("Splash_Btn_Agree"),Ne.Splash_Background=Re._("Splash_Background"),Ne.Splash_PressToPlay=Re._("Splash_PressToPlay"),Ne.IntroDialog_BG=Re._("IntroDialog_BG"),Ne.IntroDialog_OK=Re._("IntroDialog_OK"),Ne.IntroDialog_DontShowAgain=Re._("IntroDialog_DontShowAgain"),Ne.UI_BtnClear=Re._("UI_BtnClear"),Ne.UI_BtnUndo=Re._("UI_BtnUndo"),Ne.UI_BtnDouble=Re._("UI_BtnDouble"),Ne.UI_BtnRebet=Re._("UI_BtnRebet"),Ne.UI_BtnSpin=Re._("UI_BtnSpin"),Ne.UI_BtnRebetAndSpin=Re._("UI_BtnRebetAndSpin"),Ne.UI_BtnSkip=Re._("UI_BtnSkip"),Ne.UI_BtnFavBet=Re._("UI_BtnFavBet"),Ne.UI_BtnMusicOn=Re._("UI_BtnMusicOn"),Ne.UI_BtnMusicOff=Re._("UI_BtnMusicOff"),Ne.UI_BtnClose=Re._("UI_BtnClose"),Ne.UI_BtnSettings=Re._("UI_BtnSettings"),Ne.UI_BtnAudioOn=Re._("UI_BtnAudioOn"),Ne.UI_BtnAudioOff=Re._("UI_BtnAudioOff"),Ne.UI_BtnInfo=Re._("UI_BtnInfo"),Ne.UI_BtnNewGame=Re._("UI_BtnNewGame"),Ne.UI_SmallDialogBox=Re._("UI_SmallDialogBox"),Ne.UI_BtnAdd=Re._("UI_BtnAdd"),Ne.UI_BtnCancel=Re._("UI_BtnCancel"),Ne.UI_BtnConfirm=Re._("UI_BtnConfirm"),Ne.UI_TitleBar=Re._("UI_TitleBar"),Ne.UI_PIP_Frame=Re._("UI_PIP_Frame"),Ne.UI_TableLimitsFrame=Re._("UI_TableLimitsFrame"),Ne.UI_RaceTrack_Background=Re._("UI_RaceTrack_Background"),Ne.UI_RaceTrack_BtnPlus=Re._("UI_RaceTrack_BtnPlus"),Ne.UI_RaceTrack_BtnMinus=Re._("UI_RaceTrack_BtnMinus"),Ne.UI_RaceTrack_Numbers=Re._("UI_RaceTrack_Numbers"),Ne.UI_RaceTrack_HitZone_14=Re._("UI_RaceTrack_HitZone_14"),Ne.UI_RaceTrack_HitZone_2=Re._("UI_RaceTrack_HitZone_2"),Ne.UI_RaceTrack_HitZone_0=Re._("UI_RaceTrack_HitZone_0"),Ne.UI_RaceTrack_HitZone_28=Re._("UI_RaceTrack_HitZone_28"),Ne.UI_RaceTrack_HitZone_Rect=Re._("UI_RaceTrack_HitZone_Rect"),Ne.UI_RaceTrack_Button=Re._("UI_RaceTrack_Button"),Ne.UI_ToggleOn=Re._("UI_ToggleOn"),Ne.UI_ToggleOff=Re._("UI_ToggleOff"),Ne.UI_ToggleKnob=Re._("UI_ToggleKnob"),Ne.UI_AudioSettings_Background=Re._("UI_AudioSettings_Background"),Ne.UI_GenericGreenButton=Re._("UI_GenericGreenButton"),Ne.UI_WinningNumberPopup_Background=Re._("UI_WinningNumberPopup_Background"),Ne.UI_WinningNumberPopup_Circle=Re._("UI_WinningNumberPopup_Circle"),Ne.UI_InfoDialog_Background=Re._("UI_InfoDialog_Background"),Ne.UI_Settings_Background=Re._("UI_Settings_Background"),Ne.UI_Settings_FeltButtons=Re._("UI_Settings_FeltButtons"),Ne.UI_Settings_WheelCW=Re._("UI_Settings_WheelCW"),Ne.UI_Settings_WheelCCW=Re._("UI_Settings_WheelCCW"),Ne.UI_Settings_WheelAlt=Re._("UI_Settings_WheelAlt"),Ne.UI_FavBet_EmptySlot=Re._("UI_FavBet_EmptySlot"),Ne.UI_FavBet_LinkedSlot=Re._("UI_FavBet_LinkedSlot"),Ne.UI_FavBet_Background=Re._("UI_FavBet_Background"),Ne.UI_FavBet_BtnDelete=Re._("UI_FavBet_BtnDelete"),Ne.UI_FavBet_Title=Re._("UI_FavBet_Title"),Ne.UI_FavBet_EnterBetMessage=Re._("UI_FavBet_EnterBetMessage"),Ne.UI_FavBet_EnterBetTextBox=Re._("UI_FavBet_EnterBetTextBox"),Ne.UI_FavBet_DeleteConfirmationMessage=Re._("UI_FavBet_DeleteConfirmationMessage"),Ne.UI_Stats_Wheel=Re._("UI_Stats_Wheel"),Ne.UI_Stats_WheelCap=Re._("UI_Stats_WheelCap"),Ne.UI_Stats_HotColdFrame=Re._("UI_Stats_HotColdFrame"),Ne.UI_Stats_HotColdGrid=Re._("UI_Stats_HotColdGrid"),Ne.UI_Stats_Grid=Re._("UI_Stats_Grid"),Ne.UI_Stats_TitleHot=Re._("UI_Stats_TitleHot"),Ne.UI_Stats_TitleCold=Re._("UI_Stats_TitleCold"),Ne.UI_Stats_Button=Re._("UI_Stats_Button"),Ne.UI_Stats_UILastNumbersBar=Re._("UI_Stats_UILastNumbersBar"),Ne.UI_Stats_UILastNumberFrame=Re._("UI_Stats_UILastNumberFrame"),Ne.UI_MeterBet=Re._("UI_MeterBet"),Ne.UI_MeterWin=Re._("UI_MeterWin"),Ne.UI_MeterBalance=Re._("UI_MeterBalance"),Ne.UI_Frame_Slice9=Re._("UI_Frame_Slice9"),Ne.UI_BetSelector_Arrow=Re._("UI_BetSelector_Arrow"),Ne.UI_Chip_Black=Re._("UI_Chip_Black"),Ne.UI_Chip_Blue=Re._("UI_Chip_Blue"),Ne.UI_Chip_Gray=Re._("UI_Chip_Gray"),Ne.UI_Chip_Green=Re._("UI_Chip_Green"),Ne.UI_Chip_Orange=Re._("UI_Chip_Orange"),Ne.UI_Chip_Pink=Re._("UI_Chip_Pink"),Ne.UI_Chip_Red=Re._("UI_Chip_Red"),Ne.UI_Chip_White=Re._("UI_Chip_White"),Ne.UI_Chip_Yellow=Re._("UI_Chip_Yellow"),Ne.UI_BetSpotHint_Background=Re._("UI_BetSpotHint_Background"),Ne.UI_BetSpotHint_2X=Re._("UI_BetSpotHint_2X"),Ne.UI_BetSpotHint_Add=Re._("UI_BetSpotHint_Add"),Ne.UI_BetSpotHint_Clear=Re._("UI_BetSpotHint_Clear");class ke extends we{constructor(e){super(e)}static _(e){return new Pe(e)}}Pe=ke,ke.Rubik=Pe._("Rubik");var Ue=o(1427),Ve=o(5826),Ge=o(482),ze=o(3218),He=o(8058),We=o(9046);function Xe(){(0,Ue.qS)({...Ve._,createPlugin:async e=>{const{GLTFFileLoader:t}=await Promise.all([o.e(4915),o.e(67)]).then(o.bind(o,67));return new t(e[Ve._.name])}}),(0,We.Ye)("EXT_lights_image_based",!0,(async e=>{const{EXT_lights_image_based:t}=await Promise.all([o.e(4915),o.e(67),o.e(9232)]).then(o.bind(o,9232));return new t(e)})),(0,We.Ye)("EXT_mesh_gpu_instancing",!0,(async e=>{const{EXT_mesh_gpu_instancing:t}=await Promise.all([o.e(4915),o.e(67),o.e(9784)]).then(o.bind(o,9784));return new t(e)})),(0,We.Ye)("EXT_meshopt_compression",!0,(async e=>{const{EXT_meshopt_compression:t}=await Promise.all([o.e(4915),o.e(67),o.e(9518)]).then(o.bind(o,9518));return new t(e)})),(0,We.Ye)("EXT_texture_avif",!0,(async e=>{const{EXT_texture_avif:t}=await Promise.all([o.e(4915),o.e(67),o.e(3969)]).then(o.bind(o,3969));return new t(e)})),(0,We.Ye)("EXT_texture_webp",!0,(async e=>{const{EXT_texture_webp:t}=await Promise.all([o.e(4915),o.e(67),o.e(2104)]).then(o.bind(o,9723));return new t(e)})),(0,We.Ye)("ExtrasAsMetadata",!1,(async e=>{const{ExtrasAsMetadata:t}=await o.e(1151).then(o.bind(o,1151));return new t(e)})),(0,We.Ye)("KHR_animation_pointer",!0,(async e=>{const{KHR_animation_pointer:t}=await o.e(1210).then(o.bind(o,1210));return new t(e)})),(0,We.Ye)("KHR_draco_mesh_compression",!0,(async e=>{const{KHR_draco_mesh_compression:t}=await Promise.all([o.e(4915),o.e(67),o.e(5850)]).then(o.bind(o,5850));return new t(e)})),(0,We.Ye)("KHR_interactivity",!0,(async e=>{const{KHR_interactivity:t}=await o.e(4486).then(o.bind(o,4486));return new t(e)})),(0,We.Ye)("KHR_lights_punctual",!0,(async e=>{const{KHR_lights:t}=await Promise.all([o.e(4915),o.e(67),o.e(4520)]).then(o.bind(o,4520));return new t(e)})),(0,We.Ye)("EXT_lights_ies",!0,(async e=>{const{EXT_lights_ies:t}=await Promise.all([o.e(4915),o.e(67),o.e(4324)]).then(o.bind(o,4324));return new t(e)})),(0,We.Ye)("KHR_materials_anisotropy",!0,(async e=>{const{KHR_materials_anisotropy:t}=await Promise.all([o.e(4915),o.e(67),o.e(6806)]).then(o.bind(o,6806));return new t(e)})),(0,We.Ye)("KHR_materials_clearcoat",!0,(async e=>{const{KHR_materials_clearcoat:t}=await Promise.all([o.e(4915),o.e(67),o.e(762)]).then(o.bind(o,762));return new t(e)})),(0,We.Ye)("KHR_materials_diffuse_transmission",!0,(async e=>{const{KHR_materials_diffuse_transmission:t}=await Promise.all([o.e(4915),o.e(67),o.e(9377)]).then(o.bind(o,9377));return new t(e)})),(0,We.Ye)("KHR_materials_dispersion",!0,(async e=>{const{KHR_materials_dispersion:t}=await Promise.all([o.e(4915),o.e(67),o.e(7512)]).then(o.bind(o,7512));return new t(e)})),(0,We.Ye)("KHR_materials_emissive_strength",!0,(async e=>{const{KHR_materials_emissive_strength:t}=await Promise.all([o.e(4915),o.e(67),o.e(8001)]).then(o.bind(o,8001));return new t(e)})),(0,We.Ye)("KHR_materials_ior",!0,(async e=>{const{KHR_materials_ior:t}=await Promise.all([o.e(4915),o.e(67),o.e(890)]).then(o.bind(o,890));return new t(e)})),(0,We.Ye)("KHR_materials_iridescence",!0,(async e=>{const{KHR_materials_iridescence:t}=await Promise.all([o.e(4915),o.e(67),o.e(6096)]).then(o.bind(o,6096));return new t(e)})),(0,We.Ye)("KHR_materials_pbrSpecularGlossiness",!0,(async e=>{const{KHR_materials_pbrSpecularGlossiness:t}=await Promise.all([o.e(4915),o.e(67),o.e(8039)]).then(o.bind(o,8039));return new t(e)})),(0,We.Ye)("KHR_materials_sheen",!0,(async e=>{const{KHR_materials_sheen:t}=await Promise.all([o.e(4915),o.e(67),o.e(9481)]).then(o.bind(o,9481));return new t(e)})),(0,We.Ye)("KHR_materials_specular",!0,(async e=>{const{KHR_materials_specular:t}=await Promise.all([o.e(4915),o.e(67),o.e(7903)]).then(o.bind(o,7903));return new t(e)})),(0,We.Ye)("KHR_materials_transmission",!0,(async e=>{const{KHR_materials_transmission:t}=await Promise.all([o.e(4915),o.e(67),o.e(1702)]).then(o.bind(o,1702));return new t(e)})),(0,We.Ye)("KHR_materials_unlit",!0,(async e=>{const{KHR_materials_unlit:t}=await Promise.all([o.e(4915),o.e(67),o.e(2364)]).then(o.bind(o,2364));return new t(e)})),(0,We.Ye)("KHR_materials_variants",!0,(async e=>{const{KHR_materials_variants:t}=await Promise.all([o.e(4915),o.e(67),o.e(1132)]).then(o.bind(o,1132));return new t(e)})),(0,We.Ye)("KHR_materials_volume",!0,(async e=>{const{KHR_materials_volume:t}=await Promise.all([o.e(4915),o.e(67),o.e(6964)]).then(o.bind(o,6964));return new t(e)})),(0,We.Ye)("KHR_mesh_quantization",!0,(async e=>{const{KHR_mesh_quantization:t}=await o.e(146).then(o.bind(o,146));return new t(e)})),(0,We.Ye)("KHR_texture_basisu",!0,(async e=>{const{KHR_texture_basisu:t}=await Promise.all([o.e(4915),o.e(67),o.e(2668)]).then(o.bind(o,2668));return new t(e)})),(0,We.Ye)("KHR_texture_transform",!0,(async e=>{const{KHR_texture_transform:t}=await Promise.all([o.e(4915),o.e(67),o.e(6525)]).then(o.bind(o,6525));return new t(e)})),(0,We.Ye)("KHR_xmp_json_ld",!0,(async e=>{const{KHR_xmp_json_ld:t}=await o.e(4095).then(o.bind(o,6476));return new t(e)})),(0,We.Ye)("MSFT_audio_emitter",!0,(async e=>{const{MSFT_audio_emitter:t}=await Promise.all([o.e(4915),o.e(67),o.e(9021)]).then(o.bind(o,9021));return new t(e)})),(0,We.Ye)("MSFT_lod",!0,(async e=>{const{MSFT_lod:t}=await Promise.all([o.e(4915),o.e(67),o.e(7395)]).then(o.bind(o,7395));return new t(e)})),(0,We.Ye)("MSFT_minecraftMesh",!0,(async e=>{const{MSFT_minecraftMesh:t}=await Promise.all([o.e(4915),o.e(67),o.e(6042)]).then(o.bind(o,3661));return new t(e)})),(0,We.Ye)("MSFT_sRGBFactors",!0,(async e=>{const{MSFT_sRGBFactors:t}=await Promise.all([o.e(4915),o.e(67),o.e(9944)]).then(o.bind(o,9944));return new t(e)})),(0,We.Ye)("KHR_node_visibility",!0,(async e=>{const{KHR_node_visibility:t}=await o.e(4624).then(o.bind(o,4624));return new t(e)})),(0,We.Ye)("KHR_node_hoverability",!0,(async e=>{const{KHR_node_hoverability:t}=await o.e(9064).then(o.bind(o,9064));return new t(e)})),(0,Ue.qS)({...Ge.M,createPlugin:async()=>{const{OBJFileLoader:e}=await Promise.all([o.e(4915),o.e(7954)]).then(o.bind(o,7954));return new e}}),(0,Ue.qS)({...ze.B,createPlugin:async e=>{const{SPLATFileLoader:t}=await Promise.all([o.e(4915),o.e(9913)]).then(o.bind(o,9913));return new t(e[ze.B.name])}}),(0,Ue.qS)({...He.W,createPlugin:async()=>{const{STLFileLoader:e}=await Promise.all([o.e(4915),o.e(3101)]).then(o.bind(o,3101));return new e}})}function qe(e){return function(t){if(function(e){return c(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Qe(e,t,i,s,r){return new Ke(e,t,i,s,r)}var Ke=function(e){function t(t,i,s,r,n,o){var a=e.call(this,t)||this;return a.onFinalize=n,a.shouldUnsubscribe=o,a._next=i?function(e){try{i(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=r?function(e){try{r(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=s?function(){try{s()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return i(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;e.prototype.unsubscribe.call(this),!i&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(M);function Ye(e,t){return qe((function(i,s){var r=0;i.subscribe(Qe(s,(function(i){return e.call(t,i,r++)&&s.next(i)})))}))}var je=new V((function(e){return e.complete()}));function Ze(e){return e<=0?function(){return je}:qe((function(t,i){var s=0;t.subscribe(Qe(i,(function(t){++s<=e&&(i.next(t),e<=s&&i.complete())})))}))}function $e(){return new le}function Je(e,t){var i=arguments.length>=2;return function(s){return s.pipe(e?Ye((function(t,i){return e(t,i,s)})):U,Ze(1),i?function(e){return qe((function(t,i){var s=!1;t.subscribe(Qe(i,(function(e){s=!0,i.next(e)}),(function(){s||i.next(e),i.complete()})))}))}(t):(void 0===(r=function(){return new le})&&(r=$e),qe((function(e,t){var i=!1;e.subscribe(Qe(t,(function(e){i=!0,t.next(e)}),(function(){return i?t.complete():t.error(r())})))}))));var r}}var et,tt=o(3846);class it{constructor(e,t,i,s){this._offsetDragState=new Q(!1),this._offsetPointerPosition=new X,this._pointerStartScreenPosition=void 0,this._overlayUIBlocks=!1,this._allInteractiveMeshes=new Set,this._dragOffsetEnabled=!1,this._scene=e??(()=>{throw new Z("'scene' is required")})(),this._log=t,this._defaultPointerOffset=i??{x:0,y:0},this._dragPointerOffset=s??{x:0,y:0},this._currentPointerOffset=this._defaultPointerOffset;const r=new rt("Idle",this,t),n=new nt("TouchOnObjectWithStationarySupport",this,t),o=new ot("StationaryOnObject",this,t),a=new at("TouchOnObject",this,t),h=new lt("TouchWithoutObject",this,t),l=new ht("TouchOnUI",this,t);this._stateById=new Map([[et.Idle,r],[et.TouchOnObjectWithStationarySupport,n],[et.StationaryOnObject,o],[et.TouchOnObject,a],[et.TouchWithoutObject,h],[et.TouchStartedOnUIObject,l]])}get offsetDragState(){return this._offsetDragState}get offsetPointerPosition(){return this._offsetPointerPosition}get pointerOffset(){return this._currentPointerOffset}setDragOffsetEnabled(e){this._currentPointerOffset=e?this._dragPointerOffset:this._defaultPointerOffset,this._dragOffsetEnabled=e,this._offsetDragState.next(e)}get pointerDownScreenPosition(){return this._pointerStartScreenPosition}get lastPointerInfo(){return this._lastPointerInfo}clickOnObject(e,t){e.notifiables.notifyClicked(t)}get activeObject(){return this._currentObjectUnderPointer}get overlayUIBlocks(){return this._overlayUIBlocks}set overlayUIBlocks(e){this._overlayUIBlocks!==e&&(this._log.debug(`Overlay block: ${e}`),this._overlayUIBlocks=e)}start(){const e=this;this.isMobile,this._scene.onPrePointerObservable.add((t=>{e._lastPointerInfo=t,t.type===tt.Zp.POINTERDOWN?(e._pointerStartScreenPosition={x:t.localPosition.x,y:t.localPosition.y},e.onPointerEvent(t)):t.type===tt.Zp.POINTERUP&&e.onPointerEvent(t)})),this._scene.onPointerObservable.add((t=>{e._lastPointerInfo=t,e.onPointerEvent(t)})),this.enterState(et.Idle)}registerFullScreenUI(e){if(this._fullScreenUIObservable)throw new Z("Only one full screen observable is allowed");this._fullScreenUIObservable=e,e.isUIControlUnderPointer.subscribe((e=>{e&&this._currentObjectUnderPointer&&(this._log.debug("Leave current object (UI interception)"),this.leaveCurrentObject()),this.overlayUIBlocks=e}))}registerMeshInteractive(e){if(!e)throw new Z("Can't registered null or undefined mesh");if(this._allInteractiveMeshes.has(e))throw new Z(`Trying to register interactive mesh '${e.name}' twice`);if(e.mesh.metadata?.meshInteractive)throw new Z(`Trying to register mesh '${e.name}' twice`);this._allInteractiveMeshes.add(e),e.mesh.metadata={meshInteractive:e},e.disposed.pipe(Je()).subscribe((()=>{this.onMeshInteractiveDisposed(e)}))}setEventsCamera(e){this._eventsCamera=e}onMeshInteractiveDisposed(e){this._allInteractiveMeshes.delete(e)}onPointerEvent(e){if(this._currentState?.handlePointerEvent(e),e.type===tt.Zp.POINTERMOVE&&this._dragOffsetEnabled){const e=this._scene.pointerX+this._dragPointerOffset.x,t=this._scene.pointerY+this._dragPointerOffset.y;this._offsetPointerPosition.next({x:e,y:t})}}leaveCurrentObject(e){this._currentObjectUnderPointer&&(this.notifyPointerLeave(this._currentObjectUnderPointer,e),this._log.trace(`Left interactive mesh: [${this._currentObjectUnderPointer.name}]`),this._currentObjectUnderPointer=void 0)}enterObject(e,t){this._currentObjectUnderPointer=e,this.notifyPointerEnter(e,t),this._log.trace(`Entered [${e.name}]`)}tryPickInteractiveObject(e){const t=[this._scene.pointerX+this._currentPointerOffset.x,this._scene.pointerY+this._currentPointerOffset.y],i=this._scene.pick(t[0],t[1],this.filterMeshInteractive.bind(this),!0,this._eventsCamera).pickedMesh;return this.getInteractiveObjectForMesh(i)}notifyPointerEnter(e,t){e.notifiables.notifyPointerEnter(t)}notifyPointerLeave(e,t){e.notifiables.notifyPointerExit(t)}filterMeshInteractive(e,t){const i=this.getInteractiveObjectForMesh(e);return!!i&&i.interactive}get isMobile(){return this._scene.getEngine().hostInformation.isMobile}getInteractiveObjectForMesh(e){if(e)return e.metadata?.meshInteractive}enterState(e){this._currentState&&(this._currentState.exit(),this._currentStateOnNextSubscription?.unsubscribe(),this._currentStateOnNextSubscription=void 0);const t=this._stateById.get(e)??(()=>{throw new Z(`State instance for id '${e}' is not defined`)})();this._currentState=t,this._currentStateOnNextSubscription=this._currentState.onNext.subscribe((e=>{this.enterState(e)})),t.enter()}}!function(e){e.Idle="Idle",e.TouchOnObjectWithStationarySupport="TouchOnObjectWithStationarySupport",e.StationaryOnObject="StationaryOnObject",e.TouchOnObject="TouchBeginOnObject",e.TouchWithoutObject="TouchBeginWithoutObject",e.TouchStartedOnUIObject="TouchStartedOnUIObject",e.DraggingChip="DraggingChip"}(et||(et={}));class st{constructor(e,t,i){this._onNext=new X,this.name=e,this.log=i,this.context=t}enter(){this.assertInactive("Can't enter state"),this.log.trace(`[ISSM] Entering '${this.name}'`),this._isActive=!0,this._nextState=void 0,this.onEnter()}exit(){this.assertActive("Can't exit state"),this.log.trace(`[ISSM] Leaving '${this.name}'`),this._isActive=!1,this.onExit()}get onNext(){return this._onNext}goTo(e){if(this.assertActive("Can't go to another state"),this._nextState)throw new Z(`State [${this.name}] error: can't transition to state '${e}' since state transition to state '${this._nextState}' is already initiated`);this._nextState=e,this._onNext.next(e)}assertActive(e){if(!this._isActive)throw new Z(`State [${this.name}] error: ${e}. Reason: state is not currently active`)}assertInactive(e){if(this._isActive)throw new Z(`State [${this.name}] error: ${e}. Reason: state is currently active`)}}class rt extends st{handlePointerEvent(e){switch(e.type){case tt.Zp.POINTERDOWN:{if(this.context.overlayUIBlocks){this.goTo(et.TouchStartedOnUIObject);break}const t=this.context.tryPickInteractiveObject(e);t?(this.context.isMobile&&this.context.enterObject(t,e),t.notifiables.notifyPointerDown(e),t.stationaryTouchSettings?this.goTo(et.TouchOnObjectWithStationarySupport):this.goTo(et.TouchOnObject)):this.goTo(et.TouchWithoutObject);break}case tt.Zp.POINTERMOVE:{if(this.context.overlayUIBlocks)return;const t=this.context.tryPickInteractiveObject(e);t?(t!==this.context.activeObject&&(this.context.leaveCurrentObject(e),this.context.enterObject(t,e)),t.notifiables.notifyPointerMove(e)):this.context.leaveCurrentObject(e);break}}}onEnter(){if(this.context.setDragOffsetEnabled(!1),this.context.isMobile)return;if(!this.context.lastPointerInfo)return;const e=this.context.lastPointerInfo;if(this.context.overlayUIBlocks)return;const t=this.context.tryPickInteractiveObject(e);t&&(this.context.leaveCurrentObject(e),this.context.enterObject(t,e))}onExit(){}}class nt extends st{handlePointerEvent(e){switch(e.type){case tt.Zp.POINTERUP:this.context.activeObject&&(this.context.clickOnObject(this.context.activeObject,e),this.context.leaveCurrentObject(e)),this.goTo(et.Idle);break;case tt.Zp.POINTERMOVE:{if(this.context.overlayUIBlocks)return;const t=this.context.tryPickInteractiveObject(e);t?(t!==this.context.activeObject&&(this.context.leaveCurrentObject(e),this.context.enterObject(t,e),this.context.setDragOffsetEnabled(!0),this.goTo(et.TouchOnObject)),t.notifiables.notifyPointerMove(e)):(this.context.leaveCurrentObject(e),this.goTo(et.TouchWithoutObject));break}}}onEnter(){if(!this.context.activeObject||!this.context.activeObject.stationaryTouchSettings)return this.log.error("There is no active object under the pointer. Should not be in stationary state."),void this.goTo(et.TouchWithoutObject);const e=this.context.activeObject,t=this.context.activeObject.stationaryTouchSettings.stationaryTouchTimeoutMS;this._stationaryTimeout=setTimeout((()=>{e.notifiables.notifyPointerStationary(this.context.lastPointerInfo),this.goTo(et.StationaryOnObject)}),t)}goTo(e){this.clearStationaryTimeout(),super.goTo(e)}onExit(){this.clearStationaryTimeout()}clearStationaryTimeout(){this._stationaryTimeout&&(clearTimeout(this._stationaryTimeout),this._stationaryTimeout=void 0)}}class ot extends st{handlePointerEvent(e){e.type===tt.Zp.POINTERUP&&(this.context.leaveCurrentObject(e),this.goTo(et.Idle))}onEnter(){}onExit(){}}class at extends st{handlePointerEvent(e){switch(e.type){case tt.Zp.POINTERUP:this.context.activeObject&&(this.context.clickOnObject(this.context.activeObject),this.context.leaveCurrentObject(e)),this.goTo(et.Idle);break;case tt.Zp.POINTERMOVE:{if(this.context.overlayUIBlocks)return;const t=this.context.tryPickInteractiveObject(e);t?(t!==this.context.activeObject&&(this.context.leaveCurrentObject(e),this.context.enterObject(t,e),this.context.setDragOffsetEnabled(!0)),t.notifiables.notifyPointerMove(e),t.stationaryTouchSettings&&this.goTo(et.TouchOnObjectWithStationarySupport)):(this.context.leaveCurrentObject(e),this.goTo(et.TouchWithoutObject));break}}}onEnter(){}onExit(){}}class ht extends st{handlePointerEvent(e){e.type===tt.Zp.POINTERUP&&(this.context.activeObject&&(this.log.debug(`Clicking on active object: ${this.context.activeObject.name}`),this.context.clickOnObject(this.context.activeObject),this.context.leaveCurrentObject(e)),this.goTo(et.Idle))}onEnter(){}onExit(){}}class lt extends st{handlePointerEvent(e){switch(e.type){case tt.Zp.POINTERUP:this.goTo(et.Idle);break;case tt.Zp.POINTERMOVE:{if(this.context.overlayUIBlocks)return;const t=this.context.tryPickInteractiveObject(e);t&&(this.context.enterObject(t,e),t.stationaryTouchSettings?this.goTo(et.TouchOnObjectWithStationarySupport):this.goTo(et.TouchOnObject));break}}}onEnter(){this.context.setDragOffsetEnabled(!0)}onExit(){}}class ct{constructor(e,t){this._interactive=!0,this._disposed=!1,this._disposedSubject=new X,this._name=e,this._reactive=new dt,this._stationaryTouchSettings=t?.stationaryTouchSettings}get stationaryTouchSettings(){return this._stationaryTouchSettings}get observables(){return this._reactive}get notifiables(){return this._reactive}get name(){return this._name}get disposed(){return this._disposedSubject}dispose(){this._disposed||(this._disposedSubject.next(),this.cleanUp())}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e,this.onInteractiveChanged(e))}cleanUp(){}onInteractiveChanged(e){}}class ut extends ct{constructor(e,t,i){super(e,i),this._mesh=t??(()=>{throw new Error("'mesh' is required")})(),this.onInteractiveChanged(!0)}onInteractiveChanged(e){this._mesh.isPickable=e}get mesh(){return this._mesh}}class dt{constructor(){this._onPointerEnter=new X,this._onPointerExit=new X,this._onPointerDown=new X,this._onPointerUp=new X,this._onPointerMove=new X,this._onPointerStationary=new X,this._onClicked=new X}notifyPointerEnter(e){this._onPointerEnter.next(e)}notifyPointerExit(e){this._onPointerExit.next(e)}notifyPointerDown(e){this._onPointerDown.next(e)}notifyPointerUp(e){this._onPointerUp.next(e)}notifyPointerMove(e){this._onPointerMove.next(e)}notifyPointerStationary(e){this._onPointerStationary.next(e)}notifyClicked(e){this._onClicked.next(e)}get onPointerEnter(){return this._onPointerEnter}get onPointerExit(){return this._onPointerExit}get onPointerDown(){return this._onPointerDown}get onPointerUp(){return this._onPointerUp}get onPointerMove(){return this._onPointerMove}get onPointerStationary(){return this._onPointerStationary}get onClicked(){return this._onClicked}}class _t{constructor(e){this._interactiveSystem=e??(()=>{throw new Error("'interactiveSystem' is required")})()}createMeshInteractive(e,t,i){const s=new ut(e,t,i);return this._interactiveSystem.registerMeshInteractive(s),s}}class pt{constructor(e){this.name=e}}pt.Hover=new pt("Hover"),pt.Selected=new pt("Selected"),pt.WinningSpot=new pt("WinningNumber");var gt=o(4049),ft=o(6863),mt=o(6486),bt=o(451);class vt{}vt.WheelSpinSpeedRadPerSec=2*Math.PI/5,vt.BallRadius=.014,vt.BallStopDetectionTimeS=1,vt.WheelStopDurationS=2;class Tt{constructor(){}}Tt.MaxRenderingGroups=6,Tt.Default=0,Tt.Felt=1,Tt.Field=2,Tt.FieldHighlight=3,Tt.Chips=4,Tt.FieldText=5;class yt{constructor(e){this._subscription=e}dispose(){this._subscription.unsubscribe()}}const xt={w:2560,h:1284};var At,Ct,St,Et=o(4754),Rt=o(4537),Pt=o(1425),It=o(3039),Mt=o(766),wt=o(2596),Ot=o(7638),Bt=o(3550),Dt=o(35),Ft=o(5686),Lt=o(879),Nt=o(5923),kt=o(8042),Ut=o(5241),Vt=o(979);class Gt extends wt.M{constructor(){super(),this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.GAMMADIFFUSE=!1,this.DIFFUSEHASALPHA=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONBLUR=!1,this.REFLECTIONFRESNEL=!1,this.REFLECTIONFALLOFF=!1,this.TEXTURELODSUPPORT=!1,this.PREMULTIPLYALPHA=!1,this.USERGBCOLOR=!1,this.USEHIGHLIGHTANDSHADOWCOLORS=!1,this.BACKMAT_SHADOWONLY=!1,this.NOISE=!1,this.REFLECTIONBGR=!1,this.PROJECTED_GROUND=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.EQUIRECTANGULAR_RELFECTION_FOV=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.UV1=!1,this.UV2=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.SHADOWFLOAT=!1,this.LOGARITHMICDEPTH=!1,this.NONUNIFORMSCALING=!1,this.ALPHATEST=!1,this.rebuild()}}class zt extends Ot.E{get _perceptualColor(){return this.__perceptualColor}set _perceptualColor(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()}get primaryColorShadowLevel(){return this._primaryColorShadowLevel}set primaryColorShadowLevel(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()}get primaryColorHighlightLevel(){return this._primaryColorHighlightLevel}set primaryColorHighlightLevel(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()}set reflectionStandardFresnelWeight(e){let t=e;t<.5?(t*=2,this.reflectionReflectance0=zt.StandardReflectance0*t,this.reflectionReflectance90=zt.StandardReflectance90*t):(t=2*t-1,this.reflectionReflectance0=zt.StandardReflectance0+(1-zt.StandardReflectance0)*t,this.reflectionReflectance90=zt.StandardReflectance90+(1-zt.StandardReflectance90)*t)}get fovMultiplier(){return this._fovMultiplier}set fovMultiplier(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsImageProcessingDirty()}))))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this.imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this.imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this.imageProcessingConfiguration.colorCurves=e}constructor(e,t,i=!1){super(e,t,void 0,i),this.primaryColor=bt.v9.White(),this._primaryColorShadowLevel=0,this._primaryColorHighlightLevel=0,this.reflectionTexture=null,this.reflectionBlur=0,this.diffuseTexture=null,this._shadowLights=null,this.shadowLights=null,this.shadowLevel=0,this.sceneCenter=gt.Pq.Zero(),this.opacityFresnel=!0,this.reflectionFresnel=!1,this.reflectionFalloffDistance=0,this.reflectionAmount=1,this.reflectionReflectance0=.05,this.reflectionReflectance90=.5,this.useRGBColor=!0,this.enableNoise=!1,this._fovMultiplier=1,this.useEquirectangularFOV=!1,this._maxSimultaneousLights=4,this.maxSimultaneousLights=4,this._shadowOnly=!1,this.shadowOnly=!1,this._imageProcessingObserver=null,this.switchToBGR=!1,this._enableGroundProjection=!1,this.enableGroundProjection=!1,this.projectedGroundRadius=1e3,this.projectedGroundHeight=10,this._renderTargets=new Pt.L(16),this._reflectionControls=gt.IU.Zero(),this._white=bt.v9.White(),this._primaryShadowColor=bt.v9.Black(),this._primaryHighlightColor=bt.v9.Black(),this._shadersLoaded=!1,this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._renderTargets.push(this._diffuseTexture),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._renderTargets)}get hasRenderTargetTextures(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)}needAlphaTesting(){return!0}needAlphaBlending(){return this.alpha<1||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||this._shadowOnly}isReadyForSubMesh(e,t,i=!1){const s=t._drawWrapper;if(s.effect&&this.isFrozen&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new Gt);const r=this.getScene(),n=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const a=r.getEngine();if((0,Ut.az)(r,e,n,!1,this._maxSimultaneousLights),n._needNormals=!0,(0,Ut.VO)(r,n),n._areTexturesDirty){if(n._needUVs=!1,r.texturesEnabled){if(r.getEngine().getCaps().textureLOD&&(n.TEXTURELODSUPPORT=!0),this._diffuseTexture&&Lt.h.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,Ut.YT)(this._diffuseTexture,n,"DIFFUSE"),n.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,n.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,n.OPACITYFRESNEL=this._opacityFresnel}else n.DIFFUSE=!1,n.DIFFUSEDIRECTUV=0,n.DIFFUSEHASALPHA=!1,n.GAMMADIFFUSE=!1,n.OPACITYFRESNEL=!1;const e=this._reflectionTexture;if(e&&Lt.h.ReflectionTextureEnabled){if(!e.isReadyOrNotBlocking())return!1;switch(n.REFLECTION=!0,n.GAMMAREFLECTION=e.gammaSpace,n.RGBDREFLECTION=e.isRGBD,n.REFLECTIONBLUR=this._reflectionBlur>0,n.LODINREFLECTIONALPHA=e.lodLevelInAlpha,n.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,n.REFLECTIONBGR=this.switchToBGR,e.coordinatesMode===Dt.g.INVCUBIC_MODE&&(n.INVERTCUBICMAP=!0),n.REFLECTIONMAP_3D=e.isCube,n.REFLECTIONMAP_OPPOSITEZ=n.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!e.invertZ:e.invertZ,e.coordinatesMode){case Dt.g.EXPLICIT_MODE:n.REFLECTIONMAP_EXPLICIT=!0;break;case Dt.g.PLANAR_MODE:n.REFLECTIONMAP_PLANAR=!0;break;case Dt.g.PROJECTION_MODE:n.REFLECTIONMAP_PROJECTION=!0;break;case Dt.g.SKYBOX_MODE:n.REFLECTIONMAP_SKYBOX=!0;break;case Dt.g.SPHERICAL_MODE:n.REFLECTIONMAP_SPHERICAL=!0;break;case Dt.g.EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Dt.g.FIXED_EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Dt.g.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Dt.g.CUBIC_MODE:case Dt.g.INVCUBIC_MODE:default:n.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(n.REFLECTIONFRESNEL=!0,n.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(n.REFLECTIONFRESNEL=!1,n.REFLECTIONFALLOFF=!1)}else n.REFLECTION=!1,n.REFLECTIONFRESNEL=!1,n.REFLECTIONFALLOFF=!1,n.REFLECTIONBLUR=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1}n.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,n.USERGBCOLOR=this._useRGBColor,n.NOISE=this._enableNoise}if(n._areLightsDirty&&(n.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel),n.BACKMAT_SHADOWONLY=this._shadowOnly),n._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(n)}if(n._areMiscDirty&&(n.REFLECTIONMAP_3D&&this._enableGroundProjection?(n.PROJECTED_GROUND=!0,n.REFLECTIONMAP_SKYBOX=!0):n.PROJECTED_GROUND=!1),(0,Ut.fm)(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),n),(0,Ut.OR)(r,a,this,n,i,null,t.getRenderingMesh().hasThinInstances),(0,Ut.qB)(e,n,!1,!0,!1)&&e&&(r.getEngine().getCaps().standardDerivatives||e.isVerticesDataPresent(Mt.R.NormalKind)||(e.createNormals(!0),It.V.Warn("BackgroundMaterial: Normals have been created for the mesh: "+e.name))),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();const i=new Nt.J;n.FOG&&i.addFallback(0,"FOG"),n.POINTSIZE&&i.addFallback(1,"POINTSIZE"),n.MULTIVIEW&&i.addFallback(0,"MULTIVIEW"),(0,Ut.c4)(n,i,this._maxSimultaneousLights);const s=[Mt.R.PositionKind];n.NORMAL&&s.push(Mt.R.NormalKind),n.UV1&&s.push(Mt.R.UVKind),n.UV2&&s.push(Mt.R.UV2Kind),(0,Ut.ni)(s,e,n,i),(0,Ut.ER)(s,n);const h=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix","projectedGroundInfos","logarithmicDepthConstant"];(0,kt.TV)(h);const l=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],c=["Material","Scene"];Bt.p&&(Bt.p.PrepareUniforms(h,n),Bt.p.PrepareSamplers(l,n)),(0,Ut.Bb)({uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:n,maxSimultaneousLights:this._maxSimultaneousLights});const u=n.toString(),d=r.getEngine().createEffect("background",{attributes:s,uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:u,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights},shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([o.e(8699),o.e(1102)]).then(o.bind(o,1102)),Promise.all([o.e(9676),o.e(4851)]).then(o.bind(o,4851))]):await Promise.all([o.e(7836).then(o.bind(o,7836)),Promise.all([o.e(2988),o.e(2363)]).then(o.bind(o,2363))]),this._shadersLoaded=!0}},a);t.setEffect(d,n,this._materialContext),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),s._wasPreviouslyReady=!0,s._wasPreviouslyUsingInstances=i,this._checkScenePerformancePriority(),0))}_computePrimaryColorFromPerceptualColor(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor,this.getScene().getEngine().useExactSrgbConversions),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())}_computePrimaryColors(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))}buildUniformLayout(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.addUniform("projectedGroundInfos",2),this._uniformBuffer.create()}unbind(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),super.unbind()}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindForSubMesh(e,t,i){const s=this.getScene(),r=i.materialDefines;if(!r)return;const n=i.effect;if(!n)return;this._activeEffect=n,this.bindOnlyWorldMatrix(e),(0,Ut.f$)(t,this._activeEffect);const o=this._mustRebind(s,n,i,t.visibility);if(o){this._uniformBuffer.bindToEffect(n,"Material"),this.bindViewProjection(n);const e=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync&&!i._drawWrapper._forceRebindOnNextCall||(s.texturesEnabled&&(this._diffuseTexture&&Lt.h.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,Ut.mA)(this._diffuseTexture,this._uniformBuffer,"diffuse")),e&&Lt.h.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",e.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",e.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",e.getSize().width,e.lodGenerationScale,e.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),r.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),s.texturesEnabled&&(this._diffuseTexture&&Lt.h.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),e&&Lt.h.ReflectionTextureEnabled&&(r.REFLECTIONBLUR&&r.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",e):r.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",e._lodTextureMid||e),this._uniformBuffer.setTexture("reflectionSamplerLow",e._lodTextureLow||e),this._uniformBuffer.setTexture("reflectionSamplerHigh",e._lodTextureHigh||e)):this._uniformBuffer.setTexture("reflectionSampler",e),r.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w))),r.PROJECTED_GROUND&&this._uniformBuffer.updateFloat2("projectedGroundInfos",this.projectedGroundRadius,this.projectedGroundHeight)),(0,kt.gS)(this._activeEffect,this,s),s.bindEyePosition(n)}else s.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._uniformBuffer.bindToEffect(n,"Material"),this._needToBindSceneUbo=!0);!o&&this.isFrozen||(s.lightsEnabled&&(0,Ut.RL)(s,t,this._activeEffect,r,this._maxSimultaneousLights),this.bindView(n),(0,Ut.Yy)(s,t,this._activeEffect,!0),this._useLogarithmicDepth&&(0,Ut.DL)(r,n,s),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect,i),this._uniformBuffer.update()}hasTexture(e){return!!super.hasTexture(e)||this._reflectionTexture===e||this._diffuseTexture===e}dispose(e=!1,t=!1){t&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e)}clone(e){return Vt.p.Clone((()=>new zt(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.BackgroundMaterial",e}getClassName(){return"BackgroundMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new zt(e.name,t)),e,t,i)}}zt.StandardReflectance0=.05,zt.StandardReflectance90=.5,(0,Et.Cg)([(0,Rt.jT)()],zt.prototype,"_primaryColor",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsLightsDirty")],zt.prototype,"primaryColor",void 0),(0,Et.Cg)([(0,Rt.jT)()],zt.prototype,"__perceptualColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_primaryColorShadowLevel",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_primaryColorHighlightLevel",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsLightsDirty")],zt.prototype,"primaryColorHighlightLevel",null),(0,Et.Cg)([(0,Rt.uM)()],zt.prototype,"_reflectionTexture",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"reflectionTexture",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_reflectionBlur",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"reflectionBlur",void 0),(0,Et.Cg)([(0,Rt.uM)()],zt.prototype,"_diffuseTexture",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"diffuseTexture",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"shadowLights",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_shadowLevel",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"shadowLevel",void 0),(0,Et.Cg)([(0,Rt.P_)()],zt.prototype,"_sceneCenter",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"sceneCenter",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_opacityFresnel",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"opacityFresnel",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_reflectionFresnel",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"reflectionFresnel",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_reflectionFalloffDistance",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"reflectionFalloffDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_reflectionAmount",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"reflectionAmount",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_reflectionReflectance0",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"reflectionReflectance0",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_reflectionReflectance90",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"reflectionReflectance90",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_useRGBColor",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"useRGBColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_enableNoise",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"enableNoise",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_maxSimultaneousLights",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],zt.prototype,"maxSimultaneousLights",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"_shadowOnly",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsLightsDirty")],zt.prototype,"shadowOnly",void 0),(0,Et.Cg)([(0,Rt.n1)()],zt.prototype,"_imageProcessingConfiguration",void 0),(0,Et.Cg)([(0,Rt.lK)(),(0,Rt.$z)("_markAllSubMeshesAsMiscDirty")],zt.prototype,"enableGroundProjection",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"projectedGroundRadius",void 0),(0,Et.Cg)([(0,Rt.lK)()],zt.prototype,"projectedGroundHeight",void 0),(0,Ft.Y5)("BABYLON.BackgroundMaterial",zt);class Ht{constructor(){this._locks=new Set,this._locked=new Q(!1)}lock(e){const t=new Xt(e,(()=>{this._locks.delete(t),0===this._locks.size&&this._locked.next(!1)}));return this._locks.add(t),1===this._locks.size&&this._locked.next(!0),t}get lockedObservable(){return this._locked}get isLocked(){return this._locked.value}getLockNames(){return[...this._locks.values()].map((e=>e.name))}}class Wt{constructor(){this._locks=new Map,this._locked=new Q(!1)}get(e){let t=this._locks.get(e);return t||(t=new Ht,this._locks.set(e,t),t.lockedObservable.subscribe((e=>{this.updateLockedStatus()}))),t}isLocked(e){return this.get(e).isLocked}lockedObservable(e){return this.get(e).lockedObservable}lock(e,t){return this.get(e).lock(t)}get locked(){return this._locked}updateLockedStatus(){let e=!1;for(const t of this._locks.values())if(t.isLocked){e=!0;break}this._locked.value!==e&&this._locked.next(e)}}class Xt{constructor(e,t){this._disposed=!1,this.name=e,this._release=t}dispose(){this._disposed||(this._disposed=!0,this._release())}}class qt{constructor(){this._isDisposed=!1,this._disposables=new Set,this._self=this}add(e){if(!e)throw new Error("'disposable' can not be null");if(e===this._self)throw new Error("'Can not add itself'");Array.isArray(e)?e.forEach((e=>this._disposables.add(e))):this._disposables.add(e)}dispose(){this._isDisposed||(this._disposables.forEach((e=>{e.dispose()})),this._isDisposed=!0)}}!function(e){e.Red="Red",e.Black="Black",e.None="None"}(At||(At={})),function(e){e[e.Wheel=2]="Wheel",e[e.Table=4]="Table",e[e.GUI=8]="GUI",e[e.FieldText=16]="FieldText",e[e.PiPOnly=32]="PiPOnly"}(Ct||(Ct={}));class Qt{constructor(){this._tickables=new Set}register(e){const t="tick"in e?e:new Kt(e);if(this._tickables.has(t))throw new Error("Can't register the same tickable multiple times");return this._tickables.add(t),new Yt(t,this.unregister.bind(this))}tick(e){0!=this._tickables.size&&[...this._tickables].forEach((t=>{t.tick(e)}))}unregister(e){this._tickables.delete(e)}}class Kt{constructor(e){this._tickableLambda=e}tick(e){this._tickableLambda(e)}}class Yt{constructor(e,t){this._tickable=e,this._unregister=t}dispose(){this._unregister(this._tickable)}}class jt{constructor(e,t){this._decoree=e,this._timeScale=t}setTimeScale(e){this._timeScale=e}tick(e){this._decoree.tick(e*this._timeScale)}}class Zt{constructor(e,t,i){this._lastFrames=[],this._pointer=0,this._decoree=e,this._framesNumber=t,this._maxDeltaTimeS=i}tick(e){if(void 0!==this._maxDeltaTimeS&&(e=Math.min(e,this._maxDeltaTimeS)),0===this._lastFrames.length)for(let t=0;t<this._framesNumber;t++)this._lastFrames.push(e);else this._pointer=(this._pointer+1)%this._framesNumber,this._lastFrames[this._pointer]=e;let t=this._lastFrames.reduce(((e,t)=>e+t),0)/this._framesNumber;void 0!==this._maxDeltaTimeS&&this._maxDeltaTimeS<t&&(t=this._maxDeltaTimeS),this._decoree.tick(t)}}class $t{}$t.linear=e=>e,$t.easeInQuad=e=>Math.pow(e,2),$t.easeOutQuad=e=>-(Math.pow(e-1,2)-1),$t.easeInOutQuad=e=>(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2),$t.easeInCubic=e=>Math.pow(e,3),$t.easeOutCubic=e=>Math.pow(e-1,3)+1,$t.easeInOutCubic=e=>(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2),$t.easeInQuart=e=>Math.pow(e,4),$t.easeOutQuart=e=>-(Math.pow(e-1,4)-1),$t.easeInOutQuart=e=>(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),$t.easeInQuint=e=>Math.pow(e,5),$t.easeOutQuint=e=>Math.pow(e-1,5)+1,$t.easeInOutQuint=e=>(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2),$t.easeInSine=e=>1-Math.cos(e*(Math.PI/2)),$t.easeOutSine=e=>Math.sin(e*(Math.PI/2)),$t.easeInOutSine=e=>-.5*(Math.cos(Math.PI*e)-1),$t.easeInExpo=e=>0===e?0:Math.pow(2,10*(e-1)),$t.easeOutExpo=e=>1===e?1:1-Math.pow(2,-10*e),$t.easeInOutExpo=e=>0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e)),$t.easeInCirc=e=>-(Math.sqrt(1-e*e)-1),$t.easeOutCirc=e=>Math.sqrt(1-Math.pow(e-1,2)),$t.easeInOutCirc=e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),$t.easeOutBounce=e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,$t.easeInBack=e=>{const t=1.70158;return e*e*((t+1)*e-t)},$t.easeOutBack=e=>{const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},$t.easeInOutBack=e=>{let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},$t.elastic=e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,$t.easeOutElastic=function(e){const t=2*Math.PI/3;return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1},$t.swingFromTo=e=>{let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},$t.swingFrom=e=>{const t=1.70158;return e*e*((t+1)*e-t)},$t.swingTo=e=>{const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},$t.bounce=e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,$t.bouncePast=e=>e<1/2.75?7.5625*e*e:e<2/2.75?2-(7.5625*(e-=1.5/2.75)*e+.75):e<2.5/2.75?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375),$t.easeFromTo=e=>(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),$t.easeFrom=e=>Math.pow(e,4),$t.easeTo=e=>Math.pow(e,.25);class Jt{static init(e){if(!this._tickableRegistration){const t=new Kt((e=>{St.update(1e3*e)}));this._tickableRegistration=e.register(t)}}static tweening(){return this.tweens.length>0}static dispose(){this._tickableRegistration&&(this._tickableRegistration.dispose(),this._tickableRegistration=void 0,this.tweens=[])}static add(e,t,i){this.assertInitialized();const s=e.target,r=Object.assign({},...Object.keys(t).map((e=>({[e]:s[e]})))),n=Object.assign({},...Object.keys(t).map((e=>({[e]:t[e]-r[e]})))),o=e.useTickForDuration?e.duration:1e3*e.duration;return new Promise((a=>{const h=new qt,l={duration:o,useTickForDuration:!!e.useTickForDuration,ease:e.ease||$t.linear,target:e.target,delay:e.delay?1e3*e.delay:0,currentTime:0,props:t,propDeltas:n,startingProps:r,onComplete:()=>{h.dispose(),a()},timescale:e.timescale??1,onUpdate:e.onUpdate||void 0,context:e.context||s};if(i){if(i.aborted){const e=i.reason??ei.Default;return void this.completeTween(l,e.skipComplete,e.jumpToEnd)}{const e=()=>{const e=i.reason??ei.Default;this.tweens=this.tweens.filter((e=>e!==l)),this.completeTween(l,e.skipComplete,e.jumpToEnd)};i.addEventListener("abort",e),h.add({dispose:()=>{i.removeEventListener("abort",e)}})}}this.tweens.push(l)}))}static getTweensOf(e){this.assertInitialized();const t=[];return this.tweens.forEach((i=>{i.context!==e&&i.target!==e||t.push(i)})),t}static killTweensOf(e,t=!1,i=!0){this.assertInitialized();const s=[];this.tweens.forEach((r=>{r.context===e||r.target===e?this.completeTween(r,t,i):s.push(r)})),this.tweens=s}static advance(e){let t=!1;for(const i of this.tweens){let s=i.useTickForDuration?1:e;if(s*=i.timescale,i.delay>0){if(i.delay-=s,!(i.delay<=0))continue;s=-i.delay}i.currentTime+=s;const r=Math.min(1,i.currentTime/i.duration);this.updateTween(i,r),i.currentTime>=i.duration&&(i.onComplete(),t=!0)}t&&(this.tweens=this.tweens.filter((e=>e.currentTime<e.duration)))}static updateTween(e,t){const i=e.ease(t);for(const t of Object.keys(e.props))e.target[t]=e.startingProps[t]+i*e.propDeltas[t];e.onUpdate&&e.onUpdate(t)}static completeTween(e,t=!1,i=!0){i&&(this.updateTween(e,1),e.currentTime=e.duration),t||e.onComplete()}static assertInitialized(){if(!this._tickableRegistration)throw new Z("Tweener is not initialized. Tweener.init() should be called before calling it's API")}}St=Jt,Jt.tweens=[],Jt.update=e=>St.advance(e);class ei{constructor(e){this.skipComplete=e?.skipComplete??!1,this.jumpToEnd=e?.jumpToEnd??!1}}ei.Default=new ei,ei.JumpToEnd=new ei({skipComplete:!1,jumpToEnd:!0});class ti{constructor(e,t){this.abort=e,this.skip=t}get isAborted(){return this.abort.aborted}get isSkipped(){return this.skip.aborted}static GetAborted(e){return new ti(AbortSignal.abort(e),ti._nullAbortSignal)}static GetSkipped(e){return new ti(ti._nullAbortSignal,AbortSignal.abort(e))}static GetNone(){return new ti(ti._nullAbortSignal,ti._nullAbortSignal)}static WithAbortSignal(e){return new ti(e,ti._nullAbortSignal)}static WithSkipSignal(e){return new ti(ti._nullAbortSignal,e)}}ti._nullAbortSignal=(new AbortController).signal;class ii{constructor(){this._abortController=new AbortController,this._skipController=new AbortController,this._signal=new ti(this._abortController.signal,this._skipController.signal)}get signal(){return this._signal}abort(e){this._abortController.abort(e)}skip(e){this._skipController.abort(e)}}class si{static init(e){if(this._isInitialized)throw new Z("Already initialized");this._isInitialized=!0,e.register((e=>{this.tick(e)}))}static isAbortError(e){return e instanceof ee||e instanceof ei||"AbortError"===e?.name}static tick(e){for(let t=this._delays.length-1;t>=0;t--){const i=this._delays[t];i.tick(e),i.completed&&this._delays.splice(t,1)}}static Delay(e,t){if(!this._isInitialized)throw new Z("czrAsync should be initialized with czrAsync.init() call");const i=new ni(e/1e3,t);return this._delays.push(i),i.promise}constructor(){}}si._isInitialized=!1,si._delays=[];class ri{constructor(e,t,i){this._id=i??"<NO ID>",this._state="Pending";const s=this._abortController=new AbortController,r=t?AbortSignal.any([t,s.signal]):s.signal;this.promise=e(r),this.promise.then((()=>{"Pending"===this._state&&(this._state="Completed")})).catch((e=>{si.isAbortError(e)&&(this._state="Aborted")}))}async abort(e){if("Pending"==this._state){this._state="Aborted",this._abortController.abort(e);try{await this.promise}catch(e){if(!si.isAbortError(e))throw e}}}}class ni{constructor(e,t){this._completed=!1;const i=this;this._promise=new Promise(((e,t)=>{i._resolve=t=>{i._completed=!0,e(t)},i._reject=e=>{i._completed=!0,t(e)}})),t?t instanceof ti?(this._abortSignal=t.abort,this._skipSignal=t.skip):this._abortSignal=this._skipSignal=t:(this._abortSignal=void 0,this._skipSignal=void 0),this._remainingIntervalS=e}tick(e){this._completed||(this._skipSignal?.aborted?this._resolve():this._abortSignal?.aborted?this._reject(this._abortSignal.reason):(this._remainingIntervalS-=e,this._remainingIntervalS<=0&&this._resolve()))}get promise(){return this._promise}get completed(){return this._completed}}class oi{static tick(e){this._promises.forEach((t=>{t.tick(1e3*e)}))}static track(e,t){const i=new ai(t);this._promises.add(i),e.finally((()=>{this._promises.delete(i)}))}static getPendingPromises(){return[...this._promises.values()]}}oi._promises=new Set;class ai{constructor(e){this.name=e,this._runningTimeMS=0}tick(e){this._runningTimeMS+=e}get runningTimeMS(){return this._runningTimeMS}}var hi,li,ci,ui=o(8243),di=function(e,t,i){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})};class _i{}_i.Mesh=(di(hi=class{},"Mesh"),hi.Prefix_HitZone="HitZone",hi.Prefix_NumberGraphics="NumberGraphics",hi.Prefix_TableFelt="TableFelt_",hi.TableField_L="TableField_Landscape",hi.TableField_P="TableField_Portrait",hi.TableField_BG="TableField_BG",hi.Prefix_TableArmRest="TableArmRest_",hi.Prefix_TableTopPrefix="TableTop",hi.Prefix_Carpet="Carpet",hi.Emblem_CPO="Head",hi.Emblem_HSO="Horseshoe",hi.Emblem_SBK="Chalice",hi),_i.TransformNode=(di(li=class{},"TransformNode"),li.ChipStacksContainer="PlacedChipsStacks",li.TableRoot_Landscape="TableLandscapeRoot",li.TableRoot_Portrait="TablePortraitRoot",li.TableRootNode="RouletteTable",li.TableFelt="TableFelt",li.TableFeltRoot_Landscape="TableFeltLandscape",li.TableFeltRoot_Portrait="TableFeltPortrait",li.TableArmrest="TableArmRest",li.TableArmrest_Landscape="TableArmRestLandscape",li.TableArmrest_Portrait="TableArmRestPortrait",li.TableTop="TableTop",li.TableTopLandscape="TableTopLandscape",li.TableTopPortrait="TableTopPortrait",li.Carpet="Carpet",li.CarpetLandscape="CarpetLandscape",li.CarpetPortrait="CarpetPortrait",li.Wheel="Wheel",li),_i.Cameras=(di(ci=class{},"Cameras"),ci.MainCamera_Landscape="MainCamera_Landscape",ci);class pi{static async create(e,t,i){const s=new pi(e,i);return await ce(s.ready.pipe(Ye((e=>!0===e)))),t.register(s),s}constructor(e,t){this._ready=new Q(!1),this._betSpotsHighlightLocksByType=new Map,this._numbersHighlightLocksByType=new Map,this._betSpotClicked=new X,this._betSpotPointerEnter=new X,this._betSpotPointerExit=new X,this._betSpotPointerStationary=new X,this._hitZones=[];const i=this;this._log=e.log;const s=e.rouletteSceneContainer.scene;this._defaultHitZoneParams=e.defaultHitZoneParams;const r=[],n=new Set,o=t.load(e.brandedAssets.carpetTextureId,{noMipMaps:!0,invertY:!1});r.push(o);const a=(e,t)=>{n.has(e)||(n.add(e),r.push(e.forceCompilationAsync(t).then((()=>{this._log.debug(`Material: ${e.name} compilation complete`)}))))},h=new ft.F("hit-zone-transparent",s);h.alpha=0;const l=new Map,c=new Map,u=new mt.Y("hover-highligh");u.albedoColor=new bt.v9(1,1,1),u.unlit=!0,u.alpha=.5;const d=new mt.Y("winning-number-highligh-black");d.albedoColor=bt.v9.FromInts(255,196,0).toLinearSpace(!0),d.unlit=!0,d.alpha=.5;const _=new mt.Y("winning-number-highligh-red");let p,g,f,m,b,v,T,y,x,A;_.albedoColor=bt.v9.FromInts(255,196,0).toLinearSpace(!0),_.unlit=!0,_.alpha=.75,this._highlightAnimator=new mi([{material:d,minAlpha:.2,maxAlpha:.5},{material:_,minAlpha:.2,maxAlpha:.75}]),this._highlightAnimator.start();const C=this._landscapeLayout=new fi,S=this._portraitLayout=new fi;let E=null,R=null,P=null,I=null,M=null,w=null;e.rouletteSceneContainer.textures.forEach((e=>{e.wrapU=ui.Y.TEXTURE_CLAMP_ADDRESSMODE,e.wrapV=ui.Y.TEXTURE_CLAMP_ADDRESSMODE})),e.rouletteSceneContainer.transformNodes.forEach((e=>{_i.TransformNode.ChipStacksContainer===e.name?p=e:_i.TransformNode.TableRootNode===e.name?(g=e,g.getChildMeshes().forEach((e=>{e.renderingGroupId=Tt.Field}))):_i.TransformNode.TableRoot_Landscape===e.name?f=e:_i.TransformNode.TableRoot_Portrait===e.name?m=e:_i.TransformNode.TableFelt===e.name?b=e:_i.TransformNode.TableFeltRoot_Landscape===e.name?v=e:_i.TransformNode.TableFeltRoot_Portrait===e.name?T=e:_i.TransformNode.TableArmrest===e.name?y=e:_i.TransformNode.TableArmrest_Landscape===e.name?x=e:_i.TransformNode.TableArmrest_Portrait===e.name?A=e:_i.TransformNode.Wheel===e.name?e.getChildMeshes(!1).forEach((e=>{e.layerMask=Ct.Wheel})):_i.TransformNode.Carpet===e.name?P=e:_i.TransformNode.CarpetLandscape===e.name?E=e:_i.TransformNode.CarpetPortrait===e.name?R=e:_i.TransformNode.TableTop===e.name?w=e:_i.TransformNode.TableTopLandscape===e.name?I=e:_i.TransformNode.TableTopPortrait===e.name&&(M=e)}));const O=(e,t)=>{if(!e)throw new Z(`Transform node '${t}' was not found`);return e};this._chipStacksParent=p=O(p,_i.TransformNode.ChipStacksContainer),this._fieldRootNode=g=O(g,_i.TransformNode.TableRootNode),this._fieldRootNode.setParent(null),this._armrestNode=O(y,_i.TransformNode.TableArmrest),this._armrestRootLandscape=O(x,_i.TransformNode.TableArmrest_Landscape),this._armrestRootPortrait=O(A,_i.TransformNode.TableArmrest_Portrait),this._feltNode=O(b,_i.TransformNode.TableArmrest),this._feltRootLandscape=O(v,_i.TransformNode.TableFeltRoot_Landscape),this._feltRootPortrait=O(T,_i.TransformNode.TableFeltRoot_Portrait),f=O(f,_i.TransformNode.TableRoot_Landscape),m=O(m,_i.TransformNode.TableRoot_Portrait);const B=[];this._fieldTransformPerOrientation=new Map([[ue.landscape,{position:f.absolutePosition.clone(),rotation:f.absoluteRotationQuaternion.clone()}],[ue.portrait,{position:m.absolutePosition.clone(),rotation:m.absoluteRotationQuaternion.clone()}]]);const D=new Set([z.Dozen,z.Column,z.Even,z.Odd,z.Red,z.Black,z.Low,z.High]),F=[];let L,N,k,U,V;if(e.rouletteSceneContainer.meshes.forEach((t=>{t.layerMask!==Ct.Wheel&&(t.layerMask=Ct.Table);const i=t.material;i&&(["Gold_Inside","Gold_Handle","Gold_Emblem","Base_Black"].includes(i.name)&&(i.reflectionTexture=e.skyboxTexture,i.reflectionTexture.coordinatesMode=Dt.g.PLANAR_MODE,i.albedoColor=bt.v9.FromInts(255,237,202).toLinearSpace()),"Base_Black"===i.name?(V=i,i.metallic=1,i.indexOfRefraction=1.1,i.roughness=0,i.albedoColor=bt.v9.FromInts(3,29,74).toLinearSpace(),i.baseWeight=.3,i.clearCoat.isEnabled=!1):(i.roughness=0,i.indexOfRefraction=1.5,i.clearCoat.isEnabled=!0,i.clearCoat.intensity=.39,i.clearCoat.roughness=.39,i.clearCoat.indexOfRefraction=1));const r=this.parseBetHitZoneName(t.name,e.numSet);if(r){t.isVisible=!1,t.material=h,a(h,t),t.renderingGroupId=Tt.FieldHighlight;const i=e.interactiveMeshFactory.createMeshInteractive(t.name,t,this._defaultHitZoneParams),s=this.getBetSpot(r.type,e.betOptions,r.payload);if(!s)throw new Z(`Could not find bet spot for hit zone ${i.mesh.name}`);this.initBetHitZone(i,s),F.push({hitZone:i,betSpot:s});const n=D.has(s.type),o=new gi(t,{hover:n?u:h,winning:n?d:h});if(a(u,t),a(d,t),c.set(s,o),s.type===z.StraightUp){const e=s.numbers[0];this.initNumberGraphics(t,{hover:u,winning:e.color===At.Red?_:d},e,l),a(_,t)}}else if(t.name===_i.Mesh.TableField_L||t.name===_i.Mesh.TableField_P){t.name===_i.Mesh.TableField_L?k=t:U=t,t.renderingGroupId=Tt.Field;const e=new zt("field",s);a(e,t);const i=t.material;if(i.disableLighting=!0,i){const s=i.albedoTexture;s&&(s.hasAlpha=!0,e.diffuseTexture=s,e.alphaMode=Me.N.ALPHA_COMBINE,t.material=e,t.isPickable=!1)}}else if(t.name.startsWith(_i.Mesh.Prefix_TableFelt))L||(L=new zt("SharedTableFeltMaterial",s),a(L,t),L.alphaMode=2,N=t),t.material=L;else if(t.name.startsWith(_i.Mesh.Prefix_TableArmRest))t.renderingGroupId=Tt.Felt;else if(t.name===_i.Mesh.TableField_BG){const e=t.material;e.alphaMode=4,t.renderingGroupId=Tt.Felt,a(e,t)}else t.name.startsWith(_i.Mesh.Prefix_TableTopPrefix)||(t.name===_i.Mesh.Emblem_CPO?t.setEnabled("cpo"===e.brand):t.name===_i.Mesh.Emblem_HSO?t.setEnabled("hso"===e.brand):t.name===_i.Mesh.Emblem_SBK?t.setEnabled("sbk"===e.brand):t.name.startsWith(_i.Mesh.Prefix_Carpet)&&B.push(t))})),o.then((e=>{B.forEach((t=>{const i=t.material;i&&(i.emissiveTexture=e)}))})),!L)throw new Z("No shared felt material found");if(this._sharedFeltMaterial=L,this._sharedArmRestMaterial=void 0,this._hitZones=F,this._numberGraphicsMap=l,this._highlightedBetSpotsGraphicsMap=c,this._tableFieldLandscape=k??(()=>{throw new Z("Landscape table field was not found")})(),this._tableFieldPortrait=U??(()=>{throw new Z("Portrait table field was not found")})(),this._feltMesh=N??(()=>{throw new Z("Felt mesh was not found")})(),e.rouletteSceneContainer.scene.stopAllAnimations(),e.rouletteSceneContainer.addAllToScene(),"hso"===e.brand&&e.brandedAssets?.hso){const i=V;if(i){const s=e.brandedAssets.hso.woodBaseTextureId,n=t.load(s).then((e=>{i.albedoTexture=e,i.roughness=0,i.albedoColor=bt.v9.White()}));r.push(n)}}const G=e=>{if(!e)return 999999999;switch(e.type){case z.Corner:return 0;case z.Split:return 1;case z.Street:case z.Basket:case z.SixLine:return 0;case z.StraightUp:return 100;default:return 10}};s.pointerMovePredicate=()=>!1,s.pointerDownPredicate=()=>!1,s.pointerUpPredicate=()=>!1,s.meshes.sort(((t,i)=>{const s=this.parseBetHitZoneName(t.name,e.numSet),r=this.parseBetHitZoneName(i.name,e.numSet);return G(s)-G(r)})),Promise.all(r).then((()=>{this._ready.next(!0)}));const H=i._fieldTransformPerOrientation.get(ue.landscape)??(()=>{throw new Z(`Can't get field transform info for orientation [${ue.landscape}]`)})(),W=i._fieldTransformPerOrientation.get(ue.portrait)??(()=>{throw new Z(`Can't get field transform info for orientation [${ue.portrait}]`)})();w=O(w,_i.TransformNode.TableTop),I=O(I,_i.TransformNode.TableTopLandscape),M=O(M,_i.TransformNode.TableTopPortrait),P=O(P,_i.TransformNode.Carpet),E=O(E,_i.TransformNode.CarpetLandscape),R=O(R,_i.TransformNode.CarpetPortrait),C.add((()=>{i._tableFieldLandscape.isVisible=!0,i._tableFieldPortrait.isVisible=!1,i._fieldRootNode.scaling=gt.Pq.OneReadOnly,i._fieldRootNode.setAbsolutePosition(H.position),i._fieldRootNode.rotationQuaternion=H.rotation,i._feltNode.setParent(i._feltRootLandscape),i._feltNode.position=gt.Pq.Zero(),i._feltNode.rotationQuaternion=gt.PT.Identity(),i._feltNode.scaling=gt.Pq.One(),i._armrestNode.setParent(i._armrestRootLandscape),i._armrestNode.position=gt.Pq.Zero(),i._armrestNode.rotationQuaternion=gt.PT.Identity(),i._armrestNode.scaling=gt.Pq.One(),w&&(w.setParent(I),w.position=gt.Pq.Zero(),w.rotationQuaternion=gt.PT.Identity(),w.scaling=gt.Pq.One()),P&&(P.setParent(E),P.position=gt.Pq.Zero(),P.rotationQuaternion=gt.PT.Identity(),P.scaling=gt.Pq.One())})),S.add((()=>{i._tableFieldLandscape.isVisible=!1,i._tableFieldPortrait.isVisible=!0,i._fieldRootNode.scaling=new gt.Pq(1.3,1,1),i._fieldRootNode.setAbsolutePosition(W.position),i._fieldRootNode.rotationQuaternion=W.rotation,i._feltNode.setParent(i._feltRootPortrait),i._feltNode.position=gt.Pq.Zero(),i._feltNode.rotationQuaternion=gt.PT.Identity(),i._feltNode.scaling=gt.Pq.One(),i._armrestNode.setParent(i._armrestRootPortrait),i._armrestNode.position=gt.Pq.Zero(),i._armrestNode.rotationQuaternion=gt.PT.Identity(),i._armrestNode.scaling=gt.Pq.One(),w&&(w.setParent(M),w.position=gt.Pq.Zero(),w.rotationQuaternion=gt.PT.Identity(),w.scaling=gt.Pq.One()),P&&(P.setParent(R),P.position=gt.Pq.Zero(),P.rotationQuaternion=gt.PT.Identity(),P.scaling=gt.Pq.One())}))}get ready(){return this._ready}setArmRestTexture(e){}setFeltTexture(e){return this._sharedFeltMaterial.diffuseTexture=e,e.hasAlpha=!0,this._sharedFeltMaterial.forceCompilationAsync(this._feltMesh)}onResize(e){e.previousOrientation!==e.orientation&&(e.orientation===ue.landscape?this._landscapeLayout.apply():this._portraitLayout.apply())}getAbsolutePositionForBet(e){const t=this._highlightedBetSpotsGraphicsMap.get(e)?.mesh;if(!t)throw new Z(`Not hit zone found for bet '${e}'`);t.position;const i=t.getWorldMatrix();return gt.Pq.TransformCoordinates(gt.Pq.ZeroReadOnly,i)}highlightBetSpots(e,t,i){const s=new qt;return e.forEach((e=>{s.add(this.addBetSpotHighlight(e,t,t.name)),i&&s.add(this.highlightNumbers(e.numbers,t))})),s}highlightNumbers(e,t){const i=new qt;return e.forEach((e=>{i.add(this.addNumberHighlight(e,t,t.name))})),i}addBetSpotHighlight(e,t,i){const s=this.getBetSpotHighlightTypeLock(t);let r=s.get(e);return r||(r=new Wt,r.locked.subscribe((i=>{this.setBetSpotHighlightActive(e,t,i)})),s.set(e,r)),r.get(t).lock(i)}setBetSpotHighlightActive(e,t,i){const s=this._highlightedBetSpotsGraphicsMap.get(e);s&&s.setHighlight(t,i)}addNumberHighlight(e,t,i){const s=this.getNumberHighlightTypeLock(t);let r=s.get(e);return r||(r=new Wt,r.locked.subscribe((i=>{this.setNumberHighlightActive(e,t,i)})),s.set(e,r)),r.get(t).lock(i)}getBetSpotHighlightTypeLock(e){let t=this._betSpotsHighlightLocksByType.get(e);return t||(t=new Map,this._betSpotsHighlightLocksByType.set(e,t)),t}getNumberHighlightTypeLock(e){let t=this._numbersHighlightLocksByType.get(e);return t||(t=new Map,this._numbersHighlightLocksByType.set(e,t)),t}setNumberHighlightActive(e,t,i){const s=this._numberGraphicsMap.get(e);s&&s.setHighlight(t,i)}get betSpotClicked(){return this._betSpotClicked}get betSpotPointerEnter(){return this._betSpotPointerEnter}get betSpotPointerExit(){return this._betSpotPointerExit}get betSpotPointerStationary(){return this._betSpotPointerStationary}getChipsStackPosition(e){throw new Z("Method not implemented.")}activate(){this._hitZones.forEach((e=>{e.hitZone.interactive=!0}))}deactivate(){this._hitZones.forEach((e=>{e.hitZone.interactive=!1}))}getChipsStacksParent(){return this._chipStacksParent}initBetHitZone(e,t){this.activateBetSpot(e,t)}getBetSpot(e,t,i){const s=i;switch(e){case z.StraightUp:return t.StraightUp.withRouletteNumber(s[0]);case z.Split:return t.Split.getWithNumbers(s[0],s[1]);case z.Street:return t.Street.getWithNumbers(s[0],s[1],s[2]);case z.Corner:return t.Corner.getWithNumbers(s);case z.Basket:return t.Basket;case z.SixLine:return t.SixLine.getWithNumbers(s);case z.Black:return t.RedBlack.Black;case z.Red:return t.RedBlack.Red;case z.Low:return t.LowHigh.Low;case z.High:return t.LowHigh.High;case z.Even:return t.OddEven.Even;case z.Odd:return t.OddEven.Odd;case z.Column:if(void 0===i)throw new Error("Column id is not specified");return t.Column.Columns[+i];case z.Dozen:if(void 0===i)throw new Error("Dozen id is not specified");return t.Dozen.Dozens[+i];default:throw new Error(`Unsupported bet type ${e}`)}}activateBetSpot(e,t){e.observables.onPointerEnter.subscribe((()=>{this._betSpotPointerEnter.next(t)})),e.observables.onPointerExit.subscribe((()=>{this._betSpotPointerExit.next(t)})),e.observables.onPointerStationary.subscribe((()=>{this._betSpotPointerStationary.next(t)})),e.observables.onClicked.subscribe((e=>{e?.event.button?this._betSpotPointerStationary.next(t):this._betSpotClicked.next(t)}))}parseNumbersString(e,t,i){return e.map((e=>this.getNumById(e,t)))}getNumById(e,t){return"00"===e?t.N00:"0"===e?t.N0:t.getWithValue(+e)}initNumberGraphics(e,t,i,s){const r=new gi(e,t);s.set(i,r)}parseBetHitZoneName(e,t){if(!e.startsWith(_i.Mesh.Prefix_HitZone))return null;const i="_",s=e.split(i);if(1===s.length)return null;switch(s[1]){case"Straight":return{type:z.StraightUp,payload:this.parseNumbersString(s.slice(2),t,i)};case"Split":return{type:z.Split,payload:this.parseNumbersString(s.slice(2),t,i)};case"Street":return{type:z.Street,payload:this.parseNumbersString(s.slice(2),t,i)};case"Corner":return{type:z.Corner,payload:this.parseNumbersString(s.slice(2),t,i)};case"Basket":return{type:z.Basket};case"SixLine":return{type:z.SixLine,payload:this.parseNumbersString(s.slice(2),t,i)};case"Red":return{type:z.Red};case"Black":return{type:z.Black};case"Low":return{type:z.Low};case"High":return{type:z.High};case"Even":return{type:z.Even};case"Odd":return{type:z.Odd};case"Column":return{type:z.Column,payload:+s[2]};case"Dozen":return{type:z.Dozen,payload:+s[2]};default:return null}}}class gi{constructor(e,t){this._highlighStates=new Map,this._mesh=e,this._originalMaterial=e.material,this._hoverMaterial=t.hover,this._winningSpotMaterial=t.winning}setHighlight(e,t){this._highlighStates.set(e,t),this._highlighStates.get(pt.WinningSpot)?(this._mesh.material=this._winningSpotMaterial,this._mesh.isVisible=!0):this._highlighStates.get(pt.Hover)||this._highlighStates.get(pt.Selected)?(this._mesh.material=this._hoverMaterial,this._mesh.isVisible=!0):(this._mesh.material=this._originalMaterial,this._mesh.isVisible=!1)}get mesh(){return this._mesh}}class fi{constructor(){this._actions=[]}apply(){this._actions.forEach((e=>{e()}))}add(e){this._actions.push(e)}}class mi{constructor(e){this._startRequested=!1,this._materials=e,this._currentTween=null}async start(){if(this._startRequested)return;this._startRequested=!0,this._currentTween&&await this._currentTween.abort(ei.JumpToEnd);const e=this,t=this._materials;t.forEach((e=>{e.material.alpha=e.minAlpha}));const i={_progress:0,get progress(){return this._progress},set progress(e){this._progress=e,t.forEach((t=>{const i=t.material,s=t.minAlpha,r=t.maxAlpha-s;i.alpha=s+r*e}))}},s=this._currentTween=new ri((t=>new Promise((r=>{const n=async()=>(await Jt.add({target:i,duration:.8,ease:$t.easeInOutSine},{progress:1},t),t.aborted?(s===e._currentTween&&(e._currentTween=null),void r()):(await Jt.add({target:i,duration:1.2,ease:$t.easeInOutSine},{progress:0},t),t.aborted?(s===e._currentTween&&(e._currentTween=null),void r()):void n()));n()}))));this._startRequested=!1}stop(){this._currentTween&&(this._currentTween.abort(ei.JumpToEnd),this._currentTween=null)}}class bi{constructor(e,t,i){this._name=e,this._value=t,this._color=i}get name(){return this._name}get value(){return this._value}get color(){return this._color}equals(e){return e===this||e instanceof bi&&e._name===this._name&&e._value===this.value&&e._color===this._color}toString(){return`${this.name}`}}class vi{static resolve(e){if(e!=K.DOUBLE_ZERO_ID&&(e<0||e>K.MAX_NUMBER))throw new RangeError(`Number ${e} is not a valid roulette number. Must be between 0 and ${K.MAX_NUMBER} or be ${K.DOUBLE_ZERO_ID} for a double zero`);return 0==e||e==K.DOUBLE_ZERO_ID?At.None:e<=10||e>=19&&e<=28?e%2==0?At.Black:At.Red:e%2==1?At.Black:At.Red}constructor(){}}class Ti{constructor(){this._numbers=[],this.N0=this.define(0),this.N00=this.define(100,"00"),this.N1=this.define(1),this.N2=this.define(2),this.N3=this.define(3),this.N4=this.define(4),this.N5=this.define(5),this.N6=this.define(6),this.N7=this.define(7),this.N8=this.define(8),this.N9=this.define(9),this.N10=this.define(10),this.N11=this.define(11),this.N12=this.define(12),this.N13=this.define(13),this.N14=this.define(14),this.N15=this.define(15),this.N16=this.define(16),this.N17=this.define(17),this.N18=this.define(18),this.N19=this.define(19),this.N20=this.define(20),this.N21=this.define(21),this.N22=this.define(22),this.N23=this.define(23),this.N24=this.define(24),this.N25=this.define(25),this.N26=this.define(26),this.N27=this.define(27),this.N28=this.define(28),this.N29=this.define(29),this.N30=this.define(30),this.N31=this.define(31),this.N32=this.define(32),this.N33=this.define(33),this.N34=this.define(34),this.N35=this.define(35),this.N36=this.define(36)}getZeroBasedSequenceClockwise(t){switch(t){case e.SingleZero:return[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26].map((e=>this.getWithValue(e)));case e.DoubleZero:return[0,28,9,26,30,11,7,20,32,17,5,22,34,15,3,24,36,13,1,100,27,10,25,29,12,8,19,31,18,6,21,33,16,4,23,35,14,2].map((e=>this.getWithValue(e)));default:throw new Error("Unsipported game type: "+t)}}getAllNumbersForGameType(t){switch(t){case e.SingleZero:return[this.N0,...this.AllNonZero];case e.DoubleZero:return[this.N0,this.N00,...this.AllNonZero];default:throw new Error("Unsipported game type: "+t)}}get AllNonZero(){return this._numbers.filter((e=>e.value>0&&e.value<=36))}get AllRed(){return this._numbers.filter((e=>e.color===At.Red))}get AllBlack(){return this._numbers.filter((e=>e.color===At.Black))}get AllLow(){return this.AllNonZero.filter((e=>e.value>=1&&e.value<=18))}get AllHigh(){return this.AllNonZero.filter((e=>e.value>=19))}get AllEven(){return this.AllNonZero.filter((e=>e.value%2==0))}get AllOdd(){return this.AllNonZero.filter((e=>e.value%2==1))}get Column1(){return this.AllNonZero.filter((e=>e.value%3==1))}get Column2(){return this.AllNonZero.filter((e=>e.value%3==2))}get Column3(){return this.AllNonZero.filter((e=>e.value%3==0))}get Dozen1(){return this.AllNonZero.filter((e=>e.value>=1&&e.value<=12))}get Dozen2(){return this.AllNonZero.filter((e=>e.value>=13&&e.value<=24))}get Dozen3(){return this.AllNonZero.filter((e=>e.value>=25&&e.value<=36))}getWithValue(e){let t;for(const i of this._numbers)if(i.value===e){t=i;break}if(!t)throw new Error(`Roulette number "${e}" is not defined in set`);return t}define(e,t){let i=t??`#${e}`;if(this._numbers.some((e=>e.name==i)))throw new Z(`Duplicated number name "${i}"`);const s=vi.resolve(e),r=new bi(i,e,s);return this._numbers.push(r),r}}class yi{constructor(e){this.validateNumbers(e),this._numbers=e,this._typeScopeUID=this.calculateTypeScopeUID(e)}get typeScropeUID(){return this._typeScopeUID}get numbers(){return this._numbers}validateNumbers(e){if(!e)throw new Error("Numbers array can not be null");e.forEach((e=>{if(!e)throw new Error("Numbers array can not contain null values")}))}contains(e){if(e instanceof bi)return this._numbers.some((t=>t.equals(e)));for(let t=0;t<e.length;t++){const i=e[t];if(!this._numbers.some((e=>e.equals(i))))return!1}return!0}toString(){return`Type: ${this.type}, Numbers: ${this._numbers.join(",")}`}}class xi extends yi{calculateTypeScopeUID(){return 0}get type(){return z.Basket}constructor(e,t,i,s,r){super([e,t,i,s,r])}}class Ai extends yi{calculateTypeScopeUID(){return 0}get type(){return z.Black}}class Ci extends yi{calculateTypeScopeUID(){return 0}get type(){return z.Red}}class Si{constructor(e,t){this.Red=e,this.Black=t}static generate(e){return new Si(new Ci(e.AllRed),new Ai(e.AllBlack))}}class Ei extends yi{calculateTypeScopeUID(){return this.columnIndex}get type(){return z.Column}get columnIndex(){if(this.numbers.find((e=>1===e.value)))return 0;if(this.numbers.find((e=>2===e.value)))return 1;if(this.numbers.find((e=>3===e.value)))return 2;throw new Z("Invalid column bet spot")}}class Ri{constructor(){}static verify(e){const t=new Set;e.forEach((e=>{if(t.has(e.typeScropeUID))throw new Z(`Duplicated UID ${e.typeScropeUID} for type ${e.type}`);t.add(e.typeScropeUID)}))}}class Pi{constructor(e,t,i){this.Columns=[e,t,i],Ri.verify(this.Columns)}static generate(e){return new Pi(new Ei(e.Column1),new Ei(e.Column2),new Ei(e.Column3))}getWithUID(e){return this.Columns.find((t=>t.typeScropeUID===e))??(()=>{throw new Z(`Column bet with uid ${e} was not found`)})()}}class Ii extends yi{calculateTypeScopeUID(e){return Math.min(...e.map((e=>e.value)))}constructor(e,t,i,s){super([e,t,i,s])}get type(){return z.Corner}}class Mi{constructor(e){this._options=e,Ri.verify(e)}getAll(){return this._options}getWithNumbers(e){return this._options.find((t=>t.contains(e)))??(()=>{throw new Error(`No corner with numbers [${e.join(", ")}] found`)})()}getWithUID(e){return this._options.find((t=>t.typeScropeUID===e))??(()=>{throw new Z(`Bet type ${Ii.name} and UID ${e} was not found`)})()}static generate(t,i){let s=[new Ii(t.N1,t.N2,t.N4,t.N5),new Ii(t.N2,t.N3,t.N5,t.N6),new Ii(t.N4,t.N5,t.N7,t.N8),new Ii(t.N5,t.N6,t.N8,t.N9),new Ii(t.N7,t.N8,t.N10,t.N11),new Ii(t.N8,t.N9,t.N11,t.N12),new Ii(t.N10,t.N11,t.N13,t.N14),new Ii(t.N11,t.N12,t.N14,t.N15),new Ii(t.N13,t.N14,t.N16,t.N17),new Ii(t.N14,t.N15,t.N17,t.N18),new Ii(t.N16,t.N17,t.N19,t.N20),new Ii(t.N17,t.N18,t.N20,t.N21),new Ii(t.N19,t.N20,t.N22,t.N23),new Ii(t.N20,t.N21,t.N23,t.N24),new Ii(t.N22,t.N23,t.N25,t.N26),new Ii(t.N23,t.N24,t.N26,t.N27),new Ii(t.N25,t.N26,t.N28,t.N29),new Ii(t.N26,t.N27,t.N29,t.N30),new Ii(t.N28,t.N29,t.N31,t.N32),new Ii(t.N29,t.N30,t.N32,t.N33),new Ii(t.N31,t.N32,t.N34,t.N35),new Ii(t.N32,t.N33,t.N35,t.N36)];switch(i){case e.SingleZero:s.push(new Ii(t.N0,t.N1,t.N2,t.N3));break;case e.DoubleZero:break;default:throw new Error(`Game type "${i}" is not suppored`)}return new Mi(s)}}class wi extends yi{calculateTypeScopeUID(){return this.dozenIndex}get type(){return z.Dozen}get dozenIndex(){if(this.numbers.find((e=>1===e.value)))return 0;if(this.numbers.find((e=>13===e.value)))return 1;if(this.numbers.find((e=>25===e.value)))return 2;throw new Z("Invalid Dozen bet spot")}}class Oi{constructor(e,t,i){this.Dozens=[e,t,i],Ri.verify(this.Dozens)}static generate(e){return new Oi(new wi(e.Dozen1),new wi(e.Dozen2),new wi(e.Dozen3))}getWithUID(e){return this.Dozens.find((t=>t.typeScropeUID===e))??(()=>{throw new Z(`Dozen bet with uid ${e} was not found`)})()}}class Bi extends yi{calculateTypeScopeUID(){return 0}get type(){return z.High}}class Di extends yi{calculateTypeScopeUID(){return 0}get type(){return z.Low}}class Fi{constructor(e,t){this.Low=e,this.High=t}static generate(e){return new Fi(new Di(e.AllLow),new Bi(e.AllHigh))}}class Li extends yi{calculateTypeScopeUID(){return 0}get type(){return z.Even}}class Ni extends yi{calculateTypeScopeUID(){return 0}get type(){return z.Odd}}class ki{constructor(e,t){this.Odd=e,this.Even=t}static generate(e){return new ki(new Ni(e.AllOdd),new Li(e.AllEven))}}class Ui extends yi{constructor(e,t,i,s,r,n){super([e,t,i,s,r,n])}get type(){return z.SixLine}calculateTypeScopeUID(e){return Math.min(...e.map((e=>e.value)))}}class Vi{static generate(e){return new Vi([new Ui(e.N1,e.N2,e.N3,e.N4,e.N5,e.N6),new Ui(e.N4,e.N5,e.N6,e.N7,e.N8,e.N9),new Ui(e.N7,e.N8,e.N9,e.N10,e.N11,e.N12),new Ui(e.N10,e.N11,e.N12,e.N13,e.N14,e.N15),new Ui(e.N13,e.N14,e.N15,e.N16,e.N17,e.N18),new Ui(e.N16,e.N17,e.N18,e.N19,e.N20,e.N21),new Ui(e.N19,e.N20,e.N21,e.N22,e.N23,e.N24),new Ui(e.N22,e.N23,e.N24,e.N25,e.N26,e.N27),new Ui(e.N25,e.N26,e.N27,e.N28,e.N29,e.N30),new Ui(e.N28,e.N29,e.N30,e.N31,e.N32,e.N33),new Ui(e.N31,e.N32,e.N33,e.N34,e.N35,e.N36)])}constructor(e){this._options=e,Ri.verify(e)}getAll(){return this._options}getWithNumbers(e){return this._options.find((t=>t.contains(e)))??(()=>{throw new Error(`SixLine bet with numbers [${e.join(", ")}]`)})()}getWithUID(e){return this._options.find((t=>t.typeScropeUID===e))??(()=>{throw new Z(`Bet type ${Ui.name} and UID ${e} was not found`)})()}}class Gi extends yi{constructor(e,t){super([e,t])}get type(){return z.Split}calculateTypeScopeUID(e){return e[0].value|e[1].value<<7}}class zi{constructor(e){this._splits=e,Ri.verify(e)}getAll(){return this._splits}getWithNumbers(e,t){const i=[e,t];return this._splits.find((e=>e.contains(i)))??(()=>{throw new Error(`Missing split for numbers ${e} and ${t}`)})()}getWithUID(e){return this._splits.find((t=>t.typeScropeUID===e))??(()=>{throw new Z(`Bet type ${Gi.name} and UID ${e} was not found`)})()}static generate(t,i){new Set;const s=new Map(t.AllNonZero.map((e=>[e.value,e])));let r=[];for(let e=1;e<K.MAX_NUMBER;e++){const{row:t,col:i}=Y.getNumberPosition(e),n=s.get(e)??(()=>{throw new Error(`No number found for value ${e}`)})();if(t<K.NUMBERS_PER_COLUMN-1){const t=e+K.NUMBERS_PER_ROW,i=s.get(t)??(()=>{throw new Error(`No number found for value ${t}`)})();r.push(new Gi(n,i))}if(i<K.NUMBERS_PER_ROW-1){const t=s.get(e+1)??(()=>{throw new Error(`No number found for value ${e+1}`)})();r.push(new Gi(n,t))}}switch(i){case e.SingleZero:r.push(new Gi(t.N0,t.N1)),r.push(new Gi(t.N0,t.N2)),r.push(new Gi(t.N0,t.N3));break;case e.DoubleZero:r.push(new Gi(t.N0,t.N00)),r.push(new Gi(t.N0,t.N1)),r.push(new Gi(t.N0,t.N2)),r.push(new Gi(t.N00,t.N2)),r.push(new Gi(t.N00,t.N3));break;default:throw new Error(`Unsupported game type "${i}"`)}return new zi(r)}}class Hi extends yi{calculateTypeScopeUID(e){return e[0].value}constructor(e){super([e])}get type(){return z.StraightUp}}class Wi{constructor(t,i){this._all=[],this.SingleZero=this.createBet(t.N0),e.DoubleZero===i&&(this.DoubleZero=this.createBet(t.N00)),this.N1=this.createBet(t.N1),this.N2=this.createBet(t.N2),this.N3=this.createBet(t.N3),this.N4=this.createBet(t.N4),this.N5=this.createBet(t.N5),this.N6=this.createBet(t.N6),this.N7=this.createBet(t.N7),this.N8=this.createBet(t.N8),this.N9=this.createBet(t.N9),this.N10=this.createBet(t.N10),this.N11=this.createBet(t.N11),this.N12=this.createBet(t.N12),this.N13=this.createBet(t.N13),this.N14=this.createBet(t.N14),this.N15=this.createBet(t.N15),this.N16=this.createBet(t.N16),this.N17=this.createBet(t.N17),this.N18=this.createBet(t.N18),this.N19=this.createBet(t.N19),this.N20=this.createBet(t.N20),this.N21=this.createBet(t.N21),this.N22=this.createBet(t.N22),this.N23=this.createBet(t.N23),this.N24=this.createBet(t.N24),this.N25=this.createBet(t.N25),this.N26=this.createBet(t.N26),this.N27=this.createBet(t.N27),this.N28=this.createBet(t.N28),this.N29=this.createBet(t.N29),this.N30=this.createBet(t.N30),this.N31=this.createBet(t.N31),this.N32=this.createBet(t.N32),this.N33=this.createBet(t.N33),this.N34=this.createBet(t.N34),this.N35=this.createBet(t.N35),this.N36=this.createBet(t.N36),Ri.verify(this._all)}get All(){return this._all}withValue(e){return this._all.find((t=>t.numbers[0].value==e))??(()=>{throw new Error(`Straight up bet for number ${e} is not defined`)})()}withRouletteNumber(e){return this._all.find((t=>t.numbers[0]===e))??(()=>{throw new Error(`Straight up bet for number ${e} is not defined`)})()}getWithUID(e){return this._all.find((t=>t.typeScropeUID===e))??(()=>{throw new Z(`Bet type ${Hi.name} and UID ${e} was not found`)})()}createBet(e){const t=new Hi(e);return this._all.push(t),t}}class Xi extends yi{constructor(e,t,i){super([e,t,i])}get type(){return z.Street}calculateTypeScopeUID(e){return e[0].value|e[1].value<<7|e[2].value<<14}}class qi{constructor(e){this._options=e,Ri.verify(e)}getAll(){return this._options}getWithNumbers(e,t,i){const s=[e,t,i];return this._options.find((e=>e.contains(s)))??(()=>{throw new Error(`Streen bet with numbers [${s.join(", ")}] is not defiend`)})()}getWithUID(e){return this._options.find((t=>t.typeScropeUID===e))??(()=>{throw new Z(`Bet type ${Xi.name} and UID ${e} was not found`)})()}static generate(t,i){let s=[new Xi(t.N1,t.N2,t.N3),new Xi(t.N4,t.N5,t.N6),new Xi(t.N7,t.N8,t.N9),new Xi(t.N10,t.N11,t.N12),new Xi(t.N13,t.N14,t.N15),new Xi(t.N16,t.N17,t.N18),new Xi(t.N19,t.N20,t.N21),new Xi(t.N22,t.N23,t.N24),new Xi(t.N25,t.N26,t.N27),new Xi(t.N28,t.N29,t.N30),new Xi(t.N31,t.N32,t.N33),new Xi(t.N34,t.N35,t.N36)];switch(i){case e.SingleZero:s.push(new Xi(t.N0,t.N1,t.N2),new Xi(t.N0,t.N2,t.N3));break;case e.DoubleZero:s.push(new Xi(t.N0,t.N1,t.N2),new Xi(t.N0,t.N00,t.N2),new Xi(t.N00,t.N2,t.N3))}return new qi(s)}}class Qi{get All(){const e=[];return e.push(...this.StraightUp.All,...this.Split.getAll(),...this.Street.getAll(),...this.Corner.getAll(),...this.SixLine.getAll(),this.RedBlack.Black,this.RedBlack.Red,this.LowHigh.Low,this.LowHigh.High,this.OddEven.Odd,this.OddEven.Even,...this.Column.Columns,...this.Dozen.Dozens),this.Basket&&e.push(this.Basket),e}constructor(t,i){this.StraightUp=new Wi(t,i),this.Split=zi.generate(t,i),this.Street=qi.generate(t,i),this.Corner=Mi.generate(t,i),this.SixLine=Vi.generate(t),this.RedBlack=Si.generate(t),this.LowHigh=Fi.generate(t),this.OddEven=ki.generate(t),this.Column=Pi.generate(t),this.Dozen=Oi.generate(t),e.DoubleZero==i&&(this.Basket=new xi(t.N0,t.N00,t.N1,t.N2,t.N3))}}class Ki{constructor(e){this._items=[],this._items=[],e&&this.add(e)}unsubscribe(){this._items.forEach((e=>e.unsubscribe())),this._items.length=0}add(e){Array.isArray(e)?this._items.push(...e):this._items.push(e)}}class Yi{constructor(e,t,i,s,r){this._betsPlaced=new X,this._betsRemoved=new X,this._hoverHighlightLockPerBetSpot=new Map,this._log=r,this._field=e,this._currentChip=t,this._betSpotHintController=i,this._placeBetWithMessage=s,this._compositeUnsub=new Ki([e.betSpotClicked.subscribe(this.onBetSpotClicked.bind(this)),e.betSpotPointerEnter.subscribe(this.onBetSpotPointerEnter.bind(this)),e.betSpotPointerExit.subscribe(this.onBetSpotPointerExit.bind(this)),e.betSpotPointerStationary.subscribe(this.onBetSpotPointerStationary.bind(this))])}get betPlaced(){return this._betsPlaced}get betRemoved(){return this._betsRemoved}enableBets(){this._field.activate()}disableBets(){this._field.deactivate()}dispose(){this._compositeUnsub.unsubscribe()}onBetSpotClicked(e){this._log.debug(`Clicked bet spot: ${e}`);const t=this._currentChip.centsValue;this._placeBetWithMessage.tryAddBet(e,t,!0)}onBetSpotPointerEnter(e){if(!this._hoverHighlightLockPerBetSpot.get(e)){const t=new qt;t.add(this._field.highlightBetSpots([e],pt.Hover)),t.add(this._field.highlightNumbers(e.numbers,pt.Hover)),this._hoverHighlightLockPerBetSpot.set(e,t)}}onBetSpotPointerExit(e){const t=this._hoverHighlightLockPerBetSpot.get(e);t&&(t.dispose(),this._hoverHighlightLockPerBetSpot.delete(e))}onBetSpotPointerStationary(e){this._betSpotHintController.show(e)}}class ji extends ae{}var Zi=o(3054),$i=o(9732);class Ji{}Ji.COPY=1,Ji.CUT=2,Ji.PASTE=3;class es{constructor(e,t){this.type=e,this.event=t}static GetTypeFromCharacter(e){switch(e){case 67:return Ji.COPY;case 86:return Ji.PASTE;case 88:return Ji.CUT;default:return-1}}}var ts=o(7904),is=o(1663),ss=o(8499),rs=o(3788);ss.ThinEngine.prototype.createDynamicTexture=function(e,t,i,s){const r=new rs.h(this,4);return r.baseWidth=e,r.baseHeight=t,i&&(e=this.needPOTTextures?(0,is.R)(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?(0,is.R)(t,this._caps.maxTextureSize):t),r.width=e,r.height=t,r.isReady=!1,r.generateMipMaps=i,r.samplingMode=s,this.updateTextureSamplingMode(s,r),this._internalTexturesCache.push(r),r},ss.ThinEngine.prototype.updateDynamicTexture=function(e,t,i,s=!1,r,n=!1,o=!1){if(!e)return;const a=this._gl,h=a.TEXTURE_2D,l=this._bindTextureDirectly(h,e,!0,n);this._unpackFlipY(void 0===i?e.invertY:i),s&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const c=this._getWebGLTextureType(e.type),u=this._getInternalFormat(r||e.format),d=this._getRGBABufferInternalSizedFormat(e.type,u);a.texImage2D(h,0,d,u,c,t),e.generateMipMaps&&a.generateMipmap(h),l||this._bindTextureDirectly(h,null),s&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),r&&(e.format=r),e._dynamicTextureSource=t,e._premulAlpha=s,e.invertY=i||!1,e.isReady=!0};class ns extends Dt.g{constructor(e,t,i,s=!1,r=3,n=5,o){const a=!i||i._isScene;super(null,a?i:i?.scene,a?!s:i,o,r,void 0,void 0,void 0,void 0,n),this.name=e,this.wrapU=Dt.g.CLAMP_ADDRESSMODE,this.wrapV=Dt.g.CLAMP_ADDRESSMODE,this._generateMipMaps=s;const h=this._getEngine();if(!h)return;if(t.getContext)this._canvas=t,this._ownCanvas=!1,this._texture=h.createDynamicTexture(this._canvas.width,this._canvas.height,s,r);else{this._canvas=h.createCanvas(1,1),this._ownCanvas=!0;const e=t;e.width||0===e.width?this._texture=h.createDynamicTexture(e.width,e.height,s,r):this._texture=h.createDynamicTexture(t,t,s,r)}const l=this.getSize();this._canvas.width!==l.width&&(this._canvas.width=l.width),this._canvas.height!==l.height&&(this._canvas.height=l.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)}scale(e){const t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)}scaleTo(e,t){const i=this.getSize();i.width=e,i.height=t,this._recreate(i)}getContext(){return this._context}clear(e){const t=this.getSize();e&&(this._context.fillStyle=e),this._context.clearRect(0,0,t.width,t.height)}update(e,t=!1,i=!1){this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0,void 0,i)}drawText(e,t,i,s,r,n,o,a=!0){const h=this.getSize();if(n&&(this._context.fillStyle=n,this._context.fillRect(0,0,h.width,h.height)),this._context.font=s,null==t){const i=this._context.measureText(e);t=(h.width-i.width)/2}if(null==i){const e=parseInt(s.replace(/\D/g,""));i=h.height/2+e/3.65}this._context.fillStyle=r||"",this._context.fillText(e,t,i),a&&this.update(o)}dispose(){super.dispose(),this._ownCanvas&&this._canvas?.remove?.(),this._canvas=null,this._context=null}clone(){const e=this.getScene();if(!e)return this;const t=this.getSize(),i=new ns(this.name,t,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i}serialize(){const e=this.getScene();e&&!e.isReady()&&It.V.Warn("The scene must be ready before serializing the dynamic texture");const t=super.serialize();return ns._IsCanvasElement(this._canvas)&&(t.base64String=this._canvas.toDataURL()),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t}static _IsCanvasElement(e){return void 0!==e.toDataURL}_rebuild(){this.update()}}var os=o(1497),as=o(4564),hs=o(4271);class ls{constructor(e){this.name=hs.v.NAME_LAYER,this.scene=e||os.q.LastCreatedScene,this.scene&&(this._engine=this.scene.getEngine())}register(){this.scene._beforeCameraDrawStage.registerStep(hs.v.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(hs.v.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForegroundWithPostProcessing),this.scene._afterCameraPostProcessStage.registerStep(hs.v.STEP_AFTERCAMERAPOSTPROCESS_LAYER,this,this._drawCameraForegroundWithoutPostProcessing),this.scene._beforeRenderTargetDrawStage.registerStep(hs.v.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(hs.v.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForegroundWithPostProcessing),this.scene._afterRenderTargetPostProcessStage.registerStep(hs.v.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER,this,this._drawRenderTargetForegroundWithoutPostProcessing)}rebuild(){const e=this.scene.layers;for(const t of e)t._rebuild()}dispose(){const e=this.scene.layers;for(;e.length;)e[0].dispose()}_draw(e){const t=this.scene.layers;if(t.length){this._engine.setDepthBuffer(!1);for(const i of t)e(i)&&i.render();this._engine.setDepthBuffer(!0)}}_drawCameraPredicate(e,t,i,s){return!e.renderOnlyInRenderTargetTextures&&e.isBackground===t&&e.applyPostProcess===i&&!!(e.layerMask&s)}_drawCameraBackground(e){this._draw((t=>this._drawCameraPredicate(t,!0,!0,e.layerMask)))}_drawCameraForegroundWithPostProcessing(e){this._draw((t=>this._drawCameraPredicate(t,!1,!0,e.layerMask)))}_drawCameraForegroundWithoutPostProcessing(e){this._draw((t=>this._drawCameraPredicate(t,!1,!1,e.layerMask)))}_drawRenderTargetPredicate(e,t,i,s,r){return e.renderTargetTextures.length>0&&e.isBackground===t&&e.applyPostProcess===i&&e.renderTargetTextures.indexOf(r)>-1&&!!(e.layerMask&s)}_drawRenderTargetBackground(e){this._draw((t=>this._drawRenderTargetPredicate(t,!0,!0,this.scene.activeCamera.layerMask,e)))}_drawRenderTargetForegroundWithPostProcessing(e){this._draw((t=>this._drawRenderTargetPredicate(t,!1,!0,this.scene.activeCamera.layerMask,e)))}_drawRenderTargetForegroundWithoutPostProcessing(e){this._draw((t=>this._drawRenderTargetPredicate(t,!1,!1,this.scene.activeCamera.layerMask,e)))}addFromContainer(e){e.layers&&e.layers.forEach((e=>{this.scene.layers.push(e)}))}removeFromContainer(e,t=!1){e.layers&&e.layers.forEach((e=>{const i=this.scene.layers.indexOf(e);-1!==i&&this.scene.layers.splice(i,1),t&&e.dispose()}))}}var cs=o(2558);class us{set applyPostProcess(e){this._applyPostProcess=e}get applyPostProcess(){return this.isBackground||this._applyPostProcess}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,i,s,r,n=!1){this.name=e,this._applyPostProcess=!0,this.scale=new gt.I9(1,1),this.offset=new gt.I9(0,0),this.alphaBlendingMode=2,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this.convertToLinearSpace=!1,this.isEnabled=!0,this._vertexBuffers={},this.onDisposeObservable=new Zi.cP,this.onBeforeRenderObservable=new Zi.cP,this.onAfterRenderObservable=new Zi.cP,this._shaderLanguage=0,this._shadersLoaded=!1,this.texture=t?new Dt.g(t,i,!0):null,this.isBackground=void 0===s||s,this.color=void 0===r?new bt.ov(1,1,1,1):r,this._scene=i||os.q.LastCreatedScene;const o=this._scene.getEngine();!o.isWebGPU||n||us.ForceGLSL||(this._shaderLanguage=1);let a=this._scene._getComponent(hs.v.NAME_LAYER);a||(a=new ls(this._scene),this._scene._addComponent(a)),this._scene.layers.push(this),this._drawWrapper=new cs.E(o);const h=[];h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1);const l=new Mt.R(o,h,Mt.R.PositionKind,!1,!1,2);this._vertexBuffers[Mt.R.PositionKind]=l,this._createIndexBuffer()}_createIndexBuffer(){const e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)}_rebuild(){const e=this._vertexBuffers[Mt.R.PositionKind];e&&e._rebuild(),this._createIndexBuffer()}isReady(){const e=this._scene.getEngine();let t="";this.alphaTest&&(t="#define ALPHATEST"),this.texture&&(this.texture.gammaSpace?this.convertToLinearSpace&&(t+="\n#define CONVERT_TO_LINEAR"):this.convertToLinearSpace||(t+="\n#define CONVERT_TO_GAMMA")),this._previousDefines!==t&&(this._previousDefines=t,this._drawWrapper.effect=e.createEffect("layer",[Mt.R.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],t,void 0,void 0,void 0,void 0,this._shaderLanguage,this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([o.e(3059).then(o.bind(o,3059)),o.e(8809).then(o.bind(o,8809))]):await Promise.all([o.e(4204).then(o.bind(o,4204)),o.e(5254).then(o.bind(o,5254))]),this._shadersLoaded=!0}));const i=this._drawWrapper.effect;return!!i?.isReady()&&(!this.texture||this.texture.isReady())}render(){if(!this.isEnabled)return;const e=this._scene.getEngine();if(!this.isReady())return;const t=this._drawWrapper.effect;this.onBeforeRenderObservable.notifyObservers(this),e.enableEffect(this._drawWrapper),e.setState(!1),this.texture&&(t.setTexture("textureSampler",this.texture),t.setMatrix("textureMatrix",this.texture.getTextureMatrix())),t.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),t.setVector2("offset",this.offset),t.setVector2("scale",this.scale),e.bindBuffers(this._vertexBuffers,this._indexBuffer,t),this.alphaTest?e.drawElementsType(as.i.TriangleFillMode,0,6):(e.setAlphaMode(this.alphaBlendingMode),e.drawElementsType(as.i.TriangleFillMode,0,6),e.setAlphaMode(0)),this.onAfterRenderObservable.notifyObservers(this)}dispose(){const e=this._vertexBuffers[Mt.R.PositionKind];e&&(e.dispose(),this._vertexBuffers[Mt.R.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];const t=this._scene.layers.indexOf(this);this._scene.layers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()}}us.ForceGLSL=!1;class ds{constructor(e,t=ds.UNITMODE_PIXEL,i=!0){this.negativeValueAllowed=i,this._value=1,this._unit=ds.UNITMODE_PIXEL,this.ignoreAdaptiveScaling=!1,this.onChangedObservable=new Zi.cP,this._value=e,this._unit=t,this._originalUnit=t}get isPercentage(){return this._unit===ds.UNITMODE_PERCENTAGE}get isPixel(){return this._unit===ds.UNITMODE_PIXEL}get internalValue(){return this._value}get value(){return this._value}set value(e){e!==this._value&&(this._value=e,this.onChangedObservable.notifyObservers())}get unit(){return this._unit}set unit(e){e!==this._unit&&(this._unit=e,this.onChangedObservable.notifyObservers())}getValueInPixel(e,t){return this.isPixel?this.getValue(e):this.getValue(e)*t}updateInPlace(e,t=ds.UNITMODE_PIXEL){return this.value===e&&this.unit===t||(this._value=e,this._unit=t,this.onChangedObservable.notifyObservers()),this}getValue(e){if(e&&!this.ignoreAdaptiveScaling&&this.unit!==ds.UNITMODE_PERCENTAGE){let t=0,i=0;if(e.idealWidth&&(t=Math.ceil(this._value*e.getSize().width/e.idealWidth)),e.idealHeight&&(i=Math.ceil(this._value*e.getSize().height/e.idealHeight)),e.useSmallestIdeal&&e.idealWidth&&e.idealHeight)return window.innerWidth<window.innerHeight?t:i;if(e.idealWidth)return t;if(e.idealHeight)return i}return this._value}toString(e,t){switch(this._unit){case ds.UNITMODE_PERCENTAGE:{const i=100*this.getValue(e);return(t?i.toFixed(t):i)+"%"}case ds.UNITMODE_PIXEL:{const i=this.getValue(e);return(t?i.toFixed(t):i)+"px"}}return this._unit.toString()}fromString(e){const t=ds._Regex.exec(e.toString());if(!t||0===t.length)return!1;let i=parseFloat(t[1]),s=this._originalUnit;if(this.negativeValueAllowed||i<0&&(i=0),4===t.length)switch(t[3]){case"px":s=ds.UNITMODE_PIXEL;break;case"%":s=ds.UNITMODE_PERCENTAGE,i/=100}return(i!==this._value||s!==this._unit)&&(this._value=i,this._unit=s,this.onChangedObservable.notifyObservers(),!0)}static get UNITMODE_PERCENTAGE(){return ds._UNITMODE_PERCENTAGE}static get UNITMODE_PIXEL(){return ds._UNITMODE_PIXEL}}ds._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,ds._UNITMODE_PERCENTAGE=0,ds._UNITMODE_PIXEL=1;const _s=[new gt.I9(0,0),new gt.I9(0,0),new gt.I9(0,0),new gt.I9(0,0)],ps=[new gt.I9(0,0),new gt.I9(0,0),new gt.I9(0,0),new gt.I9(0,0)],gs=new gt.I9(0,0),fs=new gt.I9(0,0);class ms{constructor(e,t,i,s){this.left=e,this.top=t,this.width=i,this.height=s}copyFrom(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height}copyFromFloats(e,t,i,s){this.left=e,this.top=t,this.width=i,this.height=s}static CombineToRef(e,t,i){const s=Math.min(e.left,t.left),r=Math.min(e.top,t.top),n=Math.max(e.left+e.width,t.left+t.width),o=Math.max(e.top+e.height,t.top+t.height);i.left=s,i.top=r,i.width=n-s,i.height=o-r}addAndTransformToRef(e,t,i,s,r,n){const o=this.left+t,a=this.top+i,h=this.width+s,l=this.height+r;_s[0].copyFromFloats(o,a),_s[1].copyFromFloats(o+h,a),_s[2].copyFromFloats(o+h,a+l),_s[3].copyFromFloats(o,a+l),gs.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),fs.copyFromFloats(0,0);for(let t=0;t<4;t++)e.transformCoordinates(_s[t].x,_s[t].y,ps[t]),gs.x=Math.floor(Math.min(gs.x,ps[t].x)),gs.y=Math.floor(Math.min(gs.y,ps[t].y)),fs.x=Math.ceil(Math.max(fs.x,ps[t].x)),fs.y=Math.ceil(Math.max(fs.y,ps[t].y));n.left=gs.x,n.top=gs.y,n.width=fs.x-gs.x,n.height=fs.y-gs.y}transformToRef(e,t){this.addAndTransformToRef(e,0,0,0,0,t)}isEqualsTo(e){return this.left===e.left&&this.top===e.top&&this.width===e.width&&this.height===e.height}static Empty(){return new ms(0,0,0,0)}}var bs=o(7761);class vs extends gt.I9{constructor(e,t=0){super(e.x,e.y),this.buttonIndex=t}}class Ts{constructor(e,t,i,s,r,n){this.m=new Float32Array(6),this.fromValues(e,t,i,s,r,n)}fromValues(e,t,i,s,r,n){return this.m[0]=e,this.m[1]=t,this.m[2]=i,this.m[3]=s,this.m[4]=r,this.m[5]=n,this}determinant(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]}invertToRef(e){const t=this.m[0],i=this.m[1],s=this.m[2],r=this.m[3],n=this.m[4],o=this.m[5],a=this.determinant();if(a<bs.bH*bs.bH)return e.m[0]=0,e.m[1]=0,e.m[2]=0,e.m[3]=0,e.m[4]=0,e.m[5]=0,this;const h=1/a,l=s*o-r*n,c=i*n-t*o;return e.m[0]=r*h,e.m[1]=-i*h,e.m[2]=-s*h,e.m[3]=t*h,e.m[4]=l*h,e.m[5]=c*h,this}multiplyToRef(e,t){const i=this.m[0],s=this.m[1],r=this.m[2],n=this.m[3],o=this.m[4],a=this.m[5],h=e.m[0],l=e.m[1],c=e.m[2],u=e.m[3],d=e.m[4],_=e.m[5];return t.m[0]=i*h+s*c,t.m[1]=i*l+s*u,t.m[2]=r*h+n*c,t.m[3]=r*l+n*u,t.m[4]=o*h+a*c+d,t.m[5]=o*l+a*u+_,this}transformCoordinates(e,t,i){return i.x=e*this.m[0]+t*this.m[2]+this.m[4],i.y=e*this.m[1]+t*this.m[3]+this.m[5],this}static Identity(){return new Ts(1,0,0,1,0,0)}static IdentityToRef(e){e.m[0]=1,e.m[1]=0,e.m[2]=0,e.m[3]=1,e.m[4]=0,e.m[5]=0}static TranslationToRef(e,t,i){i.fromValues(1,0,0,1,e,t)}static ScalingToRef(e,t,i){i.fromValues(e,0,0,t,0,0)}static RotationToRef(e,t){const i=Math.sin(e),s=Math.cos(e);t.fromValues(s,i,-i,s,0,0)}static ComposeToRef(e,t,i,s,r,n,o){Ts.TranslationToRef(e,t,Ts._TempPreTranslationMatrix),Ts.ScalingToRef(s,r,Ts._TempScalingMatrix),Ts.RotationToRef(i,Ts._TempRotationMatrix),Ts.TranslationToRef(-e,-t,Ts._TempPostTranslationMatrix),Ts._TempPreTranslationMatrix.multiplyToRef(Ts._TempScalingMatrix,Ts._TempCompose0),Ts._TempCompose0.multiplyToRef(Ts._TempRotationMatrix,Ts._TempCompose1),n?(Ts._TempCompose1.multiplyToRef(Ts._TempPostTranslationMatrix,Ts._TempCompose2),Ts._TempCompose2.multiplyToRef(n,o)):Ts._TempCompose1.multiplyToRef(Ts._TempPostTranslationMatrix,o)}}Ts._TempPreTranslationMatrix=Ts.Identity(),Ts._TempPostTranslationMatrix=Ts.Identity(),Ts._TempRotationMatrix=Ts.Identity(),Ts._TempScalingMatrix=Ts.Identity(),Ts._TempCompose0=Ts.Identity(),Ts._TempCompose1=Ts.Identity(),Ts._TempCompose2=Ts.Identity();class ys{static Round(e,t=ys.DefaultRoundingPrecision){return Math.round(e*t)/t}}ys.DefaultRoundingPrecision=100;class xs{get isReadOnly(){return this._isReadOnly}set isReadOnly(e){this._isReadOnly=e}get transformedMeasure(){return this._evaluatedMeasure}set clipChildren(e){this._clipChildren=e}get clipChildren(){return this._clipChildren}set clipContent(e){this._clipContent=e}get clipContent(){return this._clipContent}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._markAsDirty())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._markAsDirty())}get shadowBlur(){return this._shadowBlur}set shadowBlur(e){this._shadowBlur!==e&&(this._previousShadowBlur=this._shadowBlur,this._shadowBlur=e,this._markAsDirty())}get shadowColor(){return this._shadowColor}set shadowColor(e){this._shadowColor!==e&&(this._shadowColor=e,this._markAsDirty())}get typeName(){return this._getTypeName()}getClassName(){return this._getTypeName()}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get host(){return this._host}get fontOffset(){return this._fontOffset}set fontOffset(e){this._fontOffset=e}get alpha(){return this._alpha}set alpha(e){this._alpha!==e&&(this._alphaSet=!0,this._alpha=e,this._markAsDirty())}get highlightLineWidth(){return this._highlightLineWidth}set highlightLineWidth(e){this._highlightLineWidth!==e&&(this._highlightLineWidth=e,this._markAsDirty())}get isHighlighted(){return this._isHighlighted}set isHighlighted(e){this._isHighlighted!==e&&(this._isHighlighted=e,this._markAsDirty())}get highlightColor(){return this._highlightColor}set highlightColor(e){this._highlightColor!==e&&(this._highlightColor=e,this._markAsDirty())}get scaleX(){return this._scaleX}set scaleX(e){this._scaleX!==e&&(this._scaleX=e,this._markAsDirty(),this._markMatrixAsDirty())}get scaleY(){return this._scaleY}set scaleY(e){this._scaleY!==e&&(this._scaleY=e,this._markAsDirty(),this._markMatrixAsDirty())}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterY(){return this._transformCenterY}set transformCenterY(e){this._transformCenterY!==e&&(this._transformCenterY=e,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterX(){return this._transformCenterX}set transformCenterX(e){this._transformCenterX!==e&&(this._transformCenterX=e,this._markAsDirty(),this._markMatrixAsDirty())}get horizontalAlignment(){return this._horizontalAlignment}set horizontalAlignment(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._markAsDirty())}get verticalAlignment(){return this._verticalAlignment}set verticalAlignment(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._markAsDirty())}set fixedRatio(e){this._fixedRatio!==e&&(this._fixedRatio=e,this._markAsDirty())}get fixedRatio(){return this._fixedRatio}set fixedRatioMasterIsWidth(e){this._fixedRatioMasterIsWidth!==e&&(this._fixedRatioMasterIsWidth=e,this._markAsDirty())}get fixedRatioMasterIsWidth(){return this._fixedRatioMasterIsWidth}get width(){return this._width.toString(this._host)}set width(e){this._fixedRatioMasterIsWidth=!0,this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()}get widthInPixels(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)}set widthInPixels(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!0,this.width=e+"px")}get height(){return this._height.toString(this._host)}set height(e){this._fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()}get heightInPixels(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)}set heightInPixels(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!1,this.height=e+"px")}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this._resetFontCache())}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this._resetFontCache())}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this._resetFontCache())}get style(){return this._style}set style(e){this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=e,this._style&&(this._styleObserver=this._style.onChangedObservable.add((()=>{this._markAsDirty(),this._resetFontCache()}))),this._markAsDirty(),this._resetFontCache()}get _isFontSizeInPercentage(){return this._fontSize.isPercentage}get fontSizeInPixels(){const e=this._style?this._style._fontSize:this._fontSize;return e.isPixel?e.getValue(this._host):e.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)}set fontSizeInPixels(e){isNaN(e)||(this.fontSize=e+"px")}get fontSize(){return this._fontSize.toString(this._host)}set fontSize(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&(this._markAsDirty(),this._resetFontCache())}get color(){return this._color}set color(e){this._color!==e&&(this._color=e,this._markAsDirty())}get gradient(){return this._gradient}set gradient(e){this._gradient!==e&&(this._gradient=e,this._markAsDirty())}get zIndex(){return this._zIndex}set zIndex(e){this.zIndex!==e&&(this._zIndex=e,this.parent&&this.parent._reOrderControl(this))}get notRenderable(){return this._doNotRender}set notRenderable(e){this._doNotRender!==e&&(this._doNotRender=e,this._markAsDirty())}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible!==e&&(this._isVisible=e,this._markAsDirty(!0),this.onIsVisibleChangedObservable.notifyObservers(e))}get isDirty(){return this._isDirty}get linkedMesh(){return this._linkedMesh}get descendantsOnlyPadding(){return this._descendantsOnlyPadding}set descendantsOnlyPadding(e){this._descendantsOnlyPadding!==e&&(this._descendantsOnlyPadding=e,this._markAsDirty())}get paddingLeft(){return this._paddingLeft.toString(this._host)}set paddingLeft(e){this._paddingLeft.fromString(e)&&this._markAsDirty()}get paddingLeftInPixels(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingLeftInPixels(e){isNaN(e)||(this.paddingLeft=e+"px")}get _paddingLeftInPixels(){return this._descendantsOnlyPadding?0:this.paddingLeftInPixels}get paddingRight(){return this._paddingRight.toString(this._host)}set paddingRight(e){this._paddingRight.fromString(e)&&this._markAsDirty()}get paddingRightInPixels(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingRightInPixels(e){isNaN(e)||(this.paddingRight=e+"px")}get _paddingRightInPixels(){return this._descendantsOnlyPadding?0:this.paddingRightInPixels}get paddingTop(){return this._paddingTop.toString(this._host)}set paddingTop(e){this._paddingTop.fromString(e)&&this._markAsDirty()}get paddingTopInPixels(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingTopInPixels(e){isNaN(e)||(this.paddingTop=e+"px")}get _paddingTopInPixels(){return this._descendantsOnlyPadding?0:this.paddingTopInPixels}get paddingBottom(){return this._paddingBottom.toString(this._host)}set paddingBottom(e){this._paddingBottom.fromString(e)&&this._markAsDirty()}get paddingBottomInPixels(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingBottomInPixels(e){isNaN(e)||(this.paddingBottom=e+"px")}get _paddingBottomInPixels(){return this._descendantsOnlyPadding?0:this.paddingBottomInPixels}get left(){return this._left.toString(this._host)}set left(e){this._left.fromString(e)&&this._markAsDirty()}get leftInPixels(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)}set leftInPixels(e){isNaN(e)||(this.left=e+"px")}get top(){return this._top.toString(this._host)}set top(e){this._top.fromString(e)&&this._markAsDirty()}get topInPixels(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)}set topInPixels(e){isNaN(e)||(this.top=e+"px")}get linkOffsetX(){return this._linkOffsetX.toString(this._host)}set linkOffsetX(e){this._linkOffsetX.fromString(e)&&this._markAsDirty()}get linkOffsetXInPixels(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)}set linkOffsetXInPixels(e){isNaN(e)||(this.linkOffsetX=e+"px")}get linkOffsetY(){return this._linkOffsetY.toString(this._host)}set linkOffsetY(e){this._linkOffsetY.fromString(e)&&this._markAsDirty()}get linkOffsetYInPixels(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)}set linkOffsetYInPixels(e){isNaN(e)||(this.linkOffsetY=e+"px")}get centerX(){return this._currentMeasure.left+this._currentMeasure.width/2}get centerY(){return this._currentMeasure.top+this._currentMeasure.height/2}get isEnabled(){return this._isEnabled}set isEnabled(e){if(this._isEnabled===e)return;this._isEnabled=e,this._markAsDirty();const t=e=>{if(e.host){for(const t in e.host._lastControlOver)e===this.host._lastControlOver[t]&&(e._onPointerOut(e,null,!0),delete e.host._lastControlOver[t]);void 0!==e.children&&e.children.forEach(t)}};t(this),this.onEnabledStateChangedObservable.notifyObservers(e)}get disabledColor(){return this._disabledColor}set disabledColor(e){this._disabledColor!==e&&(this._disabledColor=e,this._markAsDirty())}get disabledColorItem(){return this._disabledColorItem}set disabledColorItem(e){this._disabledColorItem!==e&&(this._disabledColorItem=e,this._markAsDirty())}get focusedColor(){return this._focusedColor}set focusedColor(e){this._focusedColor=e}onBlur(){this._isFocused&&(this._isFocused=!1,this.focusedColor&&null!=this._unfocusedColor&&(this.color=this._unfocusedColor),this.onBlurObservable.notifyObservers(this))}onFocus(){this._isFocused=!0,this.focusedColor&&(this._unfocusedColor=this.color,this.color=this.focusedColor),this.onFocusObservable.notifyObservers(this)}keepsFocusWith(){return null}focus(){this._host.moveFocusToControl(this)}blur(){this._host.focusedControl=null}processKeyboard(e){"Enter"===e.key&&this.onEnterPressedObservable.notifyObservers(this),this.onKeyboardEventProcessedObservable.notifyObservers(e,-1,this)}constructor(e){this.name=e,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=ms.Empty(),this._tempPaddingMeasure=ms.Empty(),this._fontFamily="",this._fontStyle="",this._fontWeight="",this._fontSize=new ds(18,ds.UNITMODE_PIXEL,!1),this._width=new ds(1,ds.UNITMODE_PERCENTAGE,!1),this._height=new ds(1,ds.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=ms.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=ms.Empty(),this._cachedParentMeasure=ms.Empty(),this._descendantsOnlyPadding=!1,this._paddingLeft=new ds(0),this._paddingRight=new ds(0),this._paddingTop=new ds(0),this._paddingBottom=new ds(0),this._left=new ds(0),this._top=new ds(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=Ts.Identity(),this._invertTransformMatrix=Ts.Identity(),this._transformedPosition=gt.I9.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._highlightColor="#4affff",this._highlightLineWidth=2,this._fontSet=!1,this._dummyVector2=gt.I9.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._evaluatedMeasure=new ms(0,0,0,0),this._evaluatedParentMeasure=new ms(0,0,0,0),this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._isReadOnly=!1,this._gradient=null,this._rebuildLayout=!1,this.onEnabledStateChangedObservable=new Zi.cP,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this._clipChildren=!0,this._clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._previousShadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new ds(0),this._linkOffsetY=new ds(0),this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new Zi.cP,this.onWheelObservable=new Zi.cP,this.onPointerMoveObservable=new Zi.cP,this.onPointerOutObservable=new Zi.cP,this.onPointerDownObservable=new Zi.cP,this.onPointerUpObservable=new Zi.cP,this.onPointerClickObservable=new Zi.cP,this.onEnterPressedObservable=new Zi.cP,this.onPointerEnterObservable=new Zi.cP,this.onDirtyObservable=new Zi.cP,this.onBeforeDrawObservable=new Zi.cP,this.onAfterDrawObservable=new Zi.cP,this.onDisposeObservable=new Zi.cP,this.onIsVisibleChangedObservable=new Zi.cP,this.isSerializable=!0,this._fixedRatio=0,this._fixedRatioMasterIsWidth=!0,this.animations=null,this._focusedColor=null,this.tabIndex=-1,this._isFocused=!1,this._unfocusedColor=null,this.onFocusObservable=new Zi.cP,this.onBlurObservable=new Zi.cP,this.onKeyboardEventProcessedObservable=new Zi.cP,this._tmpMeasureA=new ms(0,0,0,0)}_getTypeName(){return"Control"}getAscendantOfClass(e){return this.parent?this.parent.getClassName()===e?this.parent:this.parent.getAscendantOfClass(e):null}markAsDirty(e=!1){this._markAsDirty(e)}markAllAsDirty(){this._markAllAsDirty()}_resetFontCache(){this._fontSet=!0,this._markAsDirty()}isAscendant(e){return!!this.parent&&(this.parent===e||this.parent.isAscendant(e))}getLocalCoordinates(e){const t=gt.I9.Zero();return this.getLocalCoordinatesToRef(e,t),t}getLocalCoordinatesToRef(e,t){return t.x=e.x-this._currentMeasure.left,t.y=e.y-this._currentMeasure.top,this}getParentLocalCoordinates(e){const t=gt.I9.Zero();return t.x=e.x-this._cachedParentMeasure.left,t.y=e.y-this._cachedParentMeasure.top,t}moveToVector3(e,t){if(!this._host||this.parent!==this._host._rootContainer)return void $i.S0.Error("Cannot move a control to a vector3 if the control is not at root level");this.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP;const i=this._host._getGlobalViewport(),s=gt.Pq.Project(e,gt.uq.IdentityReadOnly,t.getTransformMatrix(),i);this._moveToProjectedPosition(s),s.z<0||s.z>1?this.notRenderable=!0:this.notRenderable=!1}getDescendantsToRef(e,t=!1,i){}getDescendants(e,t){const i=[];return this.getDescendantsToRef(i,e,t),i}linkWithMesh(e){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)return void(e&&$i.S0.Error("Cannot link a control to a mesh if the control is not at root level"));const t=this._host._linkedControls.indexOf(this);if(-1!==t)return this._linkedMesh=e,void(e||this._host._linkedControls.splice(t,1));e&&(this.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=e,this._host._linkedControls.push(this))}setPadding(e,t,i,s){const r=e,n=t??r,o=i??r,a=s??n;this.paddingTop=r,this.paddingRight=n,this.paddingBottom=o,this.paddingLeft=a}setPaddingInPixels(e,t,i,s){const r=e,n=t??r,o=i??r,a=s??n;this.paddingTopInPixels=r,this.paddingRightInPixels=n,this.paddingBottomInPixels=o,this.paddingLeftInPixels=a}_moveToProjectedPosition(e){const t=this._left.getValue(this._host),i=this._top.getValue(this._host),s=this.parent?._currentMeasure;s&&this._processMeasures(s,this._host.getContext());let r=e.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,n=e.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;const o=this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling;o&&(Math.abs(r-t)<.5&&(r=t),Math.abs(n-i)<.5&&(n=i)),(o||t!==r||i!==n)&&(this.left=r+"px",this.top=n+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty())}_offsetLeft(e){this._isDirty=!0,this._currentMeasure.left+=e}_offsetTop(e){this._isDirty=!0,this._currentMeasure.top+=e}_markMatrixAsDirty(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()}_flagDescendantsAsMatrixDirty(){}_intersectsRect(e,t){return this._transform(t),!(this._evaluatedMeasure.left>=e.left+e.width||this._evaluatedMeasure.top>=e.top+e.height||this._evaluatedMeasure.left+this._evaluatedMeasure.width<=e.left||this._evaluatedMeasure.top+this._evaluatedMeasure.height<=e.top)}_computeAdditionalOffsetX(){return 0}_computeAdditionalOffsetY(){return 0}invalidateRect(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization){this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),ms.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA);const e=this.shadowOffsetX,t=this.shadowOffsetY,i=Math.max(this._previousShadowBlur,this.shadowBlur),s=Math.min(Math.min(e,0)-2*i,0),r=Math.max(Math.max(e,0)+2*i,0),n=Math.min(Math.min(t,0)-2*i,0),o=Math.max(Math.max(t,0)+2*i,0),a=this._computeAdditionalOffsetX(),h=this._computeAdditionalOffsetY();this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+s-a),Math.floor(this._tmpMeasureA.top+n-h),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+r+a),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+o+h))}}_markAsDirty(e=!1){(this._isVisible||e)&&(this._isDirty=!0,this._markMatrixAsDirty(),this._host&&this._host.markAsDirty())}_markAllAsDirty(){this._markAsDirty(),this._font&&this._prepareFont()}_link(e){this._host=e,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())}_transform(e){if(!this._isMatrixDirty&&1===this._scaleX&&1===this._scaleY&&0===this._rotation)return;const t=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;e&&(e.translate(t,i),e.rotate(this._rotation),e.scale(this._scaleX,this._scaleY),e.translate(-t,-i)),(this._isMatrixDirty||this._cachedOffsetX!==t||this._cachedOffsetY!==i)&&(this._cachedOffsetX=t,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),Ts.ComposeToRef(-t,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure))}_renderHighlight(e){this.isHighlighted&&(e.save(),e.strokeStyle=this._highlightColor,e.lineWidth=this._highlightLineWidth,this._renderHighlightSpecific(e),e.restore())}_renderHighlightSpecific(e){e.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)}_getColor(e){return this.gradient?this.gradient.getCanvasGradient(e):this.color}_applyStates(e){this._isFontSizeInPercentage&&(this._fontSet=!0),this._host&&this._host.useSmallestIdeal&&!this._font&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(e.font=this._font),(this._color||this.gradient)&&(e.fillStyle=this._getColor(e)),xs.AllowAlphaInheritance?e.globalAlpha*=this._alpha:this._alphaSet&&(e.globalAlpha=this.parent&&!this.parent.renderToIntermediateTexture?this.parent.alpha*this._alpha:this._alpha)}_layout(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e)){this.host._numLayoutCalls++,this._currentMeasure.addAndTransformToRef(this._transformMatrix,0|-this._paddingLeftInPixels,0|-this._paddingTopInPixels,0|this._paddingRightInPixels,0|this._paddingBottomInPixels,this._prevCurrentMeasureTransformedIntoGlobalSpace),t.save(),this._applyStates(t);let i=0;do{this._rebuildLayout=!1,this._processMeasures(e,t),i++}while(this._rebuildLayout&&i<3);i>=3&&It.V.Error(`Layout cycle detected in GUI (Control name=${this.name}, uniqueId=${this.uniqueId})`),t.restore(),this.invalidateRect(),this._evaluateClippingState(e)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0}_processMeasures(e,t){this._tempPaddingMeasure.copyFrom(e),this.parent&&this.parent.descendantsOnlyPadding&&(this._tempPaddingMeasure.left+=this.parent.paddingLeftInPixels,this._tempPaddingMeasure.top+=this.parent.paddingTopInPixels,this._tempPaddingMeasure.width-=this.parent.paddingLeftInPixels+this.parent.paddingRightInPixels,this._tempPaddingMeasure.height-=this.parent.paddingTopInPixels+this.parent.paddingBottomInPixels),this._currentMeasure.copyFrom(this._tempPaddingMeasure),this._preMeasure(this._tempPaddingMeasure,t),this._measure(),this._postMeasure(this._tempPaddingMeasure,t),this._computeAlignment(this._tempPaddingMeasure,t),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(this._tempPaddingMeasure,t),this._cachedParentMeasure.copyFrom(this._tempPaddingMeasure),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)}_evaluateClippingState(e){if(this._transform(),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.parent&&this.parent.clipChildren){if(e.transformToRef(this.parent._transformMatrix,this._evaluatedParentMeasure),this._evaluatedMeasure.left>this._evaluatedParentMeasure.left+this._evaluatedParentMeasure.width)return void(this._isClipped=!0);if(this._evaluatedMeasure.left+this._evaluatedMeasure.width<this._evaluatedParentMeasure.left)return void(this._isClipped=!0);if(this._evaluatedMeasure.top>this._evaluatedParentMeasure.top+this._evaluatedParentMeasure.height)return void(this._isClipped=!0);if(this._evaluatedMeasure.top+this._evaluatedMeasure.height<this._evaluatedParentMeasure.top)return void(this._isClipped=!0)}this._isClipped=!1}_measure(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host),0!==this._fixedRatio&&(this._fixedRatioMasterIsWidth?this._currentMeasure.height=this._currentMeasure.width*this._fixedRatio:this._currentMeasure.width=this._currentMeasure.height*this._fixedRatio)}_computeAlignment(e,t){const i=this._currentMeasure.width,s=this._currentMeasure.height,r=e.width,n=e.height;let o=0,a=0;switch(this.horizontalAlignment){case xs.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case xs.HORIZONTAL_ALIGNMENT_RIGHT:o=r-i;break;case xs.HORIZONTAL_ALIGNMENT_CENTER:o=(r-i)/2}switch(this.verticalAlignment){case xs.VERTICAL_ALIGNMENT_TOP:a=0;break;case xs.VERTICAL_ALIGNMENT_BOTTOM:a=n-s;break;case xs.VERTICAL_ALIGNMENT_CENTER:a=(n-s)/2}this.descendantsOnlyPadding||(this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=r*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=r*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=r*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=n*this._paddingTop.getValue(this._host),this._currentMeasure.height-=n*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=n*this._paddingBottom.getValue(this._host)),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=r*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=n*this._top.getValue(this._host),this._currentMeasure.left+=o,this._currentMeasure.top+=a}_preMeasure(e,t){}_postMeasure(e,t){}_additionalProcessing(e,t){}_clipForChildren(e){}_clip(e,t){if(e.beginPath(),xs._ClipMeasure.copyFrom(this._currentMeasure),t){t.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);const e=new ms(0,0,0,0);e.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),e.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),e.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-e.left,e.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-e.top,xs._ClipMeasure.copyFrom(e)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){const t=this.shadowOffsetX,i=this.shadowOffsetY,s=this.shadowBlur,r=Math.min(Math.min(t,0)-2*s,0),n=Math.max(Math.max(t,0)+2*s,0),o=Math.min(Math.min(i,0)-2*s,0),a=Math.max(Math.max(i,0)+2*s,0);e.rect(xs._ClipMeasure.left+r,xs._ClipMeasure.top+o,xs._ClipMeasure.width+n-r,xs._ClipMeasure.height+a-o)}else e.rect(xs._ClipMeasure.left,xs._ClipMeasure.top,xs._ClipMeasure.width,xs._ClipMeasure.height);e.clip()}_render(e,t){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(this.host._numRenderCalls++,e.save(),this._applyStates(e),this._transform(e),this.clipContent&&this._clip(e,t),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?e.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(e,t),this.useBitmapCache&&this._wasDirty&&(this._cacheData=e.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(e),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),e.restore(),!0)}_draw(e,t){}contains(e,t){return this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y,!(e<this._currentMeasure.left||e>this._currentMeasure.left+this._currentMeasure.width||t<this._currentMeasure.top||t>this._currentMeasure.top+this._currentMeasure.height||(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),0))}_processPicking(e,t,i,s,r,n,o,a){return!(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this._doNotRender||!this.contains(e,t)||(this._processObservables(s,e,t,i,r,n,o,a),0))}_onPointerMove(e,t,i,s){this.onPointerMoveObservable.notifyObservers(t,-1,e,this,s)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerMove(e,t,i,s)}_onPointerEnter(e,t){return!!this._isEnabled&&(!(this._enterCount>0)&&(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,e,this,t)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerEnter(e,t),!0))}_onPointerOut(e,t,i=!1){if(!i&&!this._isEnabled)return;this._enterCount=0;let s=!0;e.isAscendant(this)||(s=this.onPointerOutObservable.notifyObservers(this,-1,e,this,t)),s&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerOut(e,t,i)}_onPointerDown(e,t,i,s,r){return this._onPointerEnter(this,r),-1!==this.tabIndex&&(this.host.focusedControl=this),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new vs(t,s),-1,e,this,r)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerDown(e,t,i,s,r),r&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.add(r.event.pointerId),!0)}_onPointerUp(e,t,i,s,r,n){if(!this._isEnabled)return;this._downCount=0,delete this._downPointerIds[i];let o=r;r&&(this._enterCount>0||-1===this._enterCount)&&(this._host.usePointerTapForClickEvent||(o=this.onPointerClickObservable.notifyObservers(new vs(t,s),-1,e,this,n))),this.onPointerUpObservable.notifyObservers(new vs(t,s),-1,e,this,n)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerUp(e,t,i,s,o,n),n&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.delete(n.event.pointerId),this._host.usePointerTapForClickEvent&&this.isPointerBlocker&&(this._host._shouldBlockPointer=!1)}_onPointerPick(e,t,i,s,r,n){if(!this._host.usePointerTapForClickEvent)return!1;let o=r;return r&&(this._enterCount>0||-1===this._enterCount)&&(o=this.onPointerClickObservable.notifyObservers(new vs(t,s),-1,e,this,n)),this.onPointerUpObservable.notifyObservers(new vs(t,s),-1,e,this,n)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerPick(e,t,i,s,o,n),this._host.usePointerTapForClickEvent&&this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0}_forcePointerUp(e=null){if(null!==e)this._onPointerUp(this,gt.I9.Zero(),e,0,!0);else for(const e in this._downPointerIds)this._onPointerUp(this,gt.I9.Zero(),+e,0,!0)}_onWheelScroll(e,t){this._isEnabled&&this.onWheelObservable.notifyObservers(new gt.I9(e,t))&&null!=this.parent&&this.parent._onWheelScroll(e,t)}_onCanvasBlur(){}_processObservables(e,t,i,s,r,n,o,a){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(t,i),e===tt.Zp.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,r,s);const e=this._host._lastControlOver[r];return e&&e!==this&&e._onPointerOut(this,s),e!==this&&this._onPointerEnter(this,s),this._host._lastControlOver[r]=this,!0}if(e===tt.Zp.POINTERDOWN)return this._onPointerDown(this,this._dummyVector2,r,n,s),this._host._registerLastControlDown(this,r),this._host._lastPickedControl=this,!0;if(e===tt.Zp.POINTERUP)return this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerUp(this,this._dummyVector2,r,n,!0,s),this._host.usePointerTapForClickEvent||delete this._host._lastControlDown[r],!0;if(e===tt.Zp.POINTERWHEEL){if(this._host._lastControlOver[r])return this._host._lastControlOver[r]._onWheelScroll(o,a),!0}else if(e===tt.Zp.POINTERTAP)return this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerPick(this,this._dummyVector2,r,n,!0,s),delete this._host._lastControlDown[r],!0;return!1}_getStyleProperty(e,t){const i=(this._style&&this._style[e])??this[e];return!i&&this.parent?this.parent._getStyleProperty(e,t):this.parent?i:t}_prepareFont(){(this._font||this._fontSet)&&(this._font=this._getStyleProperty("fontStyle","")+" "+this._getStyleProperty("fontWeight","")+" "+this.fontSizeInPixels+"px "+this._getStyleProperty("fontFamily","Arial"),this._fontOffset=xs._GetFontOffset(this._font,this._host?.getScene()?.getEngine()),this.getDescendants().forEach((e=>e._markAllAsDirty())))}isDimensionFullyDefined(e){return this.getDimension(e).isPixel}getDimension(e){return"width"===e?this._width:this._height}clone(e){const t={};this.serialize(t,!0);const i=new($i.S0.Instantiate("BABYLON.GUI."+t.className));return i.parse(t,e),i}parse(e,t,i){return this._urlRewriter=i,Vt.p.Parse((()=>this),e,null),this.name=e.name,this._parseFromContent(e,t??this._host),this}serialize(e,t=!1,i=!0){if(!this.isSerializable&&!t)return;let s=0,r=0;this.host&&(r=this.host.idealHeight,s=this.host.idealWidth,this.host.idealWidth=0,this.host.idealHeight=0),Vt.p.Serialize(this,e),e.name=this.name,e.className=this.getClassName(),i&&this._prepareFont(),this._fontFamily&&(e.fontFamily=this._fontFamily),this.fontSize&&(e.fontSize=this.fontSize),this.fontWeight&&(e.fontWeight=this.fontWeight),this.fontStyle&&(e.fontStyle=this.fontStyle),this._gradient&&(e.gradient={},this._gradient.serialize(e.gradient)),Vt.p.AppendSerializedAnimations(this,e),this.host&&(this.host.idealWidth=s,this.host.idealHeight=r)}_parseFromContent(e,t,i){if(e.fontFamily&&(this.fontFamily=e.fontFamily),e.fontSize&&(this.fontSize=e.fontSize),e.fontWeight&&(this.fontWeight=e.fontWeight),e.fontStyle&&(this.fontStyle=e.fontStyle),e.gradient){const t=$i.S0.Instantiate("BABYLON.GUI."+e.gradient.className);this._gradient=new t,this._gradient?.parse(e.gradient)}if(e.animations){this.animations=[];for(let t=0;t<e.animations.length;t++){const i=e.animations[t],s=(0,Ft.n9)("BABYLON.Animation");s&&this.animations.push(s.Parse(i))}e.autoAnimate&&this._host&&this._host.getScene()&&this._host.getScene().beginAnimation(this,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1)}this.fixedRatioMasterIsWidth=e.fixedRatioMasterIsWidth??this.fixedRatioMasterIsWidth}dispose(){this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onKeyboardEventProcessedObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host&&this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}static get HORIZONTAL_ALIGNMENT_LEFT(){return xs._HORIZONTAL_ALIGNMENT_LEFT}static get HORIZONTAL_ALIGNMENT_RIGHT(){return xs._HORIZONTAL_ALIGNMENT_RIGHT}static get HORIZONTAL_ALIGNMENT_CENTER(){return xs._HORIZONTAL_ALIGNMENT_CENTER}static get VERTICAL_ALIGNMENT_TOP(){return xs._VERTICAL_ALIGNMENT_TOP}static get VERTICAL_ALIGNMENT_BOTTOM(){return xs._VERTICAL_ALIGNMENT_BOTTOM}static get VERTICAL_ALIGNMENT_CENTER(){return xs._VERTICAL_ALIGNMENT_CENTER}static _GetFontOffset(e,t){if(xs._FontHeightSizes[e])return xs._FontHeightSizes[e];const i=t||os.q.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");const s=i.getFontOffset(e);return xs._FontHeightSizes[e]=s,s}static Parse(e,t,i){const s=$i.S0.Instantiate("BABYLON.GUI."+e.className),r=Vt.p.Parse((()=>{const e=new s;return e._urlRewriter=i,e}),e,null);return r.name=e.name,r._parseFromContent(e,t,i),r}static drawEllipse(e,t,i,s,r,n){n.translate(e,t),n.scale(i,s),n.beginPath(),n.arc(0,0,1,0,2*Math.PI*r,r<0),r>=1&&n.closePath(),n.scale(1/i,1/s),n.translate(-e,-t)}isReady(){return!0}}xs.AllowAlphaInheritance=!1,xs._ClipMeasure=new ms(0,0,0,0),xs._HORIZONTAL_ALIGNMENT_LEFT=0,xs._HORIZONTAL_ALIGNMENT_RIGHT=1,xs._HORIZONTAL_ALIGNMENT_CENTER=2,xs._VERTICAL_ALIGNMENT_TOP=0,xs._VERTICAL_ALIGNMENT_BOTTOM=1,xs._VERTICAL_ALIGNMENT_CENTER=2,xs._FontHeightSizes={},xs.AddHeader=()=>{},(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"metadata",void 0),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"isHitTestVisible",void 0),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"isPointerBlocker",void 0),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"isFocusInvisible",void 0),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"clipChildren",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"clipContent",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"useBitmapCache",void 0),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"shadowOffsetX",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"shadowOffsetY",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"shadowBlur",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"shadowColor",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"hoverCursor",void 0),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"fontOffset",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"alpha",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"isSerializable",void 0),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"scaleX",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"scaleY",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"rotation",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"transformCenterY",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"transformCenterX",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"horizontalAlignment",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"verticalAlignment",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"fixedRatio",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"fixedRatioMasterIsWidth",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"width",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"height",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"style",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"color",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"gradient",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"zIndex",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"notRenderable",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"isVisible",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"descendantsOnlyPadding",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"paddingLeft",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"paddingRight",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"paddingTop",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"paddingBottom",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"left",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"top",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"linkOffsetX",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"linkOffsetY",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"isEnabled",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"disabledColor",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"disabledColorItem",null),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"overlapGroup",void 0),(0,Et.Cg)([(0,Rt.lK)()],xs.prototype,"overlapDeltaMultiplier",void 0),(0,Ft.Y5)("BABYLON.GUI.Control",xs);class As extends xs{get renderToIntermediateTexture(){return this._renderToIntermediateTexture}set renderToIntermediateTexture(e){this._renderToIntermediateTexture!==e&&(this._renderToIntermediateTexture=e,this._markAsDirty())}get adaptHeightToChildren(){return this._adaptHeightToChildren}set adaptHeightToChildren(e){this._adaptHeightToChildren!==e&&(this._adaptHeightToChildren=e,e&&(this.height="100%"),this._markAsDirty())}get adaptWidthToChildren(){return this._adaptWidthToChildren}set adaptWidthToChildren(e){this._adaptWidthToChildren!==e&&(this._adaptWidthToChildren=e,e&&(this.width="100%"),this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(e){this._backgroundGradient!==e&&(this._backgroundGradient=e,this._markAsDirty())}get children(){return this._children}get isReadOnly(){return this._isReadOnly}set isReadOnly(e){this._isReadOnly=e;for(const t of this._children)t.isReadOnly=e}constructor(e){super(e),this.name=e,this._children=new Array,this._measureForChildren=ms.Empty(),this._background="",this._backgroundGradient=null,this._adaptWidthToChildren=!1,this._adaptHeightToChildren=!1,this._renderToIntermediateTexture=!1,this._intermediateTexture=null,this.delegatePickingToChildren=!1,this.logLayoutCycleErrors=!1,this.maxLayoutCycle=3,this.onControlAddedObservable=new Zi.cP,this.onControlRemovedObservable=new Zi.cP,this._inverseTransformMatrix=Ts.Identity(),this._inverseMeasure=new ms(0,0,0,0)}_getTypeName(){return"Container"}_flagDescendantsAsMatrixDirty(){for(const e of this.children)e._isClipped=!1,e._markMatrixAsDirty()}getChildByName(e){for(const t of this.children)if(t.name===e)return t;return null}getChildByType(e,t){for(const e of this.children)if(e.typeName===t)return e;return null}containsControl(e){return-1!==this.children.indexOf(e)}addControl(e){return e?(-1!==this._children.indexOf(e)||(e._link(this._host),e._markAllAsDirty(),this._reOrderControl(e),this._markAsDirty(),this.onControlAddedObservable.notifyObservers(e)),this):this}clearControls(){const e=this.children.slice();for(const t of e)this.removeControl(t);return this}removeControl(e){const t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null),e.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(e),this._markAsDirty(),this.onControlRemovedObservable.notifyObservers(e),this}_reOrderControl(e){const t=e.linkedMesh;this.removeControl(e);let i=!1;for(let t=0;t<this._children.length;t++)if(this._children[t].zIndex>e.zIndex){this._children.splice(t,0,e),i=!0;break}i||this._children.push(e),e.parent=this,t&&e.linkWithMesh(t),this._markAsDirty()}_offsetLeft(e){super._offsetLeft(e);for(const t of this._children)t._offsetLeft(e)}_offsetTop(e){super._offsetTop(e);for(const t of this._children)t._offsetTop(e)}_markAllAsDirty(){super._markAllAsDirty();for(let e=0;e<this._children.length;e++)this._children[e]._markAllAsDirty()}_getBackgroundColor(e){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(e):this._background}_localDraw(e){(this._background||this._backgroundGradient)&&(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._getBackgroundColor(e),e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.restore())}_link(e){super._link(e);for(const t of this._children)t._link(e)}_beforeLayout(){}_processMeasures(e,t){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(e)||(super._processMeasures(e,t),this._evaluateClippingState(e),this._renderToIntermediateTexture&&(this._intermediateTexture&&this._host.getScene()!=this._intermediateTexture.getScene()&&(this._intermediateTexture.dispose(),this._intermediateTexture=null),this._intermediateTexture?this._intermediateTexture.scaleTo(this._currentMeasure.width,this._currentMeasure.height):(this._intermediateTexture=new ns("",{width:this._currentMeasure.width,height:this._currentMeasure.height},this._host.getScene(),!1,Dt.g.NEAREST_SAMPLINGMODE,ui.Y.TEXTUREFORMAT_RGBA,!1),this._intermediateTexture.hasAlpha=!0)))}_layout(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);let i=0;t.save(),this._applyStates(t),this._beforeLayout();do{let s=-1,r=-1;if(this._rebuildLayout=!1,this._processMeasures(e,t),!this._isClipped){for(const e of this._children)e._tempParentMeasure.copyFrom(this._measureForChildren),e._layout(this._measureForChildren,t)&&e.isVisible&&!e.notRenderable&&(this.adaptWidthToChildren&&e._width.isPixel&&(s=Math.max(s,e._currentMeasure.width+e._paddingLeftInPixels+e._paddingRightInPixels)),this.adaptHeightToChildren&&e._height.isPixel&&(r=Math.max(r,e._currentMeasure.height+e._paddingTopInPixels+e._paddingBottomInPixels)));if(this.adaptWidthToChildren&&s>=0){s+=this.paddingLeftInPixels+this.paddingRightInPixels;const e=s+"px";this.width!==e&&(this.parent?._markAsDirty(),this.width=e,this._width.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)}if(this.adaptHeightToChildren&&r>=0){r+=this.paddingTopInPixels+this.paddingBottomInPixels;const e=r+"px";this.height!==e&&(this.parent?._markAsDirty(),this.height=e,this._height.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)}this._postMeasure()}i++}while(this._rebuildLayout&&i<this.maxLayoutCycle);return i>=3&&this.logLayoutCycleErrors&&It.V.Error(`Layout cycle detected in GUI (Container name=${this.name}, uniqueId=${this.uniqueId})`),t.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0}_postMeasure(){}_draw(e,t){const i=this._renderToIntermediateTexture&&this._intermediateTexture,s=i?this._intermediateTexture.getContext():e;i&&(s.save(),s.translate(-this._currentMeasure.left,-this._currentMeasure.top),t?(this._transformMatrix.invertToRef(this._inverseTransformMatrix),t.transformToRef(this._inverseTransformMatrix,this._inverseMeasure),s.clearRect(this._inverseMeasure.left,this._inverseMeasure.top,this._inverseMeasure.width,this._inverseMeasure.height)):s.clearRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._localDraw(s),e.save(),this.clipChildren&&this._clipForChildren(s);for(const e of this._children)t&&!e._intersectsRect(t)||e._render(s,t);i&&(s.restore(),e.save(),e.globalAlpha=this.alpha,e.drawImage(s.canvas,this._currentMeasure.left,this._currentMeasure.top),e.restore()),e.restore()}getDescendantsToRef(e,t=!1,i){if(this.children)for(let s=0;s<this.children.length;s++){const r=this.children[s];i&&!i(r)||e.push(r),t||r.getDescendantsToRef(e,!1,i)}}_processPicking(e,t,i,s,r,n,o,a){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;const h=super.contains(e,t);if(!h&&this.clipChildren)return!1;if(this.delegatePickingToChildren){let i=!1;for(let s=this._children.length-1;s>=0;s--){const r=this._children[s];if(r.isEnabled&&r.isHitTestVisible&&r.isVisible&&!r.notRenderable&&r.contains(e,t)){i=!0;break}}if(!i)return!1}for(let h=this._children.length-1;h>=0;h--){const l=this._children[h];if(l._processPicking(e,t,i,s,r,n,o,a))return l.hoverCursor&&this._host._changeCursor(l.hoverCursor),!0}return!!h&&!!this.isHitTestVisible&&this._processObservables(s,e,t,i,r,n,o,a)}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.copyFrom(this._currentMeasure)}_getAdaptDimTo(e){return"width"===e?this.adaptWidthToChildren:this.adaptHeightToChildren}isDimensionFullyDefined(e){if(this._getAdaptDimTo(e)){for(const t of this.children)if(!t.isDimensionFullyDefined(e))return!1;return!0}return super.isDimensionFullyDefined(e)}serialize(e,t=!1,i=!0){if(super.serialize(e,t,i),(this.isSerializable||t)&&(this.backgroundGradient&&(e.backgroundGradient={},this.backgroundGradient.serialize(e.backgroundGradient)),this.children.length)){e.children=[];for(const s of this.children)if(s.isSerializable||t){const r={};s.serialize(r,t,i),e.children.push(r)}}}dispose(){super.dispose();for(let e=this.children.length-1;e>=0;e--)this.children[e].dispose();this._intermediateTexture?.dispose()}_parseFromContent(e,t,i){if(super._parseFromContent(e,t,i),this._link(t),e.backgroundGradient){const t=$i.S0.Instantiate("BABYLON.GUI."+e.backgroundGradient.className);this._backgroundGradient=new t,this._backgroundGradient?.parse(e.backgroundGradient)}if(e.children)for(const s of e.children)this.addControl(xs.Parse(s,t,i))}isReady(){for(const e of this.children)if(!e.isReady())return!1;return!0}}(0,Et.Cg)([(0,Rt.lK)()],As.prototype,"delegatePickingToChildren",void 0),(0,Et.Cg)([(0,Rt.lK)()],As.prototype,"renderToIntermediateTexture",null),(0,Et.Cg)([(0,Rt.lK)()],As.prototype,"maxLayoutCycle",void 0),(0,Et.Cg)([(0,Rt.lK)()],As.prototype,"adaptHeightToChildren",null),(0,Et.Cg)([(0,Rt.lK)()],As.prototype,"adaptWidthToChildren",null),(0,Et.Cg)([(0,Rt.lK)()],As.prototype,"background",null),(0,Et.Cg)([(0,Rt.lK)()],As.prototype,"backgroundGradient",null),(0,Ft.Y5)("BABYLON.GUI.Container",As);class Cs{constructor(e){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new ds(18,ds.UNITMODE_PIXEL,!1),this.onChangedObservable=new Zi.cP,this._host=e}get fontSize(){return this._fontSize.toString(this._host)}set fontSize(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&this.onChangedObservable.notifyObservers(this)}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.onChangedObservable.notifyObservers(this))}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.onChangedObservable.notifyObservers(this))}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.onChangedObservable.notifyObservers(this))}dispose(){this.onChangedObservable.clear()}}var Ss,Es=o(1956),Rs=o(2276),Ps=o(7634),Is=o(427);class Ms extends ns{get numLayoutCalls(){return this._numLayoutCalls}get numRenderCalls(){return this._numRenderCalls}get adjustToEngineHardwareScalingLevel(){return this._adjustToEngineHardwareScalingLevel}set adjustToEngineHardwareScalingLevel(e){this._adjustToEngineHardwareScalingLevel!==e&&(this._adjustToEngineHardwareScalingLevel=e,this._onResize())}get renderScale(){return this._renderScale}set renderScale(e){e!==this._renderScale&&(this._renderScale=e,this._onResize())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this.markAsDirty())}get idealWidth(){return this._idealWidth}set idealWidth(e){this._idealWidth!==e&&(this._idealWidth=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get idealHeight(){return this._idealHeight}set idealHeight(e){this._idealHeight!==e&&(this._idealHeight=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get useSmallestIdeal(){return this._useSmallestIdeal}set useSmallestIdeal(e){this._useSmallestIdeal!==e&&(this._useSmallestIdeal=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get renderAtIdealSize(){return this._renderAtIdealSize}set renderAtIdealSize(e){this._renderAtIdealSize!==e&&(this._renderAtIdealSize=e,this._onResize())}get idealRatio(){let e=0,t=0;return this._idealWidth&&(e=this.getSize().width/this._idealWidth),this._idealHeight&&(t=this.getSize().height/this._idealHeight),this._useSmallestIdeal&&this._idealWidth&&this._idealHeight?window.innerWidth<window.innerHeight?e:t:this._idealWidth?e:this._idealHeight?t:1}get layer(){return this._layerToDispose}get rootContainer(){return this._rootContainer}getChildren(){return[this._rootContainer]}getDescendants(e,t){return this._rootContainer.getDescendants(e,t)}getControlsByType(e){return this._rootContainer.getDescendants(!1,(t=>t.typeName===e))}getControlByName(e){return this._getControlByKey("name",e)}_getControlByKey(e,t){return this._rootContainer.getDescendants().find((i=>i[e]===t))||null}get focusedControl(){return this._focusedControl}set focusedControl(e){this._focusedControl!=e&&(this._focusedControl&&this._focusedControl.onBlur(),e&&e.onFocus(),this._focusedControl=e)}get isForeground(){return!this.layer||!this.layer.isBackground}set isForeground(e){this.layer&&this.layer.isBackground!==!e&&(this.layer.isBackground=!e)}get clipboardData(){return this._clipboardData}set clipboardData(e){this._clipboardData=e}constructor(e,t,i=0,s,r=!1,n=Dt.g.NEAREST_SAMPLINGMODE,o=!0){const a="object"==typeof(t=t??0)&&void 0!==t?t.width??0:t??0,h="object"==typeof t&&void 0!==t?t.height??0:i;if(super(e,{width:a,height:h},"object"==typeof t&&void 0!==t?t:s,r,n,ui.Y.TEXTUREFORMAT_RGBA,o),this.useStandalone=!1,this.onGuiReadyObservable=new Zi.cP,this._isDirty=!1,this._rootContainer=new As("root"),this._lastControlOver={},this._lastControlDown={},this._capturingControl={},this._linkedControls=new Array,this._isFullscreen=!1,this._fullscreenViewport=new Es.L(0,0,1,1),this._idealWidth=0,this._idealHeight=0,this._useSmallestIdeal=!1,this._renderAtIdealSize=!1,this._blockNextFocusCheck=!1,this._renderScale=1,this._cursorChanged=!1,this._defaultMousePointerId=0,this._rootChildrenHaveChanged=!1,this._adjustToEngineHardwareScalingLevel=!1,this._capturedPointerIds=new Set,this._numLayoutCalls=0,this._numRenderCalls=0,this._clipboardData="",this.onClipboardObservable=new Zi.cP,this.onControlPickedObservable=new Zi.cP,this.onBeginLayoutObservable=new Zi.cP,this.onEndLayoutObservable=new Zi.cP,this.onBeginRenderObservable=new Zi.cP,this.onEndRenderObservable=new Zi.cP,this.premulAlpha=!1,this.applyYInversionOnUpdate=!0,this.disableTabNavigation=!1,this.disablePicking=!1,this.usePointerTapForClickEvent=!1,this.skipBlockEvents=0,this.checkPointerEveryFrame=!1,this._useInvalidateRectOptimization=!0,this._invalidatedRectangle=null,this._clearMeasure=new ms(0,0,0,0),this._focusProperties={index:0,total:-1},this._onClipboardCopy=e=>{const t=e,i=new es(Ji.COPY,t);this.onClipboardObservable.notifyObservers(i),t.preventDefault()},this._onClipboardCut=e=>{const t=e,i=new es(Ji.CUT,t);this.onClipboardObservable.notifyObservers(i),t.preventDefault()},this._onClipboardPaste=e=>{const t=e,i=new es(Ji.PASTE,t);this.onClipboardObservable.notifyObservers(i),t.preventDefault()},this.parseContent=this.parseSerializedObject,!(s=this.getScene())||!this._texture)return;this.applyYInversionOnUpdate=o,this._rootElement=s.getEngine().getInputElement();const l=t;this.useStandalone=!!l?.useStandalone,this.useStandalone||(this._renderObserver=s.onBeforeCameraRenderObservable.add((e=>this._checkUpdate(e)))),this._controlAddedObserver=this._rootContainer.onControlAddedObservable.add((e=>{e&&(this._rootChildrenHaveChanged=!0)})),this._controlRemovedObserver=this._rootContainer.onControlRemovedObservable.add((e=>{e&&(this._rootChildrenHaveChanged=!0)})),this._preKeyboardObserver=s.onPreKeyboardObservable.add((e=>{if(!this.disableTabNavigation&&e.type===ts.TB.KEYDOWN&&"Tab"===e.event.code){const t=!e.event.shiftKey;return t&&this._focusProperties.index===this._focusProperties.total-1||!t&&0===this._focusProperties.index&&this._focusProperties.total>0?(this.focusedControl=null,this._focusProperties.index=0,void(this._focusProperties.total=-1)):(this._focusNextElement(t),void e.event.preventDefault())}this._focusedControl&&(e.type===ts.TB.KEYDOWN&&this._focusedControl.processKeyboard(e.event),e.skipOnPointerObservable=!0)})),this._rootContainer._link(this),this.hasAlpha=!0,a&&h||(this._resizeObserver=s.getEngine().onResizeObservable.add((()=>this._onResize())),this._onResize()),this._texture.isReady=!0}getClassName(){return"AdvancedDynamicTexture"}executeOnAllControls(e,t){t||(t=this._rootContainer),e(t);for(const i of t.children)i.children?this.executeOnAllControls(e,i):e(i)}get useInvalidateRectOptimization(){return this._useInvalidateRectOptimization}set useInvalidateRectOptimization(e){this._useInvalidateRectOptimization=e}invalidateRect(e,t,i,s){if(this._useInvalidateRectOptimization)if(this._invalidatedRectangle){const r=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,i)),n=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,s));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,e)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,t)),this._invalidatedRectangle.width=r-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=n-this._invalidatedRectangle.top+1}else this._invalidatedRectangle=new ms(e,t,i-e+1,s-t+1)}markAsDirty(){this._isDirty=!0}createStyle(){return new Cs(this)}addControl(e){return this._rootContainer.addControl(e),this}removeControl(e){return this._rootContainer.removeControl(e),this}moveToNonOverlappedPosition(e,t=1,i=1){let s;if(Array.isArray(e))s=e;else{const t=this.getDescendants(!0);s=void 0===e?t.filter((e=>void 0!==e.overlapGroup)):t.filter((t=>t.overlapGroup===e))}s.forEach((e=>{let r=gt.I9.Zero();const n=new gt.I9(e.centerX,e.centerY);s.forEach((t=>{if(e!==t&&Ms._Overlaps(e,t)){const e=n.subtract(new gt.I9(t.centerX,t.centerY)),s=e.length();s>0&&(r=r.add(e.normalize().scale(i/s)))}})),r.length()>0&&(r=r.normalize().scale(t*(e.overlapDeltaMultiplier??1)),e.linkOffsetXInPixels+=r.x,e.linkOffsetYInPixels+=r.y)}))}dispose(){const e=this.getScene();e&&(this._rootElement=null,e.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&e.getEngine().onResizeObservable.remove(this._resizeObserver),this._prePointerObserver&&e.onPrePointerObservable.remove(this._prePointerObserver),this._sceneRenderObserver&&e.onBeforeRenderObservable.remove(this._sceneRenderObserver),this._pointerObserver&&e.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&e.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&e.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._canvasBlurObserver&&e.getEngine().onCanvasBlurObservable.remove(this._canvasBlurObserver),this._controlAddedObserver&&this._rootContainer.onControlAddedObservable.remove(this._controlAddedObserver),this._controlRemovedObserver&&this._rootContainer.onControlRemovedObservable.remove(this._controlRemovedObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),this.onGuiReadyObservable.clear(),super.dispose())}_onResize(){const e=this.getScene();if(!e)return;const t=e.getEngine();this.adjustToEngineHardwareScalingLevel&&(this._renderScale=t.getHardwareScalingLevel());const i=this.getSize();let s=t.getRenderWidth()*this._renderScale,r=t.getRenderHeight()*this._renderScale;this._renderAtIdealSize&&(this._idealWidth?(r=r*this._idealWidth/s,s=this._idealWidth):this._idealHeight&&(s=s*this._idealHeight/r,r=this._idealHeight)),i.width===s&&i.height===r||(this.scaleTo(s,r),this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty()),this.invalidateRect(0,0,i.width-1,i.height-1)}_getGlobalViewport(){const e=this.getSize(),t=this._fullscreenViewport.toGlobal(e.width,e.height),i=Math.round(t.width*(1/this.rootContainer.scaleX)),s=Math.round(t.height*(1/this.rootContainer.scaleY));return t.x+=(t.width-i)/2,t.y+=(t.height-s)/2,t.width=i,t.height=s,t}getProjectedPosition(e,t){const i=this.getProjectedPositionWithZ(e,t);return new gt.I9(i.x,i.y)}getProjectedPositionWithZ(e,t){const i=this.getScene();if(!i)return gt.Pq.Zero();const s=this._getGlobalViewport(),r=gt.Pq.Project(e,t,i.getTransformMatrix(),s);return new gt.Pq(r.x,r.y,r.z)}_checkUpdate(e,t){if(!this._layerToDispose||!e||e.layerMask&this._layerToDispose.layerMask){if(this._isFullscreen&&this._linkedControls.length){const e=this.getScene();if(!e)return;const t=this._getGlobalViewport();for(const i of this._linkedControls){if(!i.isVisible)continue;const s=i._linkedMesh;if(!s||s.isDisposed()){$i.S0.SetImmediate((()=>{i.linkWithMesh(null)}));continue}const r=s.getBoundingInfo?s.getBoundingInfo().boundingSphere.center:gt.Pq.ZeroReadOnly,n=gt.Pq.Project(r,s.getWorldMatrix(),e.getTransformMatrix(),t);n.z<0||n.z>1?i.notRenderable=!0:(i.notRenderable=!1,this.useInvalidateRectOptimization&&i.invalidateRect(),i._moveToProjectedPosition(n))}}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(t),t||this.update(this.applyYInversionOnUpdate,this.premulAlpha,Ms.AllowGPUOptimizations))}}_render(e){const t=this.getSize(),i=t.width,s=t.height,r=this.getContext();if(r.font="18px Arial",r.strokeStyle="white",this.onGuiReadyObservable.hasObservers()&&this._checkGuiIsReady(),this._rootChildrenHaveChanged){const e=this.getScene()?.activeCamera;e&&(this._rootChildrenHaveChanged=!1,this._checkUpdate(e,!0))}this.onBeginLayoutObservable.notifyObservers(this);const n=new ms(0,0,i,s);this._numLayoutCalls=0,this._rootContainer._layout(n,r),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,e||(this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,i,s),r.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(r.save(),r.fillStyle=this._background,r.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),r.restore()),this.onBeginRenderObservable.notifyObservers(this),this._numRenderCalls=0,this._rootContainer._render(r,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null)}_changeCursor(e){this._rootElement&&(this._rootElement.style.cursor=e,this._cursorChanged=!0)}_registerLastControlDown(e,t){this._lastControlDown[t]=e,this.onControlPickedObservable.notifyObservers(e)}_doPicking(e,t,i,s,r,n,o,a){const h=this.getScene();if(!h||this.disablePicking)return;const l=h.getEngine(),c=this.getSize();if(this._isFullscreen){const i=h.cameraToUseForPointers||h.activeCamera;if(!i)return;const s=i.viewport;e*=c.width/(l.getRenderWidth()*s.width),t*=c.height/(l.getRenderHeight()*s.height)}if(this._capturingControl[r])return this._capturingControl[r].isPointerBlocker&&(this._shouldBlockPointer=!0),void this._capturingControl[r]._processObservables(s,e,t,i,r,n);this._cursorChanged=!1,this._rootContainer._processPicking(e,t,i,s,r,n,o,a)||(h.doNotHandleCursors||this._changeCursor(""),s===tt.Zp.POINTERMOVE&&this._lastControlOver[r]&&(this._lastControlOver[r]._onPointerOut(this._lastControlOver[r],i),delete this._lastControlOver[r])),this._cursorChanged||h.doNotHandleCursors||this._changeCursor(""),this._manageFocus()}_cleanControlAfterRemovalFromList(e,t){for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&e[i]===t&&delete e[i]}_cleanControlAfterRemoval(e){this._cleanControlAfterRemovalFromList(this._lastControlDown,e),this._cleanControlAfterRemovalFromList(this._lastControlOver,e)}pick(e,t,i=null){this._isFullscreen&&this._scene&&this._translateToPicking(this._scene,new Es.L(0,0,0,0),i,e,t)}_translateToPicking(e,t,i,s=e.pointerX,r=e.pointerY){const n=e.cameraToUseForPointers||e.activeCamera,o=e.getEngine(),a=e.cameraToUseForPointers;if(n)if(n.rigCameras.length){const i=new Es.L(0,0,1,1);n.rigCameras.forEach((n=>{n.viewport.toGlobalToRef(o.getRenderWidth(),o.getRenderHeight(),i);const a=s/o.getHardwareScalingLevel()-i.x,h=r/o.getHardwareScalingLevel()-(o.getRenderHeight()-i.y-i.height);a<0||h<0||s>i.width||r>i.height||(e.cameraToUseForPointers=n,t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height)}))}else n.viewport.toGlobalToRef(o.getRenderWidth(),o.getRenderHeight(),t);else t.x=0,t.y=0,t.width=o.getRenderWidth(),t.height=o.getRenderHeight();const h=s/o.getHardwareScalingLevel()-t.x,l=r/o.getHardwareScalingLevel()-(o.getRenderHeight()-t.y-t.height);if(this._shouldBlockPointer=!1,i){const e=i.event.pointerId||this._defaultMousePointerId;this._doPicking(h,l,i,i.type,e,i.event.button,i.event.deltaX,i.event.deltaY),(this._shouldBlockPointer&&!(i.type&this.skipBlockEvents)||this._capturingControl[e])&&(i.skipOnPointerObservable=!0)}else this._doPicking(h,l,null,tt.Zp.POINTERMOVE,this._defaultMousePointerId,0);e.cameraToUseForPointers=a}attach(){const e=this.getScene();if(!e)return;const t=new Es.L(0,0,0,0);this._prePointerObserver=e.onPrePointerObservable.add((i=>{if((!e.isPointerCaptured(i.event.pointerId)||i.type!==tt.Zp.POINTERUP||this._capturedPointerIds.has(i.event.pointerId))&&(i.type===tt.Zp.POINTERMOVE||i.type===tt.Zp.POINTERUP||i.type===tt.Zp.POINTERDOWN||i.type===tt.Zp.POINTERWHEEL||i.type===tt.Zp.POINTERTAP)){if(i.type===tt.Zp.POINTERMOVE){if(e.isPointerCaptured(i.event.pointerId))return;i.event.pointerId&&(this._defaultMousePointerId=i.event.pointerId)}this._translateToPicking(e,t,i)}})),this._attachPickingToSceneRender(e,(()=>this._translateToPicking(e,t,null)),!1),this._attachToOnPointerOut(e),this._attachToOnBlur(e)}_focusNextElement(e=!0){const t=[];if(this.executeOnAllControls((e=>{e.isFocusInvisible||!e.isVisible||e.tabIndex<0||t.push(e)})),0===t.length)return;t.sort(((e,t)=>0===e.tabIndex?1:0===t.tabIndex?-1:e.tabIndex-t.tabIndex)),this._focusProperties.total=t.length;let i=-1;this._focusedControl?(i=t.indexOf(this._focusedControl)+(e?1:-1),i<0?i=t.length-1:i>=t.length&&(i=0)):i=e?0:t.length-1,t[i].focus(),this._focusProperties.index=i}registerClipboardEvents(){self.addEventListener("copy",this._onClipboardCopy,!1),self.addEventListener("cut",this._onClipboardCut,!1),self.addEventListener("paste",this._onClipboardPaste,!1)}unRegisterClipboardEvents(){self.removeEventListener("copy",this._onClipboardCopy),self.removeEventListener("cut",this._onClipboardCut),self.removeEventListener("paste",this._onClipboardPaste)}_transformUvs(e){const t=this.getTextureMatrix();let i;if(t.isIdentityAs3x2())i=e;else{const s=gt.AA.Matrix[0];t.getRowToRef(0,gt.AA.Vector4[0]),t.getRowToRef(1,gt.AA.Vector4[1]),t.getRowToRef(2,gt.AA.Vector4[2]);const r=gt.AA.Vector4[0],n=gt.AA.Vector4[1],o=gt.AA.Vector4[2];s.setRowFromFloats(0,r.x,r.y,0,0),s.setRowFromFloats(1,n.x,n.y,0,0),s.setRowFromFloats(2,0,0,1,0),s.setRowFromFloats(3,o.x,o.y,0,1),i=gt.AA.Vector2[0],gt.I9.TransformToRef(e,s,i)}if((this.wrapU===Dt.g.WRAP_ADDRESSMODE||this.wrapU===Dt.g.MIRROR_ADDRESSMODE)&&i.x>1){let e=i.x-Math.trunc(i.x);this.wrapU===Dt.g.MIRROR_ADDRESSMODE&&Math.trunc(i.x)%2==1&&(e=1-e),i.x=e}if((this.wrapV===Dt.g.WRAP_ADDRESSMODE||this.wrapV===Dt.g.MIRROR_ADDRESSMODE)&&i.y>1){let e=i.y-Math.trunc(i.y);this.wrapV===Dt.g.MIRROR_ADDRESSMODE&&Math.trunc(i.x)%2==1&&(e=1-e),i.y=e}return i}attachToMesh(e,t=!0){const i=this.getScene();i&&(this._pointerObserver&&i.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=i.onPointerObservable.add((t=>{if(t.type!==tt.Zp.POINTERMOVE&&t.type!==tt.Zp.POINTERUP&&t.type!==tt.Zp.POINTERDOWN&&t.type!==tt.Zp.POINTERWHEEL)return;t.type===tt.Zp.POINTERMOVE&&t.event.pointerId&&(this._defaultMousePointerId=t.event.pointerId);const i=t.event.pointerId||this._defaultMousePointerId;if(t.pickInfo&&t.pickInfo.hit&&t.pickInfo.pickedMesh===e){let e=t.pickInfo.getTextureCoordinates();if(e){e=this._transformUvs(e);const s=this.getSize();this._doPicking(e.x*s.width,(this.applyYInversionOnUpdate?1-e.y:e.y)*s.height,t,t.type,i,t.event.button,t.event.deltaX,t.event.deltaY)}}else if(t.type===tt.Zp.POINTERUP){if(this._lastControlDown[i]&&this._lastControlDown[i]._forcePointerUp(i),delete this._lastControlDown[i],this.focusedControl){const e=this.focusedControl.keepsFocusWith();let t=!0;if(e)for(const s of e){if(this===s._host)continue;const e=s._host;if(e._lastControlOver[i]&&e._lastControlOver[i].isAscendant(s)){t=!1;break}}t&&(this.focusedControl=null)}}else t.type===tt.Zp.POINTERMOVE&&(this._lastControlOver[i]&&this._lastControlOver[i]._onPointerOut(this._lastControlOver[i],t,!0),delete this._lastControlOver[i])})),e.enablePointerMoveEvents=t,this._attachPickingToSceneRender(i,(()=>{const t=this._defaultMousePointerId,s=i?.pick(i.pointerX,i.pointerY);if(s&&s.hit&&s.pickedMesh===e){let e=s.getTextureCoordinates();if(e){e=this._transformUvs(e);const i=this.getSize();this._doPicking(e.x*i.width,(this.applyYInversionOnUpdate?1-e.y:e.y)*i.height,null,tt.Zp.POINTERMOVE,t,0)}}else this._lastControlOver[t]&&this._lastControlOver[t]._onPointerOut(this._lastControlOver[t],null,!0),delete this._lastControlOver[t]}),!0),this._attachToOnPointerOut(i),this._attachToOnBlur(i))}moveFocusToControl(e){this.focusedControl=e,this._lastPickedControl=e,this._blockNextFocusCheck=!0}_manageFocus(){if(this._blockNextFocusCheck)return this._blockNextFocusCheck=!1,void(this._lastPickedControl=this._focusedControl);if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}}_attachPickingToSceneRender(e,t,i){this._sceneRenderObserver=e.onBeforeRenderObservable.add((()=>{this.checkPointerEveryFrame&&(this._linkedControls.length>0||i)&&t()}))}_attachToOnPointerOut(e){this._canvasPointerOutObserver=e.getEngine().onCanvasPointerOutObservable.add((e=>{this._lastControlOver[e.pointerId]&&this._lastControlOver[e.pointerId]._onPointerOut(this._lastControlOver[e.pointerId],null),delete this._lastControlOver[e.pointerId],this._lastControlDown[e.pointerId]&&this._lastControlDown[e.pointerId]!==this._capturingControl[e.pointerId]&&(this._lastControlDown[e.pointerId]._forcePointerUp(e.pointerId),delete this._lastControlDown[e.pointerId])}))}_attachToOnBlur(e){this._canvasBlurObserver=e.getEngine().onCanvasBlurObservable.add((()=>{Object.entries(this._lastControlDown).forEach((([,e])=>{e._onCanvasBlur()})),this.focusedControl=null,this._lastControlDown={}}))}serializeContent(){const e=this.getSize(),t={root:{},width:e.width,height:e.height};return this._rootContainer.serialize(t.root),t}parseSerializedObject(e,t,i){if(this._rootContainer=xs.Parse(e.root,this,i),t){const t=e.width,i=e.height;"number"==typeof t&&"number"==typeof i&&t>=0&&i>=0?this.scaleTo(t,i):this.scaleTo(1920,1080)}}clone(e,t){const i=this.getScene();if(!i)return this;const s=this.getSize(),r=this.serializeContent();let n;return n=this._isFullscreen?Ms.CreateFullscreenUI(e??"Clone of "+this.name):t?Ms.CreateForMesh(t,s.width,s.height):new Ms(e??"Clone of "+this.name,s.width,s.height,i,!this.noMipmap,this.samplingMode),n.parseSerializedObject(r),n}static async ParseFromSnippetAsync(e,t,i,s){const r=i??Ms.CreateFullscreenUI("ADT from snippet");if("_BLANK"===e)return r;const n=await Ms._LoadURLContentAsync(Ms.SnippetUrl+"/"+e.replace(/#/g,"/"),!0);return r.parseSerializedObject(n,t,s),r}parseFromSnippetAsync(e,t,i){return Ms.ParseFromSnippetAsync(e,t,this,i)}static async ParseFromFileAsync(e,t,i,s){const r=i??Ms.CreateFullscreenUI("ADT from URL"),n=await Ms._LoadURLContentAsync(e);return r.parseSerializedObject(n,t,s),r}parseFromURLAsync(e,t,i){return Ms.ParseFromFileAsync(e,t,this,i)}static _LoadURLContentAsync(e,t=!1){return""===e?Promise.reject("No URL provided"):new Promise(((i,s)=>{const r=new Rs.u;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){let e;if(t){const t=JSON.parse(JSON.parse(r.responseText).jsonPayload);e=t.encodedGui?new TextDecoder("utf-8").decode((0,Is.yS)(t.encodedGui)):t.gui}else e=r.responseText;const s=JSON.parse(e);i(s)}else s("Unable to load")})),r.open("GET",e),r.send()}))}static _Overlaps(e,t){return!(e.centerX>t.centerX+t.widthInPixels||e.centerX+e.widthInPixels<t.centerX||e.centerY+e.heightInPixels<t.centerY||e.centerY>t.centerY+t.heightInPixels)}static CreateForMesh(e,t=1024,i=1024,s=!0,r=!1,n,o=this._CreateMaterial,a=Dt.g.TRILINEAR_SAMPLINGMODE){const h=(0,Ps.z)(),l=new Ms(`AdvancedDynamicTexture for ${e.name} [${h}]`,t,i,e.getScene(),!0,a,n);return o(e,h,l,r),l.attachToMesh(e,s),l}static _CreateMaterial(e,t,i,s){const r=(0,Ft.n9)("BABYLON.StandardMaterial");if(!r)throw"StandardMaterial needs to be imported before as it contains a side-effect required by your code.";const n=new r(`AdvancedDynamicTextureMaterial for ${e.name} [${t}]`,e.getScene());n.backFaceCulling=!1,n.diffuseColor=bt.v9.Black(),n.specularColor=bt.v9.Black(),s?(n.diffuseTexture=i,n.emissiveTexture=i,i.hasAlpha=!0):(n.emissiveTexture=i,n.opacityTexture=i),e.material=n}static CreateForMeshTexture(e,t=1024,i=1024,s=!0,r,n=Dt.g.TRILINEAR_SAMPLINGMODE){const o=new Ms(e.name+" AdvancedDynamicTexture",t,i,e.getScene(),!0,n,r);return o.attachToMesh(e,s),o}static CreateFullscreenUI(e,t=!0,i=null,s=Dt.g.BILINEAR_SAMPLINGMODE,r=!1){const n=!i||i._isScene?new Ms(e,0,0,i,!1,s):new Ms(e,i),o=n.getScene(),a=new us(e+"_layer",null,o,!t);if(a.texture=n,n._layerToDispose=a,n._isFullscreen=!0,n.useStandalone&&(a.layerMask=0),r&&o){const e=1/o.getEngine().getHardwareScalingLevel();n._rootContainer.scaleX=e,n._rootContainer.scaleY=e}return n.attach(),n}scale(e){super.scale(e),this.markAsDirty()}scaleTo(e,t){super.scaleTo(e,t),this.markAsDirty()}_checkGuiIsReady(){this.guiIsReady()&&(this.onGuiReadyObservable.notifyObservers(this),this.onGuiReadyObservable.clear())}guiIsReady(){return this._rootContainer.isReady()}}Ms.SnippetUrl=ui.Y.SnippetUrl,Ms.AllowGPUOptimizations=!0;class ws{constructor(e){this._guiSizeSubject=new Q({width:0,height:0}),this._guiHost=e}get guiSizeObservable(){return this._guiSizeSubject}tick(e){const t=this._guiSizeSubject.value,i=this._guiHost.getSize();i.width===t.width&&i.height===t.height||this._guiSizeSubject.next({width:i.width,height:i.height})}}class Os{constructor(e,t,i,s){this._controls=new Set,this._pointerOverControlLocker=new Ht,this._currentPointersNumber=0,this._log=e;const r=this._root=Ms.CreateFullscreenUI("UI",!0,{noMipmap:!0,useStandalone:!0}),n=1e3/30;let o=0;t.onBeforeCameraRenderObservable.add((e=>{if(e!==i)return;const t=performance.now();t<o||(r._checkUpdate(e),o=t+n)})),this._guiSizeMonitor=new ws(r),r.useInvalidateRectOptimization=!1,r.renderScale=1,r.anisotropicFilteringLevel=2,r.renderAtIdealSize=!1,r.useSmallestIdeal=!1,r.checkPointerEveryFrame=!1,s?.layerMask&&r.layer&&(r.layer.layerMask=s.layerMask),this._scene=t,t.onPrePointerObservable.add((e=>{e.type===tt.Zp.POINTERDOWN?this._currentPointersNumber++:e.type===tt.Zp.POINTERUP&&this._currentPointersNumber--})),r.markAsDirty()}tick(e){this._guiSizeMonitor.tick(e)}onResize(e){e.orientation===ue.landscape?(this._root.renderAtIdealSize=!1,this._root.idealWidth=1920,this._root.idealHeight=1080,this._root.renderAtIdealSize=!0,this._root.markAsDirty(),this._root.update()):e.orientation===ue.portrait&&(this._root.renderAtIdealSize=!1,this._root.idealWidth=NaN,this._root.idealHeight=1920,this._root.renderAtIdealSize=!0,this._root.markAsDirty(),this._root.update())}get guiSizeObservable(){return this._guiSizeMonitor.guiSizeObservable}get isUIControlUnderPointer(){return this._pointerOverControlLocker.lockedObservable}addControl(e,t){this._root.addControl(e),e.parent=this._root.rootContainer,t||this.registerControl(e)}registerControl(e){if(this._controls.has(e))return void this._log.debug(`Control '${e.name}' is already registered. Ignoring.`);let t;this._log.debug(`Registering control '${e.name}'`),this._controls.add(e);const i=this._pointerOverControlLocker,s=[],r=()=>{s.forEach((e=>e.dispose())),s.length=0},n=this._root,o=this.isMobile,a=n.getScene();let h=!1;o&&a&&a.onPrePointerObservable.add((t=>{t.type===tt.Zp.POINTERUP&&(r(),h&&(e._onPointerOut(e,t,!0),h=!1))})),e.onPointerEnterObservable.add((()=>{e.isPointerBlocker?(h=!0,this._log.debug(`Control ${e.name} pointer ENTER`),t=e,s.push(i.lock(e.name||"unnamed"))):this._log.debug(`Pointer enter: Control ${e.name} is not a pointer blocker. Returning`)})),e.onPointerOutObservable.add((()=>{h=!1,this._log.debug(`Control ${e.name} pointer EXIT`),r(),t=void 0})),e.onIsVisibleChangedObservable.add((i=>{i||(this._log.debug(`Control ${e.name} became inivisible`),r(),t=void 0),setTimeout((()=>this.forcePickCheck()),1)})),e.onEnabledStateChangedObservable.add((e=>{e||r(),setTimeout((()=>this.forcePickCheck()),1)})),e.onDisposeObservable.addOnce((()=>{r(),t===e&&(t=void 0),this._controls.delete(e),setTimeout((()=>this.forcePickCheck()),1)}))}get host(){return this._root}forcePickCheck(){this.isMobile&&0===this._currentPointersNumber||this._root.pick(this._scene.pointerX,this._scene.pointerY)}get isMobile(){return this._scene.getEngine().hostInformation.isMobile}}!function(e){e.AllBettingUI="AllBettingUI",e.ButtonSpin="ButtonSpin",e.ButtonRebetAndSpin="ButtonRebetAndSpin",e.ButtonReBet="ButtonReBet",e.ButtonClear="ButtonClear",e.ButtonUndo="ButtonUndo",e.ButtonDouble="ButtonDouble",e.ButtonFavBet="ButtonFavBet",e.ButtonRacetrack="ButtonRacetrack",e.ButtonStats="ButtonStats",e.BetSelector="BetSelector",e.ButtonSettings="ButtonSettings",e.ButtonInfo="ButtonInfo",e.ButtonNewGame="ButtonNewGame",e.ButtonAudioOn="ButtonAudioOn",e.ButtonAudioOff="ButtonAudioOff",e.ButtonSkipWheelSpin="ButtonSkipWheelSpin"}(Ss||(Ss={}));var Bs=Array.isArray,Ds=Object.getPrototypeOf,Fs=Object.prototype,Ls=Object.keys;var Ns=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ks(e){return c(null==e?void 0:e.then)}function Us(e){return c(e[k])}function Vs(e){return Symbol.asyncIterator&&c(null==e?void 0:e[Symbol.asyncIterator])}function Gs(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var zs="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Hs(e){return c(null==e?void 0:e[zs])}function Ws(e){return function(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,r=i.apply(e,t||[]),n=[];return s=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),s[Symbol.asyncIterator]=function(){return this},s;function o(e,t){r[e]&&(s[e]=function(t){return new Promise((function(i,s){n.push([e,t,i,s])>1||a(e,t)}))},t&&(s[e]=t(s[e])))}function a(e,t){try{!function(e){e.value instanceof l?Promise.resolve(e.value.v).then(h,c):u(n[0][2],e)}(r[e](t))}catch(e){u(n[0][3],e)}}function h(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),n.shift(),n.length&&a(n[0][0],n[0][1])}}(this,arguments,(function(){var t,i,r;return s(this,(function(s){switch(s.label){case 0:t=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,l(t.read())];case 3:return i=s.sent(),r=i.value,i.done?[4,l(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,l(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Xs(e){return c(null==e?void 0:e.getReader)}function qs(e){if(e instanceof V)return e;if(null!=e){if(Us(e))return s=e,new V((function(e){var t=s[k]();if(c(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ns(e))return i=e,new V((function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()}));if(ks(e))return function(e){return new V((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,C)}))}(e);if(Vs(e))return Qs(e);if(Hs(e))return t=e,new V((function(e){var i,s;try{for(var n=r(t),o=n.next();!o.done;o=n.next()){var a=o.value;if(e.next(a),e.closed)return}}catch(e){i={error:e}}finally{try{o&&!o.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}}e.complete()}));if(Xs(e))return Qs(Ws(e))}var t,i,s;throw Gs(e)}function Qs(e){return new V((function(t){(function(e,t){var i,n,o,a,h,l,c,u;return h=this,l=void 0,u=function(){var h,l;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),i=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e=r(e),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=e[i]&&function(t){return new Promise((function(s,r){!function(e,t,i,s){Promise.resolve(s).then((function(t){e({value:t,done:i})}),t)}(s,r,(t=e[i](t)).done,t.value)}))}}}(e),s.label=1;case 1:return[4,i.next()];case 2:if((n=s.sent()).done)return[3,4];if(h=n.value,t.next(h),t.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=s.sent(),o={error:l},[3,11];case 6:return s.trys.push([6,,9,10]),n&&!n.done&&(a=i.return)?[4,a.call(i)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((c=void 0)||(c=Promise))((function(e,t){function i(e){try{r(u.next(e))}catch(e){t(e)}}function s(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof c?r:new c((function(e){e(r)}))).then(i,s)}r((u=u.apply(h,l||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function Ks(e,t,i,s,r){void 0===s&&(s=0),void 0===r&&(r=!1);var n=t.schedule((function(){i(),r?e.add(this.schedule(null,s)):this.unsubscribe()}),s);if(e.add(n),!r)return n}function Ys(e,t){return void 0===t&&(t=0),qe((function(i,s){i.subscribe(Qe(s,(function(i){return Ks(s,e,(function(){return s.next(i)}),t)}),(function(){return Ks(s,e,(function(){return s.complete()}),t)}),(function(i){return Ks(s,e,(function(){return s.error(i)}),t)})))}))}function js(e,t){return void 0===t&&(t=0),qe((function(i,s){s.add(e.schedule((function(){return i.subscribe(s)}),t))}))}function Zs(e,t){if(!e)throw new Error("Iterable cannot be null");return new V((function(i){Ks(i,t,(function(){var s=e[Symbol.asyncIterator]();Ks(i,t,(function(){s.next().then((function(e){e.done?i.complete():i.next(e.value)}))}),0,!0)}))}))}function $s(e,t){return t?function(e,t){if(null!=e){if(Us(e))return function(e,t){return qs(e).pipe(js(t),Ys(t))}(e,t);if(Ns(e))return function(e,t){return new V((function(i){var s=0;return t.schedule((function(){s===e.length?i.complete():(i.next(e[s++]),i.closed||this.schedule())}))}))}(e,t);if(ks(e))return function(e,t){return qs(e).pipe(js(t),Ys(t))}(e,t);if(Vs(e))return Zs(e,t);if(Hs(e))return function(e,t){return new V((function(i){var s;return Ks(i,t,(function(){s=e[zs](),Ks(i,t,(function(){var e,t,r;try{t=(e=s.next()).value,r=e.done}catch(e){return void i.error(e)}r?i.complete():i.next(t)}),0,!0)})),function(){return c(null==s?void 0:s.return)&&s.return()}}))}(e,t);if(Xs(e))return function(e,t){return Zs(Ws(e),t)}(e,t)}throw Gs(e)}(e,t):qs(e)}function Js(e,t){return qe((function(i,s){var r=0;i.subscribe(Qe(s,(function(i){s.next(e.call(t,i,r++))})))}))}var er,tr=Array.isArray;function ir(e){return e[e.length-1]}function sr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=function(e){return(t=ir(e))&&c(t.schedule)?e.pop():void 0;var t}(e),s=function(e){return c(ir(e))?e.pop():void 0}(e),r=function(e){if(1===e.length){var t=e[0];if(Bs(t))return{args:t,keys:null};if((s=t)&&"object"==typeof s&&Ds(s)===Fs){var i=Ls(t);return{args:i.map((function(e){return t[e]})),keys:i}}}var s;return{args:e,keys:null}}(e),o=r.args,a=r.keys;if(0===o.length)return $s([],i);var l,u=new V(function(e,t,i){return void 0===i&&(i=U),function(s){rr(t,(function(){for(var r=e.length,n=new Array(r),o=r,a=r,h=function(r){rr(t,(function(){var h=$s(e[r],t),l=!1;h.subscribe(Qe(s,(function(e){n[r]=e,l||(l=!0,a--),a||s.next(i(n.slice()))}),(function(){--o||s.complete()})))}),s)},l=0;l<r;l++)h(l)}),s)}}(o,i,a?function(e){return function(e,t){return e.reduce((function(e,i,s){return e[i]=t[s],e}),{})}(a,e)}:U));return s?u.pipe((l=s,Js((function(e){return function(e,t){return tr(t)?e.apply(void 0,h([],n(t))):e(t)}(l,e)})))):u}function rr(e,t,i){e?Ks(i,e,t):t()}class nr{constructor(e,t){this.name=e,this.payload=t}}class or extends nr{constructor(e){super(e)}}or.UI_Click=new or("UI_Click"),or.Win=new or("Win"),or.WinBanner=new or("WinBanner"),or.Lose=new or("Lose"),or.PlaceSingleChip=new or("PlaceSingleChip"),or.PlaceChipsStack=new or("PlaceChipsStack"),or.ClearTable=new or("ClearTable"),or.Welcome=new or("Welcome"),or.WinLow=new or("WinLow"),or.WinMid=new or("WinMid"),or.WinHigh=new or("WinHigh"),or.PlaceYourBets=new or("PlaceYourBets"),or.MaleVoiceSelected=new or("MaleVoiceSelected"),or.FemaleVoiceSelected=new or("FemaleVoiceSelected"),or.NoMoreBets=new or("NoMoreBets");class ar extends nr{static withNumber(e){return new ar("Announce Number",e)}}class hr extends xs{get isLoaded(){return this._loaded}isReady(){return this.isLoaded}get detectPointerOnOpaqueOnly(){return this._detectPointerOnOpaqueOnly}set detectPointerOnOpaqueOnly(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)}get sliceLeft(){return this._sliceLeft}set sliceLeft(e){this._sliceLeft!==e&&(this._sliceLeft=e,this._markAsDirty())}get sliceRight(){return this._sliceRight}set sliceRight(e){this._sliceRight!==e&&(this._sliceRight=e,this._markAsDirty())}get sliceTop(){return this._sliceTop}set sliceTop(e){this._sliceTop!==e&&(this._sliceTop=e,this._markAsDirty())}get sliceBottom(){return this._sliceBottom}set sliceBottom(e){this._sliceBottom!==e&&(this._sliceBottom=e,this._markAsDirty())}get sourceLeft(){return this._sourceLeft}set sourceLeft(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())}get sourceTop(){return this._sourceTop}set sourceTop(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())}get sourceWidth(){return this._sourceWidth}set sourceWidth(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())}get sourceHeight(){return this._sourceHeight}set sourceHeight(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get populateNinePatchSlicesFromImage(){return this._populateNinePatchSlicesFromImage}set populateNinePatchSlicesFromImage(e){this._populateNinePatchSlicesFromImage!==e&&(this._populateNinePatchSlicesFromImage=e,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())}get isSVG(){return this._isSVG}get svgAttributesComputationCompleted(){return this._svgAttributesComputationCompleted}get autoScale(){return this._autoScale}set autoScale(e){this._autoScale!==e&&(this._autoScale=e,e&&this._loaded&&this.synchronizeSizeWithContent())}get stretch(){return this._stretch}set stretch(e){this._stretch!==e&&(this._stretch=e,this._markAsDirty())}_rotate90(e,t=!1){const i=this._domImage.width,s=this._domImage.height,r=this._host?.getScene()?.getEngine()||os.q.LastCreatedEngine;if(!r)throw new Error("Invalid engine. Unable to create a canvas.");const n=r.createCanvas(s,i),o=n.getContext("2d");o.translate(n.width/2,n.height/2),o.rotate(e*Math.PI/2),o.drawImage(this._domImage,0,0,i,s,-i/2,-s/2,i,s);const a=n.toDataURL("image/jpg"),h=new hr(this.name+"rotated",a);return t&&(h._stretch=this._stretch,h._autoScale=this._autoScale,h._cellId=this._cellId,h._cellWidth=e%1?this._cellHeight:this._cellWidth,h._cellHeight=e%1?this._cellWidth:this._cellHeight),this._handleRotationForSVGImage(this,h,e),this._imageDataCache.data=null,h}_handleRotationForSVGImage(e,t,i){e._isSVG&&(e._svgAttributesComputationCompleted?(this._rotate90SourceProperties(e,t,i),this._markAsDirty()):e.onSVGAttributesComputedObservable.addOnce((()=>{this._rotate90SourceProperties(e,t,i),this._markAsDirty()})))}_rotate90SourceProperties(e,t,i){let s=e.sourceLeft,r=e.sourceTop,n=e.domImage.width,o=e.domImage.height,a=s,h=r,l=e.sourceWidth,c=e.sourceHeight;if(0!=i){const e=i<0?-1:1;i%=4;for(let t=0;t<Math.abs(i);++t)a=-(r-o/2)*e+o/2,h=(s-n/2)*e+n/2,[l,c]=[c,l],i<0?h-=c:a-=l,s=a,r=h,[n,o]=[o,n]}t.sourceLeft=a,t.sourceTop=h,t.sourceWidth=l,t.sourceHeight=c}_extractNinePatchSliceDataFromImage(){const e=this._domImage.width,t=this._domImage.height;if(!this._workingCanvas){const i=this._host?.getScene()?.getEngine()||os.q.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=i.createCanvas(e,t)}const i=this._workingCanvas.getContext("2d");i.drawImage(this._domImage,0,0,e,t);const s=i.getImageData(0,0,e,t);this._sliceLeft=-1,this._sliceRight=-1;for(let t=0;t<e;t++){const e=s.data[4*t+3];if(e>127&&-1===this._sliceLeft)this._sliceLeft=t;else if(e<127&&this._sliceLeft>-1){this._sliceRight=t;break}}this._sliceTop=-1,this._sliceBottom=-1;for(let i=0;i<t;i++){const t=s.data[i*e*4+3];if(t>127&&-1===this._sliceTop)this._sliceTop=i;else if(t<127&&this._sliceTop>-1){this._sliceBottom=i;break}}}set domImage(e){this._domImage=e,this._loaded=!1,this._imageDataCache.data=null,this._domImage.width?this._onImageLoaded():this._domImage.onload=()=>{this._onImageLoaded()}}get domImage(){return this._domImage}_onImageLoaded(){this._imageDataCache.data=null,this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()}get source(){return this._source}static ResetImageCache(){hr.SourceImgCache.clear()}_removeCacheUsage(e){const t=e&&hr.SourceImgCache.get(e);if(t){t.timesUsed-=1;const i=t.img;i.parentNode&&i.parentNode.removeChild(i),0===t.timesUsed&&hr.SourceImgCache.delete(e)}}set source(e){if(this._urlRewriter&&e&&(e=this._urlRewriter(e)),this._source===e)return;this._removeCacheUsage(this._source),this._loaded=!1,this._source=e,this._imageDataCache.data=null,e&&(e=this._svgCheck(e));const t=this._host?.getScene()?.getEngine()||os.q.LastCreatedEngine;if(!t)throw new Error("Invalid engine. Unable to create a canvas.");if(e&&hr.SourceImgCache.has(e)){const t=hr.SourceImgCache.get(e);return this._domImage=t.img,t.timesUsed+=1,void(t.loaded?this._onImageLoaded():t.waitingForLoadCallback.push(this._onImageLoaded.bind(this)))}this._domImage=t.createCanvasImage();const i=this._domImage;let s=!1;i.style&&this._source?.endsWith(".svg")&&(i.style.visibility="hidden",i.style.position="absolute",i.style.top="0",t.getRenderingCanvas()?.parentNode?.appendChild(i),s=!0),e&&hr.SourceImgCache.set(e,{img:this._domImage,timesUsed:1,loaded:!1,waitingForLoadCallback:[this._onImageLoaded.bind(this)]}),this._domImage.onload=()=>{if(e){const t=hr.SourceImgCache.get(e);if(t){t.loaded=!0;for(const e of t.waitingForLoadCallback)e();return t.waitingForLoadCallback.length=0,void(s&&i.remove())}}this._onImageLoaded(),s&&i.remove()},e&&($i.S0.SetCorsBehavior(e,this._domImage),$i.S0.SetReferrerPolicyBehavior(this.referrerPolicy,this._domImage),this._domImage.src=e)}_svgCheck(e){if(window.SVGSVGElement&&-1!==e.search(/(\.svg|\.svg?[?|#].*)$/gi)&&e.indexOf("#")===e.lastIndexOf("#")){this._isSVG=!0;const t=e.split("#")[0],i=e.split("#")[1],s=document.body.querySelector('object[data="'+t+'"]');if(s){const t=s.contentDocument;if(t&&t.documentElement){const r=t.documentElement.getAttribute("viewBox"),n=Number(t.documentElement.getAttribute("width")),o=Number(t.documentElement.getAttribute("height"));if(t.getElementById(i)&&r&&n&&o)return this._getSVGAttribs(s,i),e}s.addEventListener("load",(()=>{this._getSVGAttribs(s,i)}))}else{const e=document.createElement("object");e.data=t,e.type="image/svg+xml",e.width="0%",e.height="0%",document.body.appendChild(e),e.onload=()=>{const e=document.body.querySelector('object[data="'+t+'"]');e&&this._getSVGAttribs(e,i)}}return t}return e}_getSVGAttribs(e,t){const i=e.contentDocument;if(i&&i.documentElement){const e=i.documentElement.getAttribute("viewBox"),s=Number(i.documentElement.getAttribute("width")),r=Number(i.documentElement.getAttribute("height")),n=i.getElementById(t);if(e&&s&&r&&n){const t=Number(e.split(" ")[2]),i=Number(e.split(" ")[3]),o=n.getBBox();let a=1,h=1,l=0,c=0;const u=n.transform.baseVal.consolidate().matrix;n.transform&&n.transform.baseVal.consolidate()&&(a=u.a,h=u.d,l=u.e,c=u.f),this.sourceLeft=(a*o.x+l)*s/t,this.sourceTop=(h*o.y+c)*r/i,this.sourceWidth=o.width*a*(s/t),this.sourceHeight=o.height*h*(r/i),this._svgAttributesComputationCompleted=!0,this.onSVGAttributesComputedObservable.notifyObservers(this)}}}get cellWidth(){return this._cellWidth}set cellWidth(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())}get cellHeight(){return this._cellHeight}set cellHeight(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())}get cellId(){return this._cellId}set cellId(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())}constructor(e,t=null){super(e),this.name=e,this._workingCanvas=null,this._loaded=!1,this._stretch=hr.STRETCH_FILL,this._source=null,this._autoScale=!1,this._sourceLeft=0,this._sourceTop=0,this._sourceWidth=0,this._sourceHeight=0,this._svgAttributesComputationCompleted=!1,this._isSVG=!1,this._cellWidth=0,this._cellHeight=0,this._cellId=-1,this._populateNinePatchSlicesFromImage=!1,this._imageDataCache={data:null,key:""},this.onImageLoadedObservable=new Zi.cP,this.onSVGAttributesComputedObservable=new Zi.cP,this.source=t}contains(e,t){if(!super.contains(e,t))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;const i=0|this._currentMeasure.width,s=0|this._currentMeasure.height,r=i+"_"+s;let n=this._imageDataCache.data;if(!n||this._imageDataCache.key!==r){const e=this._workingCanvas.getContext("2d");this._imageDataCache.data=n=e.getImageData(0,0,i,s).data,this._imageDataCache.key=r}return n[4*((e=e-this._currentMeasure.left|0)+(t=t-this._currentMeasure.top|0)*i)+3]>0}_getTypeName(){return"Image"}synchronizeSizeWithContent(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")}_processMeasures(e,t){if(this._loaded)switch(this._stretch){case hr.STRETCH_NONE:case hr.STRETCH_FILL:case hr.STRETCH_UNIFORM:case hr.STRETCH_NINE_PATCH:break;case hr.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}super._processMeasures(e,t)}_prepareWorkingCanvasForOpaqueDetection(){if(!this._detectPointerOnOpaqueOnly)return;const e=this._currentMeasure.width,t=this._currentMeasure.height;if(!this._workingCanvas){const i=this._host?.getScene()?.getEngine()||os.q.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=i.createCanvas(e,t)}this._workingCanvas.getContext("2d").clearRect(0,0,e,t)}_drawImage(e,t,i,s,r,n,o,a,h){if(e.drawImage(this._domImage,t,i,s,r,n,o,a,h),!this._detectPointerOnOpaqueOnly)return;const l=e.getTransform(),c=this._workingCanvas.getContext("2d");c.save();const u=n-this._currentMeasure.left,d=o-this._currentMeasure.top;c.setTransform(l.a,l.b,l.c,l.d,(u+a)/2,(d+h)/2),c.translate(-(u+a)/2,-(d+h)/2),c.drawImage(this._domImage,t,i,s,r,u,d,a,h),c.restore()}_draw(e){let t,i,s,r;if(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)t=this._sourceLeft,i=this._sourceTop,s=this._sourceWidth?this._sourceWidth:this._imageWidth,r=this._sourceHeight?this._sourceHeight:this._imageHeight;else{const e=this._domImage.naturalWidth/this.cellWidth,n=this.cellId/e|0,o=this.cellId%e;t=this.cellWidth*o,i=this.cellHeight*n,s=this.cellWidth,r=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded)switch(this._stretch){case hr.STRETCH_NONE:case hr.STRETCH_FILL:this._drawImage(e,t,i,s,r,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case hr.STRETCH_UNIFORM:{const n=this._currentMeasure.width/s,o=this._currentMeasure.height/r,a=Math.min(n,o),h=(this._currentMeasure.width-s*a)/2,l=(this._currentMeasure.height-r*a)/2;this._drawImage(e,t,i,s,r,this._currentMeasure.left+h,this._currentMeasure.top+l,s*a,r*a);break}case hr.STRETCH_EXTEND:this._drawImage(e,t,i,s,r,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case hr.STRETCH_NINE_PATCH:this._renderNinePatch(e,t,i,s,r)}e.restore()}_renderNinePatch(e,t,i,s,r){const n=this.host.idealWidth?this._width.getValue(this.host)/this.host.idealWidth:this.host.idealHeight?this._height.getValue(this.host)/this.host.idealHeight:1,o=this._sliceLeft,a=this._sliceTop,h=r-this._sliceBottom,l=s-this._sliceRight,c=this._sliceRight-this._sliceLeft,u=this._sliceBottom-this._sliceTop,d=Math.round(o*n),_=Math.round(a*n),p=Math.round(h*n),g=Math.round(l*n),f=Math.round(this._currentMeasure.width)-g-d+2,m=Math.round(this._currentMeasure.height)-p-_+2,b=Math.round(this._currentMeasure.left)+d-1,v=Math.round(this._currentMeasure.top)+_-1,T=Math.round(this._currentMeasure.left+this._currentMeasure.width)-g,y=Math.round(this._currentMeasure.top+this._currentMeasure.height)-p;this._drawImage(e,t,i,o,a,this._currentMeasure.left,this._currentMeasure.top,d,_),this._drawImage(e,t+this._sliceLeft,i,c,a,b+1,this._currentMeasure.top,f-2,_),this._drawImage(e,t+this._sliceRight,i,l,a,T,this._currentMeasure.top,g,_),this._drawImage(e,t,i+this._sliceTop,o,u,this._currentMeasure.left,v+1,d,m-2),this._drawImage(e,t+this._sliceLeft,i+this._sliceTop,c,u,b+1,v+1,f-2,m-2),this._drawImage(e,t+this._sliceRight,i+this._sliceTop,l,u,T,v+1,g,m-2),this._drawImage(e,t,i+this._sliceBottom,o,h,this._currentMeasure.left,y,d,p),this._drawImage(e,t+this.sliceLeft,i+this._sliceBottom,c,h,b+1,y,f-2,p),this._drawImage(e,t+this._sliceRight,i+this._sliceBottom,l,h,T,y,g,p)}dispose(){super.dispose(),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear(),this._removeCacheUsage(this._source)}}hr.SourceImgCache=new Map,hr.STRETCH_NONE=0,hr.STRETCH_FILL=1,hr.STRETCH_UNIFORM=2,hr.STRETCH_EXTEND=3,hr.STRETCH_NINE_PATCH=4,(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"detectPointerOnOpaqueOnly",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"sliceLeft",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"sliceRight",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"sliceTop",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"sliceBottom",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"sourceLeft",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"sourceTop",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"sourceWidth",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"sourceHeight",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"populateNinePatchSlicesFromImage",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"autoScale",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"stretch",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"source",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"cellWidth",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"cellHeight",null),(0,Et.Cg)([(0,Rt.lK)()],hr.prototype,"cellId",null),(0,Ft.Y5)("BABYLON.GUI.Image",hr),function(e){e[e.Clip=0]="Clip",e[e.WordWrap=1]="WordWrap",e[e.Ellipsis=2]="Ellipsis",e[e.WordWrapEllipsis=3]="WordWrapEllipsis",e[e.HTML=4]="HTML"}(er||(er={}));class lr extends xs{get lines(){return this._lines}get resizeToFit(){return this._resizeToFit}set resizeToFit(e){this._resizeToFit!==e&&(this._resizeToFit=e,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())}get textWrapping(){return this._textWrapping}set textWrapping(e){this._textWrapping!==e&&(this._textWrapping=+e,this._markAsDirty())}get text(){return this._text}set text(e){this._text!==e&&(this._text=e+"",this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))}get textHorizontalAlignment(){return this._textHorizontalAlignment}set textHorizontalAlignment(e){this._textHorizontalAlignment!==e&&(this._textHorizontalAlignment=e,this._markAsDirty())}get textVerticalAlignment(){return this._textVerticalAlignment}set textVerticalAlignment(e){this._textVerticalAlignment!==e&&(this._textVerticalAlignment=e,this._markAsDirty())}set lineSpacing(e){this._lineSpacing.fromString(e)&&this._markAsDirty()}get lineSpacing(){return this._lineSpacing.toString(this._host)}get outlineWidth(){return this._outlineWidth}set outlineWidth(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())}get underline(){return this._underline}set underline(e){this._underline!==e&&(this._underline=e,this._markAsDirty())}get lineThrough(){return this._lineThrough}set lineThrough(e){this._lineThrough!==e&&(this._lineThrough=e,this._markAsDirty())}get applyOutlineToUnderline(){return this._applyOutlineToUnderline}set applyOutlineToUnderline(e){this._applyOutlineToUnderline!==e&&(this._applyOutlineToUnderline=e,this._markAsDirty())}get outlineColor(){return this._outlineColor}set outlineColor(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())}get wordDivider(){return this._wordDivider}set wordDivider(e){this._wordDivider!==e&&(this._wordDivider=e,this._markAsDirty())}get forceResizeWidth(){return this._forceResizeWidth}set forceResizeWidth(e){this._forceResizeWidth!==e&&(this._forceResizeWidth=e,this._markAsDirty())}constructor(e,t=""){super(e),this.name=e,this._text="",this._textWrapping=0,this._textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,this._textVerticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,this._resizeToFit=!1,this._lineSpacing=new ds(0),this._outlineWidth=0,this._outlineColor="white",this._underline=!1,this._lineThrough=!1,this._wordDivider=" ",this._forceResizeWidth=!1,this._applyOutlineToUnderline=!1,this.onTextChangedObservable=new Zi.cP,this.onLinesReadyObservable=new Zi.cP,this.reuseHTMLForWordWrapping=!1,this._linesTemp=[],this._htmlElement=null,this.text=t}_getTypeName(){return"TextBlock"}_processMeasures(e,t){this._fontOffset&&!this.isDirty||(this._fontOffset=xs._GetFontOffset(t.font,this._host.getScene()?.getEngine())),super._processMeasures(e,t),this._lines=this._breakLines(this._currentMeasure.width,this._currentMeasure.height,t),this.onLinesReadyObservable.notifyObservers(this);let i=0;for(let e=0;e<this._lines.length;e++){const t=this._lines[e];t.width>i&&(i=t.width)}if(this._resizeToFit){if(0===this._textWrapping||this._forceResizeWidth){const e=Math.ceil(this._paddingLeftInPixels)+Math.ceil(this._paddingRightInPixels)+Math.ceil(i);e!==this._width.getValueInPixel(this._host,this._tempParentMeasure.width)&&(this._width.updateInPlace(e,ds.UNITMODE_PIXEL),this._rebuildLayout=!0)}let e=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*this._lines.length|0;if(this._lines.length>0&&0!==this._lineSpacing.internalValue){let t=0;t=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),e+=(this._lines.length-1)*t}e!==this._height.internalValue&&(this._height.updateInPlace(e,ds.UNITMODE_PIXEL),this._rebuildLayout=!0)}}_drawText(e,t,i,s){const r=this._currentMeasure.width;let n=0;switch(this._textHorizontalAlignment){case xs.HORIZONTAL_ALIGNMENT_LEFT:n=0;break;case xs.HORIZONTAL_ALIGNMENT_RIGHT:n=r-t;break;case xs.HORIZONTAL_ALIGNMENT_CENTER:n=(r-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(s.shadowColor=this.shadowColor,s.shadowBlur=this.shadowBlur,s.shadowOffsetX=this.shadowOffsetX,s.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&s.strokeText(e,this._currentMeasure.left+n,i),s.fillText(e,this._currentMeasure.left+n,i),this._underline&&this._drawLine(this._currentMeasure.left+n,i+3,this._currentMeasure.left+n+t,i+3,s),this._lineThrough&&this._drawLine(this._currentMeasure.left+n,i-this.fontSizeInPixels/3,this._currentMeasure.left+n+t,i-this.fontSizeInPixels/3,s)}_drawLine(e,t,i,s,r){if(r.beginPath(),r.lineWidth=Math.round(.05*this.fontSizeInPixels),r.moveTo(e,t),r.lineTo(i,s),this.outlineWidth&&this.applyOutlineToUnderline)r.stroke(),r.fill();else{const e=r.strokeStyle;r.strokeStyle=r.fillStyle,r.stroke(),r.strokeStyle=e}r.closePath()}_draw(e){e.save(),this._applyStates(e),this._renderLines(e),e.restore()}_applyStates(e){super._applyStates(e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor,e.lineJoin="miter",e.miterLimit=2)}_breakLines(e,t,i){this._linesTemp.length=0;const s=4===this._textWrapping?this._parseHTMLText(e,t,i):this.text.split("\n");switch(this._textWrapping){case 1:for(const t of s)this._linesTemp.push(...this._parseLineWordWrap(t,e,i));break;case 2:for(const t of s)this._linesTemp.push(this._parseLineEllipsis(t,e,i));break;case 3:for(const r of s)this._linesTemp.push(...this._parseLineWordWrapEllipsis(r,e,t,i));break;default:for(const e of s)this._linesTemp.push(this._parseLine(e,i))}return this._linesTemp}_parseHTMLText(e,t,i){const s=[];this._htmlElement||(this._htmlElement=document.createElement("div"),document.body.appendChild(this._htmlElement));const r=this._htmlElement;r.textContent=this.text,r.style.font=i.font,r.style.position="absolute",r.style.visibility="hidden",r.style.top="-1000px",r.style.left="-1000px",this.adjustWordWrappingHTMLElement?.(r),r.style.width=e+"px",r.style.height=t+"px";const n=r.textContent;if(!n)return s;const o=r.childNodes[0],a=document.createRange();let h=0;for(const e of n){a.setStart(o,0),a.setEnd(o,h+1);const t=a.getClientRects().length-1;s[t]=(s[t]||"")+e,h++}return this.reuseHTMLForWordWrapping||(r.remove(),this._htmlElement=null),s}_parseLine(e="",t){return{text:e,width:this._getTextMetricsWidth(t.measureText(e))}}_getCharsToRemove(e,t,i){const s=e>t?e-t:0,r=e/i;return Math.max(Math.floor(s/r),1)}_parseLineEllipsis(e="",t,i){let s=this._getTextMetricsWidth(i.measureText(e)),r=this._getCharsToRemove(s,t,e.length);const n=Array.from&&Array.from(e);if(n)for(;n.length&&s>t;)n.splice(n.length-r,r),e=`${n.join("")}`,s=this._getTextMetricsWidth(i.measureText(e)),r=this._getCharsToRemove(s,t,e.length);else{for(;e.length>2&&s>t;)e=e.slice(0,-r),s=this._getTextMetricsWidth(i.measureText(e+"")),r=this._getCharsToRemove(s,t,e.length);e+=""}return{text:e,width:s}}_getTextMetricsWidth(e){return void 0!==e.actualBoundingBoxLeft?Math.abs(e.actualBoundingBoxLeft)+Math.abs(e.actualBoundingBoxRight):e.width}_parseLineWordWrap(e="",t,i){const s=[],r=this.wordSplittingFunction?this.wordSplittingFunction(e):e.split(this._wordDivider);let n=this._getTextMetricsWidth(i.measureText(e));for(let o=0;o<r.length;o++){const a=o>0?e+this._wordDivider+r[o]:r[0],h=this._getTextMetricsWidth(i.measureText(a));h>t&&o>0?(s.push({text:e,width:n}),e=r[o],n=this._getTextMetricsWidth(i.measureText(e))):(n=h,e=a)}return s.push({text:e,width:n}),s}_parseLineWordWrapEllipsis(e="",t,i,s){const r=this._parseLineWordWrap(e,t,s);for(let e=1;e<=r.length;e++)if(this._computeHeightForLinesOf(e)>i&&e>1){const i=r[e-2],n=r[e-1];r[e-2]=this._parseLineEllipsis(i.text+this._wordDivider+n.text,t,s);const o=r.length-e+1;for(let e=0;e<o;e++)r.pop();return r}return r}_renderLines(e){if(!this._fontOffset||!this._lines)return;const t=this._currentMeasure.height;let i=0;switch(this._textVerticalAlignment){case xs.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case xs.VERTICAL_ALIGNMENT_BOTTOM:i=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case xs.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(let t=0;t<this._lines.length;t++){const s=this._lines[t];0!==t&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(s.text,s.width,i,e),i+=this._fontOffset.height}}_computeHeightForLinesOf(e){let t=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*e;if(e>0&&0!==this._lineSpacing.internalValue){let i=0;i=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),t+=(e-1)*i}return t}isDimensionFullyDefined(e){return!!this.resizeToFit||super.isDimensionFullyDefined(e)}computeExpectedHeight(){if(this.text&&this.widthInPixels){const e=os.q.LastCreatedEngine?.createCanvas(0,0).getContext("2d");if(e){this._applyStates(e),this._fontOffset||(this._fontOffset=xs._GetFontOffset(e.font,this._host.getScene()?.getEngine()));const t=this._lines?this._lines:this._breakLines(this.widthInPixels-this._paddingLeftInPixels-this._paddingRightInPixels,this.heightInPixels-this._paddingTopInPixels-this._paddingBottomInPixels,e);return this._computeHeightForLinesOf(t.length)}}return 0}dispose(){super.dispose(),this.onTextChangedObservable.clear(),this._htmlElement?.remove(),this._htmlElement=null}}(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"resizeToFit",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"textWrapping",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"text",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"textHorizontalAlignment",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"textVerticalAlignment",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"lineSpacing",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"outlineWidth",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"underline",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"lineThrough",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"applyOutlineToUnderline",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"outlineColor",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"wordDivider",null),(0,Et.Cg)([(0,Rt.lK)()],lr.prototype,"forceResizeWidth",null),(0,Ft.Y5)("BABYLON.GUI.TextBlock",lr);class cr extends As{get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get cornerRadius(){return this._cornerRadius[0]}set cornerRadius(e){e<0&&(e=0),this._cornerRadius[0]===e&&this._cornerRadius[1]===e&&this._cornerRadius[2]===e&&this._cornerRadius[3]===e||(this._cornerRadius[0]=this._cornerRadius[1]=this._cornerRadius[2]=this._cornerRadius[3]=e,this._markAsDirty())}get cornerRadiusX(){return this._cornerRadius[0]}set cornerRadiusX(e){this._cornerRadius[0]!==e&&(this._cornerRadius[0]=e)}get cornerRadiusY(){return this._cornerRadius[1]}set cornerRadiusY(e){this._cornerRadius[1]!==e&&(this._cornerRadius[1]=e)}get cornerRadiusZ(){return this._cornerRadius[2]}set cornerRadiusZ(e){this._cornerRadius[2]!==e&&(this._cornerRadius[2]=e)}get cornerRadiusW(){return this._cornerRadius[3]}set cornerRadiusW(e){this._cornerRadius[3]!==e&&(this._cornerRadius[3]=e)}constructor(e){super(e),this.name=e,this._thickness=1,this._cornerRadius=[0,0,0,0],this._cachedRadius=[0,0,0,0]}_getTypeName(){return"Rectangle"}_computeAdditionalOffsetX(){let e=0;return 0===this._cornerRadius[0]&&0===this._cornerRadius[1]&&0===this._cornerRadius[2]&&0===this._cornerRadius[3]||(e+=1),this.thickness&&(e+=this.thickness/2),e}_computeAdditionalOffsetY(){let e=0;return 0===this._cornerRadius[0]&&0===this._cornerRadius[1]&&0===this._cornerRadius[2]&&0===this._cornerRadius[3]||(e+=1),this.thickness&&(e+=this.thickness/2),e}_getRectangleFill(e){return this._getBackgroundColor(e)}_localDraw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),(this._background||this._backgroundGradient)&&(e.fillStyle=this._getRectangleFill(e),0!==this._cornerRadius[0]||0!==this._cornerRadius[1]||0!==this._cornerRadius[2]||0!==this._cornerRadius[3]?(this._drawRoundedRect(e,this._thickness/2),e.fill()):e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),(this.color||this.gradient)&&(e.strokeStyle=this.gradient?this.gradient.getCanvasGradient(e):this.color),e.lineWidth=this._thickness,0!==this._cornerRadius[0]||0!==this._cornerRadius[1]||0!==this._cornerRadius[2]||0!==this._cornerRadius[3]?(this._drawRoundedRect(e,this._thickness/2),e.stroke()):e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness}_drawRoundedRect(e,t=0){const i=this._currentMeasure.left+t,s=this._currentMeasure.top+t,r=this._currentMeasure.width-2*t,n=this._currentMeasure.height-2*t;for(let e=0;e<this._cornerRadius.length;e++)this._cachedRadius[e]=Math.abs(Math.min(n/2,Math.min(r/2,this._cornerRadius[e])));e.beginPath(),e.moveTo(i+this._cachedRadius[0],s),e.lineTo(i+r-this._cachedRadius[1],s),e.arc(i+r-this._cachedRadius[1],s+this._cachedRadius[1],this._cachedRadius[1],3*Math.PI/2,2*Math.PI),e.lineTo(i+r,s+n-this._cachedRadius[2]),e.arc(i+r-this._cachedRadius[2],s+n-this._cachedRadius[2],this._cachedRadius[2],0,Math.PI/2),e.lineTo(i+this._cachedRadius[3],s+n),e.arc(i+this._cachedRadius[3],s+n-this._cachedRadius[3],this._cachedRadius[3],Math.PI/2,Math.PI),e.lineTo(i,s+this._cachedRadius[0]),e.arc(i+this._cachedRadius[0],s+this._cachedRadius[0],this._cachedRadius[0],Math.PI,3*Math.PI/2),e.closePath()}_clipForChildren(e){0===this._cornerRadius[0]&&0===this._cornerRadius[1]&&0===this._cornerRadius[2]&&0===this._cornerRadius[3]||(this._drawRoundedRect(e,this._thickness),e.clip())}}(0,Et.Cg)([(0,Rt.lK)()],cr.prototype,"thickness",null),(0,Et.Cg)([(0,Rt.lK)()],cr.prototype,"cornerRadius",null),(0,Et.Cg)([(0,Rt.lK)()],cr.prototype,"cornerRadiusX",null),(0,Et.Cg)([(0,Rt.lK)()],cr.prototype,"cornerRadiusY",null),(0,Et.Cg)([(0,Rt.lK)()],cr.prototype,"cornerRadiusZ",null),(0,Et.Cg)([(0,Rt.lK)()],cr.prototype,"cornerRadiusW",null),(0,Ft.Y5)("BABYLON.GUI.Rectangle",cr);class ur extends cr{get image(){return this._image}get textBlock(){return this._textBlock}constructor(e){super(e),this.name=e,this.thickness=1,this.isPointerBlocker=!0;let t=null;this.pointerEnterAnimation=()=>{t=this.alpha,this.alpha-=.1},this.pointerOutAnimation=()=>{null!==t&&(this.alpha=t)},this.pointerDownAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05}}_getTypeName(){return"Button"}_processPicking(e,t,i,s,r,n,o,a){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!super.contains(e,t))return!1;if(this.delegatePickingToChildren){let i=!1;for(let s=this._children.length-1;s>=0;s--){const r=this._children[s];if(r.isEnabled&&r.isHitTestVisible&&r.isVisible&&!r.notRenderable&&r.contains(e,t)){i=!0;break}}if(!i)return!1}return this._processObservables(s,e,t,i,r,n,o,a),!0}_onPointerEnter(e,t){return!!super._onPointerEnter(e,t)&&(!this.isReadOnly&&this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)}_onPointerOut(e,t,i=!1){!this.isReadOnly&&this.pointerOutAnimation&&this.pointerOutAnimation(),super._onPointerOut(e,t,i)}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(!this.isReadOnly&&this.pointerDownAnimation&&this.pointerDownAnimation(),!0)}_getRectangleFill(e){return this.isEnabled?this._getBackgroundColor(e):this._disabledColor}_onPointerUp(e,t,i,s,r,n){!this.isReadOnly&&this.pointerUpAnimation&&this.pointerUpAnimation(),super._onPointerUp(e,t,i,s,r,n)}serialize(e,t){super.serialize(e,t),(this.isSerializable||t)&&(this._textBlock&&(e.textBlockName=this._textBlock.name),this._image&&(e.imageName=this._image.name))}_parseFromContent(e,t){super._parseFromContent(e,t),e.textBlockName&&(this._textBlock=this.getChildByName(e.textBlockName)),e.imageName&&(this._image=this.getChildByName(e.imageName))}static CreateImageButton(e,t,i){const s=new this(e),r=new lr(e+"_button",t);r.textWrapping=!0,r.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,r.paddingLeft="20%",s.addControl(r);const n=new hr(e+"_icon",i);return n.width="20%",n.stretch=hr.STRETCH_UNIFORM,n.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,s.addControl(n),s._image=n,s._textBlock=r,s}static CreateImageOnlyButton(e,t){const i=new this(e),s=new hr(e+"_icon",t);return s.stretch=hr.STRETCH_FILL,s.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,i.addControl(s),i._image=s,i}static CreateSimpleButton(e,t){const i=new this(e),s=new lr(e+"_button",t);return s.textWrapping=!0,s.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,i.addControl(s),i._textBlock=s,i}static CreateImageWithCenterTextButton(e,t,i){const s=new this(e),r=new hr(e+"_icon",i);r.stretch=hr.STRETCH_FILL,s.addControl(r);const n=new lr(e+"_button",t);return n.textWrapping=!0,n.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,s.addControl(n),s._image=r,s._textBlock=n,s}}(0,Ft.Y5)("BABYLON.GUI.Button",ur);class dr extends xs{constructor(){super(...arguments),this._doNotRenderButInteract=!1}set doNotRenderButInteract(e){this._doNotRenderButInteract=e,this._markAsDirty()}get doNotRenderButInteract(){return this._doNotRenderButInteract}_onPointerUp(e,t,i,s,r,n){super._onPointerUp(e,t,i,s,r,n),this.contains(t.x,t.y)&&!this.host.getScene()?.getEngine().hostInformation.isMobile||this.onPointerOutObservable.notifyObservers(this,-1,e,this,n)}}class _r extends dr{get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(e){this._backgroundGradient!==e&&(this._backgroundGradient=e,this._markAsDirty())}get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get cornerRadius(){return this._cornerRadius[0]}set cornerRadius(e){e<0&&(e=0),this._cornerRadius[0]===e&&this._cornerRadius[1]===e&&this._cornerRadius[2]===e&&this._cornerRadius[3]===e||(this._cornerRadius[0]=this._cornerRadius[1]=this._cornerRadius[2]=this._cornerRadius[3]=e,this._markAsDirty())}get cornerRadiusX(){return this._cornerRadius[0]}set cornerRadiusX(e){this._cornerRadius[0]!==e&&(this._cornerRadius[0]=e)}get cornerRadiusY(){return this._cornerRadius[1]}set cornerRadiusY(e){this._cornerRadius[1]!==e&&(this._cornerRadius[1]=e)}get cornerRadiusZ(){return this._cornerRadius[2]}set cornerRadiusZ(e){this._cornerRadius[2]!==e&&(this._cornerRadius[2]=e)}get cornerRadiusW(){return this._cornerRadius[3]}set cornerRadiusW(e){this._cornerRadius[3]!==e&&(this._cornerRadius[3]=e)}constructor(e){super(e),this.name=e,this._thickness=1,this._cornerRadius=[0,0,0,0],this._cachedRadius=[0,0,0,0],this._background="",this._backgroundGradient=null}_getTypeName(){return"Rectangle"}_computeAdditionalOffsetX(){let e=0;return 0===this._cornerRadius[0]&&0===this._cornerRadius[1]&&0===this._cornerRadius[2]&&0===this._cornerRadius[3]||(e+=1),this.thickness&&(e+=this.thickness/2),e}_computeAdditionalOffsetY(){let e=0;return 0===this._cornerRadius[0]&&0===this._cornerRadius[1]&&0===this._cornerRadius[2]&&0===this._cornerRadius[3]||(e+=1),this.thickness&&(e+=this.thickness/2),e}_getRectangleFill(e){return this._getBackgroundColor(e)}_getBackgroundColor(e){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(e):this._background}_draw(e){this.doNotRenderButInteract?this._recalculateRadiusesCache(this._thickness/2):(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),(this._background||this._backgroundGradient)&&(e.fillStyle=this._getRectangleFill(e),0!==this._cornerRadius[0]||0!==this._cornerRadius[1]||0!==this._cornerRadius[2]||0!==this._cornerRadius[3]?(this._drawRoundedRect(e,this._thickness/2),e.fill()):e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),(this.color||this.gradient)&&(e.strokeStyle=this.gradient?this.gradient.getCanvasGradient(e):this.color),e.lineWidth=this._thickness,0!==this._cornerRadius[0]||0!==this._cornerRadius[1]||0!==this._cornerRadius[2]||0!==this._cornerRadius[3]?(this._drawRoundedRect(e,this._thickness/2),e.stroke()):e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore())}_drawRoundedRect(e,t=0){const i=this._currentMeasure.left+t,s=this._currentMeasure.top+t,r=this._currentMeasure.width-2*t,n=this._currentMeasure.height-2*t;this._recalculateRadiusesCache(t),e.beginPath(),e.moveTo(i+this._cachedRadius[0],s),e.lineTo(i+r-this._cachedRadius[1],s),e.arc(i+r-this._cachedRadius[1],s+this._cachedRadius[1],this._cachedRadius[1],3*Math.PI/2,2*Math.PI),e.lineTo(i+r,s+n-this._cachedRadius[2]),e.arc(i+r-this._cachedRadius[2],s+n-this._cachedRadius[2],this._cachedRadius[2],0,Math.PI/2),e.lineTo(i+this._cachedRadius[3],s+n),e.arc(i+this._cachedRadius[3],s+n-this._cachedRadius[3],this._cachedRadius[3],Math.PI/2,Math.PI),e.lineTo(i,s+this._cachedRadius[0]),e.arc(i+this._cachedRadius[0],s+this._cachedRadius[0],this._cachedRadius[0],Math.PI,3*Math.PI/2),e.closePath()}_recalculateRadiusesCache(e=0){this._currentMeasure.left,this._currentMeasure.top;const t=this._currentMeasure.width-2*e,i=this._currentMeasure.height-2*e;for(let e=0;e<this._cornerRadius.length;e++){const s=this._cornerRadius[e]<1?(i+t)/2*this._cornerRadius[e]:this._cornerRadius[e];this._cachedRadius[e]=Math.abs(Math.min(i/2,Math.min(t/2,s)))}}_clipForChildren(e){0===this._cornerRadius[0]&&0===this._cornerRadius[1]&&0===this._cornerRadius[2]&&0===this._cornerRadius[3]||(this._drawRoundedRect(e,this._thickness),e.clip())}contains(e,t){this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y;const[i,s,r,n]=[this._currentMeasure.left,this._currentMeasure.left+this._currentMeasure.width,this._currentMeasure.top,this._currentMeasure.top+this._currentMeasure.height],[o,a,h,l]=this._cachedRadius;if(e<i)return!1;if(e>s)return!1;if(t<r)return!1;if(t>n)return!1;const[c,u,d,_]=[[i+o,r+o],[s-a,r+a],[i+h,n-h],[s-l,n-l]];if(e<c[0]&&t<c[1]){const i=o*o,s=e-c[0],r=t-c[1];if(s*s+r*r>i)return!1}else if(e>u[0]&&t<u[1]){const i=a*a,s=e-u[0],r=t-u[1];if(s*s+r*r>i)return!1}else if(e<d[0]&&t>d[1]){const i=h*h,s=e-d[0],r=t-d[1];if(s*s+r*r>i)return!1}else if(e>_[0]&&t>_[1]){const i=l*l,s=e-_[0],r=t-_[1];if(s*s+r*r>i)return!1}return this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0}}class pr{static createImage(e,t,i){const s=new hr(t);return s.domImage=e,s.stretch=hr.STRETCH_UNIFORM,s.clipChildren=s.clipContent=!1,i?.setSizeRelativeToContainer&&this.setRelativeSize({control:s,containerSize:i?.setSizeRelativeToContainer,controlSize:e}),s.horizontalAlignment=i?.setPositionRelativeToContainer?.alignment?.horizontal??xs.HORIZONTAL_ALIGNMENT_CENTER,s.verticalAlignment=i?.setPositionRelativeToContainer?.alignment?.vertical??xs.HORIZONTAL_ALIGNMENT_CENTER,i?.setPositionRelativeToContainer&&this.setRelativePosition({control:s,containerSize:i.setPositionRelativeToContainer.container,position:{left:i.setPositionRelativeToContainer.position?.left||0,top:i.setPositionRelativeToContainer.position?.top||0}}),s}static createLabeledTextField(e,t,i,s){const r=new cr(`container-${t}`);r.background="black",r.width="200px",r.height="50px";const n=new lr(`lbl-${t}`);n.text=i,n.fontSize=16,n.color="white",n.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,n.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,n.textHorizontalAlignment=lr.HORIZONTAL_ALIGNMENT_CENTER,n.textVerticalAlignment=lr.VERTICAL_ALIGNMENT_TOP,r.addControl(n);const o=new lr(`txt-${t}`);return o.fontSize=24,o.color="white",o.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,o.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,o.textHorizontalAlignment=lr.HORIZONTAL_ALIGNMENT_CENTER,o.textVerticalAlignment=lr.VERTICAL_ALIGNMENT_BOTTOM,r.addControl(o),s?(s.addControl(r),e.registerControl(r)):e.addControl(r),{textContainer:r,valueText:o}}static setRelativeSize(e){e.control.width=e.controlSize.width/e.containerSize.width*100+"%",e.control.height=e.controlSize.height/e.containerSize.height*100+"%"}static setRelativePosition(e){e.control.left=e.position.left/e.containerSize.width*100+"%",e.control.top=e.position.top/e.containerSize.height*100+"%"}static createStandardButton(e){const t=ur.CreateSimpleButton(e.name,"");t.zIndex=e.controlParams?.zIndex??0,t.width=e.size.width,t.height=e.size.height,t.cornerRadius=e.size.cornerRadius??0,t.background=e.background??"white";const i=t.textBlock??(()=>{const i=new lr(`txt-${e.name}`);return t.addControl(i),i})();return i.resizeToFit=!0,i.fontFamily=e.font?.family??"",i.fontSize=e.font?.size??20,i.color=e.font?.color??"black",i.textHorizontalAlignment=lr.HORIZONTAL_ALIGNMENT_CENTER,i.textVerticalAlignment=lr.VERTICAL_ALIGNMENT_CENTER,i.horizontalAlignment=lr.HORIZONTAL_ALIGNMENT_CENTER,i.verticalAlignment=lr.VERTICAL_ALIGNMENT_CENTER,i.text=e.text,t.addControl(i),t.isPointerBlocker=!0,t}static createStandardDialogShroud(e){const t=new _r(e?.name??"shroud");return e?.invisible&&(t.doNotRenderButInteract=!0),t.background="black",t.width="100%",t.height="100%",t.alpha=e?.alpha??.6,t.color="#00000000",t.isPointerBlocker=!0,t}static calculateRefSizeConfig(e){return{landscape:pr.calculateRefSizeWithFractionConstraints({refSize:{content:e.contentRefSize,resolution:e.refResLandscape},maxHeightFraction:e.screenFraction.landscape.height,maxWidthFraction:e.screenFraction.landscape.width}),portrait:pr.calculateRefSizeWithFractionConstraints({refSize:{content:e.contentRefSize,resolution:{w:e.refResLandscape.h,h:e.refResLandscape.w}},maxHeightFraction:e.screenFraction.portrait.height,maxWidthFraction:e.screenFraction.portrait.width})}}static calculateRefSizeWithFractionConstraints(e){const t=e.refSize.content.w/e.refSize.content.h,i=e.refSize.resolution.w*e.maxWidthFraction,s=e.refSize.resolution.h*e.maxHeightFraction;let r=0,n=0;return i/s>=t?(r=s,n=r*t):(n=i,r=n/t),{resolution:e.refSize.resolution,content:{w:n,h:r}}}constructor(){}}class gr{constructor(){this._standardSmallButtonSizeLandscape=110,this._standardRegularButtonSizeLandscape=120,this._screenGapLandscape=35,this._spinSineButtonsOffset=this._screenGapLandscape+29.5,this._standardSmallButtonSizePortrait=135,this._standardRegularButtonSizePortrait=145,this._screenGapPortrait=40}apply(e,t,i){const s=t.width>t.height?ue.landscape:ue.portrait;this.layoutButtonSpin(e.buttons.spin,s,i),this.layoutButtonSpin(e.buttons.rebetAndSpin,s,i),this.layoutButtonRebet(e.buttons.rebet,s,i),this.layoutButtonUndo(e.buttons.undo,s,i),this.layoutButtonClear(e.buttons.clear,s,i),this.layoutButtonNewGame(e.buttons.newGame,s,i),this.layoutButtonDouble(e.buttons.double,s,i),this.layoutButtonSkipWheelSpin(e.buttons.skipWheelSpin,s,i),this.layoutButtonFavBet(e.buttons.favBet,s,i),this.layoutButtonSettings(e.buttons.settings,t,i),this.layoutButtonInfo(e.buttons.info,t,i),this.layoutButtonAudio([e.buttons.audioOn,e.buttons.audioOff],t,i),this.layoutButtonRacetrack(e.buttons.racetrack,s,i),this.layoutButtonStats(e.buttons.stats,t,i),this.layoutLastNumbersGrid(e.lastNumbersGrid,t,i),this.layoutMeters(e,s),this.layoutBetSelector(e.betSelector,t,i),this.layoutTableLimits(e.meters.minMaxBetContainer,s,i)}handPosition(e,t,i,s,r="px"){if(s)return e.horizontalAlignment=t,void(e.left=`${i}${r}`);const n=t===xs.HORIZONTAL_ALIGNMENT_CENTER?xs.HORIZONTAL_ALIGNMENT_CENTER:t===xs.HORIZONTAL_ALIGNMENT_LEFT?xs.HORIZONTAL_ALIGNMENT_RIGHT:xs.HORIZONTAL_ALIGNMENT_LEFT;e.horizontalAlignment=n,e.left=`${-i}${r}`}layoutButtonSpin(e,t,i){switch(e.width="200px",e.height="200px",t){case ue.landscape:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-(this._screenGapLandscape-10),i),e.top="-100px";break;case ue.portrait:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-10,i),e.top="1080px"}}layoutButtonUndo(e,t,i){switch(t){case ue.landscape:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-this._spinSineButtonsOffset,i),e.top="180px",e.width=`${this._standardRegularButtonSizeLandscape}px`,e.height=`${this._standardRegularButtonSizeLandscape}px`;break;case ue.portrait:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_LEFT,this._screenGapPortrait,i),e.top="1340px",e.width=`${this._standardRegularButtonSizePortrait}px`,e.height=`${this._standardRegularButtonSizePortrait}px`}}layoutButtonClear(e,t,i){switch(t){case ue.landscape:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,e.top="320px",this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-this._spinSineButtonsOffset,i),e.width=`${this._standardRegularButtonSizeLandscape}px`,e.height=`${this._standardRegularButtonSizeLandscape}px`;break;case ue.portrait:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_LEFT,this._screenGapPortrait,i),e.top="1160px",e.width=`${this._standardRegularButtonSizePortrait}px`,e.height=`${this._standardRegularButtonSizePortrait}px`}}layoutButtonNewGame(e,t,i){switch(t){case ue.landscape:return this.layoutButtonClear(e,t,i);case ue.portrait:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-this._screenGapPortrait,i),e.top="1520px",e.width=`${this._standardRegularButtonSizePortrait}px`,e.height=`${this._standardRegularButtonSizePortrait}px`}}layoutButtonRebet(e,t,i){switch(t){case ue.landscape:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-this._spinSineButtonsOffset,i),e.top="460px",e.width=`${this._standardRegularButtonSizeLandscape}px`,e.height=`${this._standardRegularButtonSizeLandscape}px`;break;case ue.portrait:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-this._screenGapPortrait,i),e.top="1340px",e.width=`${this._standardRegularButtonSizePortrait}px`,e.height=`${this._standardRegularButtonSizePortrait}px`}}layoutButtonDouble(e,t,i){this.layoutButtonRebet(e,t,i)}layoutButtonSkipWheelSpin(e,t,i){this.layoutButtonSpin(e,t,i)}layoutButtonFavBet(e,t,i){switch(t){case ue.landscape:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-(this._screenGapLandscape+215),i),e.top=`${this._screenGapLandscape}px`,e.width=`${this._standardSmallButtonSizeLandscape}px`,e.height=`${this._standardSmallButtonSizeLandscape}px`;break;case ue.portrait:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-this._screenGapPortrait,i),e.top="380px",e.width=`${this._standardSmallButtonSizePortrait}px`,e.height=`${this._standardSmallButtonSizePortrait}px`}}layoutButtonRacetrack(e,t,i){switch(t){case ue.landscape:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-400,i),e.top=`${this._screenGapLandscape}px`,e.width=`${this._standardSmallButtonSizeLandscape}px`,e.height=`${this._standardSmallButtonSizeLandscape}px`;break;case ue.portrait:e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-this._screenGapPortrait,i),e.width=`${this._standardSmallButtonSizePortrait}px`,e.height=`${this._standardSmallButtonSizePortrait}px`,e.top="210px"}}layoutTableLimits(e,t,i){switch(t){case ue.landscape:e.width=322/2560*100+"%",e.height=124/1284*100+"%",e.top="-43px",i?(e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,e.left="50px"):(e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,e.left="-50px");break;case ue.portrait:e.width="260px",e.height="100px",e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,e.left="40px",e.top="-65px"}}layoutButtonStats(e,t,i){const s=t.width>t.height?ue.landscape:ue.portrait;switch(e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,s){case ue.landscape:{const t=108,s=t/154*110;e.width=`${t}px`,e.height=`${s}px`,e.top=`${this._screenGapLandscape}px`,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_LEFT,this._screenGapLandscape,i);break}case ue.portrait:{const t=this._standardRegularButtonSizePortrait,s=t/154*110;e.width=`${t}px`,e.height=`${s}px`,e.top="595px",this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_LEFT,40,i);break}}}layoutLastNumbersGrid(e,t,i){const s=t.width>t.height?ue.landscape:ue.portrait;switch(e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,s){case ue.landscape:e.rotation=0,e.width=433/2560*t.width+"px",e.height=117/1280*t.height+"px",e.top=`${this._screenGapLandscape+9}px`,i?(e.horizontalAlignment=As.HORIZONTAL_ALIGNMENT_LEFT,e.left=`${this._screenGapLandscape+85}px`,e.bgImage.scaleX=1,e.bgImage.left="0px"):(e.horizontalAlignment=As.HORIZONTAL_ALIGNMENT_RIGHT,e.left=`-${this._screenGapLandscape+90}px`,e.bgImage.scaleX=-1,e.bgImage.left="8px"),e.applyLayout("horizontal");break;case ue.portrait:e.rotation=Math.PI/2,e.width="470px",e.height="105px",e.top="840px",e.bgImage.scaleX=1,i?(e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,e.left="-135px"):(e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,e.left="108px"),e.applyLayout("vertical")}}layoutBetSelector(e,t,i){(t.width>t.height?ue.landscape:ue.portrait)===ue.landscape?(e.scaleX=e.scaleY=.7,e.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_LEFT,-9,i),e.top="100px",e.rotation=0,e.setGridPosition(i?"right":"left")):(e.scaleX=e.scaleY=.8,e.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-8,i),e.top="-900px",e.rotation=0,e.setGridPosition(i?"left":"right"))}layoutButtonSettings(e,t,i){switch(e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.orientation(t)){case ue.landscape:this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-(this._screenGapLandscape+34.5),i),e.top=`${this._screenGapLandscape}px`,e.width=`${this._standardSmallButtonSizeLandscape}px`,e.height=`${this._standardSmallButtonSizeLandscape}px`;break;case ue.portrait:this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_RIGHT,-this._screenGapPortrait,i),e.top=`${this._screenGapPortrait}px`,e.width=`${this._standardSmallButtonSizePortrait}px`,e.height=`${this._standardSmallButtonSizePortrait}px`}}layoutButtonInfo(e,t,i){const s=this.orientation(t);switch(e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,s){case ue.landscape:this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_LEFT,this._screenGapLandscape,i),e.top="130px",e.width=`${this._standardSmallButtonSizeLandscape}px`,e.height=`${this._standardSmallButtonSizeLandscape}px`;break;case ue.portrait:this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_LEFT,this._screenGapPortrait,i),e.top=`${this._screenGapPortrait}px`,e.width=`${this._standardSmallButtonSizePortrait}px`,e.height=`${this._standardSmallButtonSizePortrait}px`}}layoutButtonAudio(e,t,i){const s=this.orientation(t);e.forEach((e=>{e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,s===ue.landscape?(this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_LEFT,this._screenGapLandscape,i),e.top="250px",e.width=`${this._standardSmallButtonSizeLandscape}px`,e.height=`${this._standardSmallButtonSizeLandscape}px`):(this.handPosition(e,xs.HORIZONTAL_ALIGNMENT_LEFT,this._screenGapPortrait,i),e.top="210px",e.width=`${this._standardSmallButtonSizePortrait}px`,e.height=`${this._standardSmallButtonSizePortrait}px`)}))}layoutMeters(e,t){const i=e.meters.win,s=e.meters.balance,r=e.meters.bet;if(t===ue.landscape){const t="11px",n=1.1;e.meters.bottomBar.height="44px",this.setControlScale(i,n),i.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,i.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,i.top=t,i.left="90px",this.setControlScale(s,n),s.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,s.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,s.left="100px",s.top=t,this.setControlScale(r,n),r.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,r.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,r.left="40px",r.top=t}else{e.meters.bottomBar.height="65px";const t="-2px",n=1;this.setControlScale(i,n),i.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,i.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,i.left="120px",i.top=t,this.setControlScale(s,n),s.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,s.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,s.left=10,s.top=t,this.setControlScale(r,n),r.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,r.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,r.left=100,r.top=t}}setControlScale(e,t){e.scaleX=e.scaleY=t}orientation(e){return e.width>e.height?ue.landscape:ue.portrait}}gr._scaleLandscape=.7,gr._scalePortrait=.7;class fr{constructor(e,t,i){this._spinButtonClicked=new X,this._rebetAndSpinClicked=new X,this._rebetButtonClicked=new X,this._clearBetsClicked=new X,this._newGameClicked=new X,this._doubleButtonClicked=new X,this._undoClicked=new X,this._skipWheelSpinButtonClicked=new X,this._favBetButtonClicked=new X,this._settingsButtonClicked=new X,this._audioButtonClicked=new X,this._racetrackClicked=new X,this._statsClicked=new X,this._infoClicked=new X,this._controls=t,this._layout=i,this._spinButton=this.initSpinButton(t.buttons.spin,e),this.initRebetAndSpinButton(t.buttons.rebetAndSpin,e),this._rebetButton=this.initRebetButton(t.buttons.rebet,e),this._undoButton=this.initUndoButton(t.buttons.undo,e),this._clearButton=this.initClearButton(t.buttons.clear,e),this._doubleButton=this.initDoubleButton(t.buttons.double,e),this._skipWheelSpinButton=this.initSkipWheelSpinButton(t.buttons.skipWheelSpin,e),this._favBetButton=this.initFavBetButton(t.buttons.favBet,e),this._settingsButton=this.initSettingsButton(t.buttons.settings,e),this._numbersHistoryGrid=t.lastNumbersGrid,this.initRacetrackButton(t.buttons.racetrack,e),this.initStatsButton(t.buttons.stats,e),this.initInfoButton(t.buttons.info,e),this.initNewGameButton(t.buttons.newGame,e),this.initAudioButtons(t.buttons.audioOn,t.buttons.audioOff,e),this._audioOnButton=t.buttons.audioOn,this._audioOffButton=t.buttons.audioOff,this._playerBalanceMeter=this.initMeter(t.meters.balance,e),this._winMeter=this.initMeter(t.meters.win,e),this._betMeter=this.initMeter(t.meters.bet,e),this._betSelectorUI=this.initBetSelector(t.betSelector,e),this._betLimitsContainer=t.meters.minMaxBetContainer,e.addControl(t.meters.minMaxBetContainer),this._controlsMap=new Map([[Ss.ButtonClear,t.buttons.clear],[Ss.ButtonDouble,t.buttons.double],[Ss.ButtonFavBet,t.buttons.favBet],[Ss.ButtonReBet,t.buttons.rebet],[Ss.ButtonRebetAndSpin,t.buttons.rebetAndSpin],[Ss.ButtonSkipWheelSpin,t.buttons.skipWheelSpin],[Ss.ButtonSpin,t.buttons.spin],[Ss.ButtonUndo,t.buttons.undo],[Ss.BetSelector,t.betSelector],[Ss.ButtonSettings,t.buttons.settings],[Ss.ButtonAudioOn,t.buttons.audioOn],[Ss.ButtonAudioOff,t.buttons.audioOff],[Ss.ButtonRacetrack,t.buttons.racetrack],[Ss.ButtonStats,t.buttons.stats],[Ss.ButtonInfo,t.buttons.info],[Ss.ButtonNewGame,t.buttons.newGame]]),e.guiSizeObservable.subscribe(this.onGUIResize.bind(this))}setControlAlpha(e,t){this.getControlById(e).alpha=t}setBetLimits(e,t){this._betLimitsContainer.setBetLimits(e,t)}getControlById(e){const t=this._controlsMap.get(e);if(!t)throw new Z(`Unknown controll id '${e}'`);return t}setRightHanded(e){this._rightHanded=e,this._lastSize&&this.onGUIResize(this._lastSize)}setControlVisible(e,t){this.getControlById(e).isVisible=t}setControlEnabled(e,t){this.getControlById(e).isEnabled=t}onGUIResize(e){this._lastSize=e,this._layout.apply(this._controls,e,this._rightHanded)}setPlayerBalanceText(e){this._playerBalanceMeter.text=e}setTotalBetText(e){this._betMeter.text=e}setWinText(e){this._winMeter.text=e}setLastNumbers(e){this._numbersHistoryGrid.setNumbers(e)}get spinButtonClicked(){return this._spinButtonClicked}get clearBetsClicked(){return this._clearBetsClicked}get rebetClicked(){return this._rebetButtonClicked}get rebetAndSpinClicked(){return this._rebetAndSpinClicked}get undoClicked(){return this._undoClicked}get doubleClicked(){return this._doubleButtonClicked}get skipSpinClicked(){return this._skipWheelSpinButtonClicked}get favBetClicked(){return this._favBetButtonClicked}get settingsClicked(){return this._settingsButtonClicked}get audioClicked(){return this._audioButtonClicked}get racetrackClicked(){return this._racetrackClicked}get statsClicked(){return this._statsClicked}get infoClicked(){return this._infoClicked}get newGameClicked(){return this._newGameClicked}getBetSelectorUI(){return this._betSelectorUI}initSpinButton(e,t){return e.onPointerClickObservable.add((()=>{this._spinButtonClicked.next()})),t.addControl(e),e}initRebetAndSpinButton(e,t){return e.onPointerClickObservable.add((()=>{this._rebetAndSpinClicked.next()})),t.addControl(e),e}initRebetButton(e,t){return e.onPointerClickObservable.add((()=>{this._rebetButtonClicked.next()})),t.addControl(e),e}initUndoButton(e,t){return e.onPointerClickObservable.add((()=>{this._undoClicked.next()})),t.addControl(e),e}initClearButton(e,t){return e.onPointerClickObservable.add((()=>{this._clearBetsClicked.next()})),t.addControl(e),e}initNewGameButton(e,t){return e.onPointerClickObservable.add((()=>{this._newGameClicked.next()})),t.addControl(e),e}initDoubleButton(e,t){return e.onPointerClickObservable.add((()=>{this._doubleButtonClicked.next()})),t.addControl(e),e}initSkipWheelSpinButton(e,t){return e.onPointerClickObservable.add((()=>{this._skipWheelSpinButtonClicked.next()})),t.addControl(e),e}initFavBetButton(e,t){return e.onPointerClickObservable.add((()=>{this._favBetButtonClicked.next()})),t.addControl(e),e}initRacetrackButton(e,t){return e.onPointerClickObservable.add((()=>{this._racetrackClicked.next()})),t.addControl(e),e}initStatsButton(e,t){return e.onPointerClickObservable.add((()=>{this._statsClicked.next()})),t.addControl(e),e}initInfoButton(e,t){return e.onPointerClickObservable.add((()=>{this._infoClicked.next()})),t.addControl(e),e}initSettingsButton(e,t){return e.onPointerClickObservable.add((()=>{this._settingsButtonClicked.next()})),t.addControl(e),e}initAudioButtons(e,t,i){return e.onPointerClickObservable.add((()=>{this._audioButtonClicked.next()})),t.onPointerClickObservable.add((()=>{this._audioButtonClicked.next()})),i.addControl(e),i.addControl(t),{btnAudioOn:e,btnAudioOff:t}}initMeter(e,t){return t.addControl(e),e}initBetSelector(e,t){return t.addControl(e),e}initBetLimitsContainer(e){const t=new As("container-BetLimits");t.clipChildren=t.clipContent=!1;const i=(e,i,s)=>{const r=new lr(e,s);return t.addControl(r),r.fontFamily=ke.Rubik.name,r.fontSize="32px",r.color="white",r.fontWeight="bold",r.outlineColor="black",r.outlineWidth=5,r.width=`${i}px`,r.clipChildren=r.clipContent=!1,r},s=i("lbl-min",70,"MIN:"),r=i("lbl-max",70,"MAX:"),n=i("txt-min",130),o=i("txt-max",130);return s.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,s.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,r.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,n.verticalAlignment=s.verticalAlignment,n.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,n.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,n.left="100px",n.top=s.top,n.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,r.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,r.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,r.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,r.top="40px",o.verticalAlignment=r.verticalAlignment,o.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,o.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,o.left="100px",o.top=r.top,t.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,t.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,t.width="400px",t.height="50px",t.top="-100px",t.left="50px",e.addControl(t),{betLimitsContainer:t,minBetText:n,maxBetText:o}}}class mr extends As{constructor(e){super("table-bet-limits");const t=pr.createImage(e.frame,"tableLimitsFrame");this.addControl(t),t.width=t.height="100%",this.clipChildren=this.clipContent=!1;const i=(e,t,i)=>{const s=new lr(e,i);return this.addControl(s),s.fontFamily=ke.Rubik.name,s.fontSize="28%",s.color="white",s.fontWeight="bold",s.outlineColor="black",s.outlineWidth=5,s.clipChildren=s.clipContent=!1,s},s=this._minBetText=i("txt-min"),r=this._maxBetText=i("txt-max");s.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,s.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,s.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,s.left="-9%",s.width="100%",s.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,r.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,r.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,r.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,r.left="-9%",r.top="33%",r.width="100%",this.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM}setBetLimits(e,t){this._minBetText.text=e,this._maxBetText.text=t}}class br extends As{constructor(e,t,i){super(e);const s=this.createTextBlock(`${e}-text`,t);s.left=i,this.addControl(s),this.isPointerBlocker=!1,this._textBlock=s}get textBlock(){return this._textBlock}createTextBlock(e,t){const i=new lr(e);return i.fontFamily=t.family,i.fontSize=t.size,i.color=t.color,i.resizeToFit=!0,i.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,i.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,i.top=-1,i.textHorizontalAlignment=lr.HORIZONTAL_ALIGNMENT_LEFT,i.textVerticalAlignment=lr.VERTICAL_ALIGNMENT_CENTER,i.zIndex=10,i}set text(e){this._textBlock.text=e}_onPointerUp(e,t,i,s,r,n){super._onPointerUp(e,t,i,s,r,n),this.contains(t.x,t.y)||this.onPointerOutObservable.notifyObservers(this,-1,e,this,n)}}class vr extends As{get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get arc(){return this._arc}set arc(e){this._arc!==e&&(this._arc=e,this._markAsDirty())}constructor(e){super(e),this.name=e,this._thickness=1,this._arc=1}_getTypeName(){return"Ellipse"}_localDraw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),xs.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,this._arc,e),(this._backgroundGradient||this._background)&&(e.fillStyle=this._getBackgroundColor(e),e.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._thickness&&(this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.stroke()),e.restore()}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness}_clipForChildren(e){xs.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,this._arc,e),e.clip()}_renderHighlightSpecific(e){xs.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._highlightLineWidth/2,this._currentMeasure.height/2-this._highlightLineWidth/2,this._arc,e),e.stroke()}}(0,Et.Cg)([(0,Rt.lK)()],vr.prototype,"thickness",null),(0,Et.Cg)([(0,Rt.lK)()],vr.prototype,"arc",null),(0,Ft.Y5)("BABYLON.GUI.Ellipse",vr);class Tr extends As{}class yr extends Tr{static async build(e,t,i,s,r,n){const o={width:"100%",height:"100%",left:0,top:0,cornerRadius:.2},[a,h,l,c,u,d,_,p,g,f]=await Promise.all([e.load(Ne.UI_Chip_Black),e.load(Ne.UI_Chip_Blue),e.load(Ne.UI_Chip_Green),e.load(Ne.UI_Chip_Orange),e.load(Ne.UI_Chip_Pink),e.load(Ne.UI_Chip_Red),e.load(Ne.UI_Chip_White),e.load(Ne.UI_Chip_Yellow),fn.loadAndBuildStandardRectButton("btn-ChipDown",e,Ne.UI_BetSelector_Arrow,o,t),fn.loadAndBuildStandardRectButton("btn-ChipUp",e,Ne.UI_BetSelector_Arrow,o,t)]),m=164,b=Math.ceil(i.length/2),v=m*b+20*(b-1)+40,T=[_,d,l,a,h,p,u,c];[f,g].forEach((e=>{e.modifyImages((e=>{e.stretch=hr.STRETCH_FILL,e.width=120/90*100+"%",e.height=196/155*100+"%",e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,e.left="-14.4%",e.top="-3.9%"})),e.width="90px",e.height="155px"})),g.rotation=Math.PI/2,f.rotation=Math.PI/2,g.scaleX=-1,g.clipChildren=g.clipContent=!1;const y=new Map([["1",{l:".5%",t:"-1%"}],["5",{l:"0%",t:"-1%"}]]),x=(e,t)=>{const r=i.indexOf(e),n=T[r],o=pr.createImage(n,`img-chip-${e}`);o.width=o.height=`${t}px`,o.stretch=hr.STRETCH_FILL,o.isPointerBlocker=o.isHitTestVisible=!1;const a=s.centsToCurrencyString(e),h=a.length,l=new lr(`lbl-chip-${e}`);l.fontFamily="Arial",l.fontStyle="bold",l.color="white",l.fontSize=h<=1?"45%":h<=2?"40%":h<=3?"30%":h<=4?"25%":h<=5?"20%":"17%",l.resizeToFit=!0,l.zIndex=1,l.text=a,l.outlineColor="black",l.textHorizontalAlignment=lr.HORIZONTAL_ALIGNMENT_CENTER,l.textVerticalAlignment=lr.VERTICAL_ALIGNMENT_CENTER;const c=y.get(a);l.left=c?.l||"0px",l.top=c?.t||"-0.5%",l.isPointerBlocker=l.isHitTestVisible=!1;const u=new Ar(`chip-${e}`,o,l);return u.width="100%",u.height=`${t}px`,l.outlineWidth=.05*u.heightInPixels,u.isPointerBlocker=u.isHitTestVisible=!1,u},A=new Map(i.map((e=>[e,x(e,m)]))),C=new xr("chipsGrid",n,{chips:A,gridParams:{cellSize:m,gap:20,padding:20,col:2,w:388,h:v}},t);t.registerControl(C);const S=new _r("chipsGridBG");S.width=S.height="100%",S.thickness=5,S.background="#000000FF",S.cornerRadius=.1,C.addControl(S),C.width="388px",C.height=`${v}px`;const E=new yr("ctrl-betSelector",t,{btnDown:g,btnUp:f,chips:new Map(i.map((e=>[e,x(e,m)]))),chipsGrid:C},r);return t.registerControl(E),E}constructor(e,t,i,s){super(e),this._prevClicked=new X,this._nextClicked=new X,this._betSelected=new X,this._gridOpened=new X,this._gridChipSelected=new X,this._currentIndex=0;const r=this.initChipsContainer(i.chips,380,140,0);this._chipsAnimationContainer=r.animatedContainer,this._chips=i.chips,this._chipsGrid=i.chipsGrid,this.isHitTestVisible=this.isPointerBlocker=!1,i.chipsGrid.chipSelected.subscribe((e=>{this._gridChipSelected.next(),this._betSelected.next(e),this.setActiveBet(e),i.chipsGrid.hide()})),this.addControl(i.chipsGrid),this._getValueTargetPosition=e=>r.targetPositions.get(e)??(()=>{throw new Z(`Target position for chip value ${e} is not defined`)})(),this._values=[...i.chips.keys()],this._btnNext=i.btnUp,this._btnPrev=i.btnDown,this.clipChildren=!1,this.clipContent=!1,this.addControl(i.btnDown).addControl(i.btnUp),i.btnDown.top=217,i.btnUp.top=-213,i.btnDown.left=i.btnUp.left="0%",this.width="200px",this.height="400px",i.btnDown.onPointerClickObservable.add((()=>{this._prevClicked.next()})),i.btnUp.onPointerClickObservable.add((()=>{this._nextClicked.next()})),this._chips.forEach(((e,t)=>{const i=t===s;e.scaleX=e.scaleY=i?yr.SelectedScale:yr.UnselectedScale,e.alpha=i?yr.SelectedAlpha:yr.UnselectedAlpha,e.isPointerBlocker=e.isHitTestVisible=i})),this.setActiveBet(s,AbortSignal.abort(ei.JumpToEnd));const n=this._btnOpenGrid=new _r("btn-OpenGrid");n.doNotRenderButInteract=!0,n.width="100%",n.height="80%",this._chipsGrid.hide(),n.isPointerBlocker=!0,n.onPointerClickObservable.add((()=>{this._chipsGrid.isShown||(this._chipsGrid.show(),this._gridOpened.next())})),this.addControl(n),t.registerControl(n)}hideGrid(){this._chipsGrid.hide()}setGridPosition(e){switch(e){case"left":this._chipsGrid.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this._chipsGrid.left="-200%";break;case"right":this._chipsGrid.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,this._chipsGrid.left="200%"}}initChipsContainer(e,t,i,s){const r=new As("chips-mask");r.width="200px",r.height=`${t}px`,r.clipChildren=!1;const n=new As("chips-movingContainer");r.isHitTestVisible=n.isHitTestVisible=!1,r.isPointerBlocker=n.isPointerBlocker=!1,n.clipChildren=n.clipContent=!1,r.addControl(n);let o=0;const a=new Map;for(const t of[...e.keys()].sort(((e,t)=>e-t))){const r=e.get(t)??(()=>{throw new Z(`Chip for value ${t} is not defined`)})();n.addControl(r),r.top=o,a.set(t,-o),o-=i+s}return this.addControl(r),{animatedContainer:n,targetPositions:a}}get nextClicked(){return this._nextClicked}get prevClicked(){return this._prevClicked}get betSelected(){return this._betSelected}get gridOpened(){return this._gridOpened}get gridChipSelected(){return this._gridChipSelected}async setActiveBet(e,t){await this.setBetIndex(this._values.indexOf(e),t)}async selectNext(e){this._currentIndex<this._values.length-1&&(this._betSelected.next(this._values[this._currentIndex+1]),await this.setBetIndex(this._currentIndex+1,e))}async selectPrev(e){this._currentIndex>0&&(this._betSelected.next(this._values[this._currentIndex-1]),await this.setBetIndex(this._currentIndex-1,e))}async setBetIndex(e,t){this._currentTween&&await this._currentTween.abort(ei.JumpToEnd);const i=this,s=this._currentIndex,r=this._values[s],n=this._chips.get(r);this._currentIndex=e,this._btnPrev.isEnabled=e>0,this._btnNext.isEnabled=e<this._values.length-1,this._btnPrev.alpha=this._btnPrev.isEnabled?1:.7,this._btnNext.alpha=this._btnNext.isEnabled?1:.7;const o=this._values[e],a=this._chips.get(o),h=this._getValueTargetPosition(r),l=this._getValueTargetPosition(o)-h,c=yr.SelectedAlpha,u=yr.UnselectedAlpha,d=yr.SelectedScale,_=yr.UnselectedScale,p={_progress:0,get progress(){return this._progress},set progress(e){i._chipsAnimationContainer.top=h+l*e,n&&(n.alpha=c-(c-u)*e,n.scaleX=n.scaleY=d-(d-_)*e),a&&(a.alpha=u+(c-u)*e,a.scaleX=a.scaleY=_+(d-_)*e),this._progress=e}},g=i._currentTween=new ri((e=>(i._currentTween?i._currentTween.abort(ei.JumpToEnd):Promise.resolve()).then((()=>Jt.add({target:p,duration:yr.SlideDurationS},{progress:1},e))).then((()=>{i._currentTween===g&&(i._currentTween=null)}))));await g.promise}setMaxAvailableChipValue(e){this._chips.forEach(((t,i)=>{t.setDimmed(i>e)})),this._chipsGrid.setMaxAvailableChipValue(e)}}yr.SelectedScale=1,yr.UnselectedScale=.6,yr.SelectedAlpha=1,yr.UnselectedAlpha=.7,yr.SlideDurationS=.2;class xr extends As{constructor(e,t,i,s){super(e),this._chipSelected=new X,this.isPointerBlocker=this.isHitTestVisible=!0,this.clipChildren=this.clipContent=!1,this._chipsMap=i.chips,this.generateButtons(i.chips,i.gridParams,s);const r=pr.createStandardDialogShroud({alpha:.3});s.registerControl(r),this.addControl(r),r.zIndex=-1,r.onPointerClickObservable.add((()=>{this.hide()})),r.width=r.height="2000%"}show(){this._shown=!0,this.isVisible=!0}hide(){this._shown=!1,this.isVisible=!1}generateButtons(e,t,i){let s=0;const r=Math.ceil(e.size/t.col);e.forEach(((e,n)=>{e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,e.horizontalAlignment=As.HORIZONTAL_ALIGNMENT_LEFT,e.width=t.cellSize/t.w*100+"%",e.height=t.cellSize/t.h*100+"%",e.isPointerBlocker=e.isHitTestVisible=!0,i.registerControl(e);const o=r-Math.floor(s/t.col)-1,a=s%t.col,h=`${t.padding+a*(t.cellSize+t.gap)}px`,l=`${t.padding+o*(t.cellSize+t.gap)}px`;e.left=h,e.top=l,e.zIndex=1,this.addControl(e),e.onPointerClickObservable.add((()=>{this._chipSelected.next(n)})),s++}))}get chipSelected(){return this._chipSelected}get isShown(){return this._shown}setMaxAvailableChipValue(e){this._chipsMap.forEach(((t,i)=>{t.setDimmed(i>e)}))}}class Ar extends As{constructor(e,t,i){super(e),this.image=t;const s=new vr("dimmer");s.background="#000000aa",s.width="156px",s.height="156px",s.horizontalAlignment=t.horizontalAlignment,s.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,s.top="1px",s.left=t.left,s.zIndex=5,s.color="00000000",s.thickness=0,this.dimmer=s,this.addControl(t),this.addControl(i),this.addControl(s),s.isPointerBlocker=s.isHitTestVisible=!1,this.setDimmed(!1)}setDimmed(e){this.dimmer.isVisible=e}}class Cr extends As{constructor(e,t,i){if(super(e),this._shown=new X,this._hidden=new X,this._compositeDisposable=new qt,this.uiContainer=t,i?.shroud){let s=i.shroud;if(!0===s?s=pr.createStandardDialogShroud({name:`shroud-${e}`}):s instanceof xs||(s=pr.createStandardDialogShroud(s)),!(s instanceof xs))throw new Z("Could not create dialog shroud");this._shroud=s,this.addControl(s);const r=s.onPointerClickObservable.add((()=>{this.onShroudClicked()}));this.registerDisposable({dispose:()=>{r.remove()}}),this.width=this.height="100%",this._contentRoot=new As(`root-${e}`),t.registerControl(s),this.addControl(this._contentRoot)}else this._contentRoot=this;t.registerControl(this._contentRoot),this.setContentEnabled(!1),this.alpha=0,this.isVisible=!1,this.setShroudBlockEnabled(!1),this.isPointerBlocker=!0,this.clipChildren=this.clipContent=!1,this.contentRoot.clipChildren=this.contentRoot.clipContent=!1}dispose(){super.dispose()}onShroudClicked(){}addControlToRoot(e){return this.uiContainer.registerControl(e),this._contentRoot.addControl(e),e}getShowParams(){return{targetAlpha:1,timeS:.2}}getHideParams(){return{targetAlpha:0,timeS:.1}}show(e){return this.alpha=0,this.isVisible=!0,this.setShroudBlockEnabled(!0),this.animateAlpha(this.getShowParams(),e).then((()=>{this.setContentEnabled(!0),this._shown.next()})).catch((e=>{if(!si.isAbortError(e))throw e}))}hide(e){return e?.aborted&&(this.isVisible=!1),this.setContentEnabled(!1),this.animateAlpha(this.getHideParams(),e).then((()=>{this.setShroudBlockEnabled(!1),this._hidden.next()})).catch((e=>{if(!si.isAbortError(e))throw e}))}async animateAlpha(e,t){this._currentTween&&await this._currentTween.abort();const i=this._currentTween=new ri((s=>new Promise((r=>{this.isVisible=!0,Jt.add({target:this,duration:e.timeS,ease:$t.easeOutQuad},{alpha:e.targetAlpha},AbortSignal.any(t?[s,t]:[s])).then((()=>{this._currentTween===i&&(this._currentTween=void 0),0===e.targetAlpha&&(this.isVisible=!1),r()}))}))));await i.promise}setShroudBlockEnabled(e){this._shroud&&(this._shroud.isEnabled=e)}setContentEnabled(e){this.contentRoot.isEnabled=e}registerDisposable(e){this._compositeDisposable.add(e)}get onShown(){return this._shown}get onHidden(){return this._hidden}get contentRoot(){return this._contentRoot}}class Sr extends Cr{constructor(e,t,i,s){super(e,t,s),this.referenceLandscapeSize=i.landscape,this.referencePortraitSize=i.portrait}show(e){this._resizeSubscription=this.uiContainer.guiSizeObservable.subscribe(this.onGUIHostSizeChanged.bind(this));const t=this.uiContainer.guiSizeObservable.value;return this.onGUIHostSizeChanged(t),super.show(e)}hide(e){return this._resizeSubscription&&(this._resizeSubscription.unsubscribe(),this._resizeSubscription=null),super.hide(e)}onGUIHostSizeChanged(e){switch(e.width>e.height?ue.landscape:ue.portrait){case ue.landscape:{const t=this.referenceLandscapeSize.content.h/this.referenceLandscapeSize.resolution.h,i=e.height*t,s=i*this.referenceLandscapeSize.content.w/this.referenceLandscapeSize.content.h;this.contentRoot.width=`${s}px`,this.contentRoot.height=`${i}px`,this.resizeContentLandscape(e,i/this.referenceLandscapeSize.content.h);break}case ue.portrait:{const t=this.referencePortraitSize,i=t.content.w/t.content.h,s=t.resolution.w/t.resolution.h;if(e.width/e.height/s>=1){const s=e.height*t.content.h/t.resolution.h,r=s*i;this.contentRoot.width=`${r}px`,this.contentRoot.height=`${s}px`,this.resizeContentPortrait(e,s/t.content.h)}else{const s=e.width*t.content.w/t.resolution.w,r=s/i;this.contentRoot.width=`${s}px`,this.contentRoot.height=`${r}px`,this.resizeContentPortrait(e,s/t.content.w)}break}}}resizeContentLandscape(e,t){}resizeContentPortrait(e,t){}}class Er extends Cr{constructor(e,t,i){super(e,t,{shroud:{invisible:!0}}),this._shroudClicked=new X,this._currencyFormatter=i.currencyFormatter;const s=pr.createImage(i.frameImgElement,"img-background");this.addControlToRoot(s),s.width="100%",s.height="100%",s.stretch=hr.STRETCH_FILL;const r=this._numberContainer=new As("cnt-Number");r.width=i.circleImgElement.width/i.frameImgElement.width*100+"%",r.height=i.circleImgElement.height/i.frameImgElement.height*100+"%";const n=this._numberColorBackground=new vr("img-Color");n.background="#000000",n.height="98%",n.height="97%",n.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,r.addControl(n);const o=pr.createImage(i.circleImgElement,"img-Circle");o.width="100%",o.height="100%",r.addControl(o),o.zIndex=1,this.addControlToRoot(r);const a=this._txtWinningNumber=new lr("txt-winningNumber");a.fontFamily=ke.Rubik.name,a.fontWeight="bold",a.fontSize="50%",a.color="white",a.outlineWidth=8,a.top="-1%",a.outlineColor="#000000c3",a.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,a.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,a.textHorizontalAlignment=lr.HORIZONTAL_ALIGNMENT_CENTER,a.textVerticalAlignment=lr.VERTICAL_ALIGNMENT_CENTER,a.zIndex=10,a.text="00",r.addControl(a);const h=this._lblWinAmount=new lr("lbl-winAmount");h.fontFamily="Arial",h.fontSize="7%",h.color="white",h.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,h.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,h.textHorizontalAlignment=lr.HORIZONTAL_ALIGNMENT_CENTER,h.textVerticalAlignment=lr.VERTICAL_ALIGNMENT_CENTER,h.resizeToFit=!0,h.zIndex=10,h.text="YOU WON:",h.top="-20%",this.addControlToRoot(h);const l=this._txtWinAmount=new lr("txt-winAmount");l.fontFamily=ke.Rubik.name,l.fontSize="15%",l.color="#ffffff",l.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,l.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,l.textHorizontalAlignment=lr.HORIZONTAL_ALIGNMENT_CENTER,l.textVerticalAlignment=lr.VERTICAL_ALIGNMENT_CENTER,l.resizeToFit=!0,l.zIndex=10,l.text="$12,345.34",l.top="-3%",this.addControlToRoot(l)}updateLayoutForPiPCameraEnabled(e){this._pipCameraEnabled=e,this._lastSizeInfo&&this.onResize(this._lastSizeInfo)}onResize(e){if(this._lastSizeInfo=e,e.orientation===ue.landscape){const t=434/1284;this.contentRoot.height=100*t+"%";const i=e.referenceSizeLandscape.h*t/e.referenceSizeLandscape.w;this.contentRoot.width=100*i+"%",this.contentRoot.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this.contentRoot.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.contentRoot.left=this._pipCameraEnabled?"29.8%":"10%",this.contentRoot.top=166/1284*100+"%"}else{this.contentRoot.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this.contentRoot.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP;const t=.2,i=e.height*t,s=1.25*i/e.width;this.contentRoot.height=100*t+"%",this.contentRoot.width=i/e.width*100+"%",this.contentRoot.left=this._pipCameraEnabled?100*s+"%":"0%",this.contentRoot.top="9.18%"}}onShroudClicked(){this._shroudClicked.next()}get shroudClicked(){return this._shroudClicked}setData(e){this._lblWinAmount.isVisible=e.winAmountInCents>0,this._txtWinAmount.isVisible=e.winAmountInCents>0,this._numberColorBackground.background=e.winningNumber.color===At.Red?"#ff0500":e.winningNumber.color===At.Black?"#000000":"#00b300";const t=new Map([["1","-2%"],["11","-3%"],["12","-1%"]]);e.winAmountInCents>0?(this._txtWinAmount.text=this._currencyFormatter.centsToCurrencyString(e.winAmountInCents),this._numberContainer.top="-6%"):this._numberContainer.top="3%";const i=e.winningNumber.value===K.DOUBLE_ZERO_ID?"00":e.winningNumber.value.toString();return this._txtWinningNumber.text=i,this._txtWinningNumber.left=t.get(i)||"0%",this}}class Rr{static Combine(...e){return t=>{let i=t;return e.forEach((e=>{i=e(i)})),i}}static PixelFilterAdd(e){return t=>({r:t.r+e.r,g:t.g+e.g,b:t.b+e.b,a:t.a+e.a})}static guiImageFromDomImage(e,t){const i=new hr(e);return i.clipContent=!1,i.widthInPixels=t.width,i.heightInPixels=t.height,i.domImage=t,i}static processImage(e,t){const i=e instanceof hr?e.domImage:e,s=document.createElement("canvas"),r=s.getContext("2d")??(()=>{throw new Z("No context found")})();s.width=i.width,s.height=i.height,r.drawImage(i,0,0);const n=r.getImageData(0,0,i.width,i.height);for(let e=0;e<n.data.length/4;e++){const[i,s,r,o]=[4*e,4*e+1,4*e+2,4*e+3],a=t({r:n.data[i],g:n.data[s],b:n.data[r],a:n.data[o]});n.data[i]=a.r,n.data[s]=a.g,n.data[r]=a.b,n.data[o]=a.a}r.clearRect(0,0,i.width,i.height),r.putImageData(n,0,0);const o=new hr(`${e.name}-processed`,s.toDataURL());return s.parentElement?.removeChild(s),o.widthInPixels=i.width,o.heightInPixels=i.height,o}constructor(){}}Rr.PixelFilterDisabledButton=e=>{const t=.5*(.2989*e.r+.587*e.g+.114*e.b),i=t+.3*(100-t);return{r:i,g:i,b:i,a:e.a}},Rr.PixelFilterUnselectedButton=e=>{const t=.5*(.2989*e.r+.587*e.g+.114*e.b);return{r:t,g:t,b:t,a:e.a}},Rr.PixelFilterHighlightedButton=e=>e.a>250?{r:1.2*e.r+20,g:1.2*e.g+20,b:1.2*e.b+20,a:e.a}:e;var Pr,Ir,Mr,wr=function(e){function t(t,i){return e.call(this)||this}return i(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(p),Or={setInterval:function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var r=Or.delegate;return(null==r?void 0:r.setInterval)?r.setInterval.apply(r,h([e,t],n(i))):setInterval.apply(void 0,h([e,t],n(i)))},clearInterval:function(e){var t=Or.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Br=function(e){function t(t,i){var s=e.call(this,t,i)||this;return s.scheduler=t,s.work=i,s.pending=!1,s}return i(t,e),t.prototype.schedule=function(e,t){var i;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var s=this.id,r=this.scheduler;return null!=s&&(this.id=this.recycleAsyncId(r,s,t)),this.pending=!0,this.delay=t,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,i){return void 0===i&&(i=0),Or.setInterval(e.flush.bind(e,this),i)},t.prototype.recycleAsyncId=function(e,t,i){if(void 0===i&&(i=0),null!=i&&this.delay===i&&!1===this.pending)return t;null!=t&&Or.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var i,s=!1;try{this.work(e)}catch(e){s=!0,i=e||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,i=this.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,_(s,this),null!=t&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(wr),Dr=function(){function e(t,i){void 0===i&&(i=e.now),this.schedulerActionCtor=t,this.now=i}return e.prototype.schedule=function(e,t,i){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},e.now=de.now,e}(),Fr=new(function(e){function t(t,i){void 0===i&&(i=Dr.now);var s=e.call(this,t,i)||this;return s.actions=[],s._active=!1,s}return i(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var i;this._active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}},t}(Dr))(Br),Lr=u((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function Nr(e,t){var i,s=(i=e)instanceof Date&&!isNaN(i)?{first:e}:"number"==typeof e?{each:e}:e,r=s.first,n=s.each,o=s.with,a=void 0===o?kr:o,h=s.scheduler,l=void 0===h?null!=t?t:Fr:h,c=s.meta,u=void 0===c?null:c;if(null==r&&null==n)throw new TypeError("No timeout provided.");return qe((function(e,t){var i,s,o=null,h=0,c=function(e){s=Ks(t,l,(function(){try{i.unsubscribe(),qs(a({meta:u,lastValue:o,seen:h})).subscribe(t)}catch(e){t.error(e)}}),e)};i=e.subscribe(Qe(t,(function(e){null==s||s.unsubscribe(),h++,t.next(o=e),n>0&&c(n)}),void 0,void 0,(function(){(null==s?void 0:s.closed)||null==s||s.unsubscribe(),o=null}))),!h&&c(null!=r?"number"==typeof r?r:+r-l.now():n)}))}function kr(e){throw new Lr(e)}class Ur{constructor(e,t){this.name=e,this.betsSnapshot=t}toJSONString(){return`[${JSON.stringify(this.name)}, ${this.betsSnapshot.toJSONString()}]`}static fromJSON(e,t,i){const s=e[0],r=te.fromJSON(e[1],t,i);return new Ur(s,r)}}class Vr{get text(){return this._characters?this._characters.join(""):this._text}set text(e){this._text=e,this._characters=Array.from&&Array.from(e)}get length(){return this._characters?this._characters.length:this._text.length}removePart(e,t,i){if(this._text=this._text.slice(0,e)+(i||"")+this._text.slice(t),this._characters){const s=i?Array.from(i):[];this._characters.splice(e,t-e,...s)}}charAt(e){return this._characters?this._characters[e]:this._text.charAt(e)}substr(e,t){if(this._characters){e=isNaN(e)?0:e>=0?Math.min(e,this._characters.length):this._characters.length+Math.max(e,-this._characters.length),void 0===t?t=this._characters.length-e:(isNaN(t)||t<0)&&(t=0);const i=[];for(;--t>=0;)i[t]=this._characters[e+t];return i.join("")}return this._text.substring(e,t?t+e:void 0)}substring(e,t){if(this._characters){isNaN(e)?e=0:e>this._characters.length?e=this._characters.length:e<0&&(e=0),void 0===t?t=this._characters.length:isNaN(t)?t=0:t>this._characters.length?t=this._characters.length:t<0&&(t=0);const i=[];let s=0;for(;e<t;)i[s++]=this._characters[e++];return i.join("")}return this._text.substring(e,t)}isWord(e){const t=/\w/g;return this._characters?-1!==this._characters[e].search(t):-1!==this._text.search(t)}}class Gr extends xs{get outlineWidth(){return this._outlineWidth}set outlineWidth(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())}get outlineColor(){return this._outlineColor}set outlineColor(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())}get maxWidth(){return this._maxWidth.toString(this._host)}get maxWidthInPixels(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)}set maxWidth(e){this._maxWidth.toString(this._host)!==e&&this._maxWidth.fromString(e)&&this._markAsDirty()}get highligherOpacity(){return this._highligherOpacity}set highligherOpacity(e){this._highligherOpacity!==e&&(this._highligherOpacity=e,this._markAsDirty())}get onFocusSelectAll(){return this._onFocusSelectAll}set onFocusSelectAll(e){this._onFocusSelectAll!==e&&(this._onFocusSelectAll=e,this._markAsDirty())}get textHighlightColor(){return this._textHighlightColor}set textHighlightColor(e){this._textHighlightColor!==e&&(this._textHighlightColor=e,this._markAsDirty())}get margin(){return this._margin.toString(this._host)}get marginInPixels(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)}set margin(e){this._margin.toString(this._host)!==e&&this._margin.fromString(e)&&this._markAsDirty()}get autoStretchWidth(){return this._autoStretchWidth}set autoStretchWidth(e){this._autoStretchWidth!==e&&(this._autoStretchWidth=e,this._markAsDirty())}get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get focusedBackground(){return this._focusedBackground}set focusedBackground(e){this._focusedBackground!==e&&(this._focusedBackground=e,this._markAsDirty())}set focusedColor(e){this._focusedColor!==e&&(this._focusedColor=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get placeholderColor(){return this._placeholderColor}set placeholderColor(e){this._placeholderColor!==e&&(this._placeholderColor=e,this._markAsDirty())}get placeholderText(){return this._placeholderText}set placeholderText(e){this._placeholderText!==e&&(this._placeholderText=e,this._markAsDirty())}get deadKey(){return this._deadKey}set deadKey(e){this._deadKey=e}get highlightedText(){return this._highlightedText}set highlightedText(e){this._highlightedText!==e&&(this._highlightedText=e,this._markAsDirty())}get addKey(){return this._addKey}set addKey(e){this._addKey=e}get currentKey(){return this._currentKey}set currentKey(e){this._currentKey=e}get text(){return this._textWrapper.text}set text(e){const t=e.toString();this._textWrapper||(this._textWrapper=new Vr),this._textWrapper.text!==t&&(this._textWrapper.text=t,this._textHasChanged())}_textHasChanged(){this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this)}_applyStates(e){super._applyStates(e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor)}get width(){return this._width.toString(this._host)}set width(e){(this._width.toString(this._host)!==e||this._autoStretchWidth)&&(this._width.fromString(e)&&this._markAsDirty(),this.autoStretchWidth=!1)}constructor(e,t=""){super(e),this.name=e,this._placeholderText="",this._background="#222222",this._focusedBackground="#000000",this._placeholderColor="gray",this._thickness=1,this._margin=new ds(10,ds.UNITMODE_PIXEL),this._autoStretchWidth=!0,this._maxWidth=new ds(1,ds.UNITMODE_PERCENTAGE,!1),this._blinkIsEven=!1,this._cursorOffset=0,this._deadKey=!1,this._addKey=!0,this._currentKey="",this._isTextHighlightOn=!1,this._textHighlightColor="#d5e0ff",this._highligherOpacity=.4,this._highlightedText="",this._startHighlightIndex=0,this._endHighlightIndex=0,this._cursorIndex=-1,this._outlineWidth=0,this._outlineColor="white",this._onFocusSelectAll=!1,this._isPointerDown=!1,this.promptMessage="Please enter text:",this.disableMobilePrompt=!1,this.onTextChangedObservable=new Zi.cP,this.onBeforeKeyAddObservable=new Zi.cP,this.onTextHighlightObservable=new Zi.cP,this.onTextCopyObservable=new Zi.cP,this.onTextCutObservable=new Zi.cP,this.onTextPasteObservable=new Zi.cP,this.text=t,this.isPointerBlocker=!0,this._focusedColor="white"}onBlur(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);const e=this._host.getScene();this._onPointerDblTapObserver&&e&&e.onPointerObservable.remove(this._onPointerDblTapObserver)}onFocus(){if(!this._isEnabled)return;if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),"touch"===this._focusedBy&&!this.disableMobilePrompt){const e=prompt(this.promptMessage);return null!==e&&(this.text=e),void(this._host.focusedControl=null)}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add((e=>{switch(e.type){case Ji.COPY:this._onCopyText(e.event),this.onTextCopyObservable.notifyObservers(this);break;case Ji.CUT:this._onCutText(e.event),this.onTextCutObservable.notifyObservers(this);break;case Ji.PASTE:this._onPasteText(e.event),this.onTextPasteObservable.notifyObservers(this);break;default:return}}));const e=this._host.getScene();e&&(this._onPointerDblTapObserver=e.onPointerObservable.add((e=>{this._isFocused&&e.type===tt.Zp.POINTERDOUBLETAP&&this._processDblClick(e)}))),this._onFocusSelectAll&&this.selectAllText()}_getTypeName(){return"InputText"}keepsFocusWith(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null}processKey(e,t,i){if(!this.isReadOnly&&(!i||!i.ctrlKey&&!i.metaKey||67!==e&&86!==e&&88!==e)){if(i&&(i.ctrlKey||i.metaKey)&&65===e)return this.selectAllText(),void i.preventDefault();switch(e){case 32:t=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._textWrapper.text&&this._textWrapper.length>0){if(this.isTextHighlightOn)return this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this._blinkIsEven=!1,void(i&&i.preventDefault());if(0===this._cursorOffset)this.text=this._textWrapper.substring(0,this._textWrapper.length-1);else{const e=this._textWrapper.length-this._cursorOffset;e>0&&(this._textWrapper.removePart(e-1,e),this._textHasChanged())}}return void(i&&i.preventDefault());case 46:if(this.isTextHighlightOn)return this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,void(i&&i.preventDefault());if(this._textWrapper.text&&this._textWrapper.length>0&&this._cursorOffset>0){const e=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(e,e+1),this._textHasChanged(),this._cursorOffset--}return void(i&&i.preventDefault());case 13:return this._host.focusedControl=null,void(this.isTextHighlightOn=!1);case 35:return this._cursorOffset=0,this._blinkIsEven=!1,this.isTextHighlightOn=!1,void this._markAsDirty();case 36:return this._cursorOffset=this._textWrapper.length,this._blinkIsEven=!1,this.isTextHighlightOn=!1,void this._markAsDirty();case 37:if(this._cursorOffset++,this._cursorOffset>this._textWrapper.length&&(this._cursorOffset=this._textWrapper.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this.isTextHighlightOn){if(this._textWrapper.length===this._cursorOffset)return;this._endHighlightIndex=this._textWrapper.length-this._cursorOffset+1}return this._startHighlightIndex=0,this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=this._textWrapper.length,this.isTextHighlightOn=!0,void this._markAsDirty()}return this.isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._textWrapper.length:this._textWrapper.length-this._startHighlightIndex+1):(this.isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._textWrapper.length?this._textWrapper.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this.isTextHighlightOn=!1,void this._markAsDirty()}return this.isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this._textWrapper.length,i.preventDefault()),this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this.isTextHighlightOn){if(0===this._cursorOffset)return;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset-1}return this._endHighlightIndex=this._textWrapper.length,this.isTextHighlightOn=!0,this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=0,void this._markAsDirty()}return this.isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=this._textWrapper.length===this._endHighlightIndex?0:this._textWrapper.length-this._endHighlightIndex-1):(this.isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this.isTextHighlightOn=!1,void this._markAsDirty()}return this.isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._endHighlightIndex,this.isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty()}if(32===e&&(t=i?.key??" "),this._deadKey="Dead"===t,t&&(-1===e||32===e||34===e||39===e||e>47&&e<64||e>64&&e<91||e>159&&e<193||e>218&&e<223||e>95&&e<112)&&(this._currentKey=t,this.onBeforeKeyAddObservable.notifyObservers(this),t=this._currentKey,this._addKey&&!this._deadKey))if(this.isTextHighlightOn)this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex,t),this._textHasChanged(),this._cursorOffset=this._textWrapper.length-(this._startHighlightIndex+1),this.isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(0===this._cursorOffset)this.text+=this._deadKey&&i?.key?i.key:t;else{const e=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(e,e,t),this._textHasChanged()}}}_updateValueFromCursorIndex(e){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=e;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset;else{if(!(this._cursorIndex>this._cursorOffset))return this.isTextHighlightOn=!1,void this._markAsDirty();this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex}this.isTextHighlightOn=!0,this._markAsDirty()}_processDblClick(e){let t,i;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;do{i=this._endHighlightIndex<this._textWrapper.length&&this._textWrapper.isWord(this._endHighlightIndex)?++this._endHighlightIndex:0,t=this._startHighlightIndex>0&&this._textWrapper.isWord(this._startHighlightIndex-1)?--this._startHighlightIndex:0}while(t||i);this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()}selectAllText(){this._blinkIsEven=!0,this.isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._textWrapper.length,this._cursorOffset=this._textWrapper.length,this._cursorIndex=-1,this._markAsDirty()}processKeyboard(e){this.processKey(e.keyCode,e.key,e),super.processKeyboard(e)}_onCopyText(e){this.isTextHighlightOn=!1;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText}_onCutText(e){if(this._highlightedText){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText,this._highlightedText=""}}_onPasteText(e){let t="";t=e.clipboardData&&-1!==e.clipboardData.types.indexOf("text/plain")?e.clipboardData.getData("text/plain"):this._host.clipboardData;const i=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(i,i,t),this._textHasChanged()}_draw(e){e.save(),this._applyStates(e),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(e.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._fontOffset&&!this._wasDirty||(this._fontOffset=xs._GetFontOffset(e.font,this._host.getScene()?.getEngine()));const t=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(e.fillStyle=this.color);let i=this._beforeRenderText(this._textWrapper);this._isFocused||this._textWrapper.text||!this._placeholderText||(i=new Vr,i.text=this._placeholderText,this._placeholderColor&&(e.fillStyle=this._placeholderColor)),this._textWidth=e.measureText(i.text).width;const s=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+s)+"px",this._autoStretchWidth=!0);const r=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,n=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-s;if(e.save(),e.beginPath(),e.rect(t,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,n+2,this._currentMeasure.height),e.clip(),this._isFocused&&this._textWidth>n){const e=t-this._textWidth+n;this._scrollLeft||(this._scrollLeft=e)}else this._scrollLeft=t;if(this.outlineWidth&&e.strokeText(i.text,this._scrollLeft,this._currentMeasure.top+r),e.fillText(i.text,this._scrollLeft,this._currentMeasure.top+r),this._isFocused){if(this._clickedCoordinate){const t=this._scrollLeft+this._textWidth-this._clickedCoordinate;let s=0;this._cursorOffset=0;let r=0;do{this._cursorOffset&&(r=Math.abs(t-s)),this._cursorOffset++,s=e.measureText(i.substr(i.length-this._cursorOffset,this._cursorOffset)).width}while(s<t&&i.length>=this._cursorOffset);Math.abs(t-s)>r&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){const s=i.substr(i.length-this._cursorOffset),r=e.measureText(s).width;let o=this._scrollLeft+this._textWidth-r;o<t?(this._scrollLeft+=t-o,o=t,this._markAsDirty()):o>t+n&&(this._scrollLeft+=t+n-o,o=t+n,this._markAsDirty()),this.isTextHighlightOn||e.fillRect(o,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout((()=>{this._blinkIsEven=!this._blinkIsEven,this._markAsDirty()}),500),this.isTextHighlightOn){clearTimeout(this._blinkTimeout);const s=e.measureText(i.substring(this._startHighlightIndex)).width;let r=this._scrollLeft+this._textWidth-s;this._highlightedText=i.substring(this._startHighlightIndex,this._endHighlightIndex);let n=e.measureText(i.substring(this._startHighlightIndex,this._endHighlightIndex)).width;r<t&&(n-=t-r,n||(n=e.measureText(i.charAt(i.length-this._cursorOffset)).width),r=t),e.globalAlpha=this._highligherOpacity,e.fillStyle=this._textHighlightColor,e.fillRect(r,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,n,this._fontOffset.height),e.globalAlpha=1}}e.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(e.strokeStyle=this.focusedColor):this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()}_onPointerDown(e,t,i,s,r){return!(!super._onPointerDown(e,t,i,s,r)||!this.isReadOnly&&(this._clickedCoordinate=t.x,this.isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,this._host._capturingControl[i]=this,this._focusedBy=r.event.pointerType,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),0):!this._isEnabled||(this._host.focusedControl=this,0)))}_onPointerMove(e,t,i,s){this._host.focusedControl===this&&this._isPointerDown&&!this.isReadOnly&&(this._clickedCoordinate=t.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),super._onPointerMove(e,t,i,s)}_onPointerUp(e,t,i,s,r){this._isPointerDown=!1,delete this._host._capturingControl[i],super._onPointerUp(e,t,i,s,r)}_beforeRenderText(e){return e}set isTextHighlightOn(e){this._isTextHighlightOn!==e&&(e&&this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=e)}get isTextHighlightOn(){return this._isTextHighlightOn}dispose(){super.dispose(),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()}}(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"promptMessage",void 0),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"disableMobilePrompt",void 0),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"maxWidth",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"highligherOpacity",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"onFocusSelectAll",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"textHighlightColor",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"margin",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"autoStretchWidth",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"thickness",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"focusedBackground",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"background",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"placeholderColor",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"placeholderText",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"deadKey",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"text",null),(0,Et.Cg)([(0,Rt.lK)()],Gr.prototype,"width",null),(0,Ft.Y5)("BABYLON.GUI.InputText",Gr);class zr extends Sr{constructor(e,t,i){const s=i.bgImage.width,r=i.bgImage.height,n=972/s,o=1728/r,a=Math.min(n,o),h=.8*a;super(e,t,{landscape:{content:{w:r*h,h:s*h},resolution:{w:1920,h:1080}},portrait:{content:{w:s*a,h:r*a},resolution:{w:1080,h:1920}}},{shroud:!0}),this._onApplyClicked=new X,this._onAddNewClicked=new X,this._onDeleteClicked=new X,this._onCloseClicked=new X,this.clipChildren=this.clipContent=!1,this.isPointerBlocker=!0;const l=new hr("img-favBetBackground");l.domImage=i.bgImage,l.stretch=hr.STRETCH_FILL,l.isPointerBlocker=!0,l.clipChildren=l.clipContent=!1,this._bgImage=l,this.addControlToRoot(l);const c=this._btnClose=i.btnClose;this.addControlToRoot(i.btnClose),c.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,c.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,c.zIndex=10,c.adaptWidthToChildren=c.adaptHeightToChildren=!1,c.onPointerClickObservable.add((()=>{this.closeClicked()}));const u=this._titleImage=new hr("img-favBetTitle");u.domImage=i.titleImage,u.stretch=hr.STRETCH_UNIFORM,u.verticalAlignment=hr.VERTICAL_ALIGNMENT_TOP,this.addControlToRoot(u);const d=[];for(let e=0;e<i.slots;e++){const s=new Hr(`slot-${e}`,{currencyFormatter:i.currencyFormatter,index:e,images:i.slotImages,sharedButtonAdd:i.buttonAddPreset},t);this.addControlToRoot(s),d.push(s),s.applyClicked.subscribe((e=>{this._onApplyClicked.next(e)})),s.deleteClicked.subscribe((e=>{this._onDeleteClicked.next(e)})),s.addClicked.subscribe((e=>{this._onAddNewClicked.next(e)}))}this._slots=d}onShroudClicked(){this.closeClicked()}closeClicked(){this._onCloseClicked.next(),this.hide()}resizeContentLandscape(e){this._bgImage.rotation=Math.PI/2,this._bgImage.stretch=hr.STRETCH_FILL,this._bgImage.scaleX=-1,this._bgImage.width=e.width*this.referenceLandscapeSize.content.h*.85/this.referenceLandscapeSize.resolution.w+"px",this._bgImage.height=e.height*this.referenceLandscapeSize.content.w/this.referenceLandscapeSize.resolution.h+"px",this._bgImage.left="-1.62%",this._titleImage.top="7%",this._titleImage.height="12%",this._btnClose.top="5%",this._btnClose.left="-3%",this._btnClose.width=this._btnClose.height="80px";for(let e=0;e<this._slots.length;e++){const t=this._slots[e];t.width="48%",t.height="20%",t.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,t.left=e%2==0?"-24%":"24%",t.verticalAlignment=As.VERTICAL_ALIGNMENT_TOP;const i=23+18*Math.floor(e/2);t.top=`${i}%`}}resizeContentPortrait(e,t){this._bgImage.rotation=0,this._bgImage.scaleX=1,this._bgImage.stretch=hr.STRETCH_FILL,this._bgImage.width="100%",this._bgImage.height="100%",this._bgImage.left="0%",this._titleImage.top="4%",this._titleImage.height="8.5%",this._btnClose.top="2%",this._btnClose.left="-4.5%";const i=this.referencePortraitSize;i.content.w,i.content.h,i.resolution.w,i.resolution.h;e.width,e.height,i.content.h,this._btnClose.width=this._btnClose.height=100*t+"px";for(let e=0;e<this._slots.length;e++){const t=this._slots[e];t.width="90%",t.height="13%",t.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,t.verticalAlignment=As.VERTICAL_ALIGNMENT_TOP,t.left=0;const i=15+10*e;t.top=`${i}%`}}getSlot(e){return this._slots[e]}setSlotStateAvailable(e){this._slots.length<=e||this._slots[e].setState("availableSlot")}setSlotStateAddNew(e){this._slots.length<=e||this._slots[e].setState("addPreset")}setSlotStateLinked(e,t){this._slots.length<=e||this._slots[e].linkWithPreset(t).setState("presetLinked")}get onApplyClicked(){return this._onApplyClicked}get onAddNewClicked(){return this._onAddNewClicked}get onDeleteClicked(){return this._onDeleteClicked}get onCloseClicked(){return this._onCloseClicked}}class Hr extends As{constructor(e,t,i){super(e),this._btnAddSubscription=null,this._applyClicked=new X,this._deleteClicked=new X,this._addClicked=new X,this.index=t.index,this._currencyFormatter=t.currencyFormatter;const s=Hr.RefWidth,r=Hr.RefHeight;this.width=`${s}px`,this.height=`${r}px`,this.clipChildren=this.clipContent=!1;const n=this.createLinkedPresetContainer({btnDeleteImage:t.images.btnDelete,slotImage:t.images.linkedSlot,uiContainer:i});n.container,n.container.width=n.container.height="100%",this.addControl(n.container),this._linkedPresetContainer=n.container,this._btnApplyPreset=n.btnApply,this._btnDeletePreset=n.btnDelete,this._lblPresetName=n.textFieldName,this._lblTotalBet=n.textTotalBet;const o=this._availableSlotContainer=this.createAvailableSlotContainer({emptySlotImage:t.images.emptySlot});this.addControl(o),o.width="100%",o.height="100%",this._btnAddPreset=t.sharedButtonAdd,this.setState("availableSlot")}set savePresetEnabled(e){this._btnAddPreset.isEnabled=e}set applyPresetEnabled(e){this._btnApplyPreset.isEnabled=e}createLinkedPresetContainer(e){const t=new As("cnt-LinkedPreset");t.clipChildren=t.clipContent=!1;const i=fn.buildStandardRectButton("btn-UsePreset",e.slotImage,{cornerRadius:.1,height:"65%",width:"93%",left:0,top:"-15%"},e.uiContainer,{fitImageToContainer:!0,pressed:{scale:.96}});t.addControl(i),i.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,i.height="90%",i.width="80%",i.left="1%",i.modifyImages((e=>{e.stretch=hr.STRETCH_FILL}));const s=e=>{const i=new lr(e.name,e.text);return i.fontFamily=ke.Rubik.name,i.fontSize=e.size,i.resizeToFit=!0,i.isPointerBlocker=!1,i.isHitTestVisible=!1,t.addControl(i),i},r=s({name:"lbl-PresetName",text:"",size:"16%"});r.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,r.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,r.left="7%",r.top="12%",r.fontFamily=ke.Rubik.name,r.color="white";const n=s({name:"lbl-TotalBet",text:"",size:"20%"});n.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,n.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,n.left="7%",n.top="36%",n.fontFamily=ke.Rubik.name,n.color="white";const o=fn.buildStandardRectButton("btn-Delete",e.btnDeleteImage,{cornerRadius:.2,height:"67%",width:"75%",left:0,top:"-14%"},e.uiContainer,{fitImageToContainer:!0,pressed:{scale:.9}});return o.height="90%",o.width="23%",o.modifyImages((e=>{e.stretch=hr.STRETCH_FILL})),t.addControl(o),o.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,i.onPointerClickObservable.add((()=>{this._applyClicked.next(this)}).bind(this)),o.onPointerClickObservable.add((()=>{this._deleteClicked.next(this)}).bind(this)),{container:t,btnApply:i,btnDelete:o,textTotalBet:n,textFieldName:r}}createAvailableSlotContainer(e){const t=new As("cnt-AvailableSlot");t.clipChildren=t.clipContent=!1,t.width="100%",t.height="100%";const i=new hr("img-EmptySlot");return i.domImage=e.emptySlotImage,i.width="100%",i.height="100%",i.stretch=hr.STRETCH_UNIFORM,t.addControl(i),t}createAddSlotContainer(e){const t=new As("cnt-AddPreset");t.clipChildren=t.clipContent=!1,t.widthInPixels=e.width,t.heightInPixels=e.height;const i=pr.createStandardButton({name:"btn-AddPreset",text:"Save current bets...",size:{width:"100%",height:"100%",cornerRadius:.075},font:{family:ke.Rubik.name,size:30,color:"black"},background:"#ff8b33"});return t.addControl(i),i.onPointerClickObservable.add((()=>{this._addClicked.next(this)}).bind(this)),{container:t,btnAddPreset:i}}setState(e){return this._linkedPresetContainer.isVisible="presetLinked"===e,this._availableSlotContainer.isVisible="availableSlot"===e||"addPreset"===e,"addPreset"===e?this.containsControl(this._btnAddPreset)||(this._btnAddPreset.parent&&this._btnAddPreset.parent.removeControl(this._btnAddPreset),this.addControl(this._btnAddPreset),this._btnAddPreset.isVisible=!0,this._btnAddPreset.top="-13%",this._btnAddPreset.width="94%",this._btnAddPreset.height="60%",this._btnAddSubscription=this._btnAddPreset.onPointerClickObservable.add((()=>{this._addClicked.next(this)}).bind(this))):(this.containsControl(this._btnAddPreset)&&(this._btnAddPreset.isVisible=!1,this.removeControl(this._btnAddPreset)),this._btnAddSubscription&&(this._btnAddSubscription.remove(),this._btnAddSubscription=null)),this}linkWithPreset(e){return this._lblPresetName.text=e.name,this._lblTotalBet.text=this._currencyFormatter.centsToCurrencyString(e.betsSnapshot.totalBetCents),this._linkedPreset=e,this}get applyClicked(){return this._applyClicked}get deleteClicked(){return this._deleteClicked}get addClicked(){return this._addClicked}get linkedPreset(){return this._linkedPreset}}Hr.RefWidth=470,Hr.RefHeight=80;class Wr{constructor(e){this._viewInitialized=!1,this._actionsMap=new Map,this._viewLoading=e.viewLoading,this._enterPresetNameDialog=e.enterPresetNameDialog,this._maxSlots=e.maxSlots,this._favBetController=e.favBetController,this._log=e.log,this._applySnapshotActionFactory=e.applySnapshotActionFactory,this._audioEvents=e.audioEvents,this._placedBetsCollection=e.placedBetsCollection,this._deleteConfirmPresenter=e.deleteConfirmPresenter}async show(){const[e,t]=await Promise.all([ce(this._favBetController.presetsState.pipe(Ye((e=>void 0!==e))).pipe(Nr(1e3))),this._viewLoading]);this.initializeViewOnce(t),this.updateSlots(t,e),this._view=t,await t.show()}hide(){this._view&&(this._view.hide(),this._enterPresetNameDialog.hide(),this._deleteConfirmPresenter.hide())}updateSlots(e,t,i,s){t||(t=[]);let r=!0;const n=i??0,o=void 0===s?this._maxSlots:Math.min(this._maxSlots,n+s);for(let i=n;i<o;i++){const s=t[i],n=e.getSlot(i);s?(e.setSlotStateLinked(i,s),this.tryRelinkSlotAction(n,s)):(this.tryUnlinkSlotAction(n),r?(e.setSlotStateAddNew(i),r=!1):e.setSlotStateAvailable(i))}}tryRelinkSlotAction(e,t){const i=this._actionsMap.get(e);if(i){if(i.action.betSnapshot===t.betsSnapshot)return;i.disposable.dispose(),this._actionsMap.delete(e)}const s=this._applySnapshotActionFactory.create("Apply preset: preset.name",t.betsSnapshot,!1),r=s.availabilityObservable.subscribe((t=>{e.applyPresetEnabled=t})),n=e.applyClicked.subscribe((()=>{s.available?s.execute():(this._audioEvents.play(or.Lose),this._log.error("TODO: Notify that add is not possible"))}));this._actionsMap.set(e,{action:s,disposable:{dispose:()=>{s.dispose(),r.unsubscribe(),n.unsubscribe()}}})}tryUnlinkSlotAction(e){const t=this._actionsMap.get(e);t&&(t.disposable.dispose(),this._actionsMap.delete(e))}initializeViewOnce(e){if(this._viewInitialized)return;this._viewInitialized=!0;const t=(()=>{const t=this._placedBetsCollection.currentTotalBet>0;for(let i=0;i<this._maxSlots;i++)e.getSlot(i).savePresetEnabled=t}).bind(this);this._placedBetsCollection.updateObservable.subscribe(t),t(),e.onAddNewClicked.subscribe((t=>{const i=this._enterPresetNameDialog;this._audioEvents.play(or.UI_Click),ce(i.selectionMade).then((i=>{this._audioEvents.play(or.UI_Click),i&&(this._favBetController.addLast(new Ur(i.presetName,this._placedBetsCollection.getSnapshot())),this.updateSlots(e,this._favBetController.presetsState.value,t.index,2))}));const s=this._favBetController.presetsState.value??[],r=(()=>{let e=t.index+1,i=`Bet ${e}`;for(;s.find((e=>e.name===i));)e++,i=`Bet ${e}`;return i})();i.setText(`${r}`).show()})),e.onDeleteClicked.subscribe((t=>{this._audioEvents.play(or.UI_Click),this._deleteConfirmPresenter.ask().then((i=>{if(i){if(!t.linkedPreset)return void this._log.error(`Tried to delete preset from a lost #${t.index} which does not have a preset linked`);if(!this._favBetController.delete(t.linkedPreset))return void this._log.error(`Could not find preset '${t.linkedPreset.name}' in a store`);this.updateSlots(e,this._favBetController.presetsState.value,t.index),this._log.debug(`Detele ${t.index}`)}}))})),e.onCloseClicked.subscribe((()=>{this._audioEvents.play(or.UI_Click)}))}}class Xr extends Sr{constructor(e,t,i,s){super(e,t,{landscape:pr.calculateRefSizeWithFractionConstraints({refSize:{content:{w:s.background.width,h:s.background.height},resolution:{w:1920,h:1080}},maxHeightFraction:.5,maxWidthFraction:.5}),portrait:pr.calculateRefSizeWithFractionConstraints({refSize:{content:{w:s.background.width,h:s.background.height},resolution:{w:1080,h:1920}},maxHeightFraction:.8,maxWidthFraction:.95})},{shroud:!0}),this._selectionMade=new X,this._isMobile=i.mobile,this._inputTextInFocus=!1;const r=pr.createImage(s.message,"img-message");r.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,r.top="7%",r.width=s.message.width/s.background.width*100+"%",r.height=s.message.height/s.background.height*100+"%",this.addControlToRoot(r);const n=pr.createImage(s.background,"img-AddFavBet");n.isPointerBlocker=!0,n.width="100%",n.height="100%",n.zIndex=-1,this.addControlToRoot(n);const o=fn.buildStandardRectButton("btn-Add",s.btnAdd,{cornerRadius:.12,height:"75%",width:"90%",left:0,top:"-13%",vAlign:xs.VERTICAL_ALIGNMENT_TOP},t);o.modifyImages((e=>{e.width=e.height="100%",e.stretch=hr.STRETCH_FILL})),o.width=s.btnAdd.width/s.background.width*100+"%",o.height=s.btnAdd.height/s.background.height*100+"%",o.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,o.top="-8%",o.left="-20%",o.isEnabled=!1;const a=fn.buildStandardRectButton("btn-Cancel",s.btnCancel,{cornerRadius:.12,height:"75%",width:"90%",left:0,top:"-13%",vAlign:xs.VERTICAL_ALIGNMENT_TOP},t);a.modifyImages((e=>{e.width=e.height="100%",e.stretch=hr.STRETCH_FILL})),a.width=s.btnCancel.width/s.background.width*100+"%",a.height=s.btnCancel.height/s.background.height*100+"%",a.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,a.top="-8%",a.left="20%";const h=e=>e.trim(),l=new As("cnt-input");l.clipChildren=l.clipContent=!1,this.addControlToRoot(l),l.top="-10%";const c=pr.createImage(s.textBox,"textBox");l.addControl(c),c.width="100%",c.height="100%",c.stretch=hr.STRETCH_UNIFORM,l.width="90%",l.height="20%";const u=new Gr("input-PresetName");if(u.width="95%",u.height="95%",u.text="",u.color="white",u.background="#00000000",u.fontFamily="Arial",u.fontSize="40%",u.thickness=0,u.background="",u.focusedBackground="",u.disableMobilePrompt=!0,l.addControl(u),i.mobile){const e=this._inputElement=document.createElement("input");e.type="text",e.id="fav-bet-name-input",e.maxLength=i.maxNameLength,e.addEventListener("input",(t=>{const s=e.value;s.length>i.maxNameLength&&(e.value=s.substring(0,i.maxNameLength)),u.text=e.value})),e.style.position="absolute",e.style.top="50%",e.style.visibility="false",e.style.top="-100%",e.style.userSelect="none",document.body.appendChild(e),u.onPointerClickObservable.add((()=>{e.value=u.text,e.focus()}))}else u.onBeforeDrawObservable.addOnce((()=>{u.focus()}));u.onFocusObservable.add((()=>{this._inputTextInFocus=!0})),u.onBlurObservable.add((()=>{this._inputTextInFocus=!1})),u.onBeforeKeyAddObservable.add((()=>{u.text.length===i.maxNameLength&&(u.currentKey=""),0===u.text.length&&" "===u.currentKey&&(u.currentKey="")})),u.onTextChangedObservable.add((()=>{u.text.length>i.maxNameLength&&(u.text=h(h(u.text).substring(0,i.maxNameLength))),o.isEnabled=h(u.text).length>0})),u.onTextPasteObservable.add((()=>{u.text=h(h(u.text).substring(0,i.maxNameLength))})),this._inputText=u,a.onPointerClickObservable.add((()=>{this.hide(),this._selectionMade.next(null)})),o.onPointerClickObservable.add((()=>{this.hide(),this._selectionMade.next({presetName:this._inputText.text})})),this.addControlToRoot(o),this.addControlToRoot(a)}setText(e){return this._inputElement&&(this._inputElement.value=e),this._inputText.text=e,this}show(e){return this._isMobile||this._inputText.focus(),super.show(e)}resizeContentPortrait(e,t){this.contentRoot.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.contentRoot.top="10%"}resizeContentLandscape(e){this.contentRoot.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.contentRoot.top="10%"}get selectionMade(){return this._selectionMade}onShroudClicked(){this._isMobile&&this._inputTextInFocus||(this.hide(),this._selectionMade.next(null))}}class qr extends Sr{constructor(e,t){super("deleteFavBetConfirmation",e,{landscape:pr.calculateRefSizeWithFractionConstraints({refSize:{content:{w:t.background.width,h:t.background.height},resolution:{w:1920,h:1080}},maxHeightFraction:.5,maxWidthFraction:.5}),portrait:pr.calculateRefSizeWithFractionConstraints({refSize:{content:{w:t.background.width,h:t.background.height},resolution:{w:1080,h:1920}},maxHeightFraction:.8,maxWidthFraction:.95})},{shroud:!0}),this._selectionMade=new X;const i=pr.createImage(t.background,"img-Background");i.isPointerBlocker=!0,i.width="100%",i.height="100%",i.zIndex=-1,this.addControlToRoot(i);const s=pr.createImage(t.message,"img-message");s.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,s.top="-15%",s.width=t.message.width/t.background.width*100*1.5+"%",s.height=t.message.height/t.background.height*100*1.5+"%",this.addControlToRoot(s);const r=fn.buildStandardRectButton("btn-Yes",t.yesBtn,{cornerRadius:.12,height:"75%",width:"90%",left:0,top:"-13%",vAlign:xs.VERTICAL_ALIGNMENT_TOP},e);r.modifyImages((e=>{e.width=e.height="100%",e.stretch=hr.STRETCH_FILL})),r.width=t.yesBtn.width/t.background.width*100+"%",r.height=t.yesBtn.height/t.background.height*100+"%",r.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,r.top="-8%",r.left="-20%";const n=fn.buildStandardRectButton("btn-No",t.noBtn,{cornerRadius:.12,height:"75%",width:"90%",left:0,top:"-13%",vAlign:xs.VERTICAL_ALIGNMENT_TOP},e);n.modifyImages((e=>{e.width=e.height="100%",e.stretch=hr.STRETCH_FILL})),n.width=t.noBtn.width/t.background.width*100+"%",n.height=t.noBtn.height/t.background.height*100+"%",n.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,n.top="-8%",n.left="20%",this.addControlToRoot(r),this.addControlToRoot(n),r.onPointerClickObservable.add((()=>{this.makeSelection(!0)})),n.onPointerClickObservable.add((()=>{this.makeSelection(!1)}))}makeSelection(e){this._selectionMade.next(e),this.hide()}get selectionMade(){return this._selectionMade}onShroudClicked(){this.makeSelection(!1)}}class Qr{constructor(e,t){this._dialogLoading=e,this._audioEventHandler=t}async ask(){const e=await this._dialogLoading;this._view=e,await e.show();const t=await ce(e.selectionMade);return this._audioEventHandler.play(or.UI_Click),t&&this._audioEventHandler.play(or.ClearTable),this._view=null,t}hide(){this._view&&this._view.hide()}}class Kr extends As{static debug_SetHitzonesVisible(e){this._all.forEach((t=>e?t.showHitzone():t.hideHitzone()))}constructor(e,t,i,s){super(e),this._isPointerOver=!1,this._onInactiveClicked=new X,this._inactiveButClickable=!1,Kr._all.push(this),this.delegatePickingToChildren=!0,this.clipChildren=this.clipContent=!1,this._defaultImage=t.default,this._inactiveImage=t.inactive,this._highlightedImage=t.highlighed,this._hitZone=i,this._params=s;const r=this._scaleableContainer=new As("scaleable");r.isPointerBlocker=!1,r.isHitTestVisible=!1,this.addControl(r),r.width=r.height="100%",r.clipChildren=r.clipContent=!1,this.initializeImage(this._defaultImage,!0),this.initializeImage(this._inactiveImage,!1),this.initializeImage(this._highlightedImage,!1),this.addControl(i),this.clipChildren=!1,this.clipContent=!1,i.onPointerEnterObservable.add((()=>{this._isPointerOver=!0,this._state===Pr.Active&&this.setState(Pr.Highlighted)})),i.onPointerOutObservable.add((()=>{this._isPointerOver=!1,this._state===Pr.Highlighted&&this.setState(Pr.Active)})),i.onPointerDownObservable.add((()=>{this._state===Pr.Highlighted&&this.setState(Pr.Pressed)})),i.onPointerUpObservable.add((()=>{this._state===Pr.Pressed&&this.setState(Pr.Highlighted)})),!0===s?.fitImageToContainer&&this.modifyImages((e=>{e.width=e.height="100%"})),i.onPointerClickObservable.add((e=>{this._state===Pr.Inactive?this._onInactiveClicked.next(this):this.onPointerClickObservable.notifyObservers(e)})),this.onPointerEnterObservable=i.onPointerEnterObservable,this.onPointerOutObservable=i.onPointerOutObservable,this.onPointerDownObservable=i.onPointerDownObservable,this.onPointerUpObservable=i.onPointerUpObservable,this.onPointerMoveObservable=i.onPointerMoveObservable,this.hideHitzone(),this.setState(Pr.Active)}setInactiveButClickable(e){this._inactiveButClickable=e,e?this.setState(Pr.Inactive):this.isEnabled=!0}initializeImage(e,t){e&&(e.isHitTestVisible=!1,e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,e.stretch=hr.STRETCH_UNIFORM,e.isVisible=t,this.addScaleableControl(e))}addScaleableControl(e){e&&e.parent&&e.parent.removeControl(e),this._scaleableContainer.addControl(e)}addControl(e){return e&&e.parent&&e.parent.removeControl(e),super.addControl(e),this}get isEnabled(){return this._state!=Pr.Inactive||!0===this._inactiveButClickable}set isEnabled(e){e?this._inactiveButClickable?this.setState(Pr.Inactive):this._isPointerOver?this.setState(Pr.Highlighted):this.setState(Pr.Active):this.setState(Pr.Inactive)}showHitzone(){this._hitZone.doNotRenderButInteract=!1}hideHitzone(){this._hitZone.doNotRenderButInteract=!0}getActiveImage(){switch(this._state){case Pr.Active:return this._defaultImage;case Pr.Inactive:return this._inactiveImage??this._defaultImage;case Pr.Pressed:case Pr.Highlighted:return this._highlightedImage??this._defaultImage;default:throw new Z(`Unsupported state: ${this._state}`)}}setState(e){if(this._state!=e)switch(this._state=e,e){case Pr.Active:this.setImageVisible(this._defaultImage,!0),this.setImageVisible(this._inactiveImage,!1),this.setImageVisible(this._highlightedImage,!1),this.setContentScale(1);break;case Pr.Highlighted:this._highlightedImage&&(this.setImageVisible(this._defaultImage,!1),this.setImageVisible(this._highlightedImage,!0)),this.setImageVisible(this._inactiveImage,!1),this.setContentScale(1);break;case Pr.Inactive:this._inactiveImage&&(this.setImageVisible(this._defaultImage,!1),this.setImageVisible(this._inactiveImage,!0)),this.setImageVisible(this._highlightedImage,!1),this.setContentScale(1);break;case Pr.Pressed:this._highlightedImage&&(this.setImageVisible(this._defaultImage,!1),this.setImageVisible(this._highlightedImage,!0)),this.setImageVisible(this._inactiveImage,!1),this._params?.pressed?.scale&&this.setContentScale(this._params?.pressed?.scale)}}setImageScale(e,t){e.scaleX=e.scaleY=t}setContentScale(e){this._scaleableContainer.scaleX=this._scaleableContainer.scaleY=e}setImageVisible(e,t){e&&(e.isVisible=t)}modifyImages(e){e(this._defaultImage),this._inactiveImage&&e(this._inactiveImage),this._highlightedImage&&e(this._highlightedImage)}set imageRotation(e){this._defaultImage.rotation=e,this._inactiveImage&&(this._inactiveImage.rotation=e),this._highlightedImage&&(this._highlightedImage.rotation=e)}get onInactiveClicked(){return this._onInactiveClicked}}Kr._all=[],function(e){e.Active="Active",e.Highlighted="Highlighted",e.Pressed="Pressed",e.Inactive="Inactive"}(Pr||(Pr={})),function(e){e[e.Normal=0]="Normal",e[e.Turbo=1]="Turbo"}(Ir||(Ir={}));class Yr extends Sr{constructor(e,t){const i=pr.calculateRefSizeConfig({contentRefSize:{w:772,h:1046},refResLandscape:{w:2560,h:1284},screenFraction:{landscape:{width:.5,height:.9},portrait:{width:.9,height:.9}}});super("dlg-Settings",e,i,{shroud:!0}),this._btnSpeedClicked=new X,this._feltIndexClicked=new X,this._wheelSpinButtonPressed=new X;const s=new hr(`${this.name}-background`);s.domImage=t.background,s.stretch=hr.STRETCH_UNIFORM,s.isPointerBlocker=!0,s.clipChildren=s.clipContent=!1;const r=this.addControlToRoot(s);r.width="100%",r.height="100%";const n=(i,s)=>{const r=fn.buildSelectableRectButton(i,t.speedButtonBackground,{height:"68%",width:"94%",cornerRadius:.9,top:"-13%",left:"0px"},e);r.modifyImages((e=>{e.width=e.height="100%"}));const n=new lr(`label-${i}`,s);r.addScaleableControl(n),n.width="94%",n.height="70%",n.fontFamily="Arial",n.outlineWidth=9,n.outlineColor="#000000aa",n.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,n.top="5%";const o=s.length>=9?"26%":"32%";return n.fontSize=o,n.fontWeight="bold",n.color="white",this.addControlToRoot(r),r},o=this._btnSpeedNormal=n("btn-Speed_Normal","NORMAL"),a=this._btnSpeedTurbo=n("btn-Speed_Turbo","TURBO");[o,a].forEach((e=>{const i=t.background.width,s=t.background.height;e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,e.top=97/s*100+"%",e.height=t.speedButtonBackground.height/s*100*1.2+"%",e.width=t.speedButtonBackground.width/i*100*1.2+"%"}));const h=170/t.background.width*100;o.left=-h+"%",a.left=`${h}%`;const l=pr.createImage(t.feltButtons,"feltButtons",{setSizeRelativeToContainer:t.background,setPositionRelativeToContainer:{container:t.background,alignment:{vertical:xs.VERTICAL_ALIGNMENT_TOP},position:{top:860}}});this.addControlToRoot(l);const c=[];for(let e=0;e<4;e++){const i=new _r(`felt-${e}`);i.color="red",i.background="#ff0000c8",i.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,i.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,i.width=116/t.background.width*100+"%",i.height=115/t.background.height*100+"%",i.doNotRenderButInteract=!0,this.addControlToRoot(i),i.top=860/t.background.height*100+"%",i.left=(56+e*(544/3))/t.background.width*100+"%",c.push(i),i.onPointerClickObservable.add((()=>{this._feltIndexClicked.next(e)}))}const u={cornerRadius:.25,height:"82%",width:"82%",vAlign:xs.VERTICAL_ALIGNMENT_TOP,hAlign:xs.HORIZONTAL_ALIGNMENT_LEFT,left:"0%",top:"-8%"},d=this._btnWheelCCW=fn.buildSelectableRectButton("btn-wheelCCW",t.buttons.wheelCCW,u,e);pr.setRelativePosition({control:d,containerSize:t.background,position:{left:-206,top:348}});const _=this._btnWheelCW=fn.buildSelectableRectButton("btn-wheelCW",t.buttons.wheelCW,u,e);pr.setRelativePosition({control:_,containerSize:t.background,position:{left:206,top:348}});const p=this._btnWheelAlt=fn.buildSelectableRectButton("btn-wheelAlt",t.buttons.wheelAlternating,u,e);pr.setRelativePosition({control:p,containerSize:t.background,position:{left:0,top:348}}),[d,_,p].forEach((e=>{e.modifyImages((e=>e.width=e.height="100%")),e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,pr.setRelativeSize({control:e,containerSize:t.background,controlSize:t.buttons.wheelAlternating}),this.addControlToRoot(e)}));const g=this._tglRightHanded=t.toggles.rightHanded;this.addControlToRoot(g);const f=this._tglPiP=t.toggles.pictureInPicture;this.addControlToRoot(f),[g,f].forEach((e=>{e.width=170/t.background.width*100+"%",e.height=90/t.background.height*100+"%",e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,e.left=563/t.background.width*100+"%"})),g.top=690/t.background.height*100+"%",f.top=585/t.background.height*100+"%",_.onPointerClickObservable.add((()=>{this._wheelSpinButtonPressed.next("cw")})),d.onPointerClickObservable.add((()=>{this._wheelSpinButtonPressed.next("ccw")})),p.onPointerClickObservable.add((()=>{this._wheelSpinButtonPressed.next("alt")})),o.onPointerClickObservable.add((()=>{this._btnSpeedClicked.next(Ir.Normal)})),a.onPointerClickObservable.add((()=>{this._btnSpeedClicked.next(Ir.Turbo)}))}onShroudClicked(){this.hide()}get feltIndexClicked(){return this._feltIndexClicked}get btnSpeedClicked(){return this._btnSpeedClicked}selectSpeedMode(e){this._btnSpeedNormal.isEnabled=e!==Ir.Normal,this._btnSpeedTurbo.isEnabled=e!==Ir.Turbo}get wheelDirectionSelected(){return this._wheelSpinButtonPressed}setWheelSpinningMode(e){this._btnWheelCW.isEnabled="cw"!==e,this._btnWheelCCW.isEnabled="ccw"!==e,this._btnWheelAlt.isEnabled="alt"!==e}get pipToggled(){return this._tglPiP.onToggled}setPiPToggled(e){this._tglPiP.setOn(e)}get rightHandedToggled(){return this._tglRightHanded.onToggled}setRightHanded(e){this._tglRightHanded.setOn(e)}}class jr{constructor(e){this._viewInitialized=!1,this._viewLoading=e.viewLoading,this._settingController=e.settingController,this._feltController=e.feltController,this._audioEvents=e.audioEvents}async show(){const e=await this._viewLoading;this.initializeViewOnce(e),await e.show(),this._view=e}hide(){this._view&&this._view.hide()}initializeViewOnce(e){if(this._viewInitialized)return;const t=this,i=()=>t._audioEvents.play(or.UI_Click);this._viewInitialized=!0,e.feltIndexClicked.subscribe((e=>{const t=this._settingController.feltColor.value;i(),t!==e&&(this._settingController.setFeltColor(e),this._feltController.switchFeltColor(e))})),this._settingController.wheelSpinningMode.subscribe((t=>{e.setWheelSpinningMode(t)})),e.wheelDirectionSelected.subscribe((e=>{i(),this._settingController.setWheelSpinningMode(e)})),this._settingController.gameSpeed.subscribe((t=>{e.selectSpeedMode(t)})),e.btnSpeedClicked.subscribe((e=>{i(),this._settingController.setGameSpeed(e)})),this._settingController.pipEnabled.subscribe((t=>{e.setPiPToggled(t)})),e.pipToggled.subscribe((e=>{i(),this._settingController.setPipEnabled(e)})),this._settingController.rightHanded.subscribe((t=>{e.setRightHanded(t)})),e.rightHandedToggled.subscribe((e=>{i(),this._settingController.setRightHanded(e)}))}}class Zr{static fromMusicType(e){switch(e){case"blues":return Zr.Blues;case"casino":return Zr.CasinoAmbience;case"chill":return Zr.Chill;case"classical":return Zr.Classic;case"groovy":return Zr.Groovy;case"heavy":return Zr.Heavy;case"jazz":return Zr.Jazz;case"lounge":return Zr.Lounge;case"neon":return Zr.Neon;default:throw new Z(`Unknown music type ${e}`)}}constructor(e,t){this.name=e,this.musicType=t}}Zr.Classic=new Zr("Classic","classical"),Zr.CasinoAmbience=new Zr("CasinoAmbience","casino"),Zr.Heavy=new Zr("Heavy","heavy"),Zr.Neon=new Zr("Neon","neon"),Zr.Blues=new Zr("Blues","blues"),Zr.Chill=new Zr("Chill","chill"),Zr.Groovy=new Zr("Groovy","groovy"),Zr.Jazz=new Zr("Jazz","jazz"),Zr.Lounge=new Zr("Lounge","lounge");class $r{constructor(e,t,i){this._trackIdAssetId=[[Zr.Blues,Fe.Music_Blues],[Zr.CasinoAmbience,Fe.Music_CasinoAmbient],[Zr.Chill,Fe.Music_Chill],[Zr.Classic,Fe.Music_Classical],[Zr.Groovy,Fe.Music_Groovy],[Zr.Heavy,Fe.Music_Heavy],[Zr.Jazz,Fe.Music_Jazz],[Zr.Lounge,Fe.Music_Lounge],[Zr.Neon,Fe.Music_Neon]],this._audioPlayer=e,this._audioLoader=t,this._log=i,this._muted=!1}set muted(e){this._muted=e,this._currentlyPlayingMusic&&this._currentlyPlayingMusic.asset.howl?.mute(e)}get muted(){return this._muted}async playTrack(e){if(this._muted)return;if(this._log.debug(`Track [${e}] requested`),this._currentlyPlayingMusic?.id===e)return void this._log.debug("Ignoring request since this track is currently playing");this.stopCurrentTrack(),this.cancelPreviousRequestIfAny(this._trackLoading);const t=this._audioLoader,i=e instanceof Fe?e:this.trackIdToAssetId(e),s=e instanceof Fe?this.asssetIdToTrackId(e):e,r=this._log;this._trackLoading=new ri((e=>new Promise(((s,n)=>(r.debug(`Loading music track [${i.name}]...`),t.loadMusic(i).then((t=>{e.aborted?n(new DOMException("Aborted","AbortError")):(r.debug(`Music track [${i.name}] loaded`),s(t))})).catch(n))))));try{r.debug(`Waiting for track [${i}] to load`);const e=await this._trackLoading.promise;e.howl?.mute(this._muted),r.debug(`Track [${i}] loaded. Playing.`),this._trackLoading=null,this._currentlyPlayingMusic={id:s,assetId:i,asset:e},e.howl?.volume(.3),this._audioPlayer.play({name:i.name})}catch(e){if(si.isAbortError("AbortError"!==e.name))throw e;r.debug(`Music track [${i.name}] loading cancelled`)}}asssetIdToTrackId(e){const t=this._trackIdAssetId.find((t=>t[1]===e));if(!t)throw new Z(`Could not find track id for asset id '${e.name}'`);return t[0]}trackIdToAssetId(e){const t=this._trackIdAssetId.find((t=>t[0]===e));if(!t)throw new Z(`Could not find asset id for track id '${e}'`);return t[1]}stopCurrentTrack(){this._currentlyPlayingMusic&&(this._audioPlayer.stop({name:this._currentlyPlayingMusic.assetId.name}),this._currentlyPlayingMusic.asset.howl?.stop(),this._currentlyPlayingMusic=void 0)}async cancelPreviousRequestIfAny(e){e&&(this._log.debug("Cancelling previous track request"),await e.abort(),this._log.debug("Previous track loading cancelled"))}}class Jr extends Sr{constructor(e,t,i){const s={w:1920,h:1080},r={w:806,h:1164},n=pr.calculateRefSizeWithFractionConstraints({refSize:{content:r,resolution:s},maxHeightFraction:.9,maxWidthFraction:.9}),o=pr.calculateRefSizeWithFractionConstraints({refSize:{content:r,resolution:{w:s.h,h:s.w}},maxHeightFraction:.9,maxWidthFraction:.9});super("dlg-AudioSettings",e,{landscape:n,portrait:o},{shroud:!0}),this._trackSelected=new X,this._voiceSelected=new X,this._unmuteToggled=new X,this._musicToggled=new X,this._voToggled=new X,this._sfxToggled=new X;const a=new hr("img-bg-audioSettings");a.domImage=t.bgImageElement,a.stretch=hr.STRETCH_UNIFORM,a.width="100%",a.height="100%",this.addControlToRoot(a),this.isPointerBlocker=!0;const h=(i,s)=>{const r=fn.buildSelectableRectButton(i,t.buttonElement,{height:"68%",width:"94%",cornerRadius:.9,top:"-13%",left:"0px"},e);r.modifyImages((e=>{e.width=e.height="100%"}));const n=new lr(`label-${i}`,s);r.addScaleableControl(n),n.width="94%",n.height="70%",n.fontFamily="Arial",n.outlineWidth=9,n.outlineColor="#000000aa",n.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,n.top="5%";const o=s.length>=9?"26%":"32%";return n.fontSize=o,n.fontWeight="bold",n.color="white",this.addControlToRoot(r),r};{const e=5,t=4,s=25,r=5,n=3,o=11;let a=0;const l=new Map;i.forEach(((i,c)=>{const u=h(`btn-Track-${c.name}`,i),d=Math.floor(a/n),_=(s+e)*(a%n-1),p=o+(r+t)*d;u.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,u.top=`${p}%`,u.left=`${_}%`,u.width="30%",u.height="10%",a++,u.onPointerClickObservable.add((()=>{this._trackSelected.next(c)})),l.set(c,u)})),this._trackButtons=l}const l=this._btnVoiceMale=h("btn-VoiceMale","MALE");l.width="30%",l.height="10%",l.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,l.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,l.top="0%",l.left="10%";const c=this._btnVoiceFemale=h("btn-VoiceFemale","FEMALE");c.width="30%",c.height="10%",c.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,c.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,c.top="0%",c.left="-10%",c.onPointerClickObservable.add((()=>{this._voiceSelected.next("female")})),l.onPointerClickObservable.add((()=>{this._voiceSelected.next("male")}));const u=this._toggleMute=t.toggles.mute,d=this._toggleMusic=t.toggles.music,_=this._toggleSFX=t.toggles.sfx,p=this._toggleVO=t.toggles.vo;[u,d,p,_].forEach((e=>{this.addControlToRoot(e),e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,e.left="28%"})),u.top="10.1%",d.top="19.8%",p.top="29.3%",_.top="38.8%",u.onToggled.subscribe((e=>{this._unmuteToggled.next(e)})),d.onToggled.subscribe((e=>{this._musicToggled.next(e)})),p.onToggled.subscribe((e=>{this._voToggled.next(e)})),_.onToggled.subscribe((e=>{this._sfxToggled.next(e)}))}resizeContentLandscape(e,t){this._toggleMusic.scaleX=this._toggleMusic.scaleY=t,this._toggleMute.scaleX=this._toggleMute.scaleY=t,this._toggleSFX.scaleX=this._toggleSFX.scaleY=t,this._toggleVO.scaleX=this._toggleVO.scaleY=t}resizeContentPortrait(e,t){const i=1.5*t;this._toggleMusic.scaleX=this._toggleMusic.scaleY=i,this._toggleMute.scaleX=this._toggleMute.scaleY=i,this._toggleSFX.scaleX=this._toggleSFX.scaleY=i,this._toggleVO.scaleX=this._toggleVO.scaleY=i}setTrackActive(e){this._trackButtons.forEach(((t,i)=>{t.isEnabled=i!=e}))}setVoiceType(e){this._btnVoiceFemale.isEnabled="female"!==e,this._btnVoiceMale.isEnabled="male"!==e}get trackSelected(){return this._trackSelected}get voiceSelected(){return this._voiceSelected}get allAudioToggled(){return this._unmuteToggled}get musicToggled(){return this._musicToggled}get voToggled(){return this._voToggled}get sfxToggled(){return this._sfxToggled}setAllMuted(e){this._toggleMute.setOn(!e,!0)}setMusicMuted(e){this._toggleMusic.setOn(!e,!0)}setVOMuted(e){this._toggleVO.setOn(!e,!0)}setSFXMuted(e){this._toggleSFX.setOn(!e,!0)}onShroudClicked(){this.hide()}}class en{constructor(e){this._viewLoading=e.viewLoading;const t=this;e.viewLoading.then((i=>{e.settingsController.musicType.subscribe((e=>{i.setTrackActive(Zr.fromMusicType(e))})),e.settingsController.voiceType.subscribe((e=>{i.setVoiceType(e)})),i.setAllMuted(e.settingsController.muteAll.value),i.setMusicMuted(!e.settingsController.musicEnabled.value),i.setSFXMuted(!e.settingsController.sfxEnabled.value),i.setVOMuted(!e.settingsController.voiceEnabled.value),i.trackSelected.subscribe((t=>{e.settingsController.setMusicType(t.musicType),e.audioEventHandler.play(or.UI_Click)})),i.voiceSelected.subscribe((i=>{e.settingsController.setVoiceType(i),e.audioEventHandler.play(or.UI_Click),e.audioEventHandler.play("male"===i?or.MaleVoiceSelected:or.FemaleVoiceSelected,t.closeAbortSignal)})),i.allAudioToggled.subscribe((t=>{e.settingsController.setMute(!t),e.audioEventHandler.play(or.UI_Click)})),i.musicToggled.subscribe((t=>{e.settingsController.setMusicEnabled(t),e.audioEventHandler.play(or.UI_Click)})),i.voToggled.subscribe((t=>{e.settingsController.setVoiceEnabled(t),e.audioEventHandler.play(or.UI_Click)})),i.sfxToggled.subscribe((t=>{e.settingsController.setSFXEnabled(t),e.audioEventHandler.play(or.UI_Click)})),i.onHidden.subscribe((()=>{t._closeAbortController?.abort(),t._closeAbortController=null}))}))}async show(){const e=await this._viewLoading;await e.show(),this._closeAbortController=new AbortController,this._view=e}hide(){this._view&&this._view.hide()}get closeAbortSignal(){return this._closeAbortController?.signal}}class tn extends Sr{constructor(e,t){const i={w:294,h:278};super("betSpotHint",e,{landscape:pr.calculateRefSizeWithFractionConstraints({refSize:{content:i,resolution:{w:1920,h:1080}},maxHeightFraction:.3,maxWidthFraction:.3}),portrait:pr.calculateRefSizeWithFractionConstraints({refSize:{content:i,resolution:{w:1080,h:1920}},maxHeightFraction:.3,maxWidthFraction:.3})},{shroud:{alpha:.2}}),this._doubleClicked=new X,this._addClicked=new X,this._clearClicked=new X;this.delegatePickingToChildren=!0,this.contentRoot.delegatePickingToChildren=!0;const s=pr.createImage(t.background,"bg");this.addControlToRoot(s);const r=e=>e/i.w*100+0,n=e=>e/i.h*100-70;s.width=t.background.width/i.w*100+"%",s.height=t.background.height/i.h*100+"%",s.top=`${n(79)}%`,s.left=`${r(6)}%`,s.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,s.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT;const o={cornerRadius:15/t.btnDouble.width,height:76/t.btnDouble.height*100+"% ",width:88/t.btnDouble.width*100+"%",left:14/t.btnDouble.width*100+"%",top:"0%",vAlign:xs.VERTICAL_ALIGNMENT_TOP,hAlign:xs.HORIZONTAL_ALIGNMENT_LEFT},a=t.btnDouble.width/i.w*100+"%",h=t.btnDouble.height/i.h*100+"%",l=this._btnDouble=fn.buildStandardRectButton("btn-Double",t.btnDouble,o,e);l.modifyImages((e=>{e.width=e.height="100%",e.stretch=hr.STRETCH_FILL})),l.width=a,l.height=h,l.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,l.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,l.top=`${n(0)}%`,l.left=`${r(0)}%`,this.addControlToRoot(l);const c=this._btnAdd=fn.buildStandardRectButton("btn-Add",t.btnAdd,o,e);c.modifyImages((e=>{e.width=e.height="100%",e.stretch=hr.STRETCH_FILL})),c.width=a,c.height=h,c.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,c.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,c.top=`${n(0)}%`,c.left=`${r(88)}%`,this.addControlToRoot(c);const u=this._btnClear=fn.buildStandardRectButton("btn-Delete",t.btnClear,o,e,{fitImageToContainer:!0,pressed:{scale:.9}});u.width=a,u.height=h,u.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,u.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,u.top=`${n(0)}%`,u.left=`${r(176)}%`,this.addControlToRoot(u),l.onPointerClickObservable.add((()=>{this._doubleClicked.next()})),c.onPointerClickObservable.add((()=>{this._addClicked.next()})),u.onPointerClickObservable.add((()=>{this._clearClicked.next()})),u.zIndex=l.zIndex=c.zIndex=-1;const d=this._txtBet=new lr("txt-Bet");d.fontFamily=ke.Rubik.name,d.fontSize="10%",d.width="50%",d.height="10%",d.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,d.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,d.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,d.top="-33%",d.left="-15%",d.color="white",this.addControlToRoot(d);const _=this._txtMin=new lr("txt-Min");_.fontFamily=ke.Rubik.name,_.fontSize="10%",_.width="50%",_.height="10%",_.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,_.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,_.top="-55%",_.left="-15%",_.color="white",_.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,this.addControlToRoot(_);const p=this._txtMax=new lr("txt-Max");p.fontFamily=ke.Rubik.name,p.fontSize="10%",p.width="50%",p.height="10%",p.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,p.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,p.left="-15%",p.color="white",p.top="-45%",p.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,this.addControlToRoot(p),d.isPointerBlocker=p.isPointerBlocker=_.isPointerBlocker=!1,s.isPointerBlocker=!1}setContentPosition(e,t){this.contentRoot.left=e,this.contentRoot.top=t}onShroudClicked(){this.hide()}setBetValue(e){return this._txtBet.text=e,this}setBetLimit(e,t){return this._txtMin.text=e,this._txtMax.text=t,this}get doubleClicked(){return this._doubleClicked}get addClicked(){return this._addClicked}get clearClicked(){return this._clearClicked}setDoubleEnabled(e){this._btnDouble.setInactiveButClickable(!e)}setAddEnabled(e){this._btnAdd.setInactiveButClickable(!e)}setClearEnabled(e){this._btnClear.setInactiveButClickable(!e)}}class sn{constructor(e){this._popup=e.popup,this._betConfig=e.betConfig,this._currencyFormatter=e.currencyFormatter,this._scene=e.scene,this._betSpotPositionGetter=e.betSpotPositionGetter,this._fieldView=e.fieldView,this._cameraController=e.cameraController,this._currentChip=e.currentChip,this._audioEventHandler=e.audioEventHandler,this._mainUILayerManipulator=e.mainUILayerManipulator,this._placeBetWithErrorHandling=e.placeBetWithMessage,this._currentBetSpot=null}onResize(e){setTimeout((()=>{if(this._currentBetSpot){const e=this.calculateBetSpotPosition(this._currentBetSpot);this._popup.setContentPosition(e.left,e.top)}}))}show(e){this._hideDisposable&&this._hideDisposable.dispose();const t=this._hideDisposable=new qt;this._currentBetSpot=e;const i=this._popup,s=this,r=this.calculateBetSpotPosition(e);i.setContentPosition(r.left,r.top);const n=s._placeBetWithErrorHandling.placedBetsCollection.getBetSpotCents(e),o=this._betConfig.betRangeForType.get(e.type)??(()=>{throw new Z(`Bet limit for bet type ${e.type} is not defined`)})();i.setBetLimit(this._currencyFormatter.centsToCurrencyString(o.min),this._currencyFormatter.centsToCurrencyString(o.max)).setBetValue(this._currencyFormatter.centsToCurrencyString(n)),s.updateActionsAvailability(e);const a=this._fieldView.highlightBetSpots([e],pt.Selected,!0),h=this._mainUILayerManipulator.bringToZIndex([Ss.BetSelector,Ss.ButtonClear,Ss.ButtonUndo],gn.GameUI_OverDialogs);t.add([h,new yt(i.onHidden.subscribe((()=>{a.dispose(),s._hideDisposable===t&&(s._hideDisposable.dispose(),s._hideDisposable=null),s._currentBetSpot===e&&(s._currentBetSpot=null)}))),new yt(i.doubleClicked.subscribe((()=>{this._placeBetWithErrorHandling.tryDouble(e,!0)}))),new yt(i.addClicked.subscribe((()=>{this._placeBetWithErrorHandling.tryAddBet(e,s._currentChip.centsValue,!0)}))),new yt(i.clearClicked.subscribe((()=>{s._placeBetWithErrorHandling.placedBetsCollection.clearBetSpot(e),s._audioEventHandler.play(or.ClearTable)}))),new yt(s._placeBetWithErrorHandling.placedBetsCollection.updateObservable.subscribe((()=>{s.updateActionsAvailability(e)}))),new yt(s._currentChip.centsObservable.subscribe((()=>{s.updateActionsAvailability(e)})))]),this._popup.show()}calculateBetSpotPosition(e){const t=this._betSpotPositionGetter.getAbsolutePositionForBet(e),i=new Es.L(0,0,this._scene.getEngine().getRenderWidth(),this._scene.getEngine().getRenderHeight()),s=this._cameraController.mainCameraObservable.value.getTransformationMatrix(),r=gt.Pq.Project(t,gt.uq.IdentityReadOnly,s,i),n=i.width,o=i.height;return{left:(r.x-n/2)/n*100+"%",top:(r.y-o/2)/o*100+"%"}}updateActionsAvailability(e){const t=this._placeBetWithErrorHandling.placedBetsCollection.getBetSpotCents(e);this._popup.setClearEnabled(t>0),this._popup.setAddEnabled(!0),this._popup.setDoubleEnabled(t>0),this._popup.setBetValue(this._currencyFormatter.centsToCurrencyString(t))}}class rn extends Kr{constructor(e,t,i,s){super(e,{default:t.knob,highlighed:t.knobHighlighted},s,{pressed:{scale:1},fitImageToContainer:!0}),this._isOn=!1,this._onToggled=new X,t.on.stretch=hr.STRETCH_UNIFORM,t.off.stretch=hr.STRETCH_UNIFORM,t.knob.stretch=hr.STRETCH_UNIFORM,this.addScaleableControl(t.on),this.addScaleableControl(t.off),this._onPercent=i.onPercent,this._offPercent=i.offPercent,this._imgOn=t.on,this._imgOff=t.off,this._imgKnob=t.knob,this._imgKnobHighlighted=t.knobHighlighted,t.knob.zIndex=t.knobHighlighted.zIndex=5,this._isOn=!0,this.setOn(!1,!0),this.onPointerClickObservable.add((()=>{this.toggleState()})),this.isPointerBlocker=!0}toggleState(){this.setOn(!this._isOn,!1),this._onToggled.next(this._isOn)}setOn(e,t){this._isOn!==e&&(this._isOn=e,this.animate(e,t?AbortSignal.abort(ei.JumpToEnd):void 0))}async animate(e,t){this._toggleAnimation&&await this._toggleAnimation.abort(ei.JumpToEnd);const i=this._imgOn,s=this._imgOff,r=this;i.zIndex=e?2:1,s.zIndex=e?1:2;const n={set left(e){r.setKnobPosition(`${e}%`),this._left=e},get left(){return this._left},_left:e?r._offPercent:r._onPercent},o=new ri((t=>new Promise((a=>{Promise.all([Jt.add({target:i,duration:rn.AnimationTimeS,ease:e?$t.easeOutCubic:$t.easeInCubic},{alpha:e?1:0},t),Jt.add({target:s,duration:rn.AnimationTimeS,ease:e?$t.easeInCubic:$t.easeOutCubic},{alpha:e?0:1},t),Jt.add({target:n,duration:rn.AnimationTimeS,ease:$t.easeOutQuad},{left:e?r._onPercent:r._offPercent},t)]).then((()=>{a()})).finally((()=>{r._toggleAnimation===o&&(r._toggleAnimation=null)}))}))),t);this._toggleAnimation=o}get onToggled(){return this._onToggled}setKnobPosition(e){this._imgKnob.left=this._imgKnobHighlighted.left=e}get isOn(){return this._isOn}}rn.AnimationTimeS=.2;class nn extends Sr{constructor(e,t,i,s){super(e,t,pr.calculateRefSizeConfig({contentRefSize:{w:i.background.width,h:i.background.height},refResLandscape:{w:1920,h:1080},screenFraction:{landscape:{width:.6,height:.6},portrait:{width:.9,height:.8}}}),{shroud:!0}),this._btnMinusClicked=new X,this._btnPlusClicked=new X,this._closeClicked=new X,this._numbersSelected=new X,this.isPointerBlocker=!0;const r=pr.createImage(i.background,"bg");r.width="100%",r.height="100%",r.zIndex=-2;const n=this.addControlToRoot(i.btnClose);n.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,n.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,pr.setRelativeSize({control:n,containerSize:i.background,controlSize:{width:80,height:80}}),pr.setRelativePosition({containerSize:i.background,control:n,position:{left:-20,top:20}}),n.onPointerClickObservable.add((()=>{this._closeClicked.next()})),this.addControlToRoot(r);const o=pr.createImage(i.racetrack,"racetrack",{setSizeRelativeToContainer:i.background,setPositionRelativeToContainer:{container:i.background,position:{top:-100}}});o.zIndex=-1,this.addControlToRoot(o);const a=fn.buildStandardRectButton("btnMinus",i.btnMinus,{cornerRadius:.5,height:"86%",width:"88%",left:0,top:"-3%",vAlign:xs.VERTICAL_ALIGNMENT_TOP},t);a.modifyImages((e=>e.width=e.height="100%")),pr.setRelativeSize({containerSize:i.background,control:a,controlSize:i.btnMinus}),pr.setRelativePosition({containerSize:i.background,control:a,position:{left:-200,top:200}}),this.addControlToRoot(a);const h=fn.buildStandardRectButton("btnPlus",i.btnPlus,{cornerRadius:.5,height:"86%",width:"88%",left:0,top:"-3%",vAlign:xs.VERTICAL_ALIGNMENT_TOP},t);h.modifyImages((e=>e.width=e.height="100%")),pr.setRelativeSize({containerSize:i.background,control:h,controlSize:i.btnPlus}),pr.setRelativePosition({containerSize:i.background,control:h,position:{left:200,top:200}}),this.addControlToRoot(h);const l=new lr("txt-NeighboursNumber","1");l.fontFamily="Arial",l.fontSize="15%",l.color="white",l.top="27%",l.verticalAlignment=h.verticalAlignment,l.isPointerBlocker=!1,l.isHitTestVisible=!1,this.addControlToRoot(l);const c=[9,26,30,11,7,20,32,17,5,22,34,15,3,24,36].map((e=>s.getWithValue(e))),u=[35,23,4,16,33,21,6,18,31,19,8,12,29,25,10].map((e=>s.getWithValue(e))),d=this.generateHitZones(i.hitZones,i.background,s,c,u);this._btnMinus=a,this._btnPlus=h,this._txtNeighboursNumber=l,this._hitZonesMap=d,this._indexedNumbers=[s.N0,s.N28,...c,s.N13,s.N1,s.N00,s.N27,...[...u].reverse(),s.N14,s.N2];const _=this._sectorCalculator=new on({w:i.racetrack.width,h:i.racetrack.height,r:165}),p=new gt.I9,g=new gt.I9,f=e=>{o._invertTransformMatrix.transformCoordinates(e.x,e.y,p),o.getLocalCoordinatesToRef(p,g);const t=o.widthInPixels,i=o.heightInPixels,s={w:g.x/t,h:g.y/i};return s.w<0||s.w>1||s.h<0||s.h>1?-1:_.getSectorIndex({xPerc:s.w,yPerc:s.h})};o.onPointerMoveObservable.add((e=>{const t=f(e);this.onSectorPointerOver(t)})),o.onPointerDownObservable.add((e=>{const t=f(e);this.onSectorPointerOver(t)})),o.onPointerOutObservable.add((()=>{this.highlightNumbers(null)})),o.onPointerUpObservable.add((e=>{const t=f(e);if(t<0)return;const i=this.getNumbers(t,this._neighborsNumber);this._numbersSelected.next(i)})),this.setNeighborsNumber(0),a.onPointerClickObservable.add((()=>{this._btnMinusClicked.next()})),h.onPointerClickObservable.add((()=>{this._btnPlusClicked.next()})),this.contentRoot.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this.contentRoot.top="40px"}setNeighborsNumber(e){this._neighborsNumber=e,this._txtNeighboursNumber.text=e.toString()}setBtnMinusEnabled(e){this._btnMinus.isEnabled=e}setBtnPlusEnabled(e){this._btnPlus.isEnabled=e}get btnMinusPressed(){return this._btnMinusClicked}get btnPlusPressed(){return this._btnPlusClicked}get numbersSelected(){return this._numbersSelected}get closeClicked(){return this._closeClicked}onSectorPointerOver(e){const t=this.getNumbers(e,this._neighborsNumber);this._hitZonesMap.forEach(((e,i)=>{e.isVisible=t.includes(i)}))}getNumbers(e,t){const i=[];for(let s=e-t;s<=e+t;s++){const e=(s+this._indexedNumbers.length)%this._indexedNumbers.length,t=this._indexedNumbers[e];i.push(t)}return i}generateHitZones(e,t,i,s,r){const n=new Map,o=(e,i,s,r)=>{const o=pr.createImage(i,`hz_${e.name}`,{setSizeRelativeToContainer:t,setPositionRelativeToContainer:{container:t,position:{left:"number"==typeof s?.left?s.left:void 0,top:"number"==typeof s?.top?s.top:void 0}}});return"string"==typeof s?.left&&(o.left=s.left),"string"==typeof s?.top&&(o.top=s.top),r&&(o.scaleX=-1),o.zIndex=2,o.isPointerBlocker=o.isHitTestVisible=!1,o.isVisible=!1,this.addControlToRoot(o),n.set(e,o),o},a=(o(i.N28,e.hz28,{left:"-38.3%",top:"-31.1%"}),o(i.N0,e.hz0,{left:"-41.9%",top:"-23.5%"}),o(i.N2,e.hz2,{left:"-41.9%",top:"-7.2%"}),o(i.N14,e.hz14,{left:"-38.3%",top:"-0.1%"}),o(i.N13,e.hz28,{left:"38.3%",top:"-31.1%"},!0),o(i.N1,e.hz0,{left:"41.9%",top:"-23.5%"},!0),o(i.N00,e.hz2,{left:"41.9%",top:"-7.2%"},!0),o(i.N27,e.hz14,{left:"38.3%",top:"-0.1%"},!0),-31.9),h=63.8/14;return s.forEach(((t,i)=>{const s=a+i*h;o(t,e.hzRect,{left:`${s}%`,top:"-32.7%"})})),r.forEach(((t,i)=>{const s=a+i*h;o(t,e.hzRect,{left:`${s}%`,top:"1.5%"})})),n}resizeContentLandscape(e){this.contentRoot.scaleX=this.contentRoot.scaleY=.8,this.contentRoot.top="0px",this.contentRoot.markAllAsDirty()}resizeContentPortrait(e,t){this.contentRoot.scaleX=this.contentRoot.scaleY=1,this.contentRoot.top="40px",this.contentRoot.markAllAsDirty()}onShroudClicked(){this._closeClicked.next()}highlightNumbers(e){this._hitZonesMap.forEach(((t,i)=>{t.isVisible=e?.includes(i)??!1}))}}class on{constructor(e){this._w=e.w,this._h=e.h,this._r=e.r,this._leftCenter={x:this._r,y:.5*this._h},this._rightCenter={x:this._w-this._r,y:.5*this._h},this._lineLength=this._w-2*this._r}getSectorIndex(e){const t=this._w*e.xPerc,i=this._h*e.yPerc;if(t<this._leftCenter.x){const e=t-this._leftCenter.x,s=i-this._leftCenter.y;return s<0?e<s?0:1:e<-s?37:36}if(t>this._rightCenter.x){const e=t-this._rightCenter.x,s=i-this._rightCenter.y;return s<0?e<-s?17:18:e>s?19:20}{const i=Math.floor((t-this._leftCenter.x)/this._lineLength*15);return e.yPerc<.5?2+i:35-i}}}class an{constructor(e){this._viewLoading=e.viewLoading,this._neighborsSelected=e.initialNeighborsSelected,this._maxNeighbors=e.maxNeighbors,this._placedBetsCollection=e.placedBetsCollection,this._currentChip=e.currentChip,this._viewLoading.then((t=>{this._view=t,this.updateNeighborsSelected(this._neighborsSelected),t.btnMinusPressed.subscribe((()=>{this._neighborsSelected>0&&(this.updateNeighborsSelected(this._neighborsSelected-1),e.audioEventHandler.play(or.UI_Click))})),t.btnPlusPressed.subscribe((()=>{this._neighborsSelected<e.maxNeighbors&&(this.updateNeighborsSelected(this._neighborsSelected+1),e.audioEventHandler.play(or.UI_Click))})),t.numbersSelected.subscribe((t=>{e.audioEventHandler.play(or.UI_Click);const i=this._currentChip.centsValue,s=t.map((t=>e.straightBets.withRouletteNumber(t))).map((e=>new j(e,i))),r=new te(s),n=e.applyBetSnapshotActionFactory.create("applyRacetrackbet",r,!1);n.availabilityObservable.pipe(Je()).subscribe((t=>{t?n.execute():e.audioEventHandler.play(or.Lose),n.dispose()}))})),t.closeClicked.subscribe((()=>{t.hide(),e.audioEventHandler.play(or.UI_Click)}))}))}async show(e){const t=await this._viewLoading,i=t.onHidden.subscribe((()=>{i.unsubscribe(),e.onClosed()}));await t.show()}hide(){this._view&&this._view.hide()}updateNeighborsSelected(e){this._neighborsSelected=e,this._view&&(this._view.setNeighborsNumber(e),this._view.setBtnMinusEnabled(e>0),this._view.setBtnPlusEnabled(e<this._maxNeighbors))}}class hn extends Sr{constructor(e){const t=pr.calculateRefSizeConfig({contentRefSize:{w:728,h:1088},refResLandscape:{w:2560,h:1284},screenFraction:{landscape:{width:.5,height:.9},portrait:{width:.9,height:.9}}});super("dlg-Stats",e.uiContainer,t,{shroud:!0}),this._closeClicked=new X,this._refSize={w:728,h:1088};const i={...this._refSize,width:this._refSize.w,height:this._refSize.h};this._refRes={w:2560,h:1284};const s=pr.createImage(e.controls.background,"bg-dlg-Stats");s.width="100%",s.height="100%",s.stretch=hr.STRETCH_FILL,this.addControlToRoot(s),s.zIndex=-1;const r=new vr("wheel-bg");r.background=bt.v9.FromInts(211,208,191).toHexString();const n=i.w-192;r.width=n/i.w*100+"%",r.height=n/i.h*100+"%",r.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,r.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,r.top=53/i.h*100+"%",this.addControlToRoot(r),this._sectorMap=this.generateSectors(e.zeroBasedClockwiseNumbers,n,i,{top:r.top,left:"0px"});const o=pr.createImage(e.controls.wheel,"wheel");this.addControlToRoot(o),o.verticalAlignment=r.verticalAlignment,o.width=e.controls.wheel.width/i.w*100+"%",o.height=e.controls.wheel.height/i.h*100+"%",o.top="4.21%",o.left="-0.07%",o.zIndex=1;const a=pr.createImage(e.controls.wheelCap,"wheelCap");this.addControlToRoot(a),pr.setRelativeSize({control:a,containerSize:i,controlSize:{width:85,height:85}}),a.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,a.top=280/i.h*100+"%",a.zIndex=2,this._sectorMinScale=85/n*.95,this._sectorMaxScale=.87;const h=pr.createImage(e.controls.hotColdBG,"bg-hotNumbers",{setSizeRelativeToContainer:i,setPositionRelativeToContainer:{alignment:{horizontal:xs.HORIZONTAL_ALIGNMENT_LEFT,vertical:xs.VERTICAL_ALIGNMENT_TOP},container:i,position:{left:20,top:655}}});this.addControlToRoot(h);const l=pr.createImage(e.controls.hotTitle,"titleHot",{setSizeRelativeToContainer:i,setPositionRelativeToContainer:{alignment:{horizontal:xs.HORIZONTAL_ALIGNMENT_LEFT,vertical:xs.VERTICAL_ALIGNMENT_TOP},container:i,position:{left:75,top:672}}});this.addControlToRoot(l);const c=pr.createImage(e.controls.hotColdGrid,"hotNumbersGrid",{setSizeRelativeToContainer:i,setPositionRelativeToContainer:{container:i,alignment:{horizontal:xs.HORIZONTAL_ALIGNMENT_LEFT,vertical:xs.VERTICAL_ALIGNMENT_TOP},position:{left:63,top:730}}});this.addControlToRoot(c);const u=new Map([[At.Black,734],[At.Red,734],[At.None,734]]),d=new Map([[At.Black,bt.v9.Black()],[At.Red,bt.v9.FromInts(167,0,0)],[At.None,bt.v9.FromInts(1,163,1)]]);this._hotNumbersGrid=new cn(u,d,{xStart:68,cellWidth:41,cellHeight:41,columns:5,cellStep:53.5},i,this.addControlToRoot.bind(this));const _=pr.createImage(e.controls.hotColdBG,"bg-coldNumbers",{setSizeRelativeToContainer:i,setPositionRelativeToContainer:{alignment:{horizontal:xs.HORIZONTAL_ALIGNMENT_RIGHT,vertical:xs.VERTICAL_ALIGNMENT_TOP},container:i,position:{left:-20,top:655}}});this.addControlToRoot(_);const p=pr.createImage(e.controls.coldTitle,"titleCold",{setSizeRelativeToContainer:i,setPositionRelativeToContainer:{alignment:{horizontal:xs.HORIZONTAL_ALIGNMENT_LEFT,vertical:xs.VERTICAL_ALIGNMENT_TOP},container:i,position:{left:406,top:672}}});this.addControlToRoot(p);const g=pr.createImage(e.controls.hotColdGrid,"coldNumbersGrid",{setSizeRelativeToContainer:i,setPositionRelativeToContainer:{container:i,alignment:{horizontal:xs.HORIZONTAL_ALIGNMENT_RIGHT,vertical:xs.VERTICAL_ALIGNMENT_TOP},position:{left:-63,top:730}}});this.addControlToRoot(g),this._coldNumbersGrid=new cn(u,d,{xStart:406,cellWidth:41,cellHeight:41,columns:5,cellStep:53.5},i,this.addControlToRoot.bind(this));const f=pr.createImage(e.controls.historyGrid,"historyGrid",{setSizeRelativeToContainer:i,setPositionRelativeToContainer:{position:{top:850},alignment:{vertical:xs.VERTICAL_ALIGNMENT_TOP},container:i}});this.addControlToRoot(f),this._historyGrid=new cn(new Map([[At.Black,855],[At.None,900],[At.Red,945]]),d,{xStart:41.5,cellWidth:41,cellHeight:41,cellStep:46.45,columns:14},i,this.addControlToRoot.bind(this));const m=e.controls.btnClose;this.addControlToRoot(m),m.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,m.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,m.zIndex=10,m.width=m.height="80px",m.left="-5%",m.top="2%",m.width="8%",m.height="6%",m.onPointerClickObservable.add((()=>{this.onCloseClicked()}))}onCloseClicked(){this._closeClicked.next()}get closeClicked(){return this._closeClicked}setData(e){this._sectorMap.forEach(((t,i)=>{const s=e.frequencies.get(i)??0;this.setSectorScale(t,s)})),this._historyGrid.setNumbers(e.lastNumbersLastToFirst),this._hotNumbersGrid.setNumbers([...e.hotNumbers].reverse(),""),this._coldNumbersGrid.setNumbers([...e.coldNumbers].reverse(),"")}setSectorScale(e,t){e.scaleX=e.scaleY=this._sectorMinScale+t*(this._sectorMaxScale-this._sectorMinScale)}generateSectors(e,t,i,s){const r=new Map,n=e.length,o=2*Math.PI/n,a=-Math.PI/2,h=this.drawSector(t/2,o,{r:167,g:0,b:0,a:1}),l=this.drawSector(t/2,o,{r:1,g:163,b:1,a:1}),c=this.drawSector(t/2,o,{r:0,g:0,b:0,a:1});return e.forEach(((e,o)=>{const u=e.color===At.Black?c:e.color===At.Red?h:l,d=new hr(`sector-${e.name}`,u.getContext().canvas.toDataURL("image/png"));this.addControlToRoot(d),d.width=t/i.w*100+"%",d.height=t/i.h*100+"%",d.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,d.top=s.top,d.rotation=a+o*(2*Math.PI/n),r.set(e,d)})),r}onShroudClicked(){this.onCloseClicked()}drawSector(e,t,i){const s=2*e,r=2*e,n=new ns("dynamic texture",{width:s,height:r},null,!1),o=n.getContext();o.clearRect(0,0,s,r);const a=s/2,h=r/2,l=-t/2,c=t/2;return o.beginPath(),o.moveTo(a,h),o.arc(a,h,e,l,c),o.closePath(),o.fillStyle=`rgba(${i.r}, ${i.g}, ${i.b}, ${i.a})`,o.fill(),n.update(),n}}class ln{constructor(e){this._viewLoading=e.viewLoading,this._statsController=e.statsController;const t=this;e.viewLoading.then((i=>{i.closeClicked.subscribe((()=>{e.audioEventHandler.play(or.UI_Click),t.onCloseClicked(i)}))}))}async show(){const e=await this._viewLoading,t=this._statsController.currentStats.value,i=new Map;t.hitMap.forEach((e=>{const s=0===t.maxHitsNumber?0:e.hits/t.maxHitsNumber;i.set(e.number,s)})),e.setData({coldNumbers:t.coldNumbers.map((e=>e.number)),hotNumbers:t.hotNumbers.map((e=>e.number)),lastNumbersLastToFirst:t.history,frequencies:i}),e.show(),this._view=e}hide(){this._view&&this._view.hide()}onCloseClicked(e){e.hide()}}class cn{constructor(e,t,i,s,r){const n=this._verticalPositonPerColor=new Map;e.forEach(((e,t)=>{n.set(t,e/s.h*100+"%")})),this._colorPerNumberColor=t;const o=i.cellWidth/s.w,a=i.cellHeight/s.h,h=[];for(let t=0;t<i.columns;t++){const n=e.get(At.Red)||0,l=i.xStart+i.cellStep*t,c=n/s.h,u=l/s.w,d=new un(`n-${t}`);r(d),d.top=100*c+"%",d.left=100*u+"%",d.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,d.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,d.width=100*o+"%",d.height=100*a+"%",h.push(d)}this._cells=h}setNumbers(e,t){const i=e.length;let s=0;s=i>this._cells.length?this._cells.length-1:i-1;for(let i=0;i<this._cells.length;i++){const r=this._cells[i],n=s-i;if(n<0)r.textBlock.text=t??"",r.background="#00000000";else{const t=e[n];r.textBlock.text=t.value===K.DOUBLE_ZERO_ID?"00":t.value.toString(),r.top=this._verticalPositonPerColor.get(t.color)||"0px",r.textBlock.color="white",r.background=this._colorPerNumberColor.get(t.color)?.toHexString()||"#00000000"}}return{numbersDisplayed:Math.min(e.length,this._cells.length)}}get textFields(){return this._cells}}class un extends As{constructor(e){super(e);const t=this._textBlock=new lr("txt");t.width="100%",t.height="100%",t.fontFamily="Arial",t.fontSize="80%",t.color="white",t.fontStyle="bold",this.addControl(t)}get textBlock(){return this._textBlock}}class dn extends As{constructor(e,t){super(e),this._horizontal=!0,this._numbersDisplayed=0;const i=this._bgImage=t.background;i.zIndex=-1,this.addControl(i),i.width="100%",i.height="100%",i.stretch=hr.STRETCH_FILL;const s={w:i.domImage.width,h:i.domImage.height};this._grid=new cn(new Map([[At.Black,16],[At.Red,16],[At.None,16]]),new Map([[At.Black,bt.v9.Black()],[At.Red,bt.v9.FromInts(167,0,0)],[At.None,bt.v9.FromInts(1,163,1)]]),{xStart:48,cellWidth:44,cellHeight:44,columns:7,cellStep:57.5},s,this.addControl.bind(this)),this.addControl(t.frame),this._frame=t.frame,this._frame.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this._frame.verticalAlignment=As.VERTICAL_ALIGNMENT_TOP,this._frame.top="4px",pr.setRelativeSize({control:t.frame,containerSize:t.background.domImage,controlSize:t.frame.domImage})}get bgImage(){return this._bgImage}setNumbers(e){const{numbersDisplayed:t}=this._grid.setNumbers(e);this._numbersDisplayed=t,this.positionFrame(t,this._horizontal)}applyLayout(e){this._horizontal="horizontal"===e,this._grid.textFields.forEach((t=>{t.rotation="horizontal"===e?0:-Math.PI/2})),this._frame.rotation="horizontal"===e?0:-Math.PI/2,this.positionFrame(this._numbersDisplayed,this._horizontal)}positionFrame(e,t){if(0===e)this._frame.isVisible=!1;else if(this._frame.isVisible=!0,t){const t=24.5+238/6*(e-1);this._frame.top="4px",this._frame.left=`${t}px`}else{const t=36+344/6*(e-1);this._frame.left=`${t}px`,this._frame.top="5px"}}}class _n extends Sr{constructor(e,t){const i=pr.calculateRefSizeConfig({contentRefSize:{w:539,h:554},refResLandscape:{w:2560,h:1284},screenFraction:{landscape:{width:.5,height:.7},portrait:{width:.9,height:.9}}});super("dlg-Info",e,i,{shroud:!0}),this._closeClicked=new X,this._paytableClicked=new X,this._historyClicked=new X,this._rulesClicked=new X;const s=pr.createImage(t.background,"bg");this.addControlToRoot(s),s.width="100%",s.height="100%";const r=(i,s)=>{const r=fn.buildStandardRectButton(i,t.greenButton,{height:"68%",width:"94%",cornerRadius:.9,top:"-13%",left:"0px"},e);r.modifyImages((e=>{e.width=e.height="100%"})),r.width="61.71107994389901%",r.height="22.12837837837838%";const n=new lr(`label-${i}`,s);return r.addScaleableControl(n),n.width="94%",n.height="70%",n.fontFamily="Arial",n.outlineWidth=6,n.outlineColor="#000000FF",n.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,n.top="2%",n.fontSize="35%",n.fontWeight="bold",n.color="white",this.addControlToRoot(r),r},n=r("btn-Paytable","PAYTABLE");n.onPointerClickObservable.add((()=>{this._paytableClicked.next()})),n.top="-20%";const o=r("btn-Rules","RULES");o.onPointerClickObservable.add((()=>{this._rulesClicked.next()})),o.top="5%";const a=r("btn-History","HISTORY");a.onPointerClickObservable.add((()=>{this._historyClicked.next()})),a.top="30%",a.isVisible=!1}onShroudClicked(){this.hide()}get paytableClicked(){return this._paytableClicked}get historyClicked(){return this._historyClicked}get rulesClicked(){return this._rulesClicked}}class pn{constructor(e,t,i){this._viewLoading=e,this._clientEmitter=t;const s=()=>{i.play(or.UI_Click)};e.then((e=>{e.paytableClicked.subscribe((()=>{s(),t.emit("GameOpenPaytable")})),e.historyClicked.subscribe((()=>{s(),t.emit("GameOpenHistory")})),e.rulesClicked.subscribe((()=>{s(),t.emit("GameOpenHelp")}))}))}async show(){const e=await this._viewLoading;await e.show(),this._view=e}hide(){this._view&&(this._view.hide(),this._clientEmitter.emit("GameClosePaytable"),this._clientEmitter.emit("GameCloseHelp"))}}class gn{}gn.Default=0,gn.GameUI=100,gn.GamePopup=200,gn.Dialog=300,gn.GameUI_OverDialogs=500,gn.ModalPopup=1e3,gn.Meters=999999,gn.FullScreenOverlay=999999999;class fn{constructor(e,t){this._imageLoader=e,this._mobile=t}async buildMainUI(e,t,i,s,r,n){const[o,a]=await Promise.all([this.loadAssetsAndCreateControls(e,t,i,s,n),t]),h=new gr;return new fr(e,o,h)}async loadAssetsAndCreateControls(e,t,i,s,r){const n={zIndex:gn.GameUI},o={width:"100%",height:"90%",vAlign:As.VERTICAL_ALIGNMENT_TOP,left:"0%",top:"-1%",cornerRadius:.26},a={width:"100%",height:"100%",vAlign:xs.VERTICAL_ALIGNMENT_TOP,hAlign:xs.HORIZONTAL_ALIGNMENT_LEFT,left:"0%",top:"0%",cornerRadius:.25},h={cornerRadius:.5,width:"100%",height:"100%",left:0,top:0},[l,c,u,d,_,p,g,f,m,b,v,T,y,x,A,C,S,E,R,P,I,M]=await Promise.all([this.createRegularSquareButton("btn-Spin",e,Ne.UI_BtnSpin,n,h),this.createRegularSquareButton("btn-RebetAndSpin",e,Ne.UI_BtnRebetAndSpin,n,h),this.createRegularSquareButton("btn-Undo",e,Ne.UI_BtnUndo,n,a),this.createRegularSquareButton("btn-Clear",e,Ne.UI_BtnClear,n,a),this.createRegularSquareButton("btn-Rebet",e,Ne.UI_BtnRebet,n,a),this.createRegularSquareButton("btn-Double",e,Ne.UI_BtnDouble,n,a),this.createRegularSquareButton("btn-Skip",e,Ne.UI_BtnSkip,n,h),this.createRegularSquareButton("btn-FavBet",e,Ne.UI_BtnFavBet,n,o),this.createMeterWithTextLabel("meter-Win","WIN:","400px","75px",{zIndex:gn.Meters}),this.createMeterWithTextLabel("meter-Balance","BALANCE:","500px","170px",{zIndex:gn.Meters}),this.createMeterWithTextLabel("meter-Bet","BET:","400px","75px",{zIndex:gn.Meters}),this.createBetSelector("betSelector",e,t,s,r,n),this.createBottomBar(e,{zIndex:gn.Meters}),this.createRegularSquareButton("btn-Settings",e,Ne.UI_BtnSettings,n,o),this.createRegularSquareButton("btn-AudioOn",e,Ne.UI_BtnAudioOn,n,o),this.createRegularSquareButton("btn-AudioOff",e,Ne.UI_BtnAudioOff,n,o),this.createRegularSquareButton("btn-Racetrack",e,Ne.UI_RaceTrack_Button,n,o),this.createRegularSquareButton("btn-Stats",e,Ne.UI_Stats_Button,n,{width:"100%",height:"90%",vAlign:xs.VERTICAL_ALIGNMENT_TOP,left:"0%",top:"5%",cornerRadius:.2}),this.createLastNumbersGrid({uiContainer:e}),this.createRegularSquareButton("btn-Info",e,Ne.UI_BtnInfo,n,o),this.createRegularSquareButton("btn-NewGame",e,Ne.UI_BtnNewGame,n,a),this._imageLoader.load(Ne.UI_TableLimitsFrame)]);return[l,c,g].forEach((e=>{e.modifyImages((e=>{e.stretch=hr.STRETCH_UNIFORM,e.width="105%",e.height="109%",e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,e.horizontalAlignment=As.HORIZONTAL_ALIGNMENT_LEFT,e.left="-3%"})),e.width=e.height="225px"})),[f,S].forEach((e=>{e.modifyImages((e=>{e.stretch=hr.STRETCH_UNIFORM,e.width="115%",e.height="110%",e.top="5%"})),e.width=e.height="130px"})),E.modifyImages((e=>{e.width="120%",e.height="120%",e.top="12%"})),[x,A,C,P].forEach((e=>{e.modifyImages((e=>{e.stretch=hr.STRETCH_UNIFORM,e.width="140%",e.height="140%",e.top="5%"})),e.width=e.height="150px"})),[u,d,_,p,I].forEach((e=>{e.modifyImages((e=>{e.width="116%",e.height="119%",e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,e.left="-8%"}))})),[I,_,c].forEach((e=>e.zIndex=gn.GameUI_OverDialogs)),{buttons:{spin:l,undo:u,clear:d,rebet:_,rebetAndSpin:c,double:p,skipWheelSpin:g,favBet:f,settings:x,audioOn:A,audioOff:C,racetrack:S,stats:E,info:P,newGame:I},meters:{win:m,balance:b,bet:v,bottomBar:y,minMaxBetContainer:new mr({frame:M})},betSelector:T,lastNumbersGrid:R}}createTempButton(e){return pr.createStandardButton({name:e.name,text:e.text,size:e.size??{width:"100px",height:"100px",cornerRadius:20},font:{size:24}})}async createLastNumbersGrid(e){const[t,i]=await Promise.all([this._imageLoader.load(Ne.UI_Stats_UILastNumbersBar),this._imageLoader.load(Ne.UI_Stats_UILastNumberFrame)]),s=pr.createImage(t,"img-NumbersHistory"),r=pr.createImage(i,"img-LastNumberFrame"),n=new dn("numbers-history",{background:s,frame:r});return n.zIndex=gn.GameUI-1,e.uiContainer.addControl(n),n}async loadFrameSlice9(e){const t=await this._imageLoader.load(Ne.UI_Frame_Slice9),i=new hr(e);return i.domImage=t,i.stretch=hr.STRETCH_NINE_PATCH,i.sliceLeft=44,i.sliceRight=43,i.sliceTop=32,i.sliceBottom=66,i}async buildInfoDialog(e){const[t,i]=await Promise.all([this._imageLoader.load(Ne.UI_InfoDialog_Background),this._imageLoader.load(Ne.UI_GenericGreenButton)]),s=new _n(e.uiContainer,{background:t,greenButton:i});return e.uiContainer.addControl(s),s.zIndex=gn.GameUI_OverDialogs+10,s}async buildWinningNumberPopup(e){const[t,i]=await Promise.all([this._imageLoader.load(Ne.UI_WinningNumberPopup_Background),this._imageLoader.load(Ne.UI_WinningNumberPopup_Circle)]),s=new Er("ui-winningNumberPopup",e.uiContainer,{currencyFormatter:e.currencyFormatter,frameImgElement:t,circleImgElement:i});return s.zIndex=gn.GamePopup,e.uiContainer.addControl(s),e.resizeHandler.register(s),s.clipChildren=!1,s.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,await s.hide(AbortSignal.abort(ei.JumpToEnd)),s}async buildStatsDialog(e){const[t,i,s,r,n,o,a,h,l]=await Promise.all([this._imageLoader.load(Ne.UI_FavBet_Background),this._imageLoader.load(Ne.UI_Stats_Wheel),this._imageLoader.load(Ne.UI_Stats_WheelCap),fn.buildStandardCloseButton("btn-Close",this._imageLoader,e.uiContainer),this._imageLoader.load(Ne.UI_Stats_HotColdFrame),this._imageLoader.load(Ne.UI_Stats_TitleHot),this._imageLoader.load(Ne.UI_Stats_TitleCold),this._imageLoader.load(Ne.UI_Stats_HotColdGrid),this._imageLoader.load(Ne.UI_Stats_Grid)]),c=new hn({controls:{background:t,wheel:i,wheelCap:s,btnClose:r,hotColdBG:n,hotTitle:o,coldTitle:a,hotColdGrid:h,historyGrid:l},uiContainer:e.uiContainer,zeroBasedClockwiseNumbers:e.zeroBasedCWNnumbers});return c.zIndex=gn.Dialog,e.uiContainer.addControl(c),c}async buildFavBetDialog(e){const[t,i,s,r,n,o,a]=await Promise.all([this._imageLoader.load(Ne.UI_FavBet_Background),this._imageLoader.load(Ne.UI_FavBet_EmptySlot),this._imageLoader.load(Ne.UI_FavBet_BtnDelete),this._imageLoader.load(Ne.UI_FavBet_Title),(async()=>{const t=await fn.loadAndBuildStandardRectButton("btn-AddPresert",this._imageLoader,Ne.UI_BtnClose,{width:"100%",height:"100%",cornerRadius:.05,left:0,top:0},e.uiContainer);return t.modifyImages((e=>{e.rotation=Math.PI/4,e.width="100%",e.height="60%"})),t.adaptWidthToChildren=t.adaptHeightToChildren=!1,t})(),fn.buildStandardCloseButton("btn-Close",this._imageLoader,e.uiContainer),this._imageLoader.load(Ne.UI_FavBet_LinkedSlot)]),h=new zr("dlg-favBets",e.uiContainer,{slots:e.maxSlots,currencyFormatter:e.currentcyFormatter,bgImage:t,titleImage:r,slotImages:{emptySlot:i,btnDelete:s,linkedSlot:a},buttonAddPreset:n,btnClose:o});return h.zIndex=gn.Dialog,e.uiContainer.addControl(h),await h.hide(AbortSignal.abort(ei.JumpToEnd)),h}async buildFavBetDeleteConfirmationDialog(e){const[t,i,s,r]=await Promise.all([this._imageLoader.load(Ne.UI_SmallDialogBox),this._imageLoader.load(Ne.UI_FavBet_DeleteConfirmationMessage),this._imageLoader.load(Ne.UI_BtnConfirm),this._imageLoader.load(Ne.UI_BtnCancel)]),n=new qr(e.uiContainer,{background:t,message:i,yesBtn:s,noBtn:r});return n.zIndex=gn.ModalPopup,e.uiContainer.addControl(n),n}async buildBetSpotHintPopup(e){const[t,i,s,r]=await Promise.all([this._imageLoader.load(Ne.UI_BetSpotHint_Background),this._imageLoader.load(Ne.UI_BetSpotHint_2X),this._imageLoader.load(Ne.UI_BetSpotHint_Clear),this._imageLoader.load(Ne.UI_BetSpotHint_Add)]),n=new tn(e.uiContainer,{background:t,btnDouble:i,btnClear:s,btnAdd:r});return n.zIndex=gn.GamePopup,e.uiContainer.addControl(n),n}async buildAddFavBetDialog(e){const[t,i,s,r,n]=await Promise.all([this._imageLoader.load(Ne.UI_SmallDialogBox),this._imageLoader.load(Ne.UI_FavBet_EnterBetMessage),this._imageLoader.load(Ne.UI_FavBet_EnterBetTextBox),this._imageLoader.load(Ne.UI_BtnAdd),this._imageLoader.load(Ne.UI_BtnCancel)]),o=new Xr("dlg-addFavBet",e.uiContainer,{maxNameLength:e.maxNameLength,mobile:this._mobile},{background:t,message:i,textBox:s,btnAdd:r,btnCancel:n});return o.zIndex=gn.Dialog+1,e.uiContainer.addControl(o),o}async buildSettingsDialog(e){const[t,i,s,r,n,o,a,h]=await Promise.all([this._imageLoader.load(Ne.UI_Settings_Background),this._imageLoader.load(Ne.UI_Settings_FeltButtons),this._imageLoader.load(Ne.UI_GenericGreenButton),this._imageLoader.load(Ne.UI_Settings_WheelCW),this._imageLoader.load(Ne.UI_Settings_WheelCCW),this._imageLoader.load(Ne.UI_Settings_WheelAlt),this.buildToggleButton("tgl-rightHanded"),this.buildToggleButton("tgl-PiP")]),l=new Yr(e.container,{background:t,feltButtons:i,speedButtonBackground:s,buttons:{wheelAlternating:o,wheelCCW:n,wheelCW:r},toggles:{pictureInPicture:h,rightHanded:a}});return l.zIndex=gn.Dialog,e.container.addControl(l),l}async buildToggleButton(e){const[t,i,s]=await Promise.all([this._imageLoader.load(Ne.UI_ToggleOn),this._imageLoader.load(Ne.UI_ToggleOff),this._imageLoader.load(Ne.UI_ToggleKnob)]),r={width:"90%",height:"80%",cornerRadius:.5,left:0,top:"-10%"},n=new _r(`${e}-hitZone`);n.cornerRadius=r.cornerRadius,n.width="number"==typeof r.width?`${r.width}px`:r.width,n.height="number"==typeof r.height?`${r.height}px`:r.height,n.verticalAlignment=void 0===r.vAlign?xs.VERTICAL_ALIGNMENT_CENTER:r.vAlign,n.horizontalAlignment=void 0===r.hAlign?xs.HORIZONTAL_ALIGNMENT_CENTER:r.hAlign,n.top=r.top,n.left=r.left,n.isPointerBlocker=!0,n.highlightColor="#00000000",n.background="#00FF0011",n.clipChildren=n.clipContent=!1;const o=pr.createImage(t,"img-toggleOn"),a=pr.createImage(i,"img-toggleOff"),h=pr.createImage(s,"img-toggleKnob"),l=Rr.processImage(s,Rr.PixelFilterHighlightedButton),c=new rn(e,{on:o,off:a,knob:h,knobHighlighted:l},{onPercent:24,offPercent:-24},n);return c.width=`${t.width}px`,c.height=`${t.height}px`,o.width=o.height="100%",a.width=a.height="100%",[h,l].forEach((e=>{e.width=65/170*100+"%",e.height=65/90*100+"%",e.top="-6%"})),c}async buildAudioSettingsDialog(e){const[t,i,s,r,n,o]=await Promise.all([this._imageLoader.load(Ne.UI_AudioSettings_Background),this._imageLoader.load(Ne.UI_GenericGreenButton),this.buildToggleButton("toggle-mute"),this.buildToggleButton("toggle-music"),this.buildToggleButton("toggle-sfx"),this.buildToggleButton("toggle-vo")]),a=new Jr(e.container,{bgImageElement:t,buttonElement:i,toggles:{mute:s,music:r,sfx:n,vo:o}},new Map([[Zr.Jazz,"JAZZ"],[Zr.Lounge,"LOUNGE"],[Zr.Blues,"BLUES"],[Zr.Chill,"CHILL"],[Zr.CasinoAmbience,"CASINO"],[Zr.Classic,"CLASSICAL"],[Zr.Neon,"NEON"],[Zr.Heavy,"HEAVY"],[Zr.Groovy,"GROOVY"]]));return a.zIndex=gn.Dialog,e.container.addControl(a),a}async buildRacetrackDialog(e){const[t,i,s,r,n,o,a,h,l,c]=await Promise.all([this._imageLoader.load(Ne.UI_RaceTrack_Background),this._imageLoader.load(Ne.UI_RaceTrack_Numbers),this._imageLoader.load(Ne.UI_RaceTrack_BtnMinus),this._imageLoader.load(Ne.UI_RaceTrack_BtnPlus),fn.buildStandardCloseButton("btn-Close",this._imageLoader,e.container),this._imageLoader.load(Ne.UI_RaceTrack_HitZone_0),this._imageLoader.load(Ne.UI_RaceTrack_HitZone_14),this._imageLoader.load(Ne.UI_RaceTrack_HitZone_2),this._imageLoader.load(Ne.UI_RaceTrack_HitZone_28),this._imageLoader.load(Ne.UI_RaceTrack_HitZone_Rect)]),u=new nn("dlg-Racetrack",e.container,{background:t,racetrack:i,btnMinus:s,btnPlus:r,btnClose:n,hitZones:{hz0:o,hz14:a,hz2:h,hz28:l,hzRect:c}},e.numSet);return u.zIndex=gn.Dialog,e.container.addControl(u),u}async createBetSelector(e,t,i,s,r,n){const o=await i,a=await yr.build(this._imageLoader,t,o.chipValuesAscending,s,o.defaultChip,r);return a.zIndex=n?.zIndex??0,a}async createMeterWithTextLabel(e,t,i,s,r){const n={family:ke.Rubik.name,size:32,color:"white"},o=new br(e,n,s);o.zIndex=r?.zIndex??0,o.width=i,o.height="60px";const a=new lr(`lbl-${e}`);return a.fontFamily=n.family,a.fontSize=n.size,a.color=n.color,a.verticalAlignment=lr.VERTICAL_ALIGNMENT_CENTER,a.horizontalAlignment=lr.HORIZONTAL_ALIGNMENT_LEFT,a.text=t,a.resizeToFit=!0,a.textHorizontalAlignment=lr.HORIZONTAL_ALIGNMENT_LEFT,o.addControl(a),o}async createBottomBar(e,t){const i=new As("cnt-BottomBar");i.zIndex=t?.zIndex??0,e.addControl(i),i.width="102%",i.height="65px";const s=new cr("bkg-BottomBar");return i.addControl(s),s.color="fff6d6",s.height="110%",s.width="100%",s.top="0",s.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,s.background="#000000",s.thickness=3,s.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,i.verticalAlignment=As.VERTICAL_ALIGNMENT_BOTTOM,i.horizontalAlignment=As.HORIZONTAL_ALIGNMENT_CENTER,i}async createRegularSquareButton(e,t,i,s,r){const n=r??{cornerRadius:.25,width:188,height:174,left:0,top:-16},o=await fn.loadAndBuildStandardRectButton(e,this._imageLoader,i,n,t);return o.zIndex=s?.zIndex??0,o}static async buildStandardCloseButton(e,t,i){return await this.loadAndBuildStandardRectButton(e,t,Ne.UI_BtnClose,{cornerRadius:.1,height:"100%",width:"100%",left:0,top:0},i,{pressed:{scale:.9},fitImageToContainer:!0})}static async loadAndBuildStandardRectButton(e,t,i,s,r,n){const o=await t.load(i);return this.buildStandardRectButton(e,o,s,r,n)}static buildStandardRectButton(e,t,i,s,r,n){const o=new _r(`${e}-hitZone`);return o.cornerRadius=i.cornerRadius,o.width="number"==typeof i.width?`${i.width}px`:i.width,o.height="number"==typeof i.height?`${i.height}px`:i.height,o.verticalAlignment=void 0===i.vAlign?xs.VERTICAL_ALIGNMENT_CENTER:i.vAlign,o.horizontalAlignment=void 0===i.hAlign?xs.HORIZONTAL_ALIGNMENT_CENTER:i.hAlign,o.top=i.top,o.left=i.left,o.isPointerBlocker=!0,o.highlightColor="#00000000",o.background="#00FF0011",o.clipChildren=o.clipContent=!1,fn.buildStandardImageButton({name:e,htmlImageAsset:t,uiContainer:s,hitZone:o,buttonStateParams:r??{pressed:{scale:.9}}})}static buildSelectableRectButton(e,t,i,s,r){const n=new _r(`${e}-hitZone`);return n.cornerRadius=i.cornerRadius,n.width="number"==typeof i.width?`${i.width}px`:i.width,n.height="number"==typeof i.height?`${i.height}px`:i.height,n.top=i.top,n.left=i.left,n.isPointerBlocker=!0,n.highlightColor="#00000000",n.background="#00FF0011",n.clipChildren=n.clipContent=!1,fn.buildSelectableImageButton({name:e,htmlImageAsset:t,uiContainer:s,hitZone:n,buttonStateParams:r??{pressed:{scale:.9}}})}static buildSelectableImageButton(e){const t=new hr(`img-${e.name}`);t.clipContent=!1,t.widthInPixels=e.htmlImageAsset.width,t.heightInPixels=e.htmlImageAsset.height,t.domImage=e.htmlImageAsset,t.stretch=hr.STRETCH_UNIFORM,t.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,t.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,t.isHitTestVisible=!1;const i=Rr.processImage(t,Rr.PixelFilterUnselectedButton);i.isHitTestVisible=!1,i.widthInPixels=e.htmlImageAsset.width,i.heightInPixels=e.htmlImageAsset.height,i.name=`img-${e.name}-unselected`,i.clipContent=!1;const s=Rr.processImage(t,Rr.Combine(Rr.PixelFilterUnselectedButton,Rr.PixelFilterHighlightedButton));s.clipContent=!1,s.name=`img-${e.name}-highlighted`;const r=new Kr(e.name,{default:i,inactive:t,highlighed:s},e.hitZone,e.buttonStateParams);return e.uiContainer.registerControl(r),r.isPointerBlocker=!0,r}static buildStandardImageButton(e){const t=new hr(`img-${e.name}`);let i;t.clipContent=!1,t.width="100%",t.height="100%",t.domImage=e.htmlImageAsset,t.stretch=hr.STRETCH_UNIFORM,t.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,t.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,t.isHitTestVisible=!1,!0!==e.dontGenerateDisabledState&&(i=Rr.processImage(t,Rr.PixelFilterDisabledButton),i.isHitTestVisible=!1,i.name=`img-${e.name}-inactive`,i.clipContent=!1,i.width=i.height="100%");const s=Rr.processImage(t,Rr.PixelFilterHighlightedButton);t.clipContent=!1,s.name=`img-${e.name}-highlighted`,s.width=s.height="100%";const r=new Kr(e.name,{default:t,inactive:i,highlighed:s},e.hitZone,e.buttonStateParams);return e.uiContainer.registerControl(r),r.isPointerBlocker=!0,r}}class mn{constructor(e,t,i,s,r,n,o,a,h,l,c,u,d,_,p,g,f,m,b,v,T,y,x){this._rebetAndSpinAvailable=!1,this._uniqueLocksContainer=new vn,this._view=e,this._currencyFormatter=s,this._startGameEvent=r,this._placedBetsWithErrorHandling=t,this._audioPlayer=a,this._cameraController=h,this._skipWheelSpinSubject=l,this._actions=c,this._favBetDialogController=u,this._settingsDialogController=d,this._audioSettingsDialogController=_,this._settingsController=g,this._racetrackController=f,this._statsController=m,this._infoDialogController=y,this._betHintPopup=x,this._rebetStore=b,this._statsStore=v,this._newGameEvent=T,this._compositeUnsubscribable=new Ki,this._compositeUnsubscribable.add([i.centsObservable.subscribe(this.onPlayerBalanceChanged.bind(this)),n.centsObservable.subscribe(this.onCurrentWinChanged.bind(this)),o.snapshotObservable.subscribe(this.onLastBetSnapshotUpdated.bind(this)),t.placedBetsCollection.updateObservable.subscribe(this.onPlacedBetsChanged.bind(this)),t.placedBetsCollection.undoAvailabilityObservable.subscribe((e=>{e?this._uniqueLocksContainer.unlock(Ss.ButtonUndo,Mr.NoUndoHistory):this._uniqueLocksContainer.lock(Ss.ButtonUndo,Mr.NoUndoHistory)})),e.spinButtonClicked.subscribe(this.onSpinButtonPressed.bind(this)),e.clearBetsClicked.subscribe(this.onClearBetClicked.bind(this)),e.rebetClicked.subscribe(this.onRebetClicked.bind(this)),e.rebetAndSpinClicked.subscribe(this.onRebetAndSpinClicked.bind(this)),e.undoClicked.subscribe(this.onUndoClicked.bind(this)),e.doubleClicked.subscribe(this.onDoubleClicked.bind(this)),e.skipSpinClicked.subscribe(this.onSkipWheelSpinClicked.bind(this)),e.favBetClicked.subscribe(this.onFavBetClicked.bind(this)),e.settingsClicked.subscribe(this.onSettingsClicked.bind(this)),e.audioClicked.subscribe(this.onAudioSettingsClicked.bind(this)),e.racetrackClicked.subscribe(this.onRacetrackClicked.bind(this)),e.statsClicked.subscribe(this.onStatsClicked.bind(this)),e.infoClicked.subscribe((()=>{a.play(or.UI_Click),y.show()})),e.newGameClicked.subscribe(this.onNewGameClicked.bind(this)),this.linkUIControlToLocker(Ss.ButtonSpin),this.linkUIControlToLocker(Ss.ButtonClear,{hideWhenLocked:!0}),this.linkUIControlToLocker(Ss.ButtonReBet,{lockDuringSpin:!1,hideWhenLocked:!0}),this.linkUIControlToLocker(Ss.ButtonRebetAndSpin,{lockDuringSpin:!1,hideWhenLocked:!0}),this.linkUIControlToLocker(Ss.ButtonUndo,{hideWhenLocked:!0}),this.linkUIControlToLocker(Ss.ButtonDouble,{hideWhenLocked:!0}),this.linkUIControlToLocker(Ss.ButtonSkipWheelSpin,{lockDuringSpin:!1}),this.linkUIControlToLocker(Ss.ButtonFavBet),this.linkUIControlToLocker(Ss.ButtonSettings),this.linkUIControlToLocker(Ss.ButtonAudioOn),this.linkUIControlToLocker(Ss.ButtonAudioOff),this.linkUIControlToLocker(Ss.BetSelector),this.linkUIControlToLocker(Ss.ButtonRacetrack),this.linkUIControlToLocker(Ss.ButtonStats),this.linkUIControlToLocker(Ss.ButtonInfo),this.linkUIControlToLocker(Ss.ButtonNewGame,{lockDuringSpin:!1}),c.double.availabilityObservable.subscribe((e=>{e?this._uniqueLocksContainer.unlock(Ss.ButtonDouble,Mr.LinkedActionNotAvailable):this._uniqueLocksContainer.lock(Ss.ButtonDouble,Mr.LinkedActionNotAvailable)})),g.muteAll.subscribe((t=>{e.setControlVisible(Ss.ButtonAudioOff,t),e.setControlVisible(Ss.ButtonAudioOn,!t)})),v.currentStats.subscribe((t=>{e.setLastNumbers(t.history)})),h.pipCameraStateObservable.subscribe((t=>{const i=t?0:1;g.rightHanded.value?(e.setControlAlpha(Ss.ButtonAudioOff,i),e.setControlAlpha(Ss.ButtonAudioOn,i)):(e.setControlAlpha(Ss.ButtonRacetrack,i),e.setControlAlpha(Ss.ButtonFavBet,i))}))]),e.setBetLimits(s.centsToCurrencyString(p.totalBetRange.min,{useCurrency:!0,trailingZero:!1}),s.centsToCurrencyString(p.totalBetRange.max,{useCurrency:!0,trailingZero:!1})),e.setControlVisible(Ss.ButtonNewGame,!1),e.setControlEnabled(Ss.ButtonNewGame,!1),this.updateControlsBasedOnCurrentBets(this._placedBetsWithErrorHandling.placedBetsCollection)}hideAllDialogs(){this._favBetDialogController.hide(),this._settingsDialogController.hide(),this._audioSettingsDialogController.hide(),this._racetrackController.hide(),this._statsController.hide(),this._infoDialogController.hide(),this._view.getBetSelectorUI().hideGrid(),this._betHintPopup.hide()}setRebetAndSpinEnabled(e){this._view.setControlVisible(Ss.ButtonRebetAndSpin,e),this._view.setControlVisible(Ss.ButtonSpin,!e)}bringToZIndex(e,t){const i=new Map;return e.forEach((e=>{const s=this._view.getControlById(e);i.set(s,s.zIndex),s.zIndex=t})),{dispose:()=>{i.forEach(((e,t)=>{t.zIndex=e}))}}}setWheelSpinSkipEnabled(e){this._view.setControlVisible(Ss.ButtonSkipWheelSpin,e),e&&this.hideSpinButton()}lockBettingUI(e){this._uniqueLocksContainer.lock(Ss.AllBettingUI,e)}unlockBettingUI(e){this._uniqueLocksContainer.unlock(Ss.AllBettingUI,e)}dispose(){this._compositeUnsubscribable.unsubscribe()}linkUIControlToLocker(e,t){const i=this,s=t?.lockDuringSpin??!0,r=t?.hideWhenLocked??!1,n=t=>{i._view.setControlEnabled(e,!t),r&&this._view.setControlVisible(e,!t)};return s?sr([this._uniqueLocksContainer.lockedObservable(Ss.AllBettingUI),this._uniqueLocksContainer.lockedObservable(e)]).pipe(Js((([e,t])=>e||t))).subscribe(n):this._uniqueLocksContainer.lockedObservable(e).subscribe(n)}onSpinButtonPressed(){this._audioPlayer.play(or.UI_Click),this._startGameEvent.next()}onPlacedBetsChanged(e){this.updateControlsBasedOnCurrentBets(this._placedBetsWithErrorHandling.placedBetsCollection)}updateControlsBasedOnCurrentBets(e){this._view.setTotalBetText(this._currencyFormatter.centsToCurrencyString(e.currentTotalBet)),e.currentTotalBet>0?(this._uniqueLocksContainer.unlock([Ss.ButtonClear,Ss.ButtonSpin],Mr.NoBetsOnField),this._rebetAndSpinAvailable&&this._view.setControlVisible(Ss.ButtonSpin,!0)):(this._uniqueLocksContainer.lock([Ss.ButtonClear,Ss.ButtonSpin],Mr.NoBetsOnField),this._rebetAndSpinAvailable)}setRebetAndSpinAvailable(e){this._rebetAndSpinAvailable=e}hideSpinButton(){this._view.setControlVisible(Ss.ButtonSpin,!1)}showSpinButton(){this._rebetAndSpinAvailable&&0===this._placedBetsWithErrorHandling.placedBetsCollection.currentTotalBet||this._view.setControlVisible(Ss.ButtonSpin,!0)}onPlayerBalanceChanged(e){this._view.setPlayerBalanceText(this._currencyFormatter.centsToCurrencyString(e))}onCurrentWinChanged(e){this._view.setWinText(this._currencyFormatter.centsToCurrencyString(e))}onClearBetClicked(){this._audioPlayer.play(or.UI_Click),this._audioPlayer.play(or.ClearTable),this._placedBetsWithErrorHandling.placedBetsCollection.reset(!1)}onRebetClicked(){this._audioPlayer.play(or.UI_Click),this._rebetStore.rebetSnapshot&&this._rebetStore.rebetSnapshot.placedBets.length>0&&this._placedBetsWithErrorHandling.tryApplySnapshot(this._rebetStore.rebetSnapshot,!0)===H.Ok&&this._newGameEvent.next("Rebet")}onRebetAndSpinClicked(){this._audioPlayer.play(or.UI_Click),this._rebetStore.rebetSnapshot&&this._rebetStore.rebetSnapshot.placedBets.length>0&&this._placedBetsWithErrorHandling.tryApplySnapshot(this._rebetStore.rebetSnapshot,!0)===H.Ok&&this._newGameEvent.next("RebetAndSpin")}onUndoClicked(){this._audioPlayer.play(or.UI_Click),this._placedBetsWithErrorHandling.placedBetsCollection.undo()}onDoubleClicked(){this._audioPlayer.play(or.UI_Click),this._actions.double.execute()}onSkipWheelSpinClicked(){this._audioPlayer.play(or.UI_Click),this._skipWheelSpinSubject.next()}onFavBetClicked(){this._audioPlayer.play(or.UI_Click),this._favBetDialogController.show()}onRacetrackClicked(){this._audioPlayer.play(or.UI_Click);const e=this.bringToZIndex([Ss.BetSelector,Ss.ButtonClear,Ss.ButtonUndo,Ss.ButtonDouble],gn.GameUI_OverDialogs);this._racetrackController.show({onClosed:()=>{e.dispose()}})}onStatsClicked(){this._audioPlayer.play(or.UI_Click),this._statsController.show()}onInfoClicked(){this._audioPlayer.play(or.UI_Click)}onNewGameClicked(){this._audioPlayer.play(or.UI_Click),this._newGameEvent.next("NewGame")}onSettingsClicked(){this._audioPlayer.play(or.UI_Click),this._settingsDialogController.show()}onAudioSettingsClicked(){this._audioPlayer.play(or.UI_Click),this._audioSettingsDialogController.show()}onLastBetSnapshotUpdated(e){e.placedBets.length>0?(this._uniqueLocksContainer.unlock(Ss.ButtonReBet,Mr.NoReBetHistory),this.setRebetAndSpinAvailable(!0)):(this._uniqueLocksContainer.lock(Ss.ButtonReBet,Mr.NoReBetHistory),this.setRebetAndSpinAvailable(!1)),this._rebetStore.rebetSnapshot=e}}!function(e){e.NoBetsOnField="NoBetsOnField",e.GameInProgress="GameInProgress",e.NoReBetHistory="NoReBetHistory",e.NoUndoHistory="NoUndoHistory",e.LinkedActionNotAvailable="LinkedActionNotAvailable",e.Unsupported="Unsupported"}(Mr||(Mr={}));class bn{constructor(e,t){this.controlId=e,this.reason=t}equals(e){return!!e&&e.controlId===this.controlId&&e.reason===this.reason}static get(e,t){const i=`${e}#${t}`;let s=this._instances.get(i);return s||(s=new bn(e,t),this._instances.set(i,s)),s}}bn._instances=new Map;class vn{constructor(){this._locksContainer=new Wt,this._map=new Map}get locked(){return this._locksContainer.locked}isLocked(e){return this._locksContainer.isLocked(e)}lockedObservable(e){return this._locksContainer.lockedObservable(e)}unlock(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{const i=bn.get(e,t),s=this._map.get(i);s&&(s.dispose(),this._map.delete(i))}))}lock(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{const i=bn.get(e,t);let s=this._map.get(i);s||(s=new qt,this._map.set(i,s));const r=this._locksContainer.lock(e,t);s.add(r)}))}}class Tn{constructor(e,t){this._formatAmount=e,this._defaultFormatOptions=t}centsToCurrencyString(e,t){return this._formatAmount(e,t||this._defaultFormatOptions)}}class yn{centsToCurrencyString(e){const t=Math.floor(e/100);if(0==e%100){if(t<=999)return`${t}`;const e=Math.floor(t/1e3),i=t%1e3,s=t%100,r=Math.floor(i/100);return s>0?`${t}`:i>0?`${e}.${r}K`:`${e}K`}return"..."}}class xn extends ae{}class An{constructor(){this._snapshotObservable=new Q(te.Empty)}get snapshotObservable(){return this._snapshotObservable}update(e){this._snapshotObservable.next(e)}}class Cn{constructor(e,t){this._numSet=e,this._doubleZeroId=t}getNumberIdFromInstance(e){return e==this._numSet.N00?this._doubleZeroId:e.value}getNumberInstanceFromId(e){return this._doubleZeroId===e?this._numSet.N00:this._numSet.getWithValue(e)}}class Sn{constructor(e,t,i,s){this._log=s,this._skipAnimationObservable=t,this._playGameCmd=e??(()=>{throw new Z("PlayGameCmd is required")})(),this._wheelController=i??(()=>{throw new Z("WheelController is required")})()}async fetchResults(e){this._log.debug("Fetch Results Enter");const t=new AbortController,i=this._skipAnimationObservable.pipe(Ze(1)).subscribe((()=>{t.abort(ei.JumpToEnd)}));return this._wheelController.startSpinning(t.signal).finally((()=>{i.unsubscribe()})),(await Promise.all([this._playGameCmd.execute(e)]))[0]}}class En{constructor(e,t,i,s,r,n,o,a,h,l,c,u,d,_,p,g,f,m,b,v,T,y){this._log=y,this._wheelController=e,this._cameraController=t,this._currentWinMutable=i,this._resultsShownSubject=s,this._gameCompleteSubject=r,this._pipCameraController=n,this._audioEventsHandler=o,this._winningNumberPopup=a,this._skipAnimationObservable=h,this._uiController=l,this._placeBetsAnnouncer=u,this._fieldView=c,this._startGameEvent=d,this._fieldChipsAnimator=_,this._numbersStatsController=p,this._newGameEvent=g,this._uiView=f,this._lastBetsSnapshot=m,this._placedBetsWithErrorHandling=b,this._mainUILayerManipulator=v,this._minGameIntervalTracker=T}async showResults(e){const t=this;this._placedBetsWithErrorHandling.placedBetsCollection.resetHistory(),this._log.debug("Showing results enter"),this._log.debug(`> Winning number: ${e.Hit.name} | ${e.Hit.color}`),await this._cameraController.focusOnWheel();const i=new ii,s=this._skipAnimationObservable.pipe(Ze(1)).subscribe((()=>{i.skip()})),r=this._minGameIntervalTracker.minIntervalReachedObservable.pipe(Je((e=>e))).subscribe((()=>{this._uiController.setWheelSpinSkipEnabled(!0)}));await this._wheelController.stopAtNumber(e.Hit,i.signal),r.unsubscribe();const n=new AbortController;this.playWinAnouncement(e,n.signal),this._numbersStatsController.addWinningNumber(e.Hit),this._uiController.setWheelSpinSkipEnabled(!1),s.unsubscribe(),0==e.TotalWinCents&&this._audioEventsHandler.play(or.Lose),this._currentWinMutable.centsValue=e.TotalWinCents;const o=new qt,a=e.Hit;o.add(this._fieldView.highlightNumbers([a],pt.WinningSpot)),e.BetsSnapshot.placedBets.forEach((e=>{const t=e.spot;t.contains(a)&&t.type!==z.StraightUp&&o.add(this._fieldView.highlightBetSpots([t],pt.WinningSpot,!1))})),e.TotalWinCents>0&&this._audioEventsHandler.play(or.WinBanner);const h=new AbortController,l=h.signal,c=si.Delay(1e3,l).then((()=>t._fieldChipsAnimator.removeLosingBets(e,l))).then((()=>si.Delay(750,l))).then((()=>t._fieldChipsAnimator.animateWinningBets(e,l))),u=ce(this._newGameEvent);await this._winningNumberPopup.setData({winningNumber:e.Hit,winAmountInCents:e.TotalWinCents}).show(),this._resultsShownSubject.next();const d=this._winningNumberPopup.shroudClicked.subscribe((()=>{d.unsubscribe(),h.abort(ei.JumpToEnd)}));await c,d.unsubscribe();const _=this._winningNumberPopup.shroudClicked.subscribe((()=>{_.unsubscribe(),this._newGameEvent.next("NewGame")})),p=[Ss.ButtonNewGame,Ss.ButtonReBet];p.forEach((e=>{this._uiView.setControlEnabled(e,!0),this._uiView.setControlVisible(e,!0)})),this._wheelController.idle(),this._uiController.setRebetAndSpinEnabled(!0);const g=this._mainUILayerManipulator.bringToZIndex([Ss.ButtonInfo],gn.GameUI_OverDialogs+1);this._uiView.setControlEnabled(Ss.ButtonInfo,!0),this._lastBetsSnapshot.update(e.BetsSnapshot);const f=await u;g.dispose(),this._currentWinMutable.centsValue=0,_.unsubscribe(),p.forEach((e=>{this._uiView.setControlEnabled(e,!1),this._uiView.setControlVisible(e,!1)})),this._uiController.setRebetAndSpinEnabled(!1),o.dispose(),this._pipCameraController.hide(),await Promise.all([this._cameraController.focusOnField(),this._winningNumberPopup.hide()]);let m=null;switch(f){case"NewGame":this._placedBetsWithErrorHandling.placedBetsCollection.reset(!0),m=Rn.BetsPlacement;break;case"Rebet":m=Rn.BetsPlacement;break;case"RebetAndSpin":try{n.abort(ei.JumpToEnd)}catch(e){}m=Rn.Spin(e.BetsSnapshot)}return this._lastBetsSnapshot.update(te.Empty),this._gameCompleteSubject.next(),this._log.debug("Showing results exit"),m??Rn.BetsPlacement}async playWinAnouncement(e,t){const i=this,s=new AbortController,r=this._startGameEvent.subscribe((()=>{s.abort(new ee("New Game Started"))})),n=AbortSignal.any([t,s.signal]);try{await this._audioEventsHandler.play(ar.withNumber(e.Hit),n);const t=e.TotalWinCents/e.BetsSnapshot.totalBetCents;if(0===t)return;n.throwIfAborted(),this._audioEventsHandler.play(or.Win,n),t<4?await this._audioEventsHandler.play(or.WinLow,n):t>17?await this._audioEventsHandler.play(or.WinHigh,n):await this._audioEventsHandler.play(or.WinMid,n)}catch(e){si.isAbortError(e)||i._log.error(`playWinAnouncement error: ${e}`)}finally{r.unsubscribe()}}}class Rn{static Spin(e){return new Rn("Spin",e)}constructor(e,t){this.type=e,this.betsSnapshot=t??te.Empty}}Rn.BetsPlacement=new Rn("BetsPlacement");class Pn{constructor(e,t,i,s){this._stateInitialization=e,this._stateBetsPlacement=t,this._stateFetchResults=i,this._stateShowingResults=s}async start(){this.playStateInitialization()}async playStateInitialization(){await this._stateInitialization.initialize(),this.playStateBetsPlacement(!1)}async playStateBetsPlacement(e){const t=await this._stateBetsPlacement.waitForBetsPlacement(e);this._stateInitialization.begin(),this.playStateFetchResults(t)}async playStateFetchResults(e){const t=await this._stateFetchResults.fetchResults(e);this.playStateShowingResults(t)}async playStateShowingResults(e){switch(this._stateInitialization.end(),(await this._stateShowingResults.showResults(e)).type){case"BetsPlacement":this.playStateBetsPlacement(!1);break;case"Spin":this.playStateBetsPlacement(!0)}}}class In{constructor(e,t,i,s){this.Hit=e,this.TotalWinCents=t,this.BetsSnapshot=i,this.WinPerSpot=s}}In.None=new In(new bi("none",-1,At.None),0,te.Empty,null);class Mn{constructor(e,t,i,s){this._numbers=e.getAllNumbersForGameType(t),this._playerBalance=i,this._winCalculator=s}async execute(e){const t=e.placedBets.reduce(((e,t)=>e+t.cents),0);this._playerBalance.centsValue-=t;const i=Math.floor(Math.random()*this._numbers.length),s=this._numbers[i];let r=0;const n=new Map;return e.placedBets.forEach((e=>{if(e.spot.contains(s)){const t=this._winCalculator.getWinForBet(e);r+=t,n.set(e.spot,t)}})),new In(s,r,e,n)}}class wn{constructor(e,t,i,s){this._clientEmitter=e,this._numberIdAdaptor=t,this._numSet=i,this._winCalculator=s}async execute(e){const t=e.placedBets.map((e=>this.placedBetToBetData(e))),i=new Q(void 0);this._clientEmitter.once("FrameGameEnd",(e=>{i.next(e)})),this._clientEmitter.emit("GameBet",t);const s=await ce(i.pipe(Ye((e=>void 0!==e))));return this.rgsGameEndDataToGameResults(e,s)}rgsGameEndDataToGameResults(e,t){const i=this._numberIdAdaptor.getNumberInstanceFromId(t.result),s=new Map;return e.placedBets.forEach((e=>{const t=e.spot;t.contains(i)&&s.set(t,this._winCalculator.getWinForBet(e))})),new In(i,t.totalWinAmount,e,s)}placedBetToBetData(e){if(e.spot.type==z.Corner&&e.spot.contains(this._numSet.N0))return{amount:e.cents,betOn:"BASKET",numbers:[0,1,2,3]};const t=[z.StraightUp,z.Split,z.Street,z.Corner,z.Basket,z.SixLine,z.Column,z.Dozen].includes(e.spot.type)?e.spot.numbers.map((e=>this._numberIdAdaptor.getNumberIdFromInstance(e))):void 0;let i=this.getOptionValueForBetType(e.spot.type);return{amount:e.cents,betOn:this.betTypeToRGSFormat(e.spot.type),numbers:t,option:i}}getOptionValueForBetType(e){switch(e){case z.Black:return"black";case z.Red:return"red";case z.Low:return"low";case z.High:return"high";case z.Odd:return"odd";case z.Even:return"even";default:return}}betTypeToRGSFormat(e){switch(e){case z.StraightUp:return"STRAIGHT";case z.Split:return"SPLIT";case z.Street:return"STREET";case z.Corner:return"CORNER";case z.Basket:return"BASKET";case z.SixLine:return"LINE";case z.Dozen:return"DOZEN";case z.Column:return"COLUMN";case z.Black:case z.Red:return"REDBLACK";case z.Odd:case z.Even:return"ODDEVEN";case z.Low:case z.High:return"LOWHIGH";default:throw new Error(`Unsupported bet type ${e}`)}}}class On{constructor(e){this.player=e,this.active=!0,this.lastPlayed=null,this.playing=!1}get isActive(){return this.active}setStateChangeHandler(e){this.onStateChange=e}setActive(e){this.player.muted=!e,this.active&&!e?this.stopCurrent():!this.active&&e&&this.playCurrent(this.lastPlayed,!0),this.active=e,this.onStateChange&&this.onStateChange()}enter(e){this.playCurrent(e||Zr.Jazz,!0)}play(e){this.active&&(this.playing&&this.lastPlayed===e||(this.stopCurrent(),this.playCurrent(e)))}playBlues(){this.playCurrent(Zr.Blues)}playJazz(){this.playCurrent(Zr.Jazz)}playClassical(){this.playCurrent(Zr.Classic)}playLounge(){this.playCurrent(Zr.Lounge)}playChill(){this.playCurrent(Zr.Chill)}playCasino(){this.playCurrent(Zr.CasinoAmbience)}playNeon(){this.playCurrent(Zr.Neon)}playHeavy(){this.playCurrent(Zr.Heavy)}playGroovy(){this.playCurrent(Zr.Groovy)}stopCurrent(){this.playing&&(this.lastPlayed&&this.player.stopCurrentTrack(),this.playing=!1)}playCurrent(e,t){e&&(this.lastPlayed!==e||t)&&(this.player.playTrack(e),this.lastPlayed=e,this.playing=!0)}}class Bn{constructor(e){this.player=e,this.active=!0}get isActive(){return this.active}setStateChangeHandler(e){this.onStateChange=e}setActive(e){this.active=e,this.onStateChange&&this.onStateChange()}playSFX(e){this.active&&this.player.play({name:e.name})}}class Dn{constructor(e){this.player=e,this.active=!0}get isActive(){return this.active}setStateChangeHandler(e){this.onStateChange=e}setActive(e){this.active=e,this.onStateChange&&this.onStateChange()}click(){this.playUI(Fe.SFX_UI_Click)}playUI(e){this.active&&this.player.play({name:e.name})}}class Fn{constructor(e){this.player=e,this.active=!0,this.voiceType="male",this.lastPlayed=[]}get isActive(){return this.active}setStateChangeHandler(e){this.onStateChange=e}setActive(e){this.active=e,this.onStateChange&&this.onStateChange()}setType(e){this.voiceType=e}welcome(){this.playVoice("welcome")}playVoice(e){this.active&&this.player.play({name:`${e}-${this.voiceType}`})}}class Ln{static getAudioClip(e){return Ln._player.getAudioClip(e)}static getAllAudioClips(){return Ln._player.getAllAudioClips()}static setStateChangeHandler(e){Ln._player.setStateChangeHandler(e),Ln._music.setStateChangeHandler(e),Ln._sfx.setStateChangeHandler(e),Ln._voice.setStateChangeHandler(e),Ln._ui.setStateChangeHandler(e)}static setClipStateChangeHandler(e){Ln._player.setClipStateChangeHandler(e)}static updateClip(e){Ln._player.updateClip(e)}static addToClip(e){Ln._player.addToClip(e)}static removeFromClip(e){Ln._player.removeFromClip(e)}static setVolumeLevels(e){Ln._player.setVolumeLevels(e)}static init(e,t){Ln._player=e,Ln._music=new On(t),Ln._sfx=new Bn(e),Ln._voice=new Fn(e),Ln._ui=new Dn(e),e.init()}static play(e){switch(Ln._player.getAudioClip(e).res.type){case"music":{const t=Fe.tryGetWithName(e)??(()=>{throw new Z(`No music track id found for name '${e}'`)})();Ln._music.play(t);break}default:Ln._player.play({name:e})}}static get isMute(){return Ln._player.isMute}static get volume(){return Ln._player.volume}static set volume(e){Ln._player.volume=e}static get volumeLevel(){return Ln._player.volumeLevel}static set volumeLevel(e){Ln._player.volumeLevel=e}static get volumeLevels(){return Ln._player.volumeLevels}static get music(){return Ln._music}static get sfx(){return Ln._sfx}static get voice(){return Ln._voice}static get ui(){return Ln._ui}static mute(e){Ln._player.mute(e)}}class Nn{constructor(e,t,i,s,r,n,o,a,h,l,c,u,d,_,p){this._chipsStacksController=e,this._cameraController=t,this._pipCameraController=i,this._splashScreen=s,this._demo=r,this._log=n,this._musicPlayer=o,this._uiController=a,this._settingsController=h,this._audioEventHandler=l,this._placeBetsAnnouncer=c,this._audioPlayer=u,this._voPlayer=_,this._sfxPlayer=d,this._showIntroIfNeeded=p}async showDemoSplash(){this._splashScreen.showDemo(AbortSignal.abort(ei.JumpToEnd))}begin(){this._demo.gameBegin()}end(){this._demo.gameEnd()}async initialize(){this._log.debug("Initializing Enter"),this._splashScreen.setIntro(this._showIntroIfNeeded),this._splashScreen.show(AbortSignal.abort(ei.JumpToEnd)),this._chipsStacksController.start(),this._pipCameraController.hide(),this._uiController.setWheelSpinSkipEnabled(!1),this._uiController.setRebetAndSpinEnabled(!1),await this._cameraController.focusOnField(),await ce(this._splashScreen.closed);const e=this._audioEventHandler.play(or.Welcome);this._placeBetsAnnouncer.announceAfter(e),this._settingsController.musicType.subscribe((e=>{this._musicPlayer.play(Zr.fromMusicType(e))})),this._settingsController.muteAll.subscribe((e=>{Ln.mute(e)})),this._settingsController.musicEnabled.subscribe((e=>{this._musicPlayer.setActive(e),e&&this._musicPlayer.play(Zr.fromMusicType(this._settingsController.musicType.value))})),this._settingsController.voiceEnabled.subscribe((e=>{this._voPlayer.setEnabled(e)})),this._settingsController.sfxEnabled.subscribe((e=>{this._sfxPlayer.setEnabled(e)})),this._log.debug("Initializing Exit")}}class kn{constructor(e,t,i,s,r,n,o,a,h,l){this._placedBets=e,this._fieldController=t,this._startGameEvent=i,this._wheelController=s,this._currentWinMutable=r,this._uiController=n,this._audioEventHandler=o,this._autoplayController=a,this._minGameIntervalTracker=h,this._log=l}clearBets(){this._placedBets.reset(!0)}async waitForBetsPlacement(e){const t=new qt;this._uiController.unlockBettingUI(Mr.GameInProgress),this._log.debug("Bets placement enter"),this._fieldController.enableBets();const i=e?Promise.resolve():ce(this._startGameEvent),s=this._autoplayController.enabledObservable.subscribe((e=>{e&&this._autoplayController.trySpin()}));return t.add({dispose:()=>{s.unsubscribe()}}),ce(this._placedBets.updateObservable).then((()=>{this._currentWinMutable.centsObservable.next(0)})),this._wheelController.idle(),await i,this._minGameIntervalTracker.trackGameStarted(),this._audioEventHandler.play(or.NoMoreBets),this._uiController.lockBettingUI(Mr.GameInProgress),this._log.debug("Bets placement exit"),this._fieldController.disableBets(),t.dispose(),this._placedBets.getSnapshot()}}class Un{constructor(e,t,i,s){this._stacksScale={x:1,y:1,z:1},this._started=!1,this._compositeUnsub=new Ki,this._chipsPool=e,this._placedBetsCollection=t,this._chipsDistributor=i,this._audioPlayer=s,this._additionalMultiplierPerBetType=new Map([[z.StraightUp,1.3],[z.Black,1.3],[z.Red,1.3],[z.Column,1.3],[z.Dozen,1.3],[z.High,1.3],[z.Low,1.3],[z.Even,1.3],[z.Odd,1.3]])}onResize(e){e.previousOrientation!=e.orientation&&(e.orientation===ue.landscape?this.setStacksScale({x:1,y:1,z:1}):this.setStacksScale({x:1,y:1,z:1.3}))}start(){this._started||(this._started=!0,this._compositeUnsub.add(this._placedBetsCollection.updateObservable.subscribe(this.onPlacedBetsChanged.bind(this))))}onPlacedBetsChanged(e){e.updatedSpots.forEach((e=>{this.updatePlacedBet(e)}))}updatePlacedBet(e){const t=this._chipsPool.getChipStackForSpot(e.spot);if(this.setOneStackScale(t,e.spot,this._stacksScale),0===e.cents)t.clear();else{const i=this._chipsDistributor.distributeCentsAsChips(e.cents);t.setChips(i);let s=0;i.forEach(((e,t)=>{s+=e})),1==s?this._audioPlayer.play(or.PlaceSingleChip):this._audioPlayer.play(or.PlaceChipsStack)}}dispose(){this._compositeUnsub.unsubscribe()}setStacksScale(e){this._stacksScale=e,this._chipsPool.AllStacks.forEach(((t,i)=>{this.setOneStackScale(t,i,e)}))}setOneStackScale(e,t,i){const s=this._additionalMultiplierPerBetType.get(t.type)||1,r={x:i.x*s,y:i.y*s,z:i.z*s};e.setScale(r)}}class Vn{constructor(e){this._chipsStackPerBetSpot=new Map,this._chipStackFactory=e}getChipStackForSpot(e){let t=this._chipsStackPerBetSpot.get(e);return t||(t=this._chipStackFactory.createForSpot(e),this._chipsStackPerBetSpot.set(e,t)),t}get AllStacks(){return this._chipsStackPerBetSpot}}var Gn=o(2282),zn=o(9176),Hn=o(2605),Wn=o(8795);function Xn(e){let t=e.pathArray;const i=e.closeArray||!1,s=e.closePath||!1,r=e.invertUV||!1,n=Math.floor(t[0].length/2);let o=e.offset||n;o=o>n?n:Math.floor(o);const a=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE,h=e.uvs,l=e.colors,c=[],u=[],d=[],_=[],p=[],g=[],f=[],m=[];let b;const v=[],T=[];let y,x,A;if(t.length<2){const e=[],i=[];for(x=0;x<t[0].length-o;x++)e.push(t[0][x]),i.push(t[0][x+o]);t=[e,i]}let C=0;const S=s?1:0,E=i?1:0;let R,P,I,M,w,O;for(b=t[0].length,y=0;y<t.length+E;y++){for(f[y]=0,p[y]=[0],R=y===t.length?t[0]:t[y],P=R.length,b=b<P?b:P,A=0;A<P;)c.push(R[A].x,R[A].y,R[A].z),A>0&&(I=R[A].subtract(R[A-1]).length(),M=I+f[y],p[y].push(M),f[y]=M),A++;s&&(A--,c.push(R[0].x,R[0].y,R[0].z),I=R[A].subtract(R[0]).length(),M=I+f[y],p[y].push(M),f[y]=M),v[y]=P+S,T[y]=C,C+=P+S}let B,D,F=null,L=null;for(x=0;x<b+S;x++)for(m[x]=0,g[x]=[0],y=0;y<t.length-1+E;y++)w=t[y],O=y===t.length-1?t[0]:t[y+1],x===b?(F=w[0],L=O[0]):(F=w[x],L=O[x]),I=L.subtract(F).length(),M=I+m[x],g[x].push(M),m[x]=M;if(h)for(y=0;y<h.length;y++)_.push(h[y].x,Wn.rX?1-h[y].y:h[y].y);else for(y=0;y<t.length+E;y++)for(x=0;x<b+S;x++)B=0!=f[y]?p[y][x]/f[y]:0,D=0!=m[x]?g[x][y]/m[x]:0,r?_.push(D,B):_.push(B,Wn.rX?1-D:D);y=0;let N=0,k=v[y]-1,U=v[y+1]-1,V=k<U?k:U,G=T[1]-T[0];const z=v.length-1;for(;N<=V&&y<z;)u.push(N,N+G,N+1),u.push(N+G+1,N+1,N+G),N+=1,N===V&&(y++,G=T[y+1]-T[y],k=v[y]-1,U=v[y+1]-1,N=T[y],V=k<U?k+N:U+N);if(Hn.P.ComputeNormals(c,u,d),s){let e=0,i=0;for(y=0;y<t.length;y++){e=3*T[y],i=y+1<t.length?3*(T[y+1]-1):d.length-3,d[e]=.5*(d[e]+d[i]),d[e+1]=.5*(d[e+1]+d[i+1]),d[e+2]=.5*(d[e+2]+d[i+2]);const s=Math.sqrt(d[e]*d[e]+d[e+1]*d[e+1]+d[e+2]*d[e+2]);d[e]/=s,d[e+1]/=s,d[e+2]/=s,d[i]=d[e],d[i+1]=d[e+1],d[i+2]=d[e+2]}}if(i){let e=3*T[0],i=3*T[t.length];for(x=0;x<b+S;x++){d[e]=.5*(d[e]+d[i]),d[e+1]=.5*(d[e+1]+d[i+1]),d[e+2]=.5*(d[e+2]+d[i+2]);const t=Math.sqrt(d[e]*d[e]+d[e+1]*d[e+1]+d[e+2]*d[e+2]);d[e]/=t,d[e+1]/=t,d[e+2]/=t,d[i]=d[e],d[i+1]=d[e+1],d[i+2]=d[e+2],e+=3,i+=3}}Hn.P._ComputeSides(a,c,u,d,_,e.frontUVs,e.backUVs);let H=null;if(l){H=new Float32Array(4*l.length);for(let e=0;e<l.length;e++)H[4*e]=l[e].r,H[4*e+1]=l[e].g,H[4*e+2]=l[e].b,H[4*e+3]=l[e].a}const W=new Hn.P,X=new Float32Array(c),q=new Float32Array(d),Q=new Float32Array(_);return W.indices=u,W.positions=X,W.normals=q,W.uvs=Q,H&&W.set(H,Mt.R.ColorKind),s&&(W._idx=T),W}function qn(e,t,i=null){const s=t.pathArray,r=t.closeArray,n=t.closePath,o=zn.e._GetDefaultSideOrientation(t.sideOrientation),a=t.instance,h=t.updatable;if(a){const e=gt.AA.Vector3[0].setAll(Number.MAX_VALUE),i=gt.AA.Vector3[1].setAll(-Number.MAX_VALUE),r=t=>{let r=s[0].length;const n=a;let o=0;const h=n._originalBuilderSideOrientation===zn.e.DOUBLESIDE?2:1;for(let a=1;a<=h;++a)for(let a=0;a<s.length;++a){const h=s[a],l=h.length;r=r<l?r:l;for(let s=0;s<r;++s){const r=h[s];t[o]=r.x,t[o+1]=r.y,t[o+2]=r.z,e.minimizeInPlaceFromFloats(r.x,r.y,r.z),i.maximizeInPlaceFromFloats(r.x,r.y,r.z),o+=3}if(n._creationDataStorage&&n._creationDataStorage.closePath){const e=h[0];t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z,o+=3}}},n=a.getVerticesData(Mt.R.PositionKind);if(r(n),a.hasBoundingInfo?a.getBoundingInfo().reConstruct(e,i,a._worldMatrix):a.buildBoundingInfo(e,i,a._worldMatrix),a.updateVerticesData(Mt.R.PositionKind,n,!1,!1),t.colors){const e=a.getVerticesData(Mt.R.ColorKind);for(let i=0,s=0;i<t.colors.length;i++,s+=4){const r=t.colors[i];e[s]=r.r,e[s+1]=r.g,e[s+2]=r.b,e[s+3]=r.a}a.updateVerticesData(Mt.R.ColorKind,e,!1,!1)}if(t.uvs){const e=a.getVerticesData(Mt.R.UVKind);for(let i=0;i<t.uvs.length;i++)e[2*i]=t.uvs[i].x,e[2*i+1]=Wn.rX?1-t.uvs[i].y:t.uvs[i].y;a.updateVerticesData(Mt.R.UVKind,e,!1,!1)}if(!a.areNormalsFrozen||a.isFacetDataEnabled){const e=a.getIndices(),t=a.getVerticesData(Mt.R.NormalKind),i=a.isFacetDataEnabled?a.getFacetDataParameters():null;if(Hn.P.ComputeNormals(n,e,t,i),a._creationDataStorage&&a._creationDataStorage.closePath){let e=0,i=0;for(let r=0;r<s.length;r++)e=3*a._creationDataStorage.idx[r],i=r+1<s.length?3*(a._creationDataStorage.idx[r+1]-1):t.length-3,t[e]=.5*(t[e]+t[i]),t[e+1]=.5*(t[e+1]+t[i+1]),t[e+2]=.5*(t[e+2]+t[i+2]),t[i]=t[e],t[i+1]=t[e+1],t[i+2]=t[e+2]}a.areNormalsFrozen||a.updateVerticesData(Mt.R.NormalKind,t,!1,!1)}return a}{const s=new zn.e(e,i);s._originalBuilderSideOrientation=o,s._creationDataStorage=new zn.Ez;const a=Xn(t);return n&&(s._creationDataStorage.idx=a._idx),s._creationDataStorage.closePath=n,s._creationDataStorage.closeArray=r,a.applyToMesh(s,h),s}}function Qn(e){const t=[],i=[],s=[],r=[],n=e.radius||.5,o=e.tessellation||64,a=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,h=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE;t.push(0,0,0),r.push(.5,.5);const l=2*Math.PI*a,c=1===a?l/o:l/(o-1);let u=0;for(let e=0;e<o;e++){const e=Math.cos(u),i=Math.sin(u),s=(e+1)/2,o=(1-i)/2;t.push(n*e,n*i,0),r.push(s,Wn.rX?1-o:o),u+=c}1===a&&(t.push(t[3],t[4],t[5]),r.push(r[2],Wn.rX?1-r[3]:r[3]));const d=t.length/3;for(let e=1;e<d-1;e++)i.push(e+1,0,e);Hn.P.ComputeNormals(t,i,s),Hn.P._ComputeSides(h,t,i,s,r,e.frontUVs,e.backUVs);const _=new Hn.P;return _.indices=i,_.positions=t,_.normals=s,_.uvs=r,_}function Kn(e,t={},i=null){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,Qn(t).applyToMesh(s,t.updatable),s}Hn.P.CreateRibbon=Xn,zn.e.CreateRibbon=(e,t,i=!1,s,r,n,o=!1,a,h)=>qn(e,{pathArray:t,closeArray:i,closePath:s,offset:r,updatable:o,sideOrientation:a,instance:h},n),Hn.P.CreateDisc=Qn,zn.e.CreateDisc=(e,t,i,s=null,r,n)=>Kn(e,{radius:t,tessellation:i,sideOrientation:n,updatable:r},s),zn.e._GroundMeshParser=(e,t)=>Yn.Parse(e,t);class Yn extends zn.e{constructor(e,t){super(e,t),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(e,t=32){this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)}getHeightAtCoordinates(e,t){const i=this.getWorldMatrix(),s=gt.AA.Matrix[5];i.invertToRef(s);const r=gt.AA.Vector3[8];if(gt.Pq.TransformCoordinatesFromFloatsToRef(e,0,t,s,r),e=r.x,t=r.z,e<this._minX||e>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const n=this._getFacetAt(e,t),o=-(n.x*e+n.z*t+n.w)/n.y;return gt.Pq.TransformCoordinatesFromFloatsToRef(0,o,0,i,r),r.y}getNormalAtCoordinates(e,t){const i=new gt.Pq(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i}getNormalAtCoordinatesToRef(e,t,i){const s=this.getWorldMatrix(),r=gt.AA.Matrix[5];s.invertToRef(r);const n=gt.AA.Vector3[8];if(gt.Pq.TransformCoordinatesFromFloatsToRef(e,0,t,r,n),e=n.x,t=n.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const o=this._getFacetAt(e,t);return gt.Pq.TransformNormalFromFloatsToRef(o.x,o.y,o.z,s,i),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(e,t){const i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),s=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),r=this._heightQuads[s*this._subdivisionsX+i];let n;return n=t<r.slope.x*e+r.slope.y?r.facet1:r.facet2,n}_initHeightQuads(){const e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const s={slope:gt.I9.Zero(),facet1:new gt.IU(0,0,0,0),facet2:new gt.IU(0,0,0,0)};this._heightQuads[i*e+t]=s}return this}_computeHeightQuads(){const e=this.getVerticesData(Mt.R.PositionKind);if(!e)return this;const t=gt.AA.Vector3[3],i=gt.AA.Vector3[2],s=gt.AA.Vector3[1],r=gt.AA.Vector3[0],n=gt.AA.Vector3[4],o=gt.AA.Vector3[5],a=gt.AA.Vector3[6],h=gt.AA.Vector3[7],l=gt.AA.Vector3[8];let c=0,u=0,d=0,_=0,p=0,g=0,f=0;const m=this._subdivisionsX,b=this._subdivisionsY;for(let v=0;v<b;v++)for(let b=0;b<m;b++){c=3*b,u=v*(m+1)*3,d=(v+1)*(m+1)*3,t.x=e[u+c],t.y=e[u+c+1],t.z=e[u+c+2],i.x=e[u+c+3],i.y=e[u+c+4],i.z=e[u+c+5],s.x=e[d+c],s.y=e[d+c+1],s.z=e[d+c+2],r.x=e[d+c+3],r.y=e[d+c+4],r.z=e[d+c+5],_=(r.z-t.z)/(r.x-t.x),p=t.z-_*t.x,i.subtractToRef(t,n),s.subtractToRef(t,o),r.subtractToRef(t,a),gt.Pq.CrossToRef(a,o,h),gt.Pq.CrossToRef(n,a,l),h.normalize(),l.normalize(),g=-(h.x*t.x+h.y*t.y+h.z*t.z),f=-(l.x*i.x+l.y*i.y+l.z*i.z);const T=this._heightQuads[v*m+b];T.slope.copyFromFloats(_,p),T.facet1.copyFromFloats(h.x,h.y,h.z,g),T.facet2.copyFromFloats(l.x,l.y,l.z,f)}return this}serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}static Parse(e,t){const i=new Yn(e.name,t);return i._subdivisionsX=e.subdivisionsX||1,i._subdivisionsY=e.subdivisionsY||1,i._minX=e.minX,i._maxX=e.maxX,i._minZ=e.minZ,i._maxZ=e.maxZ,i._width=e.width,i._height=e.height,i}}function jn(e){const t=[],i=[],s=[],r=[];let n,o;const a=e.width||e.size||1,h=e.height||e.size||1,l=0|(e.subdivisionsX||e.subdivisions||1),c=0|(e.subdivisionsY||e.subdivisions||1);for(n=0;n<=c;n++)for(o=0;o<=l;o++){const e=new gt.Pq(o*a/l-a/2,0,(c-n)*h/c-h/2),t=new gt.Pq(0,1,0);i.push(e.x,e.y,e.z),s.push(t.x,t.y,t.z),r.push(o/l,Wn.rX?n/c:1-n/c)}for(n=0;n<c;n++)for(o=0;o<l;o++)t.push(o+1+(n+1)*(l+1)),t.push(o+1+n*(l+1)),t.push(o+n*(l+1)),t.push(o+(n+1)*(l+1)),t.push(o+1+(n+1)*(l+1)),t.push(o+n*(l+1));const u=new Hn.P;return u.indices=t,u.positions=i,u.normals=s,u.uvs=r,u}function Zn(e){const t=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,i=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,s=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,r=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,n=e.subdivisions||{w:1,h:1},o=e.precision||{w:1,h:1},a=[],h=[],l=[],c=[];let u,d,_,p;n.h=n.h<1?1:n.h,n.w=n.w<1?1:n.w,o.w=o.w<1?1:o.w,o.h=o.h<1?1:o.h;const g=(s-t)/n.w,f=(r-i)/n.h;function m(e,t,i,s){const r=h.length/3,n=o.w+1;for(u=0;u<o.h;u++)for(d=0;d<o.w;d++){const e=[r+d+u*n,r+(d+1)+u*n,r+(d+1)+(u+1)*n,r+d+(u+1)*n];a.push(e[1]),a.push(e[2]),a.push(e[3]),a.push(e[0]),a.push(e[1]),a.push(e[3])}const _=gt.Pq.Zero(),p=new gt.Pq(0,1,0);for(u=0;u<=o.h;u++)for(_.z=u*(s-t)/o.h+t,d=0;d<=o.w;d++)_.x=d*(i-e)/o.w+e,_.y=0,h.push(_.x,_.y,_.z),l.push(p.x,p.y,p.z),c.push(d/o.w,u/o.h)}for(_=0;_<n.h;_++)for(p=0;p<n.w;p++)m(t+p*g,i+_*f,t+(p+1)*g,i+(_+1)*f);const b=new Hn.P;return b.indices=a,b.positions=h,b.normals=l,b.uvs=c,b}function $n(e){const t=[],i=[],s=[],r=[];let n,o;const a=e.colorFilter||new bt.v9(.3,.59,.11),h=e.alphaFilter||0;let l=!1;if(e.minHeight>e.maxHeight){l=!0;const t=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=t}for(n=0;n<=e.subdivisions;n++)for(o=0;o<=e.subdivisions;o++){const t=new gt.Pq(o*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-n)*e.height/e.subdivisions-e.height/2),c=4*(((t.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(t.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth);let u=e.buffer[c]/255,d=e.buffer[c+1]/255,_=e.buffer[c+2]/255;const p=e.buffer[c+3]/255;l&&(u=1-u,d=1-d,_=1-_);const g=u*a.r+d*a.g+_*a.b;t.y=p>=h?e.minHeight+(e.maxHeight-e.minHeight)*g:e.minHeight-bs.bH,e.heightBuffer&&(e.heightBuffer[n*(e.subdivisions+1)+o]=t.y),i.push(t.x,t.y,t.z),s.push(0,0,0),r.push(o/e.subdivisions,1-n/e.subdivisions)}for(n=0;n<e.subdivisions;n++)for(o=0;o<e.subdivisions;o++){const s=o+1+(n+1)*(e.subdivisions+1),r=o+1+n*(e.subdivisions+1),a=o+n*(e.subdivisions+1),h=o+(n+1)*(e.subdivisions+1),l=i[3*s+1]>=e.minHeight,c=i[3*r+1]>=e.minHeight,u=i[3*a+1]>=e.minHeight;l&&c&&u&&(t.push(s),t.push(r),t.push(a)),i[3*h+1]>=e.minHeight&&l&&u&&(t.push(h),t.push(s),t.push(a))}Hn.P.ComputeNormals(i,t,s);const c=new Hn.P;return c.indices=t,c.positions=i,c.normals=s,c.uvs=r,c}function Jn(e,t={},i){const s=new Yn(e,i);return s._setReady(!1),s._subdivisionsX=t.subdivisionsX||t.subdivisions||1,s._subdivisionsY=t.subdivisionsY||t.subdivisions||1,s._width=t.width||1,s._height=t.height||1,s._maxX=s._width/2,s._maxZ=s._height/2,s._minX=-s._maxX,s._minZ=-s._maxZ,jn(t).applyToMesh(s,t.updatable),s._setReady(!0),s}function eo(e,t,i=null){const s=new zn.e(e,i);return Zn(t).applyToMesh(s,t.updatable),s}function to(e,t,i={},s=null){const r=i.width||10,n=i.height||10,o=i.subdivisions||1,a=i.minHeight||0,h=i.maxHeight||1,l=i.colorFilter||new bt.v9(.3,.59,.11),c=i.alphaFilter||0,u=i.updatable,d=i.onReady;s=s||os.q.LastCreatedScene;const _=new Yn(e,s);let p;_._subdivisionsX=o,_._subdivisionsY=o,_._width=r,_._height=n,_._maxX=_._width/2,_._maxZ=_._height/2,_._minX=-_._maxX,_._minZ=-_._maxZ,_._setReady(!1),i.passHeightBufferInCallback&&(p=new Float32Array((o+1)*(o+1)));const g=(e,t,i)=>{$n({width:r,height:n,subdivisions:o,minHeight:a,maxHeight:h,colorFilter:l,buffer:e,bufferWidth:t,bufferHeight:i,alphaFilter:c,heightBuffer:p}).applyToMesh(_,u),d&&d(_,p),_._setReady(!0)};if("string"==typeof t){const e=e=>{const t=e.width,i=e.height;if(s.isDisposed)return;const r=s?.getEngine().resizeImageBitmap(e,t,i);g(r,t,i)};$i.S0.LoadImage(t,e,i.onError?i.onError:()=>{},s.offlineProvider)}else g(t.data,t.width,t.height);return _}function io(e){let t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],s=[];let r=[];const n=e.width||e.size||1,o=e.height||e.size||1,a=e.depth||e.size||1,h=e.wrap||!1;let l=void 0===e.topBaseAt?1:e.topBaseAt,c=void 0===e.bottomBaseAt?0:e.bottomBaseAt;l=(l+4)%4,c=(c+4)%4;let u=[2,0,3,1][l],d=[2,0,1,3][c],_=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(h){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],_=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let e=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],i=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const s=[17,18,19,16],r=[22,23,20,21];for(;u>0;)e.unshift(e.pop()),s.unshift(s.pop()),u--;for(;d>0;)i.unshift(i.pop()),r.unshift(r.pop()),d--;e=e.flat(),i=i.flat(),_=_.concat(e).concat(i),t.push(s[0],s[2],s[3],s[0],s[1],s[2]),t.push(r[0],r[2],r[3],r[0],r[1],r[2])}const p=[n/2,o/2,a/2];r=_.reduce(((e,t,i)=>e.concat(t*p[i%3])),[]);const g=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE,f=e.faceUV||new Array(6),m=e.faceColors,b=[];for(let e=0;e<6;e++)void 0===f[e]&&(f[e]=new gt.IU(0,0,1,1)),m&&void 0===m[e]&&(m[e]=new bt.ov(1,1,1,1));for(let e=0;e<6;e++)if(s.push(f[e].z,Wn.rX?1-f[e].w:f[e].w),s.push(f[e].x,Wn.rX?1-f[e].w:f[e].w),s.push(f[e].x,Wn.rX?1-f[e].y:f[e].y),s.push(f[e].z,Wn.rX?1-f[e].y:f[e].y),m)for(let t=0;t<4;t++)b.push(m[e].r,m[e].g,m[e].b,m[e].a);Hn.P._ComputeSides(g,r,t,i,s,e.frontUVs,e.backUVs);const v=new Hn.P;if(v.indices=t,v.positions=r,v.normals=i,v.uvs=s,m){const e=g===Hn.P.DOUBLESIDE?b.concat(b):b;v.colors=e}return v}function so(e,t={},i=null){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,io(t).applyToMesh(s,t.updatable),s}function ro(e){const t=e.pattern||zn.e.NO_FLIP,i=e.tileWidth||e.tileSize||1,s=e.tileHeight||e.tileSize||1,r=e.alignHorizontal||0,n=e.alignVertical||0,o=e.width||e.size||1,a=Math.floor(o/i);let h=o-a*i;const l=e.height||e.size||1,c=Math.floor(l/s);let u=l-c*s;const d=i*a/2,_=s*c/2;let p=0,g=0,f=0,m=0,b=0,v=0;if(h>0||u>0){switch(f=-d,m=-_,b=d,v=_,r){case zn.e.CENTER:h/=2,f-=h,b+=h;break;case zn.e.LEFT:b+=h,p=-h/2;break;case zn.e.RIGHT:f-=h,p=h/2}switch(n){case zn.e.CENTER:u/=2,m-=u,v+=u;break;case zn.e.BOTTOM:v+=u,g=-u/2;break;case zn.e.TOP:m-=u,g=u/2}}const T=[],y=[],x=[];x[0]=[0,0,1,0,1,1,0,1],x[1]=[0,0,1,0,1,1,0,1],t!==zn.e.ROTATE_TILE&&t!==zn.e.ROTATE_ROW||(x[1]=[1,1,0,1,0,0,1,0]),t!==zn.e.FLIP_TILE&&t!==zn.e.FLIP_ROW||(x[1]=[1,0,0,0,0,1,1,1]),t!==zn.e.FLIP_N_ROTATE_TILE&&t!==zn.e.FLIP_N_ROTATE_ROW||(x[1]=[0,1,1,1,1,0,0,0]);let A=[];const C=[],S=[];let E=0;for(let e=0;e<c;e++)for(let r=0;r<a;r++)T.push(r*i-d+p,e*s-_+g,0),T.push((r+1)*i-d+p,e*s-_+g,0),T.push((r+1)*i-d+p,(e+1)*s-_+g,0),T.push(r*i-d+p,(e+1)*s-_+g,0),S.push(E,E+1,E+3,E+1,E+2,E+3),A=t===zn.e.FLIP_TILE||t===zn.e.ROTATE_TILE||t===zn.e.FLIP_N_ROTATE_TILE?A.concat(x[(r%2+e%2)%2]):t===zn.e.FLIP_ROW||t===zn.e.ROTATE_ROW||t===zn.e.FLIP_N_ROTATE_ROW?A.concat(x[e%2]):A.concat(x[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),E+=4;if(h>0||u>0){const e=u>0&&(n===zn.e.CENTER||n===zn.e.TOP),o=u>0&&(n===zn.e.CENTER||n===zn.e.BOTTOM),l=h>0&&(r===zn.e.CENTER||r===zn.e.RIGHT),x=h>0&&(r===zn.e.CENTER||r===zn.e.LEFT);let R,P,I,M,w=[];if(e&&l&&(T.push(f+p,m+g,0),T.push(-d+p,m+g,0),T.push(-d+p,m+u+g,0),T.push(f+p,m+u+g,0),S.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,R=1-h/i,P=1-u/s,I=1,M=1,w=[R,P,I,P,I,M,R,M],t===zn.e.ROTATE_ROW&&(w=[1-R,1-P,1-I,1-P,1-I,1-M,1-R,1-M]),t===zn.e.FLIP_ROW&&(w=[1-R,P,1-I,P,1-I,M,1-R,M]),t===zn.e.FLIP_N_ROTATE_ROW&&(w=[R,1-P,I,1-P,I,1-M,R,1-M]),A=A.concat(w),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e&&x&&(T.push(d+p,m+g,0),T.push(b+p,m+g,0),T.push(b+p,m+u+g,0),T.push(d+p,m+u+g,0),S.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,R=0,P=1-u/s,I=h/i,M=1,w=[R,P,I,P,I,M,R,M],(t===zn.e.ROTATE_ROW||t===zn.e.ROTATE_TILE&&a%2==0)&&(w=[1-R,1-P,1-I,1-P,1-I,1-M,1-R,1-M]),(t===zn.e.FLIP_ROW||t===zn.e.FLIP_TILE&&a%2==0)&&(w=[1-R,P,1-I,P,1-I,M,1-R,M]),(t===zn.e.FLIP_N_ROTATE_ROW||t===zn.e.FLIP_N_ROTATE_TILE&&a%2==0)&&(w=[R,1-P,I,1-P,I,1-M,R,1-M]),A=A.concat(w),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),o&&l&&(T.push(f+p,_+g,0),T.push(-d+p,_+g,0),T.push(-d+p,v+g,0),T.push(f+p,v+g,0),S.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,R=1-h/i,P=0,I=1,M=u/s,w=[R,P,I,P,I,M,R,M],(t===zn.e.ROTATE_ROW&&c%2==1||t===zn.e.ROTATE_TILE&&c%1==0)&&(w=[1-R,1-P,1-I,1-P,1-I,1-M,1-R,1-M]),(t===zn.e.FLIP_ROW&&c%2==1||t===zn.e.FLIP_TILE&&c%2==0)&&(w=[1-R,P,1-I,P,1-I,M,1-R,M]),(t===zn.e.FLIP_N_ROTATE_ROW&&c%2==1||t===zn.e.FLIP_N_ROTATE_TILE&&c%2==0)&&(w=[R,1-P,I,1-P,I,1-M,R,1-M]),A=A.concat(w),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),o&&x&&(T.push(d+p,_+g,0),T.push(b+p,_+g,0),T.push(b+p,v+g,0),T.push(d+p,v+g,0),S.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,R=0,P=0,I=h/i,M=u/s,w=[R,P,I,P,I,M,R,M],(t===zn.e.ROTATE_ROW&&c%2==1||t===zn.e.ROTATE_TILE&&(c+a)%2==1)&&(w=[1-R,1-P,1-I,1-P,1-I,1-M,1-R,1-M]),(t===zn.e.FLIP_ROW&&c%2==1||t===zn.e.FLIP_TILE&&(c+a)%2==1)&&(w=[1-R,P,1-I,P,1-I,M,1-R,M]),(t===zn.e.FLIP_N_ROTATE_ROW&&c%2==1||t===zn.e.FLIP_N_ROTATE_TILE&&(c+a)%2==1)&&(w=[R,1-P,I,1-P,I,1-M,R,1-M]),A=A.concat(w),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e){const e=[];R=0,P=1-u/s,I=1,M=1,e[0]=[R,P,I,P,I,M,R,M],e[1]=[R,P,I,P,I,M,R,M],t!==zn.e.ROTATE_TILE&&t!==zn.e.ROTATE_ROW||(e[1]=[1-R,1-P,1-I,1-P,1-I,1-M,1-R,1-M]),t!==zn.e.FLIP_TILE&&t!==zn.e.FLIP_ROW||(e[1]=[1-R,P,1-I,P,1-I,M,1-R,M]),t!==zn.e.FLIP_N_ROTATE_TILE&&t!==zn.e.FLIP_N_ROTATE_ROW||(e[1]=[R,1-P,I,1-P,I,1-M,R,1-M]);for(let s=0;s<a;s++)T.push(s*i-d+p,m+g,0),T.push((s+1)*i-d+p,m+g,0),T.push((s+1)*i-d+p,m+u+g,0),T.push(s*i-d+p,m+u+g,0),S.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,A=t===zn.e.FLIP_TILE||t===zn.e.ROTATE_TILE||t===zn.e.FLIP_N_ROTATE_TILE?A.concat(e[(s+1)%2]):t===zn.e.FLIP_ROW||t===zn.e.ROTATE_ROW||t===zn.e.FLIP_N_ROTATE_ROW?A.concat(e[1]):A.concat(e[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(o){const e=[];R=0,P=0,I=1,M=u/s,e[0]=[R,P,I,P,I,M,R,M],e[1]=[R,P,I,P,I,M,R,M],t!==zn.e.ROTATE_TILE&&t!==zn.e.ROTATE_ROW||(e[1]=[1-R,1-P,1-I,1-P,1-I,1-M,1-R,1-M]),t!==zn.e.FLIP_TILE&&t!==zn.e.FLIP_ROW||(e[1]=[1-R,P,1-I,P,1-I,M,1-R,M]),t!==zn.e.FLIP_N_ROTATE_TILE&&t!==zn.e.FLIP_N_ROTATE_ROW||(e[1]=[R,1-P,I,1-P,I,1-M,R,1-M]);for(let s=0;s<a;s++)T.push(s*i-d+p,v-u+g,0),T.push((s+1)*i-d+p,v-u+g,0),T.push((s+1)*i-d+p,v+g,0),T.push(s*i-d+p,v+g,0),S.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,A=t===zn.e.FLIP_TILE||t===zn.e.ROTATE_TILE||t===zn.e.FLIP_N_ROTATE_TILE?A.concat(e[(s+c)%2]):t===zn.e.FLIP_ROW||t===zn.e.ROTATE_ROW||t===zn.e.FLIP_N_ROTATE_ROW?A.concat(e[c%2]):A.concat(e[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const e=[];R=1-h/i,P=0,I=1,M=1,e[0]=[R,P,I,P,I,M,R,M],e[1]=[R,P,I,P,I,M,R,M],t!==zn.e.ROTATE_TILE&&t!==zn.e.ROTATE_ROW||(e[1]=[1-R,1-P,1-I,1-P,1-I,1-M,1-R,1-M]),t!==zn.e.FLIP_TILE&&t!==zn.e.FLIP_ROW||(e[1]=[1-R,P,1-I,P,1-I,M,1-R,M]),t!==zn.e.FLIP_N_ROTATE_TILE&&t!==zn.e.FLIP_N_ROTATE_ROW||(e[1]=[R,1-P,I,1-P,I,1-M,R,1-M]);for(let i=0;i<c;i++)T.push(f+p,i*s-_+g,0),T.push(f+h+p,i*s-_+g,0),T.push(f+h+p,(i+1)*s-_+g,0),T.push(f+p,(i+1)*s-_+g,0),S.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,A=t===zn.e.FLIP_TILE||t===zn.e.ROTATE_TILE||t===zn.e.FLIP_N_ROTATE_TILE?A.concat(e[(i+1)%2]):t===zn.e.FLIP_ROW||t===zn.e.ROTATE_ROW||t===zn.e.FLIP_N_ROTATE_ROW?A.concat(e[i%2]):A.concat(e[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const e=[];R=0,P=0,I=h/s,M=1,e[0]=[R,P,I,P,I,M,R,M],e[1]=[R,P,I,P,I,M,R,M],t!==zn.e.ROTATE_TILE&&t!==zn.e.ROTATE_ROW||(e[1]=[1-R,1-P,1-I,1-P,1-I,1-M,1-R,1-M]),t!==zn.e.FLIP_TILE&&t!==zn.e.FLIP_ROW||(e[1]=[1-R,P,1-I,P,1-I,M,1-R,M]),t!==zn.e.FLIP_N_ROTATE_TILE&&t!==zn.e.FLIP_N_ROTATE_ROW||(e[1]=[R,1-P,I,1-P,I,1-M,R,1-M]);for(let i=0;i<c;i++)T.push(b-h+p,i*s-_+g,0),T.push(b+p,i*s-_+g,0),T.push(b+p,(i+1)*s-_+g,0),T.push(b-h+p,(i+1)*s-_+g,0),S.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,A=t===zn.e.FLIP_TILE||t===zn.e.ROTATE_TILE||t===zn.e.FLIP_N_ROTATE_TILE?A.concat(e[(i+a)%2]):t===zn.e.FLIP_ROW||t===zn.e.ROTATE_ROW||t===zn.e.FLIP_N_ROTATE_ROW?A.concat(e[i%2]):A.concat(e[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const R=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE;Hn.P._ComputeSides(R,T,S,y,A,e.frontUVs,e.backUVs);const P=new Hn.P;P.indices=S,P.positions=T,P.normals=y,P.uvs=A;const I=R===Hn.P.DOUBLESIDE?C.concat(C):C;return P.colors=I,P}function no(e){const t=e.faceUV||new Array(6),i=e.faceColors,s=e.pattern||zn.e.NO_FLIP,r=e.width||e.size||1,n=e.height||e.size||1,o=e.depth||e.size||1,a=e.tileWidth||e.tileSize||1,h=e.tileHeight||e.tileSize||1,l=e.alignHorizontal||0,c=e.alignVertical||0,u=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE;for(let e=0;e<6;e++)void 0===t[e]&&(t[e]=new gt.IU(0,0,1,1)),i&&void 0===i[e]&&(i[e]=new bt.ov(1,1,1,1));const d=r/2,_=n/2,p=o/2,g=[];for(let e=0;e<2;e++)g[e]=ro({pattern:s,tileWidth:a,tileHeight:h,width:r,height:n,alignVertical:c,alignHorizontal:l,sideOrientation:u});for(let e=2;e<4;e++)g[e]=ro({pattern:s,tileWidth:a,tileHeight:h,width:o,height:n,alignVertical:c,alignHorizontal:l,sideOrientation:u});let f=c;c===zn.e.BOTTOM?f=zn.e.TOP:c===zn.e.TOP&&(f=zn.e.BOTTOM);for(let e=4;e<6;e++)g[e]=ro({pattern:s,tileWidth:a,tileHeight:h,width:r,height:o,alignVertical:f,alignHorizontal:l,sideOrientation:u});let m=[],b=[],v=[],T=[];const y=[],x=[],A=[],C=[];let S=0,E=0;for(let e=0;e<6;e++){const s=g[e].positions.length;x[e]=[],A[e]=[];for(let t=0;t<s/3;t++)x[e].push(new gt.Pq(g[e].positions[3*t],g[e].positions[3*t+1],g[e].positions[3*t+2])),A[e].push(new gt.Pq(g[e].normals[3*t],g[e].normals[3*t+1],g[e].normals[3*t+2]));S=g[e].uvs.length,C[e]=[];for(let i=0;i<S;i+=2)C[e][i]=t[e].x+(t[e].z-t[e].x)*g[e].uvs[i],C[e][i+1]=t[e].y+(t[e].w-t[e].y)*g[e].uvs[i+1],Wn.rX&&(C[e][i+1]=1-C[e][i+1]);if(v=v.concat(C[e]),T=T.concat(g[e].indices.map((e=>e+E))),E+=x[e].length,i)for(let t=0;t<4;t++)y.push(i[e].r,i[e].g,i[e].b,i[e].a)}const R=new gt.Pq(0,0,p),P=gt.uq.RotationY(Math.PI);m=x[0].map((e=>gt.Pq.TransformNormal(e,P).add(R))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),b=A[0].map((e=>gt.Pq.TransformNormal(e,P))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),m=m.concat(x[1].map((e=>e.subtract(R))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),b=b.concat(A[1].map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const I=new gt.Pq(d,0,0),M=gt.uq.RotationY(-Math.PI/2);m=m.concat(x[2].map((e=>gt.Pq.TransformNormal(e,M).add(I))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),b=b.concat(A[2].map((e=>gt.Pq.TransformNormal(e,M))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const w=gt.uq.RotationY(Math.PI/2);m=m.concat(x[3].map((e=>gt.Pq.TransformNormal(e,w).subtract(I))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),b=b.concat(A[3].map((e=>gt.Pq.TransformNormal(e,w))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const O=new gt.Pq(0,_,0),B=gt.uq.RotationX(Math.PI/2);m=m.concat(x[4].map((e=>gt.Pq.TransformNormal(e,B).add(O))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),b=b.concat(A[4].map((e=>gt.Pq.TransformNormal(e,B))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const D=gt.uq.RotationX(-Math.PI/2);m=m.concat(x[5].map((e=>gt.Pq.TransformNormal(e,D).subtract(O))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),b=b.concat(A[5].map((e=>gt.Pq.TransformNormal(e,D))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),Hn.P._ComputeSides(u,m,T,b,v);const F=new Hn.P;if(F.indices=T,F.positions=m,F.normals=b,F.uvs=v,i){const e=u===Hn.P.DOUBLESIDE?y.concat(y):y;F.colors=e}return F}function oo(e){const t=0|(e.segments||32),i=e.diameterX||e.diameter||1,s=e.diameterY||e.diameter||1,r=e.diameterZ||e.diameter||1,n=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,o=e.slice&&e.slice<=0?1:e.slice||1,a=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE,h=!!e.dedupTopBottomIndices,l=new gt.Pq(i/2,s/2,r/2),c=2+t,u=2*c,d=[],_=[],p=[],g=[];for(let e=0;e<=c;e++){const t=e/c,i=t*Math.PI*o;for(let e=0;e<=u;e++){const s=e/u,r=s*Math.PI*2*n,o=gt.uq.RotationZ(-i),a=gt.uq.RotationY(r),h=gt.Pq.TransformCoordinates(gt.Pq.Up(),o),c=gt.Pq.TransformCoordinates(h,a),d=c.multiply(l),f=c.divide(l).normalize();_.push(d.x,d.y,d.z),p.push(f.x,f.y,f.z),g.push(s,Wn.rX?1-t:t)}if(e>0){const t=_.length/3;for(let i=t-2*(u+1);i+u+2<t;i++)h?(e>1&&(d.push(i),d.push(i+1),d.push(i+u+1)),(e<c||o<1)&&(d.push(i+u+1),d.push(i+1),d.push(i+u+2))):(d.push(i),d.push(i+1),d.push(i+u+1),d.push(i+u+1),d.push(i+1),d.push(i+u+2))}}Hn.P._ComputeSides(a,_,d,p,g,e.frontUVs,e.backUVs);const f=new Hn.P;return f.indices=d,f.positions=_,f.normals=p,f.uvs=g,f}function ao(e,t={},i=null){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,oo(t).applyToMesh(s,t.updatable),s}Hn.P.CreateGround=jn,Hn.P.CreateTiledGround=Zn,Hn.P.CreateGroundFromHeightMap=$n,zn.e.CreateGround=(e,t,i,s,r,n)=>Jn(e,{width:t,height:i,subdivisions:s,updatable:n},r),zn.e.CreateTiledGround=(e,t,i,s,r,n,o,a,h)=>eo(e,{xmin:t,zmin:i,xmax:s,zmax:r,subdivisions:n,precision:o,updatable:h},a),zn.e.CreateGroundFromHeightMap=(e,t,i,s,r,n,o,a,h,l,c)=>to(e,t,{width:i,height:s,subdivisions:r,minHeight:n,maxHeight:o,updatable:h,onReady:l,alphaFilter:c},a),Hn.P.CreateBox=io,zn.e.CreateBox=(e,t,i=null,s,r)=>so(e,{size:t,sideOrientation:r,updatable:s},i),Hn.P.CreateTiledPlane=ro,Hn.P.CreateTiledBox=no,Hn.P.CreateSphere=oo,zn.e.CreateSphere=(e,t,i,s,r,n)=>ao(e,{segments:t,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:n,updatable:r},s);var ho=o(6871);function lo(e){const t=e.height||2;let i=0===e.diameterTop?0:e.diameterTop||e.diameter||1,s=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1;i=i||1e-5,s=s||1e-5;const r=0|(e.tessellation||24),n=0|(e.subdivisions||1),o=!!e.hasRings,a=!!e.enclose,h=0===e.cap?0:e.cap||zn.e.CAP_ALL,l=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,c=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE,u=e.faceUV||new Array(3),d=e.faceColors,_=2+(1+(1!==l&&a?2:0))*(o?n:1);let p;for(p=0;p<_;p++)d&&void 0===d[p]&&(d[p]=new bt.ov(1,1,1,1));for(p=0;p<_;p++)u&&void 0===u[p]&&(u[p]=new gt.IU(0,0,1,1));const g=[],f=[],m=[],b=[],v=[],T=2*Math.PI*l/r;let y,x,A;const C=(s-i)/2/t,S=gt.Pq.Zero(),E=gt.Pq.Zero(),R=gt.Pq.Zero(),P=gt.Pq.Zero(),I=gt.Pq.Zero(),M=ho._0.Y;let w,O,B,D=1,F=1,L=0,N=0;for(w=0;w<=n;w++)for(x=w/n,A=(x*(i-s)+s)/2,D=o&&0!==w&&w!==n?2:1,B=0;B<D;B++){for(o&&(F+=B),a&&(F+=2*B),O=0;O<=r;O++)y=O*T,S.x=Math.cos(-y)*A,S.y=-t/2+x*t,S.z=Math.sin(-y)*A,0===i&&w===n?(E.x=m[m.length-3*(r+1)],E.y=m[m.length-3*(r+1)+1],E.z=m[m.length-3*(r+1)+2]):(E.x=S.x,E.z=S.z,E.y=Math.sqrt(E.x*E.x+E.z*E.z)*C,E.normalize()),0===O&&(R.copyFrom(S),P.copyFrom(E)),f.push(S.x,S.y,S.z),m.push(E.x,E.y,E.z),N=o?L!==F?u[F].y:u[F].w:u[F].y+(u[F].w-u[F].y)*x,b.push(u[F].x+(u[F].z-u[F].x)*O/r,Wn.rX?1-N:N),d&&v.push(d[F].r,d[F].g,d[F].b,d[F].a);1!==l&&a&&(f.push(S.x,S.y,S.z),f.push(0,S.y,0),f.push(0,S.y,0),f.push(R.x,R.y,R.z),gt.Pq.CrossToRef(M,E,I),I.normalize(),m.push(I.x,I.y,I.z,I.x,I.y,I.z),gt.Pq.CrossToRef(P,M,I),I.normalize(),m.push(I.x,I.y,I.z,I.x,I.y,I.z),N=o?L!==F?u[F+1].y:u[F+1].w:u[F+1].y+(u[F+1].w-u[F+1].y)*x,b.push(u[F+1].x,Wn.rX?1-N:N),b.push(u[F+1].z,Wn.rX?1-N:N),N=o?L!==F?u[F+2].y:u[F+2].w:u[F+2].y+(u[F+2].w-u[F+2].y)*x,b.push(u[F+2].x,Wn.rX?1-N:N),b.push(u[F+2].z,Wn.rX?1-N:N),d&&(v.push(d[F+1].r,d[F+1].g,d[F+1].b,d[F+1].a),v.push(d[F+1].r,d[F+1].g,d[F+1].b,d[F+1].a),v.push(d[F+2].r,d[F+2].g,d[F+2].b,d[F+2].a),v.push(d[F+2].r,d[F+2].g,d[F+2].b,d[F+2].a))),L!==F&&(L=F)}const k=1!==l&&a?r+4:r;for(w=0,F=0;F<n;F++){let e=0,t=0,i=0,s=0;for(O=0;O<r;O++)e=w*(k+1)+O,t=(w+1)*(k+1)+O,i=w*(k+1)+(O+1),s=(w+1)*(k+1)+(O+1),g.push(e,t,i),g.push(s,i,t);1!==l&&a&&(g.push(e+2,t+2,i+2),g.push(s+2,i+2,t+2),g.push(e+4,t+4,i+4),g.push(s+4,i+4,t+4)),w=o?w+2:w+1}const U=e=>{const n=e?i/2:s/2;if(0===n)return;let o,a,h;const c=e?u[_-1]:u[0];let p=null;d&&(p=e?d[_-1]:d[0]);const T=f.length/3,y=e?t/2:-t/2,x=new gt.Pq(0,y,0);f.push(x.x,x.y,x.z),m.push(0,e?1:-1,0);const A=c.y+.5*(c.w-c.y);b.push(c.x+.5*(c.z-c.x),Wn.rX?1-A:A),p&&v.push(p.r,p.g,p.b,p.a);const C=new gt.I9(.5,.5);for(h=0;h<=r;h++){o=2*Math.PI*h*l/r;const t=Math.cos(-o),i=Math.sin(-o);a=new gt.Pq(t*n,y,i*n);const s=new gt.I9(t*C.x+.5,i*C.y+.5);f.push(a.x,a.y,a.z),m.push(0,e?1:-1,0);const u=c.y+(c.w-c.y)*s.y;b.push(c.x+(c.z-c.x)*s.x,Wn.rX?1-u:u),p&&v.push(p.r,p.g,p.b,p.a)}for(h=0;h<r;h++)e?(g.push(T),g.push(T+(h+2)),g.push(T+(h+1))):(g.push(T),g.push(T+(h+1)),g.push(T+(h+2)))};h!==zn.e.CAP_START&&h!==zn.e.CAP_ALL||U(!1),h!==zn.e.CAP_END&&h!==zn.e.CAP_ALL||U(!0),Hn.P._ComputeSides(c,f,g,m,b,e.frontUVs,e.backUVs);const V=new Hn.P;return V.indices=g,V.positions=f,V.normals=m,V.uvs=b,d&&(V.colors=v),V}function co(e,t={},i){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,lo(t).applyToMesh(s,t.updatable),s}function uo(e){const t=[],i=[],s=[],r=[],n=e.diameter||1,o=e.thickness||.5,a=0|(e.tessellation||16),h=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE,l=a+1;for(let e=0;e<=a;e++){const h=e/a,c=e*Math.PI*2/a-Math.PI/2,u=gt.uq.Translation(n/2,0,0).multiply(gt.uq.RotationY(c));for(let n=0;n<=a;n++){const c=1-n/a,d=n*Math.PI*2/a+Math.PI,_=Math.cos(d),p=Math.sin(d);let g=new gt.Pq(_,p,0),f=g.scale(o/2);const m=new gt.I9(h,c);f=gt.Pq.TransformCoordinates(f,u),g=gt.Pq.TransformNormal(g,u),i.push(f.x,f.y,f.z),s.push(g.x,g.y,g.z),r.push(m.x,Wn.rX?1-m.y:m.y);const b=(e+1)%l,v=(n+1)%l;t.push(e*l+n),t.push(e*l+v),t.push(b*l+n),t.push(e*l+v),t.push(b*l+v),t.push(b*l+n)}}Hn.P._ComputeSides(h,i,t,s,r,e.frontUVs,e.backUVs);const c=new Hn.P;return c.indices=t,c.positions=i,c.normals=s,c.uvs=r,c}function _o(e,t={},i){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,uo(t).applyToMesh(s,t.updatable),s}function po(e){const t=[],i=[],s=[],r=[],n=e.radius||2,o=e.tube||.5,a=e.radialSegments||32,h=e.tubularSegments||32,l=e.p||2,c=e.q||3,u=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE,d=e=>{const t=Math.cos(e),i=Math.sin(e),s=c/l*e,r=Math.cos(s),o=n*(2+r)*.5*t,a=n*(2+r)*i*.5,h=n*Math.sin(s)*.5;return new gt.Pq(o,a,h)};let _,p;for(_=0;_<=a;_++){const e=_%a/a*2*l*Math.PI,t=d(e),s=d(e+.01),n=s.subtract(t);let c=s.add(t);const u=gt.Pq.Cross(n,c);for(c=gt.Pq.Cross(u,n),u.normalize(),c.normalize(),p=0;p<h;p++){const e=p%h/h*2*Math.PI,s=-o*Math.cos(e),n=o*Math.sin(e);i.push(t.x+s*c.x+n*u.x),i.push(t.y+s*c.y+n*u.y),i.push(t.z+s*c.z+n*u.z),r.push(_/a),r.push(Wn.rX?1-p/h:p/h)}}for(_=0;_<a;_++)for(p=0;p<h;p++){const e=(p+1)%h,i=_*h+p,s=(_+1)*h+p,r=(_+1)*h+e,n=_*h+e;t.push(n),t.push(s),t.push(i),t.push(n),t.push(r),t.push(s)}Hn.P.ComputeNormals(i,t,s),Hn.P._ComputeSides(u,i,t,s,r,e.frontUVs,e.backUVs);const g=new Hn.P;return g.indices=t,g.positions=i,g.normals=s,g.uvs=r,g}function go(e,t={},i){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,po(t).applyToMesh(s,t.updatable),s}Hn.P.CreateCylinder=lo,zn.e.CreateCylinder=(e,t,i,s,r,n,o,a,h)=>(void 0!==o&&o instanceof Ie.Z||(void 0!==o&&(h=a||zn.e.DEFAULTSIDE,a=o),o=n,n=1),co(e,{height:t,diameterTop:i,diameterBottom:s,tessellation:r,subdivisions:n,sideOrientation:h,updatable:a},o)),Hn.P.CreateTorus=uo,zn.e.CreateTorus=(e,t,i,s,r,n,o)=>_o(e,{diameter:t,thickness:i,tessellation:s,sideOrientation:o,updatable:n},r),Hn.P.CreateTorusKnot=po,zn.e.CreateTorusKnot=(e,t,i,s,r,n,o,a,h,l)=>go(e,{radius:t,tube:i,radialSegments:s,tubularSegments:r,p:n,q:o,sideOrientation:l,updatable:h},a);var fo=o(6758);const mo={effect:null,subMesh:null};class bo extends Ot.E{constructor(e,t,i,s={},r=!0){super(e,t,r),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new gt.uq,this._cachedWorldViewProjectionMatrix=new gt.uq,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=i,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...s}}get shaderPath(){return this._shaderPath}set shaderPath(e){this._shaderPath=e}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)}setTexture(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this}removeTexture(e){delete this._textures[e]}setTextureArray(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this}setExternalTexture(e,t){return-1===this._options.externalTextures.indexOf(e)&&this._options.externalTextures.push(e),this._externalTextures[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setUInt(e,t){return this._checkUniform(e),this._uints[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setColor3Array(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setColor4Array(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setQuaternion(e,t){return this._checkUniform(e),this._quaternions[e]=t,this}setQuaternionArray(e,t){return this._checkUniform(e),this._quaternionsArrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}setMatrices(e,t){this._checkUniform(e);const i=new Float32Array(16*t.length);for(let e=0;e<t.length;e++)t[e].copyToArray(i,16*e);return this._matrixArrays[e]=i,this}setMatrix3x3(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this}setMatrix2x2(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this}setArray2(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this}setArray3(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this}setArray4(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this}setUniformBuffer(e,t){return-1===this._options.uniformBuffers.indexOf(e)&&this._options.uniformBuffers.push(e),this._uniformBuffers[e]=t,this}setTextureSampler(e,t){return-1===this._options.samplerObjects.indexOf(e)&&this._options.samplerObjects.push(e),this._textureSamplers[e]=t,this}setStorageBuffer(e,t){return-1===this._options.storageBuffers.indexOf(e)&&this._options.storageBuffers.push(e),this._storageBuffers[e]=t,this}setDefine(e,t){const i=e.trimEnd()+" ",s=this.options.defines.findIndex((t=>t===e||t.startsWith(i)));return s>=0&&this.options.defines.splice(s,1),("boolean"!=typeof t||t)&&this.options.defines.push(i+t),this}isReadyForSubMesh(e,t,i){return this.isReady(e,i,t)}isReady(e,t,i){const s=i&&this._storeEffectOnSubMeshes;if(this.isFrozen){const e=s?i._drawWrapper:this._drawWrapper;if(e.effect&&e._wasPreviouslyReady&&e._wasPreviouslyUsingInstances===t)return!0}const r=this.getScene(),n=r.getEngine(),o=[],a=[];let h=null,l=this._shaderPath,c=this._options.uniforms,u=this._options.uniformBuffers,d=this._options.samplers;n.getCaps().multiview&&r.activeCamera&&r.activeCamera.outputRenderTarget&&r.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,o.push("#define MULTIVIEW"),-1!==c.indexOf("viewProjection")&&-1===c.indexOf("viewProjectionR")&&c.push("viewProjectionR"));for(let e=0;e<this._options.defines.length;e++){const t=0===this._options.defines[e].indexOf("#define")?this._options.defines[e]:`#define ${this._options.defines[e]}`;o.push(t)}for(let e=0;e<this._options.attributes.length;e++)a.push(this._options.attributes[e]);if(e&&e.isVerticesDataPresent(Mt.R.ColorKind)&&(-1===a.indexOf(Mt.R.ColorKind)&&a.push(Mt.R.ColorKind),o.push("#define VERTEXCOLOR")),t&&(o.push("#define INSTANCES"),(0,Ut.te)(a,this._materialHelperNeedsPreviousMatrices),e?.hasThinInstances&&(o.push("#define THIN_INSTANCES"),e&&e.isVerticesDataPresent(Mt.R.ColorInstanceKind)&&(a.push(Mt.R.ColorInstanceKind),o.push("#define INSTANCESCOLOR")))),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){a.push(Mt.R.MatricesIndicesKind),a.push(Mt.R.MatricesWeightsKind),e.numBoneInfluencers>4&&(a.push(Mt.R.MatricesIndicesExtraKind),a.push(Mt.R.MatricesWeightsExtraKind));const t=e.skeleton;o.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),h=new Nt.J,h.addCPUSkinningFallback(0,e),t.isUsingTextureForMatrices?(o.push("#define BONETEXTURE"),-1===c.indexOf("boneTextureWidth")&&c.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(o.push("#define BonesPerMesh "+(t.bones.length+1)),-1===c.indexOf("mBones")&&c.push("mBones"))}else o.push("#define NUM_BONE_INFLUENCERS 0");let _=0;const p=e?e.morphTargetManager:null;if(p){const t=-1!==o.indexOf("#define UV1"),i=-1!==o.indexOf("#define UV2"),s=-1!==o.indexOf("#define TANGENT"),r=-1!==o.indexOf("#define NORMAL"),n=-1!==o.indexOf("#define VERTEXCOLOR");_=(0,Ut.Dk)(p,o,a,e,!0,r,s,t,i,n),p.isUsingTextureForTargets&&(-1===c.indexOf("morphTargetTextureIndices")&&c.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),_>0&&(c=c.slice(),c.push("morphTargetInfluences"),c.push("morphTargetCount"),c.push("morphTargetTextureInfo"),c.push("morphTargetTextureIndices"))}else o.push("#define NUM_MORPH_INFLUENCERS 0");if(e){const t=e.bakedVertexAnimationManager;t&&t.isEnabled&&(o.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===c.indexOf("bakedVertexAnimationSettings")&&c.push("bakedVertexAnimationSettings"),-1===c.indexOf("bakedVertexAnimationTextureSizeInverted")&&c.push("bakedVertexAnimationTextureSizeInverted"),-1===c.indexOf("bakedVertexAnimationTime")&&c.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,Ut.J2)(a,e,o)}for(const e in this._textures)if(!this._textures[e].isReady())return!1;e&&this.needAlphaTestingForMesh(e)&&o.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,kt.TV)(c),(0,kt.tv)(this,r,o)),r.fogEnabled&&e?.applyFog&&r.fogMode!==Ie.Z.FOGMODE_NONE&&(o.push("#define FOG"),-1===c.indexOf("view")&&c.push("view"),-1===c.indexOf("vFogInfos")&&c.push("vFogInfos"),-1===c.indexOf("vFogColor")&&c.push("vFogColor")),this._useLogarithmicDepth&&(o.push("#define LOGARITHMICDEPTH"),-1===c.indexOf("logarithmicDepthConstant")&&c.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(c=c.slice(),u=u.slice(),d=d.slice(),l=this.customShaderNameResolve(this.name,c,u,d,o,a));const g=s?i._getDrawWrapper(void 0,!0):this._drawWrapper,f=g?.effect??null,m=g?.defines??null,b=o.join("\n");let v=f;return m!==b&&(v=n.createEffect(l,{attributes:a,uniformsNames:c,uniformBuffersNames:u,samplers:d,defines:b,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:_},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},n),s?i.setEffect(v,b,this._materialContext):g&&g.setEffect(v,b),this._onEffectCreatedObservable&&(mo.effect=v,mo.subMesh=i??e?.subMeshes[0]??null,this._onEffectCreatedObservable.notifyObservers(mo))),g._wasPreviouslyUsingInstances=!!t,!!v?.isReady()&&(f!==v&&r.resetCachedMaterial(),g._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(e,t){const i=t??this.getEffect();if(!i)return;const s=this._options.uniforms;-1!==s.indexOf("world")&&i.setMatrix("world",e);const r=this.getScene();-1!==s.indexOf("worldView")&&(e.multiplyToRef(r.getViewMatrix(),this._cachedWorldViewMatrix),i.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==s.indexOf("worldViewProjection")&&(e.multiplyToRef(r.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),i.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==s.indexOf("view")&&i.setMatrix("view",r.getViewMatrix())}bindForSubMesh(e,t,i){this.bind(e,t,i._drawWrapperOverride?.effect,i)}bind(e,t,i,s){const r=s&&this._storeEffectOnSubMeshes,n=i??(r?s.effect:this.getEffect());if(!n)return;const o=this.getScene();this._activeEffect=n,this.bindOnlyWorldMatrix(e,i);const a=this._options.uniformBuffers;let h=!1;if(n&&a&&a.length>0&&o.getEngine().supportsUniformBuffers)for(let i=0;i<a.length;++i)switch(a[i]){case"Mesh":t&&(t.getMeshUniformBuffer().bindToEffect(n,"Mesh"),t.transferToEffect(e));break;case"Scene":(0,Ut._8)(n,o.getSceneUniformBuffer()),o.finalizeSceneUbo(),h=!0}const l=t&&r?this._mustRebind(o,n,s,t.visibility):o.getCachedMaterial()!==this;if(n&&l){let e;for(e in h||-1===this._options.uniforms.indexOf("view")||n.setMatrix("view",o.getViewMatrix()),h||-1===this._options.uniforms.indexOf("projection")||n.setMatrix("projection",o.getProjectionMatrix()),h||-1===this._options.uniforms.indexOf("viewProjection")||(n.setMatrix("viewProjection",o.getTransformMatrix()),this._multiview&&n.setMatrix("viewProjectionR",o._transformMatrixR)),o.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&n.setVector3("cameraPosition",o.activeCamera.globalPosition),(0,Ut.f$)(t,n),(0,kt.gS)(n,this,o),this._useLogarithmicDepth&&(0,Ut.DL)(r?s.materialDefines:n.defines,n,o),t&&(0,Ut.Yy)(o,t,n),this._textures)n.setTexture(e,this._textures[e]);for(e in this._textureArrays)n.setTextureArray(e,this._textureArrays[e]);for(e in this._ints)n.setInt(e,this._ints[e]);for(e in this._uints)n.setUInt(e,this._uints[e]);for(e in this._floats)n.setFloat(e,this._floats[e]);for(e in this._floatsArrays)n.setArray(e,this._floatsArrays[e]);for(e in this._colors3)n.setColor3(e,this._colors3[e]);for(e in this._colors3Arrays)n.setArray3(e,this._colors3Arrays[e]);for(e in this._colors4){const t=this._colors4[e];n.setFloat4(e,t.r,t.g,t.b,t.a)}for(e in this._colors4Arrays)n.setArray4(e,this._colors4Arrays[e]);for(e in this._vectors2)n.setVector2(e,this._vectors2[e]);for(e in this._vectors3)n.setVector3(e,this._vectors3[e]);for(e in this._vectors4)n.setVector4(e,this._vectors4[e]);for(e in this._quaternions)n.setQuaternion(e,this._quaternions[e]);for(e in this._matrices)n.setMatrix(e,this._matrices[e]);for(e in this._matrixArrays)n.setMatrices(e,this._matrixArrays[e]);for(e in this._matrices3x3)n.setMatrix3x3(e,this._matrices3x3[e]);for(e in this._matrices2x2)n.setMatrix2x2(e,this._matrices2x2[e]);for(e in this._vectors2Arrays)n.setArray2(e,this._vectors2Arrays[e]);for(e in this._vectors3Arrays)n.setArray3(e,this._vectors3Arrays[e]);for(e in this._vectors4Arrays)n.setArray4(e,this._vectors4Arrays[e]);for(e in this._quaternionsArrays)n.setArray4(e,this._quaternionsArrays[e]);for(e in this._uniformBuffers){const t=this._uniformBuffers[e].getBuffer();t&&n.bindUniformBuffer(t,e)}const i=o.getEngine(),a=i.setExternalTexture;if(a)for(e in this._externalTextures)a.call(i,e,this._externalTextures[e]);const l=i.setTextureSampler;if(l)for(e in this._textureSamplers)l.call(i,e,this._textureSamplers[e]);const c=i.setStorageBuffer;if(c)for(e in this._storageBuffers)c.call(i,e,this._storageBuffers[e])}if(n&&t&&(l||!this.isFrozen)){(0,Ut.nR)(t,n),t.morphTargetManager&&t.morphTargetManager.isUsingTextureForTargets&&t.morphTargetManager._bind(n);const e=t.bakedVertexAnimationManager;if(e&&e.isEnabled){const e=r?s._drawWrapper:this._drawWrapper;t.bakedVertexAnimationManager?.bind(n,!!e._wasPreviouslyUsingInstances)}}this._afterBind(t,n,s)}getActiveTextures(){const e=super.getActiveTextures();for(const t in this._textures)e.push(this._textures[t]);for(const t in this._textureArrays){const i=this._textureArrays[t];for(let t=0;t<i.length;t++)e.push(i[t])}return e}hasTexture(e){if(super.hasTexture(e))return!0;for(const t in this._textures)if(this._textures[t]===e)return!0;for(const t in this._textureArrays){const i=this._textureArrays[t];for(let t=0;t<i.length;t++)if(i[t]===e)return!0}return!1}clone(e){const t=Vt.p.Clone((()=>new bo(e,this.getScene(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);t.name=e,t.id=e,"object"==typeof t._shaderPath&&(t._shaderPath={...t._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((e=>{const t=this._options[e];Array.isArray(t)&&(this._options[e]=t.slice(0))})),this.stencil.copyTo(t.stencil);for(const e in this._textures)t.setTexture(e,this._textures[e]);for(const e in this._textureArrays)t.setTextureArray(e,this._textureArrays[e]);for(const e in this._externalTextures)t.setExternalTexture(e,this._externalTextures[e]);for(const e in this._ints)t.setInt(e,this._ints[e]);for(const e in this._uints)t.setUInt(e,this._uints[e]);for(const e in this._floats)t.setFloat(e,this._floats[e]);for(const e in this._floatsArrays)t.setFloats(e,this._floatsArrays[e]);for(const e in this._colors3)t.setColor3(e,this._colors3[e]);for(const e in this._colors3Arrays)t._colors3Arrays[e]=this._colors3Arrays[e];for(const e in this._colors4)t.setColor4(e,this._colors4[e]);for(const e in this._colors4Arrays)t._colors4Arrays[e]=this._colors4Arrays[e];for(const e in this._vectors2)t.setVector2(e,this._vectors2[e]);for(const e in this._vectors3)t.setVector3(e,this._vectors3[e]);for(const e in this._vectors4)t.setVector4(e,this._vectors4[e]);for(const e in this._quaternions)t.setQuaternion(e,this._quaternions[e]);for(const e in this._quaternionsArrays)t._quaternionsArrays[e]=this._quaternionsArrays[e];for(const e in this._matrices)t.setMatrix(e,this._matrices[e]);for(const e in this._matrixArrays)t._matrixArrays[e]=this._matrixArrays[e].slice();for(const e in this._matrices3x3)t.setMatrix3x3(e,this._matrices3x3[e]);for(const e in this._matrices2x2)t.setMatrix2x2(e,this._matrices2x2[e]);for(const e in this._vectors2Arrays)t.setArray2(e,this._vectors2Arrays[e]);for(const e in this._vectors3Arrays)t.setArray3(e,this._vectors3Arrays[e]);for(const e in this._vectors4Arrays)t.setArray4(e,this._vectors4Arrays[e]);for(const e in this._uniformBuffers)t.setUniformBuffer(e,this._uniformBuffers[e]);for(const e in this._textureSamplers)t.setTextureSampler(e,this._textureSamplers[e]);for(const e in this._storageBuffers)t.setStorageBuffer(e,this._storageBuffers[e]);return t}dispose(e,t,i){if(t){let e;for(e in this._textures)this._textures[e].dispose();for(e in this._textureArrays){const t=this._textureArrays[e];for(let e=0;e<t.length;e++)t[e].dispose()}}this._textures={},super.dispose(e,t,i)}serialize(){const e=Vt.p.Serialize(this);let t;for(t in e.customType="BABYLON.ShaderMaterial",e.uniqueId=this.uniqueId,e.options=this._options,e.shaderPath=this._shaderPath,e.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,e.stencil=this.stencil.serialize(),e.textures={},this._textures)e.textures[t]=this._textures[t].serialize();for(t in e.textureArrays={},this._textureArrays){e.textureArrays[t]=[];const i=this._textureArrays[t];for(let s=0;s<i.length;s++)e.textureArrays[t].push(i[s].serialize())}for(t in e.ints={},this._ints)e.ints[t]=this._ints[t];for(t in e.uints={},this._uints)e.uints[t]=this._uints[t];for(t in e.floats={},this._floats)e.floats[t]=this._floats[t];for(t in e.floatsArrays={},this._floatsArrays)e.floatsArrays[t]=this._floatsArrays[t];for(t in e.colors3={},this._colors3)e.colors3[t]=this._colors3[t].asArray();for(t in e.colors3Arrays={},this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];for(t in e.colors4={},this._colors4)e.colors4[t]=this._colors4[t].asArray();for(t in e.colors4Arrays={},this._colors4Arrays)e.colors4Arrays[t]=this._colors4Arrays[t];for(t in e.vectors2={},this._vectors2){const i=this._vectors2[t];e.vectors2[t]=[i.x,i.y]}for(t in e.vectors3={},this._vectors3){const i=this._vectors3[t];e.vectors3[t]=[i.x,i.y,i.z]}for(t in e.vectors4={},this._vectors4){const i=this._vectors4[t];e.vectors4[t]=[i.x,i.y,i.z,i.w]}for(t in e.quaternions={},this._quaternions)e.quaternions[t]=this._quaternions[t].asArray();for(t in e.matrices={},this._matrices)e.matrices[t]=this._matrices[t].asArray();for(t in e.matrixArray={},this._matrixArrays)e.matrixArray[t]=this._matrixArrays[t];for(t in e.matrices3x3={},this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];for(t in e.matrices2x2={},this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];for(t in e.vectors2Arrays={},this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in e.vectors3Arrays={},this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];for(t in e.vectors4Arrays={},this._vectors4Arrays)e.vectors4Arrays[t]=this._vectors4Arrays[t];for(t in e.quaternionsArrays={},this._quaternionsArrays)e.quaternionsArrays[t]=this._quaternionsArrays[t];return e}static Parse(e,t,i){const s=Vt.p.Parse((()=>new bo(e.name,t,e.shaderPath,e.options,e.storeEffectOnSubMeshes)),e,t,i);let r;for(r in e.stencil&&s.stencil.parse(e.stencil,t,i),e.textures)s.setTexture(r,Dt.g.Parse(e.textures[r],t,i));for(r in e.textureArrays){const n=e.textureArrays[r],o=[];for(let e=0;e<n.length;e++)o.push(Dt.g.Parse(n[e],t,i));s.setTextureArray(r,o)}for(r in e.ints)s.setInt(r,e.ints[r]);for(r in e.uints)s.setUInt(r,e.uints[r]);for(r in e.floats)s.setFloat(r,e.floats[r]);for(r in e.floatsArrays)s.setFloats(r,e.floatsArrays[r]);for(r in e.colors3)s.setColor3(r,bt.v9.FromArray(e.colors3[r]));for(r in e.colors3Arrays){const t=e.colors3Arrays[r].reduce(((e,t,i)=>(i%3==0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>bt.v9.FromArray(e)));s.setColor3Array(r,t)}for(r in e.colors4)s.setColor4(r,bt.ov.FromArray(e.colors4[r]));for(r in e.colors4Arrays){const t=e.colors4Arrays[r].reduce(((e,t,i)=>(i%4==0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>bt.ov.FromArray(e)));s.setColor4Array(r,t)}for(r in e.vectors2)s.setVector2(r,gt.I9.FromArray(e.vectors2[r]));for(r in e.vectors3)s.setVector3(r,gt.Pq.FromArray(e.vectors3[r]));for(r in e.vectors4)s.setVector4(r,gt.IU.FromArray(e.vectors4[r]));for(r in e.quaternions)s.setQuaternion(r,gt.PT.FromArray(e.quaternions[r]));for(r in e.matrices)s.setMatrix(r,gt.uq.FromArray(e.matrices[r]));for(r in e.matrixArray)s._matrixArrays[r]=new Float32Array(e.matrixArray[r]);for(r in e.matrices3x3)s.setMatrix3x3(r,e.matrices3x3[r]);for(r in e.matrices2x2)s.setMatrix2x2(r,e.matrices2x2[r]);for(r in e.vectors2Arrays)s.setArray2(r,e.vectors2Arrays[r]);for(r in e.vectors3Arrays)s.setArray3(r,e.vectors3Arrays[r]);for(r in e.vectors4Arrays)s.setArray4(r,e.vectors4Arrays[r]);for(r in e.quaternionsArrays)s.setArray4(r,e.quaternionsArrays[r]);return s}static ParseFromFileAsync(e,t,i,s=""){return new Promise(((r,n)=>{const o=new Rs.u;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const t=JSON.parse(o.responseText),n=this.Parse(t,i||os.q.LastCreatedScene,s);e&&(n.name=e),r(n)}else n("Unable to load the ShaderMaterial")})),o.open("GET",t),o.send()}))}static ParseFromSnippetAsync(e,t,i=""){return new Promise(((s,r)=>{const n=new Rs.u;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const r=JSON.parse(JSON.parse(n.responseText).jsonPayload),o=JSON.parse(r.shaderMaterial),a=this.Parse(o,t||os.q.LastCreatedScene,i);a.snippetId=e,s(a)}else r("Unable to load the snippet "+e)})),n.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),n.send()}))}}bo.SnippetUrl="https://snippet.babylonjs.com",bo.CreateFromSnippetAsync=bo.ParseFromSnippetAsync,(0,Ft.Y5)("BABYLON.ShaderMaterial",bo),zn.e._LinesMeshParser=(e,t)=>vo.Parse(e,t);class vo extends zn.e{_isShaderMaterial(e){return"ShaderMaterial"===e.getClassName()}constructor(e,t=null,i=null,s=null,r,n,a,h){super(e,t,i,s,r),this.useVertexColor=n,this.useVertexAlpha=a,this.color=new bt.v9(1,1,1),this.alpha=1,this._shaderLanguage=0,s&&(this.color=s.color.clone(),this.alpha=s.alpha,this.useVertexColor=s.useVertexColor,this.useVertexAlpha=s.useVertexAlpha),this.intersectionThreshold=.1;const l={attributes:[Mt.R.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};this.useVertexAlpha?l.defines.push("#define VERTEXALPHA"):l.needAlphaBlending=!1,this.useVertexColor?(l.defines.push("#define VERTEXCOLOR"),l.attributes.push(Mt.R.ColorKind)):(l.uniforms.push("color"),this._color4=new bt.ov),h?this.material=h:(this.getScene().getEngine().isWebGPU&&!vo.ForceGLSL&&(this._shaderLanguage=1),l.shaderLanguage=this._shaderLanguage,l.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([o.e(3285).then(o.bind(o,3285)),o.e(9723).then(o.bind(o,2104))]):await Promise.all([o.e(4962).then(o.bind(o,4962)),o.e(7636).then(o.bind(o,7636))])},this.material=new bo("colorShader",this.getScene(),"color",l,!1),this.material.doNotSerialize=!0)}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(e){this._lineMaterial=e,this._lineMaterial.fillMode=as.i.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(e){}_bind(e,t){if(!this._geometry)return this;const i=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,i):this._geometry._bind(t,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:e,g:t,b:i}=this.color;this._color4.set(e,t,i,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const s=this.getScene().getEngine();return this._unIndexed?s.drawArraysType(as.i.LineListDrawMode,e.verticesStart,e.verticesCount,i):s.drawElementsType(as.i.LineListDrawMode,e.indexStart,e.indexCount,i),this}dispose(e,t=!1,i){i||this._lineMaterial.dispose(!1,!1,!0),super.dispose(e)}clone(e,t=null,i){return new vo(e,this.getScene(),t,this,i)}createInstance(e){const t=new To(e,this);if(this.instancedBuffers){t.instancedBuffers={};for(const e in this.instancedBuffers)t.instancedBuffers[e]=this.instancedBuffers[e]}return t}serialize(e){super.serialize(e),e.color=this.color.asArray(),e.alpha=this.alpha}static Parse(e,t){const i=new vo(e.name,t);return i.color=bt.v9.FromArray(e.color),i.alpha=e.alpha,i}}vo.ForceGLSL=!1;class To extends fo.Z{constructor(e,t){super(e,t),this.intersectionThreshold=t.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}function yo(e){const t=[],i=[],s=e.lines,r=e.colors,n=[];let o=0;for(let e=0;e<s.length;e++){const a=s[e];for(let s=0;s<a.length;s++){const{x:h,y:l,z:c}=a[s];if(i.push(h,l,c),r){const t=r[e],{r:i,g:o,b:a,a:h}=t[s];n.push(i,o,a,h)}s>0&&(t.push(o-1),t.push(o)),o++}}const a=new Hn.P;return a.indices=t,a.positions=i,r&&(a.colors=n),a}function xo(e){const t=e.dashSize||3,i=e.gapSize||1,s=e.dashNb||200,r=e.points,n=[],o=[],a=gt.Pq.Zero();let h=0,l=0,c=0,u=0,d=0,_=0,p=0;for(p=0;p<r.length-1;p++)r[p+1].subtractToRef(r[p],a),h+=a.length();for(c=h/s,u=t*c/(t+i),p=0;p<r.length-1;p++){r[p+1].subtractToRef(r[p],a),l=Math.floor(a.length()/c),a.normalize();for(let e=0;e<l;e++)d=c*e,n.push(r[p].x+d*a.x,r[p].y+d*a.y,r[p].z+d*a.z),n.push(r[p].x+(d+u)*a.x,r[p].y+(d+u)*a.y,r[p].z+(d+u)*a.z),o.push(_,_+1),_+=2}const g=new Hn.P;return g.positions=n,g.indices=o,g}function Ao(e,t,i=null){const s=t.instance,r=t.lines,n=t.colors;if(s){const e=s.getVerticesData(Mt.R.PositionKind);let t,i;n&&(t=s.getVerticesData(Mt.R.ColorKind));let o=0,a=0;for(let s=0;s<r.length;s++){const h=r[s];for(let r=0;r<h.length;r++)e[o]=h[r].x,e[o+1]=h[r].y,e[o+2]=h[r].z,n&&t&&(i=n[s],t[a]=i[r].r,t[a+1]=i[r].g,t[a+2]=i[r].b,t[a+3]=i[r].a,a+=4),o+=3}return s.updateVerticesData(Mt.R.PositionKind,e,!1,!1),n&&t&&s.updateVerticesData(Mt.R.ColorKind,t,!1,!1),s.refreshBoundingInfo(),s}const o=new vo(e,i,null,void 0,void 0,!!n,t.useVertexAlpha,t.material);return yo(t).applyToMesh(o,t.updatable),o}function Co(e,t,i=null){const s=t.colors?[t.colors]:null;return Ao(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:s,useVertexAlpha:t.useVertexAlpha,material:t.material},i)}function So(e,t,i=null){const s=t.points,r=t.instance,n=t.gapSize||1,o=t.dashSize||3;if(r){const e=e=>{const t=gt.Pq.Zero(),i=e.length/6;let n=0,o=0,a=0,h=0,l=0,c=0,u=0,d=0;for(u=0;u<s.length-1;u++)s[u+1].subtractToRef(s[u],t),n+=t.length();a=n/i;const _=r._creationDataStorage.dashSize;for(h=_*a/(_+r._creationDataStorage.gapSize),u=0;u<s.length-1;u++)for(s[u+1].subtractToRef(s[u],t),o=Math.floor(t.length()/a),t.normalize(),d=0;d<o&&c<e.length;)l=a*d,e[c]=s[u].x+l*t.x,e[c+1]=s[u].y+l*t.y,e[c+2]=s[u].z+l*t.z,e[c+3]=s[u].x+(l+h)*t.x,e[c+4]=s[u].y+(l+h)*t.y,e[c+5]=s[u].z+(l+h)*t.z,c+=6,d++;for(;c<e.length;)e[c]=s[u].x,e[c+1]=s[u].y,e[c+2]=s[u].z,c+=3};return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&It.V.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),r.updateMeshPositions(e,!1),r}const a=new vo(e,i,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return xo(t).applyToMesh(a,t.updatable),a._creationDataStorage=new zn.Ez,a._creationDataStorage.dashSize=o,a._creationDataStorage.gapSize=n,a}Hn.P.CreateLineSystem=yo,Hn.P.CreateDashedLines=xo,zn.e.CreateLines=(e,t,i=null,s=!1,r=null)=>Co(e,{points:t,updatable:s,instance:r},i),zn.e.CreateDashedLines=(e,t,i,s,r,n=null,o,a)=>So(e,{points:t,dashSize:i,gapSize:s,dashNb:r,updatable:o,instance:a},n);var Eo=o(3245);class Ro extends gt.I9{constructor(e,t){super(e.x,e.y),this.index=t}}class Po{constructor(){this.elements=[]}add(e){const t=[];return e.forEach((e=>{const i=new Ro(e,this.elements.length);t.push(i),this.elements.push(i)})),t}computeBounds(){const e=new gt.I9(this.elements[0].x,this.elements[0].y),t=new gt.I9(this.elements[0].x,this.elements[0].y);return this.elements.forEach((i=>{i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y)})),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}}}class Io{_addToepoint(e){for(const t of e)this._epoints.push(t.x,t.y)}constructor(e,t,i,s=earcut){let r;this._points=new Po,this._outlinepoints=new Po,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=s,this._name=e,this._scene=i||os.q.LastCreatedScene,r=t instanceof Eo.Cu?t.getPoints():t,this._addToepoint(r),this._points.add(r),this._outlinepoints.add(r),void 0===this.bjsEarcut&&It.V.Warn("Earcut was not found, the polygon will not be built.")}addHole(e){this._points.add(e);const t=new Po;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this}build(e=!1,t=0,i=2){const s=new zn.e(this._name,this._scene),r=this.buildVertexData(t,i);return s.setVerticesData(Mt.R.PositionKind,r.positions,e),s.setVerticesData(Mt.R.NormalKind,r.normals,e),s.setVerticesData(Mt.R.UVKind,r.uvs,e),s.setIndices(r.indices),s}buildVertexData(e=0,t=2){const i=new Hn.P,s=[],r=[],n=[],o=this._points.computeBounds();this._points.elements.forEach((e=>{s.push(0,1,0),r.push(e.x,0,e.y),n.push((e.x-o.min.x)/o.width,(e.y-o.min.y)/o.height)}));const a=[],h=this.bjsEarcut(this._epoints,this._eholes,2);for(let e=0;e<h.length;e++)a.push(h[e]);if(e>0){const i=r.length/3;this._points.elements.forEach((t=>{s.push(0,-1,0),r.push(t.x,-e,t.y),n.push(1-(t.x-o.min.x)/o.width,1-(t.y-o.min.y)/o.height)}));const h=a.length;for(let e=0;e<h;e+=3){const t=a[e+0],s=a[e+1],r=a[e+2];a.push(r+i),a.push(s+i),a.push(t+i)}this._addSide(r,s,n,a,o,this._outlinepoints,e,!1,t),this._holes.forEach((i=>{this._addSide(r,s,n,a,o,i,e,!0,t)}))}return i.indices=a,i.positions=r,i.normals=s,i.uvs=n,i}_addSide(e,t,i,s,r,n,o,a,h){let l=e.length/3,c=0;for(let u=0;u<n.elements.length;u++){const d=n.elements[u],_=n.elements[(u+1)%n.elements.length];e.push(d.x,0,d.y),e.push(d.x,-o,d.y),e.push(_.x,0,_.y),e.push(_.x,-o,_.y);const p=n.elements[(u+n.elements.length-1)%n.elements.length],g=n.elements[(u+2)%n.elements.length];let f=new gt.Pq(-(_.y-d.y),0,_.x-d.x),m=new gt.Pq(-(d.y-p.y),0,d.x-p.x),b=new gt.Pq(-(g.y-_.y),0,g.x-_.x);a||(f=f.scale(-1),m=m.scale(-1),b=b.scale(-1));const v=f.normalizeToNew();let T=m.normalizeToNew(),y=b.normalizeToNew();const x=gt.Pq.Dot(T,v);T=x>h?x<bs.bH-1?new gt.Pq(d.x,0,d.y).subtract(new gt.Pq(_.x,0,_.y)).normalize():m.add(f).normalize():v;const A=gt.Pq.Dot(b,f);y=A>h?A<bs.bH-1?new gt.Pq(_.x,0,_.y).subtract(new gt.Pq(d.x,0,d.y)).normalize():b.add(f).normalize():v,i.push(c/r.width,0),i.push(c/r.width,1),c+=f.length(),i.push(c/r.width,0),i.push(c/r.width,1),t.push(T.x,T.y,T.z),t.push(T.x,T.y,T.z),t.push(y.x,y.y,y.z),t.push(y.x,y.y,y.z),a?(s.push(l),s.push(l+2),s.push(l+1),s.push(l+1),s.push(l+2),s.push(l+3)):(s.push(l),s.push(l+1),s.push(l+2),s.push(l+1),s.push(l+3),s.push(l+2)),l+=4}}}function Mo(e,t,i,s,r,n,o){const a=i||new Array(3),h=s,l=[],c=o||!1;for(let e=0;e<3;e++)void 0===a[e]&&(a[e]=new gt.IU(0,0,1,1)),h&&void 0===h[e]&&(h[e]=new bt.ov(1,1,1,1));const u=e.getVerticesData(Mt.R.PositionKind),d=e.getVerticesData(Mt.R.NormalKind),_=e.getVerticesData(Mt.R.UVKind),p=e.getIndices(),g=u.length/9;let f=0,m=0,b=0,v=0,T=0;const y=[0];if(c)for(let e=g;e<u.length/3;e+=4)m=u[3*(e+2)]-u[3*e],b=u[3*(e+2)+2]-u[3*e+2],v=Math.sqrt(m*m+b*b),T+=v,y.push(T);let x=0,A=0;for(let e=0;e<d.length;e+=3)Math.abs(d[e+1])<.001&&(A=1),Math.abs(d[e+1]-1)<.001&&(A=0),Math.abs(d[e+1]+1)<.001&&(A=2),x=e/3,1===A?(f=x-g,_[2*x]=f%4<1.5?c?a[A].x+(a[A].z-a[A].x)*y[Math.floor(f/4)]/T:a[A].x:c?a[A].x+(a[A].z-a[A].x)*y[Math.floor(f/4)+1]/T:a[A].z,_[2*x+1]=f%2==0?Wn.rX?1-a[A].w:a[A].w:Wn.rX?1-a[A].y:a[A].y):(_[2*x]=(1-_[2*x])*a[A].x+_[2*x]*a[A].z,_[2*x+1]=(1-_[2*x+1])*a[A].y+_[2*x+1]*a[A].w,Wn.rX&&(_[2*x+1]=1-_[2*x+1])),h&&l.push(h[A].r,h[A].g,h[A].b,h[A].a);Hn.P._ComputeSides(t,u,p,d,_,r,n);const C=new Hn.P;if(C.indices=p,C.positions=u,C.normals=d,C.uvs=_,h){const e=t===Hn.P.DOUBLESIDE?l.concat(l):l;C.colors=e}return C}function wo(e,t,i=null,s=earcut){t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation);const r=t.shape,n=t.holes||[],o=t.depth||0,a=t.smoothingThreshold||2,h=[];let l=[];for(let e=0;e<r.length;e++)h[e]=new gt.I9(r[e].x,r[e].z);h[0].equalsWithEpsilon(h[h.length-1],1e-8)&&h.pop();const c=new Io(e,h,i||os.q.LastCreatedScene,s);for(let e=0;e<n.length;e++){l=[];for(let t=0;t<n[e].length;t++)l.push(new gt.I9(n[e][t].x,n[e][t].z));c.addHole(l)}const u=c.build(!1,o,a);return u._originalBuilderSideOrientation=t.sideOrientation,Mo(u,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs,t.wrap).applyToMesh(u,t.updatable),u}function Oo(e,t,i=null,s=earcut){return wo(e,t,i,s)}function Bo(e,t,i=null){const s=t.path,r=t.shape,n=t.scale||1,o=t.rotation||0,a=0===t.cap?0:t.cap||zn.e.NO_CAP,h=t.updatable,l=zn.e._GetDefaultSideOrientation(t.sideOrientation),c=t.instance||null,u=t.invertUV||!1,d=t.closeShape||!1;return Fo(e,r,s,n,o,null,null,t.closePath||!1,d,a,!1,i,!!h,l,c,u,t.frontUVs||null,t.backUVs||null,t.firstNormal||null,!!t.adjustFrame)}function Do(e,t,i=null){const s=t.path,r=t.shape,n=t.scaleFunction||(()=>1),o=t.rotationFunction||(()=>0),a=t.closePath||t.ribbonCloseArray||!1,h=t.closeShape||t.ribbonClosePath||!1,l=0===t.cap?0:t.cap||zn.e.NO_CAP,c=t.updatable,u=t.firstNormal||null,d=t.adjustFrame||!1;return Fo(e,r,s,null,null,n,o,a,h,l,!0,i,!!c,zn.e._GetDefaultSideOrientation(t.sideOrientation),t.instance||null,t.invertUV||!1,t.frontUVs||null,t.backUVs||null,u,d)}function Fo(e,t,i,s,r,n,o,a,h,l,c,u,d,_,p,g,f,m,b,v){const T=(e,t,i,s,r,n,o,a,h,l,c)=>{const u=i.getTangents(),d=i.getNormals(),_=i.getBinormals(),p=i.getDistances();if(c)for(let e=0;e<u.length;e++)if(0==u[e].x&&0==u[e].y&&0==u[e].z&&u[e].copyFrom(u[e-1]),0==d[e].x&&0==d[e].y&&0==d[e].z&&d[e].copyFrom(d[e-1]),0==_[e].x&&0==_[e].y&&0==_[e].z&&_[e].copyFrom(_[e-1]),e>0){let t=u[e-1];gt.Pq.Dot(t,u[e])<0&&u[e].scaleInPlace(-1),t=d[e-1],gt.Pq.Dot(t,d[e])<0&&d[e].scaleInPlace(-1),t=_[e-1],gt.Pq.Dot(t,_[e])<0&&_[e].scaleInPlace(-1)}let g=0;const f=l&&a?a:()=>null!==n?n:0,m=l&&o?o:()=>null!==r?r:1;let b=h===zn.e.NO_CAP||h===zn.e.CAP_END?0:2;const v=gt.AA.Matrix[0];for(let i=0;i<t.length;i++){const r=[],n=f(i,p[i]),o=m(i,p[i]);gt.uq.RotationAxisToRef(u[i],g,v);for(let s=0;s<e.length;s++){const n=u[i].scale(e[s].z).add(d[i].scale(e[s].x)).add(_[i].scale(e[s].y)),a=gt.Pq.Zero();gt.Pq.TransformCoordinatesToRef(n,v,a),a.scaleInPlace(o).addInPlace(t[i]),r[s]=a}s[b]=r,g+=n,b++}const T=e=>{const t=Array(),i=gt.Pq.Zero();let s;for(s=0;s<e.length;s++)i.addInPlace(e[s]);for(i.scaleInPlace(1/e.length),s=0;s<e.length;s++)t.push(i);return t};switch(h){case zn.e.NO_CAP:break;case zn.e.CAP_START:s[0]=T(s[2]),s[1]=s[2];break;case zn.e.CAP_END:s[b]=s[b-1],s[b+1]=T(s[b-1]);break;case zn.e.CAP_ALL:s[0]=T(s[2]),s[1]=s[2],s[b]=s[b-1],s[b+1]=T(s[b-1])}return s};let y,x;if(p){const e=p._creationDataStorage;return y=b?e.path3D.update(i,b):e.path3D.update(i),x=T(t,i,e.path3D,e.pathArray,s,r,n,o,e.cap,c,v),qn("",{pathArray:x,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:p},u||void 0)}y=b?new Eo.tO(i,b):new Eo.tO(i),x=T(t,i,y,new Array,s,r,n,o,l=l<0||l>3?0:l,c,v);const A=qn(e,{pathArray:x,closeArray:a,closePath:h,updatable:d,sideOrientation:_,invertUV:g,frontUVs:f||void 0,backUVs:m||void 0},u);return A._creationDataStorage.pathArray=x,A._creationDataStorage.path3D=y,A._creationDataStorage.cap=l,A}function Lo(e,t,i=null){const s=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,r=void 0===t.closed||t.closed,n=t.shape,o=t.radius||1,a=t.tessellation||64,h=t.clip||0,l=t.updatable,c=zn.e._GetDefaultSideOrientation(t.sideOrientation),u=t.cap||zn.e.NO_CAP,d=2*Math.PI,_=[],p=t.invertUV||!1;let g=0,f=0;const m=d/a*s;let b,v;for(g=0;g<=a-h;g++){for(v=[],u!=zn.e.CAP_START&&u!=zn.e.CAP_ALL||(v.push(new gt.Pq(0,n[0].y,0)),v.push(new gt.Pq(Math.cos(g*m)*n[0].x*o,n[0].y,Math.sin(g*m)*n[0].x*o))),f=0;f<n.length;f++)b=new gt.Pq(Math.cos(g*m)*n[f].x*o,n[f].y,Math.sin(g*m)*n[f].x*o),v.push(b);u!=zn.e.CAP_END&&u!=zn.e.CAP_ALL||(v.push(new gt.Pq(Math.cos(g*m)*n[n.length-1].x*o,n[n.length-1].y,Math.sin(g*m)*n[n.length-1].x*o)),v.push(new gt.Pq(0,n[n.length-1].y,0))),_.push(v)}return qn(e,{pathArray:_,closeArray:r,sideOrientation:c,updatable:l,invertUV:p,frontUVs:t.frontUVs,backUVs:t.backUVs},i)}function No(e){const t=[],i=[],s=[],r=[],n=void 0!==e.width?e.width:void 0!==e.size?e.size:1,o=void 0!==e.height?e.height:void 0!==e.size?e.size:1,a=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE,h=n/2,l=o/2;i.push(-h,-l,0),s.push(0,0,-1),r.push(0,Wn.rX?1:0),i.push(h,-l,0),s.push(0,0,-1),r.push(1,Wn.rX?1:0),i.push(h,l,0),s.push(0,0,-1),r.push(1,Wn.rX?0:1),i.push(-h,l,0),s.push(0,0,-1),r.push(0,Wn.rX?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),Hn.P._ComputeSides(a,i,t,s,r,e.frontUVs,e.backUVs);const c=new Hn.P;return c.indices=t,c.positions=i,c.normals=s,c.uvs=r,c}function ko(e,t={},i=null){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,No(t).applyToMesh(s,t.updatable),t.sourcePlane&&(s.translate(t.sourcePlane.normal,-t.sourcePlane.d),s.setDirection(t.sourcePlane.normal.scale(-1))),s}function Uo(e,t,i=null){const s=t.path;let r=t.instance,n=1;void 0!==t.radius?n=t.radius:r&&(n=r._creationDataStorage.radius);const o=t.tessellation||64,a=t.radiusFunction||null;let h=t.cap||zn.e.NO_CAP;const l=t.invertUV||!1,c=t.updatable,u=zn.e._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;const d=(e,t,i,s,r,n,o,a)=>{const h=t.getTangents(),l=t.getNormals(),c=t.getDistances(),u=2*Math.PI/r*a,d=n||(()=>s);let _,p,g,f;const m=gt.AA.Matrix[0];let b=o===zn.e.NO_CAP||o===zn.e.CAP_END?0:2;for(let t=0;t<e.length;t++){p=d(t,c[t]),_=Array(),g=l[t];for(let i=0;i<r;i++)gt.uq.RotationAxisToRef(h[t],u*i,m),f=_[i]?_[i]:gt.Pq.Zero(),gt.Pq.TransformCoordinatesToRef(g,m,f),f.scaleInPlace(p).addInPlace(e[t]),_[i]=f;i[b]=_,b++}const v=(t,i)=>{const s=Array();for(let r=0;r<t;r++)s.push(e[i]);return s};switch(o){case zn.e.NO_CAP:break;case zn.e.CAP_START:i[0]=v(r,0),i[1]=i[2].slice(0);break;case zn.e.CAP_END:i[b]=i[b-1].slice(0),i[b+1]=v(r,e.length-1);break;case zn.e.CAP_ALL:i[0]=v(r,0),i[1]=i[2].slice(0),i[b]=i[b-1].slice(0),i[b+1]=v(r,e.length-1)}return i};let _,p;if(r){const e=r._creationDataStorage,i=t.arc||e.arc;return _=e.path3D.update(s),p=d(s,_,e.pathArray,n,e.tessellation,a,e.cap,i),r=qn("",{pathArray:p,instance:r}),e.path3D=_,e.pathArray=p,e.arc=i,e.radius=n,r}_=new Eo.tO(s),h=h<0||h>3?0:h,p=d(s,_,new Array,n,o,a,h,t.arc);const g=qn(e,{pathArray:p,closePath:!0,closeArray:!1,updatable:c,sideOrientation:u,invertUV:l,frontUVs:t.frontUVs,backUVs:t.backUVs},i);return g._creationDataStorage.pathArray=p,g._creationDataStorage.path3D=_,g._creationDataStorage.tessellation=o,g._creationDataStorage.cap=h,g._creationDataStorage.arc=t.arc,g._creationDataStorage.radius=n,g}function Vo(e){const t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const i=e.type&&(e.type<0||e.type>=t.length)?0:e.type||0,s=e.size,r=e.sizeX||s||1,n=e.sizeY||s||1,o=e.sizeZ||s||1,a=e.custom||t[i],h=a.face.length,l=e.faceUV||new Array(h),c=e.faceColors,u=void 0===e.flat||e.flat,d=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE,_=[],p=[],g=[],f=[],m=[];let b=0,v=0;const T=[];let y,x,A,C,S,E,R=0,P=0;if(u)for(P=0;P<h;P++)c&&void 0===c[P]&&(c[P]=new bt.ov(1,1,1,1)),l&&void 0===l[P]&&(l[P]=new gt.IU(0,0,1,1));if(u)for(P=0;P<h;P++){const e=a.face[P].length;for(A=2*Math.PI/e,C=.5*Math.tan(A/2),S=.5,R=0;R<e;R++)_.push(a.vertex[a.face[P][R]][0]*r,a.vertex[a.face[P][R]][1]*n,a.vertex[a.face[P][R]][2]*o),T.push(b),b++,y=l[P].x+(l[P].z-l[P].x)*(.5+C),x=l[P].y+(l[P].w-l[P].y)*(S-.5),f.push(y,Wn.rX?1-x:x),E=C*Math.cos(A)-S*Math.sin(A),S=C*Math.sin(A)+S*Math.cos(A),C=E,c&&m.push(c[P].r,c[P].g,c[P].b,c[P].a);for(R=0;R<e-2;R++)p.push(T[0+v],T[R+2+v],T[R+1+v]);v+=e}else{for(R=0;R<a.vertex.length;R++)_.push(a.vertex[R][0]*r,a.vertex[R][1]*n,a.vertex[R][2]*o),f.push(0,Wn.rX?1:0);for(P=0;P<h;P++)for(R=0;R<a.face[P].length-2;R++)p.push(a.face[P][0],a.face[P][R+2],a.face[P][R+1])}Hn.P.ComputeNormals(_,p,g),Hn.P._ComputeSides(d,_,p,g,f,e.frontUVs,e.backUVs);const I=new Hn.P;return I.positions=_,I.indices=p,I.normals=g,I.uvs=f,c&&u&&(I.colors=m),I}function Go(e,t={},i=null){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,Vo(t).applyToMesh(s,t.updatable),s}function zo(e){const t=e.sideOrientation||Hn.P.DEFAULTSIDE,i=e.radius||1,s=void 0===e.flat||e.flat,r=0|(e.subdivisions||4),n=e.radiusX||i,o=e.radiusY||i,a=e.radiusZ||i,h=(1+Math.sqrt(5))/2,l=[-1,h,-0,1,h,0,-1,-h,0,1,-h,0,0,-1,-h,0,1,-h,0,-1,h,0,1,h,h,0,1,h,0,-1,-h,0,1,-h,0,-1],c=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],u=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],d=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],_=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],p=[],g=[],f=[],m=[];let b=0;const v=new Array(3),T=new Array(3);let y;for(y=0;y<3;y++)v[y]=gt.Pq.Zero(),T[y]=gt.I9.Zero();for(let e=0;e<20;e++){for(y=0;y<3;y++){const t=c[3*e+y];v[y].copyFromFloats(l[3*u[t]],l[3*u[t]+1],l[3*u[t]+2]),v[y].normalize(),T[y].copyFromFloats(.134765625*d[2*t]+.05859375+-.0390625*_[e],.2333984375*d[2*t+1]+.025390625+.01953125*_[e])}const t=(e,t,i,h)=>{const l=gt.Pq.Lerp(v[0],v[2],t/r),c=gt.Pq.Lerp(v[1],v[2],t/r),u=r===t?v[2]:gt.Pq.Lerp(l,c,e/(r-t));let d;if(u.normalize(),s){const e=gt.Pq.Lerp(v[0],v[2],h/r),t=gt.Pq.Lerp(v[1],v[2],h/r);d=gt.Pq.Lerp(e,t,i/(r-h))}else d=new gt.Pq(u.x,u.y,u.z);d.x/=n,d.y/=o,d.z/=a,d.normalize();const _=gt.I9.Lerp(T[0],T[2],t/r),y=gt.I9.Lerp(T[1],T[2],t/r),x=r===t?T[2]:gt.I9.Lerp(_,y,e/(r-t));g.push(u.x*n,u.y*o,u.z*a),f.push(d.x,d.y,d.z),m.push(x.x,Wn.rX?1-x.y:x.y),p.push(b),b++};for(let e=0;e<r;e++)for(let i=0;i+e<r;i++)t(i,e,i+1/3,e+1/3),t(i+1,e,i+1/3,e+1/3),t(i,e+1,i+1/3,e+1/3),i+e+1<r&&(t(i+1,e,i+2/3,e+2/3),t(i+1,e+1,i+2/3,e+2/3),t(i,e+1,i+2/3,e+2/3))}Hn.P._ComputeSides(t,g,p,f,m,e.frontUVs,e.backUVs);const x=new Hn.P;return x.indices=p,x.positions=g,x.normals=f,x.uvs=m,x}function Ho(e,t={},i=null){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,zo(t).applyToMesh(s,t.updatable),s}Hn.P.CreatePolygon=Mo,zn.e.CreatePolygon=(e,t,i,s,r,n,o=earcut)=>wo(e,{shape:t,holes:s,updatable:r,sideOrientation:n},i,o),zn.e.ExtrudePolygon=(e,t,i,s,r,n,o,a=earcut)=>Oo(e,{shape:t,holes:r,depth:i,updatable:n,sideOrientation:o},s,a),zn.e.ExtrudeShape=(e,t,i,s,r,n,o=null,a,h,l)=>Bo(e,{shape:t,path:i,scale:s,rotation:r,cap:0===n?0:n||zn.e.NO_CAP,sideOrientation:h,instance:l,updatable:a},o),zn.e.ExtrudeShapeCustom=(e,t,i,s,r,n,o,a,h,l,c,u)=>Do(e,{shape:t,path:i,scaleFunction:s,rotationFunction:r,ribbonCloseArray:n,ribbonClosePath:o,cap:0===a?0:a||zn.e.NO_CAP,sideOrientation:c,instance:u,updatable:l},h),zn.e.CreateLathe=(e,t,i,s,r,n,o)=>Lo(e,{shape:t,radius:i,tessellation:s,sideOrientation:o,updatable:n},r),Hn.P.CreatePlane=No,zn.e.CreatePlane=(e,t,i,s,r)=>ko(e,{size:t,width:t,height:t,sideOrientation:r,updatable:s},i),zn.e.CreateTube=(e,t,i,s,r,n,o,a,h,l)=>Uo(e,{path:t,radius:i,tessellation:s,radiusFunction:r,arc:1,cap:n,updatable:a,sideOrientation:h,instance:l},o),Hn.P.CreatePolyhedron=Vo,zn.e.CreatePolyhedron=(e,t,i)=>Go(e,t,i),Hn.P.CreateIcoSphere=zo,zn.e.CreateIcoSphere=(e,t,i)=>Ho(e,t,i);var Wo=o(8857);const Xo=new gt.Pq(1,0,0),qo=new gt.Pq(-1,0,0),Qo=new gt.Pq(0,1,0),Ko=new gt.Pq(0,-1,0),Yo=new gt.Pq(0,0,1),jo=new gt.Pq(0,0,-1);class Zo{constructor(e=gt.Pq.Zero(),t=gt.Pq.Up(),i=gt.I9.Zero(),s=0,r=0,n=null,o=null,a=null,h=null){this.position=e,this.normal=t,this.uv=i,this.vertexIdx=s,this.vertexIdxForBones=r,this.localPositionOverride=n,this.localNormalOverride=o,this.matrixIndicesOverride=a,this.matrixWeightsOverride=h}clone(){return new Zo(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,this.localPositionOverride?.slice(),this.localNormalOverride?.slice(),this.matrixIndicesOverride?.slice(),this.matrixWeightsOverride?.slice())}}function $o(e,t,i){const s=!!t.skeleton,r=i.localMode||s,n=t.getIndices(),o=s?t.getPositionData(!0,!0):t.getVerticesData(Mt.R.PositionKind),a=s?t.getNormalsData(!0,!0):t.getVerticesData(Mt.R.NormalKind),h=r?s?t.getVerticesData(Mt.R.PositionKind):o:null,l=r?s?t.getVerticesData(Mt.R.NormalKind):a:null,c=t.getVerticesData(Mt.R.UVKind),u=s?t.getVerticesData(Mt.R.MatricesIndicesKind):null,d=s?t.getVerticesData(Mt.R.MatricesWeightsKind):null,_=s?t.getVerticesData(Mt.R.MatricesIndicesExtraKind):null,p=s?t.getVerticesData(Mt.R.MatricesWeightsExtraKind):null,g=i.position||gt.Pq.Zero();let f=i.normal||gt.Pq.Up();const m=i.size||gt.Pq.One(),b=i.angle||0;if(!f){const e=new gt.Pq(0,0,1),i=t.getScene().activeCamera,s=gt.Pq.TransformCoordinates(e,i.getWorldMatrix());f=i.globalPosition.subtract(s)}const v=-Math.atan2(f.z,f.x)-Math.PI/2,T=Math.sqrt(f.x*f.x+f.z*f.z),y=Math.atan2(f.y,T),x=new Hn.P;x.indices=[],x.positions=[],x.normals=[],x.uvs=[],x.matricesIndices=s?[]:null,x.matricesWeights=s?[]:null,x.matricesIndicesExtra=_?[]:null,x.matricesWeightsExtra=p?[]:null;let A=0;const C=(e,t)=>{const s=new Zo;if(!n||!o||!a)return s;const r=n[e];if(s.vertexIdx=3*r,s.vertexIdxForBones=4*r,s.position=new gt.Pq(o[3*r],o[3*r+1],o[3*r+2]),gt.Pq.TransformCoordinatesToRef(s.position,t,s.position),s.normal=new gt.Pq(a[3*r],a[3*r+1],a[3*r+2]),gt.Pq.TransformNormalToRef(s.normal,t,s.normal),i.captureUVS&&c){const e=c[2*r+1];s.uv=new gt.I9(c[2*r],Wn.rX?1-e:e)}return s},S=[0,0,0,0],E=(e,t)=>{if(0===e.length)return e;const i=.5*Math.abs(gt.Pq.Dot(m,t)),s=(e,t,i,s)=>{for(let r=0;r<s;++r)if(e[i+r]===t)return i+r;return-1},r=(e,r)=>{const n=gt.Pq.GetClipFactor(e.position,r.position,t,i);let o=S,a=S;if(u&&d){const t=e.matrixIndicesOverride?0:e.vertexIdxForBones,i=e.matrixIndicesOverride??u,h=e.matrixWeightsOverride??d,l=r.matrixIndicesOverride?0:r.vertexIdxForBones,c=r.matrixIndicesOverride??u,_=r.matrixWeightsOverride??d;o=[0,0,0,0],a=[0,0,0,0];let p=0;for(let e=0;e<4;++e)if(h[t+e]>0){const r=s(c,i[t+e],l,4);o[p]=i[t+e],a[p]=(0,Wo.Lerp)(h[t+e],r>=0?_[r]:0,n),p++}for(let e=0;e<4&&p<4;++e){const r=c[l+e];-1===s(i,r,t,4)&&(o[p]=r,a[p]=(0,Wo.Lerp)(0,_[l+e],n),p++)}const g=a[0]+a[1]+a[2]+a[3];a[0]/=g,a[1]/=g,a[2]/=g,a[3]/=g}const c=e.localPositionOverride?e.localPositionOverride[0]:h?.[e.vertexIdx]??0,_=e.localPositionOverride?e.localPositionOverride[1]:h?.[e.vertexIdx+1]??0,p=e.localPositionOverride?e.localPositionOverride[2]:h?.[e.vertexIdx+2]??0,g=r.localPositionOverride?r.localPositionOverride[0]:h?.[r.vertexIdx]??0,f=r.localPositionOverride?r.localPositionOverride[1]:h?.[r.vertexIdx+1]??0,m=r.localPositionOverride?r.localPositionOverride[2]:h?.[r.vertexIdx+2]??0,b=e.localNormalOverride?e.localNormalOverride[0]:l?.[e.vertexIdx]??0,v=e.localNormalOverride?e.localNormalOverride[1]:l?.[e.vertexIdx+1]??0,T=e.localNormalOverride?e.localNormalOverride[2]:l?.[e.vertexIdx+2]??0,y=b+((r.localNormalOverride?r.localNormalOverride[0]:l?.[r.vertexIdx]??0)-b)*n,x=v+((r.localNormalOverride?r.localNormalOverride[1]:l?.[r.vertexIdx+1]??0)-v)*n,A=T+((r.localNormalOverride?r.localNormalOverride[2]:l?.[r.vertexIdx+2]??0)-T)*n,C=Math.sqrt(y*y+x*x+A*A);return new Zo(gt.Pq.Lerp(e.position,r.position,n),gt.Pq.Lerp(e.normal,r.normal,n).normalize(),gt.I9.Lerp(e.uv,r.uv,n),-1,-1,h?[c+(g-c)*n,_+(f-_)*n,p+(m-p)*n]:null,l?[y/C,x/C,A/C]:null,o,a)};let n=null;e.length>3&&(n=[]);for(let s=0;s<e.length;s+=3){let o=0,a=null,h=null,l=null,c=null;const u=gt.Pq.Dot(e[s].position,t)-i>0,d=gt.Pq.Dot(e[s+1].position,t)-i>0,_=gt.Pq.Dot(e[s+2].position,t)-i>0;switch(o=(u?1:0)+(d?1:0)+(_?1:0),o){case 0:e.length>3?(n.push(e[s]),n.push(e[s+1]),n.push(e[s+2])):n=e;break;case 1:if(n=n??new Array,u&&(a=e[s+1],h=e[s+2],l=r(e[s],a),c=r(e[s],h)),d){a=e[s],h=e[s+2],l=r(e[s+1],a),c=r(e[s+1],h),n.push(l),n.push(h.clone()),n.push(a.clone()),n.push(h.clone()),n.push(l.clone()),n.push(c);break}_&&(a=e[s],h=e[s+1],l=r(e[s+2],a),c=r(e[s+2],h)),a&&h&&l&&c&&(n.push(a.clone()),n.push(h.clone()),n.push(l),n.push(c),n.push(l.clone()),n.push(h.clone()));break;case 2:n=n??new Array,u||(a=e[s].clone(),h=r(a,e[s+1]),l=r(a,e[s+2]),n.push(a),n.push(h),n.push(l)),d||(a=e[s+1].clone(),h=r(a,e[s+2]),l=r(a,e[s]),n.push(a),n.push(h),n.push(l)),_||(a=e[s+2].clone(),h=r(a,e[s]),l=r(a,e[s+1]),n.push(a),n.push(h),n.push(l))}}return n},R=t instanceof zn.e?t:null,P=R?._thinInstanceDataStorage.matrixData,I=R?.thinInstanceCount||1,M=gt.AA.Matrix[0];M.copyFrom(gt.uq.IdentityReadOnly);for(let e=0;e<I;++e){if(R?.hasThinInstances&&P){const t=16*e;M.setRowFromFloats(0,P[t+0],P[t+1],P[t+2],P[t+3]),M.setRowFromFloats(1,P[t+4],P[t+5],P[t+6],P[t+7]),M.setRowFromFloats(2,P[t+8],P[t+9],P[t+10],P[t+11]),M.setRowFromFloats(3,P[t+12],P[t+13],P[t+14],P[t+15])}const s=gt.uq.RotationYawPitchRoll(v,y,b).multiply(gt.uq.Translation(g.x,g.y,g.z)),o=gt.uq.Invert(s),a=t.getWorldMatrix(),c=M.multiply(a).multiply(o),f=new Array(3);for(let e=0;e<n.length;e+=3){let t=f;if(t[0]=C(e,c),t[1]=C(e+1,c),t[2]=C(e+2,c),!(i.cullBackFaces&&-t[0].normal.z<=0&&-t[1].normal.z<=0&&-t[2].normal.z<=0)&&(t=E(t,Xo),t&&(t=E(t,qo),t&&(t=E(t,Qo),t&&(t=E(t,Ko),t&&(t=E(t,Yo),t&&(t=E(t,jo),t)))))))for(let e=0;e<t.length;e++){const s=t[e];if(x.indices.push(A),r?(s.localPositionOverride?(x.positions[3*A]=s.localPositionOverride[0],x.positions[3*A+1]=s.localPositionOverride[1],x.positions[3*A+2]=s.localPositionOverride[2]):h&&(x.positions[3*A]=h[s.vertexIdx],x.positions[3*A+1]=h[s.vertexIdx+1],x.positions[3*A+2]=h[s.vertexIdx+2]),s.localNormalOverride?(x.normals[3*A]=s.localNormalOverride[0],x.normals[3*A+1]=s.localNormalOverride[1],x.normals[3*A+2]=s.localNormalOverride[2]):l&&(x.normals[3*A]=l[s.vertexIdx],x.normals[3*A+1]=l[s.vertexIdx+1],x.normals[3*A+2]=l[s.vertexIdx+2])):(s.position.toArray(x.positions,3*A),s.normal.toArray(x.normals,3*A)),x.matricesIndices&&x.matricesWeights&&(s.matrixIndicesOverride?(x.matricesIndices[4*A]=s.matrixIndicesOverride[0],x.matricesIndices[4*A+1]=s.matrixIndicesOverride[1],x.matricesIndices[4*A+2]=s.matrixIndicesOverride[2],x.matricesIndices[4*A+3]=s.matrixIndicesOverride[3]):(u&&(x.matricesIndices[4*A]=u[s.vertexIdxForBones],x.matricesIndices[4*A+1]=u[s.vertexIdxForBones+1],x.matricesIndices[4*A+2]=u[s.vertexIdxForBones+2],x.matricesIndices[4*A+3]=u[s.vertexIdxForBones+3]),_&&x.matricesIndicesExtra&&(x.matricesIndicesExtra[4*A]=_[s.vertexIdxForBones],x.matricesIndicesExtra[4*A+1]=_[s.vertexIdxForBones+1],x.matricesIndicesExtra[4*A+2]=_[s.vertexIdxForBones+2],x.matricesIndicesExtra[4*A+3]=_[s.vertexIdxForBones+3])),s.matrixWeightsOverride?(x.matricesWeights[4*A]=s.matrixWeightsOverride[0],x.matricesWeights[4*A+1]=s.matrixWeightsOverride[1],x.matricesWeights[4*A+2]=s.matrixWeightsOverride[2],x.matricesWeights[4*A+3]=s.matrixWeightsOverride[3]):(d&&(x.matricesWeights[4*A]=d[s.vertexIdxForBones],x.matricesWeights[4*A+1]=d[s.vertexIdxForBones+1],x.matricesWeights[4*A+2]=d[s.vertexIdxForBones+2],x.matricesWeights[4*A+3]=d[s.vertexIdxForBones+3]),p&&x.matricesWeightsExtra&&(x.matricesWeightsExtra[4*A]=p[s.vertexIdxForBones],x.matricesWeightsExtra[4*A+1]=p[s.vertexIdxForBones+1],x.matricesWeightsExtra[4*A+2]=p[s.vertexIdxForBones+2],x.matricesWeightsExtra[4*A+3]=p[s.vertexIdxForBones+3]))),i.captureUVS)s.uv.toArray(x.uvs,2*A);else{x.uvs.push(.5+s.position.x/m.x);const e=.5+s.position.y/m.y;x.uvs.push(Wn.rX?1-e:e)}A++}}}0===x.indices.length&&(x.indices=null),0===x.positions.length&&(x.positions=null),0===x.normals.length&&(x.normals=null),0===x.uvs.length&&(x.uvs=null),0===x.matricesIndices?.length&&(x.matricesIndices=null),0===x.matricesWeights?.length&&(x.matricesWeights=null),0===x.matricesIndicesExtra?.length&&(x.matricesIndicesExtra=null),0===x.matricesWeightsExtra?.length&&(x.matricesWeightsExtra=null);const w=new zn.e(e,t.getScene());return x.applyToMesh(w),r?(w.skeleton=t.skeleton,w.parent=t):(w.position=g.clone(),w.rotation=new gt.Pq(y,v,b)),w.computeWorldMatrix(!0),w.refreshBoundingInfo(!0,!0),w}function Jo(e={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){const t=0|Math.max(e.subdivisions?e.subdivisions:2,1),i=0|Math.max(e.tessellation?e.tessellation:16,3),s=Math.max(e.height?e.height:1,0),r=Math.max(e.radius?e.radius:.25,0),n=0|Math.max(e.capSubdivisions?e.capSubdivisions:6,1),o=i,a=t,h=Math.max(e.radiusTop?e.radiusTop:r,0),l=Math.max(e.radiusBottom?e.radiusBottom:r,0),c=s-(h+l),u=2*Math.PI,d=Math.max(e.topCapSubdivisions?e.topCapSubdivisions:n,1),_=Math.max(e.bottomCapSubdivisions?e.bottomCapSubdivisions:n,1),p=Math.acos((l-h)/s);let g=[];const f=[],m=[],b=[];let v=0;const T=[],y=.5*c,x=.5*Math.PI;let A,C;const S=gt.Pq.Zero(),E=gt.Pq.Zero(),R=Math.cos(p),P=Math.sin(p),I=new gt.I9(h*P,y+h*R).subtract(new gt.I9(l*P,l*R-y)).length(),M=h*p+I+l*(x-p);let w=0;for(C=0;C<=d;C++){const e=[],t=x-p*(C/d);w+=h*p/d;const i=Math.cos(t),s=Math.sin(t),r=i*h;for(A=0;A<=o;A++){const t=A/o,n=t*u+0,a=Math.sin(n),l=Math.cos(n);E.x=r*a,E.y=y+s*h,E.z=r*l,f.push(E.x,E.y,E.z),S.set(i*a,s,i*l),m.push(S.x,S.y,S.z),b.push(t,Wn.rX?w/M:1-w/M),e.push(v),v++}T.push(e)}const O=s-h-l+R*h-R*l,B=P*(l-h)/O;for(C=1;C<=a;C++){const e=[];w+=I/a;const t=P*(C*(l-h)/a+h);for(A=0;A<=o;A++){const i=A/o,s=i*u+0,r=Math.sin(s),n=Math.cos(s);E.x=t*r,E.y=y+R*h-C*O/a,E.z=t*n,f.push(E.x,E.y,E.z),S.set(r,B,n).normalize(),m.push(S.x,S.y,S.z),b.push(i,Wn.rX?w/M:1-w/M),e.push(v),v++}T.push(e)}for(C=1;C<=_;C++){const e=[],t=x-p-(Math.PI-p)*(C/_);w+=l*p/_;const i=Math.cos(t),s=Math.sin(t),r=i*l;for(A=0;A<=o;A++){const t=A/o,n=t*u+0,a=Math.sin(n),h=Math.cos(n);E.x=r*a,E.y=s*l-y,E.z=r*h,f.push(E.x,E.y,E.z),S.set(i*a,s,i*h),m.push(S.x,S.y,S.z),b.push(t,Wn.rX?w/M:1-w/M),e.push(v),v++}T.push(e)}for(A=0;A<o;A++)for(C=0;C<d+a+_;C++){const e=T[C][A],t=T[C+1][A],i=T[C+1][A+1],s=T[C][A+1];g.push(e),g.push(t),g.push(s),g.push(t),g.push(i),g.push(s)}if(g=g.reverse(),e.orientation&&!e.orientation.equals(gt.Pq.Up())){const t=new gt.uq;e.orientation.clone().scale(.5*Math.PI).cross(gt.Pq.Up()).toQuaternion().toRotationMatrix(t);const i=gt.Pq.Zero();for(let e=0;e<f.length;e+=3)i.set(f[e],f[e+1],f[e+2]),gt.Pq.TransformCoordinatesToRef(i.clone(),t,i),f[e]=i.x,f[e+1]=i.y,f[e+2]=i.z}const D=new Hn.P;return D.positions=f,D.normals=m,D.uvs=b,D.indices=g,D}function ea(e,t={orientation:gt.Pq.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},i=null){const s=new zn.e(e,i);return Jo(t).applyToMesh(s,t.updatable),s}zn.e.CreateDecal=(e,t,i,s,r,n)=>$o(e,t,{position:i,normal:s,size:r,angle:n}),zn.e.CreateCapsule=(e,t,i)=>ea(e,t,i),Hn.P.CreateCapsule=Jo;class ta{constructor(e=0,t=0){this.x=e,this.y=t,e!==Math.floor(e)&&(e=Math.floor(e),It.V.Warn("x is not an integer, floor(x) used")),t!==Math.floor(t)&&(t=Math.floor(t),It.V.Warn("y is not an integer, floor(y) used"))}clone(){return new ta(this.x,this.y)}rotate60About(e){const t=this.x;return this.x=e.x+e.y-this.y,this.y=t+this.y-e.x,this}rotateNeg60About(e){const t=this.x;return this.x=t+this.y-e.y,this.y=e.x+e.y-t,this}rotate120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),It.V.Warn("m not an integer only floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),It.V.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=e-i-this.y,this.y=t+i,this}rotateNeg120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),It.V.Warn("m is not an integer, floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),It.V.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-t,this.y=e+t-i-this.y,this}toCartesianOrigin(e,t){const i=gt.Pq.Zero();return i.x=e.x+2*this.x*t+this.y*t,i.y=e.y+Math.sqrt(3)*this.y*t,i}static Zero(){return new ta(0,0)}}class ia{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new sa("icosahedron","Regular",[[0,bs.a6,-1],[-bs.a6,1,0],[-1,0,-bs.a6],[1,0,-bs.a6],[bs.a6,1,0],[0,bs.a6,1],[-1,0,bs.a6],[-bs.a6,-1,0],[0,-bs.a6,-1],[bs.a6,-1,0],[1,0,bs.a6],[0,-bs.a6,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let e=12;const t={},i=this.m,s=this.n;let r,n,o,a,h,l=i,c=1,u=0;0!==s&&(l=(0,Wo.HighestCommonFactor)(i,s)),c=i/l,u=s/l;const d=ta.Zero(),_=new ta(i,s),p=new ta(-s,i+s),g=ta.Zero(),f=ta.Zero(),m=ta.Zero();let b,v,T,y,x=[];const A=[],C=this.vertByDist,S=(i,s,r,n)=>{b=i+"|"+r,v=s+"|"+n,b in t||v in t?b in t&&!(v in t)?t[v]=t[b]:v in t&&!(b in t)&&(t[b]=t[v]):(t[b]=e,t[v]=e,e++),C[r][0]>2?A[t[b]]=[-C[r][0],C[r][1],t[b]]:A[t[b]]=[x[C[r][0]],C[r][1],t[b]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let v=0;v<20;v++){if(x=this.IDATA.face[v],o=x[2],a=x[1],h=x[0],T=d.x+"|"+d.y,b=v+"|"+T,b in t||(t[b]=o,A[o]=[x[C[T][0]],C[T][1]]),T=_.x+"|"+_.y,b=v+"|"+T,b in t||(t[b]=a,A[a]=[x[C[T][0]],C[T][1]]),T=p.x+"|"+p.y,b=v+"|"+T,b in t||(t[b]=h,A[h]=[x[C[T][0]],C[T][1]]),r=this.IDATA.edgematch[v][0],n=this.IDATA.edgematch[v][1],"B"===n)for(let e=1;e<l;e++)f.x=i-e*(c+u),f.y=s+e*c,m.x=-e*u,m.y=e*(c+u),T=f.x+"|"+f.y,y=m.x+"|"+m.y,S(v,r,T,y);if("O"===n)for(let e=1;e<l;e++)m.x=-e*u,m.y=e*(c+u),g.x=e*c,g.y=e*u,T=m.x+"|"+m.y,y=g.x+"|"+g.y,S(v,r,T,y);if(r=this.IDATA.edgematch[v][2],n=this.IDATA.edgematch[v][3],n&&"A"===n)for(let e=1;e<l;e++)g.x=e*c,g.y=e*u,f.x=i-(l-e)*(c+u),f.y=s+(l-e)*c,T=g.x+"|"+g.y,y=f.x+"|"+f.y,S(v,r,T,y);for(let i=0;i<this.vertices.length;i++)T=this.vertices[i].x+"|"+this.vertices[i].y,b=v+"|"+T,b in t||(t[b]=e++,C[T][0]>2?A[t[b]]=[-C[T][0],C[T][1],t[b]]:A[t[b]]=[x[C[T][0]],C[T][1],t[b]])}this.closestTo=A,this.vecToidx=t}calcCoeffs(){const e=this.m,t=this.n,i=Math.sqrt(3)/3,s=e*e+t*t+e*t;this.coau=(e+t)/s,this.cobu=-t/s,this.coav=-i*(e-t)/s,this.cobv=i*(2*e+t)/s}createInnerFacets(){const e=this.m,t=this.n;for(let i=0;i<t+e+1;i++)for(let e=this.min[i];e<this.max[i]+1;e++)e<this.max[i]&&e<this.max[i+1]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+e+"|"+(i+1),"|"+(e+1)+"|"+i]),i>0&&e<this.max[i-1]&&e+1<this.max[i]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+(e+1)+"|"+i,"|"+(e+1)+"|"+(i-1)])}edgeVecsABOB(){const e=this.m,t=this.n,i=new ta(-t,e+t);for(let s=1;s<e+t;s++){const e=new ta(this.min[s],s),t=new ta(this.min[s-1],s-1),r=new ta(this.min[s+1],s+1),n=e.clone(),o=t.clone(),a=r.clone();n.rotate60About(i),o.rotate60About(i),a.rotate60About(i);const h=new ta(this.max[n.y],n.y),l=new ta(this.max[n.y-1],n.y-1),c=new ta(this.max[n.y-1]-1,n.y-1);n.x===h.x&&n.y===h.y||(n.x!==l.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,l,c]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,c,h])):n.y===a.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,l]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([e,l,r])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,l]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,l,h])))}}mapABOBtoOBOA(){const e=new ta(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let s=0;s<3;s++)e.x=this.isoVecsABOB[t][s].x,e.y=this.isoVecsABOB[t][s].y,0===this.vertexTypes[t][s]&&e.rotateNeg120(this.m,this.n),i.push(e.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const e=new ta(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let s=0;s<3;s++)e.x=this.isoVecsABOB[t][s].x,e.y=this.isoVecsABOB[t][s].y,1===this.vertexTypes[t][s]&&e.rotate120(this.m,this.n),i.push(e.clone());this.isoVecsBAOA.push(i)}}MapToFace(e,t){const i=this.IDATA.face[e],s=i[2],r=i[1],n=i[0],o=gt.Pq.FromArray(this.IDATA.vertex[s]),a=gt.Pq.FromArray(this.IDATA.vertex[r]),h=gt.Pq.FromArray(this.IDATA.vertex[n]),l=a.subtract(o),c=h.subtract(o),u=l.scale(this.coau).add(c.scale(this.cobu)),d=l.scale(this.coav).add(c.scale(this.cobv)),_=[];let p,g=gt.AA.Vector3[0];for(let i=0;i<this.cartesian.length;i++)g=u.scale(this.cartesian[i].x).add(d.scale(this.cartesian[i].y)).add(o),_[i]=[g.x,g.y,g.z],p=e+"|"+this.vertices[i].x+"|"+this.vertices[i].y,t.vertex[this.vecToidx[p]]=[g.x,g.y,g.z]}build(e,t){const i=[],s=ta.Zero(),r=new ta(e,t),n=new ta(-t,e+t);i.push(s,r,n);for(let s=t;s<e+1;s++)for(let t=0;t<e+1-s;t++)i.push(new ta(t,s));if(t>0){const s=(0,Wo.HighestCommonFactor)(e,t),r=e/s,n=t/s;for(let o=1;o<s;o++)i.push(new ta(o*r,o*n)),i.push(new ta(-o*n,o*(r+n))),i.push(new ta(e-o*(r+n),t+o*r));const o=e/t;for(let s=1;s<t;s++)for(let r=0;r<s*o;r++)i.push(new ta(r,s)),i.push(new ta(r,s).rotate120(e,t)),i.push(new ta(r,s).rotateNeg120(e,t))}i.sort(((e,t)=>e.x-t.x)),i.sort(((e,t)=>e.y-t.y));const o=new Array(e+t+1),a=new Array(e+t+1);for(let e=0;e<o.length;e++)o[e]=1/0,a[e]=-1/0;let h=0,l=0;const c=i.length;for(let e=0;e<c;e++)l=i[e].x,h=i[e].y,o[h]=Math.min(l,o[h]),a[h]=Math.max(l,a[h]);const u=(i,s)=>{const r=i.clone();return"A"===s&&r.rotateNeg120(e,t),"B"===s&&r.rotate120(e,t),r.x<0?r.y:r.x+r.y},d=[],_=[],p=[],g=[],f={},m=[];let b=-1,v=-1;for(let e=0;e<c;e++)d[e]=i[e].toCartesianOrigin(new ta(0,0),.5),_[e]=u(i[e],"O"),p[e]=u(i[e],"A"),g[e]=u(i[e],"B"),_[e]===p[e]&&p[e]===g[e]?(b=3,v=_[e]):_[e]===p[e]?(b=4,v=_[e]):p[e]===g[e]?(b=5,v=p[e]):g[e]===_[e]&&(b=6,v=_[e]),_[e]<p[e]&&_[e]<g[e]&&(b=2,v=_[e]),p[e]<_[e]&&p[e]<g[e]&&(b=1,v=p[e]),g[e]<p[e]&&g[e]<_[e]&&(b=0,v=g[e]),m.push([b,v,i[e].x,i[e].y]);m.sort(((e,t)=>e[2]-t[2])),m.sort(((e,t)=>e[3]-t[3])),m.sort(((e,t)=>e[1]-t[1])),m.sort(((e,t)=>e[0]-t[0]));for(let e=0;e<m.length;e++)f[m[e][2]+"|"+m[e][3]]=[m[e][0],m[e][1],e];return this.m=e,this.n=t,this.vertices=i,this.vertByDist=f,this.cartesian=d,this.min=o,this.max=a,this}}class sa{constructor(e,t,i,s){this.name=e,this.category=t,this.vertex=i,this.face=s}}class ra extends sa{innerToData(e,t){for(let i=0;i<t.innerFacets.length;i++)this.face.push(t.innerFacets[i].map((i=>t.vecToidx[e+i])))}mapABOBtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let s=0;s<t.isoVecsABOB.length;s++){const r=[];for(let n=0;n<3;n++)0===t.vertexTypes[s][n]?r.push(e+"|"+t.isoVecsABOB[s][n].x+"|"+t.isoVecsABOB[s][n].y):r.push(i+"|"+t.isoVecsABOB[s][n].x+"|"+t.isoVecsABOB[s][n].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}mapOBOAtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let s=0;s<t.isoVecsOBOA.length;s++){const r=[];for(let n=0;n<3;n++)1===t.vertexTypes[s][n]?r.push(e+"|"+t.isoVecsOBOA[s][n].x+"|"+t.isoVecsOBOA[s][n].y):r.push(i+"|"+t.isoVecsOBOA[s][n].x+"|"+t.isoVecsOBOA[s][n].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}mapBAOAtoDATA(e,t){const i=t.IDATA.edgematch[e][2];for(let s=0;s<t.isoVecsBAOA.length;s++){const r=[];for(let n=0;n<3;n++)1===t.vertexTypes[s][n]?r.push(e+"|"+t.isoVecsBAOA[s][n].x+"|"+t.isoVecsBAOA[s][n].y):r.push(i+"|"+t.isoVecsBAOA[s][n].x+"|"+t.isoVecsBAOA[s][n].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}orderData(e){const t=[];for(let e=0;e<13;e++)t[e]=[];const i=e.closestTo;for(let e=0;e<i.length;e++)i[e][0]>-1?i[e][1]>0&&t[i[e][0]].push([e,i[e][1]]):t[12].push([e,i[e][0]]);const s=[];for(let e=0;e<12;e++)s[e]=e;let r=12;for(let e=0;e<12;e++){t[e].sort(((e,t)=>e[1]-t[1]));for(let i=0;i<t[e].length;i++)s[t[e][i][0]]=r++}for(let e=0;e<t[12].length;e++)s[t[12][e][0]]=r++;for(let e=0;e<this.vertex.length;e++)this.vertex[e].push(s[e]);this.vertex.sort(((e,t)=>e[3]-t[3]));for(let e=0;e<this.vertex.length;e++)this.vertex[e].pop();for(let e=0;e<this.face.length;e++)for(let t=0;t<this.face[e].length;t++)this.face[e][t]=s[this.face[e][t]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(e,t){const i=[],s=[];let r=t.pop();s.push(r);let n=this.face[r].indexOf(e);n=(n+2)%3;let o=this.face[r][n];i.push(o);let a=0;for(;t.length>0;)r=t[a],this.face[r].indexOf(o)>-1?(n=(this.face[r].indexOf(o)+1)%3,o=this.face[r][n],i.push(o),s.push(r),t.splice(a,1),a=0):a++;return this.adjacentFaces.push(i),s}toGoldbergPolyhedronData(){const e=new sa("GeoDual","Goldberg",[],[]);e.name="GD dual";const t=this.vertex.length,i=new Array(t);for(let e=0;e<t;e++)i[e]=[];for(let e=0;e<this.face.length;e++)for(let t=0;t<3;t++)i[this.face[e][t]].push(e);let s=0,r=0,n=0,o=[],a=[];this.adjacentFaces=[];for(let t=0;t<i.length;t++)e.face[t]=this.setOrder(t,i[t].concat([])),i[t].forEach((t=>{s=0,r=0,n=0,o=this.face[t];for(let e=0;e<3;e++)a=this.vertex[o[e]],s+=a[0],r+=a[1],n+=a[2];e.vertex[t]=[s/3,r/3,n/3]}));return e}static BuildGeodesicData(e){const t=new ra("Geodesic-m-n","Geodesic",[[0,bs.a6,-1],[-bs.a6,1,0],[-1,0,-bs.a6],[1,0,-bs.a6],[bs.a6,1,0],[0,bs.a6,1],[-1,0,bs.a6],[-bs.a6,-1,0],[0,-bs.a6,-1],[bs.a6,-1,0],[1,0,bs.a6],[0,-bs.a6,1]],[]);e.setIndices(),e.calcCoeffs(),e.createInnerFacets(),e.edgeVecsABOB(),e.mapABOBtoOBOA(),e.mapABOBtoBAOA();for(let i=0;i<e.IDATA.face.length;i++)e.MapToFace(i,t),t.innerToData(i,e),"B"===e.IDATA.edgematch[i][1]&&t.mapABOBtoDATA(i,e),"O"===e.IDATA.edgematch[i][1]&&t.mapOBOAtoDATA(i,e),"A"===e.IDATA.edgematch[i][3]&&t.mapBAOAtoDATA(i,e);return t.orderData(e),t.vertex=t.vertex.map((function(e){const t=e[0],i=e[1],s=e[2],r=Math.sqrt(t*t+i*i+s*s);return e[0]*=1/r,e[1]*=1/r,e[2]*=1/r,e})),t}}zn.e._GoldbergMeshParser=(e,t)=>na.Parse(e,t);class na extends zn.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(e,t){return void 0===t?(e>this.goldbergData.nbUnsharedFaces-1&&(It.V.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(It.V.Warn("Last pole used"),e=11),t>this.goldbergData.nbFacesAtPole-1&&(It.V.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+t)}_changeGoldbergFaceColors(e){for(let t=0;t<e.length;t++){const i=e[t][0],s=e[t][1],r=e[t][2];for(let e=i;e<s+1;e++)this.goldbergData.faceColors[e]=r}const t=[];for(let e=0;e<12;e++)for(let i=0;i<5;i++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);for(let e=12;e<this.goldbergData.faceColors.length;e++)for(let i=0;i<6;i++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);return t}setGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.setVerticesData(Mt.R.ColorKind,t)}updateGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.updateVerticesData(Mt.R.ColorKind,t)}_changeGoldbergFaceUVs(e){const t=this.getVerticesData(Mt.R.UVKind);for(let i=0;i<e.length;i++){const s=e[i][0],r=e[i][1],n=e[i][2],o=e[i][3],a=e[i][4],h=[],l=[];let c,u;for(let e=0;e<5;e++)c=n.x+o*Math.cos(a+e*Math.PI/2.5),u=n.y+o*Math.sin(a+e*Math.PI/2.5),c<0&&(c=0),c>1&&(c=1),h.push(c,u);for(let e=0;e<6;e++)c=n.x+o*Math.cos(a+e*Math.PI/3),u=n.y+o*Math.sin(a+e*Math.PI/3),c<0&&(c=0),c>1&&(c=1),l.push(c,u);for(let e=s;e<Math.min(12,r+1);e++)for(let i=0;i<5;i++)t[10*e+2*i]=h[2*i],t[10*e+2*i+1]=h[2*i+1];for(let e=Math.max(12,s);e<r+1;e++)for(let i=0;i<6;i++)t[12*e-24+2*i]=l[2*i],t[12*e-23+2*i]=l[2*i+1]}return t}setGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.setVerticesData(Mt.R.UVKind,t)}updateGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.updateVerticesData(Mt.R.UVKind,t)}placeOnGoldbergFaceAt(e,t,i){const s=gt.Pq.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);e.rotation=s,e.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(i.x)).add(this.goldbergData.faceYaxis[t].scale(i.y)).add(this.goldbergData.faceZaxis[t].scale(i.z))}serialize(e){super.serialize(e),e.type="GoldbergMesh";const t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){t.faceColors=[];for(const e of this.goldbergData.faceColors)t.faceColors.push(e.asArray())}if(this.goldbergData.faceCenters){t.faceCenters=[];for(const e of this.goldbergData.faceCenters)t.faceCenters.push(e.asArray())}if(this.goldbergData.faceZaxis){t.faceZaxis=[];for(const e of this.goldbergData.faceZaxis)t.faceZaxis.push(e.asArray())}if(this.goldbergData.faceYaxis){t.faceYaxis=[];for(const e of this.goldbergData.faceYaxis)t.faceYaxis.push(e.asArray())}if(this.goldbergData.faceXaxis){t.faceXaxis=[];for(const e of this.goldbergData.faceXaxis)t.faceXaxis.push(e.asArray())}e.goldbergData=t}static Parse(e,t){const i=e.goldbergData;i.faceColors=i.faceColors.map((e=>bt.ov.FromArray(e))),i.faceCenters=i.faceCenters.map((e=>gt.Pq.FromArray(e))),i.faceZaxis=i.faceZaxis.map((e=>gt.Pq.FromArray(e))),i.faceXaxis=i.faceXaxis.map((e=>gt.Pq.FromArray(e))),i.faceYaxis=i.faceYaxis.map((e=>gt.Pq.FromArray(e)));const s=new na(e.name,t);return s.goldbergData=i,s}}class oa{constructor(e){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=e}moveTo(e,t){this._currentPath=new Eo.Cu(e,t),this._tempPaths.push(this._currentPath)}lineTo(e,t){this._currentPath.addLineTo(e,t)}quadraticCurveTo(e,t,i,s){this._currentPath.addQuadraticCurveTo(e,t,i,s,this._resolution)}bezierCurveTo(e,t,i,s,r,n){this._currentPath.addBezierCurveTo(e,t,i,s,r,n,this._resolution)}extractHoles(){for(const e of this._tempPaths)e.area()>0?this._holes.push(e):this._paths.push(e);if(!this._paths.length&&this._holes.length){const e=this._holes;this._holes=this._paths,this._paths=e}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function aa(e,t,i,s,r,n){const o=n.glyphs[e]||n.glyphs["?"];if(!o)return null;const a=new oa(r);if(o.o){const e=o.o.split(" ");for(let r=0,n=e.length;r<n;)switch(e[r++]){case"m":{const n=parseInt(e[r++])*t+i,o=parseInt(e[r++])*t+s;a.moveTo(n,o);break}case"l":{const n=parseInt(e[r++])*t+i,o=parseInt(e[r++])*t+s;a.lineTo(n,o);break}case"q":{const n=parseInt(e[r++])*t+i,o=parseInt(e[r++])*t+s,h=parseInt(e[r++])*t+i,l=parseInt(e[r++])*t+s;a.quadraticCurveTo(h,l,n,o);break}case"b":{const n=parseInt(e[r++])*t+i,o=parseInt(e[r++])*t+s,h=parseInt(e[r++])*t+i,l=parseInt(e[r++])*t+s,c=parseInt(e[r++])*t+i,u=parseInt(e[r++])*t+s;a.bezierCurveTo(h,l,c,u,n,o);break}}}return a.extractHoles(),{offsetX:o.ha*t,shapePath:a}}const ha={CreateBox:so,CreateTiledBox:function(e,t,i=null){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,no(t).applyToMesh(s,t.updatable),s},CreateSphere:ao,CreateDisc:Kn,CreateIcoSphere:Ho,CreateRibbon:qn,CreateCylinder:co,CreateTorus:_o,CreateTorusKnot:go,CreateLineSystem:Ao,CreateLines:Co,CreateDashedLines:So,ExtrudeShape:Bo,ExtrudeShapeCustom:Do,CreateLathe:Lo,CreateTiledPlane:function(e,t,i=null){const s=new zn.e(e,i);return t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,ro(t).applyToMesh(s,t.updatable),s},CreatePlane:ko,CreateGround:Jn,CreateTiledGround:eo,CreateGroundFromHeightMap:to,CreatePolygon:wo,ExtrudePolygon:Oo,CreateTube:Uo,CreatePolyhedron:Go,CreateGeodesic:function(e,t,i=null){let s=t.m||1;s!==Math.floor(s)&&(s=Math.floor(s),It.V.Warn("m not an integer only floor(m) used"));let r=t.n||0;if(r!==Math.floor(r)&&(r=Math.floor(r),It.V.Warn("n not an integer only floor(n) used")),r>s){const e=r;r=s,s=e,It.V.Warn("n > m therefore m and n swapped")}const n=new ia;return n.build(s,r),Go(e,{custom:ra.BuildGeodesicData(n),size:t.size,sizeX:t.sizeX,sizeY:t.sizeY,sizeZ:t.sizeZ,faceUV:t.faceUV,faceColors:t.faceColors,flat:t.flat,updatable:t.updatable,sideOrientation:t.sideOrientation,frontUVs:t.frontUVs,backUVs:t.backUVs},i)},CreateGoldberg:function(e,t,i=null){const s=t.size,r=t.sizeX||s||1,n=t.sizeY||s||1,o=t.sizeZ||s||1;let a=t.m||1;a!==Math.floor(a)&&(a=Math.floor(a),It.V.Warn("m not an integer only floor(m) used"));let h=t.n||0;if(h!==Math.floor(h)&&(h=Math.floor(h),It.V.Warn("n not an integer only floor(n) used")),h>a){const e=h;h=a,a=e,It.V.Warn("n > m therefore m and n swapped")}const l=new ia;l.build(a,h);const c=ra.BuildGeodesicData(l),u=c.toGoldbergPolyhedronData(),d=new na(e,i);t.sideOrientation=zn.e._GetDefaultSideOrientation(t.sideOrientation),d._originalBuilderSideOrientation=t.sideOrientation;const _=function(e,t){const i=e.size,s=e.sizeX||i||1,r=e.sizeY||i||1,n=e.sizeZ||i||1,o=0===e.sideOrientation?0:e.sideOrientation||Hn.P.DEFAULTSIDE,a=[],h=[],l=[],c=[];let u=1/0,d=-1/0,_=1/0,p=-1/0;for(let e=0;e<t.vertex.length;e++)u=Math.min(u,t.vertex[e][0]*s),d=Math.max(d,t.vertex[e][0]*s),_=Math.min(_,t.vertex[e][1]*r),p=Math.max(p,t.vertex[e][1]*r);let g=0;for(let e=0;e<t.face.length;e++){const i=t.face[e],o=gt.Pq.FromArray(t.vertex[i[0]]),f=gt.Pq.FromArray(t.vertex[i[2]]),m=gt.Pq.FromArray(t.vertex[i[1]]),b=f.subtract(o),v=m.subtract(o),T=gt.Pq.Cross(v,b).normalize();for(let e=0;e<i.length;e++){l.push(T.x,T.y,T.z);const o=t.vertex[i[e]];a.push(o[0]*s,o[1]*r,o[2]*n);const h=(o[1]*r-_)/(p-_);c.push((o[0]*s-u)/(d-u),Wn.rX?1-h:h)}for(let e=0;e<i.length-2;e++)h.push(g,g+e+2,g+e+1);g+=i.length}Hn.P._ComputeSides(o,a,h,l,c);const f=new Hn.P;return f.positions=a,f.indices=h,f.normals=l,f.uvs=c,f}(t,u);_.applyToMesh(d,t.updatable),d.goldbergData.nbSharedFaces=c.sharedNodes,d.goldbergData.nbUnsharedFaces=c.poleNodes,d.goldbergData.adjacentFaces=c.adjacentFaces,d.goldbergData.nbFaces=d.goldbergData.nbSharedFaces+d.goldbergData.nbUnsharedFaces,d.goldbergData.nbFacesAtPole=(d.goldbergData.nbUnsharedFaces-12)/12;for(let e=0;e<c.vertex.length;e++)d.goldbergData.faceCenters.push(gt.Pq.FromArray(c.vertex[e])),d.goldbergData.faceCenters[e].x*=r,d.goldbergData.faceCenters[e].y*=n,d.goldbergData.faceCenters[e].z*=o,d.goldbergData.faceColors.push(new bt.ov(1,1,1,1));for(let e=0;e<u.face.length;e++){const t=u.face[e],i=gt.Pq.FromArray(u.vertex[t[0]]),s=gt.Pq.FromArray(u.vertex[t[2]]),r=gt.Pq.FromArray(u.vertex[t[1]]),n=s.subtract(i),o=r.subtract(i),a=gt.Pq.Cross(o,n).normalize(),h=gt.Pq.Cross(o,a).normalize();d.goldbergData.faceXaxis.push(o.normalize()),d.goldbergData.faceYaxis.push(a),d.goldbergData.faceZaxis.push(h)}return d},CreateDecal:$o,CreateCapsule:ea,CreateText:function(e,t,i,s={size:50,resolution:8,depth:1},r=null,n=earcut){const o=function(e,t,i,s){const r=Array.from(e),n=t/s.resolution,o=(s.boundingBox.yMax-s.boundingBox.yMin+s.underlineThickness)*n,a=[];let h=0,l=0;for(let e=0;e<r.length;e++){const t=r[e];if("\n"===t)h=0,l-=o;else{const e=aa(t,n,h,l,i,s);e&&(h+=e.offsetX,a.push(e.shapePath))}}return a}(t,s.size||50,s.resolution||8,i),a=[];let h=0;for(const t of o){if(!t.paths.length)continue;const i=t.holes.slice();for(const o of t.paths){const t=[],l=[],c=o.getPoints();for(const e of c)l.push(new gt.Pq(e.x,0,e.y));const u=i.slice();for(const e of u){const s=e.getPoints();let r=!1;for(const e of s)if(o.isPointInside(e)){r=!0;break}if(!r)continue;const n=[];for(const e of s)n.push(new gt.Pq(e.x,0,e.y));t.push(n),i.splice(i.indexOf(e),1)}if(!t.length&&i.length)for(const e of i){const i=e.getPoints(),s=[];for(const e of i)s.push(new gt.Pq(e.x,0,e.y));t.push(s)}const d=Oo(e,{shape:l,holes:t.length?t:void 0,depth:s.depth||1,faceUV:s.faceUV||s.perLetterFaceUV?.(h),faceColors:s.faceColors||s.perLetterFaceColors?.(h),sideOrientation:zn.e._GetDefaultSideOrientation(s.sideOrientation||zn.e.DOUBLESIDE)},r,n);a.push(d),h++}}const l=zn.e.MergeMeshes(a,!0,!0);if(l){const t=l.getBoundingInfo().boundingBox;l.position.x+=-(t.minimumWorld.x+t.maximumWorld.x)/2,l.position.y+=-(t.minimumWorld.y+t.maximumWorld.y)/2,l.position.z+=-(t.minimumWorld.z+t.maximumWorld.z)/2+t.extendSize.z,l.name=e;const i=new Gn.V("pivot",r);i.rotation.x=-Math.PI/2,l.parent=i,l.bakeCurrentTransformIntoVertices(),l.parent=null,i.dispose()}return l}};class la extends Gn.V{constructor(e,t,i,s,r,n){super(e,t),this._chips=[],this._log=n,this._chipFactory=i,this._currencyFormatter=s;const o=this._dynamicTexture=new ns(`${e}-valueText`,{width:100,height:100},t,!0,Dt.g.TRILINEAR_SAMPLINGMODE,Me.N.TEXTUREFORMAT_RGBA);o.getContext().fillStyle="#FF00FF00",o.clear();const a=new ft.F(`${e}-valueText-material`,t);a.emissiveTexture=o,a.diffuseTexture=o,a.useAlphaFromDiffuseTexture=!0,a.disableLighting=!0,o.hasAlpha=!0,a.transparencyMode=3,this._baseTextScale=new gt.Pq(1,1,1);const h=this._textPlane=ha.CreatePlane(`${e}-valueText`,{width:.1,height:.1},t);h.billboardMode=Gn.V.BILLBOARDMODE_ALL,h.material=a,h.rotation.set(0,0,Math.PI),h.ignoreNonUniformScaling=!0,h.renderingGroupId=Tt.FieldText,h.isPickable=!1,h.layerMask=Ct.FieldText,h.isVisible=!1,this.addChild(h),this.compensateTextParentScale(this.scaling),this._chipValuesOrdered=r}getScale(){return this.scaling}set absolutePosition(e){this.setAbsolutePosition(e)}get absolutePosition(){return this.getAbsolutePosition()}setScale(e){this.scaling=new gt.Pq(e.x,e.y,e.z),this.compensateTextParentScale(this.scaling)}compensateTextParentScale(e){this._textPlane.computeWorldMatrix(!0);const t=this._textPlane.parent;t&&(t.computeWorldMatrix(!0),this._textPlane.scaling=gt.Pq.One().divide(t.absoluteScaling).multiply(this._baseTextScale).multiply(e))}setChips(e){this.clear(),this._textPlane.isVisible=e.size>0;let t=0;e.forEach(((e,i)=>{t+=e*i})),this.setValue(t)}setValue(e){let t=this._chipValuesOrdered[0];for(let i=this._chipValuesOrdered.length-1;i>=0;i--){const s=this._chipValuesOrdered[i];if(s<=e){t=s;break}}const i=this._chipFactory.getChipWithValue(t);this._chips.push({chip:i,value:t}),this.addChild(i),this._textPlane.setParent(i),this._textPlane.rotationQuaternion=gt.PT.FromEulerAngles(0,0,Math.PI),this._textPlane.position=gt.Pq.Zero(),i.mesh.isPickable=!0;const s=new gt.Pq(0,i.height/2,0);i.position=s,i.rotationQuaternion=gt.PT.Identity(),i.scaling=new gt.Pq(1,1,1);const r=this._currencyFormatter.centsToCurrencyString(e),n=this._dynamicTexture,o="bold 2.5em Arial";n.clear("transparent");const a=this._dynamicTexture.getContext();a.font=o,a.strokeStyle="black",a.lineWidth=3;const h=a.measureText(r),l=(n.getSize().width-h.width)/2,c=parseInt(o.replace(/\D/g,"")),u=n.getSize().height/2+c/3.65;a.strokeText(r,l,u),a.fillStyle="white",a.fillText(r,l,u),this._dynamicTexture.update(!1);const d=this._chips.at(-1)??(()=>{throw new Z("No chips in stack")})();this._textPlane.position=new gt.Pq(d.chip.position.x+.00125,d.chip.position.y,d.chip.position.z),this.compensateTextParentScale(this.scaling)}async clear(){this._textPlane.setParent(this),this._chips.forEach((e=>{this._chipFactory.releaseChipWithValue(e.value,e.chip)})),this._chips.length=0,this._textPlane.isVisible=!1}}class ca{constructor(e,t,i,s,r,n,o){this._scene=e,this._chipFactory=t,this._parent=i,this._betStackPositionGetter=s,this._currencyFormatter=r,this._chipsValuesAsc=n,this._logManager=o}createForSpot(e){const t=new la(e.type,this._scene,this._chipFactory,this._currencyFormatter,this._chipsValuesAsc,this._logManager.getLogger("Chip Stack"));this._parent.addChild(t),t.setParent(this._parent);const i=this._betStackPositionGetter.getAbsolutePositionForBet(e);return t.setAbsolutePosition(i),t.rotation=gt.Pq.Zero(),t.setScale(gt.Pq.OneReadOnly),t.ignoreNonUniformScaling=!0,t}}class ua{constructor(e){this._chipValuesInCentsDescending=[...e].sort(((e,t)=>t-e))}distributeCentsAsChips(e){return Y.greedyChangeSolution(e,this._chipValuesInCentsDescending)??(()=>{throw new Error(`Could not represent ${e} cents using [${this._chipValuesInCentsDescending.join(", ")}] chips`)})()}}class da extends Gn.V{constructor(e,t){super(e,t)}}class _a extends da{constructor(e,t,i){super(e,t),this._mesh=i,i.scaling.set(1.15,1.15,1.15),i.isVisible=!0,i.isPickable=!1,this.addChild(i)}get mesh(){return this._mesh}get diameter(){return 2*this._mesh.getBoundingInfo().boundingSphere.radius}get height(){const e=this._mesh.getBoundingInfo().boundingBox;return Math.min(e.extendSize.x,e.extendSize.y,e.extendSize.z)}}class pa{constructor(e,t,i){this._pools=new Map,this._scene=e,this._chipModels=t,this._chipsPoolParent=new Gn.V("ChipsPool",e),i&&this.prewarm(i)}releaseChipWithValue(e,t){t.setParent(this._chipsPoolParent),t.scaling=new gt.Pq(1,1,1),t.setAbsolutePosition(gt.Pq.ZeroReadOnly),t.rotationQuaternion=gt.PT.Identity(),t.mesh.isVisible=!1,t.markAsDirty(),this.getPoolForValue(e).push(t)}getChipWithValue(e){let t=this.tryGetChipFromPool(e);return t||(t=this.createChipWithValue(e)),t}prewarm(e){this._chipModels.forEach(((t,i)=>{this.getPoolForValue(i);for(let t=0;t<e.instancesPerValue;t++){const e=this.createChipWithValue(i);this.releaseChipWithValue(i,e)}}))}createChipWithValue(e){const t=this._chipModels.get(e);if(!t)throw new Z(`No chip model is defined for value '${e}'`);const i=t.clone(`${t.name}-clone`,null);if(!i)throw new Z("Could not instantiate chip clone");return i.renderingGroupId=Tt.Chips,new _a(`chip-${e.toString()}`,this._scene,i)}tryGetChipFromPool(e){const t=this.getPoolForValue(e).pop();return t&&(t.mesh.isVisible=!0),t}getPoolForValue(e){let t=this._pools.get(e);return t||(t=new Array,this._pools.set(e,t)),t}}class ga{constructor(e,t,i,s,r){this._compositeUnsub=new Ki,this._betSelectorView=e??(()=>{throw new Error("Bet Selector view is required")})(),this._currentChip=t,this._audioEventHandler=i,this._betSelectorView.setActiveBet(this._currentChip.centsValue,AbortSignal.abort(ei.JumpToEnd));const n=()=>{this._betSelectorView.setMaxAvailableChipValue(s.centsValue-r.currentTotalBet)};this._compositeUnsub.add([e.nextClicked.subscribe(this.onNextChipClicked.bind(this)),e.prevClicked.subscribe(this.onPrevChipClicked.bind(this)),e.betSelected.subscribe(this.onBetSelected.bind(this)),e.gridOpened.subscribe((()=>{i.play(or.UI_Click)})),e.gridChipSelected.subscribe((()=>{i.play(or.UI_Click)})),s.centsObservable.subscribe((e=>{n()})),r.updateObservable.subscribe((e=>{n()}))])}dispose(){this._compositeUnsub.unsubscribe()}onNextChipClicked(){this._audioEventHandler.play(or.UI_Click),this._betSelectorView.selectNext()}onPrevChipClicked(){this._audioEventHandler.play(or.UI_Click),this._betSelectorView.selectPrev()}onBetSelected(e){this._currentChip.centsObservable.next(e)}}var fa=o(780),ma=o(9838),ba=o(3600),va=o(4245),Ta=o(1077);class ya extends Ta.${_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([o.e(3712).then(o.bind(o,1331)),o.e(3875).then(o.bind(o,3875))]))):t.push(Promise.all([o.e(6743).then(o.bind(o,6743)),o.e(4352).then(o.bind(o,4352))]))}constructor(e,t=null,i,s,r){const n=!!r?.blockCompilation;super({...r,name:e,engine:t||Me.N.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:ya.FragmentUrl,uniforms:ya.Uniforms,samplers:ya.Samplers,vertexUrl:ya.VertexUrl,blockCompilation:!0}),this._packedFloat=!1,this._staticDefines="",this.textureWidth=0,this.textureHeight=0,this.options.blockCompilation=n,void 0!==i&&(this.direction=i),void 0!==s&&(this.kernel=s)}set kernel(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this.options.blockCompilation||this._updateParameters())}get kernel(){return this._idealKernel}set packedFloat(e){this._packedFloat!==e&&(this._packedFloat=e,this.options.blockCompilation||this._updateParameters())}get packedFloat(){return this._packedFloat}bind(){super.bind(),this._drawWrapper.effect.setFloat2("delta",1/this.textureWidth*this.direction.x,1/this.textureHeight*this.direction.y)}_updateParameters(e,t){const i=this._kernel,s=(i-1)/2;let r=[],n=[],o=0;for(let e=0;e<i;e++){const t=e/(i-1),a=this._gaussianWeight(2*t-1);r[e]=e-s,n[e]=a,o+=a}for(let e=0;e<n.length;e++)n[e]/=o;const a=[],h=[],l=[];for(let e=0;e<=s;e+=2){const t=Math.min(e+1,Math.floor(s));if(e===t)l.push({o:r[e],w:n[e]});else{const i=t===s,o=n[e]+n[t]*(i?.5:1),a=r[e]+1/(1+n[e]/n[t]);0===a?(l.push({o:r[e],w:n[e]}),l.push({o:r[e+1],w:n[e+1]})):(l.push({o:a,w:o}),l.push({o:-a,w:o}))}}for(let e=0;e<l.length;e++)h[e]=l[e].o,a[e]=l[e].w;r=h,n=a;const c=this.options.engine.getCaps().maxVaryingVectors-(1===this.options.shaderLanguage?1:0),u=Math.max(c,0)-1;let d=Math.min(r.length,u),_="";_+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(_+=`#define CENTER_WEIGHT ${this._glslFloat(n[d-1])}\n`,d--);for(let e=0;e<d;e++)_+=`#define KERNEL_OFFSET${e} ${this._glslFloat(r[e])}\n`,_+=`#define KERNEL_WEIGHT${e} ${this._glslFloat(n[e])}\n`;let p=0;for(let e=u;e<r.length;e++)_+=`#define KERNEL_DEP_OFFSET${p} ${this._glslFloat(r[e])}\n`,_+=`#define KERNEL_DEP_WEIGHT${p} ${this._glslFloat(n[e])}\n`,p++;this.packedFloat&&(_+="#define PACKEDFLOAT 1"),this.options.blockCompilation=!1,this.updateEffect(_,null,null,{varyingCount:d,depCount:p},e,t)}_nearestBestKernel(e){const t=Math.round(e);for(const e of[t,t-1,t+1,t-2,t+2])if(e%2!=0&&Math.floor(e/2)%2==0&&e>0)return Math.max(e,3);return Math.max(t,3)}_gaussianWeight(e){const t=1/3,i=-e*e/(2*t*t);return 1/(Math.sqrt(2*Math.PI)*t)*Math.exp(i)}_glslFloat(e,t=8){return e.toFixed(t).replace(/0+$/,"")}}ya.VertexUrl="kernelBlur",ya.FragmentUrl="kernelBlur",ya.Uniforms=["delta","direction"],ya.Samplers=["circleOfConfusionSampler"];class xa extends va.w{get direction(){return this._effectWrapper.direction}set direction(e){this._effectWrapper.direction=e}set kernel(e){this._effectWrapper.kernel=e}get kernel(){return this._effectWrapper.kernel}set packedFloat(e){this._effectWrapper.packedFloat=e}get packedFloat(){return this._effectWrapper.packedFloat}getClassName(){return"BlurPostProcess"}constructor(e,t,i,s,r=null,n=Dt.g.BILINEAR_SAMPLINGMODE,o,a,h=0,l="",c=!1,u=5){const d="number"==typeof s?c:!!s.blockCompilation,_={uniforms:ya.Uniforms,samplers:ya.Samplers,size:"number"==typeof s?s:void 0,camera:r,samplingMode:n,engine:o,reusable:a,textureType:h,vertexUrl:ya.VertexUrl,indexParameters:{varyingCount:0,depCount:0},textureFormat:u,defines:l,...s,blockCompilation:!0};super(e,ya.FragmentUrl,{effectWrapper:"number"!=typeof s&&s.effectWrapper?void 0:new ya(e,o,void 0,void 0,_),..._}),this._effectWrapper.options.blockCompilation=d,this.direction=t,this.onApplyObservable.add((()=>{this._effectWrapper.textureWidth=this._outputTexture?this._outputTexture.width:this.width,this._effectWrapper.textureHeight=this._outputTexture?this._outputTexture.height:this.height})),this.kernel=i}updateEffect(e=null,t=null,i=null,s,r,n){this._effectWrapper._updateParameters(r,n)}static _Parse(e,t,i,s){return Vt.p.Parse((()=>new xa(e.name,e.direction,e.kernel,e.options,t,e.renderTargetSamplingMode,i.getEngine(),e.reusable,e.textureType,void 0,!1)),e,i,s)}}(0,Et.Cg)([(0,Rt.WM)()],xa.prototype,"direction",null),(0,Et.Cg)([(0,Rt.lK)()],xa.prototype,"kernel",null),(0,Et.Cg)([(0,Rt.lK)()],xa.prototype,"packedFloat",null),(0,Ft.Y5)("BABYLON.BlurPostProcess",xa);var Aa=o(2213),Ca=o(117);class Sa{get bias(){return this._bias}set bias(e){this._bias=e}get normalBias(){return this._normalBias}set normalBias(e){this._normalBias=e}get blurBoxOffset(){return this._blurBoxOffset}set blurBoxOffset(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())}get blurScale(){return this._blurScale}set blurScale(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())}get blurKernel(){return this._blurKernel}set blurKernel(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())}get useKernelBlur(){return this._useKernelBlur}set useKernelBlur(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())}get depthScale(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()}set depthScale(e){this._depthScale=e}_validateFilter(e){return e}get filter(){return this._filter}set filter(e){if(e=this._validateFilter(e),this._light.needCube()){if(e===Sa.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(e===Sa.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(e===Sa.FILTER_PCF||e===Sa.FILTER_PCSS)return void(this.usePoissonSampling=!0)}e!==Sa.FILTER_PCF&&e!==Sa.FILTER_PCSS||this._scene.getEngine()._features.supportShadowSamplers?this._filter!==e&&(this._filter=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0}get usePoissonSampling(){return this.filter===Sa.FILTER_POISSONSAMPLING}set usePoissonSampling(e){const t=this._validateFilter(Sa.FILTER_POISSONSAMPLING);(e||this.filter===Sa.FILTER_POISSONSAMPLING)&&(this.filter=e?t:Sa.FILTER_NONE)}get useExponentialShadowMap(){return this.filter===Sa.FILTER_EXPONENTIALSHADOWMAP}set useExponentialShadowMap(e){const t=this._validateFilter(Sa.FILTER_EXPONENTIALSHADOWMAP);(e||this.filter===Sa.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=e?t:Sa.FILTER_NONE)}get useBlurExponentialShadowMap(){return this.filter===Sa.FILTER_BLUREXPONENTIALSHADOWMAP}set useBlurExponentialShadowMap(e){const t=this._validateFilter(Sa.FILTER_BLUREXPONENTIALSHADOWMAP);(e||this.filter===Sa.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=e?t:Sa.FILTER_NONE)}get useCloseExponentialShadowMap(){return this.filter===Sa.FILTER_CLOSEEXPONENTIALSHADOWMAP}set useCloseExponentialShadowMap(e){const t=this._validateFilter(Sa.FILTER_CLOSEEXPONENTIALSHADOWMAP);(e||this.filter===Sa.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?t:Sa.FILTER_NONE)}get useBlurCloseExponentialShadowMap(){return this.filter===Sa.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP}set useBlurCloseExponentialShadowMap(e){const t=this._validateFilter(Sa.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(e||this.filter===Sa.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?t:Sa.FILTER_NONE)}get usePercentageCloserFiltering(){return this.filter===Sa.FILTER_PCF}set usePercentageCloserFiltering(e){const t=this._validateFilter(Sa.FILTER_PCF);(e||this.filter===Sa.FILTER_PCF)&&(this.filter=e?t:Sa.FILTER_NONE)}get filteringQuality(){return this._filteringQuality}set filteringQuality(e){this._filteringQuality!==e&&(this._filteringQuality=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())}get useContactHardeningShadow(){return this.filter===Sa.FILTER_PCSS}set useContactHardeningShadow(e){const t=this._validateFilter(Sa.FILTER_PCSS);(e||this.filter===Sa.FILTER_PCSS)&&(this.filter=e?t:Sa.FILTER_NONE)}get contactHardeningLightSizeUVRatio(){return this._contactHardeningLightSizeUVRatio}set contactHardeningLightSizeUVRatio(e){this._contactHardeningLightSizeUVRatio=e}get darkness(){return this._darkness}set darkness(e){this.setDarkness(e)}getDarkness(){return this._darkness}setDarkness(e){return this._darkness=e>=1?1:e<=0?0:e,this}get transparencyShadow(){return this._transparencyShadow}set transparencyShadow(e){this.setTransparencyShadow(e)}setTransparencyShadow(e){return this._transparencyShadow=e,this}getShadowMap(){return this._shadowMap}getShadowMapForRendering(){return this._shadowMap2?this._shadowMap2:this._shadowMap}getClassName(){return Sa.CLASSNAME}addShadowCaster(e,t=!0){if(!this._shadowMap)return this;if(this._shadowMap.renderList||(this._shadowMap.renderList=[]),-1===this._shadowMap.renderList.indexOf(e)&&this._shadowMap.renderList.push(e),t)for(const t of e.getChildMeshes())-1===this._shadowMap.renderList.indexOf(t)&&this._shadowMap.renderList.push(t);return this}removeShadowCaster(e,t=!0){if(!this._shadowMap||!this._shadowMap.renderList)return this;const i=this._shadowMap.renderList.indexOf(e);if(-1!==i&&this._shadowMap.renderList.splice(i,1),t)for(const t of e.getChildren())this.removeShadowCaster(t);return this}getLight(){return this._light}get shaderLanguage(){return this._shaderLanguage}_getCamera(){return this._camera??this._scene.activeCamera}get mapSize(){return this._mapSize}set mapSize(e){this._mapSize=e,this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}constructor(e,t,i,s,r,n=!1){this.onBeforeShadowMapRenderObservable=new Zi.cP,this.onAfterShadowMapRenderObservable=new Zi.cP,this.onBeforeShadowMapRenderMeshObservable=new Zi.cP,this.onAfterShadowMapRenderMeshObservable=new Zi.cP,this.doNotSerialize=!1,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=Sa.FILTER_NONE,this._filteringQuality=Sa.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.enableSoftTransparentShadow=!1,this.useOpacityTextureForTransparentShadow=!1,this.frustumEdgeFalloff=0,this._shaderLanguage=0,this.forceBackFacesOnly=!1,this._lightDirection=gt.Pq.Zero(),this._viewMatrix=gt.uq.Zero(),this._projectionMatrix=gt.uq.Zero(),this._transformMatrix=gt.uq.Zero(),this._cachedPosition=new gt.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new gt.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=gt.uq.Identity(),this._shadersLoaded=!1,this._mapSize=e,this._light=t,this._scene=t.getScene(),this._camera=s??null,this._useRedTextureType=!!r,this._initShaderSourceAsync(n);let o=t._shadowGenerators;o||(o=t._shadowGenerators=new Map),o.set(this._camera,this),this.id=t.id,this._useUBO=this._scene.getEngine().supportsUniformBuffers,this._useUBO&&(this._sceneUBOs=[],this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for Shadow Generator (light "${this._light.name}")`))),Sa._SceneComponentInitialization(this._scene);const a=this._scene.getEngine().getCaps();i?a.textureFloatRender&&a.textureFloatLinearFiltering?this._textureType=1:a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?this._textureType=2:this._textureType=0:a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?this._textureType=2:a.textureFloatRender&&a.textureFloatLinearFiltering?this._textureType=1:this._textureType=0,this._initializeGenerator(),this._applyFilterValues()}_initializeGenerator(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()}_createTargetRenderTexture(){const e=this._scene.getEngine();e._features.supportDepthStencilTexture?(this._shadowMap=new ba.$(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1,void 0,this._useRedTextureType?6:5),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0,void 0,void 0,void 0,`DepthStencilForShadowGenerator-${this._light.name}`)):this._shadowMap=new ba.$(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.noPrePassRenderer=!0}_initializeShadowMap(){if(this._createTargetRenderTexture(),null===this._shadowMap)return;this._shadowMap.wrapU=Dt.g.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=Dt.g.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(Dt.g.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=(e,t,i,s)=>this._renderForShadowMap(e,t,i,s),this._shadowMap.customIsReadyFunction=(e,t,i)=>{if(!i||!e.subMeshes)return!0;let s=!0;for(const t of e.subMeshes){const e=t.getRenderingMesh(),i=this._scene.getEngine(),r=t.getMaterial();if(!r||0===t.verticesCount||this.customAllowRendering&&!this.customAllowRendering(t))continue;const n=e._getInstancesRenderList(t._id,!!t.getReplacementMesh());if(n.mustReturn)continue;const o=i.getCaps().instancedArrays&&(null!==n.visibleInstances[t._id]&&void 0!==n.visibleInstances[t._id]||e.hasThinInstances),a=r.needAlphaBlendingForMesh(e);s=this.isReady(t,o,a)&&s}return s};const e=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.add((()=>{this._currentSceneUBO=this._scene.getSceneUniformBuffer(),e._debugPushGroup?.(`shadow map generation for pass id ${e.currentRenderPassId}`,1)})),this._shadowMap.onBeforeRenderObservable.add((t=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[0]),this._currentFaceIndex=t,this._filter===Sa.FILTER_PCF&&e.setColorWrite(!1),this.getTransformMatrix(),this._scene.setTransformMatrix(this._viewMatrix,this._projectionMatrix),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onAfterUnbindObservable.add((()=>{if(this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._currentSceneUBO),this._scene.updateTransformMatrix(),this._filter===Sa.FILTER_PCF&&e.setColorWrite(!0),!this.useBlurExponentialShadowMap&&!this.useBlurCloseExponentialShadowMap)return void e._debugPopGroup?.(1);const t=this.getShadowMapForRendering();t&&(this._scene.postProcessManager.directRender(this._blurPostProcesses,t.renderTarget,!0),e.unBindFramebuffer(t.renderTarget,!0)),e._debugPopGroup?.(1)}));const t=new bt.ov(0,0,0,0),i=new bt.ov(1,1,1,1);this._shadowMap.onClearObservable.add((e=>{this._filter===Sa.FILTER_PCF?e.clear(i,!1,!0,!1):this.useExponentialShadowMap||this.useBlurExponentialShadowMap?e.clear(t,!0,!0,!1):e.clear(i,!0,!0,!1)})),this._shadowMap.onResizeObservable.add((e=>{this._storedUniqueId=this._shadowMap.uniqueId,this._mapSize=e.getRenderSize(),this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}));for(let e=Ca.m.MIN_RENDERINGGROUPS;e<Ca.m.MAX_RENDERINGGROUPS;e++)this._shadowMap.setRenderingAutoClearDepthStencil(e,!1)}async _initShaderSourceAsync(e=!1){!this._scene.getEngine().isWebGPU||e||Sa.ForceGLSL?await Promise.all([o.e(687).then(o.bind(o,687)),o.e(4588).then(o.bind(o,4588)),o.e(3880).then(o.bind(o,3880)),o.e(6012).then(o.bind(o,6012))]):(this._shaderLanguage=1,await Promise.all([o.e(8130).then(o.bind(o,8130)),o.e(6632).then(o.bind(o,1870)),o.e(8965).then(o.bind(o,8965)),o.e(9229).then(o.bind(o,9229))])),this._shadersLoaded=!0}_initializeBlurRTTAndPostProcesses(){const e=this._scene.getEngine(),t=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new ba.$(this._light.name+"_shadowMap2",t,this._scene,!1,!0,this._textureType,void 0,void 0,!1),this._shadowMap2.wrapU=Dt.g.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=Dt.g.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(Dt.g.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new xa(this._light.name+"KernelBlurX",new gt.I9(1,0),this.blurKernel,1,null,Dt.g.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.width=t,this._kernelBlurXPostprocess.height=t,this._kernelBlurXPostprocess.externalTextureSamplerBinding=!0,this._kernelBlurXPostprocess.onApplyObservable.add((e=>{e.setTexture("textureSampler",this._shadowMap)})),this._kernelBlurYPostprocess=new xa(this._light.name+"KernelBlurY",new gt.I9(0,1),this.blurKernel,1,null,Dt.g.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,0===this._textureType&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new va.w(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,Dt.g.BILINEAR_SAMPLINGMODE,e,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType,void 0,void 0,void 0,void 0,this._shaderLanguage),this._boxBlurPostprocess.externalTextureSamplerBinding=!0,this._boxBlurPostprocess.onApplyObservable.add((e=>{e.setFloat2("screenSize",t,t),e.setTexture("textureSampler",this._shadowMap)})),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])}_renderForShadowMap(e,t,i,s){let r;if(s.length)for(r=0;r<s.length;r++)this._renderSubMeshForShadowMap(s.data[r]);for(r=0;r<e.length;r++)this._renderSubMeshForShadowMap(e.data[r]);for(r=0;r<t.length;r++)this._renderSubMeshForShadowMap(t.data[r]);if(this._transparencyShadow)for(r=0;r<i.length;r++)this._renderSubMeshForShadowMap(i.data[r],!0);else for(r=0;r<i.length;r++)i.data[r].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1}_bindCustomEffectForRenderSubMeshForShadowMap(e,t,i){t.setMatrix("viewProjection",this.getTransformMatrix())}_renderSubMeshForShadowMap(e,t=!1){const i=e.getRenderingMesh(),s=e.getEffectiveMesh(),r=this._scene,n=r.getEngine(),o=e.getMaterial();if(s._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!o||0===e.verticesCount||e._renderId===r.getRenderId())return;const a=r.useRightHandedSystem,h=s._getWorldMatrixDeterminant()<0;let l=o._getEffectiveOrientation(i);(h&&!a||!h&&a)&&(l=0===l?1:0);const c=0===l;n.setState(o.backFaceCulling,void 0,void 0,c,o.cullBackFaces);const u=i._getInstancesRenderList(e._id,!!e.getReplacementMesh());if(u.mustReturn)return;const d=n.getCaps().instancedArrays&&(null!==u.visibleInstances[e._id]&&void 0!==u.visibleInstances[e._id]||i.hasThinInstances);if(!this.customAllowRendering||this.customAllowRendering(e))if(this.isReady(e,d,t)){e._renderId=r.getRenderId();const a=o.shadowDepthWrapper,h=a?.getEffect(e,this,n.currentRenderPassId)??e._getDrawWrapper(),l=cs.E.GetEffect(h);n.enableEffect(h),d||i._bind(e,l,o.fillMode),this.getTransformMatrix(),l.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale),this.getLight().getTypeID()===ma.v.LIGHTTYPEID_DIRECTIONALLIGHT?l.setVector3("lightDataSM",this._cachedDirection):l.setVector3("lightDataSM",this._cachedPosition);const c=this._getCamera();if(l.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(c),this.getLight().getDepthMinZ(c)+this.getLight().getDepthMaxZ(c)),t&&this.enableSoftTransparentShadow&&l.setFloat2("softTransparentShadowSM",s.visibility*o.alpha,this._opacityTexture?.getAlphaFromRGB?1:0),a)e._setMainDrawWrapperOverride(h),a.standalone?a.baseMaterial.bindForSubMesh(s.getWorldMatrix(),i,e):o.bindForSubMesh(s.getWorldMatrix(),i,e),e._setMainDrawWrapperOverride(null);else{if(this._opacityTexture&&(l.setTexture("diffuseSampler",this._opacityTexture),l.setMatrix("diffuseMatrix",this._opacityTexture.getTextureMatrix()||this._defaultTextureMatrix)),i.useBones&&i.computeBonesUsingShaders&&i.skeleton){const e=i.skeleton;if(e.isUsingTextureForMatrices){const t=e.getTransformMatrixTexture(i);if(!t)return;l.setTexture("boneSampler",t),l.setFloat("boneTextureWidth",4*(e.bones.length+1))}else l.setMatrices("mBones",e.getTransformMatrices(i))}(0,Ut.nR)(i,l),i.morphTargetManager&&i.morphTargetManager.isUsingTextureForTargets&&i.morphTargetManager._bind(l);const t=e.getMesh().bakedVertexAnimationManager;t&&t.isEnabled&&t.bind(l,d),(0,kt.gS)(l,o,r)}this._useUBO||a||this._bindCustomEffectForRenderSubMeshForShadowMap(e,l,s),(0,Ut._8)(l,this._scene.getSceneUniformBuffer()),this._scene.getSceneUniformBuffer().bindUniformBuffer();const _=s.getWorldMatrix();d&&(s.getMeshUniformBuffer().bindToEffect(l,"Mesh"),s.transferToEffect(_)),this.forceBackFacesOnly&&n.setState(!0,0,!1,!0,o.cullBackFaces),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(i),this.onBeforeShadowMapRenderObservable.notifyObservers(l),i._processRendering(s,e,l,o.fillMode,u,d,((e,t)=>{s===i||e?(s.getMeshUniformBuffer().bindToEffect(l,"Mesh"),s.transferToEffect(e?t:_)):(i.getMeshUniformBuffer().bindToEffect(l,"Mesh"),i.transferToEffect(t))})),this.forceBackFacesOnly&&n.setState(!0,0,!1,!1,o.cullBackFaces),this.onAfterShadowMapRenderObservable.notifyObservers(l),this.onAfterShadowMapRenderMeshObservable.notifyObservers(i)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}_applyFilterValues(){this._shadowMap&&(this.filter===Sa.FILTER_NONE||this.filter===Sa.FILTER_PCSS?this._shadowMap.updateSamplingMode(Dt.g.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(Dt.g.BILINEAR_SAMPLINGMODE))}forceCompilation(e,t){const i={useInstances:!1,...t},s=this.getShadowMap();if(!s)return void(e&&e(this));const r=s.renderList;if(!r)return void(e&&e(this));const n=[];for(const e of r)n.push(...e.subMeshes);if(0===n.length)return void(e&&e(this));let o=0;const a=()=>{if(this._scene&&this._scene.getEngine()){for(;this.isReady(n[o],i.useInstances,n[o].getMaterial()?.needAlphaBlendingForMesh(n[o].getMesh())??!1);)if(o++,o>=n.length)return void(e&&e(this));setTimeout(a,16)}};a()}forceCompilationAsync(e){return new Promise((t=>{this.forceCompilation((()=>{t()}),e)}))}_isReadyCustomDefines(e,t,i){}_prepareShadowDefines(e,t,i,s){i.push("#define SM_LIGHTTYPE_"+this._light.getClassName().toUpperCase()),i.push("#define SM_FLOAT "+(0!==this._textureType?"1":"0")),i.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0")),i.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));const r=e.getMesh();return i.push("#define SM_NORMALBIAS "+(this.normalBias&&r.isVerticesDataPresent(Mt.R.NormalKind)?"1":"0")),i.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===ma.v.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0")),i.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0")),i.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&s?"1":"0")),this._isReadyCustomDefines(i,e,t),i}isReady(e,t,i){if(!this._shadersLoaded)return!1;const s=e.getMaterial(),r=s?.shadowDepthWrapper;if(this._opacityTexture=null,!s)return!1;const n=[];if(this._prepareShadowDefines(e,t,n,i),r){if(!r.isReadyForSubMesh(e,n,this,t,this._scene.getEngine().currentRenderPassId))return!1}else{const i=e._getDrawWrapper(void 0,!0);let r=i.effect,o=i.defines;const a=[Mt.R.PositionKind],h=e.getMesh();let l=!1,c=!1,u=!1;const d=!1;this.normalBias&&h.isVerticesDataPresent(Mt.R.NormalKind)&&(a.push(Mt.R.NormalKind),n.push("#define NORMAL"),l=!0,h.nonUniformScaling&&n.push("#define NONUNIFORMSCALING"));const _=s.needAlphaTestingForMesh(h);if((_||s.needAlphaBlendingForMesh(h))&&(this.useOpacityTextureForTransparentShadow?this._opacityTexture=s.opacityTexture:this._opacityTexture=s.getAlphaTestTexture(),this._opacityTexture)){if(!this._opacityTexture.isReady())return!1;const e=s.alphaCutOff??Sa.DEFAULT_ALPHA_CUTOFF;n.push("#define ALPHATEXTURE"),_&&n.push(`#define ALPHATESTVALUE ${e}${e%1==0?".":""}`),h.isVerticesDataPresent(Mt.R.UVKind)&&(a.push(Mt.R.UVKind),n.push("#define UV1"),c=!0),h.isVerticesDataPresent(Mt.R.UV2Kind)&&1===this._opacityTexture.coordinatesIndex&&(a.push(Mt.R.UV2Kind),n.push("#define UV2"),u=!0)}const p=new Nt.J;if(h.useBones&&h.computeBonesUsingShaders&&h.skeleton){a.push(Mt.R.MatricesIndicesKind),a.push(Mt.R.MatricesWeightsKind),h.numBoneInfluencers>4&&(a.push(Mt.R.MatricesIndicesExtraKind),a.push(Mt.R.MatricesWeightsExtraKind));const e=h.skeleton;n.push("#define NUM_BONE_INFLUENCERS "+h.numBoneInfluencers),h.numBoneInfluencers>0&&p.addCPUSkinningFallback(0,h),e.isUsingTextureForMatrices?n.push("#define BONETEXTURE"):n.push("#define BonesPerMesh "+(e.bones.length+1))}else n.push("#define NUM_BONE_INFLUENCERS 0");const g=h.morphTargetManager?(0,Ut.Dk)(h.morphTargetManager,n,a,h,!0,l,!1,c,u,d):0;if((0,kt.tv)(s,this._scene,n),t&&(n.push("#define INSTANCES"),(0,Ut.te)(a),e.getRenderingMesh().hasThinInstances&&n.push("#define THIN_INSTANCES")),this.customShaderOptions&&this.customShaderOptions.defines)for(const e of this.customShaderOptions.defines)-1===n.indexOf(e)&&n.push(e);const f=h.bakedVertexAnimationManager;f&&f.isEnabled&&(n.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),t&&a.push("bakedVertexAnimationSettingsInstanced"));const m=n.join("\n");if(o!==m){o=m;let e="shadowMap";const t=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","morphTargetCount","boneTextureWidth","softTransparentShadowSM","morphTargetTextureInfo","morphTargetTextureIndices","bakedVertexAnimationSettings","bakedVertexAnimationTextureSizeInverted","bakedVertexAnimationTime","bakedVertexAnimationTexture"],s=["diffuseSampler","boneSampler","morphTargets","bakedVertexAnimationTexture"],n=["Scene","Mesh"];if((0,kt.TV)(t),this.customShaderOptions){if(e=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(const e of this.customShaderOptions.attributes)-1===a.indexOf(e)&&a.push(e);if(this.customShaderOptions.uniforms)for(const e of this.customShaderOptions.uniforms)-1===t.indexOf(e)&&t.push(e);if(this.customShaderOptions.samplers)for(const e of this.customShaderOptions.samplers)-1===s.indexOf(e)&&s.push(e)}const h=this._scene.getEngine();r=h.createEffect(e,{attributes:a,uniformsNames:t,uniformBuffersNames:n,samplers:s,defines:m,fallbacks:p,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:g},shaderLanguage:this._shaderLanguage},h),i.setEffect(r,o)}if(!r.isReady())return!1}return(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady()||this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady()||this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())}prepareDefines(e,t){const i=this._scene,s=this._light;i.shadowsEnabled&&s.shadowEnabled&&(e["SHADOW"+t]=!0,this.useContactHardeningShadow?(e["SHADOWPCSS"+t]=!0,this._filteringQuality===Sa.QUALITY_LOW?e["SHADOWLOWQUALITY"+t]=!0:this._filteringQuality===Sa.QUALITY_MEDIUM&&(e["SHADOWMEDIUMQUALITY"+t]=!0)):this.usePercentageCloserFiltering?(e["SHADOWPCF"+t]=!0,this._filteringQuality===Sa.QUALITY_LOW?e["SHADOWLOWQUALITY"+t]=!0:this._filteringQuality===Sa.QUALITY_MEDIUM&&(e["SHADOWMEDIUMQUALITY"+t]=!0)):this.usePoissonSampling?e["SHADOWPOISSON"+t]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?e["SHADOWESM"+t]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(e["SHADOWCLOSEESM"+t]=!0),s.needCube()&&(e["SHADOWCUBE"+t]=!0))}bindShadowLight(e,t){const i=this._light;if(!this._scene.shadowsEnabled||!i.shadowEnabled)return;const s=this._getCamera(),r=this.getShadowMap();if(!r)return;i.needCube()||t.setMatrix("lightMatrix"+e,this.getTransformMatrix());const n=this.getShadowMapForRendering();this._filter===Sa.FILTER_PCF?(t.setDepthStencilTexture("shadowTexture"+e,n),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),r.getSize().width,1/r.getSize().width,this.frustumEdgeFalloff,e)):this._filter===Sa.FILTER_PCSS?(t.setDepthStencilTexture("shadowTexture"+e,n),t.setTexture("depthTexture"+e,n),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/r.getSize().width,this._contactHardeningLightSizeUVRatio*r.getSize().width,this.frustumEdgeFalloff,e)):(t.setTexture("shadowTexture"+e,n),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/r.getSize().width,this.depthScale,this.frustumEdgeFalloff,e)),i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(s),this.getLight().getDepthMinZ(s)+this.getLight().getDepthMaxZ(s),e)}get viewMatrix(){return this._viewMatrix}get projectionMatrix(){return this._projectionMatrix}getTransformMatrix(){const e=this._scene;if(this._currentRenderId===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderId=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;let t=this._light.position;if(this._light.computeTransformedInformation()&&(t=this._light.transformedPosition),gt.Pq.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(gt.Pq.Dot(this._lightDirection,gt.Pq.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!t.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(t),this._cachedDirection.copyFrom(this._lightDirection),gt.uq.LookAtLHToRef(t,t.add(this._lightDirection),gt.Pq.Up(),this._viewMatrix);const e=this.getShadowMap();if(e){const t=e.renderList;t&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,t)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix}recreateShadowMap(){const e=this._shadowMap;if(!e)return;const t=e.renderList;if(this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this._filter,this._applyFilterValues(),t){this._shadowMap.renderList||(this._shadowMap.renderList=[]);for(const e of t)this._shadowMap.renderList.push(e)}else this._shadowMap.renderList=null}_disposeBlurPostProcesses(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]}_disposeRTTandPostProcesses(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()}_disposeSceneUBOs(){if(this._sceneUBOs){for(const e of this._sceneUBOs)e.dispose();this._sceneUBOs=[]}}dispose(){if(this._disposeRTTandPostProcesses(),this._disposeSceneUBOs(),this._light){if(this._light._shadowGenerators){const e=this._light._shadowGenerators.entries();for(let t=e.next();!0!==t.done;t=e.next()){const[e,i]=t.value;i===this&&this._light._shadowGenerators.delete(e)}0===this._light._shadowGenerators.size&&(this._light._shadowGenerators=null)}this._light._markMeshesAsLightDirty()}this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()}serialize(){const e={},t=this.getShadowMap();if(!t)return e;if(e.className=this.getClassName(),e.lightId=this._light.id,e.cameraId=this._camera?.id,e.id=this.id,e.mapSize=t.getRenderSize(),e.forceBackFacesOnly=this.forceBackFacesOnly,e.darkness=this.getDarkness(),e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.filteringQuality=this.filteringQuality,e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.depthScale=this.depthScale,e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.renderList=[],t.renderList)for(let i=0;i<t.renderList.length;i++){const s=t.renderList[i];e.renderList.push(s.id)}return e}static Parse(e,t,i){const s=t.getLightById(e.lightId),r=void 0!==e.cameraId?t.getCameraById(e.cameraId):null,n=i?i(e.mapSize,s,r):new Sa(e.mapSize,s,void 0,r),o=n.getShadowMap();for(let i=0;i<e.renderList.length;i++)t.getMeshesById(e.renderList[i]).forEach((function(e){o&&(o.renderList||(o.renderList=[]),o.renderList.push(e))}));return void 0!==e.id&&(n.id=e.id),n.forceBackFacesOnly=!!e.forceBackFacesOnly,void 0!==e.darkness&&n.setDarkness(e.darkness),e.transparencyShadow&&n.setTransparencyShadow(!0),void 0!==e.frustumEdgeFalloff&&(n.frustumEdgeFalloff=e.frustumEdgeFalloff),void 0!==e.bias&&(n.bias=e.bias),void 0!==e.normalBias&&(n.normalBias=e.normalBias),e.usePercentageCloserFiltering?n.usePercentageCloserFiltering=!0:e.useContactHardeningShadow?n.useContactHardeningShadow=!0:e.usePoissonSampling?n.usePoissonSampling=!0:e.useExponentialShadowMap?n.useExponentialShadowMap=!0:e.useBlurExponentialShadowMap?n.useBlurExponentialShadowMap=!0:e.useCloseExponentialShadowMap?n.useCloseExponentialShadowMap=!0:e.useBlurCloseExponentialShadowMap?n.useBlurCloseExponentialShadowMap=!0:e.useVarianceShadowMap?n.useExponentialShadowMap=!0:e.useBlurVarianceShadowMap&&(n.useBlurExponentialShadowMap=!0),void 0!==e.contactHardeningLightSizeUVRatio&&(n.contactHardeningLightSizeUVRatio=e.contactHardeningLightSizeUVRatio),void 0!==e.filteringQuality&&(n.filteringQuality=e.filteringQuality),e.depthScale&&(n.depthScale=e.depthScale),e.blurScale&&(n.blurScale=e.blurScale),e.blurBoxOffset&&(n.blurBoxOffset=e.blurBoxOffset),e.useKernelBlur&&(n.useKernelBlur=e.useKernelBlur),e.blurKernel&&(n.blurKernel=e.blurKernel),n}}Sa.CLASSNAME="ShadowGenerator",Sa.ForceGLSL=!1,Sa.FILTER_NONE=0,Sa.FILTER_EXPONENTIALSHADOWMAP=1,Sa.FILTER_POISSONSAMPLING=2,Sa.FILTER_BLUREXPONENTIALSHADOWMAP=3,Sa.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,Sa.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,Sa.FILTER_PCF=6,Sa.FILTER_PCSS=7,Sa.QUALITY_HIGH=0,Sa.QUALITY_MEDIUM=1,Sa.QUALITY_LOW=2,Sa.DEFAULT_ALPHA_CUTOFF=.5,Sa._SceneComponentInitialization=e=>{throw(0,Aa.n)("ShadowGeneratorSceneComponent")};var Ea=o(1717),Ra=o(9642);o(3190),o(6791);class Pa{get shaderLanguage(){return this._shaderLanguage}setMaterialForRendering(e,t){this._depthMap.setMaterialForRendering(e,t)}constructor(e,t=1,i=null,s=!1,r=Dt.g.TRILINEAR_SAMPLINGMODE,n=!1,o){this._shaderLanguage=0,this.enabled=!0,this.forceDepthWriteTransparentMeshes=!1,this.useOnlyInActiveCamera=!1,this.reverseCulling=!1,this._shadersLoaded=!1,this._scene=e,this._storeNonLinearDepth=s,this._storeCameraSpaceZ=n,this.isPacked=0===t,this.isPacked?this.clearColor=new bt.ov(1,1,1,1):this.clearColor=new bt.ov(n?1e8:1,0,0,1),this._initShaderSourceAsync(),Pa._SceneComponentInitialization(this._scene);const a=e.getEngine();this._camera=i,r!==Dt.g.NEAREST_SAMPLINGMODE&&(1!==t||a._caps.textureFloatLinearFiltering||(r=Dt.g.NEAREST_SAMPLINGMODE),2!==t||a._caps.textureHalfFloatLinearFiltering||(r=Dt.g.NEAREST_SAMPLINGMODE));const h=this.isPacked||!a._features.supportExtendedTextureFormats?5:6;this._depthMap=new ba.$(o??"DepthRenderer",{width:a.getRenderWidth(),height:a.getRenderHeight()},this._scene,!1,!0,t,!1,r,void 0,void 0,void 0,h),this._depthMap.wrapU=Dt.g.CLAMP_ADDRESSMODE,this._depthMap.wrapV=Dt.g.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.noPrePassRenderer=!0,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add((e=>{e.clear(this.clearColor,!0,!0,!0)})),this._depthMap.onBeforeBindObservable.add((()=>{a._debugPushGroup?.("depth renderer",1)})),this._depthMap.onAfterUnbindObservable.add((()=>{a._debugPopGroup?.(1)})),this._depthMap.customIsReadyFunction=(e,t,i)=>{if((i||0===t)&&e.subMeshes)for(let t=0;t<e.subMeshes.length;++t){const i=e.subMeshes[t],s=i.getRenderingMesh(),r=s._getInstancesRenderList(i._id,!!i.getReplacementMesh()),n=a.getCaps().instancedArrays&&(null!==r.visibleInstances[i._id]&&void 0!==r.visibleInstances[i._id]||s.hasThinInstances);if(!this.isReady(i,n))return!1}return!0};const l=e=>{const t=e.getRenderingMesh(),i=e.getEffectiveMesh(),s=this._scene,r=s.getEngine(),n=e.getMaterial();if(i._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!n||i.infiniteDistance||n.disableDepthWrite||0===e.verticesCount||e._renderId===s.getRenderId())return;const o=i._getWorldMatrixDeterminant()<0;let a=n._getEffectiveOrientation(t);o&&(a=0===a?1:0);const h=0===a;r.setState(n.backFaceCulling,0,!1,h,this.reverseCulling?!n.cullBackFaces:n.cullBackFaces);const l=t._getInstancesRenderList(e._id,!!e.getReplacementMesh());if(l.mustReturn)return;const c=r.getCaps().instancedArrays&&(null!==l.visibleInstances[e._id]&&void 0!==l.visibleInstances[e._id]||t.hasThinInstances),u=this._camera||s.activeCamera;if(this.isReady(e,c)&&u){e._renderId=s.getRenderId();const o=i._internalAbstractMeshDataInfo._materialForRenderPass?.[r.currentRenderPassId];let a=e._getDrawWrapper();!a&&o&&(a=o._getDrawWrapper());const h=u.mode===Ra.i.ORTHOGRAPHIC_CAMERA;if(!a)return;const d=a.effect;let _,p;if(r.enableEffect(a),c||t._bind(e,d,n.fillMode),o?o.bindForSubMesh(i.getWorldMatrix(),i,e):(d.setMatrix("viewProjection",s.getTransformMatrix()),d.setMatrix("world",i.getWorldMatrix()),this._storeCameraSpaceZ&&d.setMatrix("view",s.getViewMatrix())),h?(_=!r.useReverseDepthBuffer&&r.isNDCHalfZRange?0:1,p=r.useReverseDepthBuffer&&r.isNDCHalfZRange?0:1):(_=r.useReverseDepthBuffer&&r.isNDCHalfZRange?u.minZ:r.isNDCHalfZRange?0:u.minZ,p=r.useReverseDepthBuffer&&r.isNDCHalfZRange?0:u.maxZ),d.setFloat2("depthValues",_,_+p),!o){if(n.needAlphaTestingForMesh(i)){const e=n.getAlphaTestTexture();e&&(d.setTexture("diffuseSampler",e),d.setMatrix("diffuseMatrix",e.getTextureMatrix()))}(0,Ut.f$)(t,d),(0,kt.gS)(d,n,s),(0,Ut.nR)(t,d),t.morphTargetManager&&t.morphTargetManager.isUsingTextureForTargets&&t.morphTargetManager._bind(d);const r=e.getMesh().bakedVertexAnimationManager;r&&r.isEnabled&&r.bind(d,c),n.pointsCloud&&d.setFloat("pointSize",n.pointSize)}t._processRendering(i,e,d,n.fillMode,l,c,((e,t)=>d.setMatrix("world",t)))}};this._depthMap.customRenderFunction=(e,t,i,s)=>{let r;if(s.length)for(r=0;r<s.length;r++)l(s.data[r]);for(r=0;r<e.length;r++)l(e.data[r]);for(r=0;r<t.length;r++)l(t.data[r]);if(this.forceDepthWriteTransparentMeshes)for(r=0;r<i.length;r++)l(i.data[r]);else for(r=0;r<i.length;r++)i.data[r].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1}}async _initShaderSourceAsync(e=!1){!this._scene.getEngine().isWebGPU||e||Pa.ForceGLSL?await Promise.all([Promise.resolve().then(o.bind(o,6791)),Promise.resolve().then(o.bind(o,3190))]):(this._shaderLanguage=1,await Promise.all([o.e(6747).then(o.bind(o,6747)),o.e(2993).then(o.bind(o,2993))])),this._shadersLoaded=!0}isReady(e,t){if(!this._shadersLoaded)return!1;const i=this._scene.getEngine(),s=e.getMesh(),r=s.getScene(),n=s._internalAbstractMeshDataInfo._materialForRenderPass?.[i.currentRenderPassId];if(n)return n.isReadyForSubMesh(s,e,t);const o=e.getMaterial();if(!o||o.disableDepthWrite)return!1;const a=[],h=[Mt.R.PositionKind];let l=!1,c=!1;o.needAlphaTestingForMesh(s)&&o.getAlphaTestTexture()&&(a.push("#define ALPHATEST"),s.isVerticesDataPresent(Mt.R.UVKind)&&(h.push(Mt.R.UVKind),a.push("#define UV1"),l=!0),s.isVerticesDataPresent(Mt.R.UV2Kind)&&(h.push(Mt.R.UV2Kind),a.push("#define UV2"),c=!0));const u=new Nt.J;if(s.useBones&&s.computeBonesUsingShaders&&s.skeleton){h.push(Mt.R.MatricesIndicesKind),h.push(Mt.R.MatricesWeightsKind),s.numBoneInfluencers>4&&(h.push(Mt.R.MatricesIndicesExtraKind),h.push(Mt.R.MatricesWeightsExtraKind)),a.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),s.numBoneInfluencers>0&&u.addCPUSkinningFallback(0,s);const e=s.skeleton;e.isUsingTextureForMatrices?a.push("#define BONETEXTURE"):a.push("#define BonesPerMesh "+(e.bones.length+1))}else a.push("#define NUM_BONE_INFLUENCERS 0");const d=s.morphTargetManager?(0,Ut.Dk)(s.morphTargetManager,a,h,s,!0,!1,!1,l,c,!1):0;o.pointsCloud&&a.push("#define POINTSIZE"),t&&(a.push("#define INSTANCES"),(0,Ut.te)(h),e.getRenderingMesh().hasThinInstances&&a.push("#define THIN_INSTANCES"));const _=s.bakedVertexAnimationManager;_&&_.isEnabled&&(a.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),t&&h.push("bakedVertexAnimationSettingsInstanced")),this._storeNonLinearDepth&&a.push("#define NONLINEARDEPTH"),this._storeCameraSpaceZ&&a.push("#define STORE_CAMERASPACE_Z"),this.isPacked&&a.push("#define PACKED"),(0,kt.tv)(o,r,a);const p=e._getDrawWrapper(void 0,!0),g=p.defines,f=a.join("\n");if(g!==f){const e=["world","mBones","boneTextureWidth","pointSize","viewProjection","view","diffuseMatrix","depthValues","morphTargetInfluences","morphTargetCount","morphTargetTextureInfo","morphTargetTextureIndices","bakedVertexAnimationSettings","bakedVertexAnimationTextureSizeInverted","bakedVertexAnimationTime","bakedVertexAnimationTexture"],t=["diffuseSampler","morphTargets","boneSampler","bakedVertexAnimationTexture"];(0,kt.TV)(e),p.setEffect(i.createEffect("depth",{attributes:h,uniformsNames:e,uniformBuffersNames:[],samplers:t,defines:f,fallbacks:u,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:d},shaderLanguage:this._shaderLanguage},i),f)}return p.effect.isReady()}getDepthMap(){return this._depthMap}dispose(){const e=[];for(const t in this._scene._depthRenderer)this._scene._depthRenderer[t]===this&&e.push(t);if(e.length>0){this._depthMap.dispose();for(const t of e)delete this._scene._depthRenderer[t]}}}Pa.ForceGLSL=!1,Pa._SceneComponentInitialization=e=>{throw(0,Aa.n)("DepthRendererSceneComponent")};var Ia=o(8442),Ma=o(4796);Ma.l.ShadersStore.minmaxReduxPixelShader="varying vec2 vUV;uniform sampler2D textureSampler;\n#if defined(INITIAL)\nuniform sampler2D sourceTexture;uniform vec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*(texSize-1.0));float f1=texelFetch(sourceTexture,coord,0).r;float f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;float f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;float f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;float minz=min(min(min(f1,f2),f3),f4);\n#ifdef DEPTH_REDUX\nfloat maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);\n#else\nfloat maxz=max(max(max(f1,f2),f3),f4);\n#endif\nglFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(MAIN)\nuniform vec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*(texSize-1.0));vec2 f1=texelFetch(textureSampler,coord,0).rg;vec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;vec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;vec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;float minz=min(min(min(f1.x,f2.x),f3.x),f4.x);float maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);glFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(ONEBEFORELAST)\nuniform ivec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*vec2(texSize-1));vec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;vec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;vec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;vec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;float minz=min(f1.x,f2.x);float maxz=max(f1.y,f2.y);glFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(LAST)\nvoid main(void)\n{glFragColor=vec4(0.);if (true) { \ndiscard;}}\n#endif\n";class wa{constructor(e){this.onAfterReductionPerformed=new Zi.cP,this._forceFullscreenViewport=!0,this._activated=!1,this._camera=e,this._postProcessManager=new Ia.X(e.getScene()),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add((()=>{this._postProcessManager._rebuild()}))}get sourceTexture(){return this._sourceTexture}setSourceTexture(e,t,i=2,s=!0){if(e===this._sourceTexture)return;this.dispose(!1),this._sourceTexture=e,this._reductionSteps=[],this._forceFullscreenViewport=s;const r=this._camera.getScene(),n=new va.w("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,1,r.getEngine(),!1,"#define INITIAL"+(t?"\n#define DEPTH_REDUX":""),i,void 0,void 0,void 0,7);n.autoClear=!1,n.forceFullscreenViewport=s;let o=this._sourceTexture.getRenderWidth(),a=this._sourceTexture.getRenderHeight();n.onApply=((e,t)=>i=>{i.setTexture("sourceTexture",this._sourceTexture),i.setFloat2("texSize",e,t)})(o,a),this._reductionSteps.push(n);let h=1;for(;o>1||a>1;){o=Math.max(Math.round(o/2),1),a=Math.max(Math.round(a/2),1);const e=new va.w("Reduction phase "+h,"minmaxRedux",["texSize"],null,{width:o,height:a},null,1,r.getEngine(),!1,"#define "+(1==o&&1==a?"LAST":1==o||1==a?"ONEBEFORELAST":"MAIN"),i,void 0,void 0,void 0,7);if(e.autoClear=!1,e.forceFullscreenViewport=s,e.onApply=((e,t)=>i=>{1==e||1==t?i.setInt2("texSize",e,t):i.setFloat2("texSize",e,t)})(o,a),this._reductionSteps.push(e),h++,1==o&&1==a){const t=(e,t,i)=>{const s=new Float32Array(4*e*t),n={min:0,max:0};return()=>{r.getEngine()._readTexturePixels(i.inputTexture.texture,e,t,-1,0,s,!1),n.min=s[0],n.max=s[1],this.onAfterReductionPerformed.notifyObservers(n)}};e.onAfterRenderObservable.add(t(o,a,e))}}}get refreshRate(){return this._sourceTexture?this._sourceTexture.refreshRate:-1}set refreshRate(e){this._sourceTexture&&(this._sourceTexture.refreshRate=e)}get activated(){return this._activated}activate(){!this._onAfterUnbindObserver&&this._sourceTexture&&(this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add((()=>{const e=this._camera.getScene().getEngine();e._debugPushGroup?.("min max reduction",1),this._reductionSteps[0].activate(this._camera),this._postProcessManager.directRender(this._reductionSteps,this._reductionSteps[0].inputTexture,this._forceFullscreenViewport),e.unBindFramebuffer(this._reductionSteps[0].inputTexture,!1),e._debugPopGroup?.(1)})),this._activated=!0)}deactivate(){this._onAfterUnbindObserver&&this._sourceTexture&&(this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=null,this._activated=!1)}dispose(e=!0){if(e&&(this.onAfterReductionPerformed.clear(),this._onContextRestoredObserver&&(this._camera.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)),this.deactivate(),this._reductionSteps){for(let e=0;e<this._reductionSteps.length;++e)this._reductionSteps[e].dispose();this._reductionSteps=null}this._postProcessManager&&e&&this._postProcessManager.dispose(),this._sourceTexture=null}}class Oa extends wa{get depthRenderer(){return this._depthRenderer}constructor(e){super(e)}setDepthRenderer(e=null,t=2,i=!0){const s=this._camera.getScene();this._depthRenderer&&(delete s._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null),null===e&&(s._depthRenderer||(s._depthRenderer={}),(e=this._depthRenderer=new Pa(s,t,this._camera,!1,1)).enabled=!1,this._depthRendererId="minmax"+this._camera.id,s._depthRenderer[this._depthRendererId]=e),super.setSourceTexture(e.getDepthMap(),!0,t,i)}setSourceTexture(e,t,i=2,s=!0){super.setSourceTexture(e,t,i,s)}activate(){this._depthRenderer&&(this._depthRenderer.enabled=!0),super.activate()}deactivate(){super.deactivate(),this._depthRenderer&&(this._depthRenderer.enabled=!1)}dispose(e=!0){if(super.dispose(e),this._depthRenderer&&e){const e=this._depthRenderer.getDepthMap().getScene();e&&delete e._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null}}}const Ba=gt.Pq.Up(),Da=gt.Pq.Zero(),Fa=new gt.Pq,La=new gt.Pq,Na=new gt.uq;class ka extends Sa{_validateFilter(e){return e===Sa.FILTER_NONE||e===Sa.FILTER_PCF||e===Sa.FILTER_PCSS?e:(It.V.Error('Unsupported filter "'+e+'"!'),Sa.FILTER_NONE)}get numCascades(){return this._numCascades}set numCascades(e){(e=Math.min(Math.max(e,ka.MIN_CASCADES_COUNT),ka.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=e,this.recreateShadowMap(),this._recreateSceneUBOs())}get freezeShadowCastersBoundingInfo(){return this._freezeShadowCastersBoundingInfo}set freezeShadowCastersBoundingInfo(e){this._freezeShadowCastersBoundingInfoObservable&&e&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||e||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add((()=>this._computeShadowCastersBoundingInfo()))),this._freezeShadowCastersBoundingInfo=e,e&&this._computeShadowCastersBoundingInfo()}_computeShadowCastersBoundingInfo(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._shadowMap&&this._shadowMap.renderList){const e=this._shadowMap.renderList;for(let t=0;t<e.length;t++){const i=e[t];if(!i)continue;const s=i.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(s.minimumWorld),this._scbiMax.maximizeInPlace(s.maximumWorld)}const t=this._scene.meshes;for(let e=0;e<t.length;e++){const i=t[e];if(!(i&&i.isVisible&&i.isEnabled&&i.receiveShadows))continue;const s=i.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(s.minimumWorld),this._scbiMax.maximizeInPlace(s.maximumWorld)}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)}get shadowCastersBoundingInfo(){return this._shadowCastersBoundingInfo}set shadowCastersBoundingInfo(e){this._shadowCastersBoundingInfo=e}setMinMaxDistance(e,t){this._minDistance===e&&this._maxDistance===t||(e>t&&(e=0,t=1),e<0&&(e=0),t>1&&(t=1),this._minDistance=e,this._maxDistance=t,this._breaksAreDirty=!0)}get minDistance(){return this._minDistance}get maxDistance(){return this._maxDistance}getClassName(){return ka.CLASSNAME}getCascadeMinExtents(e){return e>=0&&e<this._numCascades?this._cascadeMinExtents[e]:null}getCascadeMaxExtents(e){return e>=0&&e<this._numCascades?this._cascadeMaxExtents[e]:null}get shadowMaxZ(){return this._getCamera()?this._shadowMaxZ:0}set shadowMaxZ(e){const t=this._getCamera();t?this._shadowMaxZ===e||e<t.minZ||e>t.maxZ&&0!==t.maxZ||(this._shadowMaxZ=e,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=e}get debug(){return this._debug}set debug(e){this._debug=e,this._light._markMeshesAsLightDirty()}get depthClamp(){return this._depthClamp}set depthClamp(e){this._depthClamp=e}get cascadeBlendPercentage(){return this._cascadeBlendPercentage}set cascadeBlendPercentage(e){this._cascadeBlendPercentage=e,this._light._markMeshesAsLightDirty()}get lambda(){return this._lambda}set lambda(e){const t=Math.min(Math.max(e,0),1);this._lambda!=t&&(this._lambda=t,this._breaksAreDirty=!0)}getCascadeViewMatrix(e){return e>=0&&e<this._numCascades?this._viewMatrices[e]:null}getCascadeProjectionMatrix(e){return e>=0&&e<this._numCascades?this._projectionMatrices[e]:null}getCascadeTransformMatrix(e){return e>=0&&e<this._numCascades?this._transformMatrices[e]:null}setDepthRenderer(e){this._depthRenderer=e,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)}get autoCalcDepthBounds(){return this._autoCalcDepthBounds}set autoCalcDepthBounds(e){const t=this._getCamera();if(t){if(this._autoCalcDepthBounds=e,!e)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new Oa(t),this._depthReducer.onAfterReductionPerformed.add((e=>{let t=e.min,i=e.max;t>=i&&(t=0,i=1),t==this._minDistance&&i==this._maxDistance||this.setMinMaxDistance(t,i)})),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}}get autoCalcDepthBoundsRefreshRate(){return this._depthReducer?.depthRenderer?.getDepthMap().refreshRate??-1}set autoCalcDepthBoundsRefreshRate(e){this._depthReducer?.depthRenderer&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=e)}splitFrustum(){this._breaksAreDirty=!0}_splitFrustum(){const e=this._getCamera();if(!e)return;const t=e.minZ,i=e.maxZ||this._shadowMaxZ,s=i-t,r=this._minDistance,n=t+r*s,o=t+(this._shadowMaxZ<i&&this._shadowMaxZ>=t?Math.min((this._shadowMaxZ-t)/(i-t),this._maxDistance):this._maxDistance)*s,a=o-n,h=o/n;for(let e=0;e<this._cascades.length;++e){const i=(e+1)/this._numCascades,o=n*h**i,l=n+a*i,c=this._lambda*(o-l)+l;this._cascades[e].prevBreakDistance=0===e?r:this._cascades[e-1].breakDistance,this._cascades[e].breakDistance=(c-t)/s,this._viewSpaceFrustumsZ[e]=c,this._frustumLengths[e]=(this._cascades[e].breakDistance-this._cascades[e].prevBreakDistance)*s}this._breaksAreDirty=!1}_computeMatrices(){const e=this._scene;if(!this._getCamera())return;gt.Pq.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),1===Math.abs(gt.Pq.Dot(this._lightDirection,gt.Pq.Up()))&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);const t=e.getEngine().useReverseDepthBuffer;for(let i=0;i<this._numCascades;++i){this._computeFrustumInWorldSpace(i),this._computeCascadeFrustum(i),this._cascadeMaxExtents[i].subtractToRef(this._cascadeMinExtents[i],Fa),this._frustumCenter[i].addToRef(this._lightDirection.scale(this._cascadeMinExtents[i].z),this._shadowCameraPos[i]),gt.uq.LookAtLHToRef(this._shadowCameraPos[i],this._frustumCenter[i],Ba,this._viewMatrices[i]);let s=0,r=Fa.z;const n=this._shadowCastersBoundingInfo;n.update(this._viewMatrices[i]),r=Math.min(r,n.boundingBox.maximumWorld.z),s=this._depthClamp&&this.filter!==Sa.FILTER_PCSS?Math.max(s,n.boundingBox.minimumWorld.z):Math.min(s,n.boundingBox.minimumWorld.z),gt.uq.OrthoOffCenterLHToRef(this._cascadeMinExtents[i].x,this._cascadeMaxExtents[i].x,this._cascadeMinExtents[i].y,this._cascadeMaxExtents[i].y,t?r:s,t?s:r,this._projectionMatrices[i],e.getEngine().isNDCHalfZRange),this._cascadeMinExtents[i].z=s,this._cascadeMaxExtents[i].z=r,this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),gt.Pq.TransformCoordinatesToRef(Da,this._transformMatrices[i],Fa),Fa.scaleInPlace(this._mapSize/2),La.copyFromFloats(Math.round(Fa.x),Math.round(Fa.y),Math.round(Fa.z)),La.subtractInPlace(Fa).scaleInPlace(2/this._mapSize),gt.uq.TranslationToRef(La.x,La.y,0,Na),this._projectionMatrices[i].multiplyToRef(Na,this._projectionMatrices[i]),this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),this._transformMatrices[i].copyToArray(this._transformMatricesAsArray,16*i)}}_computeFrustumInWorldSpace(e){const t=this._getCamera();if(!t)return;const i=this._cascades[e].prevBreakDistance,s=this._cascades[e].breakDistance,r=this._scene.getEngine().isNDCHalfZRange;t.getViewMatrix();const n=0===t.maxZ,o=t.maxZ;n&&(t.maxZ=this._shadowMaxZ,t.getProjectionMatrix(!0));const a=gt.uq.Invert(t.getTransformationMatrix());n&&(t.maxZ=o,t.getProjectionMatrix(!0));const h=this._scene.getEngine().useReverseDepthBuffer?4:0;for(let t=0;t<ka._FrustumCornersNDCSpace.length;++t)Fa.copyFrom(ka._FrustumCornersNDCSpace[(t+h)%ka._FrustumCornersNDCSpace.length]),r&&-1===Fa.z&&(Fa.z=0),gt.Pq.TransformCoordinatesToRef(Fa,a,this._frustumCornersWorldSpace[e][t]);for(let t=0;t<ka._FrustumCornersNDCSpace.length/2;++t)Fa.copyFrom(this._frustumCornersWorldSpace[e][t+4]).subtractInPlace(this._frustumCornersWorldSpace[e][t]),La.copyFrom(Fa).scaleInPlace(i),Fa.scaleInPlace(s),Fa.addInPlace(this._frustumCornersWorldSpace[e][t]),this._frustumCornersWorldSpace[e][t+4].copyFrom(Fa),this._frustumCornersWorldSpace[e][t].addInPlace(La)}_computeCascadeFrustum(e){if(this._cascadeMinExtents[e].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[e].copyFromFloats(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._frustumCenter[e].copyFromFloats(0,0,0),this._getCamera()){for(let t=0;t<this._frustumCornersWorldSpace[e].length;++t)this._frustumCenter[e].addInPlace(this._frustumCornersWorldSpace[e][t]);if(this._frustumCenter[e].scaleInPlace(1/this._frustumCornersWorldSpace[e].length),this.stabilizeCascades){let t=0;for(let i=0;i<this._frustumCornersWorldSpace[e].length;++i){const s=this._frustumCornersWorldSpace[e][i].subtractToRef(this._frustumCenter[e],Fa).length();t=Math.max(t,s)}t=Math.ceil(16*t)/16,this._cascadeMaxExtents[e].copyFromFloats(t,t,t),this._cascadeMinExtents[e].copyFromFloats(-t,-t,-t)}else{const t=this._frustumCenter[e];this._frustumCenter[e].addToRef(this._lightDirection,Fa),gt.uq.LookAtLHToRef(t,Fa,Ba,Na);for(let t=0;t<this._frustumCornersWorldSpace[e].length;++t)gt.Pq.TransformCoordinatesToRef(this._frustumCornersWorldSpace[e][t],Na,Fa),this._cascadeMinExtents[e].minimizeInPlace(Fa),this._cascadeMaxExtents[e].maximizeInPlace(Fa)}}}_recreateSceneUBOs(){if(this._disposeSceneUBOs(),this._sceneUBOs)for(let e=0;e<this._numCascades;++e)this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for CSM Shadow Generator (light "${this._light.name}" cascade #${e})`))}static get IsSupported(){const e=os.q.LastCreatedEngine;return!!e&&e._features.supportCSM}constructor(e,t,i,s,r=!0){ka.IsSupported?(super(e,t,i,s,r),this.usePercentageCloserFiltering=!0):It.V.Error("CascadedShadowMap is not supported by the current engine.")}_initializeGenerator(){this.penumbraDarkness=this.penumbraDarkness??1,this._numCascades=this._numCascades??ka.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=this.stabilizeCascades??!1,this._freezeShadowCastersBoundingInfoObservable=this._freezeShadowCastersBoundingInfoObservable??null,this.freezeShadowCastersBoundingInfo=this.freezeShadowCastersBoundingInfo??!1,this._scbiMin=this._scbiMin??new gt.Pq(0,0,0),this._scbiMax=this._scbiMax??new gt.Pq(0,0,0),this._shadowCastersBoundingInfo=this._shadowCastersBoundingInfo??new Ea.j(new gt.Pq(0,0,0),new gt.Pq(0,0,0)),this._breaksAreDirty=this._breaksAreDirty??!0,this._minDistance=this._minDistance??0,this._maxDistance=this._maxDistance??1,this._currentLayer=this._currentLayer??0,this._shadowMaxZ=this._shadowMaxZ??this._getCamera()?.maxZ??1e4,this._debug=this._debug??!1,this._depthClamp=this._depthClamp??!0,this._cascadeBlendPercentage=this._cascadeBlendPercentage??.1,this._lambda=this._lambda??.5,this._autoCalcDepthBounds=this._autoCalcDepthBounds??!1,this._recreateSceneUBOs(),super._initializeGenerator()}_createTargetRenderTexture(){const e=this._scene.getEngine(),t={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new ba.$(this._light.name+"_CSMShadowMap",t,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0,this._useRedTextureType?6:5),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0,void 0,void 0,void 0,`DepthStencilForCSMShadowGenerator-${this._light.name}`),this._shadowMap.noPrePassRenderer=!0}_initializeShadowMap(){if(super._initializeShadowMap(),null===this._shadowMap)return;this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(let e=0;e<this._numCascades;++e){this._cascades[e]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[e]=gt.uq.Zero(),this._projectionMatrices[e]=gt.uq.Zero(),this._transformMatrices[e]=gt.uq.Zero(),this._cascadeMinExtents[e]=new gt.Pq,this._cascadeMaxExtents[e]=new gt.Pq,this._frustumCenter[e]=new gt.Pq,this._shadowCameraPos[e]=new gt.Pq,this._frustumCornersWorldSpace[e]=new Array(ka._FrustumCornersNDCSpace.length);for(let t=0;t<ka._FrustumCornersNDCSpace.length;++t)this._frustumCornersWorldSpace[e][t]=new gt.Pq}const e=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.clear(),this._shadowMap.onBeforeRenderObservable.clear(),this._shadowMap.onBeforeRenderObservable.add((t=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[t]),this._currentLayer=t,this._filter===Sa.FILTER_PCF&&e.setColorWrite(!1),this._scene.setTransformMatrix(this.getCascadeViewMatrix(t),this.getCascadeProjectionMatrix(t)),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onBeforeBindObservable.add((()=>{this._currentSceneUBO=this._scene.getSceneUniformBuffer(),e._debugPushGroup?.(`cascaded shadow map generation for pass id ${e.currentRenderPassId}`,1),this._breaksAreDirty&&this._splitFrustum(),this._computeMatrices()})),this._splitFrustum()}_bindCustomEffectForRenderSubMeshForShadowMap(e,t){t.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer))}_isReadyCustomDefines(e){e.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==Sa.FILTER_PCSS?"1":"0"))}prepareDefines(e,t){super.prepareDefines(e,t);const i=this._scene,s=this._light;if(!i.shadowsEnabled||!s.shadowEnabled)return;e["SHADOWCSM"+t]=!0,e["SHADOWCSMDEBUG"+t]=this.debug,e["SHADOWCSMNUM_CASCADES"+t]=this.numCascades,e["SHADOWCSM_RIGHTHANDED"+t]=i.useRightHandedSystem;const r=this._getCamera();r&&this._shadowMaxZ<=(r.maxZ||this._shadowMaxZ)&&(e["SHADOWCSMUSESHADOWMAXZ"+t]=!0),0===this.cascadeBlendPercentage&&(e["SHADOWCSMNOBLEND"+t]=!0)}bindShadowLight(e,t){const i=this._light;if(!this._scene.shadowsEnabled||!i.shadowEnabled)return;const s=this._getCamera();if(!s)return;const r=this.getShadowMap();if(!r)return;const n=r.getSize().width;if(t.setMatrices("lightMatrix"+e,this._transformMatricesAsArray),t.setArray("viewFrustumZ"+e,this._viewSpaceFrustumsZ),t.setFloat("cascadeBlendFactor"+e,0===this.cascadeBlendPercentage?1e4:1/this.cascadeBlendPercentage),t.setArray("frustumLengths"+e,this._frustumLengths),this._filter===Sa.FILTER_PCF)t.setDepthStencilTexture("shadowTexture"+e,r),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),n,1/n,this.frustumEdgeFalloff,e);else if(this._filter===Sa.FILTER_PCSS){for(let e=0;e<this._numCascades;++e)this._lightSizeUVCorrection[2*e+0]=0===e?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[e].x-this._cascadeMinExtents[e].x),this._lightSizeUVCorrection[2*e+1]=0===e?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[e].y-this._cascadeMinExtents[e].y),this._depthCorrection[e]=0===e?1:(this._cascadeMaxExtents[e].z-this._cascadeMinExtents[e].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);t.setDepthStencilTexture("shadowTexture"+e,r),t.setTexture("depthTexture"+e,r),t.setArray2("lightSizeUVCorrection"+e,this._lightSizeUVCorrection),t.setArray("depthCorrection"+e,this._depthCorrection),t.setFloat("penumbraDarkness"+e,this.penumbraDarkness),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/n,this._contactHardeningLightSizeUVRatio*n,this.frustumEdgeFalloff,e)}else t.setTexture("shadowTexture"+e,r),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),n,1/n,this.frustumEdgeFalloff,e);i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(s),this.getLight().getDepthMinZ(s)+this.getLight().getDepthMaxZ(s),e)}getTransformMatrix(){return this.getCascadeTransformMatrix(0)}dispose(){super.dispose(),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)}serialize(){const e=super.serialize(),t=this.getShadowMap();if(!t)return e;if(e.numCascades=this._numCascades,e.debug=this._debug,e.stabilizeCascades=this.stabilizeCascades,e.lambda=this._lambda,e.cascadeBlendPercentage=this.cascadeBlendPercentage,e.depthClamp=this._depthClamp,e.autoCalcDepthBounds=this.autoCalcDepthBounds,e.shadowMaxZ=this._shadowMaxZ,e.penumbraDarkness=this.penumbraDarkness,e.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.renderList=[],t.renderList)for(let i=0;i<t.renderList.length;i++){const s=t.renderList[i];e.renderList.push(s.id)}return e}static Parse(e,t){const i=Sa.Parse(e,t,((e,t,i)=>new ka(e,t,void 0,i)));return void 0!==e.numCascades&&(i.numCascades=e.numCascades),void 0!==e.debug&&(i.debug=e.debug),void 0!==e.stabilizeCascades&&(i.stabilizeCascades=e.stabilizeCascades),void 0!==e.lambda&&(i.lambda=e.lambda),void 0!==e.cascadeBlendPercentage&&(i.cascadeBlendPercentage=e.cascadeBlendPercentage),void 0!==e.depthClamp&&(i.depthClamp=e.depthClamp),void 0!==e.autoCalcDepthBounds&&(i.autoCalcDepthBounds=e.autoCalcDepthBounds),void 0!==e.shadowMaxZ&&(i.shadowMaxZ=e.shadowMaxZ),void 0!==e.penumbraDarkness&&(i.penumbraDarkness=e.penumbraDarkness),void 0!==e.freezeShadowCastersBoundingInfo&&(i.freezeShadowCastersBoundingInfo=e.freezeShadowCastersBoundingInfo),void 0!==e.minDistance&&void 0!==e.maxDistance&&i.setMinMaxDistance(e.minDistance,e.maxDistance),i}}ka._FrustumCornersNDCSpace=[new gt.Pq(-1,1,-1),new gt.Pq(1,1,-1),new gt.Pq(1,-1,-1),new gt.Pq(-1,-1,-1),new gt.Pq(-1,1,1),new gt.Pq(1,1,1),new gt.Pq(1,-1,1),new gt.Pq(-1,-1,1)],ka.CLASSNAME="CascadedShadowGenerator",ka.DEFAULT_CASCADES_COUNT=4,ka.MIN_CASCADES_COUNT=2,ka.MAX_CASCADES_COUNT=4,ka._SceneComponentInitialization=e=>{throw(0,Aa.n)("ShadowGeneratorSceneComponent")},(0,o(866).ji)(hs.v.NAME_SHADOWGENERATOR,((e,t)=>{if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(let i=0,s=e.shadowGenerators.length;i<s;i++){const s=e.shadowGenerators[i];s.className===ka.CLASSNAME?ka.Parse(s,t):Sa.Parse(s,t)}}));class Ua{constructor(e){this.name=hs.v.NAME_SHADOWGENERATOR,this.scene=e}register(){this.scene._gatherRenderTargetsStage.registerStep(hs.v.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)}rebuild(){}serialize(e){e.shadowGenerators=[];const t=this.scene.lights;for(const i of t){if(i.doNotSerialize)continue;const t=i.getShadowGenerators();if(t){const i=t.values();for(let t=i.next();!0!==t.done;t=i.next()){const i=t.value;i.doNotSerialize||e.shadowGenerators.push(i.serialize())}}}}addFromContainer(e){}removeFromContainer(e,t){}dispose(){}_gatherRenderTargets(e){const t=this.scene;if(this.scene.shadowsEnabled)for(let i=0;i<t.lights.length;i++){const s=t.lights[i],r=s.getShadowGenerators();if(s.isEnabled()&&s.shadowEnabled&&r){const i=r.values();for(let s=i.next();!0!==s.done;s=i.next()){const i=s.value.getShadowMap();-1!==t.textures.indexOf(i)&&e.push(i)}}}}}Sa._SceneComponentInitialization=e=>{let t=e._getComponent(hs.v.NAME_SHADOWGENERATOR);t||(t=new Ua(e),e._addComponent(t))};class Va{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw(0,Aa.n)("CannonJSPlugin")}constructor(e,t=Va.DefaultPluginFactory()){if(this._physicsPlugin=t,this._impostors=[],this._joints=[],this._subTimeStep=0,this._uniqueIdCounter=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");e=e||new gt.Pq(0,-9.807,0),this.setGravity(e),this.setTimeStep()}setGravity(e){this.gravity=e,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(e=1/60){this._physicsPlugin.setTimeStep(e)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(e=0){this._subTimeStep=e}getSubTimeStep(){return this._subTimeStep}dispose(){this._impostors.forEach((function(e){e.dispose()})),this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}addImpostor(e){this._impostors.push(e),e.uniqueId=this._uniqueIdCounter++,e.parent||this._physicsPlugin.generatePhysicsBody(e)}removeImpostor(e){const t=this._impostors.indexOf(e);t>-1&&this._impostors.splice(t,1).length&&this.getPhysicsPlugin().removePhysicsBody(e)}addJoint(e,t,i){const s={mainImpostor:e,connectedImpostor:t,joint:i};i.physicsPlugin=this._physicsPlugin,this._joints.push(s),this._physicsPlugin.generateJoint(s)}removeJoint(e,t,i){const s=this._joints.filter((function(s){return s.connectedImpostor===t&&s.joint===i&&s.mainImpostor===e}));s.length&&this._physicsPlugin.removeJoint(s[0])}_step(e){this._impostors.forEach((e=>{e.isBodyInitRequired()&&this._physicsPlugin.generatePhysicsBody(e)})),e>.1?e=.1:e<=0&&(e=1/60),this._physicsPlugin.executeStep(e,this._impostors)}getPhysicsPlugin(){return this._physicsPlugin}getImpostors(){return this._impostors}getImpostorForPhysicsObject(e){for(let t=0;t<this._impostors.length;++t)if(this._impostors[t].object===e)return this._impostors[t];return null}getImpostorWithPhysicsBody(e){for(let t=0;t<this._impostors.length;++t)if(this._impostors[t].physicsBody===e)return this._impostors[t];return null}raycast(e,t){return this._physicsPlugin.raycast(e,t)}raycastToRef(e,t,i){return this._physicsPlugin.raycastToRef(e,t,i)}}class Ga{constructor(){this._hasHit=!1,this._hitNormal=gt.Pq.Zero(),this._hitPoint=gt.Pq.Zero(),this._triangleIndex=-1}get hitPoint(){return this._hitPoint}get hitNormal(){return this._hitNormal}get hasHit(){return this._hasHit}get triangleIndex(){return this._triangleIndex}setHitData(e,t,i){this._hasHit=!0,this._hitNormal.set(e.x,e.y,e.z),this._hitPoint.set(t.x,t.y,t.z),this._triangleIndex=i??-1}reset(){this._hasHit=!1,this._hitNormal.setAll(0),this._hitPoint.setAll(0),this._triangleIndex=-1,this.body=void 0,this.bodyIndex=void 0,this.shape=void 0}}class za extends Ga{constructor(){super(...arguments),this._hitDistance=0,this._rayFromWorld=gt.Pq.Zero(),this._rayToWorld=gt.Pq.Zero()}get hitDistance(){return this._hitDistance}get hitNormalWorld(){return this._hitNormal}get hitPointWorld(){return this._hitPoint}get rayFromWorld(){return this._rayFromWorld}get rayToWorld(){return this._rayToWorld}setHitDistance(e){this._hitDistance=e}calculateHitDistance(){this._hitDistance=gt.Pq.Distance(this._rayFromWorld,this._hitPoint)}reset(e=gt.Pq.Zero(),t=gt.Pq.Zero()){super.reset(),this._rayFromWorld.copyFrom(e),this._rayToWorld.copyFrom(t),this._hitDistance=0}}class Ha{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw(0,Aa.n)("")}constructor(e,t=Ha.DefaultPluginFactory()){this._physicsPlugin=t,this._physicsBodies=[],this._subTimeStep=0,e=e||new gt.Pq(0,-9.807,0),this.setGravity(e),this.setTimeStep()}setGravity(e){this.gravity=e,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(e=1/60){this._physicsPlugin.setTimeStep(e)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(e=0){this._subTimeStep=e}getSubTimeStep(){return this._subTimeStep}dispose(){this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}setVelocityLimits(e,t){this._physicsPlugin.setVelocityLimits(e,t)}getMaxLinearVelocity(){return this._physicsPlugin.getMaxLinearVelocity()}getMaxAngularVelocity(){return this._physicsPlugin.getMaxAngularVelocity()}_step(e){e>.1?e=.1:e<=0&&(e=1/60),this._physicsPlugin.executeStep(e,this._physicsBodies)}addBody(e){this._physicsBodies.push(e)}removeBody(e){const t=this._physicsBodies.indexOf(e);t>-1&&this._physicsBodies.splice(t,1)}getBodies(){return this._physicsBodies}getPhysicsPlugin(){return this._physicsPlugin}raycastToRef(e,t,i,s){this._physicsPlugin.raycast(e,t,i,s)}raycast(e,t,i){const s=new za;return this._physicsPlugin.raycast(e,t,s,i),s}}Ie.Z.prototype.getPhysicsEngine=function(){return this._physicsEngine},Ie.Z.prototype.enablePhysics=function(e=null,t){if(this._physicsEngine)return!0;let i=this._getComponent(hs.v.NAME_PHYSICSENGINE);i||(i=new Wa(this),this._addComponent(i));try{if(t&&1!==t?.getPluginVersion()){if(2!==t?.getPluginVersion())throw new Error("Unsupported Physics plugin version.");this._physicsEngine=new Ha(e,t)}else this._physicsEngine=new Va(e,t);return this._physicsTimeAccumulator=0,!0}catch(e){return It.V.Error(e.message),!1}},Ie.Z.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},Ie.Z.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},Ie.Z.prototype.deleteCompoundImpostor=function(e){const t=e.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},Ie.Z.prototype._advancePhysicsEngineStep=function(e){if(this._physicsEngine){const t=this._physicsEngine.getSubTimeStep();if(t>0)for(this._physicsTimeAccumulator+=e;this._physicsTimeAccumulator>t;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=t;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}};class Wa{constructor(e){this.name=hs.v.NAME_PHYSICSENGINE,this.scene=e,this.scene.onBeforePhysicsObservable=new Zi.cP,this.scene.onAfterPhysicsObservable=new Zi.cP,this.scene.getDeterministicFrameTime=()=>this.scene._physicsEngine?1e3*this.scene._physicsEngine.getTimeStep():1e3/60}register(){}rebuild(){}dispose(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()}}o(3785),o(4366);var Xa=o(4292);Xa.b.AddNodeConstructor("Light_Type_3",((e,t)=>()=>new qa(e,gt.Pq.Zero(),t)));class qa extends ma.v{constructor(e,t,i){super(e,i),this.groundColor=new bt.v9(0,0,0),this.direction=t||gt.Pq.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"HemisphericLight"}setDirectionToTarget(e){return this.direction=gt.Pq.Normalize(e.subtract(gt.Pq.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(e,t){const i=gt.Pq.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this}transferToNodeMaterialEffect(e,t){const i=gt.Pq.Normalize(this.direction);return e.setFloat3(t,i.x,i.y,i.z),this}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=gt.uq.Identity()),this._worldMatrix}getTypeID(){return ma.v.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(e,t){e["HEMILIGHT"+t]=!0}}(0,Et.Cg)([(0,Rt.jT)()],qa.prototype,"groundColor",void 0),(0,Et.Cg)([(0,Rt.P_)()],qa.prototype,"direction",void 0),(0,Ft.Y5)("BABYLON.HemisphericLight",qa);var Qa=o(8827);class Ka{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(e){this._idleRotationSpeed=e}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(e){this._idleRotationWaitTime=e}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(e){this._idleRotationSpinupTime=e}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(e){this._attachedCamera=e;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver=t.onPrePointerObservable.add((e=>{e.type!==tt.Zp.POINTERDOWN?e.type===tt.Zp.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const e=Qa.j.Now;let t=0;null!=this._lastFrameTime&&(t=e-this._lastFrameTime),this._lastFrameTime=e,this._applyUserInteraction();const i=e-this._lastInteractionTime-this._idleRotationWaitTime,s=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*s,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(t/1e3))}))}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(e){this._lastInteractionTime=e??Qa.j.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<bs.bH}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Qa.j.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}class Ya{constructor(){this._easingMode=Ya.EASINGMODE_EASEIN}setEasingMode(e){const t=Math.min(Math.max(e,0),2);this._easingMode=t}getEasingMode(){return this._easingMode}easeInCore(e){throw new Error("You must implement this method")}ease(e){switch(this._easingMode){case Ya.EASINGMODE_EASEIN:return this.easeInCore(e);case Ya.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return e>=.5?.5*(1-this.easeInCore(2*(1-e)))+.5:.5*this.easeInCore(2*e)}}Ya.EASINGMODE_EASEIN=0,Ya.EASINGMODE_EASEOUT=1,Ya.EASINGMODE_EASEINOUT=2;class ja extends Ya{easeInCore(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)}}class Za extends Ya{easeInCore(e){return e*e}}class $a extends Ya{easeInCore(e){return 1-Math.sin(1.5707963267948966*(1-e))}}var Ja=o(6618);class eh{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(e){if(this._autoTransitionRange===e)return;this._autoTransitionRange=e;const t=this._attachedCamera;t&&(e?this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((e=>{if(e&&(e.computeWorldMatrix(!0),e.getBoundingInfo)){const t=e.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*t,this.upperRadiusTransitionRange=.05*t}})):this._onMeshTargetChangedObserver&&t.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(e){this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(e){return!!this._attachedCamera&&this._attachedCamera.radius===e&&!this._radiusIsAnimating}_applyBoundRadiusAnimation(e){if(!this._attachedCamera)return;this._radiusBounceTransition||(eh.EasingFunction.setEasingMode(eh.EasingMode),this._radiusBounceTransition=Ja.X5.CreateAnimation("radius",Ja.X5.ANIMATIONTYPE_FLOAT,60,eh.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const t=Ja.X5.TransitionTo("radius",this._attachedCamera.radius+e,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));t&&this._animatables.push(t)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}eh.EasingFunction=new class extends Ya{constructor(e=1){super(),this.amplitude=e}easeInCore(e){const t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)}}(.3),eh.EasingMode=Ya.EASINGMODE_EASEOUT;class th{constructor(){this.onTargetFramingAnimationEndObservable=new Zi.cP,this._mode=th.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(e){this._mode=e}get mode(){return this._mode}set radiusScale(e){this._radiusScale=e}get radiusScale(){return this._radiusScale}set positionScale(e){this._positionScale=e}get positionScale(){return this._positionScale}set defaultElevation(e){this._defaultElevation=e}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(e){this._elevationReturnTime=e}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(e){this._elevationReturnWaitTime=e}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(e){this._framingTime=e}get framingTime(){return this._framingTime}init(){}attach(e){this._attachedCamera=e;const t=this._attachedCamera.getScene();th.EasingFunction.setEasingMode(th.EasingMode),this._onPrePointerObservableObserver=t.onPrePointerObservable.add((e=>{e.type!==tt.Zp.POINTERDOWN?e.type===tt.Zp.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add((e=>{e&&e.getBoundingInfo&&this.zoomOnMesh(e,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(e,t=!1,i=null){e.computeWorldMatrix(!0);const s=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(s.minimumWorld,s.maximumWorld,t,i)}zoomOnMeshHierarchy(e,t=!1,i=null){e.computeWorldMatrix(!0);const s=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(s.min,s.max,t,i)}zoomOnMeshesHierarchy(e,t=!1,i=null){const s=new gt.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new gt.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let t=0;t<e.length;t++){const i=e[t].getHierarchyBoundingVectors(!0);gt.Pq.CheckExtends(i.min,s,r),gt.Pq.CheckExtends(i.max,s,r)}this.zoomOnBoundingInfo(s,r,t,i)}zoomOnBoundingInfo(e,t,i=!1,s=null){let r;if(!this._attachedCamera)return!1;const n=e.y,o=n+(t.y-n)*this._positionScale,a=t.subtract(e).scale(.5);if(!isFinite(o))return!1;if(i)r=new gt.Pq(0,o,0);else{const t=e.add(a);r=new gt.Pq(t.x,o,t.z)}this._vectorTransition||(this._vectorTransition=Ja.X5.CreateAnimation("target",Ja.X5.ANIMATIONTYPE_VECTOR3,60,th.EasingFunction)),this._betaIsAnimating=!0;let h=Ja.X5.TransitionTo("target",r,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);h&&this._animatables.push(h);let l=0;if(this._mode===th.FitFrustumSidesMode){const i=this._calculateLowerRadiusFromModelBoundingSphere(e,t);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=a.length()+this._attachedCamera.minZ),l=i}else this._mode===th.IgnoreBoundsSizeMode&&(l=this._calculateLowerRadiusFromModelBoundingSphere(e,t),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){const i=t.subtract(e).length();this._attachedCamera.panningSensibility=5e3/i,this._attachedCamera.wheelPrecision=100/l}return this._radiusTransition||(this._radiusTransition=Ja.X5.CreateAnimation("radius",Ja.X5.ANIMATIONTYPE_FLOAT,60,th.EasingFunction)),h=Ja.X5.TransitionTo("radius",l,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),s&&s(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),h&&this._animatables.push(h),!0}_calculateLowerRadiusFromModelBoundingSphere(e,t){const i=this._attachedCamera;if(!i)return 0;let s=i._calculateLowerRadiusFromModelBoundingSphere(e,t,this._radiusScale);return i.lowerRadiusLimit&&this._mode===th.IgnoreBoundsSizeMode&&(s=s<i.lowerRadiusLimit?i.lowerRadiusLimit:s),i.upperRadiusLimit&&(s=s>i.upperRadiusLimit?i.upperRadiusLimit:s),s}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const e=Qa.j.Now-this._lastInteractionTime,t=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Ja.X5.CreateAnimation("beta",Ja.X5.ANIMATIONTYPE_FLOAT,60,th.EasingFunction));const e=Ja.X5.TransitionTo("beta",t,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));e&&this._animatables.push(e)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Qa.j.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}th.EasingFunction=new class extends Ya{constructor(e=2){super(),this.exponent=e}easeInCore(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)}},th.EasingMode=Ya.EASINGMODE_EASEINOUT,th.IgnoreBoundsSizeMode=0,th.FitFrustumSidesMode=1;var ih=o(4459),sh=o(504);class rh{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(e){e=$i.S0.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),i=t.getInputElement();let s=0,r=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=n=>{const o=n.event,a="touch"===o.pointerType;if(n.type!==tt.Zp.POINTERMOVE&&-1===this.buttons.indexOf(o.button))return;const h=o.target;if(this._altKey=o.altKey,this._ctrlKey=o.ctrlKey,this._metaKey=o.metaKey,this._shiftKey=o.shiftKey,this._buttonsPressed=o.buttons,t.isPointerLock){const e=o.movementX,t=o.movementY;this.onTouch(null,e,t),this._pointA=null,this._pointB=null}else{if(n.type!==tt.Zp.POINTERDOWN&&n.type!==tt.Zp.POINTERDOUBLETAP&&a&&this._pointA?.pointerId!==o.pointerId&&this._pointB?.pointerId!==o.pointerId)return;if(n.type!==tt.Zp.POINTERDOWN||-1!==this._currentActiveButton&&!a)if(n.type===tt.Zp.POINTERDOUBLETAP)this.onDoubleTap(o.pointerType);else if(n.type!==tt.Zp.POINTERUP||this._currentActiveButton!==o.button&&!a){if(n.type===tt.Zp.POINTERMOVE)if(e||o.preventDefault(),this._pointA&&null===this._pointB){const e=o.clientX-this._pointA.x,t=o.clientY-this._pointA.y;this._pointA.x=o.clientX,this._pointA.y=o.clientY,this.onTouch(this._pointA,e,t)}else if(this._pointA&&this._pointB){const e=this._pointA.pointerId===o.pointerId?this._pointA:this._pointB;e.x=o.clientX,e.y=o.clientY;const t=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,a=t*t+i*i,h={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:o.pointerId,type:n.type};this.onMultiTouch(this._pointA,this._pointB,s,a,r,h),r=h,s=a}}else{try{h?.releasePointerCapture(o.pointerId)}catch(e){}a||(this._pointB=null),t._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==o.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==o.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==s||r)&&(this.onMultiTouch(this._pointA,this._pointB,s,0,r,null),s=0,r=null),this._currentActiveButton=-1,this.onButtonUp(o),e||o.preventDefault()}else{try{h?.setPointerCapture(o.pointerId)}catch(e){}if(null===this._pointA)this._pointA={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType};else{if(null!==this._pointB)return;this._pointB={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType}}-1!==this._currentActiveButton||a||(this._currentActiveButton=o.button),this.onButtonDown(o),e||(o.preventDefault(),i&&i.focus())}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,tt.Zp.POINTERDOWN|tt.Zp.POINTERUP|tt.Zp.POINTERMOVE|tt.Zp.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,s=0,r=null,this.onLostFocus()},this._contextMenuBind=e=>this.onContextMenu(e),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const n=this.camera.getScene().getEngine().getHostWindow();n&&$i.S0.RegisterTopRootEvents(n,[{name:"blur",handler:this._onLostFocus}])}detachControl(){if(this._onLostFocus){const e=this.camera.getScene().getEngine().getHostWindow();e&&$i.S0.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const e=this.camera.getScene().getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(e){}onTouch(e,t,i){}onMultiTouch(e,t,i,s,r,n){}onContextMenu(e){e.preventDefault()}onButtonDown(e){}onButtonUp(e){}onLostFocus(){}}(0,Et.Cg)([(0,Rt.lK)()],rh.prototype,"buttons",void 0);class nh extends rh{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(e,t){if(0!==this.panningSensibility&&e&&t){const i=t.x-e.x,s=t.y-e.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility}}_computePinchZoom(e,t){const i=this.camera.radius||nh.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(e)/Math.sqrt(t):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(t-e)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(t-e)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(e,t,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(e,t,i,s,r,n){0===i&&null===r||0===s&&null===n||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,s),this._computeMultiTouchPanning(r,n)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(s)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,s),this._isPinching=!0):this._computeMultiTouchPanning(r,n)):this.multiTouchPanning?this._computeMultiTouchPanning(r,n):this.pinchZoom&&this._computePinchZoom(i,s))}onButtonDown(e){this._isPanClick=e.button===this.camera._panningMouseButton}onButtonUp(e){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}nh.MinimumRadiusForPinch=.001,(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"buttons",void 0),(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"angularSensibilityX",void 0),(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"angularSensibilityY",void 0),(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"pinchPrecision",void 0),(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"pinchDeltaPercentage",void 0),(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"useNaturalPinchZoom",void 0),(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"pinchZoom",void 0),(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"panningSensibility",void 0),(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"multiTouchPanning",void 0),(0,Et.Cg)([(0,Rt.lK)()],nh.prototype,"multiTouchPanAndZoom",void 0),sh.H.ArcRotateCameraPointersInput=nh;class oh{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(e){e=$i.S0.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const i=t.event;if(!i.metaKey)if(t.type===ts.TB.KEYDOWN)this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode))&&(-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(e||i.preventDefault()));else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const t=this._keys.indexOf(i.keyCode);t>=0&&this._keys.splice(t,1),i.preventDefault&&(e||i.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&e.useInputToRestoreState&&e.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,Et.Cg)([(0,Rt.lK)()],oh.prototype,"keysUp",void 0),(0,Et.Cg)([(0,Rt.lK)()],oh.prototype,"keysDown",void 0),(0,Et.Cg)([(0,Rt.lK)()],oh.prototype,"keysLeft",void 0),(0,Et.Cg)([(0,Rt.lK)()],oh.prototype,"keysRight",void 0),(0,Et.Cg)([(0,Rt.lK)()],oh.prototype,"keysReset",void 0),(0,Et.Cg)([(0,Rt.lK)()],oh.prototype,"panningSensibility",void 0),(0,Et.Cg)([(0,Rt.lK)()],oh.prototype,"zoomingSensibility",void 0),(0,Et.Cg)([(0,Rt.lK)()],oh.prototype,"useAltToZoom",void 0),(0,Et.Cg)([(0,Rt.lK)()],oh.prototype,"angularSpeed",void 0),sh.H.ArcRotateCameraKeyboardMoveInput=oh;var ah=o(2050),hh=o(9169);class lh{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new gt.Pq(0,0,0),this._globalOffset=new gt.Pq(0,0,0),this._inertialPanning=gt.Pq.Zero()}_computeDeltaFromMouseWheelLegacyEvent(e,t){let i=0;const s=.01*e*this.wheelDeltaPercentage*t;return i=e>0?s/(1+this.wheelDeltaPercentage):s*(1+this.wheelDeltaPercentage),i}attachControl(e){e=$i.S0.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==tt.Zp.POINTERWHEEL)return;const i=t.event;let s=0;const r=i.deltaMode===hh.s.DOM_DELTA_LINE?40:1,n=-i.deltaY*r;if(this.customComputeDeltaFromMouseWheel)s=this.customComputeDeltaFromMouseWheel(n,this,i);else if(this.wheelDeltaPercentage){if(s=this._computeDeltaFromMouseWheelLegacyEvent(n,this.camera.radius),s>0){let e=this.camera.radius,t=this.camera.inertialRadiusOffset+s;for(let i=0;i<20&&Math.abs(t)>.001;i++)e-=t,t*=this.camera.inertia;e=(0,Wo.Clamp)(e,0,Number.MAX_VALUE),s=this._computeDeltaFromMouseWheelLegacyEvent(n,e)}}else s=n/(40*this.wheelPrecision);s&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(s)):this.camera.inertialRadiusOffset+=s),i.preventDefault&&(e||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,tt.Zp.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const e=this.camera;0+e.inertialAlphaOffset+e.inertialBetaOffset+e.inertialRadiusOffset&&(this._updateHitPlane(),e.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(e.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const e=this.camera,t=e.target.subtract(e.position);this._hitPlane=ah.Z.FromPositionAndNormal(e.target,t)}_getPosition(){const e=this.camera,t=e.getScene(),i=t.createPickingRay(t.pointerX,t.pointerY,gt.uq.Identity(),e,!1);0===e.targetScreenOffset.x&&0===e.targetScreenOffset.y||(this._viewOffset.set(e.targetScreenOffset.x,e.targetScreenOffset.y,0),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),this._globalOffset=gt.Pq.TransformNormal(this._viewOffset,e._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let s=0;return this._hitPlane&&(s=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(s))}_zoomToMouse(e){const t=this.camera,i=1-t.inertia;if(t.lowerRadiusLimit){const s=t.lowerRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i<s&&(e=(t.radius-s)*i-t.inertialRadiusOffset)}if(t.upperRadiusLimit){const s=t.upperRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i>s&&(e=(t.radius-s)*i-t.inertialRadiusOffset)}const s=e/i/t.radius,r=this._getPosition(),n=gt.AA.Vector3[6];r.subtractToRef(t.target,n),n.scaleInPlace(s),n.scaleInPlace(i),this._inertialPanning.addInPlace(n),t.inertialRadiusOffset+=e}_zeroIfClose(e){Math.abs(e.x)<bs.bH&&(e.x=0),Math.abs(e.y)<bs.bH&&(e.y=0),Math.abs(e.z)<bs.bH&&(e.z=0)}}(0,Et.Cg)([(0,Rt.lK)()],lh.prototype,"wheelPrecision",void 0),(0,Et.Cg)([(0,Rt.lK)()],lh.prototype,"zoomToMouseLocation",void 0),(0,Et.Cg)([(0,Rt.lK)()],lh.prototype,"wheelDeltaPercentage",void 0),sh.H.ArcRotateCameraMouseWheelInput=lh;class ch extends sh._{constructor(e){super(e)}addMouseWheel(){return this.add(new lh),this}addPointers(){return this.add(new nh),this}addKeyboard(){return this.add(new oh),this}}Xa.b.AddNodeConstructor("ArcRotateCamera",((e,t)=>()=>new uh(e,0,0,1,gt.Pq.Zero(),t)));class uh extends ih.F{get target(){return this._target}set target(e){this.setTarget(e)}get targetHost(){return this._targetHost}set targetHost(e){e&&this.setTarget(e)}getTarget(){return this.target}get position(){return this._position}set position(e){this.setPosition(e)}set upVector(e){this._upToYMatrix||(this._yToUpMatrix=new gt.uq,this._upToYMatrix=new gt.uq,this._upVector=gt.Pq.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){gt.uq.RotationAlignToRef(gt.Pq.UpReadOnly,this._upVector,this._yToUpMatrix),gt.uq.RotationAlignToRef(this._upVector,gt.Pq.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0}set angularSensibilityX(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)}get angularSensibilityY(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0}set angularSensibilityY(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)}get pinchPrecision(){const e=this.inputs.attached.pointers;return e?e.pinchPrecision:0}set pinchPrecision(e){const t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)}get pinchDeltaPercentage(){const e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0}set pinchDeltaPercentage(e){const t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)}get useNaturalPinchZoom(){const e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom}set useNaturalPinchZoom(e){const t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=e)}get panningSensibility(){const e=this.inputs.attached.pointers;return e?e.panningSensibility:0}set panningSensibility(e){const t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}get wheelPrecision(){const e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0}set wheelPrecision(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)}get zoomToMouseLocation(){const e=this.inputs.attached.mousewheel;return!!e&&e.zoomToMouseLocation}set zoomToMouseLocation(e){const t=this.inputs.attached.mousewheel;t&&(t.zoomToMouseLocation=e)}get wheelDeltaPercentage(){const e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0}set wheelDeltaPercentage(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new eh,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new th,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new Ka,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(e,t,i,s,r,n,o=!0){super(e,gt.Pq.Zero(),n,o),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=gt.Pq.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=gt.I9.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new gt.uq,this.panningAxis=new gt.Pq(1,1,0),this._transformedDirection=new gt.Pq,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new Zi.cP,this.checkCollisions=!1,this.collisionRadius=new gt.Pq(.5,.5,.5),this._previousPosition=gt.Pq.Zero(),this._collisionVelocity=gt.Pq.Zero(),this._newPosition=gt.Pq.Zero(),this._computationVector=gt.Pq.Zero(),this._onCollisionPositionChange=(e,t,i=null)=>{i?(this.setPosition(t),this.onCollide&&this.onCollide(i)):this._previousPosition.copyFrom(this._position);const s=Math.cos(this.alpha),r=Math.sin(this.alpha),n=Math.cos(this.beta);let o=Math.sin(this.beta);0===o&&(o=1e-4);const a=this._getTargetPosition();this._computationVector.copyFromFloats(this.radius*s*o,this.radius*n,this.radius*r*o),a.addToRef(this._computationVector,this._newPosition),this._position.copyFrom(this._newPosition);let h=this.upVector;this.allowUpsideDown&&this.beta<0&&(h=h.clone(),h=h.negate()),this._computeViewMatrix(this._position,a,h),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y),this._collisionTriggered=!1},this._target=gt.Pq.Zero(),r&&this.setTarget(r),this.alpha=t,this.beta=i,this.radius=s,this.getViewMatrix(),this.inputs=new ch(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new gt.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=gt.I9.Zero()}_updateCache(e){e||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}return this._getLockedTargetPosition()||this._target}storeState(){return this._storedAlpha=this._goalAlpha=this.alpha,this._storedBeta=this._goalBeta=this.beta,this._storedRadius=this._goalRadius=this.radius,this._storedTarget=this._goalTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this._goalTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>bs.bH&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}interpolateTo(e=this.alpha,t=this.beta,i=this.radius,s=this.target,r=this.targetScreenOffset,n){this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=n?this._currentInterpolationFactor=n:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,e=(0,Wo.Clamp)(e,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),t=(0,Wo.Clamp)(t,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),i=(0,Wo.Clamp)(i,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),s.y=(0,Wo.Clamp)(s.y,this.lowerTargetYLimit??-1/0,1/0),this._goalAlpha=e,this._goalBeta=t,this._goalRadius=i,this._goalTarget=s,this._goalTargetScreenOffset=r}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)}attachControl(e,t,i=!0,s=2){const r=arguments;t=$i.S0.BackCompatCameraNoPreventDefault(r),this._useCtrlForPanning=i,this._panningMouseButton=s,"boolean"==typeof r[0]&&(r.length>1&&(this._useCtrlForPanning=r[1]),r.length>2&&(this._panningMouseButton=r[2])),this.inputs.attachElement(t),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const e=this._scene.getEngine().getDeltaTime()/1e3,t=1-Math.pow(2,-e/this._currentInterpolationFactor);this.setTarget(gt.Pq.Lerp(this.getTarget(),this._goalTarget,t)),gt.PT.RotationAlphaBetaGammaToRef(this._goalAlpha,this._goalBeta,0,gt.AA.Quaternion[0]),gt.PT.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,gt.AA.Quaternion[1]),gt.PT.SlerpToRef(gt.AA.Quaternion[1],gt.AA.Quaternion[0],t,gt.AA.Quaternion[2]),gt.AA.Quaternion[2].normalize(),gt.AA.Quaternion[2].toAlphaBetaGammaToRef(gt.AA.Vector3[0]),this.alpha=gt.AA.Vector3[0].x,this.beta=gt.AA.Vector3[0].y,this.radius+=(this._goalRadius-this.radius)*t,gt.I9.LerpToRef(this.targetScreenOffset,this._goalTargetScreenOffset,t,this.targetScreenOffset),(gt.Pq.DistanceSquared(this.getTarget(),this._goalTarget)<bs.bH&&gt.AA.Quaternion[2].equalsWithEpsilon(gt.AA.Quaternion[0])&&Math.pow(this._goalRadius-this.radius,2)<bs.bH&&gt.I9.Distance(this.targetScreenOffset,this._goalTargetScreenOffset)<bs.bH||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const e=this.invertRotation?-1:1,t=this._calculateHandednessMultiplier();let i=this.inertialAlphaOffset*t;this.beta<0&&(i*=-1),this.alpha+=i*e,this.beta+=this.inertialBetaOffset*e,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<bs.bH&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<bs.bH&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*bs.bH&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const e=new gt.Pq(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),e.multiplyInPlace(this.panningAxis),gt.Pq.TransformNormalToRef(e,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const e=this.upVector,t=gt.Pq.CrossToRef(this._transformedDirection,e,this._transformedDirection);gt.Pq.CrossToRef(e,t,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),gt.Pq.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else{if(this.parent){const e=gt.AA.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.transposeToRef(e),gt.Pq.TransformCoordinatesToRef(this._transformedDirection,e,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*bs.bH&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*bs.bH&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||gt.Pq.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const e=this.alpha;var t,i;this.alpha=function(e){let t=Math.PI/2;return 0===e.x&&0===e.z||(t=Math.acos(e.x/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2)))),e.z<0&&(t=2*Math.PI-t),t}(this._computationVector),this.beta=(t=this._computationVector.y,i=this.radius,Math.acos(t/i));const s=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*s*Math.PI,this._checkLimits()}setPosition(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())}setTarget(e,t=!1,i=!1,s=!1){if(s=this.overrideCloneAlphaBetaRadius??s,e.computeWorldMatrix)t&&e.getBoundingInfo?this._targetBoundingCenter=e.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const t=e,s=this._getTargetPosition();if(s&&!i&&s.equals(t))return;this._targetHost=null,this._target=t,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}s||this.rebuildAnglesAndRadius()}_getViewMatrix(){const e=Math.cos(this.alpha),t=Math.sin(this.alpha),i=Math.cos(this.beta);let s=Math.sin(this.beta);0===s&&(s=1e-4),0===this.radius&&(this.radius=1e-4);const r=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*s,this.radius*i,this.radius*t*s),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||gt.Pq.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),r.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const e=this.getScene().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,e.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);let e=this.upVector;this.allowUpsideDown&&s<0&&(e=e.negate()),this._computeViewMatrix(this._position,r,e),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=r,this._viewMatrix}zoomOn(e,t=!1){e=e||this.getScene().meshes;const i=zn.e.MinMax(e);let s=this._calculateLowerRadiusFromModelBoundingSphere(i.min,i.max);s=Math.max(Math.min(s,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=s*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:s},t)}focusOn(e,t=!1){let i,s;if(void 0===e.min){const t=e||this.getScene().meshes;i=zn.e.MinMax(t),s=gt.Pq.Distance(i.min,i.max)}else i=e,s=e.distance;this._target=zn.e.Center(i),t||(this.maxZ=2*s)}createRigCamera(e,t){let i=0;switch(this.cameraRigMode){case Ra.i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ra.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ra.i.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Ra.i.RIG_MODE_STEREOSCOPIC_INTERLACED:case Ra.i.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===t?1:-1);break;case Ra.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===t?-1:1)}const s=new uh(e,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return s._cameraRigParams={},s.isRigCamera=!0,s.rigParent=this,s.upVector=this.upVector,s.mode=this.mode,s.orthoLeft=this.orthoLeft,s.orthoRight=this.orthoRight,s.orthoBottom=this.orthoBottom,s.orthoTop=this.orthoTop,s}_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(e.beta=t.beta=this.beta,this.cameraRigMode){case Ra.i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ra.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ra.i.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Ra.i.RIG_MODE_STEREOSCOPIC_INTERLACED:case Ra.i.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Ra.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(e,t,i=1){const s=gt.Pq.Distance(e,t),r=this.getScene().getEngine().getAspectRatio(this),n=Math.tan(this.fov/2),o=n*r,a=.5*s*i,h=a*Math.sqrt(1+1/(o*o)),l=a*Math.sqrt(1+1/(n*n));return Math.max(h,l)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"alpha",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"beta",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"radius",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,Et.Cg)([(0,Rt.P_)("target")],uh.prototype,"_target",void 0),(0,Et.Cg)([(0,Rt.xG)("targetHost")],uh.prototype,"_targetHost",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"inertialAlphaOffset",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"inertialBetaOffset",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"inertialRadiusOffset",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"lowerAlphaLimit",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"upperAlphaLimit",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"lowerBetaLimit",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"upperBetaLimit",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"lowerRadiusLimit",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"upperRadiusLimit",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"lowerTargetYLimit",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"inertialPanningX",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"inertialPanningY",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"pinchToPanMaxDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"panningDistanceLimit",void 0),(0,Et.Cg)([(0,Rt.P_)()],uh.prototype,"panningOriginTarget",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"panningInertia",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"zoomToMouseLocation",null),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"zoomOnFactor",void 0),(0,Et.Cg)([(0,Rt.WM)()],uh.prototype,"targetScreenOffset",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"allowUpsideDown",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"useInputToRestoreState",void 0),(0,Et.Cg)([(0,Rt.lK)()],uh.prototype,"restoreStateInterpolationFactor",void 0),(0,Ft.Y5)("BABYLON.ArcRotateCamera",uh);var dh=o(3113);class _h extends ba.${set blurRatio(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())}get blurRatio(){return this._blurRatio}set adaptiveBlurKernel(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()}set blurKernel(e){this.blurKernelX=e,this.blurKernelY=e}set blurKernelX(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())}get blurKernelX(){return this._blurKernelX}set blurKernelY(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())}get blurKernelY(){return this._blurKernelY}_autoComputeBlurKernel(){const e=this.getScene().getEngine(),t=this.getRenderWidth()/e.getRenderWidth(),i=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*t,this.blurKernelY=this._adaptiveBlurKernel*i}_onRatioRescale(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()}_updateGammaSpace(){const e=this.getScene();e&&(this.gammaSpace=!e.imageProcessingConfiguration.isEnabled||!e.imageProcessingConfiguration.applyByPostProcess)}constructor(e,t,i,s,r=0,n=Dt.g.BILINEAR_SAMPLINGMODE,o=!0){if(super(e,t,i,s,!0,r,!1,n,o),this.mirrorPlane=new ah.Z(0,1,0,1),this._transformMatrix=gt.uq.Zero(),this._mirrorMatrix=gt.uq.Zero(),this._adaptiveBlurKernel=0,this._blurKernelX=0,this._blurKernelY=0,this._blurRatio=1,!(i=this.getScene()))return this;let a;this.ignoreCameraViewport=!0,this._updateGammaSpace(),this._imageProcessingConfigChangeObserver=i.imageProcessingConfiguration.onUpdateParameters.add((()=>{this._updateGammaSpace()})),i.getEngine().supportsUniformBuffers&&(this._sceneUBO=i.createSceneUniformBuffer(`Scene for Mirror Texture (name "${e}")`)),this.onBeforeRenderObservable.add((()=>{this._sceneUBO&&(this._currentSceneUBO=i.getSceneUniformBuffer(),i.setSceneUniformBuffer(this._sceneUBO),i.getSceneUniformBuffer().unbindEffect()),gt.uq.ReflectionToRef(this.mirrorPlane,this._mirrorMatrix),this._mirrorMatrix.multiplyToRef(i.getViewMatrix(),this._transformMatrix),i.setTransformMatrix(this._transformMatrix,i.getProjectionMatrix()),a=i.clipPlane,i.clipPlane=this.mirrorPlane,i._mirroredCameraPosition=gt.Pq.TransformCoordinates(i.activeCamera.globalPosition,this._mirrorMatrix)})),this.onAfterRenderObservable.add((()=>{this._sceneUBO&&i.setSceneUniformBuffer(this._currentSceneUBO),i.updateTransformMatrix(),i._mirroredCameraPosition=null,i.clipPlane=a}))}_preparePostProcesses(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){const e=this.getScene().getEngine(),t=e.getCaps().textureFloatRender&&e.getCaps().textureFloatLinearFiltering?1:2;this._blurX=new xa("horizontal blur",new gt.I9(1,0),this._blurKernelX,this._blurRatio,null,Dt.g.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.inputTexture=this._renderTarget:this._blurX.alwaysForcePOT=!0,this._blurY=new xa("vertical blur",new gt.I9(0,1),this._blurKernelY,this._blurRatio,null,Dt.g.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)}clone(){const e=this.getScene();if(!e)return this;const t=this.getSize(),i=new _h(this.name,t.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(i.renderList=this.renderList.slice(0)),i}serialize(){if(!this.name)return null;const e=super.serialize();return e.mirrorPlane=this.mirrorPlane.asArray(),e}dispose(){super.dispose();const e=this.getScene();e&&e.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver),this._sceneUBO?.dispose()}}Dt.g._CreateMirror=(e,t,i,s)=>new _h(e,t,i,s);var ph=o(7336);class gh{static _GetDefaultOptions(e){return{createGround:!0,groundSize:15,groundTexture:$i.S0.GetAssetUrl(this._GroundTextureCDNUrl),groundColor:new bt.v9(.2,.2,.3).toLinearSpace(e.getEngine().useExactSrgbConversions).scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:0,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:$i.S0.GetAssetUrl(this._SkyboxTextureCDNUrl),skyboxColor:new bt.v9(.2,.2,.3).toLinearSpace(e.getEngine().useExactSrgbConversions).scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:gt.Pq.Zero(),setupImageProcessing:!0,environmentTexture:$i.S0.GetAssetUrl(this._EnvironmentTextureCDNUrl),cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}}get rootMesh(){return this._rootMesh}get skybox(){return this._skybox}get skyboxTexture(){return this._skyboxTexture}get skyboxMaterial(){return this._skyboxMaterial}get ground(){return this._ground}get groundTexture(){return this._groundTexture}get groundMirror(){return this._groundMirror}get groundMirrorRenderList(){return this._groundMirror?this._groundMirror.renderList:null}get groundMaterial(){return this._groundMaterial}constructor(e,t){this._errorHandler=(e,t)=>{this.onErrorObservable.notifyObservers({message:e,exception:t})},this._options={...gh._GetDefaultOptions(t),...e},this._scene=t,this.onErrorObservable=new Zi.cP,this._setupBackground(),this._setupImageProcessing()}updateOptions(e){const t={...this._options,...e};this._ground&&!t.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!t.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=t.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!t.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!t.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=t.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!t.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=t.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=t,this._setupBackground(),this._setupImageProcessing()}setMainColor(e){this.groundMaterial&&(this.groundMaterial.primaryColor=e),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=e),this.groundMirror&&(this.groundMirror.clearColor=new bt.ov(e.r,e.g,e.b,1))}_setupImageProcessing(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())}_setupEnvironmentTexture(){if(this._scene.environmentTexture)return;if(this._options.environmentTexture instanceof dh.t)return void(this._scene.environmentTexture=this._options.environmentTexture);const e=ph.b.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=e}_setupBackground(){this._rootMesh||(this._rootMesh=new zn.e("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;const e=this._getSceneSize();this._options.createGround&&(this._setupGround(e),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(e),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(e),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=e.rootPosition.x,this._rootMesh.position.z=e.rootPosition.z,this._rootMesh.position.y=e.rootPosition.y}_getSceneSize(){let e=this._options.groundSize,t=this._options.skyboxSize,i=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:e,skyboxSize:t,rootPosition:i};const s=this._scene.getWorldExtends((e=>e!==this._ground&&e!==this._rootMesh&&e!==this._skybox)),r=s.max.subtract(s.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof uh&&this._scene.activeCamera.upperRadiusLimit&&(e=2*this._scene.activeCamera.upperRadiusLimit,t=e);const n=r.length();n>e&&(e=2*n,t=e),e*=1.1,t*=1.5,i=s.min.add(r.scale(.5)),i.y=s.min.y-this._options.groundYBias}return{groundSize:e,skyboxSize:t,rootPosition:i}}_setupGround(e){this._ground&&!this._ground.isDisposed()||(this._ground=ko("BackgroundPlane",{size:e.groundSize},this._scene),this._ground.rotation.x=Math.PI/2,this._ground.isPickable=!1,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add((()=>{this._ground=null}))),this._ground.receiveShadows=this._options.enableGroundShadow}_setupGroundMaterial(){this._groundMaterial||(this._groundMaterial=new zt("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=8,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)}_setupGroundDiffuseTexture(){this._groundMaterial&&(this._groundTexture||(this._options.groundTexture instanceof dh.t?this._groundMaterial.diffuseTexture=this._options.groundTexture:(this._groundTexture=new Dt.g(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._groundTexture.gammaSpace=!1,this._groundTexture.hasAlpha=!0,this._groundMaterial.diffuseTexture=this._groundTexture)))}_setupGroundMirrorTexture(e){const t=Dt.g.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new _h("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,Dt.g.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new ah.Z(0,-1,0,e.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=t,this._groundMirror.wrapV=t,this._groundMirror.renderList))for(let e=0;e<this._scene.meshes.length;e++){const t=this._scene.meshes[e];t!==this._ground&&t!==this._skybox&&t!==this._rootMesh&&this._groundMirror.renderList.push(t)}const i=this._options.groundColor.toGammaSpace(this._scene.getEngine().useExactSrgbConversions);this._groundMirror.clearColor=new bt.ov(i.r,i.g,i.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel}_setupMirrorInGroundMaterial(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)}_setupSkybox(e){this._skybox&&!this._skybox.isDisposed()||(this._skybox=so("BackgroundSkybox",{size:e.skyboxSize,sideOrientation:zn.e.BACKSIDE},this._scene),this._skybox.isPickable=!1,this._skybox.onDisposeObservable.add((()=>{this._skybox=null}))),this._skybox.parent=this._rootMesh}_setupSkyboxMaterial(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new zt("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)}_setupSkyboxReflectionTexture(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof dh.t?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new ph.b(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=Dt.g.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))}dispose(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)}}gh._GroundTextureCDNUrl="https://assets.babylonjs.com/core/environments/backgroundGround.png",gh._SkyboxTextureCDNUrl="https://assets.babylonjs.com/core/environments/backgroundSkybox.dds",gh._EnvironmentTextureCDNUrl="https://assets.babylonjs.com/core/environments/environmentSpecular.env";var fh=o(844),mh=o(9271);mh.s.prototype.addDeviceOrientation=function(e){return this._deviceOrientationInput||(this._deviceOrientationInput=new bh,e&&(this._deviceOrientationInput.smoothFactor=e),this.add(this._deviceOrientationInput)),this};class bh{static WaitForOrientationChangeAsync(e){return new Promise(((t,i)=>{let s=!1;const r=()=>{window.removeEventListener("deviceorientation",r),s=!0,t()};e&&setTimeout((()=>{s||(window.removeEventListener("deviceorientation",r),i("WaitForOrientationChangeAsync timed out"))}),e),"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e?window.addEventListener("deviceorientation",r):$i.S0.Warn("Permission not granted.")})).catch((e=>{$i.S0.Error(e)})):window.addEventListener("deviceorientation",r)}))}constructor(){this._screenOrientationAngle=0,this._screenQuaternion=new gt.PT,this._alpha=0,this._beta=0,this._gamma=0,this.smoothFactor=0,this._onDeviceOrientationChangedObservable=new Zi.cP,this._orientationChanged=()=>{this._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,this._screenOrientationAngle=-$i.S0.ToRadians(this._screenOrientationAngle/2),this._screenQuaternion.copyFromFloats(0,Math.sin(this._screenOrientationAngle),0,Math.cos(this._screenOrientationAngle))},this._deviceOrientation=e=>{this.smoothFactor?(this._alpha=null!==e.alpha?$i.S0.SmoothAngleChange(this._alpha,e.alpha,this.smoothFactor):0,this._beta=null!==e.beta?$i.S0.SmoothAngleChange(this._beta,e.beta,this.smoothFactor):0,this._gamma=null!==e.gamma?$i.S0.SmoothAngleChange(this._gamma,e.gamma,this.smoothFactor):0):(this._alpha=null!==e.alpha?e.alpha:0,this._beta=null!==e.beta?e.beta:0,this._gamma=null!==e.gamma?e.gamma:0),null!==e.alpha&&this._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTransform=new gt.PT(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}get camera(){return this._camera}set camera(e){this._camera=e,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new gt.PT),this._camera&&this._camera.onDisposeObservable.add((()=>{this._onDeviceOrientationChangedObservable.clear()}))}attachControl(){const e=this.camera.getScene().getEngine().getHostWindow();if(e){const t=()=>{e.addEventListener("orientationchange",this._orientationChanged),e.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()};"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e?t():$i.S0.Warn("Permission not granted.")})).catch((e=>{$i.S0.Error(e)})):t()}}detachControl(){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0}checkInputs(){this._alpha&&(gt.PT.RotationYawPitchRollToRef($i.S0.ToRadians(this._alpha),$i.S0.ToRadians(this._beta),-$i.S0.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTransform),this._camera.getScene().useRightHandedSystem?this._camera.rotationQuaternion.y*=-1:this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)}getClassName(){return"FreeCameraDeviceOrientationInput"}getSimpleName(){return"deviceOrientation"}}sh.H.FreeCameraDeviceOrientationInput=bh,Xa.b.AddNodeConstructor("DeviceOrientationCamera",((e,t)=>()=>new vh(e,gt.Pq.Zero(),t)));class vh extends fh.S{constructor(e,t,i){super(e,t,i),this._tmpDragQuaternion=new gt.PT,this._disablePointerInputWhenUsingDeviceOrientation=!0,this._dragFactor=0,this._quaternionCache=new gt.PT,this.inputs.addDeviceOrientation(),this.inputs._deviceOrientationInput&&this.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce((()=>{this._disablePointerInputWhenUsingDeviceOrientation&&this.inputs._mouseInput&&(this.inputs._mouseInput._allowCameraRotation=!1,this.inputs._mouseInput.onPointerMovedObservable.add((e=>{0!=this._dragFactor&&(this._initialQuaternion||(this._initialQuaternion=new gt.PT),gt.PT.FromEulerAnglesToRef(0,e.offsetX*this._dragFactor,0,this._tmpDragQuaternion),this._initialQuaternion.multiplyToRef(this._tmpDragQuaternion,this._initialQuaternion))})))}))}get disablePointerInputWhenUsingDeviceOrientation(){return this._disablePointerInputWhenUsingDeviceOrientation}set disablePointerInputWhenUsingDeviceOrientation(e){this._disablePointerInputWhenUsingDeviceOrientation=e}enableHorizontalDragging(e=1/300){this._dragFactor=e}getClassName(){return"DeviceOrientationCamera"}_checkInputs(){super._checkInputs(),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}resetToCurrentRotation(e=ho._0.Y){this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new gt.PT),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach((t=>{e[t]?this._initialQuaternion[t]*=-1:this._initialQuaternion[t]=0})),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))}}class Th{constructor(){this.compensateDistortion=!0,this.multiviewEnabled=!1}get aspectRatio(){return this.hResolution/(2*this.vResolution)}get aspectRatioFov(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))}get leftHMatrix(){const e=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return gt.uq.Translation(e,0,0)}get rightHMatrix(){const e=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return gt.uq.Translation(-e,0,0)}get leftPreViewMatrix(){return gt.uq.Translation(.5*this.interpupillaryDistance,0,0)}get rightPreViewMatrix(){return gt.uq.Translation(-.5*this.interpupillaryDistance,0,0)}static GetDefault(){const e=new Th;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e}}class yh extends va.w{getClassName(){return"VRDistortionCorrectionPostProcess"}constructor(e,t,i,s){super(e,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,s.postProcessScaleFactor,t,Dt.g.BILINEAR_SAMPLINGMODE),this._isRightEye=i,this._distortionFactors=s.distortionK,this._postProcessScaleFactor=s.postProcessScaleFactor,this._lensCenterOffset=s.lensCenterOffset,this.adaptScaleToCurrentViewport=!0,this.onSizeChangedObservable.add((()=>{this._scaleIn=new gt.I9(2,2/this.aspectRatio),this._scaleFactor=new gt.I9(1/this._postProcessScaleFactor*.5,1/this._postProcessScaleFactor*.5*this.aspectRatio),this._lensCenter=new gt.I9(this._isRightEye?.5-.5*this._lensCenterOffset:.5+.5*this._lensCenterOffset,.5)})),this.onApplyObservable.add((e=>{e.setFloat2("LensCenter",this._lensCenter.x,this._lensCenter.y),e.setFloat2("Scale",this._scaleFactor.x,this._scaleFactor.y),e.setFloat2("ScaleIn",this._scaleIn.x,this._scaleIn.y),e.setFloat4("HmdWarpParam",this._distortionFactors[0],this._distortionFactors[1],this._distortionFactors[2],this._distortionFactors[3])}))}_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(o.e(6541).then(o.bind(o,6541)))):t.push(o.e(8796).then(o.bind(o,8796))),super._gatherImports(e,t)}}Ma.l.ShadersStore.vrMultiviewToSingleviewPixelShader="precision mediump sampler2DArray;varying vec2 vUV;uniform sampler2DArray multiviewSampler;uniform int imageIndex;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{gl_FragColor=texture2D(multiviewSampler,vec3(vUV,imageIndex));}";var xh=o(7893);class Ah extends ba.${set samples(e){this._samples=e}get samples(){return this._samples}constructor(e,t=512){super("multiview rtt",t,e,!1,!0,0,!1,void 0,!1,!1,!0,void 0,!0),this._renderTarget=this.getScene().getEngine().createMultiviewRenderTargetTexture(this.getRenderWidth(),this.getRenderHeight()),this._texture=this._renderTarget.texture,this._texture.isMultiview=!0,this._texture.format=5,this.samples=this._getEngine().getCaps().maxSamples||this.samples,this._texture.samples=this._samples}_bindFrameBuffer(){this._renderTarget&&this.getScene().getEngine().bindMultiviewFramebuffer(this._renderTarget)}getViewCount(){return 2}}var Ch=o(2610);function Sh(e,t){const i=new xh.D(e,void 0,!0,t);return i.addUniform("viewProjection",16),i.addUniform("viewProjectionR",16),i.addUniform("view",16),i.addUniform("projection",16),i.addUniform("vEyePosition",4),i}Me.N.prototype.createMultiviewRenderTargetTexture=function(e,t,i,s){const r=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";const n=this._createHardwareRenderTargetWrapper(!1,!1,{width:e,height:t});n._framebuffer=r.createFramebuffer();const o=new rs.h(this,0,!0);return o.width=e,o.height=t,o.isMultiview=!0,i||(i=r.createTexture(),r.bindTexture(r.TEXTURE_2D_ARRAY,i),r.texStorage3D(r.TEXTURE_2D_ARRAY,1,r.RGBA8,e,t,2)),n._colorTextureArray=i,s||(s=r.createTexture(),r.bindTexture(r.TEXTURE_2D_ARRAY,s),r.texStorage3D(r.TEXTURE_2D_ARRAY,1,r.DEPTH24_STENCIL8,e,t,2)),n._depthStencilTextureArray=s,o.isReady=!0,n.setTextures(o),n._depthStencilTexture=o,n},Me.N.prototype.bindMultiviewFramebuffer=function(e){const t=e,i=this._gl,s=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(t,void 0,void 0,void 0,!0),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,t._framebuffer),!t._colorTextureArray||!t._depthStencilTextureArray)throw"Invalid multiview frame buffer";this.getCaps().oculusMultiview?(s.framebufferTextureMultisampleMultiviewOVR(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,t._colorTextureArray,0,t.samples,0,2),s.framebufferTextureMultisampleMultiviewOVR(i.DRAW_FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,t._depthStencilTextureArray,0,t.samples,0,2)):(s.framebufferTextureMultiviewOVR(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,t._colorTextureArray,0,0,2),s.framebufferTextureMultiviewOVR(i.DRAW_FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,t._depthStencilTextureArray,0,0,2))},Me.N.prototype.bindSpaceWarpFramebuffer=function(e){const t=e,i=this._gl,s=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(t,void 0,void 0,void 0,!0),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,t._framebuffer),!t._colorTextureArray||!t._depthStencilTextureArray)throw new Error("Invalid Space Warp framebuffer");s.framebufferTextureMultiviewOVR(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,t._colorTextureArray,0,0,2),s.framebufferTextureMultiviewOVR(i.DRAW_FRAMEBUFFER,i.DEPTH_ATTACHMENT,t._depthStencilTextureArray,0,0,2)},Ra.i.prototype._useMultiviewToSingleView=!1,Ra.i.prototype._multiviewTexture=null,Ra.i.prototype._resizeOrCreateMultiviewTexture=function(e,t){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==e&&this._multiviewTexture.getRenderHeight()==t||(this._multiviewTexture.dispose(),this._multiviewTexture=new Ah(this.getScene(),{width:e,height:t})):this._multiviewTexture=new Ah(this.getScene(),{width:e,height:t})};const Eh=Ie.Z.prototype.createSceneUniformBuffer;Ie.Z.prototype._transformMatrixR=gt.uq.Zero(),Ie.Z.prototype._multiviewSceneUbo=null,Ie.Z.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=Sh(this.getEngine(),"scene_multiview")},Ie.Z.prototype.createSceneUniformBuffer=function(e){return this._multiviewSceneUbo?Sh(this.getEngine(),e):Eh.bind(this)(e)},Ie.Z.prototype._updateMultiviewUbo=function(e,t){e&&t&&e.multiplyToRef(t,this._transformMatrixR),e&&t&&(e.multiplyToRef(t,gt.AA.Matrix[0]),Ch.P.GetRightPlaneToRef(gt.AA.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.updateMatrix("projection",this._projectionMatrix))},Ie.Z.prototype._renderMultiviewToSingleView=function(e){e._resizeOrCreateMultiviewTexture(e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.width>0?e._rigPostProcess.width:this.getEngine().getRenderWidth(!0),e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.height>0?e._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),e.outputRenderTarget=e._multiviewTexture,this._renderForCamera(e),e.outputRenderTarget=null;for(let t=0;t<e._rigCameras.length;t++){const i=this.getEngine();this._activeCamera=e._rigCameras[t],i.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};class Rh extends va.w{getClassName(){return"VRMultiviewToSingleviewPostProcess"}constructor(e,t,i){super(e,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],i,t,Dt.g.BILINEAR_SAMPLINGMODE);const s=t??this.getCamera();this.onSizeChangedObservable.add((()=>{})),this.onApplyObservable.add((e=>{s._scene.activeCamera&&s._scene.activeCamera.isLeftCamera?e.setInt("imageIndex",0):e.setInt("imageIndex",1),e.setTexture("multiviewSampler",s._multiviewTexture)}))}}Xa.b.AddNodeConstructor("VRDeviceOrientationFreeCamera",((e,t)=>()=>new Ph(e,gt.Pq.Zero(),t)));class Ph extends vh{constructor(e,t,i,s=!0,r=Th.GetDefault()){super(e,t,i),this._setRigMode=e=>function(e,t){const i=t.vrCameraMetrics||Th.GetDefault();e._rigCameras[0]._cameraRigParams.vrMetrics=i,e._rigCameras[0].viewport=new Es.L(0,0,.5,1),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new gt.uq,e._rigCameras[0]._cameraRigParams.vrHMatrix=i.leftHMatrix,e._rigCameras[0]._cameraRigParams.vrPreViewMatrix=i.leftPreViewMatrix,e._rigCameras[0].getProjectionMatrix=e._rigCameras[0]._getVRProjectionMatrix,e._rigCameras[1]._cameraRigParams.vrMetrics=i,e._rigCameras[1].viewport=new Es.L(.5,0,.5,1),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new gt.uq,e._rigCameras[1]._cameraRigParams.vrHMatrix=i.rightHMatrix,e._rigCameras[1]._cameraRigParams.vrPreViewMatrix=i.rightPreViewMatrix,e._rigCameras[1].getProjectionMatrix=e._rigCameras[1]._getVRProjectionMatrix,i.multiviewEnabled&&(e.getScene().getEngine().getCaps().multiview?(e._useMultiviewToSingleView=!0,e._rigPostProcess=new Rh("VRMultiviewToSingleview",e,i.postProcessScaleFactor)):(It.V.Warn("Multiview is not supported, falling back to standard rendering"),i.multiviewEnabled=!1)),i.compensateDistortion&&(e._rigCameras[0]._rigPostProcess=new yh("VR_Distort_Compensation_Left",e._rigCameras[0],!1,i),e._rigCameras[1]._rigPostProcess=new yh("VR_Distort_Compensation_Right",e._rigCameras[1],!0,i))}(this,e),r.compensateDistortion=s,this.setCameraRigMode(Ra.i.RIG_MODE_VR,{vrCameraMetrics:r})}getClassName(){return"VRDeviceOrientationFreeCamera"}}class Ih{get isConnected(){return this._isConnected}constructor(e,t,i,s=0,r=1,n=2,o=3){this.id=e,this.index=t,this.browserGamepad=i,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=Ih.GAMEPAD,this._leftStickAxisX=s,this._leftStickAxisY=r,this._rightStickAxisX=n,this._rightStickAxisY=o,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}onleftstickchanged(e){this._onleftstickchanged=e}onrightstickchanged(e){this._onrightstickchanged=e}get leftStick(){return this._leftStick}set leftStick(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e}get rightStick(){return this._rightStick}set rightStick(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e}update(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}dispose(){}}Ih.GAMEPAD=0,Ih.GENERIC=1,Ih.XBOX=2,Ih.POSE_ENABLED=3,Ih.DUALSHOCK=4;class Mh extends Ih{onbuttondown(e){this._onbuttondown=e}onbuttonup(e){this._onbuttonup=e}constructor(e,t,i){super(e,t,i),this.onButtonDownObservable=new Zi.cP,this.onButtonUpObservable=new Zi.cP,this.type=Ih.GENERIC,this._buttons=new Array(i.buttons.length)}_setButtonValue(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e}update(){super.update();for(let e=0;e<this._buttons.length;e++)this._buttons[e]=this._setButtonValue(this.browserGamepad.buttons[e].value,this._buttons[e],e)}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()}}var wh,Oh,Bh,Dh,Fh=o(4920);!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LeftStick=10]="LeftStick",e[e.RightStick=11]="RightStick"}(wh||(wh={})),function(e){e[e.Up=12]="Up",e[e.Down=13]="Down",e[e.Left=14]="Left",e[e.Right=15]="Right"}(Oh||(Oh={}));class Lh extends Ih{constructor(e,t,i,s=!1){super(e,t,i,0,1,2,3),this._leftTrigger=0,this._rightTrigger=0,this.onButtonDownObservable=new Zi.cP,this.onButtonUpObservable=new Zi.cP,this.onPadDownObservable=new Zi.cP,this.onPadUpObservable=new Zi.cP,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0,this._isXboxOnePad=!1,this.type=Ih.XBOX,this._isXboxOnePad=s}onlefttriggerchanged(e){this._onlefttriggerchanged=e}onrighttriggerchanged(e){this._onrighttriggerchanged=e}get leftTrigger(){return this._leftTrigger}set leftTrigger(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e}get rightTrigger(){return this._rightTrigger}set rightTrigger(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e}onbuttondown(e){this._onbuttondown=e}onbuttonup(e){this._onbuttonup=e}ondpaddown(e){this._ondpaddown=e}ondpadup(e){this._ondpadup=e}_setButtonValue(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e}_setDPadValue(e,t,i){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===e&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),e}get buttonA(){return this._buttonA}set buttonA(e){this._buttonA=this._setButtonValue(e,this._buttonA,0)}get buttonB(){return this._buttonB}set buttonB(e){this._buttonB=this._setButtonValue(e,this._buttonB,1)}get buttonX(){return this._buttonX}set buttonX(e){this._buttonX=this._setButtonValue(e,this._buttonX,2)}get buttonY(){return this._buttonY}set buttonY(e){this._buttonY=this._setButtonValue(e,this._buttonY,3)}get buttonStart(){return this._buttonStart}set buttonStart(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,9)}get buttonBack(){return this._buttonBack}set buttonBack(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,8)}get buttonLB(){return this._buttonLB}set buttonLB(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,4)}get buttonRB(){return this._buttonRB}set buttonRB(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,5)}get buttonLeftStick(){return this._buttonLeftStick}set buttonLeftStick(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,10)}get buttonRightStick(){return this._buttonRightStick}set buttonRightStick(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,11)}get dPadUp(){return this._dPadUp}set dPadUp(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,12)}get dPadDown(){return this._dPadDown}set dPadDown(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,13)}get dPadLeft(){return this._dPadLeft}set dPadLeft(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,14)}get dPadRight(){return this._dPadRight}set dPadRight(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,15)}update(){super.update(),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()}}!function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.LeftStick=10]="LeftStick",e[e.RightStick=11]="RightStick"}(Bh||(Bh={})),function(e){e[e.Up=12]="Up",e[e.Down=13]="Down",e[e.Left=14]="Left",e[e.Right=15]="Right"}(Dh||(Dh={}));class Nh extends Ih{constructor(e,t,i){super(e.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),t,i,0,1,2,3),this._leftTrigger=0,this._rightTrigger=0,this.onButtonDownObservable=new Zi.cP,this.onButtonUpObservable=new Zi.cP,this.onPadDownObservable=new Zi.cP,this.onPadUpObservable=new Zi.cP,this._buttonCross=0,this._buttonCircle=0,this._buttonSquare=0,this._buttonTriangle=0,this._buttonShare=0,this._buttonOptions=0,this._buttonL1=0,this._buttonR1=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0,this.type=Ih.DUALSHOCK}onlefttriggerchanged(e){this._onlefttriggerchanged=e}onrighttriggerchanged(e){this._onrighttriggerchanged=e}get leftTrigger(){return this._leftTrigger}set leftTrigger(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e}get rightTrigger(){return this._rightTrigger}set rightTrigger(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e}onbuttondown(e){this._onbuttondown=e}onbuttonup(e){this._onbuttonup=e}ondpaddown(e){this._ondpaddown=e}ondpadup(e){this._ondpadup=e}_setButtonValue(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e}_setDPadValue(e,t,i){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===e&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),e}get buttonCross(){return this._buttonCross}set buttonCross(e){this._buttonCross=this._setButtonValue(e,this._buttonCross,0)}get buttonCircle(){return this._buttonCircle}set buttonCircle(e){this._buttonCircle=this._setButtonValue(e,this._buttonCircle,1)}get buttonSquare(){return this._buttonSquare}set buttonSquare(e){this._buttonSquare=this._setButtonValue(e,this._buttonSquare,2)}get buttonTriangle(){return this._buttonTriangle}set buttonTriangle(e){this._buttonTriangle=this._setButtonValue(e,this._buttonTriangle,3)}get buttonOptions(){return this._buttonOptions}set buttonOptions(e){this._buttonOptions=this._setButtonValue(e,this._buttonOptions,9)}get buttonShare(){return this._buttonShare}set buttonShare(e){this._buttonShare=this._setButtonValue(e,this._buttonShare,8)}get buttonL1(){return this._buttonL1}set buttonL1(e){this._buttonL1=this._setButtonValue(e,this._buttonL1,4)}get buttonR1(){return this._buttonR1}set buttonR1(e){this._buttonR1=this._setButtonValue(e,this._buttonR1,5)}get buttonLeftStick(){return this._buttonLeftStick}set buttonLeftStick(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,10)}get buttonRightStick(){return this._buttonRightStick}set buttonRightStick(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,11)}get dPadUp(){return this._dPadUp}set dPadUp(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,12)}get dPadDown(){return this._dPadDown}set dPadDown(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,13)}get dPadLeft(){return this._dPadLeft}set dPadLeft(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,14)}get dPadRight(){return this._dPadRight}set dPadRight(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,15)}update(){super.update(),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()}}var kh=o(976);class Uh{constructor(e){if(this._scene=e,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new Zi.cP,(0,Fh.BA)()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator&&navigator.getGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new Zi.cP((e=>{for(const t in this._babylonGamepads){const i=this._babylonGamepads[t];i&&i._isConnected&&this.onGamepadConnectedObservable.notifyObserver(e,i)}})),this._onGamepadConnectedEvent=e=>{const t=e.gamepad;if(t.index in this._babylonGamepads&&this._babylonGamepads[t.index].isConnected)return;let i;this._babylonGamepads[t.index]?(i=this._babylonGamepads[t.index],i.browserGamepad=t,i._isConnected=!0):i=this._addNewGamepad(t),this.onGamepadConnectedObservable.notifyObservers(i),this._startMonitoringGamepads()},this._onGamepadDisconnectedEvent=e=>{const t=e.gamepad;for(const e in this._babylonGamepads)if(this._babylonGamepads[e].index===t.index){const t=this._babylonGamepads[e];t._isConnected=!1,this.onGamepadDisconnectedObservable.notifyObservers(t),t.dispose&&t.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){const e=this._scene?this._scene.getEngine().getHostWindow():window;e&&(e.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),e.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}get gamepads(){return this._babylonGamepads}getGamepadByType(e=Ih.XBOX){for(const t of this._babylonGamepads)if(t&&t.type===e)return t;return null}dispose(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach((e=>{e.dispose()})),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]}_addNewGamepad(e){let t;this._oneGamepadConnected||(this._oneGamepadConnected=!0);const i=-1!==e.id.search("054c")&&-1===e.id.search("0ce6"),s=-1!==e.id.search("Xbox One");return t=s||-1!==e.id.search("Xbox 360")||-1!==e.id.search("xinput")||-1!==e.id.search("045e")&&-1===e.id.search("Surface Dock")?new Lh(e.id,e.index,e,s):i?new Nh(e.id,e.index,e):new Mh(e.id,e.index,e),this._babylonGamepads[t.index]=t,t}_startMonitoringGamepads(){this._isMonitoring||(this._isMonitoring=!0,this._checkGamepadsStatus())}_stopMonitoringGamepads(){this._isMonitoring=!1}_checkGamepadsStatus(){this._updateGamepadObjects();for(const e in this._babylonGamepads){const t=this._babylonGamepads[e];if(t&&t.isConnected)try{t.update()}catch{-1===this._loggedErrors.indexOf(t.index)&&($i.S0.Warn(`Error updating gamepad ${t.id}`),this._loggedErrors.push(t.index))}}this._isMonitoring&&kh.$.QueueNewFrame((()=>{this._checkGamepadsStatus()}))}_updateGamepadObjects(){const e=navigator.getGamepads?navigator.getGamepads():[];for(let t=0;t<e.length;t++){const i=e[t];if(i)if(this._babylonGamepads[i.index])this._babylonGamepads[t].browserGamepad=i,this._babylonGamepads[t].isConnected||(this._babylonGamepads[t]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t]));else{const e=this._addNewGamepad(i);this.onGamepadConnectedObservable.notifyObservers(e)}}}}class Vh{constructor(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this.deadzoneDelta=.1,this._yAxisScale=1,this._cameraTransform=gt.uq.Identity(),this._deltaTransform=gt.Pq.Zero(),this._vector3=gt.Pq.Zero(),this._vector2=gt.I9.Zero()}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(e){this._yAxisScale=e?-1:1}attachControl(){const e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add((e=>{e.type!==Ih.POSE_ENABLED&&(this.gamepad&&e.type!==Ih.XBOX||(this.gamepad=e))})),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add((e=>{this.gamepad===e&&(this.gamepad=null)})),this.gamepad=e.getGamepadByType(Ih.XBOX),!this.gamepad&&e.gamepads.length&&(this.gamepad=e.gamepads[0])}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad&&this.gamepad.leftStick){const e=this.camera,t=this.gamepad.leftStick;0!==this.gamepadMoveSensibility&&(t.x=Math.abs(t.x)>this.deadzoneDelta?t.x/this.gamepadMoveSensibility:0,t.y=Math.abs(t.y)>this.deadzoneDelta?t.y/this.gamepadMoveSensibility:0);let i=this.gamepad.rightStick;i&&0!==this.gamepadAngularSensibility?(i.x=Math.abs(i.x)>this.deadzoneDelta?i.x/this.gamepadAngularSensibility:0,i.y=(Math.abs(i.y)>this.deadzoneDelta?i.y/this.gamepadAngularSensibility:0)*this._yAxisScale):i={x:0,y:0},e.rotationQuaternion?e.rotationQuaternion.toRotationMatrix(this._cameraTransform):gt.uq.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,this._cameraTransform);const s=50*e._computeLocalCameraSpeed();this._vector3.copyFromFloats(t.x*s,0,-t.y*s),gt.Pq.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),e.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(i.y,i.x),e.cameraRotation.addInPlace(this._vector2)}}getClassName(){return"FreeCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,Et.Cg)([(0,Rt.lK)()],Vh.prototype,"gamepadAngularSensibility",void 0),(0,Et.Cg)([(0,Rt.lK)()],Vh.prototype,"gamepadMoveSensibility",void 0),sh.H.FreeCameraGamepadInput=Vh;class Gh{constructor(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(e){this._yAxisScale=e?-1:1}attachControl(){const e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add((e=>{e.type!==Ih.POSE_ENABLED&&(this.gamepad&&e.type!==Ih.XBOX||(this.gamepad=e))})),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add((e=>{this.gamepad===e&&(this.gamepad=null)})),this.gamepad=e.getGamepadByType(Ih.XBOX),!this.gamepad&&e.gamepads.length&&(this.gamepad=e.gamepads[0])}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad){const e=this.camera,t=this.gamepad.rightStick;if(t){if(0!=t.x){const i=t.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(e.inertialAlphaOffset+=i)}if(0!=t.y){const i=t.y/this.gamepadRotationSensibility*this._yAxisScale;0!=i&&Math.abs(i)>.005&&(e.inertialBetaOffset+=i)}}const i=this.gamepad.leftStick;if(i&&0!=i.y){const e=i.y/this.gamepadMoveSensibility;0!=e&&Math.abs(e)>.005&&(this.camera.inertialRadiusOffset-=e)}}}getClassName(){return"ArcRotateCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,Et.Cg)([(0,Rt.lK)()],Gh.prototype,"gamepadRotationSensibility",void 0),(0,Et.Cg)([(0,Rt.lK)()],Gh.prototype,"gamepadMoveSensibility",void 0),sh.H.ArcRotateCameraGamepadInput=Gh,Object.defineProperty(Ie.Z.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new Uh(this);let e=this._getComponent(hs.v.NAME_GAMEPAD);e||(e=new zh(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),mh.s.prototype.addGamepad=function(){return this.add(new Vh),this},ch.prototype.addGamepad=function(){return this.add(new Gh),this};class zh{constructor(e){this.name=hs.v.NAME_GAMEPAD,this.scene=e}register(){}rebuild(){}dispose(){const e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)}}class Hh{get isFixedFoveationSupported(){return"XRWebGLLayer"==this.layerType&&"number"==typeof this.layer.fixedFoveation}get fixedFoveation(){return this.isFixedFoveationSupported?this.layer.fixedFoveation:null}set fixedFoveation(e){if(this.isFixedFoveationSupported){const t=Math.max(0,Math.min(1,e||0));this.layer.fixedFoveation=t}}createRenderTargetTextureProvider(e){return this._rttWrapper=this._createRenderTargetTextureProvider(e),this._rttWrapper}dispose(){this._rttWrapper&&(this._rttWrapper.dispose(),this._rttWrapper=null)}constructor(e,t,i,s,r){this.getWidth=e,this.getHeight=t,this.layer=i,this.layerType=s,this._createRenderTargetTextureProvider=r,this._rttWrapper=null}}var Wh=o(9202);class Xh{constructor(e,t){this._scene=e,this.layerWrapper=t,this._renderTargetTextures=new Array,this._engine=e.getEngine()}_createInternalTexture(e,t){const i=new rs.h(this._engine,0,!0);return i.width=e.width,i.height=e.height,i._hardwareTexture=new Wh.d(t,this._engine._gl),i.isReady=!0,i}_createRenderTargetTexture(e,t,i,s,r,n){if(!this._engine)throw new Error("Engine is disposed");const o={width:e,height:t},a=n?new Ah(this._scene,o):new ba.$("XR renderTargetTexture",o,this._scene),h=a.renderTarget;if(h._samples=a.samples,!i&&s||(h._framebuffer=i),s)if(n)h._colorTextureArray=s;else{const e=this._createInternalTexture(o,s);h.setTexture(e,0),a._texture=e}return r&&(n?h._depthStencilTextureArray=r:h._depthStencilTexture=this._createInternalTexture(o,r)),a.disableRescaling(),this._renderTargetTextures.push(a),a}_destroyRenderTargetTexture(e){this._renderTargetTextures.splice(this._renderTargetTextures.indexOf(e),1),e.dispose()}getFramebufferDimensions(){return this._framebufferDimensions}dispose(){this._renderTargetTextures.forEach((e=>e.dispose())),this._renderTargetTextures.length=0}}class qh extends Hh{constructor(e){super((()=>e.framebufferWidth),(()=>e.framebufferHeight),e,"XRWebGLLayer",(e=>new Qh(e.scene,this))),this.layer=e}}class Qh extends Xh{constructor(e,t){super(e,t),this.layerWrapper=t,this._layer=t.layer,this._framebufferDimensions={framebufferWidth:this._layer.framebufferWidth,framebufferHeight:this._layer.framebufferHeight}}trySetViewportForView(e,t){const i=this._layer.getViewport(t);if(!i)return!1;const s=this._framebufferDimensions.framebufferWidth,r=this._framebufferDimensions.framebufferHeight;return e.x=i.x/s,e.y=i.y/r,e.width=i.width/s,e.height=i.height/r,!0}getRenderTargetTextureForEye(e){const t=this._layer.framebufferWidth,i=this._layer.framebufferHeight,s=this._layer.framebuffer;return this._rtt&&t===this._framebufferDimensions.framebufferWidth&&i===this._framebufferDimensions.framebufferHeight&&s===this._framebuffer||(this._rtt=this._createRenderTargetTexture(t,i,s),this._framebufferDimensions.framebufferWidth=t,this._framebufferDimensions.framebufferHeight=i,this._framebuffer=s),this._rtt}getRenderTargetTextureForView(e){return this.getRenderTargetTextureForEye(e.eye)}}class Kh{static GetDefaults(e){const t=new Kh;return t.canvasOptions={antialias:!0,depth:!0,stencil:!e||e.isStencilEnable,alpha:!0,framebufferScaleFactor:1},t.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",t}}class Yh{constructor(e,t=Kh.GetDefaults()){if(this._options=t,this._canvas=null,this._engine=null,this.xrLayer=null,this._xrLayerWrapper=null,this.onXRLayerInitObservable=new Zi.cP,this._engine=e.scene.getEngine(),this._engine.onDisposeObservable.addOnce((()=>{this._engine=null})),t.canvasElement)this._setManagedOutputCanvas(t.canvasElement);else{const e=document.createElement("canvas");e.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(e)}e.onXRSessionInit.add((()=>{this._addCanvas()})),e.onXRSessionEnded.add((()=>{this._removeCanvas()})),this._makeCanvasCompatibleAsync()}dispose(){this._removeCanvas(),this._setManagedOutputCanvas(null),this.onXRLayerInitObservable.clear()}_makeCanvasCompatibleAsync(){this._canvasCompatiblePromise=new Promise(((e,t)=>{try{this.canvasContext&&this.canvasContext.makeXRCompatible?this.canvasContext.makeXRCompatible().then((()=>{e()}),(()=>{$i.S0.Warn("Error executing makeXRCompatible. This does not mean that the session will work incorrectly."),e()})):e()}catch(e){t(e)}}))}async initializeXRLayerAsync(e){const t=()=>(this.xrLayer=new XRWebGLLayer(e,this.canvasContext,this._options.canvasOptions),this._xrLayerWrapper=new qh(this.xrLayer),this.onXRLayerInitObservable.notifyObservers(this.xrLayer),this.xrLayer);return this._canvasCompatiblePromise.then((()=>{}),(()=>{})).then((()=>t()))}_addCanvas(){this._canvas&&this._engine&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas),this.xrLayer?this._setCanvasSize(!0):this.onXRLayerInitObservable.addOnce((()=>{this._setCanvasSize(!0)}))}_removeCanvas(){this._canvas&&this._engine&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas),this._setCanvasSize(!1)}_setCanvasSize(e=!0,t=this._xrLayerWrapper){this._canvas&&this._engine&&(e?t&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=t.getWidth()+"px",this._canvas.style.height=t.getHeight()+"px"):this._engine.setSize(t.getWidth(),t.getHeight())):this._originalCanvasSize&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=this._originalCanvasSize.width+"px",this._canvas.style.height=this._originalCanvasSize.height+"px"):this._engine.setSize(this._originalCanvasSize.width,this._originalCanvasSize.height)))}_setManagedOutputCanvas(e){this._removeCanvas(),e?(this._originalCanvasSize={width:e.offsetWidth,height:e.offsetHeight},this._canvas=e,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)}}class jh extends Hh{constructor(e){super((()=>e.framebufferWidth),(()=>e.framebufferHeight),e,"XRWebGLLayer",(e=>new Zh(e,this))),this.layer=e}}class Zh extends Xh{constructor(e,t){super(e.scene,t),this.layerWrapper=t,this._nativeRTTProvider=navigator.xr.getNativeRenderTargetProvider(e.session,this._createRenderTargetTexture.bind(this),this._destroyRenderTargetTexture.bind(this)),this._nativeLayer=t.layer}trySetViewportForView(e){return e.x=0,e.y=0,e.width=1,e.height=1,!0}getRenderTargetTextureForEye(e){return this._nativeRTTProvider.getRenderTargetForEye(e)}getRenderTargetTextureForView(e){return this._nativeRTTProvider.getRenderTargetForEye(e.eye)}getFramebufferDimensions(){return{framebufferWidth:this._nativeLayer.framebufferWidth,framebufferHeight:this._nativeLayer.framebufferHeight}}}class $h{constructor(e){this._nativeRenderTarget=navigator.xr.getWebXRRenderTarget(e.scene.getEngine())}async initializeXRLayerAsync(e){return await this._nativeRenderTarget.initializeXRLayerAsync(e),this.xrLayer=this._nativeRenderTarget.xrLayer,this.xrLayer}dispose(){}}class Jh{get worldScalingFactor(){return this._worldScalingFactor}set worldScalingFactor(e){const t=this._worldScalingFactor;this._worldScalingFactor=e,this.onWorldScaleFactorChangedObservable.notifyObservers({previousScaleFactor:t,newScaleFactor:e})}constructor(e){this.scene=e,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new Zi.cP,this.onXRReferenceSpaceChanged=new Zi.cP,this.onXRSessionEnded=new Zi.cP,this.onXRSessionInit=new Zi.cP,this.onXRReferenceSpaceInitialized=new Zi.cP,this.onXRReady=new Zi.cP,this.inXRFrameLoop=!1,this.inXRSession=!1,this._worldScalingFactor=1,this.onWorldScaleFactorChangedObservable=new Zi.cP(void 0,!0),this._engine=e.getEngine(),this._onEngineDisposedObserver=this._engine.onDisposeObservable.addOnce((()=>{this._engine=null})),e.onDisposeObservable.addOnce((()=>{this.dispose()}))}get referenceSpace(){return this._referenceSpace}set referenceSpace(e){this._referenceSpace=e,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)}get sessionMode(){return this._sessionMode}dispose(){this.inXRSession&&this.exitXRAsync(),this.onXRReady.clear(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear(),this.onWorldScaleFactorChangedObservable.clear(),this._engine?.onDisposeObservable.remove(this._onEngineDisposedObserver),this._engine=null}async exitXRAsync(){if(this.session&&this.inXRSession){this.inXRSession=!1;try{return await this.session.end()}catch{It.V.Warn("Could not end XR session.")}}return Promise.resolve()}trySetViewportForView(e,t){return this._baseLayerRTTProvider?.trySetViewportForView(e,t)||!1}getRenderTargetTextureForEye(e){return this._baseLayerRTTProvider?.getRenderTargetTextureForEye(e)||null}getRenderTargetTextureForView(e){return this._baseLayerRTTProvider?.getRenderTargetTextureForView(e)||null}getWebXRRenderTarget(e){const t=this.scene.getEngine();return this._xrNavigator.xr.native?new $h(this):((e=e||Kh.GetDefaults(t)).canvasElement=e.canvasElement||t.getRenderingCanvas()||void 0,new Yh(this,e))}initializeAsync(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")}initializeSessionAsync(e="immersive-vr",t={}){return this._xrNavigator.xr.requestSession(e,t).then((t=>(this.session=t,this._sessionMode=e,this.inXRSession=!0,this.onXRSessionInit.notifyObservers(t),this.session.addEventListener("end",(()=>{this.inXRSession=!1,this.onXRSessionEnded.notifyObservers(null),this._engine&&(this._engine.framebufferDimensionsObject=null,this._engine.restoreDefaultFramebuffer(),this._engine.customAnimationFrameRequester=null,this._engine._renderLoop()),this.isNative&&this._baseLayerRTTProvider?.dispose(),this._baseLayerRTTProvider=null,this._baseLayerWrapper=null}),{once:!0}),this.session)))}isSessionSupportedAsync(e){return Jh.IsSessionSupportedAsync(e)}resetReferenceSpace(){this.referenceSpace=this.baseReferenceSpace}runXRRenderLoop(){this.inXRSession&&this._engine&&(this._engine.customAnimationFrameRequester={requestAnimationFrame:e=>this.session.requestAnimationFrame(e),renderFunction:(e,t)=>{if(this.inXRSession&&this._engine&&(this.currentFrame=t,this.currentTimestamp=e,t)){this.inXRFrameLoop=!0;const e=this._baseLayerRTTProvider?.getFramebufferDimensions()||null;this._engine.framebufferDimensionsObject!==e&&(this._engine.framebufferDimensionsObject=e),this.onXRFrameObservable.notifyObservers(t),this._engine._renderLoop(),this._engine.framebufferDimensionsObject=null,this.inXRFrameLoop=!1}}},this._engine.framebufferDimensionsObject=this._baseLayerRTTProvider?.getFramebufferDimensions()||null,this.onXRFrameObservable.addOnce((()=>{this.onXRReady.notifyObservers(this)})),"undefined"!=typeof window&&window.cancelAnimationFrame&&window.cancelAnimationFrame(this._engine._frameHandler),this._engine._renderLoop())}setReferenceSpaceTypeAsync(e="local-floor"){return this.session.requestReferenceSpace(e).then((e=>e),(e=>(It.V.Error("XR.requestReferenceSpace failed for the following reason: "),It.V.Error(e),It.V.Log('Defaulting to universally-supported "viewer" reference space type.'),this.session.requestReferenceSpace("viewer").then((e=>{const t=new XRRigidTransform({x:0,y:-this.defaultHeightCompensation,z:0});return e.getOffsetReferenceSpace(t)}),(e=>{throw It.V.Error(e),'XR initialization failed: required "viewer" reference space type not supported.'}))))).then((e=>this.session.requestReferenceSpace("viewer").then((t=>(this.viewerReferenceSpace=t,e))))).then((e=>(this.referenceSpace=this.baseReferenceSpace=e,this.onXRReferenceSpaceInitialized.notifyObservers(e),this.referenceSpace)))}updateRenderStateAsync(e){return Promise.resolve(this.session.updateRenderState(e))}_setBaseLayerWrapper(e){this.isNative&&this._baseLayerRTTProvider?.dispose(),this._baseLayerWrapper=e,this._baseLayerRTTProvider=this._baseLayerWrapper?.createRenderTargetTextureProvider(this)||null}_getBaseLayerWrapper(){return this._baseLayerWrapper}updateRenderState(e){e.baseLayer&&this._setBaseLayerWrapper(this.isNative?new jh(e.baseLayer):new qh(e.baseLayer)),this.session.updateRenderState(e)}static IsSessionSupportedAsync(e){if(!navigator.xr)return Promise.resolve(!1);const t=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return t?t.call(navigator.xr,e).then((e=>{const t=void 0===e||e;return Promise.resolve(t)})).catch((e=>(It.V.Warn(e),Promise.resolve(!1)))):Promise.resolve(!1)}get isNative(){return this._xrNavigator.xr.native??!1}get currentFrameRate(){return this.session?.frameRate}get supportedFrameRates(){return this.session?.supportedFrameRates}updateTargetFrameRate(e){return this.session.updateTargetFrameRate(e)}runInXRFrame(e,t=!0){this.inXRFrameLoop?e():!this.inXRSession&&t||this.onXRFrameObservable.addOnce(e)}get isFixedFoveationSupported(){return this._baseLayerWrapper?.isFixedFoveationSupported||!1}get fixedFoveation(){return this._baseLayerWrapper?.fixedFoveation||null}set fixedFoveation(e){const t=Math.max(0,Math.min(1,e||0));this._baseLayerWrapper&&(this._baseLayerWrapper.fixedFoveation=t)}get enabledFeatures(){return this.session?.enabledFeatures??null}}class el{constructor(e,t=null){if(this.scene=e,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=el._IdCounter++,t)this._gazeTracker=t.clone("gazeTracker");else{this._gazeTracker=_o("gazeTracker",{diameter:.0035,thickness:.0025,tessellation:20,updatable:!1},e),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;const t=new ft.F("targetMat",e);t.specularColor=bt.v9.Black(),t.emissiveColor=new bt.v9(.7,.7,.7),t.backFaceCulling=!1,this._gazeTracker.material=t}}_getForwardRay(e){return new fa.Rl(gt.Pq.Zero(),new gt.Pq(0,0,e))}_selectionPointerDown(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})}_selectionPointerUp(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1}_activatePointer(){this._activePointer=!0}_deactivatePointer(){this._activePointer=!1}_updatePointerDistance(e=100){}dispose(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()}}el._IdCounter=0;class tl extends el{constructor(e,t){super(t),this._getCamera=e}_getForwardRay(e){const t=this._getCamera();return t?t.getForwardRay(e):new fa.Rl(gt.Pq.Zero(),gt.Pq.Forward())}}class il{get onEnteringVR(){return this.onEnteringVRObservable}get onExitingVR(){return this.onExitingVRObservable}get teleportationTarget(){return this._teleportationTarget}set teleportationTarget(e){e&&(e.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=e)}get gazeTrackerMesh(){return this._cameraGazer._gazeTracker}set gazeTrackerMesh(e){e&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._cameraGazer._gazeTracker=e,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker")}get displayGaze(){return this._displayGaze}set displayGaze(e){this._displayGaze=e,e||(this._cameraGazer._gazeTracker.isVisible=!1)}get displayLaserPointer(){return this._displayLaserPointer}set displayLaserPointer(e){this._displayLaserPointer=e}get deviceOrientationCamera(){return this._deviceOrientationCamera}get currentVRCamera(){return this._scene.activeCamera}get vrDeviceOrientationCamera(){return this._vrDeviceOrientationCamera}get vrButton(){return this._btnVR}get _teleportationRequestInitiated(){return this._cameraGazer._teleportationRequestInitiated}constructor(e,t={}){if(this.webVROptions=t,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new Zi.cP,this.onAfterEnteringVRObservable=new Zi.cP,this.onExitingVRObservable=new Zi.cP,this._useCustomVRButton=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=il.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new gt.Pq(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new gt.Pq(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._pickedLaserColor=new bt.v9(.2,.2,1),this._pickedGazeColor=new bt.v9(0,0,1),this.onNewMeshSelected=new Zi.cP,this.onNewMeshPicked=new Zi.cP,this.onBeforeCameraTeleport=new Zi.cP,this.onAfterCameraTeleport=new Zi.cP,this.onSelectedMeshUnselected=new Zi.cP,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=()=>{this._moveButtonToBottomRight()},this._onFullscreenChange=()=>{this._fullscreenVRpresenting=!!document.fullscreenElement,!this._fullscreenVRpresenting&&this._inputElement&&(this.exitVR(),!this._useCustomVRButton&&this._btnVR&&(this._btnVR.style.top=this._inputElement.offsetTop+this._inputElement.offsetHeight-70+"px",this._btnVR.style.left=this._inputElement.offsetLeft+this._inputElement.offsetWidth-100+"px",this._updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this._beforeRender=()=>{this._scene.getEngine().isPointerLock||this.enableGazeEvenWhenNoPointerLock||(this._cameraGazer._gazeTracker.isVisible=!1)},this._onNewGamepadConnected=e=>{e.type!==Ih.POSE_ENABLED&&(e.leftStick&&e.onleftstickchanged((e=>{this._teleportationInitialized&&this.teleportationEnabled&&(this._checkTeleportWithRay(e,this._cameraGazer),this._checkTeleportBackwards(e,this._cameraGazer))})),e.rightStick&&e.onrightstickchanged((e=>{this._teleportationInitialized&&this._checkRotate(e,this._cameraGazer)})),e.type===Ih.XBOX&&(e.onbuttondown((e=>{this._interactionsEnabled&&0===e&&this._cameraGazer._selectionPointerDown()})),e.onbuttonup((e=>{this._interactionsEnabled&&0===e&&this._cameraGazer._selectionPointerUp()}))))},this._workingVector=gt.Pq.Zero(),this._workingQuaternion=gt.PT.Identity(),this._workingMatrix=gt.uq.Identity(),It.V.Warn("WebVR is deprecated. Please avoid using this experience helper and use the WebXR experience helper instead"),this._scene=e,this._inputElement=e.getEngine().getInputElement(),"getVRDisplays"in navigator||void 0!==t.useXR||(t.useXR=!0),void 0===t.createFallbackVRDeviceOrientationFreeCamera&&(t.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===t.createDeviceOrientationCamera&&(t.createDeviceOrientationCamera=!0),void 0===t.laserToggle&&(t.laserToggle=!0),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new gt.Pq(0,this._defaultHeight,0),t.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new vh("deviceOrientationVRHelper",this._position.clone(),e),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof ih.F&&this._scene.activeCamera.rotation)){const e=this._scene.activeCamera;e.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(e.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(gt.PT.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z)),this._deviceOrientationCamera.rotation=e.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl()}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?Jh.IsSessionSupportedAsync("immersive-vr").then((i=>{i?(It.V.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),e.createDefaultXRExperienceAsync({floorMeshes:t.floorMeshes||[]}).then((t=>{this.xr=t,this.xrTestDone=!0,this._cameraGazer=new tl((()=>this.xr.baseExperience.camera),e),this.xr.baseExperience.onStateChangedObservable.add((e=>{switch(e){case 0:this.onEnteringVRObservable.notifyObservers(this),this._interactionsEnabled||this.xr.pointerSelection.detach(),this.xr.pointerSelection.displayLaserPointer=this._displayLaserPointer;break;case 1:this.onExitingVRObservable.notifyObservers(this),this._scene.getEngine().resize();break;case 2:this._hasEnteredVR=!0;break;case 3:this._hasEnteredVR=!1}}))}))):this._completeVRInit(e,t)})):this._completeVRInit(e,t)}_completeVRInit(e,t){if(this.xrTestDone=!0,t.createFallbackVRDeviceOrientationFreeCamera&&(this._vrDeviceOrientationCamera=new Ph("VRDeviceOrientationVRHelper",this._position,this._scene,!0,t.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._cameraGazer=new tl((()=>this.currentVRCamera),e),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";let e=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";e+=".babylonVRicon.vrdisplaypresenting { display: none; }";const t=document.createElement("style");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t),this._moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",(()=>{this.isInVRMode||this.enterVR()}));const i=this._scene.getEngine().getHostWindow();i&&(i.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),t.createFallbackVRDeviceOrientationFreeCamera&&this._displayVRButton(),this._onKeyDown=e=>{27===e.keyCode&&this.isInVRMode&&this.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add((()=>{this._hasEnteredVR&&this.exitVROnDoubleTap&&(this.exitVR(),this._fullscreenVRpresenting&&this._scene.getEngine().exitFullscreen())}),tt.Zp.POINTERDOUBLETAP,!1),e.onDisposeObservable.add((()=>{this.dispose()})),this._updateButtonVisibility(),this._circleEase=new ja,this._circleEase.setEasingMode(Ya.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,e.onPointerObservable.add((t=>{this._interactionsEnabled&&e.activeCamera===this.vrDeviceOrientationCamera&&"mouse"===t.event.pointerType&&(t.type===tt.Zp.POINTERDOWN?this._cameraGazer._selectionPointerDown():t.type===tt.Zp.POINTERUP&&this._cameraGazer._selectionPointerUp())})),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))}get isInVRMode(){return this.xr&&this.webVROptions.useXR&&2===this.xr.baseExperience.state||this._fullscreenVRpresenting}_moveButtonToBottomRight(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){const e=this._inputElement.getBoundingClientRect();this._btnVR.style.top=e.top+e.height-70+"px",this._btnVR.style.left=e.left+e.width-100+"px"}}_displayVRButton(){this._useCustomVRButton||this._btnVRDisplayed||!this._btnVR||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)}_updateButtonVisibility(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode&&(this._btnVR.className+=" vrdisplaypresenting"))}enterVR(){if(this.xr)this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);else{if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(e){It.V.Warn("Error in your custom logic onEnteringVR: "+e)}this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=gt.PT.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)),this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this._updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce((()=>{this.onAfterEnteringVRObservable.notifyObservers({success:!0})}))),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(),this._interactionsEnabled&&this._scene.registerBeforeRender(this._beforeRender),this._hasEnteredVR=!0}}exitVR(){if(this.xr)this.xr.baseExperience.exitXRAsync();else if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(e){It.V.Warn("Error in your custom logic onExitingVR: "+e)}this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this._updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this._beforeRender),this._cameraGazer._gazeTracker.isVisible=!1),this._scene.getEngine().resize(),this._hasEnteredVR=!1}}get position(){return this._position}set position(e){this._position=e,this._scene.activeCamera&&(this._scene.activeCamera.position=e)}enableInteractions(){if(!this._interactionsEnabled){if(this.xr)return void(2===this.xr.baseExperience.state&&this.xr.pointerSelection.attach());this.raySelectionPredicate=e=>e.isVisible&&(e.isPickable||e.name===this._floorMeshName),this.meshSelectionPredicate=()=>!0,this._raySelectionPredicate=e=>!!(this._isTeleportationFloor(e)||-1===e.name.indexOf("gazeTracker")&&-1===e.name.indexOf("teleportationTarget")&&-1===e.name.indexOf("torusTeleportation"))&&this.raySelectionPredicate(e),this._interactionsEnabled=!0}}_isTeleportationFloor(e){for(let t=0;t<this._floorMeshesCollection.length;t++)if(this._floorMeshesCollection[t].id===e.id)return!0;return!(!this._floorMeshName||e.name!==this._floorMeshName)}addFloorMesh(e){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(e)>-1||this._floorMeshesCollection.push(e))}removeFloorMesh(e){if(!this._floorMeshesCollection)return;const t=this._floorMeshesCollection.indexOf(e);-1!==t&&this._floorMeshesCollection.splice(t,1)}enableTeleportation(e={}){if(!this._teleportationInitialized){if(this.enableInteractions(),this.webVROptions.useXR&&(e.floorMeshes||e.floorMeshName)){const t=e.floorMeshes||[];if(!t.length){const i=this._scene.getMeshByName(e.floorMeshName);i&&t.push(i)}if(this.xr)return t.forEach((e=>{this.xr.teleportation.addFloorMesh(e)})),void(this.xr.teleportation.attached||this.xr.teleportation.attach());if(!this.xrTestDone){const t=()=>{this.xrTestDone&&(this._scene.unregisterBeforeRender(t),this.xr?this.xr.teleportation.attached||this.xr.teleportation.attach():this.enableTeleportation(e))};return void this._scene.registerBeforeRender(t)}}e.floorMeshName&&(this._floorMeshName=e.floorMeshName),e.floorMeshes&&(this._floorMeshesCollection=e.floorMeshes),e.teleportationMode&&(this._teleportationMode=e.teleportationMode),e.teleportationTime&&e.teleportationTime>0&&(this._teleportationTime=e.teleportationTime),e.teleportationSpeed&&e.teleportationSpeed>0&&(this._teleportationSpeed=e.teleportationSpeed),void 0!==e.easingFunction&&(this._teleportationEasing=e.easingFunction);const t=new Bt.p;t.vignetteColor=new bt.ov(0,0,0,0),t.vignetteEnabled=!0,this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&this._createTeleportationCircles()}}_checkTeleportWithRay(e,t){this._teleportationRequestInitiated&&!t._teleportationRequestInitiated||(t._teleportationRequestInitiated?Math.sqrt(e.y*e.y+e.x*e.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),t._teleportationRequestInitiated=!1):e.y<-this._padSensibilityUp&&t._dpadPressed&&(t._activatePointer(),t._teleportationRequestInitiated=!0))}_checkRotate(e,t){t._teleportationRequestInitiated||(t._rotationLeftAsked?e.x>-this._padSensibilityDown&&(t._rotationLeftAsked=!1):e.x<-this._padSensibilityUp&&t._dpadPressed&&(t._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),t._rotationRightAsked?e.x<this._padSensibilityDown&&(t._rotationRightAsked=!1):e.x>this._padSensibilityUp&&t._dpadPressed&&(t._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))}_checkTeleportBackwards(e,t){if(!t._teleportationRequestInitiated)if(e.y>this._padSensibilityUp&&t._dpadPressed){if(!t._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;const e=gt.PT.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),i=this.currentVRCamera.position;e.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,gt.PT.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),gt.Pq.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);const s=new fa.Rl(i,this._workingVector),r=this._scene.pickWithRay(s,this._raySelectionPredicate);r&&r.pickedPoint&&r.pickedMesh&&this._isTeleportationFloor(r.pickedMesh)&&r.distance<5&&this.teleportCamera(r.pickedPoint),t._teleportationBackRequestInitiated=!0}}else t._teleportationBackRequestInitiated=!1}_createTeleportationCircles(){this._teleportationTarget=Jn("teleportationTarget",{width:2,height:2,subdivisions:2},this._scene),this._teleportationTarget.isPickable=!1;const e=new ns("DynamicTexture",512,this._scene,!0);e.hasAlpha=!0;const t=e.getContext();t.beginPath(),t.arc(256,256,200,0,2*Math.PI,!1),t.fillStyle=this._teleportationFillColor,t.fill(),t.lineWidth=10,t.strokeStyle=this._teleportationBorderColor,t.stroke(),t.closePath(),e.update();const i=new ft.F("TextPlaneMaterial",this._scene);i.diffuseTexture=e,this._teleportationTarget.material=i;const s=_o("torusTeleportation",{diameter:.75,thickness:.1,tessellation:25,updatable:!1},this._scene);s.isPickable=!1,s.parent=this._teleportationTarget;const r=new Ja.X5("animationInnerCircle","position.y",30,Ja.X5.ANIMATIONTYPE_FLOAT,Ja.X5.ANIMATIONLOOPMODE_CYCLE),n=[];n.push({frame:0,value:0}),n.push({frame:30,value:.4}),n.push({frame:60,value:0}),r.setKeys(n);const o=new $a;o.setEasingMode(Ya.EASINGMODE_EASEINOUT),r.setEasingFunction(o),s.animations=[],s.animations.push(r),this._scene.beginAnimation(s,0,60,!0),this._hideTeleportationTarget()}_hideTeleportationTarget(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))}_rotateCamera(e){if(!(this.currentVRCamera instanceof fh.S))return;e?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];const t=gt.PT.FromRotationMatrix(gt.uq.RotationY(Math.PI/4*this._rotationAngle)),i=new Ja.X5("animationRotation","rotationQuaternion",90,Ja.X5.ANIMATIONTYPE_QUATERNION,Ja.X5.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),s.push({frame:6,value:t}),i.setKeys(s),i.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(i),this._postProcessMove.animations=[];const r=new Ja.X5("animationPP","vignetteWeight",90,Ja.X5.ANIMATIONTYPE_FLOAT,Ja.X5.ANIMATIONLOOPMODE_CONSTANT),n=[];n.push({frame:0,value:0}),n.push({frame:3,value:4}),n.push({frame:6,value:0}),r.setKeys(n),r.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(r);const o=new Ja.X5("animationPP2","vignetteStretch",90,Ja.X5.ANIMATIONTYPE_FLOAT,Ja.X5.ANIMATIONLOOPMODE_CONSTANT),a=[];a.push({frame:0,value:0}),a.push({frame:3,value:10}),a.push({frame:6,value:0}),o.setKeys(a),o.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(o),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}teleportCamera(e){if(!(this.currentVRCamera instanceof fh.S))return;let t,i;if(this._workingVector.copyFrom(e),this.isInVRMode||(this._workingVector.y+=this._defaultHeight),this.onBeforeCameraTeleport.notifyObservers(this._workingVector),this._teleportationMode==il.TELEPORTATIONMODE_CONSTANTSPEED){i=90;const e=gt.Pq.Distance(this.currentVRCamera.position,this._workingVector);t=this._teleportationSpeed/e}else i=Math.round(90*this._teleportationTime/1e3),t=1;this.currentVRCamera.animations=[];const s=new Ja.X5("animationCameraTeleportation","position",90,Ja.X5.ANIMATIONTYPE_VECTOR3,Ja.X5.ANIMATIONLOOPMODE_CONSTANT),r=[{frame:0,value:this.currentVRCamera.position},{frame:i,value:this._workingVector}];s.setKeys(r),s.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(s),this._postProcessMove.animations=[];const n=Math.round(i/2),o=new Ja.X5("animationPP","vignetteWeight",90,Ja.X5.ANIMATIONTYPE_FLOAT,Ja.X5.ANIMATIONLOOPMODE_CONSTANT),a=[];a.push({frame:0,value:0}),a.push({frame:n,value:8}),a.push({frame:i,value:0}),o.setKeys(a),this._postProcessMove.animations.push(o);const h=new Ja.X5("animationPP2","vignetteStretch",90,Ja.X5.ANIMATIONTYPE_FLOAT,Ja.X5.ANIMATIONLOOPMODE_CONSTANT),l=[];l.push({frame:0,value:0}),l.push({frame:n,value:10}),l.push({frame:i,value:0}),h.setKeys(l),this._postProcessMove.animations.push(h),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._scene.beginAnimation(this.currentVRCamera,0,i,!1,t,(()=>{this.onAfterCameraTeleport.notifyObservers(this._workingVector)})),this._hideTeleportationTarget()}setLaserColor(e,t=this._pickedLaserColor){this._pickedLaserColor=t}setLaserLightingState(e=!0){}setGazeColor(e,t=this._pickedGazeColor){this._pickedGazeColor=t}changeLaserColor(e){this.updateControllerLaserColor}changeGazeColor(e){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=e)}dispose(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection.length=0,document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChangeBind),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.unregisterBeforeRender(this._beforeRender)}getClassName(){return"VRExperienceHelper"}}il.TELEPORTATIONMODE_CONSTANTTIME=0,il.TELEPORTATIONMODE_CONSTANTSPEED=1,o(8908),o(4526),o(462);class sl extends fh.S{constructor(e,t,i){super(e,gt.Pq.Zero(),t),this._xrSessionManager=i,this._firstFrame=!1,this._referenceQuaternion=gt.PT.Identity(),this._referencedPosition=new gt.Pq,this._trackingState=0,this.onXRCameraInitializedObservable=new Zi.cP,this.onBeforeCameraTeleport=new Zi.cP,this.onAfterCameraTeleport=new Zi.cP,this.onTrackingStateChanged=new Zi.cP,this.compensateOnFirstFrame=!0,this._rotate180=new gt.PT(0,1,0,0),this.minZ=.1,this.rotationQuaternion=new gt.PT,this.cameraRigMode=Ra.i.RIG_MODE_CUSTOM,this.updateUpVectorFromRotation=!0,this._updateNumberOfRigCameras(1),this.freezeProjectionMatrix(),this._deferOnly=!0,this._xrSessionManager.onXRSessionInit.add((()=>{this._referencedPosition.copyFromFloats(0,0,0),this._referenceQuaternion.copyFromFloats(0,0,0,1),this._firstFrame=this.compensateOnFirstFrame,this._xrSessionManager.onWorldScaleFactorChangedObservable.add((()=>{this._xrSessionManager.currentFrame&&this._updateDepthNearFar()}))})),this._xrSessionManager.onXRFrameObservable.add((()=>{this._firstFrame&&this._updateFromXRSession(),this.onXRCameraInitializedObservable.hasObservers()&&(this.onXRCameraInitializedObservable.notifyObservers(this),this.onXRCameraInitializedObservable.clear()),this._deferredUpdated&&(this.position.copyFrom(this._deferredPositionUpdate),this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate)),this._updateReferenceSpace(),this._updateFromXRSession()}),void 0,!0)}get trackingState(){return this._trackingState}_setTrackingState(e){this._trackingState!==e&&(this._trackingState=e,this.onTrackingStateChanged.notifyObservers(e))}get realWorldHeight(){const e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return e&&e.transform?e.transform.position.y*this._xrSessionManager.worldScalingFactor:0}_updateForDualEyeDebugging(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new Es.L(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new Es.L(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null}setTransformationFromNonVRCamera(e=this.getScene().activeCamera,t=!0){e&&e!==this&&(e.computeWorldMatrix().decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,gt.PT.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,t&&this._xrSessionManager.resetReferenceSpace())}getClassName(){return"WebXRCamera"}setTarget(e){const t=gt.AA.Vector3[1];e.subtractToRef(this.position,t),t.y=0,t.normalize();const i=Math.atan2(t.x,t.z);this.rotationQuaternion.toEulerAnglesToRef(t),gt.PT.FromEulerAnglesToRef(t.x,i,t.z,this.rotationQuaternion)}dispose(){super.dispose(),this._lastXRViewerPose=void 0,this.onTrackingStateChanged.clear()}_updateDepthNearFar(){const e=(this.maxZ||1e4)*this._xrSessionManager.worldScalingFactor,t={depthFar:e,depthNear:this.minZ};this._xrSessionManager.updateRenderState(t),this._cache.minZ=this.minZ,this._cache.maxZ=e}_updateFromXRSession(){const e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);if(this._lastXRViewerPose=e||void 0,!e)return void this._setTrackingState(0);const t=e.emulatedPosition?1:2;if(this._setTrackingState(t),this.minZ===this._cache.minZ&&this.maxZ===this._cache.maxZ||this._updateDepthNearFar(),e.transform){const t=e.transform.orientation;if(void 0===e.transform.orientation.x)return;const i=e.transform.position;this._referencedPosition.set(i.x,i.y,i.z).scaleInPlace(this._xrSessionManager.worldScalingFactor),this._referenceQuaternion.set(t.x,t.y,t.z,t.w),this._scene.useRightHandedSystem?this._referenceQuaternion.multiplyInPlace(this._rotate180):(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))}this.rigCameras.length!==e.views.length&&this._updateNumberOfRigCameras(e.views.length),e.views.forEach(((e,t)=>{const i=this.rigCameras[t];i.isLeftCamera||i.isRightCamera||("right"===e.eye?i._isRightCamera=!0:"left"===e.eye&&(i._isLeftCamera=!0));const s=this.getScene().customRenderTargets;for(let e=0;e<s.length;e++){const t=s[e];-1===i.customRenderTargets.indexOf(t)&&i.customRenderTargets.push(t)}const r=e.transform.position,n=e.transform.orientation;i.parent=this.parent,i.position.set(r.x,r.y,r.z).scaleInPlace(this._xrSessionManager.worldScalingFactor),i.rotationQuaternion.set(n.x,n.y,n.z,n.w),this._scene.useRightHandedSystem?i.rotationQuaternion.multiplyInPlace(this._rotate180):(i.position.z*=-1,i.rotationQuaternion.z*=-1,i.rotationQuaternion.w*=-1),gt.uq.FromFloat32ArrayToRefScaled(e.projectionMatrix,0,1,i._projectionMatrix),this._scene.useRightHandedSystem||i._projectionMatrix.toggleProjectionMatrixHandInPlace();const o=2*Math.atan2(1,e.projectionMatrix[5]);i.fov=o,0===t&&(this.fov=o,this._projectionMatrix.copyFrom(i._projectionMatrix));const a=this._xrSessionManager.getRenderTargetTextureForView(e);this._renderingMultiview=a?._texture?.isMultiview||!1,this._renderingMultiview?0==t&&(this._xrSessionManager.trySetViewportForView(this.viewport,e),this.outputRenderTarget=a):(this._xrSessionManager.trySetViewportForView(i.viewport,e),i.outputRenderTarget=a||this._xrSessionManager.getRenderTargetTextureForView(e)),i.layerMask=this.layerMask}))}_updateNumberOfRigCameras(e=1){for(;this.rigCameras.length<e;){const e=new ih.F("XR-RigCamera: "+this.rigCameras.length,gt.Pq.Zero(),this.getScene());e.minZ=.1,e.rotationQuaternion=new gt.PT,e.updateUpVectorFromRotation=!0,e.isRigCamera=!0,e.rigParent=this,e.freezeProjectionMatrix(),this.rigCameras.push(e)}for(;this.rigCameras.length>e;){const e=this.rigCameras.pop();e&&e.dispose()}}_updateReferenceSpace(){if(!this.position.equals(this._referencedPosition)||!this.rotationQuaternion.equals(this._referenceQuaternion)){const e=gt.AA.Matrix[0],t=gt.AA.Matrix[1],i=gt.AA.Matrix[2];gt.uq.ComposeToRef(sl._ScaleReadOnly,this._referenceQuaternion,this._referencedPosition,e),gt.uq.ComposeToRef(sl._ScaleReadOnly,this.rotationQuaternion,this.position,t),e.invert().multiplyToRef(t,i),i.invert(),this._scene.useRightHandedSystem||i.toggleModelMatrixHandInPlace(),i.decompose(void 0,this._referenceQuaternion,this._referencedPosition);const s=new XRRigidTransform({x:this._referencedPosition.x/this._xrSessionManager.worldScalingFactor,y:this._referencedPosition.y/this._xrSessionManager.worldScalingFactor,z:this._referencedPosition.z/this._xrSessionManager.worldScalingFactor},{x:this._referenceQuaternion.x,y:this._referenceQuaternion.y,z:this._referenceQuaternion.z,w:this._referenceQuaternion.w});this._xrSessionManager.referenceSpace=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(s)}}}sl._ScaleReadOnly=gt.Pq.One();class rl{}rl.ANCHOR_SYSTEM="xr-anchor-system",rl.BACKGROUND_REMOVER="xr-background-remover",rl.HIT_TEST="xr-hit-test",rl.MESH_DETECTION="xr-mesh-detection",rl.PHYSICS_CONTROLLERS="xr-physics-controller",rl.PLANE_DETECTION="xr-plane-detection",rl.POINTER_SELECTION="xr-controller-pointer-selection",rl.TELEPORTATION="xr-controller-teleportation",rl.FEATURE_POINTS="xr-feature-points",rl.HAND_TRACKING="xr-hand-tracking",rl.IMAGE_TRACKING="xr-image-tracking",rl.NEAR_INTERACTION="xr-near-interaction",rl.DOM_OVERLAY="xr-dom-overlay",rl.MOVEMENT="xr-controller-movement",rl.LIGHT_ESTIMATION="xr-light-estimation",rl.EYE_TRACKING="xr-eye-tracking",rl.WALKING_LOCOMOTION="xr-walking-locomotion",rl.LAYERS="xr-layers",rl.DEPTH_SENSING="xr-depth-sensing",rl.SPACE_WARP="xr-space-warp",rl.RAW_CAMERA_ACCESS="xr-raw-camera-access";class nl{constructor(e){this._xrSessionManager=e,this._features={},this._xrSessionManager.onXRSessionInit.add((()=>{this.getEnabledFeatures().forEach((e=>{const t=this._features[e];!t.enabled||t.featureImplementation.attached||t.featureImplementation.disableAutoAttach||this.attachFeature(e)}))})),this._xrSessionManager.onXRSessionEnded.add((()=>{this.getEnabledFeatures().forEach((e=>{const t=this._features[e];t.enabled&&t.featureImplementation.attached&&this.detachFeature(e)}))}))}static AddWebXRFeature(e,t,i=1,s=!1){this._AvailableFeatures[e]=this._AvailableFeatures[e]||{latest:i},i>this._AvailableFeatures[e].latest&&(this._AvailableFeatures[e].latest=i),s&&(this._AvailableFeatures[e].stable=i),this._AvailableFeatures[e][i]=t}static ConstructFeature(e,t=1,i,s){const r=this._AvailableFeatures[e][t];if(!r)throw new Error("feature not found");return r(i,s)}static GetAvailableFeatures(){return Object.keys(this._AvailableFeatures)}static GetAvailableVersions(e){return Object.keys(this._AvailableFeatures[e])}static GetLatestVersionOfFeature(e){return this._AvailableFeatures[e]&&this._AvailableFeatures[e].latest||-1}static GetStableVersionOfFeature(e){return this._AvailableFeatures[e]&&this._AvailableFeatures[e].stable||-1}attachFeature(e){const t=this._features[e];t&&t.enabled&&!t.featureImplementation.attached&&(t.featureImplementation.attach()||$i.S0.Warn(`Feature ${e} failed to attach`))}detachFeature(e){const t=this._features[e];t&&t.featureImplementation.attached&&(t.featureImplementation.detach()||$i.S0.Warn(`Feature ${e} failed to detach`))}disableFeature(e){const t="string"==typeof e?e:e.Name,i=this._features[t];return!(!i||!i.enabled||(i.enabled=!1,this.detachFeature(t),i.featureImplementation.dispose(),delete this._features[t],0))}dispose(){this.getEnabledFeatures().forEach((e=>{this.disableFeature(e)}))}enableFeature(e,t="latest",i={},s=!0,r=!0){const n="string"==typeof e?e:e.Name;let o=0;if("string"==typeof t){if(!t)throw new Error(`Error in provided version - ${n} (${t})`);if(o="stable"===t?nl.GetStableVersionOfFeature(n):"latest"===t?nl.GetLatestVersionOfFeature(n):+t,-1===o||isNaN(o))throw new Error(`feature not found - ${n} (${t})`)}else o=t;const a=nl._ConflictingFeatures[n];if(void 0!==a&&-1!==this.getEnabledFeatures().indexOf(a))throw new Error(`Feature ${n} cannot be enabled while ${a} is enabled.`);const h=this._features[n],l=nl.ConstructFeature(n,o,this._xrSessionManager,i);if(!l)throw new Error(`feature not found - ${n}`);h&&this.disableFeature(n);const c=l();if(c.dependsOn){const e=c.dependsOn.every((e=>!!this._features[e]));if(!e)throw new Error(`Dependant features missing. Make sure the following features are enabled - ${c.dependsOn.join(", ")}`)}if(c.isCompatible())return this._features[n]={featureImplementation:c,enabled:!0,version:o,required:r},s?this._xrSessionManager.session&&!this._features[n].featureImplementation.attached&&this.attachFeature(n):this._features[n].featureImplementation.disableAutoAttach=!0,this._features[n].featureImplementation;if(r)throw new Error("required feature not compatible");return $i.S0.Warn(`Feature ${n} not compatible with the current environment/browser and was not enabled.`),c}getEnabledFeature(e){return this._features[e]&&this._features[e].featureImplementation}getEnabledFeatures(){return Object.keys(this._features)}async _extendXRSessionInitObject(e){const t=this.getEnabledFeatures();for(const i of t){const t=this._features[i],s=t.featureImplementation.xrNativeFeatureName;if(s&&(t.required?(e.requiredFeatures=e.requiredFeatures||[],-1===e.requiredFeatures.indexOf(s)&&e.requiredFeatures.push(s)):(e.optionalFeatures=e.optionalFeatures||[],-1===e.optionalFeatures.indexOf(s)&&e.optionalFeatures.push(s))),t.featureImplementation.getXRSessionInitExtension){const i=await t.featureImplementation.getXRSessionInitExtension();e={...e,...i}}}return e}}nl._AvailableFeatures={},nl._ConflictingFeatures={[rl.TELEPORTATION]:rl.MOVEMENT,[rl.MOVEMENT]:rl.TELEPORTATION},Xa.b.AddNodeConstructor("TouchCamera",((e,t)=>()=>new ol(e,gt.Pq.Zero(),t)));class ol extends fh.S{get touchAngularSensibility(){const e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0}set touchAngularSensibility(e){const t=this.inputs.attached.touch;t&&(t.touchAngularSensibility=e)}get touchMoveSensibility(){const e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0}set touchMoveSensibility(e){const t=this.inputs.attached.touch;t&&(t.touchMoveSensibility=e)}constructor(e,t,i){super(e,t,i),this.inputs.addTouch(),this._setupInputs()}getClassName(){return"TouchCamera"}_setupInputs(){const e=this.inputs.attached.touch,t=this.inputs.attached.mouse;t?t.touchEnabled=!e:e.allowMouse=!t}}Xa.b.AddNodeConstructor("FreeCamera",((e,t)=>()=>new al(e,gt.Pq.Zero(),t)));class al extends ol{get gamepadAngularSensibility(){const e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0}set gamepadAngularSensibility(e){const t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)}get gamepadMoveSensibility(){const e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0}set gamepadMoveSensibility(e){const t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)}constructor(e,t,i){super(e,t,i),this.inputs.addGamepad()}getClassName(){return"UniversalCamera"}}Ra.i._CreateDefaultParsedCamera=(e,t)=>new al(e,gt.Pq.Zero(),t);class hl{constructor(e){this._scene=e,this._nonVRCamera=null,this._attachedToElement=!1,this._spectatorCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this._spectatorMode=!1,this._lastTimestamp=0,this.onInitialXRPoseSetObservable=new Zi.cP,this.onStateChangedObservable=new Zi.cP,this.state=3,this.sessionManager=new Jh(e),this.camera=new sl("webxr",e,this.sessionManager),this.featuresManager=new nl(this.sessionManager),e.onDisposeObservable.addOnce((()=>{this.dispose()}))}static CreateAsync(e){const t=new hl(e);return t.sessionManager.initializeAsync().then((()=>(t._supported=!0,t))).catch((e=>{throw t._setState(3),t.dispose(),e}))}dispose(){this.exitXRAsync(),this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),this._spectatorCamera?.dispose(),this._nonVRCamera&&(this._scene.activeCamera=this._nonVRCamera)}async enterXRAsync(e,t,i=this.sessionManager.getWebXRRenderTarget(),s={}){if(!this._supported)throw"WebXR not supported in this browser or environment";this._setState(0),"viewer"!==t&&"local"!==t&&(s.optionalFeatures=s.optionalFeatures||[],s.optionalFeatures.push(t)),s=await this.featuresManager._extendXRSessionInitObject(s),"immersive-ar"===e&&"unbounded"!==t&&It.V.Warn("We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode");try{await this.sessionManager.initializeSessionAsync(e,s),await this.sessionManager.setReferenceSpaceTypeAsync(t);const r={depthFar:this.camera.maxZ||1e4,depthNear:this.camera.minZ};if(!this.featuresManager.getEnabledFeature(rl.LAYERS)){const e=await i.initializeXRLayerAsync(this.sessionManager.session);r.baseLayer=e}return this.sessionManager.updateRenderState(r),this.sessionManager.runXRRenderLoop(),this._originalSceneAutoClear=this._scene.autoClear,this._nonVRCamera=this._scene.activeCamera,this._attachedToElement=!!this._nonVRCamera?.inputs?.attachedToElement,this._nonVRCamera?.detachControl(),this._scene.activeCamera=this.camera,"immersive-ar"!==e?this._nonXRToXRCamera():(this._scene.autoClear=!1,this.camera.compensateOnFirstFrame=!1,this.camera.position.set(0,0,0),this.camera.rotationQuaternion.set(0,0,0,1),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)),kh.$.audioEngine?._resumeAudioContextOnStateChange(),this.sessionManager.onXRSessionEnded.addOnce((()=>{1!==this.state&&this._setState(1),this.camera.rigCameras.forEach((e=>{e.outputRenderTarget=null})),this._scene.autoClear=this._originalSceneAutoClear,this._scene.activeCamera=this._nonVRCamera,this._attachedToElement&&this._nonVRCamera&&this._nonVRCamera.attachControl(!!this._nonVRCamera.inputs.noPreventDefault),"immersive-ar"!==e&&this.camera.compensateOnFirstFrame&&(this._nonVRCamera.setPosition?this._nonVRCamera.setPosition(this.camera.position):this._nonVRCamera.position.copyFrom(this.camera.position)),this._setState(3)})),this.sessionManager.onXRFrameObservable.addOnce((()=>{this._setState(2)})),this.sessionManager}catch(e){throw It.V.Log(e),It.V.Log(e.message),this._setState(3),e}}exitXRAsync(){return 2!==this.state?Promise.resolve():(this._setState(1),this.sessionManager.exitXRAsync())}enableSpectatorMode(e){this._spectatorMode||(this._spectatorMode=!0,this._switchSpectatorMode(e))}disableSpecatatorMode(){this._spectatorMode&&(this._spectatorMode=!1,this._switchSpectatorMode())}_switchSpectatorMode(e){const t=1/(e?.fps?e.fps:1e3)*1e3,i=e?.preferredCameraIndex?e?.preferredCameraIndex:0,s=()=>{this._spectatorCamera&&this.sessionManager.currentTimestamp-this._lastTimestamp>=t&&(this._lastTimestamp=this.sessionManager.currentTimestamp,this._spectatorCamera.position.copyFrom(this.camera.rigCameras[i].globalPosition),this._spectatorCamera.rotationQuaternion.copyFrom(this.camera.rigCameras[i].absoluteRotation))};if(this._spectatorMode){if(i>=this.camera.rigCameras.length)throw new Error("the preferred camera index is beyond the length of rig camera array.");const e=()=>{2===this.state?(this._spectatorCamera=new al("webxr-spectator",gt.Pq.Zero(),this._scene),this._spectatorCamera.rotationQuaternion=new gt.PT,this._scene.activeCameras=[this.camera,this._spectatorCamera],this.sessionManager.onXRFrameObservable.add(s),this._scene.onAfterRenderCameraObservable.add((e=>{e===this.camera&&(this._scene.getEngine().framebufferDimensionsObject=null)}))):1===this.state&&(this.sessionManager.onXRFrameObservable.removeCallback(s),this._scene.activeCameras=null)};this.onStateChangedObservable.add(e),e()}else this.sessionManager.onXRFrameObservable.removeCallback(s),this._scene.activeCameras=[this.camera]}_nonXRToXRCamera(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)}_setState(e){this.state!==e&&(this.state=e,this.onStateChangedObservable.notifyObservers(this.state))}}class ll{constructor(e,t,i=-1,s=[]){this.id=e,this.type=t,this._buttonIndex=i,this._axesIndices=s,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new Zi.cP,this.onButtonStateChangedObservable=new Zi.cP}get axes(){return this._axes}get changes(){return this._changes}get hasChanges(){return this._hasChanges}get pressed(){return this._pressed}get touched(){return this._touched}get value(){return this._currentValue}dispose(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()}isAxes(){return 0!==this._axesIndices.length}isButton(){return-1!==this._buttonIndex}update(e){let t=!1,i=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){const i=e.buttons[this._buttonIndex];if(!i)return;this._currentValue!==i.value&&(this.changes.value={current:i.value,previous:this._currentValue},t=!0,this._currentValue=i.value),this._touched!==i.touched&&(this.changes.touched={current:i.touched,previous:this._touched},t=!0,this._touched=i.touched),this._pressed!==i.pressed&&(this.changes.pressed={current:i.pressed,previous:this._pressed},t=!0,this._pressed=i.pressed)}this.isAxes()&&(this._axes.x!==e.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:e.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=e.axes[this._axesIndices[0]],i=!0),this._axes.y!==e.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=e.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:e.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=e.axes[this._axesIndices[1]],i=!0)),t&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),i&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))}}ll.BUTTON_TYPE="button",ll.SQUEEZE_TYPE="squeeze",ll.THUMBSTICK_TYPE="thumbstick",ll.TOUCHPAD_TYPE="touchpad",ll.TRIGGER_TYPE="trigger";class cl{constructor(e,t,i,s,r=!1,n){this.scene=e,this.layout=t,this.gamepadObject=i,this.handedness=s,this._doNotLoadControllerMesh=r,this._controllerCache=n,this._initComponent=e=>{if(!e)return;const t=this.layout.components[e],i=t.type,s=t.gamepadIndices.button,r=[];void 0!==t.gamepadIndices.xAxis&&void 0!==t.gamepadIndices.yAxis&&r.push(t.gamepadIndices.xAxis,t.gamepadIndices.yAxis),this.components[e]=new ll(e,i,s,r)},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new Zi.cP,t.components&&Object.keys(t.components).forEach(this._initComponent)}dispose(){this.getComponentIds().forEach((e=>this.getComponent(e).dispose())),this.rootMesh&&(this.rootMesh.getChildren(void 0,!0).forEach((e=>{e.setEnabled(!1)})),this.rootMesh.dispose(!!this._controllerCache,!this._controllerCache)),this.onModelLoadedObservable.clear()}getAllComponentsOfType(e){return this.getComponentIds().map((e=>this.components[e])).filter((t=>t.type===e))}getComponent(e){return this.components[e]}getComponentIds(){return Object.keys(this.components)}getComponentOfType(e){return this.getAllComponentsOfType(e)[0]||null}getMainComponent(){return this.getComponent(this.layout.selectComponentId)}async loadModel(){const e=!this._getModelLoadingConstraints();let t=this._getGenericFilenameAndPath();return e?It.V.Warn("Falling back to generic models"):t=this._getFilenameAndPath(),new Promise(((i,s)=>{const r=t=>{e?this._getGenericParentMesh(t):this._setRootMesh(t),this._processLoadedModel(t),this._modelReady=!0,this.onModelLoadedObservable.notifyObservers(this),i(!0)};if(this._controllerCache){const e=this._controllerCache.filter((e=>e.filename===t.filename&&e.path===t.path));if(e[0])return e[0].meshes.forEach((e=>e.setEnabled(!0))),void r(e[0].meshes)}Ue.cn.ImportMesh("",t.path,t.filename,this.scene,(e=>{this._controllerCache&&this._controllerCache.push({...t,meshes:e}),r(e)}),null,((e,i)=>{It.V.Log(i),It.V.Warn(`Failed to retrieve controller model of type ${this.profileId} from the remote server: ${t.path}${t.filename}`),s(i)}))}))}updateFromXRFrame(e){this.getComponentIds().forEach((e=>this.getComponent(e).update(this.gamepadObject))),this.updateModel(e)}get handness(){return this.handedness}pulse(e,t,i=0){return this.gamepadObject.hapticActuators&&this.gamepadObject.hapticActuators[i]?this.gamepadObject.hapticActuators[i].pulse(e,t):Promise.resolve(!1)}_getChildByName(e,t){return e.getChildren((e=>e.name===t),!1)[0]}_getImmediateChildByName(e,t){return e.getChildren((e=>e.name==t),!0)[0]}_lerpTransform(e,t,i){if(!e.minMesh||!e.maxMesh||!e.valueMesh)return;if(!e.minMesh.rotationQuaternion||!e.maxMesh.rotationQuaternion||!e.valueMesh.rotationQuaternion)return;const s=i?.5*t+.5:t;gt.PT.SlerpToRef(e.minMesh.rotationQuaternion,e.maxMesh.rotationQuaternion,s,e.valueMesh.rotationQuaternion),gt.Pq.LerpToRef(e.minMesh.position,e.maxMesh.position,s,e.valueMesh.position)}updateModel(e){this._modelReady&&this._updateModel(e)}_getGenericFilenameAndPath(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}}_getGenericParentMesh(e){this.rootMesh=new zn.e(this.profileId+" "+this.handedness,this.scene),e.forEach((e=>{e.parent||(e.isPickable=!1,e.setParent(this.rootMesh))})),this.rootMesh.rotationQuaternion=gt.PT.FromEulerAngles(0,Math.PI,0)}}class ul extends cl{constructor(e,t,i){super(e,dl[i],t,i),this.profileId=ul.ProfileId}_getFilenameAndPath(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}}_getModelLoadingConstraints(){return!0}_processLoadedModel(e){}_setRootMesh(e){this.rootMesh=new zn.e(this.profileId+" "+this.handedness,this.scene),e.forEach((e=>{e.isPickable=!1,e.parent||e.setParent(this.rootMesh)})),this.rootMesh.rotationQuaternion=gt.PT.FromEulerAngles(0,Math.PI,0)}_updateModel(){}}ul.ProfileId="generic-trigger";const dl={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}};class _l extends cl{constructor(e,t,i,s,r){super(e,i.layouts[t.handedness||"none"],t.gamepad,t.handedness,void 0,r),this._repositoryUrl=s,this.controllerCache=r,this._buttonMeshMapping={},this._touchDots={},this.profileId=i.profileId}dispose(){super.dispose(),this.controllerCache||Object.keys(this._touchDots).forEach((e=>{this._touchDots[e].dispose()}))}_getFilenameAndPath(){return{filename:this.layout.assetPath,path:`${this._repositoryUrl}/profiles/${this.profileId}/`}}_getModelLoadingConstraints(){const e=Ue.cn.IsPluginForExtensionAvailable(".glb");return e||It.V.Warn("glTF / glb loader was not registered, using generic controller instead"),e}_processLoadedModel(e){this.getComponentIds().forEach((e=>{const t=this.layout.components[e];this._buttonMeshMapping[e]={mainMesh:this._getChildByName(this.rootMesh,t.rootNodeName),states:{}},Object.keys(t.visualResponses).forEach((i=>{const s=t.visualResponses[i];if("transform"===s.valueNodeProperty)this._buttonMeshMapping[e].states[i]={valueMesh:this._getChildByName(this.rootMesh,s.valueNodeName),minMesh:this._getChildByName(this.rootMesh,s.minNodeName),maxMesh:this._getChildByName(this.rootMesh,s.maxNodeName)};else{const r=t.type===ll.TOUCHPAD_TYPE&&t.touchPointNodeName?t.touchPointNodeName:s.valueNodeName;if(this._buttonMeshMapping[e].states[i]={valueMesh:this._getChildByName(this.rootMesh,r)},t.type===ll.TOUCHPAD_TYPE&&!this._touchDots[i]){const t=ao(i+"dot",{diameter:.0015,segments:8},this.scene);t.material=new ft.F(i+"mat",this.scene),t.material.diffuseColor=bt.v9.Red(),t.parent=this._buttonMeshMapping[e].states[i].valueMesh||null,t.isVisible=!1,this._touchDots[i]=t}}}))}))}_setRootMesh(e){let t;this.rootMesh=new zn.e(this.profileId+"-"+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(let i=0;i<e.length;i++){const s=e[i];s.isPickable=!1,s.parent||(t=s)}t&&t.setParent(this.rootMesh),this.scene.useRightHandedSystem||this.rootMesh.rotate(ho._0.Y,Math.PI,1)}_updateModel(e){this.disableAnimation||this.getComponentIds().forEach((e=>{const t=this.getComponent(e);if(!t.hasChanges)return;const i=this._buttonMeshMapping[e],s=this.layout.components[e];Object.keys(s.visualResponses).forEach((e=>{const r=s.visualResponses[e];let n=t.value;if("xAxis"===r.componentProperty?n=t.axes.x:"yAxis"===r.componentProperty&&(n=t.axes.y),"transform"===r.valueNodeProperty)this._lerpTransform(i.states[e],n,"button"!==r.componentProperty);else{const s=i.states[e].valueMesh;s&&(s.isVisible=t.touched||t.pressed),this._touchDots[e]&&(this._touchDots[e].isVisible=t.touched||t.pressed)}}))}))}}const pl=[];class gl{static ClearProfilesCache(){this._ProfilesList=null,this._ProfileLoadingPromises={}}static DefaultFallbacks(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("generic-hand-select",["generic-trigger"])}static FindFallbackWithProfileId(e){const t=this._Fallbacks[e]||[];return t.unshift(e),t}static GetMotionControllerWithXRInput(e,t,i){const s=[];i&&s.push(i),s.push(...e.profiles||[]),s.length&&!s[0]&&s.pop(),e.gamepad&&e.gamepad.id&&e.gamepad.id===(e.gamepad.id.match(/oculus touch/gi)?e.gamepad.id:void 0)&&s.push("oculus-touch-v2");const r=s.indexOf("windows-mixed-reality");if(-1!==r&&s.splice(r,0,"microsoft-mixed-reality"),s.length||s.push("generic-trigger"),this.UseOnlineRepository){const i=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,r=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return i.call(this,s,e,t).catch((()=>r.call(this,s,e,t)))}return this._LoadProfilesFromAvailableControllers(s,e,t)}static RegisterController(e,t){this._AvailableControllers[e]=t}static RegisterFallbacksForProfileId(e,t){this._Fallbacks[e]?this._Fallbacks[e].push(...t):this._Fallbacks[e]=t}static UpdateProfilesList(){return this._ProfilesList=$i.S0.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then((e=>JSON.parse(e))),this._ProfilesList}static ClearControllerCache(){pl.forEach((e=>{e.meshes.forEach((e=>{e.dispose(!1,!0)}))})),pl.length=0}static _LoadProfileFromRepository(e,t,i){return Promise.resolve().then((()=>this._ProfilesList?this._ProfilesList:this.UpdateProfilesList())).then((t=>{for(let i=0;i<e.length;++i)if(e[i]&&t[e[i]])return e[i];throw new Error(`neither controller ${e[0]} nor all fallbacks were found in the repository,`)})).then((e=>(this._ProfileLoadingPromises[e]||(this._ProfileLoadingPromises[e]=$i.S0.LoadFileAsync(`${this.BaseRepositoryUrl}/profiles/${e}/profile.json`,!1).then((e=>JSON.parse(e)))),this._ProfileLoadingPromises[e]))).then((e=>new _l(i,t,e,this.BaseRepositoryUrl,this.DisableControllerCache?void 0:pl)))}static _LoadProfilesFromAvailableControllers(e,t,i){for(let s=0;s<e.length;++s){if(!e[s])continue;const r=this.FindFallbackWithProfileId(e[s]);for(let e=0;e<r.length;++e){const s=this._AvailableControllers[r[e]];if(s)return Promise.resolve(s(t,i))}}throw new Error("no controller requested was found in the available controllers list")}}gl._AvailableControllers={},gl._Fallbacks={},gl._ProfileLoadingPromises={},gl.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",gl.PrioritizeOnlineRepository=!0,gl.UseOnlineRepository=!0,gl.DisableControllerCache=!0,gl.RegisterController(ul.ProfileId,((e,t)=>new ul(t,e.gamepad,e.handedness))),gl.DefaultFallbacks();let fl=0;class ml{constructor(e,t,i={}){this._scene=e,this.inputSource=t,this._options=i,this._tmpVector=new gt.Pq,this._disposed=!1,this.onDisposeObservable=new Zi.cP,this.onMeshLoadedObservable=new Zi.cP,this.onMotionControllerInitObservable=new Zi.cP,this._uniqueId=`controller-${fl++}-${t.targetRayMode}-${t.handedness}`,this.pointer=new zn.e(`${this._uniqueId}-pointer`,e),this.pointer.rotationQuaternion=new gt.PT,this.inputSource.gripSpace&&(this.grip=new zn.e(`${this._uniqueId}-grip`,this._scene),this.grip.rotationQuaternion=new gt.PT),this._tmpVector.set(0,0,this._scene.useRightHandedSystem?-1:1),this.inputSource.gamepad&&"tracked-pointer"===this.inputSource.targetRayMode&&gl.GetMotionControllerWithXRInput(t,e,this._options.forceControllerProfile).then((e=>{this.motionController=e,this.onMotionControllerInitObservable.notifyObservers(e),this._options.doNotLoadControllerMesh||this.motionController._doNotLoadControllerMesh||this.motionController.loadModel().then((e=>{e&&this.motionController&&this.motionController.rootMesh&&(this._options.renderingGroupId&&(this.motionController.rootMesh.renderingGroupId=this._options.renderingGroupId,this.motionController.rootMesh.getChildMeshes(!1).forEach((e=>e.renderingGroupId=this._options.renderingGroupId))),this.onMeshLoadedObservable.notifyObservers(this.motionController.rootMesh),this.motionController.rootMesh.parent=this.grip||this.pointer,this.motionController.disableAnimation=!!this._options.disableMotionControllerAnimation),this._disposed&&this.motionController?.dispose()}))}),(()=>{$i.S0.Warn("Could not find a matching motion controller for the registered input source")}))}get uniqueId(){return this._uniqueId}dispose(){this.grip&&this.grip.dispose(!0),this.motionController&&this.motionController.dispose(),this.pointer.dispose(!0),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._disposed=!0}getWorldPointerRayToRef(e,t=!1){const i=t&&this.grip?this.grip:this.pointer;gt.Pq.TransformNormalToRef(this._tmpVector,i.getWorldMatrix(),e.direction),e.direction.normalize(),e.origin.copyFrom(i.absolutePosition),e.length=1e3}updateFromXRFrame(e,t,i,s){const r=e.getPose(this.inputSource.targetRaySpace,t);if(this._lastXRPose=r,r){const e=r.transform.position;this.pointer.position.set(e.x,e.y,e.z).scaleInPlace(s.worldScalingFactor);const t=r.transform.orientation;this.pointer.rotationQuaternion.set(t.x,t.y,t.z,t.w),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1),this.pointer.parent=i.parent,this.pointer.scaling.setAll(s.worldScalingFactor)}if(this.inputSource.gripSpace&&this.grip){const r=e.getPose(this.inputSource.gripSpace,t);if(r){const e=r.transform.position,t=r.transform.orientation;this.grip.position.set(e.x,e.y,e.z).scaleInPlace(s.worldScalingFactor),this.grip.rotationQuaternion.set(t.x,t.y,t.z,t.w),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1)}this.grip.parent=i.parent,this.grip.scaling.setAll(s.worldScalingFactor)}this.motionController&&this.motionController.updateFromXRFrame(e)}}class bl{constructor(e,t,i={}){if(this.xrSessionManager=e,this.xrCamera=t,this._options=i,this.controllers=[],this.onControllerAddedObservable=new Zi.cP,this.onControllerRemovedObservable=new Zi.cP,this._onInputSourcesChange=e=>{this._addAndRemoveControllers(e.added,e.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add((()=>{this._addAndRemoveControllers([],this.controllers.map((e=>e.inputSource)))})),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add((e=>{e.addEventListener("inputsourceschange",this._onInputSourcesChange)})),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add((e=>{this.controllers.forEach((t=>{t.updateFromXRFrame(e,this.xrSessionManager.referenceSpace,this.xrCamera,this.xrSessionManager)}))})),this._options.customControllersRepositoryURL&&(gl.BaseRepositoryUrl=this._options.customControllersRepositoryURL),gl.UseOnlineRepository=!this._options.disableOnlineControllerRepository,gl.UseOnlineRepository)try{gl.UpdateProfilesList().catch((()=>{gl.UseOnlineRepository=!1}))}catch(e){gl.UseOnlineRepository=!1}}_addAndRemoveControllers(e,t){const i=this.controllers.map((e=>e.inputSource));for(const t of e)if(-1===i.indexOf(t)){const e=new ml(this.xrSessionManager.scene,t,{...this._options.controllerOptions||{},forceControllerProfile:this._options.forceInputProfile,doNotLoadControllerMesh:this._options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this._options.disableControllerAnimation});this.controllers.push(e),this.onControllerAddedObservable.notifyObservers(e)}const s=[],r=[];this.controllers.forEach((e=>{-1===t.indexOf(e.inputSource)?s.push(e):r.push(e)})),this.controllers=s,r.forEach((e=>{this.onControllerRemovedObservable.notifyObservers(e),e.dispose()}))}dispose(){this.controllers.forEach((e=>{e.dispose()})),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear(),gl.ClearControllerCache()}}var vl=o(109);class Tl{get xrNativeFeatureName(){return this._xrNativeFeatureName}set xrNativeFeatureName(e){!this._xrSessionManager.isNative&&e&&this._xrSessionManager.inXRSession&&-1===this._xrSessionManager.enabledFeatures?.indexOf(e)&&It.V.Warn(`The feature ${e} needs to be enabled before starting the XR session. Note - It is still possible it is not supported.`),this._xrNativeFeatureName=e}constructor(e){this._xrSessionManager=e,this._attached=!1,this._removeOnDetach=[],this.isDisposed=!1,this.disableAutoAttach=!1,this._xrNativeFeatureName="",this.onFeatureAttachObservable=new Zi.cP,this.onFeatureDetachObservable=new Zi.cP}get attached(){return this._attached}attach(e){if(this.isDisposed)return!1;if(e)this.attached&&this.detach();else if(this.attached)return!1;if(this._xrSessionManager.enabledFeatures){if(!this._xrSessionManager.isNative&&this.xrNativeFeatureName&&-1===this._xrSessionManager.enabledFeatures.indexOf(this.xrNativeFeatureName))return!1}else It.V.Warn("session.enabledFeatures is not available on this device. It is possible that this feature is not supported.");return this._attached=!0,this._addNewAttachObserver(this._xrSessionManager.onXRFrameObservable,(e=>this._onXRFrame(e))),this.onFeatureAttachObservable.notifyObservers(this),!0}detach(){return this._attached?(this._attached=!1,this._removeOnDetach.forEach((e=>{e.observable.remove(e.observer)})),this.onFeatureDetachObservable.notifyObservers(this),!0):(this.disableAutoAttach=!0,!1)}dispose(){this.detach(),this.isDisposed=!0,this.onFeatureAttachObservable.clear(),this.onFeatureDetachObservable.clear()}isCompatible(){return!0}_addNewAttachObserver(e,t,i){this._removeOnDetach.push({observable:e,observer:e.add(t,void 0,i)})}}class yl{getRenderCamera(e){if(this._renderCamera)return this._renderCamera;{let t;return t=this.originalScene.activeCameras&&this.originalScene.activeCameras.length>1?this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.originalScene.activeCamera,e&&t&&t.isRigCamera?t.rigParent:t}}setRenderCamera(e){this._renderCamera=e}_getSharedGizmoLight(){return this._sharedGizmoLight||(this._sharedGizmoLight=new qa("shared gizmo light",new gt.Pq(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=bt.v9.Gray()),this._sharedGizmoLight}static get DefaultUtilityLayer(){return null==yl._DefaultUtilityLayer?yl._CreateDefaultUtilityLayerFromScene(os.q.LastCreatedScene):yl._DefaultUtilityLayer}static _CreateDefaultUtilityLayerFromScene(e){return yl._DefaultUtilityLayer=new yl(e),yl._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce((()=>{yl._DefaultUtilityLayer=null})),yl._DefaultUtilityLayer}static get DefaultKeepDepthUtilityLayer(){return null==yl._DefaultKeepDepthUtilityLayer&&(yl._DefaultKeepDepthUtilityLayer=new yl(os.q.LastCreatedScene),yl._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,yl._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce((()=>{yl._DefaultKeepDepthUtilityLayer=null}))),yl._DefaultKeepDepthUtilityLayer}constructor(e,t=!0,i=!1){this.originalScene=e,this.handleEvents=t,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this._renderCamera=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.pickingEnabled=!0,this.onPointerOutObservable=new Zi.cP,this.utilityLayerScene=new Ie.Z(e.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=e.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.postProcessesEnabled=!1,this.utilityLayerScene.detachControl(),t&&(this._originalPointerObserver=e.onPrePointerObservable.add((t=>{if(!this.utilityLayerScene.activeCamera)return;if(!this.pickingEnabled)return;if(!this.processAllEvents&&t.type!==tt.Zp.POINTERMOVE&&t.type!==tt.Zp.POINTERUP&&t.type!==tt.Zp.POINTERDOWN&&t.type!==tt.Zp.POINTERDOUBLETAP)return;this.utilityLayerScene.pointerX=e.pointerX,this.utilityLayerScene.pointerY=e.pointerY;const i=t.event;if(e.isPointerCaptured(i.pointerId))return void(this._pointerCaptures[i.pointerId]=!1);const s=i=>{let s=null;if(t.nearInteractionPickingInfo)s=t.nearInteractionPickingInfo.pickedMesh.getScene()==i?t.nearInteractionPickingInfo:new vl.G;else if(i!==this.utilityLayerScene&&t.originalPickingInfo)s=t.originalPickingInfo;else{let r=null;this._renderCamera&&(r=i._activeCamera,i._activeCamera=this._renderCamera,t.ray=null),s=t.ray?i.pickWithRay(t.ray):i.pick(e.pointerX,e.pointerY),r&&(i._activeCamera=r)}return s},r=s(this.utilityLayerScene);if(!t.ray&&r&&(t.ray=r.ray),t.originalPickingInfo?.aimTransform&&r&&(r.aimTransform=t.originalPickingInfo.aimTransform,r.gripTransform=t.originalPickingInfo.gripTransform),this.utilityLayerScene.onPrePointerObservable.notifyObservers(t),this.onlyCheckPointerDownEvents&&t.type!=tt.Zp.POINTERDOWN)return t.skipOnPointerObservable||this.utilityLayerScene.onPointerObservable.notifyObservers(new tt.mx(t.type,t.event,r),t.type),void(t.type===tt.Zp.POINTERUP&&this._pointerCaptures[i.pointerId]&&(this._pointerCaptures[i.pointerId]=!1));if(this.utilityLayerScene.autoClearDepthAndStencil||this.pickUtilitySceneFirst)r&&r.hit&&(t.skipOnPointerObservable||this.utilityLayerScene.onPointerObservable.notifyObservers(new tt.mx(t.type,t.event,r),t.type),t.skipOnPointerObservable=!0);else{const i=s(e),n=t.event;i&&r&&(0===r.distance&&i.pickedMesh?this.mainSceneTrackerPredicate&&this.mainSceneTrackerPredicate(i.pickedMesh)?(this._notifyObservers(t,i,n),t.skipOnPointerObservable=!0):t.type===tt.Zp.POINTERDOWN?(this._pointerCaptures[n.pointerId]=!0,this._notifyObservers(t,i,n)):t.type!==tt.Zp.POINTERMOVE&&t.type!==tt.Zp.POINTERUP||(this._lastPointerEvents[n.pointerId]&&(this.onPointerOutObservable.notifyObservers(n.pointerId),delete this._lastPointerEvents[n.pointerId]),this._notifyObservers(t,i,n)):!this._pointerCaptures[n.pointerId]&&(r.distance<i.distance||0===i.distance)?(this._notifyObservers(t,r,n),t.skipOnPointerObservable||(t.skipOnPointerObservable=r.distance>0)):!this._pointerCaptures[n.pointerId]&&r.distance>=i.distance&&(this.mainSceneTrackerPredicate&&this.mainSceneTrackerPredicate(i.pickedMesh)?(this._notifyObservers(t,i,n),t.skipOnPointerObservable=!0):(t.type!==tt.Zp.POINTERMOVE&&t.type!==tt.Zp.POINTERUP||this._lastPointerEvents[n.pointerId]&&(this.onPointerOutObservable.notifyObservers(n.pointerId),delete this._lastPointerEvents[n.pointerId]),this._notifyObservers(t,r,n))),t.type===tt.Zp.POINTERUP&&this._pointerCaptures[n.pointerId]&&(this._pointerCaptures[n.pointerId]=!1))}})),this._originalPointerObserver&&e.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,i||(this._afterRenderObserver=this.originalScene.onAfterRenderCameraObservable.add((e=>{this.shouldRender&&e==this.getRenderCamera()&&this.render()}))),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add((()=>{this.dispose()})),this._updateCamera()}_notifyObservers(e,t,i){e.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new tt.mx(e.type,e.event,t),e.type),this._lastPointerEvents[i.pointerId]=!0)}render(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){const e=this.utilityLayerScene.activeCamera.getScene(),t=this.utilityLayerScene.activeCamera;t._scene=this.utilityLayerScene,t.leftCamera&&(t.leftCamera._scene=this.utilityLayerScene),t.rightCamera&&(t.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),t._scene=e,t.leftCamera&&(t.leftCamera._scene=e),t.rightCamera&&(t.rightCamera._scene=e)}}dispose(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()}_updateCamera(){this.utilityLayerScene.cameraToUseForPointers=this.getRenderCamera(),this.utilityLayerScene.activeCamera=this.getRenderCamera()}}yl._DefaultUtilityLayer=null,yl._DefaultKeepDepthUtilityLayer=null;class xl extends Tl{constructor(e,t){super(e),this._options=t,this._attachController=e=>{if(this._controllers[e.uniqueId])return;const{laserPointer:t,selectionMesh:i}=this._generateNewMeshPair(this._options.forceGripIfAvailable&&e.grip?e.grip:e.pointer);switch(this._controllers[e.uniqueId]={xrController:e,laserPointer:t,selectionMesh:i,meshUnderPointer:null,pick:null,tmpRay:new fa.Rl(new gt.Pq,new gt.Pq),disabledByNearInteraction:!1,id:xl._IdCounter++},this._attachedController?!this._options.enablePointerSelectionOnAllControllers&&this._options.preferredHandedness&&e.inputSource.handedness===this._options.preferredHandedness&&(this._attachedController=e.uniqueId):this._options.enablePointerSelectionOnAllControllers||(this._attachedController=e.uniqueId),e.inputSource.targetRayMode){case"tracked-pointer":return this._attachTrackedPointerRayMode(e);case"gaze":return this._attachGazeMode(e);case"screen":case"transient-pointer":return this._attachScreenRayMode(e)}},this._controllers={},this._tmpVectorForPickCompare=new gt.Pq,this.disablePointerLighting=!0,this.disableSelectionMeshLighting=!0,this.displayLaserPointer=!0,this.displaySelectionMesh=!0,this.laserPointerPickedColor=new bt.v9(.9,.9,.9),this.laserPointerDefaultColor=new bt.v9(.7,.7,.7),this.selectionMeshDefaultColor=new bt.v9(.8,.8,.8),this.selectionMeshPickedColor=new bt.v9(.3,.3,1),this._identityMatrix=gt.uq.Identity(),this._screenCoordinatesRef=gt.Pq.Zero(),this._viewportRef=new Es.L(0,0,0,0),this._scene=this._xrSessionManager.scene,void 0===this._options.lookAndPickMode&&(this._scene.getEngine()._badDesktopOS||this._scene.getEngine()._badOS)&&(this._options.lookAndPickMode=!0),this._options.lookAndPickMode&&(this._options.enablePointerSelectionOnAllControllers=!0,this.displayLaserPointer=!1)}attach(){if(!super.attach())return!1;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController,!0),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(e=>{this._detachController(e.uniqueId)}),!0),this._scene.constantlyUpdateMeshUnderPointer=!0,this._options.gazeCamera){const e=this._options.gazeCamera,{laserPointer:t,selectionMesh:i}=this._generateNewMeshPair(e);this._controllers.camera={webXRCamera:e,laserPointer:t,selectionMesh:i,meshUnderPointer:null,pick:null,tmpRay:new fa.Rl(new gt.Pq,new gt.Pq),disabledByNearInteraction:!1,id:xl._IdCounter++},this._attachGazeMode()}return!0}detach(){return!!super.detach()&&(Object.keys(this._controllers).forEach((e=>{this._detachController(e)})),!0)}getMeshUnderPointer(e){return this._controllers[e]?this._controllers[e].meshUnderPointer:null}getXRControllerByPointerId(e){const t=Object.keys(this._controllers);for(let i=0;i<t.length;++i)if(this._controllers[t[i]].id===e)return this._controllers[t[i]].xrController||null;return null}_getPointerSelectionDisabledByPointerId(e){const t=Object.keys(this._controllers);for(let i=0;i<t.length;++i)if(this._controllers[t[i]].id===e)return this._controllers[t[i]].disabledByNearInteraction;return!0}_setPointerSelectionDisabledByPointerId(e,t){const i=Object.keys(this._controllers);for(let s=0;s<i.length;++s)if(this._controllers[i[s]].id===e)return void(this._controllers[i[s]].disabledByNearInteraction=t)}_onXRFrame(e){Object.keys(this._controllers).forEach((e=>{const t=this._controllers[e];if(this._options.lookAndPickMode&&"transient-pointer"!==t.xrController?.inputSource.targetRayMode)return;if(!this._options.enablePointerSelectionOnAllControllers&&e!==this._attachedController||t.disabledByNearInteraction)return t.selectionMesh.isVisible=!1,t.laserPointer.isVisible=!1,void(t.pick=null);let i;if(t.laserPointer.isVisible=this.displayLaserPointer,t.xrController)i=this._options.forceGripIfAvailable&&t.xrController.grip?t.xrController.grip.position:t.xrController.pointer.position,t.xrController.getWorldPointerRayToRef(t.tmpRay,this._options.forceGripIfAvailable);else{if(!t.webXRCamera)return;i=t.webXRCamera.position,t.webXRCamera.getForwardRayToRef(t.tmpRay)}if(this._options.maxPointerDistance&&(t.tmpRay.length=this._options.maxPointerDistance),!this._options.disableScenePointerVectorUpdate&&i){const e=this._xrSessionManager.scene,s=this._options.xrInput.xrCamera;s&&(s.viewport.toGlobalToRef(e.getEngine().getRenderWidth()/s.rigCameras.length,e.getEngine().getRenderHeight(),this._viewportRef),gt.Pq.ProjectToRef(i,this._identityMatrix,s.getTransformationMatrix(),this._viewportRef,this._screenCoordinatesRef),"number"!=typeof this._screenCoordinatesRef.x||"number"!=typeof this._screenCoordinatesRef.y||isNaN(this._screenCoordinatesRef.x)||isNaN(this._screenCoordinatesRef.y)||this._screenCoordinatesRef.x===1/0||this._screenCoordinatesRef.y===1/0||(e.pointerX=this._screenCoordinatesRef.x,e.pointerY=this._screenCoordinatesRef.y,t.screenCoordinates={x:this._screenCoordinatesRef.x,y:this._screenCoordinatesRef.y}))}let s=null;this._utilityLayerScene&&(s=this._utilityLayerScene.pickWithRay(t.tmpRay,this._utilityLayerScene.pointerMovePredicate||this.raySelectionPredicate));const r=this._scene.pickWithRay(t.tmpRay,this._scene.pointerMovePredicate||this.raySelectionPredicate);s&&s.hit?r&&r.hit?s.distance<r.distance?t.pick=s:t.pick=r:t.pick=s:t.pick=r,t.pick&&t.xrController&&(t.pick.aimTransform=t.xrController.pointer,t.pick.gripTransform=t.xrController.grip||null,t.pick.originMesh=t.xrController.pointer,t.tmpRay.length=t.pick.distance);const n=t.pick;if(n&&n.pickedPoint&&n.hit){this._updatePointerDistance(t.laserPointer,n.distance),t.selectionMesh.position.copyFrom(n.pickedPoint),t.selectionMesh.scaling.x=Math.sqrt(n.distance),t.selectionMesh.scaling.y=Math.sqrt(n.distance),t.selectionMesh.scaling.z=Math.sqrt(n.distance);const e=this._convertNormalToDirectionOfRay(n.getNormal(!0),t.tmpRay),i=.001;if(t.selectionMesh.position.copyFrom(n.pickedPoint),e){const s=gt.Pq.Cross(ho._0.Y,e),r=gt.Pq.Cross(e,s);gt.Pq.RotationFromAxisToRef(r,e,s,t.selectionMesh.rotation),t.selectionMesh.position.addInPlace(e.scale(i))}t.selectionMesh.isVisible=this.displaySelectionMesh,t.meshUnderPointer=n.pickedMesh}else t.selectionMesh.isVisible=!1,this._updatePointerDistance(t.laserPointer,1),t.meshUnderPointer=null}))}get _utilityLayerScene(){return this._options.customUtilityLayerScene||yl.DefaultUtilityLayer.utilityLayerScene}_attachGazeMode(e){const t=this._controllers[e&&e.uniqueId||"camera"],i=this._options.timeToSelect||3e3,s=this._options.useUtilityLayer?this._utilityLayerScene:this._scene;let r=new vl.G;const n=_o("selection",{diameter:.0525,thickness:.015,tessellation:20},s);n.isVisible=!1,n.isPickable=!1,n.parent=t.selectionMesh;let o=0,a=!1;const h={pointerId:t.id,pointerType:"xr"};t.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((()=>{if(t.pick){if(this._augmentPointerInit(h,t.id,t.screenCoordinates),t.laserPointer.material.alpha=0,n.isVisible=!1,t.pick.hit)if(this._pickingMoved(r,t.pick))a&&(this._options.disablePointerUpOnTouchOut||this._scene.simulatePointerUp(t.pick,h)),a=!1,o=0;else if(o>i/10&&(n.isVisible=!0),o+=this._scene.getEngine().getDeltaTime(),o>=i)this._scene.simulatePointerDown(t.pick,h),a=!0,this._options.disablePointerUpOnTouchOut&&this._scene.simulatePointerUp(t.pick,h),n.isVisible=!1;else{const e=1-o/i;n.scaling.set(e,e,e)}else a=!1,o=0;this._scene.simulatePointerMove(t.pick,h),r=t.pick}})),void 0!==this._options.renderingGroupId&&(n.renderingGroupId=this._options.renderingGroupId),e&&e.onDisposeObservable.addOnce((()=>{t.pick&&!this._options.disablePointerUpOnTouchOut&&a&&(this._scene.simulatePointerUp(t.pick,h),t.finalPointerUpTriggered=!0),n.dispose()}))}_attachScreenRayMode(e){const t=this._controllers[e.uniqueId];let i=!1;const s={pointerId:t.id,pointerType:"xr"};t.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((()=>{this._augmentPointerInit(s,t.id,t.screenCoordinates),!t.pick||this._options.disablePointerUpOnTouchOut&&i||(i?this._scene.simulatePointerMove(t.pick,s):(this._scene.simulatePointerDown(t.pick,s),t.pointerDownTriggered=!0,i=!0,this._options.disablePointerUpOnTouchOut&&this._scene.simulatePointerUp(t.pick,s)))})),e.onDisposeObservable.addOnce((()=>{this._augmentPointerInit(s,t.id,t.screenCoordinates),this._xrSessionManager.runInXRFrame((()=>{t.pick&&!t.finalPointerUpTriggered&&i&&!this._options.disablePointerUpOnTouchOut&&(this._scene.simulatePointerUp(t.pick,s),t.finalPointerUpTriggered=!0)}))}))}_attachTrackedPointerRayMode(e){const t=this._controllers[e.uniqueId];if(this._options.forceGazeMode)return this._attachGazeMode(e);const i={pointerId:t.id,pointerType:"xr"};if(t.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((()=>{t.laserPointer.material.disableLighting=this.disablePointerLighting,t.selectionMesh.material.disableLighting=this.disableSelectionMeshLighting,t.pick&&(this._augmentPointerInit(i,t.id,t.screenCoordinates),this._scene.simulatePointerMove(t.pick,i))})),e.inputSource.gamepad){const s=s=>{this._options.overrideButtonId&&(t.selectionComponent=s.getComponent(this._options.overrideButtonId)),t.selectionComponent||(t.selectionComponent=s.getMainComponent()),t.onButtonChangedObserver=t.selectionComponent.onButtonStateChangedObservable.add((s=>{if(s.changes.pressed){const r=s.changes.pressed.current;if(t.pick)(this._options.enablePointerSelectionOnAllControllers||e.uniqueId===this._attachedController)&&(this._augmentPointerInit(i,t.id,t.screenCoordinates),r?(this._scene.simulatePointerDown(t.pick,i),t.pointerDownTriggered=!0,t.selectionMesh.material.emissiveColor=this.selectionMeshPickedColor,t.laserPointer.material.emissiveColor=this.laserPointerPickedColor):(this._scene.simulatePointerUp(t.pick,i),t.selectionMesh.material.emissiveColor=this.selectionMeshDefaultColor,t.laserPointer.material.emissiveColor=this.laserPointerDefaultColor));else if(r&&!this._options.enablePointerSelectionOnAllControllers&&!this._options.disableSwitchOnClick){const t=this._controllers[this._attachedController];t&&t.pointerDownTriggered&&!t.finalPointerUpTriggered&&(this._augmentPointerInit(i,t.id,t.screenCoordinates),this._scene.simulatePointerUp(new vl.G,{pointerId:t.id,pointerType:"xr"}),t.finalPointerUpTriggered=!0),this._attachedController=e.uniqueId}}}))};e.motionController?s(e.motionController):e.onMotionControllerInitObservable.add(s)}else{const e=e=>{this._xrSessionManager.onXRFrameObservable.addOnce((()=>{this._augmentPointerInit(i,t.id,t.screenCoordinates),t.xrController&&e.inputSource===t.xrController.inputSource&&t.pick&&(this._scene.simulatePointerDown(t.pick,i),t.pointerDownTriggered=!0,t.selectionMesh.material.emissiveColor=this.selectionMeshPickedColor,t.laserPointer.material.emissiveColor=this.laserPointerPickedColor)}))},s=e=>{this._xrSessionManager.onXRFrameObservable.addOnce((()=>{this._augmentPointerInit(i,t.id,t.screenCoordinates),t.xrController&&e.inputSource===t.xrController.inputSource&&t.pick&&(this._scene.simulatePointerUp(t.pick,i),t.selectionMesh.material.emissiveColor=this.selectionMeshDefaultColor,t.laserPointer.material.emissiveColor=this.laserPointerDefaultColor)}))};t.eventListeners={selectend:s,selectstart:e},this._xrSessionManager.session.addEventListener("selectstart",e),this._xrSessionManager.session.addEventListener("selectend",s)}}_convertNormalToDirectionOfRay(e,t){return e&&Math.acos(gt.Pq.Dot(e,t.direction))<Math.PI/2&&e.scaleInPlace(-1),e}_detachController(e){const t=this._controllers[e];if(t){if(t.selectionComponent&&t.onButtonChangedObserver&&t.selectionComponent.onButtonStateChangedObservable.remove(t.onButtonChangedObserver),t.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(t.onFrameObserver),t.eventListeners&&Object.keys(t.eventListeners).forEach((e=>{const i=t.eventListeners&&t.eventListeners[e];i&&this._xrSessionManager.session.removeEventListener(e,i)})),!t.finalPointerUpTriggered&&t.pointerDownTriggered){const e={pointerId:t.id,pointerType:"xr"};this._xrSessionManager.runInXRFrame((()=>{this._augmentPointerInit(e,t.id,t.screenCoordinates),this._scene.simulatePointerUp(t.pick||new vl.G,e),t.finalPointerUpTriggered=!0}))}this._xrSessionManager.scene.onBeforeRenderObservable.addOnce((()=>{try{if(t.selectionMesh.dispose(),t.laserPointer.dispose(),delete this._controllers[e],this._attachedController===e){const e=Object.keys(this._controllers);e.length?this._attachedController=e[0]:this._attachedController=""}}catch(e){$i.S0.Warn("controller already detached.")}}))}}_generateNewMeshPair(e){const t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||yl.DefaultUtilityLayer.utilityLayerScene:this._scene,i=this._options.customLasterPointerMeshGenerator?this._options.customLasterPointerMeshGenerator():co("laserPointer",{height:1,diameterTop:2e-4,diameterBottom:.004,tessellation:20,subdivisions:1},t);i.parent=e;const s=new ft.F("laserPointerMat",t);s.emissiveColor=this.laserPointerDefaultColor,s.alpha=.7,i.material=s,i.rotation.x=Math.PI/2,this._updatePointerDistance(i,1),i.isPickable=!1,i.isVisible=!1;const r=this._options.customSelectionMeshGenerator?this._options.customSelectionMeshGenerator():_o("gazeTracker",{diameter:.0105,thickness:.0075,tessellation:20},t);r.bakeCurrentTransformIntoVertices(),r.isPickable=!1,r.isVisible=!1;const n=new ft.F("targetMat",t);return n.specularColor=bt.v9.Black(),n.emissiveColor=this.selectionMeshDefaultColor,n.backFaceCulling=!1,r.material=n,void 0!==this._options.renderingGroupId&&(i.renderingGroupId=this._options.renderingGroupId,r.renderingGroupId=this._options.renderingGroupId),{laserPointer:i,selectionMesh:r}}_pickingMoved(e,t){if(!e.hit||!t.hit)return!0;if(!(e.pickedMesh&&e.pickedPoint&&t.pickedMesh&&t.pickedPoint))return!0;if(e.pickedMesh!==t.pickedMesh)return!0;e.pickedPoint?.subtractToRef(t.pickedPoint,this._tmpVectorForPickCompare),this._tmpVectorForPickCompare.set(Math.abs(this._tmpVectorForPickCompare.x),Math.abs(this._tmpVectorForPickCompare.y),Math.abs(this._tmpVectorForPickCompare.z));const i=.01*(this._options.gazeModePointerMovedFactor||1)*t.distance;return this._tmpVectorForPickCompare.length()>i}_updatePointerDistance(e,t=100){e.scaling.y=t,this._scene.useRightHandedSystem&&(t*=-1),e.position.z=t/2+.05}_augmentPointerInit(e,t,i){e.pointerId=t,e.pointerType="xr",i&&(e.screenX=i.x,e.screenY=i.y)}get lasterPointerDefaultColor(){return this.laserPointerDefaultColor}}xl._IdCounter=200,xl.Name=rl.POINTER_SELECTION,xl.Version=1,nl.AddWebXRFeature(xl.Name,((e,t)=>()=>new xl(e,t)),xl.Version,!0);var Al,Cl,Sl=o(7484);!function(e){e[e.Float=1]="Float",e[e.Int=2]="Int",e[e.Vector2=4]="Vector2",e[e.Vector3=8]="Vector3",e[e.Vector4=16]="Vector4",e[e.Color3=32]="Color3",e[e.Color4=64]="Color4",e[e.Matrix=128]="Matrix",e[e.Object=256]="Object",e[e.AutoDetect=1024]="AutoDetect",e[e.BasedOnInput=2048]="BasedOnInput",e[e.All=4095]="All"}(Al||(Al={})),function(e){e[e.Vertex=1]="Vertex",e[e.Fragment=2]="Fragment",e[e.Neutral=4]="Neutral",e[e.VertexAndFragment=3]="VertexAndFragment"}(Cl||(Cl={}));class El{constructor(){this.supportUniformBuffers=!1,this.attributes=[],this.uniforms=[],this.constants=[],this.samplers=[],this.functions={},this.extensions={},this.prePassOutput={},this.counters={},this._terminalBlocks=new Set,this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}get shaderLanguage(){return this.sharedData.nodeMaterial.shaderLanguage}get fSuffix(){return 1===this.shaderLanguage?"f":""}finalize(e){const t=e.sharedData.emitComments,i=this.target===Cl.Fragment;1===this.shaderLanguage?this.compilationString=i?`\n${t?"//Entry point\n":""}@fragment\nfn main(input: FragmentInputs) -> FragmentOutputs {\n${this.compilationString}`:`\n${t?"//Entry point\n":""}@vertex\nfn main(input: VertexInputs) -> FragmentInputs{\n${this.compilationString}`:this.compilationString=`\n${t?"//Entry point\n":""}void main(void) {\n${this.compilationString}`,this._constantDeclaration&&(this.compilationString=`\n${t?"//Constants\n":""}${this._constantDeclaration}\n${this.compilationString}`);let s="";for(const e in this.functions)s+=this.functions[e]+"\n";if(this.compilationString=`\n${s}\n${this.compilationString}`,!i&&this._varyingTransfer&&(this.compilationString=`${this.compilationString}\n${this._varyingTransfer}`),this._injectAtEnd&&(this.compilationString=`${this.compilationString}\n${this._injectAtEnd}`),this.compilationString=`${this.compilationString}\n}`,this.sharedData.varyingDeclaration&&(this.compilationString=`\n${t?"//Varyings\n":""}${this.sharedData.varyingDeclaration}\n${this.compilationString}`),this._samplerDeclaration&&(this.compilationString=`\n${t?"//Samplers\n":""}${this._samplerDeclaration}\n${this.compilationString}`),this._uniformDeclaration&&(this.compilationString=`\n${t?"//Uniforms\n":""}${this._uniformDeclaration}\n${this.compilationString}`),this._attributeDeclaration&&!i&&(this.compilationString=`\n${t?"//Attributes\n":""}${this._attributeDeclaration}\n${this.compilationString}`),1!==this.shaderLanguage){this.compilationString="precision highp float;\n"+this.compilationString,this.compilationString="#if defined(WEBGL2) || defined(WEBGPU)\nprecision highp sampler2DArray;\n#endif\n"+this.compilationString,i&&(this.compilationString="#if defined(PREPASS)\r\n#extension GL_EXT_draw_buffers : require\r\nlayout(location = 0) out highp vec4 glFragData[SCENE_MRT_COUNT];\r\nhighp vec4 gl_FragColor;\r\n#endif\r\n"+this.compilationString);for(const e in this.extensions){const t=this.extensions[e];this.compilationString=`\n${t}\n${this.compilationString}`}}this._builtCompilationString=this.compilationString}get _repeatableContentAnchor(){return`###___ANCHOR${this._repeatableContentAnchorIndex++}___###`}_getFreeVariableName(e){return e=e.replace(/[^a-zA-Z_]+/g,""),void 0===this.sharedData.variableNames[e]?(this.sharedData.variableNames[e]=0,"output"===e||"texture"===e?e+this.sharedData.variableNames[e]:e):(this.sharedData.variableNames[e]++,e+this.sharedData.variableNames[e])}_getFreeDefineName(e){return void 0===this.sharedData.defineNames[e]?this.sharedData.defineNames[e]=0:this.sharedData.defineNames[e]++,e+this.sharedData.defineNames[e]}_excludeVariableName(e){this.sharedData.variableNames[e]=0}_emit2DSampler(e,t="",i=!1){(this.samplers.indexOf(e)<0||i)&&(t&&(this._samplerDeclaration+=`#if ${t}\n`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;\n`,this._samplerDeclaration+=`var ${e}: texture_2d<f32>;\n`):this._samplerDeclaration+=`uniform sampler2D ${e};\n`,t&&(this._samplerDeclaration+="#endif\n"),i||this.samplers.push(e))}_emitCubeSampler(e,t="",i=!1){(this.samplers.indexOf(e)<0||i)&&(t&&(this._samplerDeclaration+=`#if ${t}\n`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;\n`,this._samplerDeclaration+=`var ${e}: texture_cube<f32>;\n`):this._samplerDeclaration+=`uniform samplerCube ${e};\n`,t&&(this._samplerDeclaration+="#endif\n"),i||this.samplers.push(e))}_emit2DArraySampler(e){this.samplers.indexOf(e)<0&&(this._samplerDeclaration+=`uniform sampler2DArray ${e};\n`,this.samplers.push(e))}_getGLType(e){switch(e){case Al.Float:return"float";case Al.Int:return"int";case Al.Vector2:return"vec2";case Al.Color3:case Al.Vector3:return"vec3";case Al.Color4:case Al.Vector4:return"vec4";case Al.Matrix:return"mat4"}return""}_getShaderType(e){const t=1===this.shaderLanguage;switch(e){case Al.Float:return t?"f32":"float";case Al.Int:return t?"i32":"int";case Al.Vector2:return t?"vec2f":"vec2";case Al.Color3:case Al.Vector3:return t?"vec3f":"vec3";case Al.Color4:case Al.Vector4:return t?"vec4f":"vec4";case Al.Matrix:return t?"mat4x4f":"mat4"}return""}_emitExtension(e,t,i=""){this.extensions[e]||(i&&(t=`#if ${i}\n${t}\n#endif`),this.extensions[e]=t)}_emitFunction(e,t,i){this.functions[e]||(this.sharedData.emitComments&&(t=i+"\n"+t),this.functions[e]=t)}_emitCodeFromInclude(e,t,i){const s=Ma.l.GetIncludesShadersStore(this.shaderLanguage);if(i&&i.repeatKey)return`#include<${e}>${i.substitutionVars?"("+i.substitutionVars+")":""}[0..${i.repeatKey}]\n`;let r=s[e]+"\n";if(this.sharedData.emitComments&&(r=t+"\n"+r),!i)return r;if(i.replaceStrings)for(let e=0;e<i.replaceStrings.length;e++){const t=i.replaceStrings[e];r=r.replace(t.search,t.replace)}return r}_emitFunctionFromInclude(e,t,i,s=""){const r=e+s;if(this.functions[r])return;const n=Ma.l.GetIncludesShadersStore(this.shaderLanguage);if(!i||!(i.removeAttributes||i.removeUniforms||i.removeVaryings||i.removeIfDef||i.replaceStrings))return i&&i.repeatKey?this.functions[r]=`#include<${e}>${i.substitutionVars?"("+i.substitutionVars+")":""}[0..${i.repeatKey}]\n`:this.functions[r]=`#include<${e}>${i?.substitutionVars?"("+i?.substitutionVars+")":""}\n`,void(this.sharedData.emitComments&&(this.functions[r]=t+"\n"+this.functions[r]));if(this.functions[r]=n[e],this.sharedData.emitComments&&(this.functions[r]=t+"\n"+this.functions[r]),i.removeIfDef&&(this.functions[r]=this.functions[r].replace(/^\s*?#ifdef.+$/gm,""),this.functions[r]=this.functions[r].replace(/^\s*?#endif.*$/gm,""),this.functions[r]=this.functions[r].replace(/^\s*?#else.*$/gm,""),this.functions[r]=this.functions[r].replace(/^\s*?#elif.*$/gm,"")),i.removeAttributes&&(this.functions[r]=this.functions[r].replace(/\s*?attribute .+?;/g,"\n")),i.removeUniforms&&(this.functions[r]=this.functions[r].replace(/\s*?uniform .*?;/g,"\n")),i.removeVaryings&&(this.functions[r]=this.functions[r].replace(/\s*?(varying|in) .+?;/g,"\n")),i.replaceStrings)for(let e=0;e<i.replaceStrings.length;e++){const t=i.replaceStrings[e];this.functions[r]=this.functions[r].replace(t.search,t.replace)}}_registerTempVariable(e){return-1===this.sharedData.temps.indexOf(e)&&(this.sharedData.temps.push(e),!0)}_emitVaryingFromString(e,t,i="",s=!1){if(-1!==this.sharedData.varyings.indexOf(e))return!1;this.sharedData.varyings.push(e),i&&(i.startsWith("defined(")?this.sharedData.varyingDeclaration+=`#if ${i}\n`:this.sharedData.varyingDeclaration+=`${s?"#ifndef":"#ifdef"} ${i}\n`);const r=this._getShaderType(t);return 1===this.shaderLanguage?this.sharedData.varyingDeclaration+=`varying ${e}: ${r};\n`:this.sharedData.varyingDeclaration+=`varying ${r} ${e};\n`,i&&(this.sharedData.varyingDeclaration+="#endif\n"),!0}_getVaryingName(e){return 1===this.shaderLanguage?(this.target!==Cl.Fragment?"vertexOutputs.":"fragmentInputs.")+e:e}_emitUniformFromString(e,t,i="",s=!1){if(-1!==this.uniforms.indexOf(e))return;this.uniforms.push(e),i&&(i.startsWith("defined(")?this._uniformDeclaration+=`#if ${i}\n`:this._uniformDeclaration+=`${s?"#ifndef":"#ifdef"} ${i}\n`);const r=this._getShaderType(t);1===this.shaderLanguage?this._uniformDeclaration+=`uniform ${e}: ${r};\n`:this._uniformDeclaration+=`uniform ${r} ${e};\n`,i&&(this._uniformDeclaration+="#endif\n")}_generateTernary(e,t,i){return 1===this.shaderLanguage?`select(${t}, ${e}, ${i})`:`(${i}) ? ${e} : ${t}`}_emitFloat(e){return e.toString()===e.toFixed(0)?`${e}.0`:e.toString()}_declareOutput(e,t){return this._declareLocalVar(e.associatedVariableName,e.type,t)}_declareLocalVar(e,t,i){return 1===this.shaderLanguage?`${i?"const":"var"} ${e}: ${this._getShaderType(t)}`:`${this._getShaderType(t)} ${e}`}_samplerCubeFunc(){return 1===this.shaderLanguage?"textureSample":"textureCube"}_samplerFunc(){return 1===this.shaderLanguage?"textureSample":"texture2D"}_samplerLODFunc(){return 1===this.shaderLanguage?"textureSampleLevel":"texture2DLodEXT"}_toLinearSpace(e){return 1!==this.shaderLanguage||e.type!==Al.Color3&&e.type!==Al.Vector3?`toLinearSpace(${e.associatedVariableName})`:`toLinearSpaceVec3(${e.associatedVariableName})`}_generateTextureSample(e,t){return 1===this.shaderLanguage?`${this._samplerFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerFunc()}(${t}, ${e})`}_generateTextureSampleLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerLODFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerLODFunc()}(${t}, ${e}, ${i})`}_generateTextureSampleCube(e,t){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerCubeFunc()}(${t}, ${e})`}_generateTextureSampleCubeLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerCubeFunc()}(${t}, ${e}, ${i})`}_convertVariableDeclarationToWGSL(e,t,i){return i.replace(new RegExp(`(${e})\\s+(\\w+)`,"g"),`var $2: ${t}`)}_convertVariableConstructorsToWGSL(e,t,i){return i.replace(new RegExp(`(${e})\\(`,"g"),` ${t}(`)}_convertOutParametersToWGSL(e){return e.replace(new RegExp("out\\s+var\\s+(\\w+)\\s*:\\s*(\\w+)","g"),"$1: ptr<function, $2>")}_convertTernaryOperandsToWGSL(e){return e.replace(new RegExp("\\[(.*?)\\?(.*?):(.*)\\]","g"),((e,t,i,s)=>`select(${s}, ${i}, ${t})`))}_convertModOperatorsToWGSL(e){return e.replace(new RegExp("mod\\((.+?),\\s*(.+?)\\)","g"),((e,t,i)=>`((${t})%(${i}))`))}_convertConstToWGSL(e){return e.replace(new RegExp("const var","g"),"const")}_convertInnerFunctionsToWGSL(e){return e.replace(new RegExp("inversesqrt","g"),"inverseSqrt")}_convertFunctionsToWGSL(e){const t=/var\s+(\w+)\s*:\s*(\w+)\((.*)\)/g;let i;for(;null!==(i=t.exec(e));){const t=i[1],s=i[2],r=i[3].replace(/var\s/g,"");e=e.replace(i[0],`fn ${t}(${r}) -> ${s}`)}return e}_babylonSLtoWGSL(e){return e=this._convertVariableDeclarationToWGSL("void","voidnull",e),e=this._convertVariableDeclarationToWGSL("bool","bool",e),e=this._convertVariableDeclarationToWGSL("int","i32",e),e=this._convertVariableDeclarationToWGSL("uint","u32",e),e=this._convertVariableDeclarationToWGSL("float","f32",e),e=this._convertVariableDeclarationToWGSL("vec2","vec2f",e),e=this._convertVariableDeclarationToWGSL("vec3","vec3f",e),e=this._convertVariableDeclarationToWGSL("vec4","vec4f",e),e=this._convertVariableDeclarationToWGSL("mat2","mat2x2f",e),e=this._convertVariableDeclarationToWGSL("mat3","mat3x3f",e),e=this._convertVariableDeclarationToWGSL("mat4","mat4x4f",e),e=this._convertVariableConstructorsToWGSL("float","f32",e),e=this._convertVariableConstructorsToWGSL("vec2","vec2f",e),e=this._convertVariableConstructorsToWGSL("vec3","vec3f",e),e=this._convertVariableConstructorsToWGSL("vec4","vec4f",e),e=this._convertVariableConstructorsToWGSL("mat2","mat2x2f",e),e=this._convertVariableConstructorsToWGSL("mat3","mat3x3f",e),e=this._convertVariableConstructorsToWGSL("mat4","mat4x4f",e),e=this._convertTernaryOperandsToWGSL(e),e=this._convertModOperatorsToWGSL(e),e=this._convertConstToWGSL(e),e=this._convertInnerFunctionsToWGSL(e),e=(e=this._convertOutParametersToWGSL(e)).replace(/\[\*\]/g,"*"),(e=(e=(e=this._convertFunctionsToWGSL(e)).replace(/\s->\svoidnull/g,"")).replace(/dFdx/g,"dpdx")).replace(/dFdy/g,"dpdy")}_convertTernaryOperandsToGLSL(e){return e.replace(new RegExp("\\[(.+?)\\?(.+?):(.+)\\]","g"),((e,t,i,s)=>`${t} ? ${i} : ${s}`))}_babylonSLtoGLSL(e){return e=e.replace(/\[\*\]/g,""),this._convertTernaryOperandsToGLSL(e)}}var Rl,Pl,Il=o(2450);class Ml{constructor(){this.temps=[],this.varyings=[],this.varyingDeclaration="",this.inputBlocks=[],this.textureBlocks=[],this.bindableBlocks=[],this.forcedBindableBlocks=[],this.blocksWithFallbacks=[],this.blocksWithDefines=[],this.repeatableContentBlocks=[],this.dynamicUniformBlocks=[],this.blockingBlocks=[],this.animatedInputs=[],this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}emitErrors(e=null){let t="";this.checks.emitVertex||this.allowEmptyVertexProgram||(t+="NodeMaterial does not have a vertex output. You need to at least add a block that generates a position value.\n"),this.checks.emitFragment||(t+="NodeMaterial does not have a fragment output. You need to at least add a block that generates a color value.\n");for(const e of this.checks.notConnectedNonOptionalInputs)t+=`input ${e.name} from block ${e.ownerBlock.name}[${e.ownerBlock.getClassName()}] is not connected and is not optional.\n`;return!t||(e&&e.notifyObservers(t),It.V.Error("Build of NodeMaterial failed:\n"+t),!1)}}!function(e){e[e.Compatible=0]="Compatible",e[e.TypeIncompatible=1]="TypeIncompatible",e[e.TargetIncompatible=2]="TargetIncompatible",e[e.HierarchyIssue=3]="HierarchyIssue"}(Rl||(Rl={})),function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(Pl||(Pl={}));class wl{static AreEquivalentTypes(e,t){switch(e){case Al.Vector3:if(t===Al.Color3)return!0;break;case Al.Vector4:if(t===Al.Color4)return!0;break;case Al.Color3:if(t===Al.Vector3)return!0;break;case Al.Color4:if(t===Al.Vector4)return!0}return!1}get _connectedPoint(){return this._connectedPointBackingField}set _connectedPoint(e){this._connectedPointBackingField!==e&&(this._connectedPointTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._connectedPointBackingField=e)),this._connectedPointBackingField&&(this._connectedPointTypeChangedObserver=this._connectedPointBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}get _typeConnectionSource(){return this._typeConnectionSourceBackingField}set _typeConnectionSource(e){this._typeConnectionSourceBackingField!==e&&(this._typeConnectionSourceTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._typeConnectionSourceBackingField=e)),this._typeConnectionSourceBackingField&&(this._typeConnectionSourceTypeChangedObserver=this._typeConnectionSourceBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}get _defaultConnectionPointType(){return this._defaultConnectionPointTypeBackingField}set _defaultConnectionPointType(e){this._updateTypeDependentState((()=>this._defaultConnectionPointTypeBackingField=e))}get _linkedConnectionSource(){return this._linkedConnectionSourceBackingField}set _linkedConnectionSource(e){this._linkedConnectionSourceBackingField!==e&&(this._linkedConnectionSourceTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._linkedConnectionSourceBackingField=e)),this._isMainLinkSource=!1,this._linkedConnectionSourceBackingField&&(this._linkedConnectionSourceTypeChangedObserver=this._linkedConnectionSourceBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}get direction(){return this._direction}get declarationVariableName(){return this._ownerBlock.isInput?this._ownerBlock.declarationVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.declarationVariableName}get associatedVariableName(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName}set associatedVariableName(e){this._associatedVariableName=e}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}get type(){if(this._type===Al.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.connectedPoint._redirectedSource&&this._linkedConnectionSource.connectedPoint._redirectedSource.isConnected?this._linkedConnectionSource.connectedPoint._redirectedSource.type:this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Al.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(e){this._updateTypeDependentState((()=>this._type=e))}get target(){return this._prioritizeVertex&&this._ownerBlock?this._target!==Cl.VertexAndFragment?this._target:this._ownerBlock.target===Cl.Fragment?Cl.Fragment:Cl.Vertex:this._target}set target(e){this._target=e}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get isConnectedToInputBlock(){return null!==this.connectedPoint&&this.connectedPoint.ownerBlock.isInput}get connectInputBlock(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((e=>e.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get isDirectlyConnectedToVertexOutput(){if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===Cl.Vertex)return!0;if((e.ownerBlock.target===Cl.Neutral||e.ownerBlock.target===Cl.VertexAndFragment)&&e.ownerBlock.outputs.some((e=>e.isDirectlyConnectedToVertexOutput)))return!0}return!1}get isConnectedInVertexShader(){if(this.target===Cl.Vertex)return!0;if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===Cl.Vertex)return!0;if(e.target===Cl.Vertex)return!0;if((e.ownerBlock.target===Cl.Neutral||e.ownerBlock.target===Cl.VertexAndFragment)&&e.ownerBlock.outputs.some((e=>e.isConnectedInVertexShader)))return!0}return!1}get isConnectedInFragmentShader(){if(this.target===Cl.Fragment)return!0;if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===Cl.Fragment)return!0;if((e.ownerBlock.target===Cl.Neutral||e.ownerBlock.target===Cl.VertexAndFragment)&&e.ownerBlock.isConnectedInFragmentShader())return!0}return!1}createCustomInputBlock(){return null}constructor(e,t,i){this._preventBubbleUp=!1,this._connectedPointBackingField=null,this._endpoints=new Array,this._redirectedSource=null,this._typeConnectionSourceBackingField=null,this._defaultConnectionPointTypeBackingField=null,this._isMainLinkSource=!1,this._linkedConnectionSourceBackingField=null,this._acceptedConnectionPointType=null,this._type=Al.Float,this._enforceAssociatedVariableName=!1,this._forPostBuild=!1,this.needDualDirectionValidation=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new Zi.cP,this.onDisconnectionObservable=new Zi.cP,this.onTypeChangedObservable=new Zi.cP,this._isTypeChangeObservableNotifying=!1,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this._prioritizeVertex=!1,this._target=Cl.VertexAndFragment,this._ownerBlock=t,this.name=e,this._direction=i}getClassName(){return"NodeMaterialConnectionPoint"}canConnectTo(e){return 0===this.checkCompatibilityState(e)}checkCompatibilityState(e){const t=this._ownerBlock,i=e.ownerBlock;if(t.target===Cl.Fragment){if(i.target===Cl.Vertex)return 2;for(const e of i.outputs)if(e.ownerBlock.target!=Cl.Neutral&&e.isConnectedInVertexShader)return 2}if(this.type!==e.type&&e.innerType!==Al.AutoDetect)return wl.AreEquivalentTypes(this.type,e.type)||e.acceptedConnectionPointTypes&&-1!==e.acceptedConnectionPointTypes.indexOf(this.type)||e._acceptedConnectionPointType&&wl.AreEquivalentTypes(e._acceptedConnectionPointType.type,this.type)?0:1;if(e.excludedConnectionPointTypes&&-1!==e.excludedConnectionPointTypes.indexOf(this.type))return 1;let s=i,r=t;return 0===this.direction&&(s=t,r=i),s.isAnAncestorOf(r)?3:0}connectTo(e,t=!1){if(!t&&!this.canConnectTo(e))throw"Cannot connect these two connectors.";return this._endpoints.push(e),e._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(e),e.onConnectionObservable.notifyObservers(this),this}disconnectFrom(e){const t=this._endpoints.indexOf(e);return-1===t||(this._endpoints.splice(t,1),e._connectedPoint=null,this._enforceAssociatedVariableName=!1,e._enforceAssociatedVariableName=!1,this.onDisconnectionObservable.notifyObservers(e),e.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(e){let t=1;for(;t<Al.All;)e&t||this.excludedConnectionPointTypes.push(t),t<<=1}serialize(e=!0){const t={};return t.name=this.name,this.displayName&&(t.displayName=this.displayName),e&&this.connectedPoint&&(t.inputName=this.name,t.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,t.targetConnectionName=this.connectedPoint.name,t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),t}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear(),this.onTypeChangedObservable.clear(),this._connectedPoint=null,this._typeConnectionSource=null,this._linkedConnectionSource=null}_updateTypeDependentState(e){const t=this.type;e(),this.type!==t&&this._notifyTypeChanged()}_notifyTypeChanged(){this._isTypeChangeObservableNotifying||(this._isTypeChangeObservableNotifying=!0,this.onTypeChangedObservable.notifyObservers(this.type),this._isTypeChangeObservableNotifying=!1)}}var Ol,Bl,Dl,Fl=o(9112);class Ll{get _isFinalOutputAndActive(){return this._isFinalOutput}get _hasPrecedence(){return!1}get name(){return this._name}get codeIsReady(){return this._codeIsReady}set name(e){this.validateBlockName(e)&&(this._name=e)}get isUnique(){return this._isUnique}get isFinalMerger(){return this._isFinalMerger}get isInput(){return this._isInput}get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isLoop(){return this._isLoop}get buildId(){return this._buildId}set buildId(e){this._buildId=e}get target(){return this._target}set target(e){this._target&e||(this._target=e)}get inputs(){return this._inputs}get outputs(){return this._outputs}getInputByName(e){const t=this._inputs.filter((t=>t.name===e));return t.length?t[0]:null}getOutputByName(e){const t=this._outputs.filter((t=>t.name===e));return t.length?t[0]:null}constructor(e,t=Cl.Vertex,i=!1,s=!1){switch(this._isFinalMerger=!1,this._isInput=!1,this._isLoop=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._name="",this._isUnique=!1,this._codeIsReady=!0,this._isFinalOutput=!1,this.onCodeIsReadyObservable=new Zi.cP,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array,this._outputs=new Array,this.comments="",this.visibleInInspector=!1,this.visibleOnFrame=!1,this._target=t,this._originalTargetIsNeutral=t===Cl.Neutral,this._isFinalMerger=i,this._isFinalOutput=s,this.getClassName()){case"InputBlock":this._isInput=!0;break;case"NodeMaterialTeleportOutBlock":this._isTeleportOut=!0;break;case"NodeMaterialTeleportInBlock":this._isTeleportIn=!0;break;case"LoopBlock":this._isLoop=!0}this._name=e,this.uniqueId=Fl.K.UniqueId}_setInitialTarget(e){this._target=e,this._originalTargetIsNeutral=e===Cl.Neutral}initialize(e){}bind(e,t,i,s){}_writeVariable(e){return e.connectedPoint?`${e.associatedVariableName}`:"0."}_writeFloat(e){let t=e.toString();return-1===t.indexOf(".")&&(t+=".0"),`${t}`}getClassName(){return"NodeMaterialBlock"}isConnectedInFragmentShader(){return this.outputs.some((e=>e.isConnectedInFragmentShader))}registerInput(e,t,i=!1,s,r){return(r=r??new wl(e,this,0)).type=t,r.isOptional=i,s&&(r.target=s),this._inputs.push(r),this}registerOutput(e,t,i,s){return(s=s??new wl(e,this,1)).type=t,i&&(s.target=i),this._outputs.push(s),this}getFirstAvailableInput(e=null){for(const t of this._inputs)if(!(t.connectedPoint||e&&e.type!==t.type&&t.type!==Al.AutoDetect&&-1===t.acceptedConnectionPointTypes.indexOf(e.type)))return t;return null}getFirstAvailableOutput(e=null){for(const t of this._outputs)if(!e||!e.target||e.target===Cl.Neutral||e.target&t.target)return t;return null}getSiblingOutput(e){const t=this._outputs.indexOf(e);return-1===t||t>=this._outputs.length?null:this._outputs[t+1]}isAnAncestorOf(e){for(const t of this._outputs)if(t.hasEndpoints)for(const i of t.endpoints){if(i.ownerBlock===e)return!0;if(i.ownerBlock.isAnAncestorOf(e))return!0}return!1}connectTo(e,t){if(0===this._outputs.length)return;let i=t&&t.output?this.getOutputByName(t.output):this.getFirstAvailableOutput(e),s=!0;for(;s;){const r=t&&t.input?e.getInputByName(t.input):e.getFirstAvailableInput(i);if(i&&r&&i.canConnectTo(r))i.connectTo(r),s=!1;else{if(!i)throw"Unable to find a compatible match";i=this.getSiblingOutput(i)}}return this}_buildBlock(e){}_postBuildBlock(e){}updateUniformsAndSamples(e,t,i,s){}provideFallbacks(e,t){}initializeDefines(e,t,i,s=!1){}prepareDefines(e,t,i,s=!1,r){}autoConfigure(e,t=()=>!0){}replaceRepeatableContent(e,t,i,s){}get willBeGeneratedIntoVertexShaderFromFragmentShader(){return!(this.isInput||this.isFinalMerger||this._outputs.some((e=>e.isDirectlyConnectedToVertexOutput))||this.target===Cl.Vertex||this.target!==Cl.VertexAndFragment&&this.target!==Cl.Neutral||!this._outputs.some((e=>e.isConnectedInVertexShader)))}isReady(e,t,i,s=!1){return!0}_linkConnectionTypes(e,t,i=!1){i?this._inputs[t]._acceptedConnectionPointType=this._inputs[e]:(this._inputs[e]._linkedConnectionSource=this._inputs[t],this._inputs[e]._isMainLinkSource=!0),this._inputs[t]._linkedConnectionSource=this._inputs[e]}_processBuild(e,t,i,s){e.build(t,s);const r=null!=t._vertexState,n=e._buildTarget===Cl.Vertex&&e.target!==Cl.VertexAndFragment;if(r&&(!(e.target&e._buildTarget)||!(e.target&i.target)||this.target!==Cl.VertexAndFragment&&n)&&(!e.isInput&&t.target!==e._buildTarget||e.isInput&&e.isAttribute&&!e._noContextSwitch)){const e=i.connectedPoint;if(t._vertexState._emitVaryingFromString("v_"+e.declarationVariableName,e.type)){const i=1===t.shaderLanguage?"vertexOutputs.":"";t._vertexState.compilationString+=`${i}${"v_"+e.declarationVariableName} = ${e.associatedVariableName};\n`}const s=1===t.shaderLanguage?"fragmentInputs.":"";i.associatedVariableName=s+"v_"+e.declarationVariableName,i._enforceAssociatedVariableName=!0}}validateBlockName(e){const t=["position","normal","tangent","particle_positionw","uv","uv2","uv3","uv4","uv5","uv6","position2d","particle_uv","matricesIndices","matricesWeights","world0","world1","world2","world3","particle_color","particle_texturemask"];for(const i of t)if(e===i)return!1;return!0}_customBuildStep(e,t){}build(e,t){if(this._buildId===e.sharedData.buildId)return!0;if(!this.isInput)for(const t of this._outputs)t.associatedVariableName||(t.associatedVariableName=e._getFreeVariableName(t.name));for(const i of this._inputs){if(!i.connectedPoint){i.isOptional||e.sharedData.checks.notConnectedNonOptionalInputs.push(i);continue}if(this.target!==Cl.Neutral){if(!(i.target&this.target))continue;if(!(i.target&e.target))continue}const s=i.connectedPoint.ownerBlock;s&&s!==this&&this._processBuild(s,e,i,t)}if(this._customBuildStep(e,t),this._buildId===e.sharedData.buildId)return!0;if(e.sharedData.verbose&&It.V.Log(`${e.target===Cl.Vertex?"Vertex shader":"Fragment shader"}: Building ${this.name} [${this.getClassName()}]`),this.isFinalMerger)switch(e.target){case Cl.Vertex:e.sharedData.checks.emitVertex=!0;break;case Cl.Fragment:e.sharedData.checks.emitFragment=!0}!this.isInput&&e.sharedData.emitComments&&(e.compilationString+=`\n//${this.name}\n`),this._buildBlock(e),this._buildId=e.sharedData.buildId,this._buildTarget=e.target;for(const i of this._outputs)if(!i._forPostBuild&&i.target&e.target)for(const s of i.endpoints){const i=s.ownerBlock;i&&(i.target&e.target&&-1!==t.indexOf(i)||e._terminalBlocks.has(i))&&this._processBuild(i,e,s,t)}this._postBuildBlock(e);for(const i of this._outputs)if(i._forPostBuild&&i.target&e.target)for(const s of i.endpoints){const i=s.ownerBlock;i&&i.target&e.target&&-1!==t.indexOf(i)&&this._processBuild(i,e,s,t)}return!1}_inputRename(e){return e}_outputRename(e){return e}_dumpPropertiesCode(){const e=this._codeVariableName;return`${e}.visibleInInspector = ${this.visibleInInspector};\n${e}.visibleOnFrame = ${this.visibleOnFrame};\n${e}.target = ${this.target};\n`}_dumpCode(e,t){t.push(this);const i=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=i||`${this.getClassName()}_${this.uniqueId}`,-1!==e.indexOf(this._codeVariableName)){let t=0;do{t++,this._codeVariableName=i+t}while(-1!==e.indexOf(this._codeVariableName))}e.push(this._codeVariableName);let s=`\n// ${this.getClassName()}\n`;this.comments&&(s+=`// ${this.comments}\n`),s+=`var ${this._codeVariableName} = new BABYLON.${this.getClassName()}("${this.name}");\n`,s+=this._dumpPropertiesCode();for(const i of this.inputs){if(!i.isConnected)continue;const r=i.connectedPoint.ownerBlock;-1===t.indexOf(r)&&(s+=r._dumpCode(e,t))}for(const i of this.outputs)if(i.hasEndpoints)for(const r of i.endpoints){const i=r.ownerBlock;i&&-1===t.indexOf(i)&&(s+=i._dumpCode(e,t))}return s}_dumpCodeForOutputConnections(e){let t="";if(-1!==e.indexOf(this))return t;e.push(this);for(const i of this.inputs){if(!i.isConnected)continue;const s=i.connectedPoint,r=s.ownerBlock;t+=r._dumpCodeForOutputConnections(e),t+=`${r._codeVariableName}.${r._outputRename(s.name)}.connectTo(${this._codeVariableName}.${this._inputRename(i.name)});\n`}return t}clone(e,t=""){const i=this.serialize(),s=(0,Ft.n9)(i.customType);if(s){const r=new s;return r._deserialize(i,e,t),r}return null}serialize(){const e={};e.customType="BABYLON."+this.getClassName(),e.id=this.uniqueId,e.name=this.name,e.comments=this.comments,e.visibleInInspector=this.visibleInInspector,e.visibleOnFrame=this.visibleOnFrame,e.target=this.target,e.inputs=[],e.outputs=[];for(const t of this.inputs)e.inputs.push(t.serialize());for(const t of this.outputs)e.outputs.push(t.serialize(!1));return e}_deserialize(e,t,i,s){this.name=e.name,this.comments=e.comments,this.visibleInInspector=!!e.visibleInInspector,this.visibleOnFrame=!!e.visibleOnFrame,this._target=e.target??this.target,this._deserializePortDisplayNamesAndExposedOnFrame(e)}_deserializePortDisplayNamesAndExposedOnFrame(e){const t=e.inputs,i=e.outputs;t&&t.forEach(((e,t)=>{e.displayName&&(this.inputs[t].displayName=e.displayName),e.isExposedOnFrame&&(this.inputs[t].isExposedOnFrame=e.isExposedOnFrame,this.inputs[t].exposedPortPosition=e.exposedPortPosition)})),i&&i.forEach(((e,t)=>{e.displayName&&(this.outputs[t].displayName=e.displayName),e.isExposedOnFrame&&(this.outputs[t].isExposedOnFrame=e.isExposedOnFrame,this.outputs[t].exposedPortPosition=e.exposedPortPosition)}))}dispose(){this.onCodeIsReadyObservable.clear();for(const e of this.inputs)e.dispose();for(const e of this.outputs)e.dispose()}}function Nl(e,t=0,i="PROPERTIES",s){return(r,n)=>{let o=r._propStore;o||(o=[],r._propStore=o),o.push({propertyName:n,displayName:e,type:t,groupName:i,options:s??{},className:r.getClassName()})}}!function(e){e[e.Boolean=0]="Boolean",e[e.Float=1]="Float",e[e.Int=2]="Int",e[e.Vector2=3]="Vector2",e[e.List=4]="List",e[e.Color4=5]="Color4",e[e.SamplingMode=6]="SamplingMode",e[e.TextureFormat=7]="TextureFormat",e[e.TextureType=8]="TextureType"}(Ol||(Ol={}));class kl extends Ll{get transformAsDirection(){return 0===this.complementW}set transformAsDirection(e){this.complementW=e?0:1}constructor(e){super(e,Cl.Neutral),this.complementW=1,this.complementZ=0,this.target=Cl.Vertex,this.registerInput("vector",Al.AutoDetect),this.registerInput("transform",Al.Matrix),this.registerOutput("output",Al.Vector4),this.registerOutput("xyz",Al.Vector3),this._inputs[0].onConnectionObservable.add((e=>{if(e.ownerBlock.isInput){const t=e.ownerBlock;"normal"!==t.name&&"tangent"!==t.name||(this.complementW=0)}}))}getClassName(){return"TransformBlock"}get vector(){return this._inputs[0]}get output(){return this._outputs[0]}get xyz(){return this._outputs[1]}get transform(){return this._inputs[1]}_buildBlock(e){super._buildBlock(e);const t=this.vector,i=this.transform,s=e._getShaderType(Al.Vector4),r=e._getShaderType(Al.Vector3);if(t.connectedPoint){if(0===this.complementW||this.transformAsDirection){const n=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",n),e.sharedData.blocksWithDefines.push(this);const o=e._getFreeVariableName(`${i.associatedVariableName}_NUS`);switch(1===e.shaderLanguage?e.compilationString+=`var ${o}: mat3x3f = mat3x3f(${i.associatedVariableName}[0].xyz, ${i.associatedVariableName}[1].xyz, ${i.associatedVariableName}[2].xyz);\n`:e.compilationString+=`mat3 ${o} = mat3(${i.associatedVariableName});\n`,e.compilationString+="#ifdef NONUNIFORMSCALING\n",e.compilationString+=`${o} = transposeMat3(inverseMat3(${o}));\n`,e.compilationString+="#endif\n",t.connectedPoint.type){case Al.Vector2:e.compilationString+=e._declareOutput(this.output)+` = ${s}(${o} * ${r}(${t.associatedVariableName}, ${this._writeFloat(this.complementZ)}), ${this._writeFloat(this.complementW)});\n`;break;case Al.Vector3:case Al.Color3:e.compilationString+=e._declareOutput(this.output)+` = ${s}(${o} * ${t.associatedVariableName}, ${this._writeFloat(this.complementW)});\n`;break;default:e.compilationString+=e._declareOutput(this.output)+` = ${s}(${o} * ${t.associatedVariableName}.xyz, ${this._writeFloat(this.complementW)});\n`}}else{const r=i.associatedVariableName;switch(t.connectedPoint.type){case Al.Vector2:e.compilationString+=e._declareOutput(this.output)+` = ${r} * ${s}(${t.associatedVariableName}, ${this._writeFloat(this.complementZ)}, ${this._writeFloat(this.complementW)});\n`;break;case Al.Vector3:case Al.Color3:e.compilationString+=e._declareOutput(this.output)+` = ${r} * ${s}(${t.associatedVariableName}, ${this._writeFloat(this.complementW)});\n`;break;default:e.compilationString+=e._declareOutput(this.output)+` = ${r} * ${t.associatedVariableName};\n`}}this.xyz.hasEndpoints&&(e.compilationString+=e._declareOutput(this.xyz)+` = ${this.output.associatedVariableName}.xyz;\n`)}return this}prepareDefines(e,t,i){e.nonUniformScaling&&i.setValue("NONUNIFORMSCALING",!0)}serialize(){const e=super.serialize();return e.complementZ=this.complementZ,e.complementW=this.complementW,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.complementZ=void 0!==e.complementZ?e.complementZ:0,this.complementW=void 0!==e.complementW?e.complementW:1}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.complementZ = ${this.complementZ};\n`;return e+=`${this._codeVariableName}.complementW = ${this.complementW};\n`,e}}(0,Et.Cg)([Nl("Transform as direction",0,void 0,{embedded:!0})],kl.prototype,"transformAsDirection",null),(0,Ft.Y5)("BABYLON.TransformBlock",kl);class Ul extends Ll{constructor(e){super(e,Cl.Vertex,!0),this.registerInput("vector",Al.Vector4)}getClassName(){return"VertexOutputBlock"}get vector(){return this._inputs[0]}_isLogarithmicDepthEnabled(e,t){if(t)return!0;for(const t of e)if(t.useLogarithmicDepth)return!0;return!1}_buildBlock(e){super._buildBlock(e);const t=this.vector,i=1===e.shaderLanguage;if(1===e.shaderLanguage?e.compilationString+=`vertexOutputs.position = ${t.associatedVariableName};\n`:e.compilationString+=`gl_Position = ${t.associatedVariableName};\n`,this._isLogarithmicDepthEnabled(e.sharedData.fragmentOutputNodes,e.sharedData.nodeMaterial.useLogarithmicDepth)){e._emitUniformFromString("logarithmicDepthConstant",Al.Float),e._emitVaryingFromString("vFragmentDepth",Al.Float);const t=i?"vertexOutputs.vFragmentDepth":"vFragmentDepth",s=i?"uniforms.":"",r=i?"vertexOutputs.position":"gl_Position";e.compilationString+=`${t} = 1.0 + ${r}.w;\n`,e.compilationString+=`${r}.z = log2(max(0.000001, ${t})) * ${s}logarithmicDepthConstant;\n`}return this}}(0,Ft.Y5)("BABYLON.VertexOutputBlock",Ul),function(e){e[e.NoColorSpace=0]="NoColorSpace",e[e.Gamma=1]="Gamma",e[e.Linear=2]="Linear"}(Bl||(Bl={}));class Vl extends Ll{constructor(e){super(e,Cl.Fragment,!0,!0),this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this.useLogarithmicDepth=!1,this.registerInput("rgba",Al.Color4,!0),this.registerInput("rgb",Al.Color3,!0),this.registerInput("a",Al.Float,!0),this.registerInput("glow",Al.Color3,!0),this.rgb.acceptedConnectionPointTypes.push(Al.Vector3),this.rgb.acceptedConnectionPointTypes.push(Al.Float),this.additionalColor.acceptedConnectionPointTypes.push(Al.Vector3),this.additionalColor.acceptedConnectionPointTypes.push(Al.Float)}get colorSpace(){return this.convertToGammaSpace?Bl.Gamma:this.convertToLinearSpace?Bl.Linear:Bl.NoColorSpace}set colorSpace(e){this.convertToGammaSpace=e===Bl.Gamma,this.convertToLinearSpace=e===Bl.Linear}getClassName(){return"FragmentOutputBlock"}initialize(e){e._excludeVariableName("logarithmicDepthConstant"),e._excludeVariableName("vFragmentDepth")}get rgba(){return this._inputs[0]}get rgb(){return this._inputs[1]}get a(){return this._inputs[2]}get additionalColor(){return this._inputs[3]}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToLinearSpace,!0),i.setValue(this._gammaDefineName,this.convertToGammaSpace,!0),i.setValue(this._additionalColorDefineName,this.additionalColor.connectedPoint&&t._useAdditionalColor,!0)}bind(e,t,i){(this.useLogarithmicDepth||t.useLogarithmicDepth)&&i&&(0,Ut.DL)(void 0,e,i.getScene())}_buildBlock(e){super._buildBlock(e);const t=this.rgba,i=this.rgb,s=this.a,r=this.additionalColor,n=1===e.shaderLanguage;e.sharedData.hints.needAlphaBlending=t.isConnected||s.isConnected,e.sharedData.blocksWithDefines.push(this),(this.useLogarithmicDepth||e.sharedData.nodeMaterial.useLogarithmicDepth)&&(e._emitUniformFromString("logarithmicDepthConstant",Al.Float),e._emitVaryingFromString("vFragmentDepth",Al.Float),e.sharedData.bindableBlocks.push(this)),r.connectedPoint&&(e._excludeVariableName("useAdditionalColor"),e._emitUniformFromString("useAdditionalColor",Al.Float),this._additionalColorDefineName=e._getFreeDefineName("USEADDITIONALCOLOR")),this._linearDefineName=e._getFreeDefineName("CONVERTTOLINEAR"),this._gammaDefineName=e._getFreeDefineName("CONVERTTOGAMMA");const o=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",o);let a="gl_FragColor";1===e.shaderLanguage&&(e.compilationString+="var fragmentOutputsColor : vec4<f32>;\r\n",a="fragmentOutputsColor");const h=e._getShaderType(Al.Vector4);if(r.connectedPoint){let t="1.0";s.connectedPoint&&(t=s.associatedVariableName),e.compilationString+=`#ifdef ${this._additionalColorDefineName}\n`,r.connectedPoint.type===Al.Float?e.compilationString+=`${a}  = ${h}(${r.associatedVariableName}, ${r.associatedVariableName}, ${r.associatedVariableName}, ${t});\n`:e.compilationString+=`${a}  = ${h}(${r.associatedVariableName}, ${t});\n`,e.compilationString+="#else\n"}if(t.connectedPoint)s.isConnected?e.compilationString+=`${a} = ${h}(${t.associatedVariableName}.rgb, ${s.associatedVariableName});\n`:e.compilationString+=`${a}  = ${t.associatedVariableName};\n`;else if(i.connectedPoint){let t="1.0";s.connectedPoint&&(t=s.associatedVariableName),i.connectedPoint.type===Al.Float?e.compilationString+=`${a}  = ${h}(${i.associatedVariableName}, ${i.associatedVariableName}, ${i.associatedVariableName}, ${t});\n`:e.compilationString+=`${a}  = ${h}(${i.associatedVariableName}, ${t});\n`}else e.sharedData.checks.notConnectedNonOptionalInputs.push(t);if(r.connectedPoint&&(e.compilationString+="#endif\n"),e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${a}  = toLinearSpace(${a});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${a}  = toGammaSpace(${a});\n`,e.compilationString+="#endif\n",1===e.shaderLanguage&&(e.compilationString+="#if !defined(PREPASS)\r\n",e.compilationString+="fragmentOutputs.color = fragmentOutputsColor;\r\n",e.compilationString+="#endif\r\n"),this.useLogarithmicDepth||e.sharedData.nodeMaterial.useLogarithmicDepth){const t=n?"input.vFragmentDepth":"vFragmentDepth",i=n?"uniforms.":"",s=n?"fragmentOutputs.fragDepth":"gl_FragDepthEXT";e.compilationString+=`${s} = log2(${t}) * ${i}logarithmicDepthConstant * 0.5;\n`}return e.compilationString+="#if defined(PREPASS)\r\n",e.compilationString+=`${n?"fragmentOutputs.fragData0":"gl_FragData[0]"} = ${a};\r\n`,e.compilationString+="#endif\r\n",this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.convertToGammaSpace = ${this.convertToGammaSpace};\n`,e+=`${this._codeVariableName}.convertToLinearSpace = ${this.convertToLinearSpace};\n`,e+=`${this._codeVariableName}.useLogarithmicDepth = ${this.useLogarithmicDepth};\n`,e}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.useLogarithmicDepth=this.useLogarithmicDepth,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,this.useLogarithmicDepth=e.useLogarithmicDepth??!1}}(0,Et.Cg)([Nl("Use logarithmic depth",0,"PROPERTIES",{embedded:!0})],Vl.prototype,"useLogarithmicDepth",void 0),(0,Et.Cg)([Nl("Color space",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"No color space",value:Bl.NoColorSpace},{label:"Gamma",value:Bl.Gamma},{label:"Linear",value:Bl.Linear}]})],Vl.prototype,"colorSpace",null),(0,Ft.Y5)("BABYLON.FragmentOutputBlock",Vl),function(e){e[e.World=1]="World",e[e.View=2]="View",e[e.Projection=3]="Projection",e[e.ViewProjection=4]="ViewProjection",e[e.WorldView=5]="WorldView",e[e.WorldViewProjection=6]="WorldViewProjection",e[e.CameraPosition=7]="CameraPosition",e[e.FogColor=8]="FogColor",e[e.DeltaTime=9]="DeltaTime",e[e.CameraParameters=10]="CameraParameters",e[e.MaterialAlpha=11]="MaterialAlpha"}(Dl||(Dl={}));var Gl,zl=o(3086);!function(e){e[e.None=0]="None",e[e.Time=1]="Time",e[e.RealTime=2]="RealTime",e[e.MouseInfo=3]="MouseInfo"}(Gl||(Gl={}));const Hl={position2d:"position",particle_uv:"vUV",particle_color:"vColor",particle_texturemask:"textureMask",particle_positionw:"vPositionW"},Wl={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},Xl={particle_texturemask:!0},ql={normal:"NORMAL",tangent:"TANGENT",uv:"UV1",uv2:"UV2",uv3:"UV3",uv4:"UV4",uv5:"UV5",uv6:"UV6",uv7:"UV7",uv8:"UV8"};class Ql extends Ll{get type(){if(this._type===Al.AutoDetect){if(this.isUniform&&null!=this.value){if(!isNaN(this.value))return this._type=Al.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Al.Vector2,this._type;case"Vector3":return this._type=Al.Vector3,this._type;case"Vector4":return this._type=Al.Vector4,this._type;case"Color3":return this._type=Al.Color3,this._type;case"Color4":return this._type=Al.Color4,this._type;case"Matrix":return this._type=Al.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"splatIndex":return this._type=Al.Float,this._type;case"position":case"normal":case"particle_positionw":case"splatPosition":return this._type=Al.Vector3,this._type;case"uv":case"uv2":case"uv3":case"uv4":case"uv5":case"uv6":case"position2d":case"particle_uv":case"splatScale":return this._type=Al.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"matricesIndicesExtra":case"matricesWeightsExtra":case"world0":case"world1":case"world2":case"world3":case"tangent":return this._type=Al.Vector4,this._type;case"color":case"instanceColor":case"particle_color":case"particle_texturemask":case"splatColor":return this._type=Al.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case Dl.World:case Dl.WorldView:case Dl.WorldViewProjection:case Dl.View:case Dl.ViewProjection:case Dl.Projection:return this._type=Al.Matrix,this._type;case Dl.CameraPosition:return this._type=Al.Vector3,this._type;case Dl.FogColor:return this._type=Al.Color3,this._type;case Dl.DeltaTime:case Dl.MaterialAlpha:return this._type=Al.Float,this._type;case Dl.CameraParameters:return this._type=Al.Vector4,this._type}}return this._type}constructor(e,t=Cl.Vertex,i=Al.AutoDetect){super(e,t,!1),this._mode=3,this._animationType=Gl.None,this._prefix="",this.min=0,this.max=0,this.isBoolean=!1,this.matrixMode=0,this._systemValue=null,this.isConstant=!1,this.groupInInspector="",this.onValueChangedObservable=new Zi.cP,this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._type=i,this.setDefaultValue(),this.registerOutput("output",i)}validateBlockName(e){return!!this.isAttribute||super.validateBlockName(e)}get output(){return this._outputs[0]}setAsAttribute(e){return this._mode=1,e&&(this.name=e),this}setAsSystemValue(e){return this.systemValue=e,this}get value(){return this._storedValue}set value(e){this.type===Al.Float&&(this.isBoolean?e=e?1:0:this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e))),this._storedValue=e,this._mode=0,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(e){this._valueCallback=e,this._mode=0}get declarationVariableName(){return this._associatedVariableName}get associatedVariableName(){return this._prefix+this._associatedVariableName}set associatedVariableName(e){this._associatedVariableName=e}get animationType(){return this._animationType}set animationType(e){this._animationType=e}get isUndefined(){return 3===this._mode}get isUniform(){return 0===this._mode}set isUniform(e){this._mode=e?0:3,this.associatedVariableName=""}get isAttribute(){return 1===this._mode}set isAttribute(e){this._mode=e?1:3,this.associatedVariableName=""}get isVarying(){return 2===this._mode}set isVarying(e){this._mode=e?2:3,this.associatedVariableName=""}get isSystemValue(){return null!=this._systemValue}get systemValue(){return this._systemValue}set systemValue(e){this._mode=0,this.associatedVariableName="",this._systemValue=e}getClassName(){return"InputBlock"}animate(e){switch(this._animationType){case Gl.Time:this.type===Al.Float&&(this.value+=.01*e.getAnimationRatio());break;case Gl.RealTime:this.type===Al.Float&&(this.value=(Qa.j.Now-e.getEngine().startTime)/1e3);break;case Gl.MouseInfo:if(this.type===Al.Vector4){const t=e._inputManager._originMouseEvent;if(t){const e=t.offsetX,i=t.offsetY,s=1&t.buttons?1:0,r=2&t.buttons?1:0;this.value=new gt.IU(e,i,s,r)}else this.value=new gt.IU(0,0,0,0)}}}_emitDefine(e){return"!"===e[0]?`#ifndef ${e.substring(1)}\n`:`#ifdef ${e}\n`}initialize(){this.associatedVariableName=""}setDefaultValue(){switch(this.type){case Al.Float:this.value=0;break;case Al.Vector2:this.value=gt.I9.Zero();break;case Al.Vector3:this.value=gt.Pq.Zero();break;case Al.Vector4:this.value=gt.IU.Zero();break;case Al.Color3:this.value=zl.v9.White();break;case Al.Color4:this.value=new zl.ov(1,1,1,1);break;case Al.Matrix:this.value=gt.uq.Identity()}}_emitConstant(e){switch(this.type){case Al.Float:return`${e._emitFloat(this.value)}`;case Al.Vector2:return`vec2(${this.value.x}, ${this.value.y})`;case Al.Vector3:return`vec3(${this.value.x}, ${this.value.y}, ${this.value.z})`;case Al.Vector4:return`vec4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;case Al.Color3:return zl.IG.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&zl.IG.Color3[0].toGammaSpaceToRef(zl.IG.Color3[0],e.sharedData.scene.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&zl.IG.Color3[0].toLinearSpaceToRef(zl.IG.Color3[0],e.sharedData.scene.getEngine().useExactSrgbConversions),`vec3(${zl.IG.Color3[0].r}, ${zl.IG.Color3[0].g}, ${zl.IG.Color3[0].b})`;case Al.Color4:return zl.IG.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&zl.IG.Color4[0].toGammaSpaceToRef(zl.IG.Color4[0],e.sharedData.scene.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&zl.IG.Color4[0].toLinearSpaceToRef(zl.IG.Color4[0],e.sharedData.scene.getEngine().useExactSrgbConversions),`vec4(${zl.IG.Color4[0].r}, ${zl.IG.Color4[0].g}, ${zl.IG.Color4[0].b}, ${zl.IG.Color4[0].a})`}return""}get _noContextSwitch(){return Wl[this.name]}_emit(e,t){if(this.isUniform){if(this._associatedVariableName||(this._associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant){if(-1!==e.constants.indexOf(this.associatedVariableName))return;return e.constants.push(this.associatedVariableName),void(e._constantDeclaration+=e._declareOutput(this.output,!0)+` = ${this._emitConstant(e)};\n`)}if(-1!==e.uniforms.indexOf(this.associatedVariableName))return;e.uniforms.push(this.associatedVariableName),t&&(e._uniformDeclaration+=this._emitDefine(t));const i=e._getShaderType(this.type);1===e.shaderLanguage?(e._uniformDeclaration+=`uniform ${this._associatedVariableName}: ${i};\n`,this._prefix="uniforms."):e._uniformDeclaration+=`uniform ${i} ${this.associatedVariableName};\n`,t&&(e._uniformDeclaration+="#endif\n");const s=e.sharedData.hints;if(null!==this._systemValue&&void 0!==this._systemValue)switch(this._systemValue){case Dl.WorldView:s.needWorldViewMatrix=!0;break;case Dl.WorldViewProjection:s.needWorldViewProjectionMatrix=!0}else this._animationType!==Gl.None&&e.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=Hl[this.name]??this.name,this.target===Cl.Vertex&&e._vertexState)return void(Wl[this.name]?Xl[this.name]?(e._emitUniformFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="vertexInputs.")):e._emitVaryingFromString(this.declarationVariableName,this.type,t):this._emit(e._vertexState,t));const i=-1!==e.attributes.indexOf(this.declarationVariableName);if(i||e.attributes.push(this.declarationVariableName),Wl[this.name])Xl[this.name]?(i||e._emitUniformFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="uniforms.")):(i||e._emitVaryingFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="fragmentInputs."));else{if(t&&!i&&(e._attributeDeclaration+=this._emitDefine(t)),1===e.shaderLanguage){if(!i){const t=ql[this.name];t?(e._attributeDeclaration+=`#ifdef ${t}\n`,e._attributeDeclaration+=`attribute ${this.declarationVariableName}: ${e._getShaderType(this.type)};\n`,e._attributeDeclaration+="#else\n",e._attributeDeclaration+=`let ${this.declarationVariableName}: ${e._getShaderType(this.type)} = ${e._getShaderType(this.type)}(0.);\n`,e._attributeDeclaration+="#endif\n"):e._attributeDeclaration+=`attribute ${this.declarationVariableName}: ${e._getShaderType(this.type)};\n`}this._prefix="vertexInputs."}else if(!i){const t=ql[this.name];t?(e._attributeDeclaration+=`#ifdef ${t}\n`,e._attributeDeclaration+=`attribute ${e._getShaderType(this.type)} ${this.declarationVariableName};\n`,e._attributeDeclaration+="#else\n",e._attributeDeclaration+=`${e._getShaderType(this.type)} ${this.declarationVariableName} = ${e._getShaderType(this.type)}(0.);\n`,e._attributeDeclaration+="#endif\n"):e._attributeDeclaration+=`attribute ${e._getShaderType(this.type)} ${this.declarationVariableName};\n`}t&&!i&&(e._attributeDeclaration+="#endif\n")}}}_transmitWorld(e,t,i,s){if(!this._systemValue)return;const r=this._associatedVariableName;switch(this._systemValue){case Dl.World:e.setMatrix(r,t);break;case Dl.WorldView:e.setMatrix(r,i);break;case Dl.WorldViewProjection:e.setMatrix(r,s)}}_transmit(e,t,i){if(this.isAttribute)return;const s=this._associatedVariableName;if(this._systemValue){switch(this._systemValue){case Dl.World:case Dl.WorldView:case Dl.WorldViewProjection:return;case Dl.View:e.setMatrix(s,t.getViewMatrix());break;case Dl.Projection:e.setMatrix(s,t.getProjectionMatrix());break;case Dl.ViewProjection:e.setMatrix(s,t.getTransformMatrix());break;case Dl.CameraPosition:t.bindEyePosition(e,s,!0);break;case Dl.FogColor:e.setColor3(s,t.fogColor);break;case Dl.DeltaTime:e.setFloat(s,t.deltaTime/1e3);break;case Dl.CameraParameters:t.activeCamera&&e.setFloat4(s,t.getEngine().hasOriginBottomLeft?-1:1,t.activeCamera.minZ,t.activeCamera.maxZ,1/t.activeCamera.maxZ);break;case Dl.MaterialAlpha:e.setFloat(s,i.alpha)}return}const r=this._valueCallback?this._valueCallback():this._storedValue;if(null!==r)switch(this.type){case Al.Float:e.setFloat(s,r);break;case Al.Int:e.setInt(s,r);break;case Al.Color3:zl.IG.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&zl.IG.Color3[0].toGammaSpaceToRef(zl.IG.Color3[0],t.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&zl.IG.Color3[0].toLinearSpaceToRef(zl.IG.Color3[0],t.getEngine().useExactSrgbConversions),e.setColor3(s,zl.IG.Color3[0]);break;case Al.Color4:zl.IG.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&zl.IG.Color4[0].toGammaSpaceToRef(zl.IG.Color4[0],t.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&zl.IG.Color4[0].toLinearSpaceToRef(zl.IG.Color4[0],t.getEngine().useExactSrgbConversions),e.setDirectColor4(s,zl.IG.Color4[0]);break;case Al.Vector2:e.setVector2(s,r);break;case Al.Vector3:e.setVector3(s,r);break;case Al.Vector4:e.setVector4(s,r);break;case Al.Matrix:e.setMatrix(s,r)}}_buildBlock(e){super._buildBlock(e),(this.isUniform||this.isSystemValue)&&e.sharedData.inputBlocks.push(this),this._emit(e)}_dumpPropertiesCode(){const e=this._codeVariableName;if(this.isAttribute)return super._dumpPropertiesCode()+`${e}.setAsAttribute("${this.name}");\n`;if(this.isSystemValue)return super._dumpPropertiesCode()+`${e}.setAsSystemValue(BABYLON.NodeMaterialSystemValues.${Dl[this._systemValue]});\n`;if(this.isUniform){const t=[];let i="";switch(this.type){case Al.Float:i=`${this.value}`;break;case Al.Vector2:i=`new BABYLON.Vector2(${this.value.x}, ${this.value.y})`;break;case Al.Vector3:i=`new BABYLON.Vector3(${this.value.x}, ${this.value.y}, ${this.value.z})`;break;case Al.Vector4:i=`new BABYLON.Vector4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;break;case Al.Color3:i=`new BABYLON.Color3(${this.value.r}, ${this.value.g}, ${this.value.b})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case Al.Color4:i=`new BABYLON.Color4(${this.value.r}, ${this.value.g}, ${this.value.b}, ${this.value.a})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case Al.Matrix:i=`BABYLON.Matrix.FromArray([${this.value.m}])`}return t.push(`${e}.value = ${i}`),this.type===Al.Float&&t.push(`${e}.min = ${this.min}`,`${e}.max = ${this.max}`,`${e}.isBoolean = ${this.isBoolean}`,`${e}.matrixMode = ${this.matrixMode}`,`${e}.animationType = BABYLON.AnimatedInputBlockTypes.${Gl[this.animationType]}`),t.push(`${e}.isConstant = ${this.isConstant}`),t.push(""),super._dumpPropertiesCode()+t.join(";\n")}return super._dumpPropertiesCode()}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const e=super.serialize();return e.type=this.type,e.mode=this._mode,e.systemValue=this._systemValue,e.animationType=this._animationType,e.min=this.min,e.max=this.max,e.isBoolean=this.isBoolean,e.matrixMode=this.matrixMode,e.isConstant=this.isConstant,e.groupInInspector=this.groupInInspector,e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,null!=this._storedValue&&0===this._mode&&(this._storedValue.asArray?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.asArray()):(e.valueType="number",e.value=this._storedValue)),e}_deserialize(e,t,i){if(this._mode=e.mode,super._deserialize(e,t,i),this._type=e.type,this._systemValue=e.systemValue||e.wellKnownValue,this._animationType=e.animationType,this.min=e.min||0,this.max=e.max||0,this.isBoolean=!!e.isBoolean,this.matrixMode=e.matrixMode||0,this.isConstant=!!e.isConstant,this.groupInInspector=e.groupInInspector||"",this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,"tangent"===e.name&&1===e.mode&&e.type===Al.Vector3&&(this._type=Al.Vector4),e.valueType)if("number"===e.valueType)this._storedValue=e.value;else{const t=(0,Ft.n9)(e.valueType);t&&(this._storedValue=t.FromArray(e.value))}}}(0,Ft.Y5)("BABYLON.InputBlock",Ql);class Kl extends Ll{constructor(e){super(e,Cl.VertexAndFragment),this._samplerName="textureSampler",this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._isUnique=!1,this.registerInput("uv",Al.AutoDetect,!1,Cl.VertexAndFragment),this.registerOutput("rgba",Al.Color4,Cl.Neutral),this.registerOutput("rgb",Al.Color3,Cl.Neutral),this.registerOutput("r",Al.Float,Cl.Neutral),this.registerOutput("g",Al.Float,Cl.Neutral),this.registerOutput("b",Al.Float,Cl.Neutral),this.registerOutput("a",Al.Float,Cl.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Al.Vector2|Al.Vector3|Al.Vector4),this._inputs[0]._prioritizeVertex=!1}getClassName(){return"CurrentScreenBlock"}get uv(){return this._inputs[0]}get rgba(){return this._outputs[0]}get rgb(){return this._outputs[1]}get r(){return this._outputs[2]}get g(){return this._outputs[3]}get b(){return this._outputs[4]}get a(){return this._outputs[5]}initialize(e){e._excludeVariableName(this._samplerName)}get target(){return this.uv.isConnected?this.uv.sourceBlock.isInput?Cl.VertexAndFragment:Cl.Fragment:Cl.VertexAndFragment}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}_injectVertexCode(e){const t=this.uv;if(t.connectedPoint.ownerBlock.isInput&&(t.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(t.associatedVariableName,Al.Vector2)),this._mainUVName="vMain"+t.associatedVariableName,e._emitVaryingFromString(this._mainUVName,Al.Vector2),e.compilationString+=`${this._mainUVName} = ${t.associatedVariableName}.xy;\n`,this._outputs.some((e=>e.isConnectedInVertexShader))){this._writeTextureRead(e,!0);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name,!0)}}_writeTextureRead(e,t=!1){const i=this.uv;if(t){if(e.target===Cl.Fragment)return;const t=0===e.shaderLanguage?`texture2D(${this._samplerName},`:`textureSampleLevel(${this._samplerName}, ${this._samplerName+"Sampler"},`,s=0===e.shaderLanguage?"":", 0";return void(e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,Al.Vector4)} = ${t} ${i.associatedVariableName}${s});\n`)}const s=0===e.shaderLanguage?`texture2D(${this._samplerName},`:`textureSample(${this._samplerName}, ${this._samplerName+"Sampler"},`;this.uv.ownerBlock.target!==Cl.Fragment?e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,Al.Vector4)} = ${s} ${this._mainUVName});\n`:e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,Al.Vector4)} = ${s} ${i.associatedVariableName});\n`}_writeOutput(e,t,i,s=!1){if(s){if(e.target===Cl.Fragment)return;e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`}else this.uv.ownerBlock.target!==Cl.Fragment?(e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`,e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n"):e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`}_buildBlock(e){if(super._buildBlock(e),this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e.sharedData.blockingBlocks.indexOf(this)<0&&e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.indexOf(this)<0&&e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.indexOf(this)<0&&e.sharedData.blocksWithDefines.push(this),e.target!==Cl.Fragment)return e._emit2DSampler(this._samplerName),void this._injectVertexCode(e);if(!this._outputs.some((e=>e.isConnectedInFragmentShader)))return;e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),this._writeTextureRead(e);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name);return this}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=Dt.g.Parse(e.texture,t,i))}}(0,Ft.Y5)("BABYLON.CurrentScreenBlock",Kl);class Yl extends Ll{constructor(e){super(e,Cl.Fragment),this._samplerName="diffuseSampler",this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._isUnique=!1,this.registerInput("uv",Al.AutoDetect,!1,Cl.VertexAndFragment),this.registerOutput("rgba",Al.Color4,Cl.Neutral),this.registerOutput("rgb",Al.Color3,Cl.Neutral),this.registerOutput("r",Al.Float,Cl.Neutral),this.registerOutput("g",Al.Float,Cl.Neutral),this.registerOutput("b",Al.Float,Cl.Neutral),this.registerOutput("a",Al.Float,Cl.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Al.Vector2|Al.Vector3|Al.Vector4)}getClassName(){return"ParticleTextureBlock"}get uv(){return this._inputs[0]}get rgba(){return this._outputs[0]}get rgb(){return this._outputs[1]}get r(){return this._outputs[2]}get g(){return this._outputs[3]}get b(){return this._outputs[4]}get a(){return this._outputs[5]}initialize(e){e._excludeVariableName("diffuseSampler")}autoConfigure(e,t=()=>!0){if(!this.uv.isConnected){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"particle_uv"===e.name&&t(e)));i||(i=new Ql("uv"),i.setAsAttribute("particle_uv")),i.output.connectTo(this.uv)}}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}_writeOutput(e,t,i){e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`,e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n"}_buildBlock(e){if(super._buildBlock(e),e.target===Cl.Vertex)return;this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,Al.Vector4)} = ${e._generateTextureSample(this.uv.associatedVariableName,this._samplerName)};\n`;for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name);return this}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=Dt.g.Parse(e.texture,t,i))}}(0,Ft.Y5)("BABYLON.ParticleTextureBlock",Yl);class jl extends Ll{constructor(e){super(e,Cl.Fragment),this._isUnique=!0,this.registerInput("color",Al.Color4,!1,Cl.Fragment),this.registerOutput("rampColor",Al.Color4,Cl.Fragment)}getClassName(){return"ParticleRampGradientBlock"}get color(){return this._inputs[0]}get rampColor(){return this._outputs[0]}initialize(e){e._excludeVariableName("remapRanges"),e._excludeVariableName("rampSampler"),e._excludeVariableName("baseColor"),e._excludeVariableName("alpha"),e._excludeVariableName("remappedColorIndex"),e._excludeVariableName("rampColor")}_buildBlock(e){if(super._buildBlock(e),e.target===Cl.Vertex)return;e._emit2DSampler("rampSampler","RAMPGRADIENT"),e._emitVaryingFromString("remapRanges",Al.Vector4,"RAMPGRADIENT");const t=0===e.shaderLanguage?"":"fragmentInputs.";return e.compilationString+=`\n            #ifdef RAMPGRADIENT\n                ${e._declareLocalVar("baseColor",Al.Vector4)} = ${this.color.associatedVariableName};\n                ${e._declareLocalVar("alpha",Al.Float)} = ${this.color.associatedVariableName}.a;\n\n                ${e._declareLocalVar("remappedColorIndex",Al.Float)} = clamp((alpha - ${t}remapRanges.x) / ${t}remapRanges.y, 0.0, 1.0);\n\n                ${e._declareLocalVar("rampColor",Al.Vector4)} = ${e._generateTextureSample("vec2(1.0 - remappedColorIndex, 0.)","rampSampler")};\n\n                // Remapped alpha\n                ${e._declareOutput(this.rampColor)} = vec4${e.fSuffix}(baseColor.rgb * rampColor.rgb, clamp((alpha * rampColor.a - ${t}remapRanges.z) / ${t}remapRanges.w, 0.0, 1.0));\n            #else\n                ${e._declareOutput(this.rampColor)} = ${this.color.associatedVariableName};\n            #endif\n        `,this}}(0,Ft.Y5)("BABYLON.ParticleRampGradientBlock",jl);class Zl extends Ll{constructor(e){super(e,Cl.Fragment),this._isUnique=!0,this.registerInput("color",Al.Color4,!1,Cl.Fragment),this.registerInput("alphaTexture",Al.Float,!1,Cl.Fragment),this.registerInput("alphaColor",Al.Float,!1,Cl.Fragment),this.registerOutput("blendColor",Al.Color4,Cl.Fragment)}getClassName(){return"ParticleBlendMultiplyBlock"}get color(){return this._inputs[0]}get alphaTexture(){return this._inputs[1]}get alphaColor(){return this._inputs[2]}get blendColor(){return this._outputs[0]}initialize(e){e._excludeVariableName("sourceAlpha")}_buildBlock(e){if(super._buildBlock(e),e.target!==Cl.Vertex)return e.compilationString+=`\n            #ifdef BLENDMULTIPLYMODE\n                ${e._declareOutput(this.blendColor)};\n                ${e._declareLocalVar("sourceAlpha",Al.Float)}  = ${this.alphaColor.associatedVariableName} * ${this.alphaTexture.associatedVariableName};\n                ${this.blendColor.associatedVariableName} = vec4${e.fSuffix}(${this.color.associatedVariableName}.rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha), ${this.color.associatedVariableName}.a);\n            #else\n                ${e._declareOutput(this.blendColor)} = ${this.color.associatedVariableName};\n            #endif\n        `,this}}(0,Ft.Y5)("BABYLON.ParticleBlendMultiplyBlock",Zl);class $l extends Ll{constructor(e){super(e,Cl.Neutral),this.xSwizzle="x",this.ySwizzle="y",this.zSwizzle="z",this.wSwizzle="w",this.registerInput("xyzw ",Al.Vector4,!0),this.registerInput("xyz ",Al.Vector3,!0),this.registerInput("xy ",Al.Vector2,!0),this.registerInput("zw ",Al.Vector2,!0),this.registerInput("x",Al.Float,!0),this.registerInput("y",Al.Float,!0),this.registerInput("z",Al.Float,!0),this.registerInput("w",Al.Float,!0),this.registerOutput("xyzw",Al.Vector4),this.registerOutput("xyz",Al.Vector3),this.registerOutput("xy",Al.Vector2),this.registerOutput("zw",Al.Vector2)}getClassName(){return"VectorMergerBlock"}get xyzwIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get x(){return this._inputs[4]}get y(){return this._inputs[5]}get z(){return this._inputs[6]}get w(){return this._inputs[7]}get xyzw(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xy(){return this.xyOut}get xyz(){return this.xyzOut}_inputRename(e){return"xyzw "===e?"xyzwIn":"xyz "===e?"xyzIn":"xy "===e?"xyIn":"zw "===e?"zwIn":e}_buildSwizzle(e){return"."+(this.xSwizzle+this.ySwizzle+this.zSwizzle+this.wSwizzle).substring(0,e)}_buildBlock(e){super._buildBlock(e);const t=this.x,i=this.y,s=this.z,r=this.w,n=this.xyIn,o=this.zwIn,a=this.xyzIn,h=this.xyzwIn,l=this._outputs[0],c=this._outputs[1],u=this._outputs[2],d=this._outputs[3],_=e._getShaderType(Al.Vector4),p=e._getShaderType(Al.Vector3),g=e._getShaderType(Al.Vector2);return h.isConnected?(l.hasEndpoints&&(e.compilationString+=e._declareOutput(l)+` = ${h.associatedVariableName}${this._buildSwizzle(4)};\n`),c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${h.associatedVariableName}${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${h.associatedVariableName}${this._buildSwizzle(2)};\n`)):a.isConnected?(l.hasEndpoints&&(e.compilationString+=e._declareOutput(l)+` = ${_}(${a.associatedVariableName}, ${r.isConnected?this._writeVariable(r):"0.0"})${this._buildSwizzle(4)};\n`),c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${a.associatedVariableName}${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${a.associatedVariableName}${this._buildSwizzle(2)};\n`)):n.isConnected?(l.hasEndpoints&&(o.isConnected?e.compilationString+=e._declareOutput(l)+` = ${_}(${n.associatedVariableName}, ${o.associatedVariableName})${this._buildSwizzle(4)};\n`:e.compilationString+=e._declareOutput(l)+` = ${_}(${n.associatedVariableName}, ${s.isConnected?this._writeVariable(s):"0.0"}, ${r.isConnected?this._writeVariable(r):"0.0"})${this._buildSwizzle(4)};\n`),c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${p}(${n.associatedVariableName}, ${s.isConnected?this._writeVariable(s):"0.0"})${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${n.associatedVariableName}${this._buildSwizzle(2)};\n`),d.hasEndpoints&&(o.isConnected?e.compilationString+=e._declareOutput(d)+` = ${o.associatedVariableName}${this._buildSwizzle(2)};\n`:e.compilationString+=e._declareOutput(d)+` = ${g}(${s.isConnected?this._writeVariable(s):"0.0"}, ${r.isConnected?this._writeVariable(r):"0.0"})${this._buildSwizzle(2)};\n`)):(l.hasEndpoints&&(o.isConnected?e.compilationString+=e._declareOutput(l)+` = ${_}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${o.associatedVariableName})${this._buildSwizzle(4)};\n`:e.compilationString+=e._declareOutput(l)+` = ${_}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${s.isConnected?this._writeVariable(s):"0.0"}, ${r.isConnected?this._writeVariable(r):"0.0"})${this._buildSwizzle(4)};\n`),c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${p}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${s.isConnected?this._writeVariable(s):"0.0"})${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${g}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"})${this._buildSwizzle(2)};\n`),d.hasEndpoints&&(o.isConnected?e.compilationString+=e._declareOutput(d)+` = ${o.associatedVariableName}${this._buildSwizzle(2)};\n`:e.compilationString+=e._declareOutput(d)+` = ${g}(${s.isConnected?this._writeVariable(s):"0.0"}, ${r.isConnected?this._writeVariable(r):"0.0"})${this._buildSwizzle(2)};\n`)),this}serialize(){const e=super.serialize();return e.xSwizzle=this.xSwizzle,e.ySwizzle=this.ySwizzle,e.zSwizzle=this.zSwizzle,e.wSwizzle=this.wSwizzle,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.xSwizzle=e.xSwizzle??"x",this.ySwizzle=e.ySwizzle??"y",this.zSwizzle=e.zSwizzle??"z",this.wSwizzle=e.wSwizzle??"w"}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.xSwizzle = "${this.xSwizzle}";\n`,e+=`${this._codeVariableName}.ySwizzle = "${this.ySwizzle}";\n`,e+=`${this._codeVariableName}.zSwizzle = "${this.zSwizzle}";\n`,e+=`${this._codeVariableName}.wSwizzle = "${this.wSwizzle}";\n`,e}}(0,Ft.Y5)("BABYLON.VectorMergerBlock",$l);class Jl extends Ll{constructor(e){super(e,Cl.Neutral),this.sourceRange=new gt.I9(-1,1),this.targetRange=new gt.I9(0,1),this.registerInput("input",Al.AutoDetect),this.registerInput("sourceMin",Al.Float,!0),this.registerInput("sourceMax",Al.Float,!0),this.registerInput("targetMin",Al.Float,!0),this.registerInput("targetMax",Al.Float,!0),this.registerOutput("output",Al.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"RemapBlock"}get input(){return this._inputs[0]}get sourceMin(){return this._inputs[1]}get sourceMax(){return this._inputs[2]}get targetMin(){return this._inputs[3]}get targetMax(){return this._inputs[4]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),s=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),r=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),n=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return e.compilationString+=e._declareOutput(t)+` = ${r} + (${this._inputs[0].associatedVariableName} - ${i}) * (${n} - ${r}) / (${s} - ${i});\n`,this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.sourceRange = new BABYLON.Vector2(${this.sourceRange.x}, ${this.sourceRange.y});\n`;return e+=`${this._codeVariableName}.targetRange = new BABYLON.Vector2(${this.targetRange.x}, ${this.targetRange.y});\n`,e}serialize(){const e=super.serialize();return e.sourceRange=this.sourceRange.asArray(),e.targetRange=this.targetRange.asArray(),e}_deserialize(e,t,i){super._deserialize(e,t,i),this.sourceRange=gt.I9.FromArray(e.sourceRange),this.targetRange=gt.I9.FromArray(e.targetRange)}}(0,Et.Cg)([Nl("From",3)],Jl.prototype,"sourceRange",void 0),(0,Et.Cg)([Nl("To",3)],Jl.prototype,"targetRange",void 0),(0,Ft.Y5)("BABYLON.RemapBlock",Jl);class ec extends Ll{constructor(e){super(e,Cl.Neutral),this.registerInput("left",Al.AutoDetect),this.registerInput("right",Al.AutoDetect),this.registerOutput("output",Al.BasedOnInput),this.output._typeConnectionSource=this.left,this._linkConnectionTypes(0,1,!0),this.left.acceptedConnectionPointTypes.push(Al.Float),this.right.acceptedConnectionPointTypes.push(Al.Float),this._connectionObservers=[this.left.onTypeChangedObservable.add((()=>this._updateInputOutputTypes())),this.right.onTypeChangedObservable.add((()=>this._updateInputOutputTypes()))]}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Al.Int||this.left.type===Al.Float&&this.right.type!==Al.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[e,t]of[[this.left,this.right],[this.right,this.left]])e.acceptedConnectionPointTypes=[Al.Int,Al.Float],t.isConnected&&(e.acceptedConnectionPointTypes.push(t.type),t.type!==Al.Int&&t.type!==Al.Float||e.acceptedConnectionPointTypes.push(Al.Vector2,Al.Vector3,Al.Vector4,Al.Color3,Al.Color4,Al.Matrix))}dispose(){super.dispose(),this._connectionObservers.forEach((e=>e.remove())),this._connectionObservers.length=0}}class tc extends ec{constructor(e){super(e)}getClassName(){return"MultiplyBlock"}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} * ${this.right.associatedVariableName};\n`,this}}var ic;(0,Ft.Y5)("BABYLON.MultiplyBlock",tc),function(e){e[e.Material=0]="Material",e[e.PostProcess=1]="PostProcess",e[e.Particle=2]="Particle",e[e.ProceduralTexture=3]="ProceduralTexture",e[e.GaussianSplatting=4]="GaussianSplatting"}(ic||(ic={}));class sc extends wt.M{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}o(1386);class rc{get noiseTexture(){return this._noiseTexture}set noiseTexture(e){this._noiseTexture!==e&&(this._noiseTexture=e,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(e){this._isAnimationSheetEnabled!=e&&(this._isAnimationSheetEnabled=e,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported}getScene(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:gt.Pq.Zero()}set direction1(e){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=e)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:gt.Pq.Zero()}set direction2(e){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=e)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:gt.Pq.Zero()}set minEmitBox(e){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=e)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:gt.Pq.Zero()}set maxEmitBox(e){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=e)}get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(e){this._isBillboardBased!==e&&(this._isBillboardBased=e,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e)}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(!e&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=e)}_reset(){}_removeGradientAndTexture(e,t,i){if(!t)return this;let s=0;for(const i of t){if(i.gradient===e){t.splice(s,1);break}s++}return i&&i.dispose(),this}constructor(e){this.animations=[],this.renderingGroupId=0,this.emitter=gt.Pq.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new gt.Pq(10,10,10),this.onAnimationEnd=null,this.blendMode=rc.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new gt.I9(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new gt.Pq(0,0,0),this._useLogarithmicDepth=!1,this.gravity=gt.Pq.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new bt.ov(1,1,1,1),this.color2=new bt.ov(1,1,1,1),this.colorDead=new bt.ov(0,0,0,1),this.textureMask=new bt.ov(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new sc,this.id=e,this.name=e}createPointEmitter(e,t){throw new Error("Method not implemented.")}createHemisphericEmitter(e=1,t=1){throw new Error("Method not implemented.")}createSphereEmitter(e=1,t=1){throw new Error("Method not implemented.")}createDirectedSphereEmitter(e=1,t=new gt.Pq(0,1,0),i=new gt.Pq(0,1,0)){throw new Error("Method not implemented.")}createCylinderEmitter(e=1,t=1,i=1,s=0){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(e=1,t=1,i=1,s=new gt.Pq(0,1,0),r=new gt.Pq(0,1,0)){throw new Error("Method not implemented.")}createConeEmitter(e=1,t=Math.PI/4){throw new Error("Method not implemented.")}createDirectedConeEmitter(e=1,t=Math.PI/4,i=new gt.Pq(0,1,0),s=new gt.Pq(0,1,0)){throw new Error("Method not implemented.")}createBoxEmitter(e,t,i,s){throw new Error("Method not implemented.")}}rc.BLENDMODE_ONEONE=0,rc.BLENDMODE_STANDARD=1,rc.BLENDMODE_ADD=2,rc.BLENDMODE_MULTIPLY=3,rc.BLENDMODE_MULTIPLYADD=4,(0,Ft.Y5)("BABYLON.BaseParticleSystem",rc);class nc extends Ll{constructor(e){super(e,Cl.Neutral),this.registerInput("rgba",Al.Color4,!0),this.registerInput("rgb ",Al.Color3,!0),this.registerOutput("rgb",Al.Color3),this.registerOutput("r",Al.Float),this.registerOutput("g",Al.Float),this.registerOutput("b",Al.Float),this.registerOutput("a",Al.Float),this.inputsAreExclusive=!0}getClassName(){return"ColorSplitterBlock"}get rgba(){return this._inputs[0]}get rgbIn(){return this._inputs[1]}get rgbOut(){return this._outputs[0]}get r(){return this._outputs[1]}get g(){return this._outputs[2]}get b(){return this._outputs[3]}get a(){return this._outputs[4]}_inputRename(e){return"rgb "===e?"rgbIn":e}_outputRename(e){return"rgb"===e?"rgbOut":e}_buildBlock(e){super._buildBlock(e);const t=this.rgba.isConnected?this.rgba:this.rgbIn;if(!t.isConnected)return;const i=this._outputs[0],s=this._outputs[1],r=this._outputs[2],n=this._outputs[3],o=this._outputs[4];return i.hasEndpoints&&(e.compilationString+=e._declareOutput(i)+` = ${t.associatedVariableName}.rgb;\n`),s.hasEndpoints&&(e.compilationString+=e._declareOutput(s)+` = ${t.associatedVariableName}.r;\n`),r.hasEndpoints&&(e.compilationString+=e._declareOutput(r)+` = ${t.associatedVariableName}.g;\n`),n.hasEndpoints&&(e.compilationString+=e._declareOutput(n)+` = ${t.associatedVariableName}.b;\n`),o.hasEndpoints&&(e.compilationString+=e._declareOutput(o)+` = ${t.associatedVariableName}.a;\n`),this}}(0,Ft.Y5)("BABYLON.ColorSplitterBlock",nc);var oc,ac=o(5098);class hc{constructor(e){this.name=hs.v.NAME_PROCEDURALTEXTURE,this.scene=e}register(){this.scene._beforeClearStage.registerStep(hs.v.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)}rebuild(){}dispose(){}_beforeClear(){if(this.scene.proceduralTexturesEnabled){$i.S0.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(let e=0;e<this.scene.proceduralTextures.length;e++){const t=this.scene.proceduralTextures[e];t._shouldRender()&&t.render()}$i.S0.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}}}class lc extends Dt.g{get shaderLanguage(){return this._shaderLanguage}constructor(e,t,i,s,r=null,n=!0,o=!1,a=0){super(null,s,!n),this.isEnabled=!0,this.autoClear=!0,this.onGeneratedObservable=new Zi.cP,this.onBeforeGenerationObservable=new Zi.cP,this.nodeMaterialSource=null,this.defines="",this._textures={},this._currentRefreshId=-1,this._frameId=-1,this._refreshRate=1,this._vertexBuffers={},this._uniforms=new Array,this._samplers=new Array,this._floats={},this._ints={},this._floatsArrays={},this._colors3={},this._colors4={},this._vectors2={},this._vectors3={},this._vectors4={},this._matrices={},this._fallbackTextureUsed=!1,this._cachedDefines=null,this._contentUpdateId=-1,this._rtWrapper=null,null===r||r instanceof Dt.g?(this._options={},this._fallbackTexture=r):(this._options=r,this._fallbackTexture=r.fallbackTexture??null),this._shaderLanguage=this._options.shaderLanguage??0;let h=(s=this.getScene()||os.q.LastCreatedScene)._getComponent(hs.v.NAME_PROCEDURALTEXTURE);h||(h=new hc(s),s._addComponent(h)),s.proceduralTextures.push(this),this._fullEngine=s.getEngine(),this.name=e,this.isRenderTarget=!0,this._size=t,this._textureType=a,this._generateMipMaps=n,this._drawWrapper=new cs.E(this._fullEngine),this.setFragment(i);const l=this._createRtWrapper(o,t,n,a);this._texture=l.texture;const c=[];c.push(1,1),c.push(-1,1),c.push(-1,-1),c.push(1,-1),this._vertexBuffers[Mt.R.PositionKind]=new Mt.R(this._fullEngine,c,Mt.R.PositionKind,!1,!1,2),this._createIndexBuffer()}_createRtWrapper(e,t,i,s){return e?(this._rtWrapper=this._fullEngine.createRenderTargetCubeTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:s,...this._options}),this.setFloat("face",0)):(this._rtWrapper=this._fullEngine.createRenderTargetTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:s,...this._options}),this._rtWrapper.is3D&&(this.setFloat("layer",0),this.setInt("layerNum",0))),this._rtWrapper}getEffect(){return this._drawWrapper.effect}_setEffect(e){this._drawWrapper.effect=e}getContent(){return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData?this._contentData.then((e=>{this._contentData=this.readPixels(0,0,e),this._contentUpdateId=this._frameId})):(this._contentData=this.readPixels(0,0),this._contentUpdateId=this._frameId)),this._contentData}_createIndexBuffer(){const e=this._fullEngine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)}_rebuild(){const e=this._vertexBuffers[Mt.R.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===ba.$.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=ba.$.REFRESHRATE_RENDER_ONCE)}reset(){this._drawWrapper.effect?.dispose(),this._drawWrapper.effect=null,this._cachedDefines=null}_getDefines(){return this.defines}executeWhenReady(e){if(this.isReady())return void e(this);const t=this.getEffect();t&&t.executeWhenCompiled((()=>{e(this)}))}isReady(){const e=this._fullEngine;if(this.nodeMaterialSource)return this._drawWrapper.effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;if(!this._texture)return!1;const t=this._getDefines();if(this._drawWrapper.effect&&t===this._cachedDefines&&this._drawWrapper.effect.isReady())return!0;const i={vertex:"procedural",fragmentElement:this._fragment.fragmentElement,fragmentSource:this._fragment.fragmentSource,fragment:"string"==typeof this._fragment?this._fragment:void 0};return this._cachedDefines!==t&&(this._cachedDefines=t,this._drawWrapper.effect=e.createEffect(i,[Mt.R.PositionKind],this._uniforms,this._samplers,t,void 0,void 0,(()=>{this._rtWrapper?.dispose(),this._rtWrapper=this._texture=null,this._fallbackTexture&&(this._texture=this._fallbackTexture._texture,this._texture&&this._texture.incrementReferences()),this._fallbackTextureUsed=!0}),void 0,this._shaderLanguage,(async()=>{this._options.extraInitializationsAsync?1===this.shaderLanguage?await Promise.all([o.e(6935).then(o.bind(o,6935)),this._options.extraInitializationsAsync()]):await Promise.all([o.e(2250).then(o.bind(o,9869)),this._options.extraInitializationsAsync()]):1===this.shaderLanguage?await o.e(6935).then(o.bind(o,6935)):await o.e(2250).then(o.bind(o,9869))}))),this._drawWrapper.effect.isReady()}resetRefreshCounter(){this._currentRefreshId=-1}setFragment(e){this._fragment=e}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}_shouldRender(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)}getRenderSize(){return this._size}resize(e,t){if(this._fallbackTextureUsed||!this._rtWrapper||!this._texture)return;const i=this._texture.isCube;this._rtWrapper.dispose();const s=this._createRtWrapper(i,e,t,this._textureType);this._texture=s.texture,this._size=e,this._generateMipMaps=t}_checkUniform(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)}setTexture(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}render(e){const t=this.getScene();if(!t)return;const i=this._fullEngine;if(i.enableEffect(this._drawWrapper),this.onBeforeGenerationObservable.notifyObservers(this),i.setState(!1),!this.nodeMaterialSource){for(const e in this._textures)this._drawWrapper.effect.setTexture(e,this._textures[e]);for(const e in this._ints)this._drawWrapper.effect.setInt(e,this._ints[e]);for(const e in this._floats)this._drawWrapper.effect.setFloat(e,this._floats[e]);for(const e in this._floatsArrays)this._drawWrapper.effect.setArray(e,this._floatsArrays[e]);for(const e in this._colors3)this._drawWrapper.effect.setColor3(e,this._colors3[e]);for(const e in this._colors4){const t=this._colors4[e];this._drawWrapper.effect.setFloat4(e,t.r,t.g,t.b,t.a)}for(const e in this._vectors2)this._drawWrapper.effect.setVector2(e,this._vectors2[e]);for(const e in this._vectors3)this._drawWrapper.effect.setVector3(e,this._vectors3[e]);for(const e in this._vectors4)this._drawWrapper.effect.setVector4(e,this._vectors4[e]);for(const e in this._matrices)this._drawWrapper.effect.setMatrix(e,this._matrices[e])}if(!this._texture||!this._rtWrapper)return;i._debugPushGroup?.(`procedural texture generation for ${this.name}`,1);const s=i.currentViewport;if(this.isCube)for(let e=0;e<6;e++)i.bindFramebuffer(this._rtWrapper,e,void 0,void 0,!0),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._drawWrapper.effect.setFloat("face",e),this.autoClear&&i.clear(t.clearColor,!0,!1,!1),i.drawElementsType(as.i.TriangleFillMode,0,6),i.unBindFramebuffer(this._rtWrapper,!0);else{let e=1;this._rtWrapper.is3D?e=this._rtWrapper.depth:this._rtWrapper.is2DArray&&(e=this._rtWrapper.layers);for(let s=0;s<e;s++){if(i.bindFramebuffer(this._rtWrapper,0,void 0,void 0,!0,0,s),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._rtWrapper.is3D||this._rtWrapper.is2DArray){this._drawWrapper.effect?.setFloat("layer",1!==e?s/(e-1):0),this._drawWrapper.effect?.setInt("layerNum",s);for(const e in this._textures)this._drawWrapper.effect.setTexture(e,this._textures[e])}this.autoClear&&i.clear(t.clearColor,!0,!1,!1),i.drawElementsType(as.i.TriangleFillMode,0,6),i.unBindFramebuffer(this._rtWrapper,!this._generateMipMaps)}}s&&i.setViewport(s),this.isCube&&i.generateMipMapsForCubemap(this._texture,!0),i._debugPopGroup?.(1),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}clone(){const e=this.getSize(),t=new lc(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t}dispose(){const e=this.getScene();if(!e)return;const t=e.proceduralTextures.indexOf(this);t>=0&&e.proceduralTextures.splice(t,1);const i=this._vertexBuffers[Mt.R.PositionKind];i&&(i.dispose(),this._vertexBuffers[Mt.R.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),super.dispose()}}(0,Et.Cg)([(0,Rt.lK)()],lc.prototype,"isEnabled",void 0),(0,Et.Cg)([(0,Rt.lK)()],lc.prototype,"autoClear",void 0),(0,Et.Cg)([(0,Rt.lK)()],lc.prototype,"_generateMipMaps",void 0),(0,Et.Cg)([(0,Rt.lK)()],lc.prototype,"_size",void 0),(0,Et.Cg)([(0,Rt.lK)()],lc.prototype,"refreshRate",null),(0,Ft.Y5)("BABYLON.ProceduralTexture",lc),function(e){e[e.Cos=0]="Cos",e[e.Sin=1]="Sin",e[e.Abs=2]="Abs",e[e.Exp=3]="Exp",e[e.Exp2=4]="Exp2",e[e.Round=5]="Round",e[e.Floor=6]="Floor",e[e.Ceiling=7]="Ceiling",e[e.Sqrt=8]="Sqrt",e[e.Log=9]="Log",e[e.Tan=10]="Tan",e[e.ArcTan=11]="ArcTan",e[e.ArcCos=12]="ArcCos",e[e.ArcSin=13]="ArcSin",e[e.Fract=14]="Fract",e[e.Sign=15]="Sign",e[e.Radians=16]="Radians",e[e.Degrees=17]="Degrees",e[e.Set=18]="Set"}(oc||(oc={}));class cc extends Ll{constructor(e){super(e,Cl.Neutral),this.operation=oc.Cos,this.registerInput("input",Al.AutoDetect),this.registerOutput("output",Al.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"TrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];let i="";switch(this.operation){case oc.Cos:i="cos";break;case oc.Sin:i="sin";break;case oc.Abs:i="abs";break;case oc.Exp:i="exp";break;case oc.Exp2:i="exp2";break;case oc.Round:i="round";break;case oc.Floor:i="floor";break;case oc.Ceiling:i="ceil";break;case oc.Sqrt:i="sqrt";break;case oc.Log:i="log";break;case oc.Tan:i="tan";break;case oc.ArcTan:i="atan";break;case oc.ArcCos:i="acos";break;case oc.ArcSin:i="asin";break;case oc.Fract:i="fract";break;case oc.Sign:i="sign";break;case oc.Radians:i="radians";break;case oc.Degrees:i="degrees";break;case oc.Set:i=""}return e.compilationString+=e._declareOutput(t)+` = ${i}(${this.input.associatedVariableName});\n`,this}serialize(){const e=super.serialize();return e.operation=this.operation,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.operation=e.operation}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.operation = BABYLON.TrigonometryBlockOperations.${oc[this.operation]};\n`}}(0,Et.Cg)([Nl("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Cos",value:oc.Cos},{label:"Sin",value:oc.Sin},{label:"Abs",value:oc.Abs},{label:"Exp",value:oc.Exp},{label:"Exp2",value:oc.Exp2},{label:"Round",value:oc.Round},{label:"Floor",value:oc.Floor},{label:"Ceiling",value:oc.Ceiling},{label:"Sqrt",value:oc.Sqrt},{label:"Log",value:oc.Log},{label:"Tan",value:oc.Tan},{label:"ArcTan",value:oc.ArcTan},{label:"ArcCos",value:oc.ArcCos},{label:"ArcSin",value:oc.ArcSin},{label:"Fract",value:oc.Fract},{label:"Sign",value:oc.Sign},{label:"Radians",value:oc.Radians},{label:"Degrees",value:oc.Degrees},{label:"Set",value:oc.Set}]})],cc.prototype,"operation",void 0),(0,Ft.Y5)("BABYLON.TrigonometryBlock",cc);var uc=o(8884);const dc={effect:null,subMesh:null};class _c extends wt.M{constructor(){super(),this.NORMAL=!1,this.TANGENT=!1,this.VERTEXCOLOR_NME=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.PREPASS=!1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.EXPOSURE=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.BUMPDIRECTUV=0,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.AREALIGHTNOROUGHTNESS=!0,this.rebuild()}setValue(e,t,i=!1){void 0===this[e]&&this._keys.push(e),i&&this[e]!==t&&this.markAsUnprocessed(),this[e]=t}}class pc extends Ot.E{static _BlockIsTextureBlock(e){return"TextureBlock"===e.getClassName()||"ReflectionTextureBaseBlock"===e.getClassName()||"ReflectionTextureBlock"===e.getClassName()||"ReflectionBlock"===e.getClassName()||"RefractionBlock"===e.getClassName()||"CurrentScreenBlock"===e.getClassName()||"ParticleTextureBlock"===e.getClassName()||"ImageSourceBlock"===e.getClassName()||"TriPlanarBlock"===e.getClassName()||"BiPlanarBlock"===e.getClassName()||"PrePassTextureBlock"===e.getClassName()}set _glowModeEnabled(e){this._useAdditionalColor=e}_getGlobalNodeMaterialEditor(){return"undefined"!=typeof NODEEDITOR?NODEEDITOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.NodeEditor?BABYLON:void 0}get shaderLanguage(){return this._options?.shaderLanguage||pc.DefaultShaderLanguage}set shaderLanguage(e){this._options.shaderLanguage=e}get options(){return this._options}set options(e){this._options=e}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}get mode(){return this._mode}set mode(e){this._mode=e}get buildId(){return this._buildId}set buildId(e){this._buildId=e}constructor(e,t,i={}){if(super(e,t||os.q.LastCreatedScene),this._buildId=pc._BuildIdGenerator++,this._buildWasSuccessful=!1,this._cachedWorldViewMatrix=new gt.uq,this._cachedWorldViewProjectionMatrix=new gt.uq,this._optimizers=new Array,this._animationFrame=-1,this._buildIsInProgress=!1,this.BJSNODEMATERIALEDITOR=this._getGlobalNodeMaterialEditor(),this._useAdditionalColor=!1,this.editorData=null,this.ignoreAlpha=!1,this.maxSimultaneousLights=4,this.onBuildObservable=new Zi.cP,this.onBuildErrorObservable=new Zi.cP,this._vertexOutputNodes=new Array,this._fragmentOutputNodes=new Array,this.attachedBlocks=[],this._mode=ic.Material,this.forceAlphaBlending=!1,i&&1===i.shaderLanguage&&!this.getScene().getEngine().isWebGPU)throw new Error("WebGPU shader language is only supported with WebGPU engine");this._options={emitComments:!1,shaderLanguage:pc.DefaultShaderLanguage,...i},this._attachImageProcessingConfiguration(null)}getClassName(){return"NodeMaterial"}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}getBlockByName(e){let t=null;for(const i of this.attachedBlocks)if(i.name===e){if(t)return $i.S0.Warn("More than one block was found with the name `"+e+"`"),t;t=i}return t}getBlockByPredicate(e){for(const t of this.attachedBlocks)if(e(t))return t;return null}getInputBlockByPredicate(e){for(const t of this.attachedBlocks)if(t.isInput&&e(t))return t;return null}getInputBlocks(){const e=[];for(const t of this.attachedBlocks)t.isInput&&e.push(t);return e}registerOptimizer(e){if(!(this._optimizers.indexOf(e)>-1))return this._optimizers.push(e),this}unregisterOptimizer(e){const t=this._optimizers.indexOf(e);if(-1!==t)return this._optimizers.splice(t,1),this}addOutputNode(e){if(null===e.target)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return e.target&Cl.Vertex&&this._addVertexOutputNode(e),e.target&Cl.Fragment&&this._addFragmentOutputNode(e),this}removeOutputNode(e){return null===e.target||(e.target&Cl.Vertex&&this._removeVertexOutputNode(e),e.target&Cl.Fragment&&this._removeFragmentOutputNode(e)),this}_addVertexOutputNode(e){if(-1===this._vertexOutputNodes.indexOf(e))return e.target=Cl.Vertex,this._vertexOutputNodes.push(e),this}_removeVertexOutputNode(e){const t=this._vertexOutputNodes.indexOf(e);if(-1!==t)return this._vertexOutputNodes.splice(t,1),this}_addFragmentOutputNode(e){if(-1===this._fragmentOutputNodes.indexOf(e))return e.target=Cl.Fragment,this._fragmentOutputNodes.push(e),this}_removeFragmentOutputNode(e){const t=this._fragmentOutputNodes.indexOf(e);if(-1!==t)return this._fragmentOutputNodes.splice(t,1),this}get _supportGlowLayer(){return 0!==this._fragmentOutputNodes.length&&!!this._fragmentOutputNodes.some((e=>e.additionalColor&&e.additionalColor.isConnected))}needAlphaBlending(){return!this.ignoreAlpha&&(this.forceAlphaBlending||this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)}needAlphaTesting(){return this._sharedData&&this._sharedData.hints.needAlphaTesting}_processInitializeOnLink(e,t,i,s=!0){(e.target===Cl.VertexAndFragment||t.target===Cl.Fragment&&e.target===Cl.Vertex&&e._preparationId!==this._buildId)&&i.push(e),this._initializeBlock(e,t,i,s)}_attachBlock(e){if(-1===this.attachedBlocks.indexOf(e)){if(e.isUnique){const t=e.getClassName();for(const e of this.attachedBlocks)if(e.getClassName()===t)throw`Cannot have multiple blocks of type ${t} in the same NodeMaterial`}this.attachedBlocks.push(e)}}_initializeBlock(e,t,i,s=!0){e.initialize(t),s&&e.autoConfigure(this),e._preparationId=this._buildId,this._attachBlock(e);for(const r of e.inputs){r.associatedVariableName="";const n=r.connectedPoint;if(n&&!n._preventBubbleUp){const r=n.ownerBlock;r!==e&&this._processInitializeOnLink(r,t,i,s)}}if(e.isLoop){const r=e;if(r.loopID.hasEndpoints)for(const e of r.loopID.endpoints){const r=e.ownerBlock;0===r.outputs.length&&(t._terminalBlocks.add(r),this._processInitializeOnLink(r,t,i,s))}}else if(e.isTeleportOut){const r=e;r.entryPoint&&this._processInitializeOnLink(r.entryPoint,t,i,s)}for(const t of e.outputs)t.associatedVariableName=""}_resetDualBlocks(e,t){e.target===Cl.VertexAndFragment&&(e.buildId=t);for(const i of e.inputs){const s=i.connectedPoint;if(s&&!s._preventBubbleUp){const i=s.ownerBlock;i!==e&&this._resetDualBlocks(i,t)}}if(e.isTeleportOut){const i=e;i.entryPoint&&this._resetDualBlocks(i.entryPoint,t)}else if(e.isLoop){const i=e;if(i.loopID.hasEndpoints)for(const e of i.loopID.endpoints){const i=e.ownerBlock;0===i.outputs.length&&this._resetDualBlocks(i,t)}}}removeBlock(e){const t=this.attachedBlocks.indexOf(e);t>-1&&this.attachedBlocks.splice(t,1),e.isFinalMerger&&this.removeOutputNode(e)}build(e=!1,t=!0,i=!1){if(this._buildIsInProgress)return void It.V.Warn("Build is already in progress, You can use NodeMaterial.onBuildObservable to determine when the build is completed.");this._buildIsInProgress=!0,this._vertexCompilationState||i||(i=!0),this._buildWasSuccessful=!1;const s=this.getScene().getEngine(),r=this._mode===ic.Particle;if(0===this._vertexOutputNodes.length&&!r)throw"You must define at least one vertexOutputNode";if(0===this._fragmentOutputNodes.length)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new El,this._vertexCompilationState.supportUniformBuffers=s.supportsUniformBuffers,this._vertexCompilationState.target=Cl.Vertex,this._fragmentCompilationState=new El,this._fragmentCompilationState.supportUniformBuffers=s.supportsUniformBuffers,this._fragmentCompilationState.target=Cl.Fragment;const n=this._fragmentOutputNodes.filter((e=>e._isFinalOutputAndActive)).length>1;let o=this._fragmentOutputNodes;n&&(o=this._fragmentOutputNodes.filter((e=>!e._isFinalOutputAndActive)),o.push(this._fragmentOutputNodes.filter((e=>e._isFinalOutputAndActive&&e._hasPrecedence))[0])),this._sharedData=new Ml,this._sharedData.nodeMaterial=this,this._sharedData.fragmentOutputNodes=o,this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=e,this._sharedData.scene=this.getScene(),this._sharedData.allowEmptyVertexProgram=r;const a=[],h=[];for(const e of this._vertexOutputNodes)a.push(e),this._initializeBlock(e,this._vertexCompilationState,h,i);for(const e of o)h.push(e),this._initializeBlock(e,this._fragmentCompilationState,a,i);let l=0;for(const i of this.attachedBlocks)i.codeIsReady||(l++,i.onCodeIsReadyObservable.addOnce((()=>{l--,0===l&&this._finishBuildProcess(e,t,a,h)})));0===l&&this._finishBuildProcess(e,t,a,h)}_finishBuildProcess(e=!1,t=!0,i,s){this.optimize();for(const e of i)e.build(this._vertexCompilationState,i);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(const e of s)this._resetDualBlocks(e,this._buildId-1);for(const e of s)e.build(this._fragmentCompilationState,s);this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),t&&(this._buildId=pc._BuildIdGenerator++);const r=this._sharedData.emitErrors(this.onBuildErrorObservable);e&&(It.V.Log("Vertex shader:"),It.V.Log(this._vertexCompilationState.compilationString),It.V.Log("Fragment shader:"),It.V.Log(this._fragmentCompilationState.compilationString)),this._buildIsInProgress=!1,this._buildWasSuccessful=!0,r&&this.onBuildObservable.notifyObservers(this);const n=this.getScene().meshes;for(const e of n)if(e.subMeshes)for(const t of e.subMeshes){if(t.getMaterial()!==this)continue;if(!t.materialDefines)continue;const e=t.materialDefines;e.markAllAsDirty(),e.reset()}this.prePassTextureInputs.length&&this.getScene().enablePrePassRenderer();const o=this.getScene().prePassRenderer;o&&o.markAsDirty()}optimize(){for(const e of this._optimizers)e.optimize(this._vertexOutputNodes,this._fragmentOutputNodes)}_prepareDefinesForAttributes(e,t){const i=t.NORMAL,s=t.TANGENT,r=t.VERTEXCOLOR_NME;t.NORMAL=e.isVerticesDataPresent(Mt.R.NormalKind),t.TANGENT=e.isVerticesDataPresent(Mt.R.TangentKind);const n=e.useVertexColors&&e.isVerticesDataPresent(Mt.R.ColorKind);t.VERTEXCOLOR_NME=n;let o=!1;for(let i=1;i<=6;++i){const s=t["UV"+i];t["UV"+i]=e.isVerticesDataPresent(`uv${1===i?"":i}`),o=o||t["UV"+i]!==s}const a=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;(0,Ut.N4)(this.getScene(),t,!a),uc.m.PrepareDefines(this.getScene().getEngine().currentRenderPassId,e,t),(i!==t.NORMAL||s!==t.TANGENT||r!==t.VERTEXCOLOR_NME||o)&&t.markAsAttributesDirty()}get isPrePassCapable(){return!0}get prePassTextureOutputs(){const e=this.getBlockByPredicate((e=>"PrePassOutputBlock"===e.getClassName())),t=[4];return e?(this.prePassTextureInputs.length||(e.viewDepth.isConnected&&t.push(5),e.screenDepth.isConnected&&t.push(10),e.viewNormal.isConnected&&t.push(6),e.worldNormal.isConnected&&t.push(8),e.worldPosition.isConnected&&t.push(1),e.localPosition.isConnected&&t.push(9),e.reflectivity.isConnected&&t.push(3),e.velocity.isConnected&&t.push(2),e.velocityLinear.isConnected&&t.push(11)),t):t}get prePassTextureInputs(){const e=this.getAllTextureBlocks().filter((e=>"PrePassTextureBlock"===e.getClassName())),t=[];for(const i of e)i.position.isConnected&&!t.includes(1)&&t.push(1),i.localPosition.isConnected&&!t.includes(9)&&t.push(9),i.depth.isConnected&&!t.includes(5)&&t.push(5),i.screenDepth.isConnected&&!t.includes(10)&&t.push(10),i.normal.isConnected&&!t.includes(6)&&t.push(6),i.worldNormal.isConnected&&!t.includes(8)&&t.push(8);return t}setPrePassRenderer(e){const t=this.prePassTextureInputs.concat(this.prePassTextureOutputs);if(e&&t.length>1){let i=e.getEffectConfiguration("nodeMaterial");i||(i=e.addEffectConfiguration({enabled:!0,needsImageProcessing:!1,name:"nodeMaterial",texturesRequired:[]}));for(const e of t)i.texturesRequired.includes(e)||i.texturesRequired.push(e);i.enabled=!0}return t.length>1}createPostProcess(e,t=1,i=1,s,r,n=0,o=5){return this.mode!==ic.PostProcess?(It.V.Log("Incompatible material mode"),null):this._createEffectForPostProcess(null,e,t,i,s,r,n,o)}createEffectForPostProcess(e){this._createEffectForPostProcess(e)}_createEffectForPostProcess(e,t,i=1,s=1,r,n,o=0,a=5){let h=this.name+this._buildId;const l=new _c,c=new zn.e(h+"PostProcess",this.getScene());let u=this._buildId;return this._processDefines(c,l),Il.M.RegisterShader(h,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage),e?e.updateEffect(l.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,h,h):e=new va.w(this.name+"PostProcess",h,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,i,t,s,r,n,l.toString(),o,h,{maxSimultaneousLights:this.maxSimultaneousLights},!1,a,this.shaderLanguage),e.nodeMaterialSource=this,e.onApplyObservable.add((t=>{u!==this._buildId&&(delete Il.M.ShadersStore[h+"VertexShader"],delete Il.M.ShadersStore[h+"PixelShader"],h=this.name+this._buildId,l.markAllAsDirty(),u=this._buildId),this._processDefines(c,l)&&(Il.M.RegisterShader(h,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString),ac._.SetImmediate((()=>e.updateEffect(l.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,h,h)))),this._checkInternals(t)})),e}createProceduralTexture(e,t){if(this.mode!==ic.ProceduralTexture)return It.V.Log("Incompatible material mode"),null;let i=this.name+this._buildId;const s=new lc(i,e,null,t),r=new zn.e(i+"Procedural",this.getScene());r.reservedDataStore={hidden:!0};const n=new _c,o=this._processDefines(r,n);Il.M.RegisterShader(i,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage);let a=this.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[Mt.R.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,n.toString(),o?.fallbacks,void 0,void 0,void 0,this.shaderLanguage);s.nodeMaterialSource=this,s._setEffect(a);let h=this._buildId;const l=()=>{h!==this._buildId&&(delete Il.M.ShadersStore[i+"VertexShader"],delete Il.M.ShadersStore[i+"PixelShader"],i=this.name+this._buildId,n.markAllAsDirty(),h=this._buildId);const e=this._processDefines(r,n);e&&(Il.M.RegisterShader(i,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage),ac._.SetImmediate((()=>{a=this.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[Mt.R.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,n.toString(),e?.fallbacks,void 0),s._setEffect(a)}))),this._checkInternals(a)};return s.onBeforeGenerationObservable.add((()=>{l()})),this.onBuildObservable.add((()=>{l()})),s}_createEffectForParticles(e,t,i,s,r,n,o,a=""){let h=this.name+this._buildId+"_"+t;n||(n=new _c),o||(o=this.getScene().getMeshByName(this.name+"Particle"))||((o=new zn.e(this.name+"Particle",this.getScene())).reservedDataStore={hidden:!0});let l=this._buildId;const c=[];let u=a;if(!r){const a=this._processDefines(o,n);Il.M.RegisterShader(h,this._fragmentCompilationState._builtCompilationString,void 0,this.shaderLanguage),e.fillDefines(c,t,!1),u=c.join("\n"),r=this.getScene().getEngine().createEffectForParticles(h,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,n.toString()+"\n"+u,a?.fallbacks,i,s,e,this.shaderLanguage),e.setCustomEffect(r,t)}r.onBindObservable.add((r=>{l!==this._buildId&&(delete Il.M.ShadersStore[h+"PixelShader"],h=this.name+this._buildId+"_"+t,n.markAllAsDirty(),l=this._buildId),c.length=0,e.fillDefines(c,t,!1);const d=c.join("\n");d!==u&&(n.markAllAsDirty(),u=d);const _=this._processDefines(o,n);if(_)return Il.M.RegisterShader(h,this._fragmentCompilationState._builtCompilationString,void 0,this.shaderLanguage),r=this.getScene().getEngine().createEffectForParticles(h,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,n.toString()+"\n"+u,_?.fallbacks,i,s,e),e.setCustomEffect(r,t),void this._createEffectForParticles(e,t,i,s,r,n,o,a);this._checkInternals(r)}))}_checkInternals(e){if(this._sharedData.animatedInputs){const e=this.getScene(),t=e.getFrameId();if(this._animationFrame!==t){for(const t of this._sharedData.animatedInputs)t.animate(e);this._animationFrame=t}}for(const t of this._sharedData.bindableBlocks)t.bind(e,this);for(const t of this._sharedData.inputBlocks)t._transmit(e,this.getScene(),this)}createEffectForParticles(e,t,i){this.mode===ic.Particle?(this._createEffectForParticles(e,rc.BLENDMODE_ONEONE,t,i),this._createEffectForParticles(e,rc.BLENDMODE_MULTIPLY,t,i)):It.V.Log("Incompatible material mode")}createAsShadowDepthWrapper(e){this.mode===ic.Material?e.shadowDepthWrapper=new BABYLON.ShadowDepthWrapper(this,this.getScene()):It.V.Log("Incompatible material mode")}_processDefines(e,t,i=!1,s){let r=null;const n=this.getScene();if((0,Ut.Y7)(n,t)&&t.markAsMiscDirty(),this._sharedData.blocksWithDefines.forEach((s=>{s.initializeDefines(e,this,t,i)})),this._sharedData.blocksWithDefines.forEach((r=>{r.prepareDefines(e,this,t,i,s)})),t.isDirty){const i=t._areLightsDisposed;t.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach((i=>{i.replaceRepeatableContent(this._vertexCompilationState,this._fragmentCompilationState,e,t)}));const s=[];this._sharedData.dynamicUniformBlocks.forEach((e=>{e.updateUniformsAndSamples(this._vertexCompilationState,this,t,s)}));const n=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach((e=>{-1===n.indexOf(e)&&n.push(e)}));const o=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach((e=>{-1===o.indexOf(e)&&o.push(e)}));const a=new Nt.J;this._sharedData.blocksWithFallbacks.forEach((t=>{t.provideFallbacks(e,a)})),r={lightDisposed:i,uniformBuffers:s,mergedUniforms:n,mergedSamplers:o,fallbacks:a}}return r}isReadyForSubMesh(e,t,i=!1){if(!this._buildWasSuccessful)return!1;const s=this.getScene();if(this._sharedData.animatedInputs){const e=s.getFrameId();if(this._animationFrame!==e){for(const e of this._sharedData.animatedInputs)e.animate(s);this._animationFrame=e}}const r=t._drawWrapper;if(r.effect&&this.isFrozen&&r._wasPreviouslyReady&&r._wasPreviouslyUsingInstances===i)return!0;t.materialDefines&&"string"!=typeof t.materialDefines||(t.materialDefines=new _c);const n=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const o=s.getEngine();if(this._prepareDefinesForAttributes(e,n),this._sharedData.blockingBlocks.some((t=>!t.isReady(e,this,n,i))))return!1;const a=this._processDefines(e,n,i,t);if(a){const e=t.effect,i=n.toString();let r=o.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:a.mergedUniforms,uniformBuffersNames:a.uniformBuffers,samplers:a.mergedSamplers,defines:i,fallbacks:a.fallbacks,onCompiled:this.onCompiled,onError:this.onError,multiTarget:n.PREPASS,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:n.NUM_MORPH_INFLUENCERS},shaderLanguage:this.shaderLanguage},o);if(r)if(this._onEffectCreatedObservable&&(dc.effect=r,dc.subMesh=t,this._onEffectCreatedObservable.notifyObservers(dc)),this.allowShaderHotSwapping&&e&&!r.isReady()){if(r=e,n.markAsUnprocessed(),a.lightDisposed)return n._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),t.setEffect(r,n,this._materialContext)}if(n.AREALIGHTUSED)for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1;return!(!t.effect||!t.effect.isReady()||(n._renderId=s.getRenderId(),r._wasPreviouslyReady=!0,r._wasPreviouslyUsingInstances=i,this._checkScenePerformancePriority(),0))}get compiledShaders(){return this._buildWasSuccessful||this.build(),`// Vertex shader\n${this._vertexCompilationState.compilationString}\n\n// Fragment shader\n${this._fragmentCompilationState.compilationString}`}bindOnlyWorldMatrix(e){const t=this.getScene();if(!this._activeEffect)return;const i=this._sharedData.hints;i.needWorldViewMatrix&&e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),i.needWorldViewProjectionMatrix&&e.multiplyToRef(t.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(const t of this._sharedData.inputBlocks)t._transmitWorld(this._activeEffect,e,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}bindForSubMesh(e,t,i){const s=this.getScene(),r=i.effect;if(!r)return;this._activeEffect=r,this.bindOnlyWorldMatrix(e);const n=this._mustRebind(s,r,i,t.visibility),o=this._sharedData;if(n){for(const e of o.bindableBlocks)e.bind(r,this,t,i);for(const e of o.forcedBindableBlocks)e.bind(r,this,t,i);for(const e of o.inputBlocks)e._transmit(r,s,this)}else if(!this.isFrozen)for(const e of o.forcedBindableBlocks)e.bind(r,this,t,i);this._afterBind(t,this._activeEffect,i)}getActiveTextures(){const e=super.getActiveTextures();return this._sharedData&&e.push(...this._sharedData.textureBlocks.filter((e=>e.texture)).map((e=>e.texture))),e}getTextureBlocks(){return this._sharedData?this._sharedData.textureBlocks:[]}getAllTextureBlocks(){const e=[];for(const t of this.attachedBlocks)pc._BlockIsTextureBlock(t)&&e.push(t);return e}hasTexture(e){if(super.hasTexture(e))return!0;if(!this._sharedData)return!1;for(const t of this._sharedData.textureBlocks)if(t.texture===e)return!0;return!1}dispose(e,t,i){if(t)for(const e of this.getTextureBlocks().filter((e=>e.texture)).map((e=>e.texture)))e.dispose();for(const e of this.attachedBlocks)e.dispose();this.attachedBlocks.length=0,this._sharedData=null,this._vertexCompilationState=null,this._fragmentCompilationState=null,this.onBuildObservable.clear(),this.onBuildErrorObservable.clear(),this._imageProcessingObserver&&(this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingObserver=null),super.dispose(e,t,i)}_createNodeEditor(e){const t={nodeMaterial:this,...e};this.BJSNODEMATERIALEDITOR.NodeEditor.Show(t)}edit(e){return new Promise((t=>{if(this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),void 0===this.BJSNODEMATERIALEDITOR){const i=e&&e.editorURL?e.editorURL:pc.EditorURL;$i.S0.LoadBabylonScript(i,(()=>{this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),this._createNodeEditor(e?.nodeEditorConfig),t()}))}else this._createNodeEditor(e?.nodeEditorConfig),t()}))}clear(){this._vertexOutputNodes.length=0,this._fragmentOutputNodes.length=0,this.attachedBlocks.length=0,this._buildIsInProgress=!1}setToDefault(){this.clear(),this.editorData=null;const e=new Ql("Position");e.setAsAttribute("position");const t=new Ql("World");t.setAsSystemValue(Dl.World);const i=new kl("WorldPos");e.connectTo(i),t.connectTo(i);const s=new Ql("ViewProjection");s.setAsSystemValue(Dl.ViewProjection);const r=new kl("WorldPos * ViewProjectionTransform");i.connectTo(r),s.connectTo(r);const n=new Ul("VertexOutput");r.connectTo(n);const o=new Ql("color");o.value=new bt.ov(.8,.8,.8,1);const a=new Vl("FragmentOutput");o.connectTo(a),this.addOutputNode(n),this.addOutputNode(a),this._mode=ic.Material}setToDefaultPostProcess(){this.clear(),this.editorData=null;const e=new Ql("Position");e.setAsAttribute("position2d");const t=new Ql("Constant1");t.isConstant=!0,t.value=1;const i=new $l("Position3D");e.connectTo(i),t.connectTo(i,{input:"w"});const s=new Ul("VertexOutput");i.connectTo(s);const r=new Ql("Scale");r.visibleInInspector=!0,r.value=new gt.I9(1,1);const n=new Jl("uv0");e.connectTo(n);const o=new tc("UV scale");n.connectTo(o),r.connectTo(o);const a=new Kl("CurrentScreen");o.connectTo(a);const h=$i.S0.GetAssetUrl("https://assets.babylonjs.com/core/nme/currentScreenPostProcess.png");a.texture=new Dt.g(h,this.getScene());const l=new Vl("FragmentOutput");a.connectTo(l,{output:"rgba"}),this.addOutputNode(s),this.addOutputNode(l),this._mode=ic.PostProcess}setToDefaultProceduralTexture(){this.clear(),this.editorData=null;const e=new Ql("Position");e.setAsAttribute("position2d");const t=new Ql("Constant1");t.isConstant=!0,t.value=1;const i=new $l("Position3D");e.connectTo(i),t.connectTo(i,{input:"w"});const s=new Ul("VertexOutput");i.connectTo(s);const r=new Ql("Time");r.value=0,r.min=0,r.max=0,r.isBoolean=!1,r.matrixMode=0,r.animationType=Gl.Time,r.isConstant=!1;const n=new Ql("Color3");n.value=new bt.v9(1,1,1),n.isConstant=!1;const o=new Vl("FragmentOutput"),a=new $l("VectorMerger");a.visibleInInspector=!1;const h=new cc("Cos");h.operation=oc.Cos,e.connectTo(a),r.output.connectTo(h.input),h.output.connectTo(a.z),a.xyzOut.connectTo(o.rgb),this.addOutputNode(s),this.addOutputNode(o),this._mode=ic.ProceduralTexture}setToDefaultParticle(){this.clear(),this.editorData=null;const e=new Ql("uv");e.setAsAttribute("particle_uv");const t=new Yl("ParticleTexture");e.connectTo(t);const i=new Ql("Color");i.setAsAttribute("particle_color");const s=new tc("Texture * Color");t.connectTo(s),i.connectTo(s);const r=new jl("ParticleRampGradient");s.connectTo(r);const n=new nc("ColorSplitter");i.connectTo(n);const o=new Zl("ParticleBlendMultiply");r.connectTo(o),t.connectTo(o,{output:"a"}),n.connectTo(o,{output:"a"});const a=new Vl("FragmentOutput");o.connectTo(a),this.addOutputNode(a),this._mode=ic.Particle}async loadAsync(e,t=""){return pc.ParseFromFileAsync("",e,this.getScene(),t,!0,this)}_gatherBlocks(e,t){if(-1===t.indexOf(e)){t.push(e);for(const i of e.inputs){const s=i.connectedPoint;if(s){const i=s.ownerBlock;i!==e&&this._gatherBlocks(i,t)}}if(e.isTeleportOut){const i=e;i.entryPoint&&this._gatherBlocks(i.entryPoint,t)}}}generateCode(){let e=[];const t=[],i=["const","var","let"];for(const e of this._vertexOutputNodes)this._gatherBlocks(e,t);const s=[];for(const e of this._fragmentOutputNodes)this._gatherBlocks(e,s);let r=`var nodeMaterial = new BABYLON.NodeMaterial("${this.name||"node material"}");\n`;r+=`nodeMaterial.mode = BABYLON.NodeMaterialModes.${ic[this.mode]};\n`;for(const s of t)s.isInput&&-1===e.indexOf(s)&&(r+=s._dumpCode(i,e));for(const t of s)t.isInput&&-1===e.indexOf(t)&&(r+=t._dumpCode(i,e));e=[],r+="\n// Connections\n";for(const t of this._vertexOutputNodes)r+=t._dumpCodeForOutputConnections(e);for(const t of this._fragmentOutputNodes)r+=t._dumpCodeForOutputConnections(e);r+="\n// Output nodes\n";for(const e of this._vertexOutputNodes)r+=`nodeMaterial.addOutputNode(${e._codeVariableName});\n`;for(const e of this._fragmentOutputNodes)r+=`nodeMaterial.addOutputNode(${e._codeVariableName});\n`;return r+="nodeMaterial.build();\n",r}serialize(e){const t=e?{}:Vt.p.Serialize(this);t.editorData=JSON.parse(JSON.stringify(this.editorData));let i=[];if(e)i=e;else{t.customType="BABYLON.NodeMaterial",t.outputNodes=[];for(const e of this._vertexOutputNodes)this._gatherBlocks(e,i),t.outputNodes.push(e.uniqueId);for(const e of this._fragmentOutputNodes)this._gatherBlocks(e,i),-1===t.outputNodes.indexOf(e.uniqueId)&&t.outputNodes.push(e.uniqueId)}t.blocks=[];for(const e of i)t.blocks.push(e.serialize());if(!e)for(const e of this.attachedBlocks)-1===i.indexOf(e)&&t.blocks.push(e.serialize());return t.uniqueId=this.uniqueId,t}_restoreConnections(e,t,i){for(const s of e.outputs)for(const r of t.blocks){const n=i[r.id];if(n)for(const o of r.inputs)if(i[o.targetBlockId]!==e||o.targetConnectionName!==s.name);else{const e=n.getInputByName(o.inputName);if(!e||e.isConnected)continue;s.connectTo(e,!0),this._restoreConnections(n,t,i)}}}parseSerializedObject(e,t="",i=!1,s){i||this.clear();const r={};for(const i of e.blocks){const e=(0,Ft.n9)(i.customType);if(e){const n=new e;n._deserialize(i,this.getScene(),t,s),r[i.id]=n,this.attachedBlocks.push(n)}}for(const e of this.attachedBlocks)if(e.isTeleportOut){const t=e,i=t._tempEntryPointUniqueId;i&&r[i].attachToEndpoint(t)}for(let t=0;t<e.blocks.length;t++){const s=r[e.blocks[t].id];s&&(s.inputs.length&&!i||this._restoreConnections(s,e,r))}if(e.outputNodes)for(const t of e.outputNodes)this.addOutputNode(r[t]);if(e.locations||e.editorData&&e.editorData.locations){const t=e.locations||e.editorData.locations;for(const e of t)r[e.blockId]&&(e.blockId=r[e.blockId].uniqueId);i&&this.editorData&&this.editorData.locations&&t.concat(this.editorData.locations),e.locations?this.editorData={locations:t}:(this.editorData=e.editorData,this.editorData.locations=t);const s=[];for(const e in r)s[e]=r[e].uniqueId;this.editorData.map=s}this.comment=e.comment,void 0!==e.forceAlphaBlending&&(this.forceAlphaBlending=e.forceAlphaBlending),void 0!==e.alphaMode&&(this.alphaMode=e.alphaMode),i||(this._mode=e.mode??ic.Material)}loadFromSerialization(e,t="",i=!1){this.parseSerializedObject(e,t,i)}clone(e,t=!1){const i=this.serialize(),s=Vt.p.Clone((()=>new pc(e,this.getScene(),this.options)),this);return s.id=e,s.name=e,s.parseSerializedObject(i),s._buildId=this._buildId,s.build(!1,!t),s}whenTexturesReadyAsync(){const e=[];return this.getActiveTextures().forEach((t=>{const i=t.getInternalTexture();i&&!i.isReady&&e.push(new Promise(((e,t)=>{i.onLoadedObservable.addOnce((()=>{e()})),i.onErrorObservable.addOnce((e=>{t(e)}))})))})),Promise.all(e)}static Parse(e,t,i="",s=0){const r=Vt.p.Parse((()=>new pc(e.name,t,{shaderLanguage:s})),e,t,i);return r.parseSerializedObject(e,i),r.build(),r}static async ParseFromFileAsync(e,t,i,s="",r=!1,n,o,a){const h=n??new pc(e,i,a),l=await i._loadFileAsync(t),c=JSON.parse(l);return h.parseSerializedObject(c,s,void 0,o),r||h.build(),h}static ParseFromSnippetAsync(e,t=os.q.LastCreatedScene,i="",s,r=!1,n=!1,o,a){return"_BLANK"===e?Promise.resolve(pc.CreateDefault("blank",t)):new Promise(((h,l)=>{const c=new Rs.u;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const u=JSON.parse(JSON.parse(c.responseText).jsonPayload),d=JSON.parse(u.nodeMaterial);s||((s=Vt.p.Parse((()=>new pc(e,t,a)),d,t,i)).uniqueId=t.getUniqueId()),s.parseSerializedObject(d,void 0,void 0,o),s.snippetId=e,s.sideOrientation=null;try{r||s.build()}catch(e){l(e)}n?s.whenTexturesReadyAsync().then((()=>{h(s)})).catch((e=>{l(e)})):h(s)}else l("Unable to load the snippet "+e)})),c.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),c.send()}))}static CreateDefault(e,t){const i=new pc(e,t);return i.setToDefault(),i.build(),i}}pc._BuildIdGenerator=0,pc.EditorURL=`${$i.S0._DefaultCdnUrl}/v${kh.$.Version}/nodeEditor/babylon.nodeEditor.js`,pc.SnippetUrl="https://snippet.babylonjs.com",pc.IgnoreTexturesAtLoadTime=!1,pc.DefaultShaderLanguage=0,(0,Et.Cg)([(0,Rt.lK)()],pc.prototype,"ignoreAlpha",void 0),(0,Et.Cg)([(0,Rt.lK)()],pc.prototype,"maxSimultaneousLights",void 0),(0,Et.Cg)([(0,Rt.lK)("mode")],pc.prototype,"_mode",void 0),(0,Et.Cg)([(0,Rt.lK)("comment")],pc.prototype,"comment",void 0),(0,Et.Cg)([(0,Rt.lK)()],pc.prototype,"forceAlphaBlending",void 0),(0,Ft.Y5)("BABYLON.NodeMaterial",pc);var gc,fc,mc=o(9593);mc.K.prototype._projectOnTrianglesToRef=function(e,t,i,s,r,n){const o=gt.AA.Vector3[0],a=gt.AA.Vector3[1];let h=1/0;for(let n=this.indexStart;n<this.indexStart+this.indexCount-(3-s);n+=s){const s=i[n],l=i[n+1],c=i[n+2];if(r&&4294967295===c){n+=2;continue}const u=t[s],d=t[l],_=t[c];if(!u||!d||!_)continue;const p=gt.Pq.ProjectOnTriangleToRef(e,u,d,_,a);p<h&&(o.copyFrom(a),h=p)}return n.copyFrom(o),h},mc.K.prototype._projectOnUnIndexedTrianglesToRef=function(e,t,i,s){const r=gt.AA.Vector3[0],n=gt.AA.Vector3[1];let o=1/0;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=3){const s=t[i],a=t[i+1],h=t[i+2],l=gt.Pq.ProjectOnTriangleToRef(e,s,a,h,n);l<o&&(r.copyFrom(n),o=l)}return s.copyFrom(r),o},mc.K.prototype.projectToRef=function(e,t,i,s){const r=this.getMaterial();if(!r)return-1;let n=3,o=!1;switch(r.fillMode){case 3:case 5:case 6:case 8:return-1;case 7:n=1,o=!0}return 4===r.fillMode?-1:!i.length&&this._mesh._unIndexed?this._projectOnUnIndexedTrianglesToRef(e,t,i,s):this._projectOnTrianglesToRef(e,t,i,n,o,s)},function(e){e[e.DEHYDRATED=0]="DEHYDRATED",e[e.HOVER=1]="HOVER",e[e.TOUCH=2]="TOUCH"}(gc||(gc={})),function(e){e[e.DISABLED=0]="DISABLED",e[e.CENTERED_ON_CONTROLLER=1]="CENTERED_ON_CONTROLLER",e[e.CENTERED_IN_FRONT=2]="CENTERED_IN_FRONT"}(fc||(fc={}));const bc=[new gt.Pq,new gt.Pq,new gt.Pq,new gt.Pq];class vc extends Tl{constructor(e,t){super(e),this._options=t,this._tmpRay=new fa.Rl(new gt.Pq,new gt.Pq),this._attachController=e=>{if(this._controllers[e.uniqueId])return;const{touchCollisionMesh:t,touchCollisionMeshFunction:i,hydrateCollisionMeshFunction:s}=this._generateNewTouchPointMesh(),r=this._generateVisualCue();switch(this._controllers[e.uniqueId]={xrController:e,meshUnderPointer:null,nearInteractionTargetMesh:null,pick:null,stalePick:null,touchCollisionMesh:t,touchCollisionMeshFunction:i,hydrateCollisionMeshFunction:s,currentAnimationState:gc.DEHYDRATED,grabRay:new fa.Rl(new gt.Pq,new gt.Pq),hoverInteraction:!1,nearInteraction:!1,grabInteraction:!1,downTriggered:!1,id:vc._IdCounter++,pickedPointVisualCue:r},this._controllers[e.uniqueId]._worldScaleObserver=this._controllers[e.uniqueId]._worldScaleObserver||this._xrSessionManager.onWorldScaleFactorChangedObservable.add((t=>{if(t.newScaleFactor!==t.previousScaleFactor){this._controllers[e.uniqueId].touchCollisionMesh.dispose(),this._controllers[e.uniqueId].pickedPointVisualCue.dispose();const{touchCollisionMesh:t,touchCollisionMeshFunction:i,hydrateCollisionMeshFunction:s}=this._generateNewTouchPointMesh();this._controllers[e.uniqueId].touchCollisionMesh=t,this._controllers[e.uniqueId].touchCollisionMeshFunction=i,this._controllers[e.uniqueId].hydrateCollisionMeshFunction=s,this._controllers[e.uniqueId].pickedPointVisualCue=this._generateVisualCue()}})),this._attachedController?!this._options.enableNearInteractionOnAllControllers&&this._options.preferredHandedness&&e.inputSource.handedness===this._options.preferredHandedness&&(this._attachedController=e.uniqueId):this._options.enableNearInteractionOnAllControllers||(this._attachedController=e.uniqueId),e.inputSource.targetRayMode){case"tracked-pointer":return this._attachNearInteractionMode(e);case"gaze":case"screen":return null}},this._controllers={},this._farInteractionFeature=null,this.selectionMeshDefaultColor=new bt.v9(.8,.8,.8),this.selectionMeshPickedColor=new bt.v9(.3,.3,1),this.alwaysHideSelectionMesh=!1,this._hoverRadius=.1,this._pickRadius=.02,this._controllerPickRadius=.03,this._nearGrabLengthScale=5,this._scene=this._xrSessionManager.scene,void 0===this._options.nearInteractionControllerMode&&(this._options.nearInteractionControllerMode=2),this._options.farInteractionFeature&&(this._farInteractionFeature=this._options.farInteractionFeature)}attach(){return!!super.attach()&&(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(e=>{this._detachController(e.uniqueId)})),this._scene.constantlyUpdateMeshUnderPointer=!0,!0)}detach(){return!!super.detach()&&(Object.keys(this._controllers).forEach((e=>{this._detachController(e)})),!0)}getMeshUnderPointer(e){return this._controllers[e]?this._controllers[e].meshUnderPointer:null}getXRControllerByPointerId(e){const t=Object.keys(this._controllers);for(let i=0;i<t.length;++i)if(this._controllers[t[i]].id===e)return this._controllers[t[i]].xrController||null;return null}setFarInteractionFeature(e){this._farInteractionFeature=e}_nearPickPredicate(e){return e.isEnabled()&&e.isVisible&&e.isPickable&&e.isNearPickable}_nearGrabPredicate(e){return e.isEnabled()&&e.isVisible&&e.isPickable&&e.isNearGrabbable}_nearInteractionPredicate(e){return e.isEnabled()&&e.isVisible&&e.isPickable&&(e.isNearPickable||e.isNearGrabbable)}_controllerAvailablePredicate(e,t){let i=e;for(;i;){if(i.reservedDataStore&&i.reservedDataStore.nearInteraction&&i.reservedDataStore.nearInteraction.excludedControllerId===t)return!1;i=i.parent}return!0}_handleTransitionAnimation(e,t){if(e.currentAnimationState!==t&&2===this._options.nearInteractionControllerMode&&!e.xrController?.inputSource.hand){if(t>e.currentAnimationState)switch(e.currentAnimationState){case gc.DEHYDRATED:if(e.hydrateCollisionMeshFunction(!0),t===gc.HOVER)break;case gc.HOVER:if(e.touchCollisionMeshFunction(!0),t===gc.TOUCH)break}else switch(e.currentAnimationState){case gc.TOUCH:if(e.touchCollisionMeshFunction(!1),t===gc.HOVER)break;case gc.HOVER:if(e.hydrateCollisionMeshFunction(!1),t===gc.DEHYDRATED)break}e.currentAnimationState=t}}_processTouchPoint(e,t,i){const s=this._controllers[e];s.grabRay.origin.copyFrom(t),i.toEulerAnglesToRef(gt.AA.Vector3[0]),s.grabRay.direction.copyFrom(gt.AA.Vector3[0]),2!==this._options.nearInteractionControllerMode||s.xrController?.inputSource.hand||(s.xrController.getWorldPointerRayToRef(this._tmpRay),s.grabRay.origin.addInPlace(this._tmpRay.direction.scale(.05))),s.grabRay.length=this._nearGrabLengthScale*this._hoverRadius*this._xrSessionManager.worldScalingFactor,s.touchCollisionMesh.position.copyFrom(s.grabRay.origin).scaleInPlace(this._xrSessionManager.worldScalingFactor)}_onXRFrame(e){Object.keys(this._controllers).forEach((t=>{const i=this._controllers[t],s=i.xrController?.inputSource.hand;if(!this._options.enableNearInteractionOnAllControllers&&t!==this._attachedController||!i.xrController||!s&&(!this._options.nearInteractionControllerMode||!i.xrController.inputSource.gamepad))return void(i.pick=null);if(i.hoverInteraction=!1,i.nearInteraction=!1,!i.xrController)return;if(s){const i=s.get("index-finger-tip");if(i){const s=e.getJointPose(i,this._xrSessionManager.referenceSpace);if(s&&s.transform){const e=this._scene.useRightHandedSystem?1:-1;gt.AA.Vector3[0].set(s.transform.position.x,s.transform.position.y,s.transform.position.z*e),gt.AA.Quaternion[0].set(s.transform.orientation.x,s.transform.orientation.y,s.transform.orientation.z*e,s.transform.orientation.w*e),this._processTouchPoint(t,gt.AA.Vector3[0],gt.AA.Quaternion[0])}}}else if(i.xrController.inputSource.gamepad&&0!==this._options.nearInteractionControllerMode){let e=i.xrController.pointer;i.xrController.grip&&1===this._options.nearInteractionControllerMode&&(e=i.xrController.grip),this._processTouchPoint(t,e.position,e.rotationQuaternion)}const r=(e,t)=>{let i=null;return i=t&&t.hit?e&&e.hit?t.distance<e.distance?t:e:t:e,i},n=e=>{let t=new vl.G,i=!1;const s=e&&e.pickedPoint&&e.hit;return e?.pickedPoint&&(i=0===e.pickedPoint.x&&0===e.pickedPoint.y&&0===e.pickedPoint.z),s&&!i&&(t=e),t};if(!i.grabInteraction){let e=null,t=null;this._options.useUtilityLayer&&this._utilityLayerScene&&(t=this._pickWithSphere(i,this._hoverRadius*this._xrSessionManager.worldScalingFactor,this._utilityLayerScene,(e=>this._nearInteractionPredicate(e))));const o=r(this._pickWithSphere(i,this._hoverRadius*this._xrSessionManager.worldScalingFactor,this._scene,(e=>this._nearInteractionPredicate(e))),t);if(o&&o.hit&&(e=n(o),e.hit&&(i.hoverInteraction=!0)),i.hoverInteraction){let t=null;const o=(s?this._pickRadius:this._controllerPickRadius)*this._xrSessionManager.worldScalingFactor;this._options.useUtilityLayer&&this._utilityLayerScene&&(t=this._pickWithSphere(i,o,this._utilityLayerScene,(e=>this._nearPickPredicate(e))));const a=n(r(this._pickWithSphere(i,o,this._scene,(e=>this._nearPickPredicate(e))),t));a.hit&&(e=a,i.nearInteraction=!0)}i.stalePick=i.pick,i.pick=e,i.pick&&i.pick.pickedPoint&&i.pick.hit?(i.meshUnderPointer=i.pick.pickedMesh,i.pickedPointVisualCue.position.copyFrom(i.pick.pickedPoint),i.pickedPointVisualCue.isVisible=!this.alwaysHideSelectionMesh,this._farInteractionFeature&&this._farInteractionFeature.attached&&this._farInteractionFeature._setPointerSelectionDisabledByPointerId(i.id,!0)):(i.meshUnderPointer=null,i.pickedPointVisualCue.isVisible=!1,this._farInteractionFeature&&this._farInteractionFeature.attached&&this._farInteractionFeature._setPointerSelectionDisabledByPointerId(i.id,!1))}let o=gc.DEHYDRATED;i.grabInteraction||i.nearInteraction?o=gc.TOUCH:i.hoverInteraction&&(o=gc.HOVER),this._handleTransitionAnimation(i,o)}))}get _utilityLayerScene(){return this._options.customUtilityLayerScene||yl.DefaultUtilityLayer.utilityLayerScene}_generateVisualCue(){const e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||yl.DefaultUtilityLayer.utilityLayerScene:this._scene,t=ao("nearInteraction",{diameter:.0105*this._xrSessionManager.worldScalingFactor},e);t.bakeCurrentTransformIntoVertices(),t.isPickable=!1,t.isVisible=!1,t.rotationQuaternion=gt.PT.Identity();const i=new ft.F("targetMat",e);return i.specularColor=bt.v9.Black(),i.emissiveColor=this.selectionMeshDefaultColor,i.backFaceCulling=!1,t.material=i,t}_isControllerReadyForNearInteraction(e){return!this._farInteractionFeature||this._farInteractionFeature._getPointerSelectionDisabledByPointerId(e)}_attachNearInteractionMode(e){const t=this._controllers[e.uniqueId],i={pointerId:t.id,pointerType:"xr-near"};t.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((()=>{(this._options.enableNearInteractionOnAllControllers||e.uniqueId===this._attachedController)&&t.xrController&&(t.xrController.inputSource.hand||this._options.nearInteractionControllerMode&&t.xrController.inputSource.gamepad)&&(t.pick&&(t.pick.ray=t.grabRay),t.pick&&this._isControllerReadyForNearInteraction(t.id)&&this._scene.simulatePointerMove(t.pick,i),t.nearInteraction&&t.pick&&t.pick.hit?t.nearInteractionTargetMesh||(this._scene.simulatePointerDown(t.pick,i),t.nearInteractionTargetMesh=t.meshUnderPointer,t.downTriggered=!0):t.nearInteractionTargetMesh&&t.stalePick&&(this._scene.simulatePointerUp(t.stalePick,i),t.downTriggered=!1,t.nearInteractionTargetMesh=null))}));const s=s=>{this._options.enableNearInteractionOnAllControllers||e.uniqueId===this._attachedController&&this._isControllerReadyForNearInteraction(t.id)?(t.pick&&(t.pick.ray=t.grabRay),s&&t.pick&&t.meshUnderPointer&&this._nearGrabPredicate(t.meshUnderPointer)?(t.grabInteraction=!0,t.pickedPointVisualCue.isVisible=!1,this._scene.simulatePointerDown(t.pick,i),t.downTriggered=!0):!s&&t.pick&&t.grabInteraction&&(this._scene.simulatePointerUp(t.pick,i),t.downTriggered=!1,t.grabInteraction=!1,t.pickedPointVisualCue.isVisible=!this.alwaysHideSelectionMesh)):!s||this._options.enableNearInteractionOnAllControllers||this._options.disableSwitchOnClick||(this._attachedController=e.uniqueId)};if(e.inputSource.gamepad){const i=e=>{t.squeezeComponent=e.getComponent("grasp"),t.squeezeComponent?t.onSqueezeButtonChangedObserver=t.squeezeComponent.onButtonStateChangedObservable.add((e=>{if(e.changes.pressed){const t=e.changes.pressed.current;s(t)}})):(t.selectionComponent=e.getMainComponent(),t.onButtonChangedObserver=t.selectionComponent.onButtonStateChangedObservable.add((e=>{if(e.changes.pressed){const t=e.changes.pressed.current;s(t)}})))};e.motionController?i(e.motionController):e.onMotionControllerInitObservable.add(i)}else{const e=e=>{t.xrController&&e.inputSource===t.xrController.inputSource&&t.pick&&this._isControllerReadyForNearInteraction(t.id)&&t.meshUnderPointer&&this._nearGrabPredicate(t.meshUnderPointer)&&(t.grabInteraction=!0,t.pickedPointVisualCue.isVisible=!1,this._scene.simulatePointerDown(t.pick,i),t.downTriggered=!0)},s=e=>{t.xrController&&e.inputSource===t.xrController.inputSource&&t.pick&&this._isControllerReadyForNearInteraction(t.id)&&(this._scene.simulatePointerUp(t.pick,i),t.grabInteraction=!1,t.pickedPointVisualCue.isVisible=!this.alwaysHideSelectionMesh,t.downTriggered=!1)};t.eventListeners={selectend:s,selectstart:e},this._xrSessionManager.session.addEventListener("selectstart",e),this._xrSessionManager.session.addEventListener("selectend",s)}}_detachController(e){const t=this._controllers[e];if(t&&(t.squeezeComponent&&t.onSqueezeButtonChangedObserver&&t.squeezeComponent.onButtonStateChangedObservable.remove(t.onSqueezeButtonChangedObserver),t.selectionComponent&&t.onButtonChangedObserver&&t.selectionComponent.onButtonStateChangedObservable.remove(t.onButtonChangedObserver),t.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(t.onFrameObserver),t.eventListeners&&Object.keys(t.eventListeners).forEach((e=>{const i=t.eventListeners&&t.eventListeners[e];i&&this._xrSessionManager.session.removeEventListener(e,i)})),t.touchCollisionMesh.dispose(),t.pickedPointVisualCue.dispose(),this._xrSessionManager.runInXRFrame((()=>{if(!t.downTriggered)return;const e={pointerId:t.id,pointerType:"xr-near"};this._scene.simulatePointerUp(new vl.G,e)})),t._worldScaleObserver&&this._xrSessionManager.onWorldScaleFactorChangedObservable.remove(t._worldScaleObserver),delete this._controllers[e],this._attachedController===e)){const e=Object.keys(this._controllers);e.length?this._attachedController=e[0]:this._attachedController=""}}_generateNewTouchPointMesh(){const e=this._xrSessionManager.worldScalingFactor,t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||yl.DefaultUtilityLayer.utilityLayerScene:this._scene,i=ao("PickSphere",{diameter:1*e},t);if(i.isVisible=!1,this._options.motionControllerOrbMaterial)i.material=this._options.motionControllerOrbMaterial;else{let e;e=this._options.motionControllerTouchMaterialSnippetUrl?pc.ParseFromFileAsync("motionControllerTouchMaterial",this._options.motionControllerTouchMaterialSnippetUrl,t):pc.ParseFromSnippetAsync("8RUNKL#3",t),e.then((e=>{i.material=e})).catch((e=>{It.V.Warn(`Error creating touch material in WebXRNearInteraction: ${e}`)}))}const s=new Za;s.setEasingMode(Ya.EASINGMODE_EASEINOUT);const r=new gt.Pq(this._controllerPickRadius,this._controllerPickRadius,this._controllerPickRadius).scaleInPlace(e),n=this._controllerPickRadius*(4/3),o=new gt.Pq(n,n,n).scaleInPlace(e),a=this._controllerPickRadius*(7/6),h=new gt.Pq(a,a,a).scaleInPlace(e),l=.8*this._controllerPickRadius,c=new gt.Pq(l,l,l).scaleInPlace(e),u=1.5*this._controllerPickRadius,d=[{frame:0,value:r},{frame:10,value:new gt.Pq(u,u,u).scaleInPlace(e)},{frame:18,value:o}],_=[{frame:0,value:o},{frame:10,value:c},{frame:18,value:r}],p=[{frame:0,value:gt.Pq.ZeroReadOnly},{frame:12,value:h},{frame:15,value:r}],g=[{frame:0,value:r},{frame:10,value:gt.Pq.ZeroReadOnly},{frame:15,value:gt.Pq.ZeroReadOnly}],f=new Ja.X5("touch","scaling",60,Ja.X5.ANIMATIONTYPE_VECTOR3,Ja.X5.ANIMATIONLOOPMODE_CONSTANT),m=new Ja.X5("release","scaling",60,Ja.X5.ANIMATIONTYPE_VECTOR3,Ja.X5.ANIMATIONLOOPMODE_CONSTANT),b=new Ja.X5("hydrate","scaling",60,Ja.X5.ANIMATIONTYPE_VECTOR3,Ja.X5.ANIMATIONLOOPMODE_CONSTANT),v=new Ja.X5("dehydrate","scaling",60,Ja.X5.ANIMATIONTYPE_VECTOR3,Ja.X5.ANIMATIONLOOPMODE_CONSTANT);return f.setEasingFunction(s),m.setEasingFunction(s),b.setEasingFunction(s),v.setEasingFunction(s),f.setKeys(d),m.setKeys(_),b.setKeys(p),v.setKeys(g),{touchCollisionMesh:i,touchCollisionMeshFunction:e=>{const s=e?f:m;t.beginDirectAnimation(i,[s],0,18,!1,1)},hydrateCollisionMeshFunction:e=>{const s=e?b:v;e&&(i.isVisible=!0),t.beginDirectAnimation(i,[s],0,15,!1,1,(()=>{e||(i.isVisible=!1)}))}}}_pickWithSphere(e,t,i,s){const r=new vl.G;if(r.distance=1/0,e.touchCollisionMesh&&e.xrController){const n=e.touchCollisionMesh.position,o=Sl.i.CreateFromCenterAndRadius(n,t);for(let t=0;t<i.meshes.length;t++){const n=i.meshes[t];if(!s(n)||!this._controllerAvailablePredicate(n,e.xrController.uniqueId))continue;const a=vc.PickMeshWithSphere(n,o);a&&a.hit&&a.distance<r.distance&&(r.hit=a.hit,r.pickedMesh=n,r.pickedPoint=a.pickedPoint,r.aimTransform=e.xrController.pointer,r.gripTransform=e.xrController.grip||null,r.originMesh=e.touchCollisionMesh,r.distance=a.distance,r.bu=a.bu,r.bv=a.bv,r.faceId=a.faceId,r.subMeshId=a.subMeshId)}}return r}static PickMeshWithSphere(e,t,i=!1){const s=e.subMeshes,r=new vl.G,n=e.getBoundingInfo();if(!e._generatePointsArray())return r;if(!e.subMeshes||!n)return r;if(!i&&!Sl.i.Intersects(n.boundingSphere,t))return r;const o=bc[0],a=bc[1];bc[2].setAll(0),bc[3].setAll(0);const h=new fa.Rl(bc[2],bc[3],1);let l,c,u,d,_=1/0;const p=gt.AA.Vector3[2],g=gt.AA.Matrix[0];g.copyFrom(e.getWorldMatrix()),g.invert(),gt.Pq.TransformCoordinatesToRef(t.center,g,p);for(let i=0;i<s.length;i++)s[i].projectToRef(p,e._positions,e.getIndices(),a),gt.Pq.TransformCoordinatesToRef(a,e.getWorldMatrix(),a),l=gt.Pq.Distance(a,t.center),u=gt.Pq.DistanceSquared(a,e.getAbsolutePosition()),c=gt.Pq.DistanceSquared(t.center,e.getAbsolutePosition()),-1!==c&&-1!==u&&u>c&&(l=0,a.copyFrom(t.center)),-1!==l&&l<_&&(_=l,fa.Rl.CreateFromToToRef(t.center,a,h),h.length=2*_,d=h.intersectsMesh(e),o.copyFrom(a));return _<t.radius&&(r.hit=!0,r.distance=_,r.pickedMesh=e,r.pickedPoint=o.clone(),d&&null!==d.bu&&null!==d.bv&&(r.faceId=d.faceId,r.subMeshId=d.subMeshId,r.bu=d.bu,r.bv=d.bv)),r}}vc._IdCounter=200,vc.Name=rl.NEAR_INTERACTION,vc.Version=1,nl.AddWebXRFeature(vc.Name,((e,t)=>()=>new vc(e,t)),vc.Version,!0);class Tc{constructor(e,t,i){this.element=e,this.sessionMode=t,this.referenceSpaceType=i}update(e){}}class yc{constructor(e,t){if(this._scene=e,this.options=t,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new Zi.cP,this._onSessionGranted=e=>{this._helper&&this._enterXRWithButtonIndex(0)},this.overlay=document.createElement("div"),this.overlay.classList.add("xr-button-overlay"),!t.ignoreSessionGrantedEvent&&navigator.xr&&navigator.xr.addEventListener("sessiongranted",this._onSessionGranted),"undefined"!=typeof window&&window.location&&"http:"===window.location.protocol&&"localhost"!==window.location.hostname)throw $i.S0.Warn("WebXR can only be served over HTTPS"),new Error("WebXR can only be served over HTTPS");if(t.customButtons)this._buttons=t.customButtons;else{this.overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;";const e=t.sessionMode||"immersive-vr",i=t.referenceSpaceType||"local-floor";let s=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+("undefined"==typeof SVGSVGElement?"https://cdn.babylonjs.com/Assets/vrButton.png":"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";s+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';const r=document.createElement("style");r.appendChild(document.createTextNode(s)),document.getElementsByTagName("head")[0].appendChild(r);const n=document.createElement("button");n.className="babylonVRicon",n.title=`${e} - ${i}`,this._buttons.push(new Tc(n,e,i)),this._buttons[this._buttons.length-1].update=function(e){this.element.style.display=null===e||e===this?"":"none",n.className="babylonVRicon"+(e===this?" vrdisplaypresenting":"")},this._updateButtons(null)}const i=e.getEngine().getInputElement();i&&i.parentNode&&(i.parentNode.appendChild(this.overlay),e.onDisposeObservable.addOnce((()=>{this.dispose()})))}async setHelperAsync(e,t){this._helper=e,this._renderTarget=t;const i=this._buttons.map((t=>e.sessionManager.isSessionSupportedAsync(t.sessionMode)));e.onStateChangedObservable.add((e=>{3==e&&this._updateButtons(null)})),(await Promise.all(i)).forEach(((e,t)=>{e?(this.overlay.appendChild(this._buttons[t].element),this._buttons[t].element.onclick=this._enterXRWithButtonIndex.bind(this,t)):$i.S0.Warn(`Session mode "${this._buttons[t].sessionMode}" not supported in browser`)}))}static async CreateAsync(e,t,i){const s=new yc(e,i);return await s.setHelperAsync(t,i.renderTarget||void 0),s}async _enterXRWithButtonIndex(e=0){if(2==this._helper.state)await this._helper.exitXRAsync(),this._updateButtons(null);else if(3==this._helper.state)try{await this._helper.enterXRAsync(this._buttons[e].sessionMode,this._buttons[e].referenceSpaceType,this._renderTarget,{optionalFeatures:this.options.optionalFeatures,requiredFeatures:this.options.requiredFeatures}),this._updateButtons(this._buttons[e])}catch(t){this._updateButtons(null);const i=this._buttons[e].element,s=i.title;i.title="Error entering XR session : "+s,i.classList.add("xr-error"),this.options.onError&&this.options.onError(t)}}dispose(){const e=this._scene.getEngine().getInputElement();e&&e.parentNode&&e.parentNode.contains(this.overlay)&&e.parentNode.removeChild(this.overlay),this.activeButtonChangedObservable.clear(),navigator.xr.removeEventListener("sessiongranted",this._onSessionGranted)}_updateButtons(e){this._activeButton=e,this._buttons.forEach((e=>{e.update(this._activeButton)})),this.activeButtonChangedObservable.notifyObservers(this._activeButton)}}var xc,Ac,Cc=o(959),Sc=o(9039);class Ec{constructor(e,t){this.type=e,this.jointData=t,t.nativeParams=t.nativeParams||{}}get physicsJoint(){return this._physicsJoint}set physicsJoint(e){this._physicsJoint=e}set physicsPlugin(e){this._physicsPlugin=e}executeNativeFunction(e){e(this._physicsPlugin.world,this._physicsJoint)}}Ec.DistanceJoint=0,Ec.HingeJoint=1,Ec.BallAndSocketJoint=2,Ec.WheelJoint=3,Ec.SliderJoint=4,Ec.PrismaticJoint=5,Ec.UniversalJoint=6,Ec.Hinge2Joint=Ec.WheelJoint,Ec.PointToPointJoint=8,Ec.SpringJoint=9,Ec.LockJoint=10,zn.e._PhysicsImpostorParser=function(e,t,i){return new Rc(t,i.physicsImpostor,{mass:i.physicsMass,friction:i.physicsFriction,restitution:i.physicsRestitution},e)};class Rc{get isDisposed(){return this._isDisposed}get mass(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0}set mass(e){this.setMass(e)}get friction(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0}set friction(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,e)}get restitution(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0}set restitution(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,e)}get pressure(){if(!this._physicsEngine)return 0;const e=this._physicsEngine.getPhysicsPlugin();return e.setBodyPressure?e.getBodyPressure(this):0}set pressure(e){if(!this._physicsEngine)return;const t=this._physicsEngine.getPhysicsPlugin();t.setBodyPressure&&t.setBodyPressure(this,e)}get stiffness(){if(!this._physicsEngine)return 0;const e=this._physicsEngine.getPhysicsPlugin();return e.getBodyStiffness?e.getBodyStiffness(this):0}set stiffness(e){if(!this._physicsEngine)return;const t=this._physicsEngine.getPhysicsPlugin();t.setBodyStiffness&&t.setBodyStiffness(this,e)}get velocityIterations(){if(!this._physicsEngine)return 0;const e=this._physicsEngine.getPhysicsPlugin();return e.getBodyVelocityIterations?e.getBodyVelocityIterations(this):0}set velocityIterations(e){if(!this._physicsEngine)return;const t=this._physicsEngine.getPhysicsPlugin();t.setBodyVelocityIterations&&t.setBodyVelocityIterations(this,e)}get positionIterations(){if(!this._physicsEngine)return 0;const e=this._physicsEngine.getPhysicsPlugin();return e.getBodyPositionIterations?e.getBodyPositionIterations(this):0}set positionIterations(e){if(!this._physicsEngine)return;const t=this._physicsEngine.getPhysicsPlugin();t.setBodyPositionIterations&&t.setBodyPositionIterations(this,e)}constructor(e,t,i={mass:0},s){this.object=e,this.type=t,this._options=i,this._scene=s,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=gt.Pq.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new gt.PT,this._tmpQuat2=new gt.PT,this.beforeStep=()=>{this._physicsEngine&&(this.object.translate(this._deltaPosition,-1),this._deltaRotationConjugated&&this.object.rotationQuaternion&&this.object.rotationQuaternion.multiplyToRef(this._deltaRotationConjugated,this.object.rotationQuaternion),this.object.computeWorldMatrix(!1),this.object.parent&&this.object.rotationQuaternion?(this.getParentsRotation(),this._tmpQuat.multiplyToRef(this.object.rotationQuaternion,this._tmpQuat)):this._tmpQuat.copyFrom(this.object.rotationQuaternion||new gt.PT),this._options.disableBidirectionalTransformation||this.object.rotationQuaternion&&this._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(this,this.object.getAbsolutePosition(),this._tmpQuat),this._onBeforePhysicsStepCallbacks.forEach((e=>{e(this)})))},this.afterStep=()=>{this._physicsEngine&&(this._onAfterPhysicsStepCallbacks.forEach((e=>{e(this)})),this._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(this),this.object.parent&&this.object.rotationQuaternion&&(this.getParentsRotation(),this._tmpQuat.conjugateInPlace(),this._tmpQuat.multiplyToRef(this.object.rotationQuaternion,this.object.rotationQuaternion)),this.object.setAbsolutePosition(this.object.position),this._deltaRotation?(this.object.rotationQuaternion&&this.object.rotationQuaternion.multiplyToRef(this._deltaRotation,this.object.rotationQuaternion),this._deltaPosition.applyRotationQuaternionToRef(this._deltaRotation,Rc._TmpVecs[0]),this.object.translate(Rc._TmpVecs[0],1)):this.object.translate(this._deltaPosition,1),this.object.computeWorldMatrix(!0))},this.onCollideEvent=null,this.onCollide=e=>{if(!this._onPhysicsCollideCallbacks.length&&!this.onCollideEvent)return;if(!this._physicsEngine)return;const t=this._physicsEngine.getImpostorWithPhysicsBody(e.body);t&&(this.onCollideEvent&&this.onCollideEvent(this,t),this._onPhysicsCollideCallbacks.filter((e=>-1!==e.otherImpostors.indexOf(t))).forEach((i=>{i.callback(this,t,e.point,e.distance,e.impulse,e.normal)})))},this.object?(this.object.parent&&0!==i.mass&&It.V.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&e.getScene&&(this._scene=e.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=gt.PT.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new gt.PT),this._options.mass=void 0===i.mass?0:i.mass,this._options.friction=void 0===i.friction?.2:i.friction,this._options.restitution=void 0===i.restitution?.2:i.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===i.pressure?200:i.pressure,this._options.stiffness=void 0===i.stiffness?1:i.stiffness,this._options.velocityIterations=void 0===i.velocityIterations?20:i.velocityIterations,this._options.positionIterations=void 0===i.positionIterations?20:i.positionIterations,this._options.fixedPoints=void 0===i.fixedPoints?0:i.fixedPoints,this._options.margin=void 0===i.margin?0:i.margin,this._options.damping=void 0===i.damping?0:i.damping,this._options.path=void 0===i.path?null:i.path,this._options.shape=void 0===i.shape?null:i.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&It.V.Warn("You must affect impostors to children before affecting impostor to parent.")):It.V.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):It.V.Error("No object was provided. A physics object is obligatory")}_init(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))}_getPhysicsParent(){return this.object.parent instanceof Sc.u?this.object.parent.physicsImpostor:null}isBodyInitRequired(){return this._bodyUpdateRequired||!this._physicsBody&&(!this._parent||!!this._options.ignoreParent)}setScalingUpdated(){this.forceUpdate()}forceUpdate(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()}get physicsBody(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody}get parent(){return!this._options.ignoreParent&&this._parent?this._parent:null}set parent(e){this._parent=e}set physicsBody(e){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=e,this.resetUpdateFlags()}resetUpdateFlags(){this._bodyUpdateRequired=!1}getObjectExtents(){if(this.object.getBoundingInfo){const e=this.object.rotationQuaternion,t=this.object.scaling.clone();this.object.rotationQuaternion=Rc.IDENTITY_QUATERNION;const i=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);i&&i.decompose(t,void 0,void 0);const s=this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiplyInPlace(t);return s.x=Math.abs(s.x),s.y=Math.abs(s.y),s.z=Math.abs(s.z),this.object.rotationQuaternion=e,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),s}return Rc.DEFAULT_OBJECT_SIZE}getObjectCenter(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position}getParam(e){return this._options[e]}setParam(e,t){this._options[e]=t,this._bodyUpdateRequired=!0}setMass(e){this.getParam("mass")!==e&&this.setParam("mass",e),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,e)}getLinearVelocity(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):gt.Pq.Zero()}setLinearVelocity(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,e)}getAngularVelocity(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):gt.Pq.Zero()}setAngularVelocity(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,e)}executeNativeFunction(e){this._physicsEngine&&e(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)}registerBeforePhysicsStep(e){this._onBeforePhysicsStepCallbacks.push(e)}unregisterBeforePhysicsStep(e){const t=this._onBeforePhysicsStepCallbacks.indexOf(e);t>-1?this._onBeforePhysicsStepCallbacks.splice(t,1):It.V.Warn("Function to remove was not found")}registerAfterPhysicsStep(e){this._onAfterPhysicsStepCallbacks.push(e)}unregisterAfterPhysicsStep(e){const t=this._onAfterPhysicsStepCallbacks.indexOf(e);t>-1?this._onAfterPhysicsStepCallbacks.splice(t,1):It.V.Warn("Function to remove was not found")}registerOnPhysicsCollide(e,t){const i=e instanceof Array?e:[e];this._onPhysicsCollideCallbacks.push({callback:t,otherImpostors:i})}unregisterOnPhysicsCollide(e,t){const i=e instanceof Array?e:[e];let s=-1;this._onPhysicsCollideCallbacks.some(((e,r)=>{if(e.callback===t&&e.otherImpostors.length===i.length){const t=e.otherImpostors.every((e=>i.indexOf(e)>-1));return t&&(s=r),t}return!1}))?this._onPhysicsCollideCallbacks.splice(s,1):It.V.Warn("Function to remove was not found")}getParentsRotation(){let e=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);e;)e.rotationQuaternion?this._tmpQuat2.copyFrom(e.rotationQuaternion):gt.PT.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,e.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),e=e.parent;return this._tmpQuat}applyForce(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,e,t),this}applyImpulse(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,e,t),this}createJoint(e,t,i){const s=new Ec(t,i);return this.addJoint(e,s),this}addJoint(e,t){return this._joints.push({otherImpostor:e,joint:t}),this._physicsEngine&&this._physicsEngine.addJoint(this,e,t),this}addAnchor(e,t,i,s,r){if(!this._physicsEngine)return this;const n=this._physicsEngine.getPhysicsPlugin();return n.appendAnchor?(this._physicsEngine&&n.appendAnchor(this,e,t,i,s,r),this):this}addHook(e,t,i,s){if(!this._physicsEngine)return this;const r=this._physicsEngine.getPhysicsPlugin();return r.appendAnchor?(this._physicsEngine&&r.appendHook(this,e,t,i,s),this):this}sleep(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this}wakeUp(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this}clone(e){return e?new Rc(e,this.type,this._options,this._scene):null}dispose(){this._physicsEngine&&(this._joints.forEach((e=>{this._physicsEngine&&this._physicsEngine.removeJoint(this,e.otherImpostor,e.joint)})),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)}setDeltaPosition(e){this._deltaPosition.copyFrom(e)}setDeltaRotation(e){this._deltaRotation||(this._deltaRotation=new gt.PT),this._deltaRotation.copyFrom(e),this._deltaRotationConjugated=this._deltaRotation.conjugate()}getBoxSizeToRef(e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,e),this}getRadius(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0}syncBoneWithImpostor(e,t,i,s,r){const n=Rc._TmpVecs[0],o=this.object;if(o.rotationQuaternion)if(r){const i=Rc._TmpQuat;o.rotationQuaternion.multiplyToRef(r,i),e.setRotationQuaternion(i,1,t)}else e.setRotationQuaternion(o.rotationQuaternion,1,t);n.x=0,n.y=0,n.z=0,i&&(n.x=i.x,n.y=i.y,n.z=i.z,e.getDirectionToRef(n,t,n),null==s&&(s=i.length()),n.x*=s,n.y*=s,n.z*=s),e.getParent()?(n.addInPlace(o.getAbsolutePosition()),e.setAbsolutePosition(n,t)):(t.setAbsolutePosition(o.getAbsolutePosition()),t.position.x-=n.x,t.position.y-=n.y,t.position.z-=n.z)}syncImpostorWithBone(e,t,i,s,r,n){const o=this.object;if(o.rotationQuaternion)if(r){const i=Rc._TmpQuat;e.getRotationQuaternionToRef(1,t,i),i.multiplyToRef(r,o.rotationQuaternion)}else e.getRotationQuaternionToRef(1,t,o.rotationQuaternion);const a=Rc._TmpVecs[0],h=Rc._TmpVecs[1];n||((n=Rc._TmpVecs[2]).x=0,n.y=1,n.z=0),e.getDirectionToRef(n,t,h),e.getAbsolutePositionToRef(t,a),null==s&&i&&(s=i.length()),null!=s&&(a.x+=h.x*s,a.y+=h.y*s,a.z+=h.z*s),o.setAbsolutePosition(a)}}Rc.DEFAULT_OBJECT_SIZE=new gt.Pq(1,1,1),Rc.IDENTITY_QUATERNION=gt.PT.Identity(),Rc._TmpVecs=(0,Cc.mI)(3,gt.Pq.Zero),Rc._TmpQuat=gt.PT.Identity(),Rc.NoImpostor=0,Rc.SphereImpostor=1,Rc.BoxImpostor=2,Rc.PlaneImpostor=3,Rc.MeshImpostor=4,Rc.CapsuleImpostor=6,Rc.CylinderImpostor=7,Rc.ParticleImpostor=8,Rc.HeightmapImpostor=9,Rc.ConvexHullImpostor=10,Rc.CustomImpostor=100,Rc.RopeImpostor=101,Rc.ClothImpostor=102,Rc.SoftbodyImpostor=103,function(e){e.WRIST="wrist",e.THUMB="thumb",e.INDEX="index",e.MIDDLE="middle",e.RING="ring",e.LITTLE="little"}(xc||(xc={})),function(e){e.WRIST="wrist",e.THUMB_METACARPAL="thumb-metacarpal",e.THUMB_PHALANX_PROXIMAL="thumb-phalanx-proximal",e.THUMB_PHALANX_DISTAL="thumb-phalanx-distal",e.THUMB_TIP="thumb-tip",e.INDEX_FINGER_METACARPAL="index-finger-metacarpal",e.INDEX_FINGER_PHALANX_PROXIMAL="index-finger-phalanx-proximal",e.INDEX_FINGER_PHALANX_INTERMEDIATE="index-finger-phalanx-intermediate",e.INDEX_FINGER_PHALANX_DISTAL="index-finger-phalanx-distal",e.INDEX_FINGER_TIP="index-finger-tip",e.MIDDLE_FINGER_METACARPAL="middle-finger-metacarpal",e.MIDDLE_FINGER_PHALANX_PROXIMAL="middle-finger-phalanx-proximal",e.MIDDLE_FINGER_PHALANX_INTERMEDIATE="middle-finger-phalanx-intermediate",e.MIDDLE_FINGER_PHALANX_DISTAL="middle-finger-phalanx-distal",e.MIDDLE_FINGER_TIP="middle-finger-tip",e.RING_FINGER_METACARPAL="ring-finger-metacarpal",e.RING_FINGER_PHALANX_PROXIMAL="ring-finger-phalanx-proximal",e.RING_FINGER_PHALANX_INTERMEDIATE="ring-finger-phalanx-intermediate",e.RING_FINGER_PHALANX_DISTAL="ring-finger-phalanx-distal",e.RING_FINGER_TIP="ring-finger-tip",e.PINKY_FINGER_METACARPAL="pinky-finger-metacarpal",e.PINKY_FINGER_PHALANX_PROXIMAL="pinky-finger-phalanx-proximal",e.PINKY_FINGER_PHALANX_INTERMEDIATE="pinky-finger-phalanx-intermediate",e.PINKY_FINGER_PHALANX_DISTAL="pinky-finger-phalanx-distal",e.PINKY_FINGER_TIP="pinky-finger-tip"}(Ac||(Ac={}));const Pc=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],Ic={wrist:["wrist"],thumb:["thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip"],index:["index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip"],middle:["middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip"],ring:["ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip"],little:["pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]};class Mc{get handMesh(){return this._handMesh}getHandPartMeshes(e){return Ic[e].map((e=>this._jointMeshes[Pc.indexOf(e)]))}getJointMesh(e){return this._jointMeshes[Pc.indexOf(e)]}constructor(e,t,i,s,r=!1,n=!1,o=1){this.xrController=e,this._jointMeshes=t,this._handMesh=i,this.rigMapping=s,this._leftHandedMeshes=r,this._jointsInvisible=n,this._jointScaleFactor=o,this.onHandMeshSetObservable=new Zi.cP,this._jointTransforms=new Array(Pc.length),this._jointTransformMatrices=new Float32Array(16*Pc.length),this._tempJointMatrix=new gt.uq,this._jointRadii=new Float32Array(Pc.length),this._scene=t[0].getScene();for(let e=0;e<this._jointTransforms.length;e++)this._jointTransforms[e]=new Gn.V(Pc[e],this._scene),this._jointTransforms[e].rotationQuaternion=new gt.PT,t[e].rotationQuaternion?t[e].rotationQuaternion=new gt.PT:t[e].rotationQuaternion?.set(0,0,0,1);i&&this.setHandMesh(i,s),this.xrController.motionController&&this.xrController.motionController.rootMesh&&this.xrController.motionController.rootMesh.dispose(!1,!0),this.xrController.onMotionControllerInitObservable.add((e=>{e._doNotLoadControllerMesh=!0}))}setHandMesh(e,t,i){if(this._handMesh=e,e.alwaysSelectAsActiveMesh=!0,e.getChildMeshes().forEach((e=>{e.alwaysSelectAsActiveMesh=!0})),this._handMesh.skeleton){const e=this._handMesh.skeleton;Pc.forEach(((i,s)=>{const r=e.getBoneIndexByName(t?t[i]:i);-1!==r&&e.bones[r].linkTransformNode(this._jointTransforms[s])}))}this.onHandMeshSetObservable.notifyObservers(this)}updateFromXRFrame(e,t){const i=this.xrController.inputSource.hand;if(!i)return;const s=i,r=Pc.map((e=>s[e]||i.get(e)));let n=!1;if(e.fillPoses&&e.fillJointRadii)n=e.fillPoses(r,t,this._jointTransformMatrices)&&e.fillJointRadii(r,this._jointRadii);else if(e.getJointPose){n=!0;for(let i=0;i<r.length;i++){const s=e.getJointPose(r[i],t);if(!s){n=!1;break}this._jointTransformMatrices.set(s.transform.matrix,16*i),this._jointRadii[i]=s.radius||.008}}n&&(Pc.forEach(((e,t)=>{const i=this._jointTransforms[t];gt.uq.FromArrayToRef(this._jointTransformMatrices,16*t,this._tempJointMatrix),this._tempJointMatrix.decompose(void 0,i.rotationQuaternion,i.position);const s=this._jointRadii[t]*this._jointScaleFactor,r=this._jointMeshes[t];r.isVisible=!this._handMesh&&!this._jointsInvisible,r.position.copyFrom(i.position),r.rotationQuaternion.copyFrom(i.rotationQuaternion),r.scaling.setAll(s),this._scene.useRightHandedSystem||(r.position.z*=-1,r.rotationQuaternion.z*=-1,r.rotationQuaternion.w*=-1,this._leftHandedMeshes&&this._handMesh&&(i.position.z*=-1,i.rotationQuaternion.z*=-1,i.rotationQuaternion.w*=-1))})),this._handMesh&&(this._handMesh.isVisible=!0))}dispose(e=!1){this._handMesh&&(e?(this._handMesh.skeleton?.dispose(),this._handMesh.dispose(!1,!0)):this._handMesh.isVisible=!1),this._jointTransforms.forEach((e=>e.dispose())),this._jointTransforms.length=0,this.onHandMeshSetObservable.clear()}}class wc extends Tl{static _GenerateTrackedJointMeshes(e,t=Ho("jointParent",wc._ICOSPHERE_PARAMS)){const i={};return["left","right"].map((s=>{const r=[];t.isVisible=!!e.jointMeshes?.keepOriginalVisible;for(let i=0;i<Pc.length;++i){let n=t.createInstance(`${s}-handJoint-${i}`);if(e.jointMeshes?.onHandJointMeshGenerated){const t=e.jointMeshes.onHandJointMeshGenerated(n,i,s);t&&t!==n&&(n.dispose(),n=t)}if(n.isPickable=!1,e.jointMeshes?.enablePhysics){const t=e.jointMeshes?.physicsProps||{};n.scaling.setAll(.02);const i=void 0!==t.impostorType?t.impostorType:Rc.SphereImpostor;n.physicsImpostor=new Rc(n,i,{mass:0,...t})}n.rotationQuaternion=new gt.PT,n.isVisible=!1,r.push(n)}i[s]=r})),{left:i.left,right:i.right}}static _GenerateDefaultHandMeshesAsync(e,t,i){return new Promise((async s=>{const r={};wc._RightHandGLB?.meshes[1]?.isDisposed()&&(wc._RightHandGLB=null),wc._LeftHandGLB?.meshes[1]?.isDisposed()&&(wc._LeftHandGLB=null);const n=!(!wc._RightHandGLB||!wc._LeftHandGLB),o=$i.S0.GetAssetUrl(wc.DEFAULT_HAND_MODEL_BASE_URL),a=await Promise.all([wc._RightHandGLB||Ue.cn.ImportMeshAsync("",o,wc.DEFAULT_HAND_MODEL_RIGHT_FILENAME,e),wc._LeftHandGLB||Ue.cn.ImportMeshAsync("",o,wc.DEFAULT_HAND_MODEL_LEFT_FILENAME,e)]);wc._RightHandGLB=a[0],wc._LeftHandGLB=a[1];const h=$i.S0.GetAssetUrl(wc.DEFAULT_HAND_MODEL_SHADER_URL),l=await pc.ParseFromFileAsync("handShader",h,e,void 0,!0);l.needDepthPrePass=!0,l.transparencyMode=as.i.MATERIAL_ALPHABLEND,l.alphaMode=2,l.build(!1);const c={base:bt.v9.FromInts(116,63,203),fresnel:bt.v9.FromInts(149,102,229),fingerColor:bt.v9.FromInts(177,130,255),tipFresnel:bt.v9.FromInts(220,200,255),...i?.handMeshes?.customColors},u={base:l.getBlockByName("baseColor"),fresnel:l.getBlockByName("fresnelColor"),fingerColor:l.getBlockByName("fingerColor"),tipFresnel:l.getBlockByName("tipFresnelColor")};u.base.value=c.base,u.fresnel.value=c.fresnel,u.fingerColor.value=c.fingerColor,u.tipFresnel.value=c.tipFresnel;const d=t._getBaseLayerWrapper()?.isMultiview;["left","right"].forEach((t=>{const s="left"==t?wc._LeftHandGLB:wc._RightHandGLB;if(!s)throw new Error("Could not load hand model");const o=s.meshes[1];o._internalAbstractMeshDataInfo._computeBonesUsingShaders=!0,d||i?.handMeshes?.disableHandShader||(o.material=l.clone(`${t}HandShaderClone`,!0)),o.isVisible=!1,r[t]=o,n||e.useRightHandedSystem||s.meshes[1].rotate(ho._0.Y,Math.PI)})),l.dispose(),s({left:r.left,right:r.right})}))}static _GenerateDefaultHandMeshRigMapping(e){const t="right"==e?"R":"L";return{wrist:`wrist_${t}`,"thumb-metacarpal":`thumb_metacarpal_${t}`,"thumb-phalanx-proximal":`thumb_proxPhalanx_${t}`,"thumb-phalanx-distal":`thumb_distPhalanx_${t}`,"thumb-tip":`thumb_tip_${t}`,"index-finger-metacarpal":`index_metacarpal_${t}`,"index-finger-phalanx-proximal":`index_proxPhalanx_${t}`,"index-finger-phalanx-intermediate":`index_intPhalanx_${t}`,"index-finger-phalanx-distal":`index_distPhalanx_${t}`,"index-finger-tip":`index_tip_${t}`,"middle-finger-metacarpal":`middle_metacarpal_${t}`,"middle-finger-phalanx-proximal":`middle_proxPhalanx_${t}`,"middle-finger-phalanx-intermediate":`middle_intPhalanx_${t}`,"middle-finger-phalanx-distal":`middle_distPhalanx_${t}`,"middle-finger-tip":`middle_tip_${t}`,"ring-finger-metacarpal":`ring_metacarpal_${t}`,"ring-finger-phalanx-proximal":`ring_proxPhalanx_${t}`,"ring-finger-phalanx-intermediate":`ring_intPhalanx_${t}`,"ring-finger-phalanx-distal":`ring_distPhalanx_${t}`,"ring-finger-tip":`ring_tip_${t}`,"pinky-finger-metacarpal":`little_metacarpal_${t}`,"pinky-finger-phalanx-proximal":`little_proxPhalanx_${t}`,"pinky-finger-phalanx-intermediate":`little_intPhalanx_${t}`,"pinky-finger-phalanx-distal":`little_distPhalanx_${t}`,"pinky-finger-tip":`little_tip_${t}`}}isCompatible(){return"undefined"!=typeof XRHand}getHandByControllerId(e){return this._attachedHands[e]}getHandByHandedness(e){return"none"==e?null:this._trackingHands[e]}constructor(e,t){super(e),this.options=t,this._attachedHands={},this._trackingHands={left:null,right:null},this._handResources={jointMeshes:null,handMeshes:null,rigMappings:null},this._worldScaleObserver=null,this.onHandAddedObservable=new Zi.cP,this.onHandRemovedObservable=new Zi.cP,this._attachHand=e=>{if(!e.inputSource.hand||"none"==e.inputSource.handedness||!this._handResources.jointMeshes)return;const t=e.inputSource.handedness,i=new Mc(e,this._handResources.jointMeshes[t],this._handResources.handMeshes&&this._handResources.handMeshes[t],this._handResources.rigMappings&&this._handResources.rigMappings[t],this.options.handMeshes?.meshesUseLeftHandedCoordinates,this.options.jointMeshes?.invisible,this.options.jointMeshes?.scaleFactor);this._attachedHands[e.uniqueId]=i,this._trackingHands[t]=i,this.onHandAddedObservable.notifyObservers(i)},this._detachHand=e=>{this._detachHandById(e.uniqueId)},this.xrNativeFeatureName="hand-tracking";const i=t.jointMeshes;if(i&&(void 0!==i.disableDefaultHandMesh&&(t.handMeshes=t.handMeshes||{},t.handMeshes.disableDefaultMeshes=i.disableDefaultHandMesh),void 0!==i.handMeshes&&(t.handMeshes=t.handMeshes||{},t.handMeshes.customMeshes=i.handMeshes),void 0!==i.leftHandedSystemMeshes&&(t.handMeshes=t.handMeshes||{},t.handMeshes.meshesUseLeftHandedCoordinates=i.leftHandedSystemMeshes),void 0!==i.rigMapping)){t.handMeshes=t.handMeshes||{};const e={},s={};[[i.rigMapping.left,e],[i.rigMapping.right,s]].forEach((e=>{const t=e[0],i=e[1];t.forEach(((e,t)=>{i[Pc[t]]=e}))})),t.handMeshes.customRigMappings={left:e,right:s}}}attach(){return!!super.attach()&&(this._handResources.jointMeshes||(this._originalMesh=this._originalMesh||this.options.jointMeshes?.sourceMesh||Ho("jointParent",wc._ICOSPHERE_PARAMS),this._originalMesh.isVisible=!1,this._handResources.jointMeshes=wc._GenerateTrackedJointMeshes(this.options,this._originalMesh)),this._handResources.handMeshes=this.options.handMeshes?.customMeshes||null,this._handResources.rigMappings=this.options.handMeshes?.customRigMappings||null,this.options.handMeshes?.customMeshes||this.options.handMeshes?.disableDefaultMeshes||(wc._GenerateDefaultHandMeshesAsync(os.q.LastCreatedScene,this._xrSessionManager,this.options).then((e=>{this._handResources.handMeshes=e,this._handResources.rigMappings={left:wc._GenerateDefaultHandMeshRigMapping("left"),right:wc._GenerateDefaultHandMeshRigMapping("right")},this._trackingHands.left?.setHandMesh(this._handResources.handMeshes.left,this._handResources.rigMappings.left,this._xrSessionManager),this._trackingHands.right?.setHandMesh(this._handResources.handMeshes.right,this._handResources.rigMappings.right,this._xrSessionManager),this._handResources.handMeshes.left.scaling.setAll(this._xrSessionManager.worldScalingFactor),this._handResources.handMeshes.right.scaling.setAll(this._xrSessionManager.worldScalingFactor)})),this._worldScaleObserver=this._xrSessionManager.onWorldScaleFactorChangedObservable.add((e=>{this._handResources.handMeshes&&(this._handResources.handMeshes.left.scaling.scaleInPlace(e.newScaleFactor/e.previousScaleFactor),this._handResources.handMeshes.right.scaling.scaleInPlace(e.newScaleFactor/e.previousScaleFactor))}))),this.options.xrInput.controllers.forEach(this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerAddedObservable,this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerRemovedObservable,this._detachHand),!0)}_onXRFrame(e){this._trackingHands.left?.updateFromXRFrame(e,this._xrSessionManager.referenceSpace),this._trackingHands.right?.updateFromXRFrame(e,this._xrSessionManager.referenceSpace)}_detachHandById(e,t){const i=this.getHandByControllerId(e);if(i){const s="left"==i.xrController.inputSource.handedness?"left":"right";this._trackingHands[s]?.xrController.uniqueId===e&&(this._trackingHands[s]=null),this.onHandRemovedObservable.notifyObservers(i),i.dispose(t),delete this._attachedHands[e]}}detach(){return!!super.detach()&&(Object.keys(this._attachedHands).forEach((e=>this._detachHandById(e,this.options.handMeshes?.disposeOnSessionEnd))),this.options.handMeshes?.disposeOnSessionEnd&&(this._handResources.jointMeshes&&(this._handResources.jointMeshes.left.forEach((e=>e.dispose())),this._handResources.jointMeshes.right.forEach((e=>e.dispose())),this._handResources.jointMeshes=null),this._handResources.handMeshes&&(this._handResources.handMeshes.left.dispose(),this._handResources.handMeshes.right.dispose(),this._handResources.handMeshes=null),wc._RightHandGLB?.meshes.forEach((e=>e.dispose())),wc._LeftHandGLB?.meshes.forEach((e=>e.dispose())),wc._RightHandGLB=null,wc._LeftHandGLB=null,this._originalMesh?.dispose(),this._originalMesh=void 0),this._worldScaleObserver&&this._xrSessionManager.onWorldScaleFactorChangedObservable.remove(this._worldScaleObserver),!0)}dispose(){super.dispose(),this.onHandAddedObservable.clear(),this.onHandRemovedObservable.clear(),this._handResources.handMeshes&&!this.options.handMeshes?.customMeshes&&(this._handResources.handMeshes.left.dispose(),this._handResources.handMeshes.right.dispose(),wc._RightHandGLB?.meshes.forEach((e=>e.dispose())),wc._LeftHandGLB?.meshes.forEach((e=>e.dispose())),wc._RightHandGLB=null,wc._LeftHandGLB=null),this._handResources.jointMeshes&&(this._handResources.jointMeshes.left.forEach((e=>e.dispose())),this._handResources.jointMeshes.right.forEach((e=>e.dispose())))}}wc.Name=rl.HAND_TRACKING,wc.Version=1,wc.DEFAULT_HAND_MODEL_BASE_URL="https://assets.babylonjs.com/core/HandMeshes/",wc.DEFAULT_HAND_MODEL_RIGHT_FILENAME="r_hand_rhs.glb",wc.DEFAULT_HAND_MODEL_LEFT_FILENAME="l_hand_rhs.glb",wc.DEFAULT_HAND_MODEL_SHADER_URL="https://assets.babylonjs.com/core/HandMeshes/handsShader.json",wc._ICOSPHERE_PARAMS={radius:.5,flat:!1,subdivisions:2},wc._RightHandGLB=null,wc._LeftHandGLB=null,nl.AddWebXRFeature(wc.Name,((e,t)=>()=>new wc(e,t)),wc.Version,!1);var Oc,Bc,Dc=o(7230);class Fc extends Tl{get rotationEnabled(){return this._rotationEnabled}set rotationEnabled(e){if(this._rotationEnabled=e,this._options.teleportationTargetMesh){const t=this._options.teleportationTargetMesh.getChildMeshes(!1,(e=>"rotationCone"===e.name));t[0]&&t[0].setEnabled(e)}}get teleportationTargetMesh(){return this._options.teleportationTargetMesh||null}constructor(e,t){super(e),this._options=t,this._controllers={},this._snappedToPoint=!1,this._cachedColor4White=new bt.ov(1,1,1,1),this._tmpRay=new fa.Rl(new gt.Pq,new gt.Pq),this._tmpVector=new gt.Pq,this._tmpQuaternion=new gt.PT,this._worldScaleObserver=null,this.skipNextTeleportation=!1,this.backwardsMovementEnabled=!0,this.backwardsTeleportationDistance=.7,this.parabolicCheckRadius=5,this.parabolicRayEnabled=!0,this.straightRayEnabled=!0,this.rotationAngle=Math.PI/8,this.onTargetMeshPositionUpdatedObservable=new Zi.cP,this.teleportationEnabled=!0,this._rotationEnabled=!0,this.onBeforeCameraTeleportRotation=new Zi.cP,this.onAfterCameraTeleportRotation=new Zi.cP,this._attachController=e=>{if(this._controllers[e.uniqueId]||this._options.forceHandedness&&e.inputSource.handedness!==this._options.forceHandedness)return;this._controllers[e.uniqueId]={xrController:e,teleportationState:{forward:!1,backwards:!1,rotating:!1,currentRotation:0,baseRotation:0,blocked:!1,initialHit:!1,mainComponentUsed:!1}};const t=this._controllers[e.uniqueId];if("tracked-pointer"===t.xrController.inputSource.targetRayMode&&t.xrController.inputSource.gamepad){const i=()=>{if(e.motionController){const i=e.motionController.getComponentOfType(ll.THUMBSTICK_TYPE)||e.motionController.getComponentOfType(ll.TOUCHPAD_TYPE);if(!i||this._options.useMainComponentOnly){const i=e.motionController.getMainComponent();if(!i)return;t.teleportationState.mainComponentUsed=!0,t.teleportationComponent=i,t.onButtonChangedObserver=i.onButtonStateChangedObservable.add((()=>{if(!this.teleportationEnabled)return;const s=()=>{t.teleportationState.forward=!0,t.teleportationState.initialHit=!1,this._currentTeleportationControllerId=t.xrController.uniqueId,t.teleportationState.baseRotation=this._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,t.teleportationState.currentRotation=0;const s=this._options.timeToTeleport||3e3;(0,Dc.fj)({timeout:s,contextObservable:this._xrSessionManager.onXRFrameObservable,breakCondition:()=>!i.pressed,onEnded:()=>{this._currentTeleportationControllerId===t.xrController.uniqueId&&t.teleportationState.forward&&this._teleportForward(e.uniqueId)}})};i.changes.pressed&&(i.changes.pressed.current?this._options.timeToTeleportStart?(0,Dc.fj)({timeout:this._options.timeToTeleportStart,contextObservable:this._xrSessionManager.onXRFrameObservable,onEnded:()=>{i.pressed&&s()}}):s():(t.teleportationState.forward=!1,this._currentTeleportationControllerId=""))}))}else t.teleportationComponent=i,t.onAxisChangedObserver=i.onAxisValueChangedObservable.add((i=>{if(i.y<=.7&&t.teleportationState.backwards&&(t.teleportationState.backwards=!1),i.y>.7&&!t.teleportationState.forward&&this.backwardsMovementEnabled&&!this.snapPointsOnly&&!t.teleportationState.backwards){t.teleportationState.backwards=!0,this._tmpQuaternion.copyFrom(this._options.xrInput.xrCamera.rotationQuaternion),this._tmpQuaternion.toEulerAnglesToRef(this._tmpVector),this._tmpVector.x=0,this._tmpVector.z=0,gt.PT.FromEulerVectorToRef(this._tmpVector,this._tmpQuaternion),this._tmpVector.set(0,0,this.backwardsTeleportationDistance*(this._xrSessionManager.scene.useRightHandedSystem?1:-1)),this._tmpVector.rotateByQuaternionToRef(this._tmpQuaternion,this._tmpVector),this._tmpVector.addInPlace(this._options.xrInput.xrCamera.position),this._tmpRay.origin.copyFrom(this._tmpVector),this._tmpRay.length=this._options.xrInput.xrCamera.realWorldHeight+.1,this._tmpRay.direction.set(0,-1,0);const e=this._xrSessionManager.scene.pickWithRay(this._tmpRay,(e=>-1!==this._floorMeshes.indexOf(e)));e&&e.pickedPoint&&(this._options.xrInput.xrCamera.position.x=e.pickedPoint.x,this._options.xrInput.xrCamera.position.z=e.pickedPoint.z)}if(i.y<-.7&&!this._currentTeleportationControllerId&&!t.teleportationState.rotating&&this.teleportationEnabled&&(t.teleportationState.forward=!0,this._currentTeleportationControllerId=t.xrController.uniqueId,t.teleportationState.baseRotation=this._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y),i.x){if(t.teleportationState.forward)this._currentTeleportationControllerId===t.xrController.uniqueId&&(this.rotationEnabled?setTimeout((()=>{t.teleportationState.currentRotation=Math.atan2(i.x,i.y*(this._xrSessionManager.scene.useRightHandedSystem?1:-1))})):t.teleportationState.currentRotation=0);else if(!t.teleportationState.rotating&&Math.abs(i.x)>.7){t.teleportationState.rotating=!0;const e=this.rotationAngle*(i.x>0?1:-1)*(this._xrSessionManager.scene.useRightHandedSystem?-1:1);this.onBeforeCameraTeleportRotation.notifyObservers(e),gt.PT.FromEulerAngles(0,e,0).multiplyToRef(this._options.xrInput.xrCamera.rotationQuaternion,this._options.xrInput.xrCamera.rotationQuaternion),this.onAfterCameraTeleportRotation.notifyObservers(this._options.xrInput.xrCamera.rotationQuaternion)}}else t.teleportationState.rotating=!1;0===i.x&&0===i.y&&(t.teleportationState.blocked&&(t.teleportationState.blocked=!1,this._setTargetMeshVisibility(!1)),t.teleportationState.forward&&this._teleportForward(e.uniqueId))}))}};e.motionController?i():e.onMotionControllerInitObservable.addOnce((()=>{i()}))}else{t.teleportationState.mainComponentUsed=!0;let i=!1;const s=()=>{this._currentTeleportationControllerId=t.xrController.uniqueId,t.teleportationState.forward=!0,t.teleportationState.initialHit=!1,t.teleportationState.baseRotation=this._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,t.teleportationState.currentRotation=0;const i=this._options.timeToTeleport||3e3;(0,Dc.fj)({timeout:i,contextObservable:this._xrSessionManager.onXRFrameObservable,onEnded:()=>{this._currentTeleportationControllerId===t.xrController.uniqueId&&t.teleportationState.forward&&this._teleportForward(e.uniqueId)}})};this._xrSessionManager.scene.onPointerObservable.add((e=>{e.type===tt.Zp.POINTERDOWN?(i=!1,this._options.timeToTeleportStart?(0,Dc.fj)({timeout:this._options.timeToTeleportStart,contextObservable:this._xrSessionManager.onXRFrameObservable,onEnded:()=>{this._currentTeleportationControllerId===t.xrController.uniqueId&&s()},breakCondition:()=>!!i&&(i=!1,!0)}):s()):e.type===tt.Zp.POINTERUP&&(i=!0,t.teleportationState.forward=!1,this._currentTeleportationControllerId="")}))}},this._colorArray=Array(24).fill(this._cachedColor4White),this._options.teleportationTargetMesh||this._createDefaultTargetMesh(),this._floorMeshes=this._options.floorMeshes||[],this._snapToPositions=this._options.snapPositions||[],this._blockedRayColor=this._options.blockedRayColor||new bt.ov(1,0,0,.75),this._setTargetMeshVisibility(!1),this.onBeforeCameraTeleport=t.xrInput.xrCamera.onBeforeCameraTeleport,this.onAfterCameraTeleport=t.xrInput.xrCamera.onAfterCameraTeleport,this.parabolicCheckRadius*=this._xrSessionManager.worldScalingFactor,this._worldScaleObserver=e.onWorldScaleFactorChangedObservable.add((e=>{this.parabolicCheckRadius=this.parabolicCheckRadius/e.previousScaleFactor*e.newScaleFactor,this._options.teleportationTargetMesh?.scaling.scaleInPlace(e.newScaleFactor/e.previousScaleFactor)}))}get snapPointsOnly(){return!!this._options.snapPointsOnly}set snapPointsOnly(e){this._options.snapPointsOnly=e}addFloorMesh(e){this._floorMeshes.push(e)}addBlockerMesh(e){this._options.pickBlockerMeshes=this._options.pickBlockerMeshes||[],this._options.pickBlockerMeshes.push(e)}addSnapPoint(e){this._snapToPositions.push(e)}attach(){return!!super.attach()&&(this._currentTeleportationControllerId="",this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(e=>{this._detachController(e.uniqueId)})),!0)}detach(){return!!super.detach()&&(Object.keys(this._controllers).forEach((e=>{this._detachController(e)})),this._setTargetMeshVisibility(!1),this._currentTeleportationControllerId="",this._controllers={},!0)}dispose(){super.dispose(),this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.dispose(!1,!0),this._worldScaleObserver&&this._xrSessionManager.onWorldScaleFactorChangedObservable.remove(this._worldScaleObserver),this.onTargetMeshPositionUpdatedObservable.clear(),this.onTargetMeshPositionUpdatedObservable.clear(),this.onBeforeCameraTeleportRotation.clear(),this.onAfterCameraTeleportRotation.clear(),this.onBeforeCameraTeleport.clear(),this.onAfterCameraTeleport.clear()}removeFloorMesh(e){const t=this._floorMeshes.indexOf(e);-1!==t&&this._floorMeshes.splice(t,1)}removeBlockerMesh(e){this._options.pickBlockerMeshes=this._options.pickBlockerMeshes||[];const t=this._options.pickBlockerMeshes.indexOf(e);-1!==t&&this._options.pickBlockerMeshes.splice(t,1)}removeFloorMeshByName(e){const t=this._xrSessionManager.scene.getMeshByName(e);t&&this.removeFloorMesh(t)}removeSnapPoint(e){let t=this._snapToPositions.indexOf(e);if(-1===t)for(let i=0;i<this._snapToPositions.length;++i)if(this._snapToPositions[i].equals(e)){t=i;break}return-1!==t&&(this._snapToPositions.splice(t,1),!0)}setSelectionFeature(e){this._selectionFeature=e}_onXRFrame(e){const t=this._xrSessionManager.currentFrame,i=this._xrSessionManager.scene;if(!this.attach||!t)return;const s=this._options.teleportationTargetMesh;if(this._currentTeleportationControllerId){if(!s)return;s.rotationQuaternion=s.rotationQuaternion||new gt.PT;const e=this._controllers[this._currentTeleportationControllerId];if(e&&e.teleportationState.forward){gt.PT.RotationYawPitchRollToRef(e.teleportationState.currentRotation+e.teleportationState.baseRotation,0,0,s.rotationQuaternion);let t=!1;const r="transient-pointer"!==e.xrController.inputSource.targetRayMode;if(e.xrController.getWorldPointerRayToRef(this._tmpRay),this.straightRayEnabled){const s=i.pickWithRay(this._tmpRay,(e=>{if(this._options.blockerMeshesPredicate&&this._options.blockerMeshesPredicate(e))return!0;if(this._options.blockAllPickableMeshes&&e.isPickable)return!0;if(this._options.pickBlockerMeshes&&-1!==this._options.pickBlockerMeshes.indexOf(e))return!0;const t=this._floorMeshes.indexOf(e);return-1!==t&&this._floorMeshes[t].absolutePosition.y<this._options.xrInput.xrCamera.globalPosition.y})),n=s&&s.pickedMesh&&-1!==this._floorMeshes.indexOf(s.pickedMesh);if(s&&s.pickedMesh&&!n)return e.teleportationState.mainComponentUsed&&!e.teleportationState.initialHit?void(e.teleportationState.forward=!1):(e.teleportationState.blocked=!0,this._setTargetMeshVisibility(!1,!1,r),void this._showParabolicPath(s));s&&s.pickedPoint&&(e.teleportationState.initialHit=!0,e.teleportationState.blocked=!1,t=!0,this._setTargetMeshPosition(s),this._setTargetMeshVisibility(!0,!1,r),this._showParabolicPath(s))}if(this.parabolicRayEnabled&&!t){const s=e.xrController.pointer.rotationQuaternion.toEulerAngles().x,n=Math.PI/2-Math.abs(s)+1,o=this.parabolicCheckRadius*n;this._tmpRay.origin.addToRef(this._tmpRay.direction.scale(2*o),this._tmpVector),this._tmpVector.y=this._tmpRay.origin.y,this._tmpRay.origin.addInPlace(this._tmpRay.direction.scale(o)),this._tmpVector.subtractToRef(this._tmpRay.origin,this._tmpRay.direction),this._tmpRay.direction.normalize();const a=i.pickWithRay(this._tmpRay,(e=>!(!this._options.blockerMeshesPredicate||!this._options.blockerMeshesPredicate(e))||!(!this._options.blockAllPickableMeshes||!e.isPickable)||!(!this._options.pickBlockerMeshes||-1===this._options.pickBlockerMeshes.indexOf(e))||-1!==this._floorMeshes.indexOf(e))),h=a&&a.pickedMesh&&-1!==this._floorMeshes.indexOf(a.pickedMesh);if(a&&a.pickedMesh&&!h)return e.teleportationState.mainComponentUsed&&!e.teleportationState.initialHit?void(e.teleportationState.forward=!1):(e.teleportationState.blocked=!0,this._setTargetMeshVisibility(!1,!1,r),void this._showParabolicPath(a));a&&a.pickedPoint&&(e.teleportationState.initialHit=!0,e.teleportationState.blocked=!1,t=!0,this._setTargetMeshPosition(a),this._setTargetMeshVisibility(!0,!1,r),this._showParabolicPath(a))}this._setTargetMeshVisibility(t,!1,r)}else this._setTargetMeshVisibility(!1,!1,!0)}else this._disposeBezierCurve(),this._setTargetMeshVisibility(!1,!1,!0)}_createDefaultTargetMesh(){this._options.defaultTargetMeshOptions=this._options.defaultTargetMeshOptions||{};const e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||yl.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,t=Jn("teleportationTarget",{width:2,height:2,subdivisions:2},e);if(t.isPickable=!1,this._options.defaultTargetMeshOptions.teleportationCircleMaterial)t.material=this._options.defaultTargetMeshOptions.teleportationCircleMaterial;else{const i=512,s=new ns("teleportationPlaneDynamicTexture",i,e,!0);s.hasAlpha=!0;const r=s.getContext(),n=i/2,o=i/2,a=200;r.beginPath(),r.arc(n,o,a,0,2*Math.PI,!1),r.fillStyle=this._options.defaultTargetMeshOptions.teleportationFillColor||"#444444",r.fill(),r.lineWidth=10,r.strokeStyle=this._options.defaultTargetMeshOptions.teleportationBorderColor||"#FFFFFF",r.stroke(),r.closePath(),s.update();const h=new ft.F("teleportationPlaneMaterial",e);h.diffuseTexture=s,t.material=h}const i=_o("torusTeleportation",{diameter:.75,thickness:.1,tessellation:20},e);if(i.isPickable=!1,i.parent=t,!this._options.defaultTargetMeshOptions.disableAnimation){const t=new Ja.X5("animationInnerCircle","position.y",30,Ja.X5.ANIMATIONTYPE_FLOAT,Ja.X5.ANIMATIONLOOPMODE_CYCLE),s=[];s.push({frame:0,value:0}),s.push({frame:30,value:.4}),s.push({frame:60,value:0}),t.setKeys(s);const r=new $a;r.setEasingMode(Ya.EASINGMODE_EASEINOUT),t.setEasingFunction(r),i.animations=[],i.animations.push(t),e.beginAnimation(i,0,60,!0)}const s=co("rotationCone",{diameterTop:0,tessellation:4},e);if(s.isPickable=!1,s.scaling.set(.5,.12,.2),s.rotate(ho._0.X,Math.PI/2),s.position.z=.6,s.parent=i,this._options.defaultTargetMeshOptions.torusArrowMaterial)i.material=this._options.defaultTargetMeshOptions.torusArrowMaterial,s.material=this._options.defaultTargetMeshOptions.torusArrowMaterial;else{const t=new ft.F("torusConsMat",e);t.disableLighting=!!this._options.defaultTargetMeshOptions.disableLighting,t.disableLighting?t.emissiveColor=new bt.v9(.3,.3,1):t.diffuseColor=new bt.v9(.3,.3,1),t.alpha=.9,i.material=t,s.material=t,this._teleportationRingMaterial=t}void 0!==this._options.renderingGroupId&&(t.renderingGroupId=this._options.renderingGroupId,i.renderingGroupId=this._options.renderingGroupId,s.renderingGroupId=this._options.renderingGroupId),this._options.teleportationTargetMesh=t,this._options.teleportationTargetMesh.scaling.setAll(this._xrSessionManager.worldScalingFactor),this._setTargetMeshVisibility(!1)}_detachController(e){const t=this._controllers[e];t&&(t.teleportationComponent&&(t.onAxisChangedObserver&&t.teleportationComponent.onAxisValueChangedObservable.remove(t.onAxisChangedObserver),t.onButtonChangedObserver&&t.teleportationComponent.onButtonStateChangedObservable.remove(t.onButtonChangedObserver)),delete this._controllers[e])}_findClosestSnapPointWithRadius(e,t=this._options.snapToPositionRadius||.8){let i=null,s=Number.MAX_VALUE;if(this._snapToPositions.length){const r=t*t;this._snapToPositions.forEach((t=>{const n=gt.Pq.DistanceSquared(t,e);n<=r&&n<s&&(s=n,i=t)}))}return i}_setTargetMeshPosition(e){const t=e.pickedPoint;if(!this._options.teleportationTargetMesh||!t)return;const i=this._findClosestSnapPointWithRadius(t);this._snappedToPoint=!!i,this.snapPointsOnly&&!this._snappedToPoint&&this._teleportationRingMaterial?this._teleportationRingMaterial.diffuseColor.set(1,.3,.3):this.snapPointsOnly&&this._snappedToPoint&&this._teleportationRingMaterial&&this._teleportationRingMaterial.diffuseColor.set(.3,.3,1),this._options.teleportationTargetMesh.position.copyFrom(i||t),this._options.teleportationTargetMesh.position.y+=.01,this.onTargetMeshPositionUpdatedObservable.notifyObservers(e)}_setTargetMeshVisibility(e,t,i){this._options.teleportationTargetMesh&&(this._options.teleportationTargetMesh.isVisible!==e||t)&&(this._options.teleportationTargetMesh.isVisible=e,this._options.teleportationTargetMesh.getChildren(void 0,!1).forEach((t=>{t.isVisible=e})),e?this._selectionFeature&&i&&this._selectionFeature.detach():(this._quadraticBezierCurve&&(this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=null),this._selectionFeature&&i&&this._selectionFeature.attach()))}_disposeBezierCurve(){this._quadraticBezierCurve&&(this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=null)}_showParabolicPath(e){if(!e.pickedPoint||!this._currentTeleportationControllerId)return;const t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||yl.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,i=this._controllers[this._currentTeleportationControllerId],s=Eo.jj.CreateQuadraticBezier(i.xrController.pointer.absolutePosition,e.ray.origin,e.pickedPoint,25),r=i.teleportationState.blocked?this._blockedRayColor:void 0,n=this._colorArray.fill(r||this._cachedColor4White),o=s.getPoints();o.shift(),o.shift(),this._options.generateRayPathMesh?this._quadraticBezierCurve=this._options.generateRayPathMesh(s.getPoints(),e):this._quadraticBezierCurve=Co("teleportation path line",{points:o,instance:this._quadraticBezierCurve,updatable:!0,colors:n},t),this._quadraticBezierCurve.isPickable=!1,void 0!==this._options.renderingGroupId&&(this._quadraticBezierCurve.renderingGroupId=this._options.renderingGroupId)}_teleportForward(e){const t=this._controllers[e];if(t&&t.teleportationState.forward&&this.teleportationEnabled&&(t.teleportationState.forward=!1,this._currentTeleportationControllerId="",!this.snapPointsOnly||this._snappedToPoint))if(this.skipNextTeleportation)this.skipNextTeleportation=!1;else if(this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible){const e=this._options.xrInput.xrCamera.realWorldHeight;this.onBeforeCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position),this._options.xrInput.xrCamera.position.copyFrom(this._options.teleportationTargetMesh.position),this._options.xrInput.xrCamera.position.y+=e,gt.PT.FromEulerAngles(0,t.teleportationState.currentRotation-(this._xrSessionManager.scene.useRightHandedSystem?Math.PI:0),0).multiplyToRef(this._options.xrInput.xrCamera.rotationQuaternion,this._options.xrInput.xrCamera.rotationQuaternion),this.onAfterCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position)}}}Fc.Name=rl.TELEPORTATION,Fc.Version=1,nl.AddWebXRFeature(Fc.Name,((e,t)=>()=>new Fc(e,t)),Fc.Version,!0);class Lc{constructor(){}static CreateAsync(e,t={}){const i=new Lc;if(e.onDisposeObservable.addOnce((()=>{i.dispose()})),!t.disableDefaultUI){const s={renderTarget:i.renderTarget,...t.uiOptions||{}};t.optionalFeatures&&("boolean"==typeof t.optionalFeatures?s.optionalFeatures=["hit-test","anchors","plane-detection","hand-tracking"]:s.optionalFeatures=t.optionalFeatures),i.enterExitUI=new yc(e,s)}return hl.CreateAsync(e).then((e=>{if(i.baseExperience=e,t.ignoreNativeCameraTransformation&&(i.baseExperience.camera.compensateOnFirstFrame=!1),i.input=new bl(e.sessionManager,e.camera,{controllerOptions:{renderingGroupId:t.renderingGroupId},...t.inputOptions||{}}),!t.disablePointerSelection){const e={...t.pointerSelectionOptions,xrInput:i.input,renderingGroupId:t.renderingGroupId};i.pointerSelection=i.baseExperience.featuresManager.enableFeature(xl.Name,t.useStablePlugins?"stable":"latest",e),t.disableTeleportation||(i.teleportation=i.baseExperience.featuresManager.enableFeature(Fc.Name,t.useStablePlugins?"stable":"latest",{floorMeshes:t.floorMeshes,xrInput:i.input,renderingGroupId:t.renderingGroupId,...t.teleportationOptions}),i.teleportation.setSelectionFeature(i.pointerSelection))}return t.disableNearInteraction||(i.nearInteraction=i.baseExperience.featuresManager.enableFeature(vc.Name,t.useStablePlugins?"stable":"latest",{xrInput:i.input,farInteractionFeature:i.pointerSelection,renderingGroupId:t.renderingGroupId,useUtilityLayer:!0,enableNearInteractionOnAllControllers:!0,...t.nearInteractionOptions})),t.disableHandTracking||i.baseExperience.featuresManager.enableFeature(wc.Name,t.useStablePlugins?"stable":"latest",{xrInput:i.input,...t.handSupportOptions},void 0,!1),i.renderTarget=i.baseExperience.sessionManager.getWebXRRenderTarget(t.outputCanvasOptions),t.disableDefaultUI?void 0:i.enterExitUI.setHelperAsync(i.baseExperience,i.renderTarget)})).then((()=>i)).catch((e=>(It.V.Error("Error initializing XR"),It.V.Error(e),i)))}dispose(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()}}Ie.Z.prototype.createDefaultLight=function(e=!1){if(e&&this.lights)for(let e=0;e<this.lights.length;e++)this.lights[e].dispose();0===this.lights.length&&new qa("default light",gt.Pq.Up(),this)},Ie.Z.prototype.createDefaultCamera=function(e=!1,t=!1,i=!1){if(t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){const t=this.getWorldExtends((e=>e.isVisible&&e.isEnabled())),s=t.max.subtract(t.min),r=t.min.add(s.scale(.5));let n,o=1.5*s.length();if(isFinite(o)||(o=1,r.copyFromFloats(0,0,0)),e){const e=new uh("default camera",-Math.PI/2,Math.PI/2,o,r,this);e.lowerRadiusLimit=.01*o,e.wheelPrecision=100/o,n=e}else{const e=new fh.S("default camera",new gt.Pq(r.x,r.y,-o),this);e.setTarget(r),n=e}n.minZ=.01*o,n.maxZ=1e3*o,n.speed=.2*o,this.activeCamera=n,i&&n.attachControl()}},Ie.Z.prototype.createDefaultCameraOrLight=function(e=!1,t=!1,i=!1){this.createDefaultLight(t),this.createDefaultCamera(e,t,i)},Ie.Z.prototype.createDefaultSkybox=function(e,t=!1,i=1e3,s=0,r=!0){if(!e)return It.V.Warn("Can not create default skybox without environment texture."),null;r&&e&&(this.environmentTexture=e);const n=so("hdrSkyBox",{size:i},this);if(t){const t=new mt.Y("skyBox",this);t.backFaceCulling=!1,t.reflectionTexture=e.clone(),t.reflectionTexture&&(t.reflectionTexture.coordinatesMode=Dt.g.SKYBOX_MODE),t.microSurface=1-s,t.disableLighting=!0,t.twoSidedLighting=!0,n.material=t}else{const t=new ft.F("skyBox",this);t.backFaceCulling=!1,t.reflectionTexture=e.clone(),t.reflectionTexture&&(t.reflectionTexture.coordinatesMode=Dt.g.SKYBOX_MODE),t.disableLighting=!0,n.material=t}return n.isPickable=!1,n.infiniteDistance=!0,n.ignoreCameraMaxZ=!0,n},Ie.Z.prototype.createDefaultEnvironment=function(e){return gh?new gh(e,this):null},Ie.Z.prototype.createDefaultVRExperience=function(e={}){return new il(this,e)},Ie.Z.prototype.createDefaultXRExperienceAsync=function(e={}){return Lc.CreateAsync(this,e).then((e=>e))};class Nc{static ImportAndPatch(e){if(fa.Rl,xs.AllowAlphaInheritance=!0,Ca.m.MAX_RENDERINGGROUPS=5,Ts.prototype.invertToRef=function(e){const t=this.m[0],i=this.m[1],s=this.m[2],r=this.m[3],n=this.m[4],o=this.m[5],a=this.determinant();if(Math.abs(a)<bs.bH*bs.bH)return e.m[0]=0,e.m[1]=0,e.m[2]=0,e.m[3]=0,e.m[4]=0,e.m[5]=0,this;const h=1/a,l=s*o-r*n,c=i*n-t*o;return e.m[0]=r*h,e.m[1]=-i*h,e.m[2]=-s*h,e.m[3]=t*h,e.m[4]=l*h,e.m[5]=c*h,this},e.isMobile){const e=xs.prototype._onPointerUp;xs.prototype._onPointerUp=function(t,i,s,r,n,o){e.call(this,t,i,s,r,n,o),this._onPointerOut(t,o,!0)}}}constructor(){}}!function(e){e[e.Unknown=0]="Unknown",e[e.Field=1]="Field",e[e.FieldToWheel=2]="FieldToWheel",e[e.Wheel=3]="Wheel",e[e.WheelToField=4]="WheelToField"}(Oc||(Oc={}));class kc{constructor(e,t,i,s){this._zoomedIn=!1,this._orientation=ue.landscape,this._pipCameraStateObservable=new Q(!1),this._defaultLandscape=t.landscape.default,this._defaultPortrait=t.portrait.default,this._zoomedLandscape=t.landscape.zoomed,this._zoomedPortrait=t.portrait.zoomed,this._pipCamera=t.pipCamera,t.pipCamera.fov=.3217,this._guiCamera=t.gui,this._scene=e,this._pipFrame=i,e.cameraToUseForPointers=t.gui,this._cameraObservable=new Q(t.landscape.default),t.landscape.zoomed.setEnabled(!1),t.portrait.default.setEnabled(!1),t.portrait.zoomed.setEnabled(!1),this._pipEnabled=s}setPiPEnabled(e){this._pipEnabled=e}get pipCameraStateObservable(){return this._pipCameraStateObservable}get pipCamera(){return this._pipCamera}setPiPActive(e){e&&!this._pipEnabled||(this._pipCameraStateObservable.next(e),this.updateActiveCameras(),this._pipFrame.isVisible=e)}updateActiveCameras(){const e=this.getRelevantCamera();this._scene.activeCameras=this._pipCameraStateObservable.value?[e,this._pipCamera,this._guiCamera]:[e,this._guiCamera]}get mainCameraObservable(){return this._cameraObservable}onResize(e){this._orientation=e.orientation,this.updateMainCamera(),this.applyPiPSettings(e)}applyPiPSettings(e){const t=this.pipCamera;if(e.orientation===ue.landscape){const i=435/1284*.99,s=e.referenceSizeLandscape.h*i*1.25/e.referenceSizeLandscape.w,r=257/2560,n=165/1284;t.viewport=new Es.L(r,1-i-n,s,i)}else{const i=.195,s=e.height*i*1.265/e.width;t.viewport=new Es.L(0,1-i-.0918,s,i)}this.layoutPiPFrame(this._pipFrame,e)}layoutPiPFrame(e,t){if(t.orientation===ue.portrait){e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP;const i=.2*t.height*1.25;e.stretch=hr.STRETCH_UNIFORM,e.height="20%",e.width=i/t.width*100+"%",e.left="0%",e.top="9.18%"}else if(t.orientation===ue.landscape){e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP;const i=435/1284,s=t.referenceSizeLandscape.h*i*1.25,r=257/2560,n=165/1284;e.stretch=hr.STRETCH_UNIFORM,e.height=100*i+"%",e.width=s/t.referenceSizeLandscape.w*100+"%",e.left=100*r+"%",e.top=100*n+"%"}}toggleZoom(){return this._zoomedIn=!this._zoomedIn,this.updateMainCamera(),this._zoomedIn}updateMainCamera(){const e=this._cameraObservable.value,t=this.getRelevantCamera();e!==t&&(e.setEnabled(!1),t.setEnabled(!0),this._cameraObservable.next(t),this.updateActiveCameras())}getRelevantCamera(){switch(this._orientation){case ue.landscape:return this._zoomedIn?this._zoomedLandscape:this._defaultLandscape;case ue.portrait:return this._zoomedIn?this._zoomedPortrait:this._defaultPortrait}}focusOnField(){return Promise.resolve()}focusOnWheel(){return Promise.resolve()}enableBlur(){}disableBlur(){}}class Uc{constructor(e){this._playSessions=new Set,this._interpolator=e}tick(e){this._playSessions.forEach((t=>{t.tick(e)}))}play(e,t,i,s){return new Promise(((r,n)=>{const o=new Vc(e,this._interpolator,t,i,(e=>{this._playSessions.delete(e),r()}).bind(this),s);this._playSessions.add(o)}))}}class Vc{constructor(e,t,i,s,r,n){this._statesSetter=i,this._endCallback=r,e.markers&&e.markers.length>0&&s&&(this._markersPlaySession=new Gc(e.markers,s));let o=0;this._trackPlaySessions=e.tracks.map((e=>(e.durationInSeconds>o&&(o=e.durationInSeconds),new zc(e,t,this.onTrackEnded.bind(this))))),this._durationInSeconds=o,this._abortSkipSignal=n??ti.GetNone()}tick(e){(this._abortSkipSignal.isAborted||this._abortSkipSignal.isSkipped)&&(e=this._durationInSeconds+.001);const t=new Map;this._trackPlaySessions.forEach((i=>{const s=i.tick(e);s&&t.set(i.getTrackName(),s)})),this._statesSetter(t),this._markersPlaySession?.tick(e)}onTrackEnded(e){let t=!0;for(let e=0;e<this._trackPlaySessions.length;e++)if(!this._trackPlaySessions[e].isCompleted){t=!1;break}t&&this._endCallback(this)}}class Gc{constructor(e,t){this._markers=e,this._markersHandler=t,this._lastMarkerIndex=-1,this._currentTimeS=0,this.tryTriggerMarkers()}tick(e){this._currentTimeS+=e,this.tryTriggerMarkers()}tryTriggerMarkers(){const e=[];let t=this._lastMarkerIndex+1;for(;t<this._markers.length;t++){const i=this._markers[t];if(i.timeS>this._currentTimeS)break;e.push(...i.markers)}e.length>0&&(this._markersHandler(e),this._lastMarkerIndex=t-1)}}class zc{constructor(e,t,i){this._lastPassedPointIndex=0,this._isCompleted=!1,this._track=e,this._interpolator=t,this._endCallback=i,this._currentTimeS=0,this._lastPassedPointIndex=0}getTrackName(){return this._track.name}tick(e){if(this._isCompleted)return;const t=this._track.points;if(this._currentTimeS+=e,this._lastPassedPointIndex===t.length-1||t[t.length-1].timeS<=this._currentTimeS)return this.endSession(),t[t.length-1].state;let i=t[this._lastPassedPointIndex],s=t[this._lastPassedPointIndex+1];for(;s.timeS<=this._currentTimeS;)this._lastPassedPointIndex++,i=t[this._lastPassedPointIndex],s=t[this._lastPassedPointIndex+1];return this._interpolator.interpolate(i,s,this._currentTimeS)}endSession(){this._isCompleted=!0,this._endCallback(this)}get isCompleted(){return this._isCompleted}}class Hc{constructor(e,t,i,s){this.x=e,this.y=t,this.z=i,this.w=s}equals(e){return!!e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}toJSON(){return[this.x,this.y,this.z,this.w]}toJSONString(e){return`[${this.x.toFixed(e)},${this.y.toFixed(e)},${this.z.toFixed(e)},${this.w.toFixed(e)}]`}static fromJSON(e){return new Hc(e[0],e[1],e[2],e[3])}static Slerp(e,t,i){let s=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w;if(s<0&&(t=new Hc(-t.x,-t.y,-t.z,-t.w),s=-s),Math.abs(s)>=.9999){const s=e.w+i*(t.w-e.w),r=e.x+i*(t.x-e.x),n=e.y+i*(t.y-e.y),o=e.z+i*(t.z-e.z);return new Hc(r,n,o,s)}const r=Math.sqrt(1-s*s);if(Math.abs(r)<.001)return new Hc(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z),.5*(e.w+t.w));const n=Math.acos(s),o=Math.sin((1-i)*n)/r,a=Math.sin(i*n)/r;return new Hc(e.x*o+t.x*a,e.y*o+t.y*a,e.z*o+t.z*a,e.w*o+t.w*a)}}class Wc{constructor(e,t,i){this.x=e,this.y=t,this.z=i}equals(e){return!!e&&this.x===e.x&&this.y===e.y&&this.z===e.z}toString(){return`[${this.x}, ${this.y}, ${this.z}]`}toJSON(){return[this.x,this.y,this.z]}toJSONString(e){return`[${this.x.toFixed(e)},${this.y.toFixed(e)},${this.z.toFixed(e)}]`}static fromJSON(e){if(e&&3==e.length)return new Wc(e[0],e[1],e[2])}}class Xc{constructor(e,t){if(!e&&!t)throw new Error("At least one parameter - position or rotation - should be defined");this.position=e,this.rotation=t}equals(e){return!!e&&!(!this.position&&e.position)&&!!this.position?.equals(e.position)&&(!this.rotation&&!e.rotation||!(!this.rotation||!e.rotation)&&this.rotation.equals(e.rotation))}toString(){return`p:${this.position}, r:${this.rotation}`}toJSON(){const e=[this.position];return this.rotation&&e.push(this.rotation),e}toJSONString(){let e=`[${this.position?this.position.toJSONString(3):"[]"}`;return this.rotation&&(e+=`,${this.rotation.toJSONString(4)}`),e+="]",e}static fromJSON(e){const t=Wc.fromJSON(e[0]),i=e.length>1?Hc.fromJSON(e[1]):void 0;return new Xc(t,i)}}class qc{get durationInSeconds(){return this.points.at(-1)?.timeS||0}constructor(e,t){this.name=e,this.points=t}toJSONString(){return`{"${qc.kName}":"${this.name}","${qc.kPoints}":[${this.points.map((e=>e.toJSONString())).join(",")}]}`}static fromJSON(e){const t=e[qc.kName].toString(),i=e[qc.kPoints].map((e=>Yc.fromJSON(e)));return new qc(t,i)}}qc.kName="n",qc.kPoints="p";class Qc{constructor(e,t){this.tracks=e,this.markers=t;let i=0;e.forEach((e=>{e.durationInSeconds>i&&(i=e.durationInSeconds)})),this.durationInSeconds=i}toJSONString(){let e=`{"${Qc.kTracks}":[${this.tracks.map((e=>e.toJSONString())).join(",")}]`;return this.markers&&(e+=`,"${Qc.kMarkers}": [${this.markers.map((e=>e.toJSONString())).join(",")}]`),e+="}",e}static fromJSON(e){const t=e[Qc.kTracks].map((e=>qc.fromJSON(e))),i=e[Qc.kMarkers]?.map((e=>Kc.fromJSON(e)));return new Qc(t,i)}}Qc.kTracks="tracks",Qc.kMarkers="markers";class Kc{constructor(e,t){this.timeS=e,this.markers=t}toJSONString(){return`[${this.timeS.toFixed(3)}, [${this.markers.map((e=>`"${e}"`)).join(",")}]]`}static fromJSON(e){const t=e[0],i=e[1];return new Kc(t,i)}}class Yc{constructor(e,t){this.timeS=e,this.state=t}toString(){return`t:${this.timeS}, s:${this.state}`}toJSONString(){return`[${this.timeS.toFixed(4)}, ${this.state.toJSONString()}]`}static fromJSON(e){const t=Xc.fromJSON(e[1]);return new Yc(e[0],t)}}class jc{constructor(e){this._state="stopped",this._spinWheelClockwise=!0,this._wheelView=e.wheelView,this._wheelSpinner=e.wheelSpinner,this._wheelSpinningSpeed=e.wheelSpinningSpeed,this._spinAnimRegistry=e.spinAnimRegistry,this._motionPlayer=e.motionPlayer,this._sfxPlayer=e.sfxPlayer,this._pipController=e.pipController,this._pipTimeBeforeStopS=e.pipTimeBeforeStopS,this._timeScaleObservable=e.timeScaleObservable,this._wheelSpinningMode=e.wheelSpinningMode,this._wheelSpinningMode.subscribe((e=>{if("idle"===this._state){if("alt"===e)return;this._spinWheelClockwise="cw"===e,this.setIdleSpeed()}}))}idle(){return this._state="idle",this.setIdleSpeed()}setIdleSpeed(){return this._wheelSpinner.setSpeed(this._wheelSpinningSpeed/6*(this._spinWheelClockwise?-1:1),1,$t.easeInQuad)}async startSpinning(e){const t=this;if(this._state="accelerating",this._accelerationTask)return void await this._accelerationTask.promise;const i=this._timeScaleObservable.timeScale.value,s=new ri((e=>(this._wheelView.hideBall(),this._wheelSpinner.setSpeed(this._wheelSpinningSpeed*(this._spinWheelClockwise?-1:1),1/i,$t.easeInQuad,e).then((()=>{t._accelerationTask===s&&(t._accelerationTask=null)})))),e);this._accelerationTask=s,await s.promise}async stopAtNumber(e,t){this._state="spinning";const i=await this._spinAnimRegistry.getNextRandomItem(!1),s=this;this._accelerationTask&&await this._accelerationTask.promise;const r=this._timeScaleObservable.timeScale.value;let n;i.audioAssetId&&(n=await this._sfxPlayer.play({name:i.audioAssetId.name,filters:r<=1?void 0:{lowpass:{frequency:1e3}}}),n.setTimeScale(r)),this._wheelSpinner.stop();const o=(i.animation.durationInSeconds-(vt.BallStopDetectionTimeS+vt.WheelStopDurationS-.5))/r,a=Math.max(0,(i.animation.durationInSeconds-this._pipTimeBeforeStopS)/r),h=this._pipController,l=this._wheelView.playBallAnimation(this._motionPlayer,i.animation,e,this._spinWheelClockwise,t);await Promise.all([si.Delay(1e3*o,t),si.Delay(1e3*a,t).then((()=>h.show()))]),t&&n&&(t.isAborted||t.isSkipped)&&(n.stop(),l.then((()=>{h.snapToTarget()}))),l.finally((()=>{this._state="stopped","alt"===this._wheelSpinningMode.value&&(s._spinWheelClockwise=!s._spinWheelClockwise)}))}}class Zc{constructor(e,t,i,s,r,n){this._wheelSpinner=t,this._ballMesh=s,this._ballMesh.isVisible=!1,this._emblemNode=i.emblemNode,this._emblemNode.setParent(t),this._emblemRotationSpeedRedS=i.rotationSpeedRadS,this._log=n,this._clockwiseNumbersSequence=r;const o=this._ballAnimContainer=new Gn.V("BallAnimationContainer",e);o.position=t.position,this._ballMesh.setParent(o)}getBallPosition(){return this._ballMesh.absolutePosition}hideBall(){this._ballMesh.isVisible=!1}get rotation(){if(this._wheelSpinner.rotationQuaternion){const e=this._wheelSpinner.rotationQuaternion.toEulerAngles();this._wheelSpinner.rotation=e}return this._wheelSpinner.rotation.y}set rotation(e){if(this._wheelSpinner.rotationQuaternion){const e=this._wheelSpinner.rotationQuaternion.toEulerAngles();this._wheelSpinner.rotation=e}this._wheelSpinner.rotation=new gt.Pq(this._wheelSpinner.rotation.x,e,this._wheelSpinner.rotation.z)}async playBallAnimation(e,t,i,s,r){this._ballMesh.isVisible=!1,this._wheelSpinner.rotationQuaternion||(this._wheelSpinner.rotationQuaternion=gt.PT.FromEulerAngles(this._wheelSpinner.rotation.x,this._wheelSpinner.rotation.y,this._wheelSpinner.rotation.z));const n=this._wheelSpinner.rotationQuaternion,o=new gt.PT(t.initialWheelRotation.x,t.initialWheelRotation.y,t.initialWheelRotation.z,t.initialWheelRotation.w),a=t.motionRecording.tracks.find((e=>"ball"===e.name))??(()=>{throw new Z})(),h=t.motionRecording.tracks.find((e=>"wheel"===e.name))??(()=>{throw new Z})(),l=a.points[0].state.position??new Wc(0,0,0),c=a.points[a.points.length-1].state.position??new Wc(0,0,0),u=h.points[h.points.length-1].state.rotation??new Hc(0,0,0,1),d=Math.atan(l.x/l.z),_=Math.atan(c.x/c.z),p=new gt.PT(u.x,u.y,u.z,u.w).toEulerAngles().y,g=_-p-p+(_-d)+Math.PI/38/2,f=s?n.multiply(o):n.multiply(o.invert()),m=this._ballAnimContainer.clone("ball-container",null,!0)??(()=>{throw new Z})();m.rotationQuaternion=s?gt.PT.FromEulerAngles(0,g,0).multiply(f):f.clone(),this._ballMesh.setParent(m);const b=this._clockwiseNumbersSequence.length;let v=-1,T=-1;if(this._clockwiseNumbersSequence.forEach(((e,s)=>{e===i&&(T=s),e===t.endingNumber&&(v=s)})),v<0)throw new Z(`Can't find index for the reference ending number '${t.endingNumber.name}'`);if(T<0)throw new Z(`Can't find index for the target number '${i.name}'`);let y=v-T;const x=2*Math.PI/b,A=gt.PT.FromEulerAngles(0,x*y,0);m.rotationQuaternion.multiplyInPlace(A),this._log.debug("Motion play session started..."),await e.play(t.motionRecording,(e=>{const t=e.get("ball");t&&t.position&&(this._ballMesh.position.set(t.position.x*(s?-1:1),t.position.y,t.position.z),this._ballMesh.isVisible=!0);const i=e.get("wheel");if(i&&i.rotation){const e=new gt.PT(i.rotation.x,i.rotation.y,i.rotation.z,i.rotation.w);s&&e.invertInPlace(),e.multiplyInPlace(f),this._wheelSpinner.rotationQuaternion=e}}),(e=>{this._log.debug(`Markers: [${e.join(",")}]`)}),r),this._ballMesh.setParent(this._wheelSpinner),m?.dispose(),this._log.debug("Motion play session complete")}}class $c{constructor(e){this._currentSpeedRadPerSec=0,this._currentTask=null,this._wheelView=e}async setSpeed(e,t,i,s){this._currentTask&&await this._currentTask.abort(ei.JumpToEnd);const r=this,n={get speed(){return r._currentSpeedRadPerSec},set speed(e){r._currentSpeedRadPerSec=e}},o=new ri((s=>Jt.add({target:n,duration:t,ease:i},{speed:e},s)),s);return o.promise.then((()=>{this._currentTask===o&&(this._currentTask=null)})),this._currentTask=o,o.promise}stop(){this._currentTask&&(this._currentTask.abort(ei.Default),this._currentTask=null),this._currentSpeedRadPerSec=0}tick(e){if(0===this._currentSpeedRadPerSec)return;const t=2*Math.PI;let i=this._wheelView.rotation+this._currentSpeedRadPerSec*e;for(;i<0;)i+=t;for(;i>=t;)i-=t;this._wheelView.rotation=i}}class Jc{static create(e,t){const i=new Jc(e);return t.register(i),i}constructor(e){this._assetContainer=e.assetContainer,this._canvas=e.canvas,this._log=e.log,this.scene=e.assetContainer.scene,this.mainLight=e.assetContainer.lights[0],this.mainLight.shadowEnabled=!0,this.mainLight.shadowMaxZ=100,this.mainLight.intensity=5,this.shadowGenerator=this.createShadowGenerator(this.mainLight),this.wheelView=this.createWheelView(e.assetContainer,this.scene,this.shadowGenerator,e.numSet,e.gameType,e.skyboxTexture,e.log),this.setupAssetContainer(e.assetContainer,this.shadowGenerator);const t=this.initializeCameras(e.assetContainer,this.scene);this.mainCamera=t.mainCamera,this.pipCamera=t.pipCamera,this._cameraSettings=t.mainCameraSettings}onResize(e){e.previousOrientation!==e.orientation&&(e.orientation===ue.landscape?this.applyCameraSettings(this.mainCamera,this._cameraSettings.landscape):this.applyCameraSettings(this.mainCamera,this._cameraSettings.portrait))}setupAssetContainer(e,t){const i=new Set(["BallLauchSpot"]),s=new Set(["WheelCenterPost","WheelBaseRing1","WheelBaseRing2","WheelBaseRing3","RouletteBase","WheelBumpers"]),r=["Divider_","Handle","WheelBumpers"],n=new Set(["WheelGold","WheelNumbers","RouletteBase","Handle"]);new Set(["Divider_"]),this.scene.skipPointerMovePicking=!0,this.scene.skipPointerDownPicking=!0,this.scene.skipPointerUpPicking=!0;const o=ha.CreatePlane("pip-background",{size:100},this.scene),a=new ft.F("pip-background",this.scene);a.diffuseColor=bt.v9.Black(),a.disableLighting=!0,o.material=a,o.layerMask=Ct.PiPOnly,o.rotation=new gt.Pq(Math.PI/2,0,0),e.meshes.forEach((e=>{i.has(e.name)&&(e.isVisible=!1),e.doNotSyncBoundingInfo=!0,(s.has(e.name)||r.some((t=>e.name.includes(t))))&&(t.addShadowCaster(e),this._log.debug(`Adding shadow caster: ${e.name}`)),(n.has(e.name)||r.some((t=>e.name.includes(t))))&&(e.receiveShadows=!0,this._log.debug(`Adding shadow receiver: ${e.name}`))}))}createShadowGenerator(e){const t=new Sa(1024,e);return t.usePercentageCloserFiltering=!0,t.setDarkness(0),t.bias=1e-4,t}createWheelView(e,t,i,s,r,n,o){const a="RouletteRotor",h="EmblemRotate",l=vt.BallRadius,c=e.transformNodes.find((e=>e.name===a))??(()=>{throw new Z(`Could not find '${a}' node`)})(),u=e.transformNodes.find((e=>e.name===h))??(()=>{throw new Z(`Could not find '${h}' node`)})();c.setParent(null);const d=this.createBallMesh({color:new bt.v9(1,1,240/255),radius:l},t,n,i);return new Zc(t,c,{emblemNode:u,rotationSpeedRadS:-.5},d,s.getZeroBasedSequenceClockwise(r),o)}createBallMesh(e,t,i,s){const r=ha.CreateSphere("ball",{segments:32,diameter:2*e.radius},t),n=new mt.Y("ball-material");return n.metallic=.1,n.roughness=.2,r.material=n,r.layerMask=Ct.Wheel,s&&s.addShadowCaster(r),r}initializeCameras(e,t){const i="MainCamera_Landscape",s="MainCamera_Portrait";let r,n,o,a;if(e.cameras.forEach((e=>{e.name==i?(o=this.getCameraSettings(e),r=e):e.name===s?a=this.getCameraSettings(e):"PiPCamera"==e.name&&(n=e)})),!r)throw new Z(`Camera [${i}] was not found`);if(!o||!a)throw new Z(`Camera [${s}] was not found`);if(!n)throw new Z("PiP Camera was not found");const h=n.parent;h.computeWorldMatrix(!0,r);const l=h.absolutePosition;return n.parent=null,n.position=l,t.activeCameras=[r,n],{mainCamera:r,pipCamera:n,mainCameraSettings:{landscape:o,portrait:a}}}getBallPosition(){return this.wheelView.getBallPosition()}getCameraSettings(e){const t=e.parent;return{absolutePosition:t.absolutePosition.clone(),rotation:t.absoluteRotationQuaternion.clone()}}applyCameraSettings(e,t){const i=e.parent,s=t.absolutePosition,r=t.rotation;i.setAbsolutePosition(s),i.rotationQuaternion=r}}class eu{constructor(e){this._extrapolateBeyondTimeRange=e}interpolate(e,t,i){const{minPoint:s,maxPoint:r}=e.timeS<t.timeS?{minPoint:e,maxPoint:t}:{minPoint:t,maxPoint:e};if(i<s.timeS)return console.error("<<<"),this._extrapolateBeyondTimeRange?s.state:void 0;if(i>r.timeS)return console.error(">>>"),this._extrapolateBeyondTimeRange?r.state:void 0;const n=(i-s.timeS)/(r.timeS-s.timeS),o=s.state,a=r.state,{minPos:h,maxPos:l}={minPos:o.position,maxPos:a.position};let c;c=h||l?l?h?new Wc((l.x-h.x)*n+h.x,(l.y-h.y)*n+h.y,(l.z-h.z)*n+h.z):l:h:void 0;const u=o.rotation,d=a.rotation;let _;return _=u&&d?Hc.Slerp(u,d,n):u||d?u||d:void 0,new Xc(c,_)}}class tu{constructor(e){this._lastTargetPosition=null,this._cameraController=e,this.hide()}tick(e){if(this._active&&this._targetPositionDelegate){const e=this._targetPositionDelegate();if(e){const t=this._lastTargetPosition?gt.Pq.Lerp(this._lastTargetPosition,e,.5):e;this._cameraController.pipCamera.setTarget(t),this._lastTargetPosition=t}}}setTargetDelegate(e){this._targetPositionDelegate=e}show(){this._active=!0,this._cameraController.setPiPActive(!0)}hide(){this._active=!1,this._cameraController.setPiPActive(!1),this._lastTargetPosition=null}snapToTarget(){if(this._targetPositionDelegate){const e=this._targetPositionDelegate();e&&(this._cameraController.pipCamera.setTarget(e),this._lastTargetPosition=e)}}}class iu extends Sr{static async create(e,t,i,s){const[r,n,o,a,h,l,c,u]=await Promise.all([i.load(Ne.Splash_Demo_1),i.load(Ne.Splash_Demo_2),i.load(Ne.Splash_Demo_3),i.load(Ne.Splash_Demo_Check),i.load(Ne.UI_PIP_Frame),i.load(Ne.Splash_Demo_Btn_Agree),i.load(Ne.Splash_Background),i.load(Ne.Splash_PressToPlay)]),d=new iu(e,t,{background:c,buttonImage:u,demo1:r,demo2:n,demo3:o,demoCheck:a,demoCheckBtn:h,demoBtn:l},s);return t.addControl(d),d.zIndex=gn.FullScreenOverlay,d.isPointerBlocker=!0,d.onDisposeObservable.addOnce((()=>{i.release(Ne.Splash_Demo_1),i.release(Ne.Splash_Demo_2),i.release(Ne.Splash_Demo_3),i.release(Ne.Splash_Demo_Check),i.release(Ne.Splash_Demo_Btn_Agree),i.release(Ne.Splash_Background),i.release(Ne.Splash_PressToPlay)})),d}constructor(e,t,i,s){const r={w:i.background.width,h:i.background.height};super(e,t,pr.calculateRefSizeConfig({contentRefSize:r,refResLandscape:{w:2560,h:1284},screenFraction:{landscape:{width:.5,height:.9},portrait:{width:.9,height:.9}}}),{shroud:{alpha:.9}}),this._closed=new X,this._currentDemoStage=0,this._agree1=!1,this._agree2=!1,this._newGameEvent=s;const n=this,o=pr.createImage(i.background,"splash-bg");o.width=o.height="100%",o.isPointerBlocker=o.isHitTestVisible=!1,this.addControlToRoot(o),this._pressToPlay=pr.createImage(i.buttonImage,"press-to-play",{setSizeRelativeToContainer:i.background}),this._pressToPlay.isPointerBlocker=this._pressToPlay.isHitTestVisible=!1,this._pressToPlay.top="45%",this.addControlToRoot(this._pressToPlay),this._demo2=pr.createImage(i.demo2,"splash-demo-2"),this._demo2.width=this._demo2.height="125%",this._demo2.isPointerBlocker=this._demo2.isHitTestVisible=!1,this.addControlToRoot(this._demo2),this._demoAgree=pr.createImage(i.demoBtn,"demo-btn-agree",{setSizeRelativeToContainer:i.demo2}),this._demoAgree.isPointerBlocker=this._demoAgree.isHitTestVisible=!1,this._demoAgree.top="40%",this._demoAgree.isVisible=!1,this.addControlToRoot(this._demoAgree),this._agreeCheck1Bg=new _r("demo-check-1-back"),this._agreeCheck1Bg.background="black",this._agreeCheck1Bg.left="-40%",this._agreeCheck1Bg.width="10%",this._agreeCheck1Bg.height="5%",this._agreeCheck1Bg.alpha=.6,this._agreeCheck1Bg.color="#00000000",this._agreeCheck1Bg.isPointerBlocker=!0,this.addControlToRoot(this._agreeCheck1Bg),this._agreeCheck1=pr.createImage(i.demoCheckBtn,"demo-check-1",{setSizeRelativeToContainer:i.demo2}),this._agreeCheck1.width=this._agreeCheck1.height="10%",this._agreeCheck1.left="-40%",this._agreeCheck1.color="black",this._agreeCheck1.isPointerBlocker=!0,this._agreeCheck1.isHitTestVisible=!0,this._agreeCheck1.onPointerDownObservable.add((()=>{n._agree1||(n._agree1=!0,n._agreeCheckMark1.isVisible=!0,n._agree2&&(this._demoAgree.isVisible=!0))})),this.addControlToRoot(this._agreeCheck1),this._agreeCheckMark1=pr.createImage(i.demoCheck,"demo-checkmark-1",{setSizeRelativeToContainer:i.demo2}),this._agreeCheckMark1.width=this._agreeCheckMark1.height="6%",this._agreeCheckMark1.left="-40%",this._agreeCheckMark1.isPointerBlocker=!0,this._agreeCheckMark1.isHitTestVisible=!1,this._agreeCheckMark1.isVisible=!1,this.addControlToRoot(this._agreeCheckMark1),this._agreeCheck2Bg=new _r("demo-check-2-back"),this._agreeCheck2Bg.background="black",this._agreeCheck2Bg.left="-40%",this._agreeCheck2Bg.top="15%",this._agreeCheck2Bg.width="10%",this._agreeCheck2Bg.height="5%",this._agreeCheck2Bg.alpha=.6,this._agreeCheck2Bg.color="#00000000",this._agreeCheck2Bg.isPointerBlocker=!0,this.addControlToRoot(this._agreeCheck2Bg),this._agreeCheck2=pr.createImage(i.demoCheckBtn,"demo-check-2",{setSizeRelativeToContainer:i.demo2}),this._agreeCheck2.width=this._agreeCheck2.height="10%",this._agreeCheck2.left="-40%",this._agreeCheck2.top="15%",this._agreeCheck2.isPointerBlocker=!0,this._agreeCheck2.isHitTestVisible=!0,this._agreeCheck2.onPointerDownObservable.add((()=>{n._agree2||(n._agree2=!0,n._agreeCheckMark2.isVisible=!0,n._agree1&&(this._demoAgree.isVisible=!0))})),this.addControlToRoot(this._agreeCheck2),this._agreeCheckMark2=pr.createImage(i.demoCheck,"demo-checkmark-2",{setSizeRelativeToContainer:i.demo2}),this._agreeCheckMark2.width=this._agreeCheckMark2.height="6%",this._agreeCheckMark2.left="-40%",this._agreeCheckMark2.top="15%",this._agreeCheckMark2.isPointerBlocker=!0,this._agreeCheckMark2.isHitTestVisible=!1,this._agreeCheckMark2.isVisible=!1,this.addControlToRoot(this._agreeCheckMark2),this._demo1=pr.createImage(i.demo1,"splash-demo-1"),this._demo1.width=this._demo1.height="125%",this._demo1.isPointerBlocker=this._demo1.isHitTestVisible=!1,this.addControlToRoot(this._demo1),this._demo3=pr.createImage(i.demo3,"splash-demo-3"),this._demo3.width=this._demo3.height="125%",this._demo3.isPointerBlocker=this._demo3.isHitTestVisible=!0,this._demo3.isVisible=!1,this.addControlToRoot(this._demo3),this.contentRoot.isPointerBlocker=this.contentRoot.isHitTestVisible=!1;const a=1.1-.9,h={_progress:0,get progress(){return this._progress},set progress(e){this._progress=e,n._pressToPlay.scaleX=n._pressToPlay.scaleY=.9+a*e}},l=new AbortController,c=l.signal,u=e=>Jt.add({target:h,ease:$t.easeInOutSine,duration:1},{progress:e?1:0},c),d=async()=>{try{c.throwIfAborted(),await u(!0),c.throwIfAborted(),await u(!1),c.throwIfAborted(),d()}catch(e){if(!si.isAbortError(e))throw e;n._introDialog=await n._showIntroDialog();const t=n._introDialog.optionSelected.subscribe((e=>{t.unsubscribe(),n._introDialog=null}))}},_=new qt;_.add({dispose:()=>{try{l.abort(ei.Default)}catch(e){if(!si.isAbortError(e))throw e}}}),d(),this._disposable=_}get isOpen(){return this.isVisible}get isSplashOpen(){return this._currentDemoStage<1}setIntro(e){this._showIntroDialog=e}async showDemo(e){if(this.isVisible)return void(2===this._currentDemoStage&&(this._currentDemoStage=0,this._agree1=!1,this._agree2=!1,this._demo3.isVisible=!1,this._demo1.isVisible=!0,this._demo2.isVisible=!0,this._agreeCheckMark1.isVisible=!1,this._agreeCheckMark2.isVisible=!1,this._demoAgree.isVisible=!1,this._agreeCheck1.isVisible=!0,this._agreeCheck2.isVisible=!0,this._agreeCheck1Bg.isVisible=!0,this._agreeCheck2Bg.isVisible=!0));this._introDialog&&this._introDialog.close(),this._currentDemoStage=0,this._agree1=!1,this._agree2=!1,this._demo1.isVisible=!1,this._demo2.isVisible=!1,this._demo3.isVisible=!0,this._agreeCheckMark1.isVisible=!1,this._agreeCheckMark2.isVisible=!1,this._demoAgree.isVisible=!1,this._agreeCheck1.isVisible=!1,this._agreeCheck2.isVisible=!1,this._agreeCheck1Bg.isVisible=!1,this._agreeCheck2Bg.isVisible=!1;const t=1.1-.9,i=this,s={_progress:0,get progress(){return this._progress},set progress(e){this._progress=e,i._pressToPlay.scaleX=i._pressToPlay.scaleY=.9+t*e}},r=new AbortController,n=r.signal,o=e=>Jt.add({target:s,ease:$t.easeInOutSine,duration:1},{progress:e?1:0},n),a=async()=>{try{n.throwIfAborted(),await o(!0),n.throwIfAborted(),await o(!1),n.throwIfAborted(),a()}catch(e){if(!si.isAbortError(e))throw e;i._introDialog=await i._showIntroDialog();const t=i._introDialog.optionSelected.subscribe((e=>{t.unsubscribe(),i._introDialog=null}))}},h=new qt;return h.add({dispose:()=>{try{r.abort(ei.Default)}catch(e){if(!si.isAbortError(e))throw e}}}),a(),(async()=>{let e=15e3;for(;i._demo3.isVisible&&e>0;)await si.Delay(500),e-=500;i._demo3.isVisible=!1,i._demo1.isVisible=!0,i._demo2.isVisible=!0,i._agreeCheckMark1.isVisible=!1,i._agreeCheckMark2.isVisible=!1,i._demoAgree.isVisible=!1,i._agreeCheck1.isVisible=!0,i._agreeCheck2.isVisible=!0,i._agreeCheck1Bg.isVisible=!0,i._agreeCheck2Bg.isVisible=!0})(),this._disposable=h,this._closed=new X,this.show(e)}onShroudClicked(){0===this._currentDemoStage?(this._currentDemoStage++,this._demo1.isVisible=!1):1===this._currentDemoStage?this._agree1&&this._agree2&&(this._currentDemoStage++,this._demoAgree.isVisible=!1,this._agreeCheckMark1.isVisible=!1,this._agreeCheckMark2.isVisible=!1,this._agreeCheck1.isVisible=!1,this._agreeCheck2.isVisible=!1,this._agreeCheck1Bg.isVisible=!1,this._agreeCheck2Bg.isVisible=!1,this._demo2.isVisible=!1):2===this._currentDemoStage&&this.close()}close(){this.hide(),this._disposable.dispose(),this._closed.next()}get closed(){return this._closed}}class su{get durationInSeconds(){return this.motionRecording.durationInSeconds}constructor(e,t,i,s,r,n){this.id=e,this.initialWheelRotation=t,this.wheelSpinningSpeedRadPerSec=i,this.motionRecording=s,this.gameType=r,this.endingNumber=n}toJSONString(){return`{"${su.kId}": "${this.id}","${su.kInitialWheelRotation}": ${this.initialWheelRotation.toJSONString(4)},"${su.kWheelSpeed}": ${this.wheelSpinningSpeedRadPerSec.toFixed(4)},"${su.kGameType}":"${this.gameType.toString()}","${su.kNumber}":"${this.endingNumber.name}","${su.kMotion}":${this.motionRecording.toJSONString()}}`}static fromJSON(e,t){const i=e[this.kId].toString(),s=e[this.kInitialWheelRotation],r=e[this.kMotion],n=e[this.kGameType].toString(),o=e[this.kNumber].toString(),a=e[this.kWheelSpeed],h=Hc.fromJSON(s),l=Qc.fromJSON(r),c=n,u=t.getAllNumbersForGameType(c).filter((e=>e.name===o))[0];if(!u)throw new Z(`Could not parse roulette number with name '${o}'`);return new su(i,h,a,l,c,u)}}su.kId="id",su.kInitialWheelRotation="initialWheelRotation",su.kWheelSpeed="wheelSpeed",su.kMotion="motion",su.kNumber="number",su.kGameType="gameType";class ru{constructor(e){this._releaseMap=new Map,this._gltfLoader=e.gltf,this._ballAnimationLoader=e.ballAnimations,this._audioLoader=e.audio}loadGLTF(e){const t=this._gltfLoader.load(e);return this._releaseMap.set(e,(()=>{this._gltfLoader.release(e)}).bind(this)),t}async loadBallAnimations(e){const t=this._ballAnimationLoader.load(e);return this._releaseMap.set(e,(()=>{this._ballAnimationLoader.release(e)}).bind(this)),t}async loadAudio(e){const t=this._audioLoader.load(e);return this._releaseMap.set(e,(()=>{this._audioLoader.release(e)})),t}release(e){const t=this._releaseMap.get(e);null!=t&&t(e),this._releaseMap.delete(e)}}class nu{constructor(e,t){this._assetCache=new Map,this._loadingTasks=new Map,this._assetPathResolver=e,this._retryConfig=t??{retryCount:30,retryCalculator:{getRetryIntervalMS:e=>1e3}}}load(e,t,i){const s=this;return new Promise((r=>{const n=this._assetCache.get(e);null!=n&&r(n);r(this._loadingTasks.get(e)||new Promise(((r,n)=>{const o=this._assetPathResolver.resolveAssetId(e),a=new ou(s._retryConfig.retryCount),h=()=>new Promise(((r,n)=>{this.loadInternal(e,o,t,i).then((t=>{this.addToCache(e,t),this._loadingTasks.delete(e),r(t)})).catch((t=>{if(a.attemptsLeft>0){const t=s._retryConfig.retryCalculator.getRetryIntervalMS(a.attemptIndex);a.addAttempt(),console.error(`Retrying '${e.name}'. Retries left: ${a.attemptsLeft}`),si.Delay(t).then((()=>{r(h())}))}else console.error(`Could not load ${e.name} after ${a.maxAttempts} attempts`),n(t)}))})),l=h();oi.track(l,`Asset Loading: [${e.name}]`),this._loadingTasks.set(e,l),l.then((e=>r(e)))})))}))}release(e){const t=this._assetCache.get(e);null!=t&&(this._assetCache.delete(e),this.releaseInternal(e,t))}addToCache(e,t){this._assetCache.set(e,t)}}class ou{constructor(e){this.maxAttempts=e,this._attemptIndex=0}addAttempt(){return this._attemptIndex++,this._attemptIndex}get attemptsLeft(){return this.maxAttempts-this._attemptIndex-1}get attemptIndex(){return this._attemptIndex}}class au extends nu{constructor(e,t,i){super(e),this._fetchCache=new Map,this._extensions=t,this._numSet=i}async loadInternal(e,t){const i=t.url,s=this._fetchCache,r=(()=>{const e=s.get(i);if(e)return e;const t=fetch(i);return s.set(i,t),t.catch((()=>{s.delete(i)})),t})(),n=await r;if(!n.ok)throw new Z(`Could not load animation '${e.name}' at '${i}'.`);let o;const a=i.split(".").at(-1);let h=!1;if(void 0===a||this._extensions.gzip.find((e=>e.toLowerCase()===a.toLowerCase())))h=!0;else if(!this._extensions.json.find((e=>e.toLowerCase()===a.toLowerCase())))throw new Z(`Unknown ball animation extension: '${a}'`);if(h){const e=(await n.clone().blob()).stream().pipeThrough(new DecompressionStream("gzip")),t=new Response(e),i=await t.blob();o=await i.text()}else o=await n.clone().text();if(!o)throw new Z(`Could not load ball animation JSON string from path: '${i}`);const l=JSON.parse(o);return Array.isArray(l)?l.map((e=>su.fromJSON(e,this._numSet))):[su.fromJSON(l,this._numSet)]}releaseInternal(e,t){}}!function(e){e.Image="Image",e.GLTF="GLTF",e.SpinAnimation="SpinAnimation",e.WAV="WAV"}(Bc||(Bc={}));class hu extends nu{constructor(e,t){super(e),this._scene=t}async loadInternal(e,t){return await(0,Ue.uD)(t.url,this._scene)}releaseInternal(e,t){t.dispose()}}class lu{static get Audio(){return this._audio}static registerAudio(e,t){this._audio.set(e,t)}}lu._audio=new class{constructor(){this._map=new Map}get(e){return this._map.get(e)??(()=>{throw new Z(`Audio [${e}] is not defined`)})()}set(e,t){if(this._map.has(e))throw new Z(`Attempt to override audio [${e}]`);this._map.set(e,t)}values(){return[...this._map.values()]}};const cu={master:{volume:1,level:"high",levels:{low:.3,mid:.6,high:1},mute:!1,music:!0,sfx:!0,voice:!0},tracks:[{name:"VO_F_32",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_9",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Welcome_US_hso",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_00",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_12",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_ChipStackPlaced",type:"sfx",volume:.8,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_1",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Welcome_EU_cpo",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_14",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Winner_Big",type:"vo",volume:.9,mute:!1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:1,stagger:0,ducking:[{id:"duck-0",name:"music",target:"SECTION",cut:"FADE",end:"RESTORE",delta:.1}]},{name:"VO_F_Odd",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_18",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_6",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Place_Your_Bets",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_27",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_4",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_35",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_7",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Winner_Reg",type:"vo",volume:.9,mute:!1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:1,stagger:0,ducking:[{id:"duck-0",name:"music",target:"SECTION",cut:"FADE",end:"RESTORE",delta:.1}]},{name:"VO_F_28",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_SingleChipPlaced",type:"sfx",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_34",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_3",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_11",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Black",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_15",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_22",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_1",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_30",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_23",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_UI_MenuOpen",type:"sfx",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_21",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_10",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_31",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Even",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Winner_High",type:"vo",volume:.9,mute:!1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:1,stagger:0,ducking:[{id:"duck-0",name:"music",target:"SECTION",cut:"FADE",end:"RESTORE",delta:.1}]},{name:"VO_F_Welcome_EU_hso",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_2",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_0",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_29",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_17",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_2",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_ChipSelect",type:"sfx",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_UI_MenuClose",type:"sfx",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_20",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_5",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_8",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_33",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_UI_Click",type:"sfx",volume:.2,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_19",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_26",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_HereWeGo",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Win",type:"sfx",volume:.8,mute:!1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0,ducking:[{id:"duck-0",name:"music",target:"SECTION",cut:"FADE",end:"RESTORE",delta:0}]},{name:"VO_F_13",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Welcome_US_cpo",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_25",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_24",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_4",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_10",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_7",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_TableClear",type:"sfx",volume:.75,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Red",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_8",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_3",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_9",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_16",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_5",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_6",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_13",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_12",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_16",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_27",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_14",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_15",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_22",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Lose",type:"sfx",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_31",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_19",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_28",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_23",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_17",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_21",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_20",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Even",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_18",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_13",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_35",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_0",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Welcome_EU_sbk",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_14",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_36",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_25",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_24",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_34",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_29",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_33",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_32",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_00",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Red",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_26",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Winner_High",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:1,stagger:0,ducking:[{id:"duck-0",name:"music",target:"SECTION",cut:"FADE",end:"RESTORE",delta:.1}]},{name:"SFX_Spin_12",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Winner_Reg",type:"vo",volume:1,mute:!1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:1,stagger:0,ducking:[{id:"duck-0",name:"music",target:"SECTION",cut:"FADE",end:"RESTORE",delta:.1}]},{name:"VO_F_36",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Winner_Big",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:1,stagger:0,ducking:[{id:"duck-0",name:"music",target:"SECTION",cut:"FADE",end:"RESTORE",delta:.1}]},{name:"VO_M_11",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_F_Welcome_US_sbk",type:"vo",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Black",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Place_Your_Bets",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_15",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Odd",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_HereWeGo",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Welcome_US_cpo",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Welcome_US_hso",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Welcome_EU_hso",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_10",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Welcome_EU_cpo",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_6",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_11",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_3",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Welcome_US_sbk",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_30",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_2",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_1",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_4",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"VO_M_Welcome_EU_sbk",type:"vo",volume:1,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_9",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_8",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_7",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"SFX_Spin_5",type:"sfx",volume:.9,loop:!1,dedupe:!1,fade:!1,preload:!0,delay:0,stagger:0},{name:"Music_Classical",type:"music",volume:.22,loop:!0,dedupe:!1,fade:!0,preload:!0,delay:0,stagger:0},{name:"Music_Jazz",type:"music",volume:.35,mute:!1,loop:!0,dedupe:!1,fade:!0,preload:!0,delay:0,stagger:0},{name:"Music_Groovy",type:"music",volume:.2,loop:!0,dedupe:!1,fade:!0,preload:!0,delay:0,stagger:0},{name:"Music_CasinoAmbient",type:"music",volume:.2,loop:!0,dedupe:!1,fade:!0,preload:!0,delay:0,stagger:0},{name:"Music_Blues",type:"music",volume:.2,loop:!0,dedupe:!1,fade:!0,preload:!0,delay:0,stagger:0},{name:"Music_Neon",type:"music",volume:.18,loop:!0,dedupe:!1,fade:!0,preload:!0,delay:0,stagger:0},{name:"Music_Heavy",type:"music",volume:.2,loop:!0,dedupe:!1,fade:!0,preload:!0,delay:0,stagger:0},{name:"Music_Lounge",type:"music",volume:.2,loop:!0,dedupe:!1,fade:!0,preload:!0,delay:0,stagger:0},{name:"Music_Chill",type:"music",volume:.2,loop:!0,dedupe:!1,fade:!0,preload:!0,delay:0,stagger:0}]};var uu=o(7472);class du{static create(e){return new du(e)}constructor(e){this.howl=e}}du.Null=new du(null);class _u extends nu{loadInternal(e,t,i,s){const r=i?.preload??!1;return new Promise(((e,i)=>{const s=new uu.Howl({src:t.url,preload:r,onload:()=>{r&&e(du.create(s))},onloaderror:(e,s)=>{i(new Z(`Could not load sound at '${t.url}'. Error: ${s}`))}});r||e(du.create(s))}))}releaseInternal(e,t){t.howl?.unload()}}class pu{constructor(e,t,i){this._loadingMap=new Map,this._audioLoader=e,this._assetPathResolver=t,this._log=i}async loadMusic(e,t){const i={key:e.name,path:this._assetPathResolver.resolveAssetId(e).url,fade:!0,loop:!0,type:"music"};return await this.loadAudio(e,i,t)}async loadSFX(e,t){const i={key:e.name,path:this._assetPathResolver.resolveAssetId(e).url,type:"sfx"};return await this.loadAudio(e,i,t)}async loadVO(e,t,i){const s={key:e.name,path:this._assetPathResolver.resolveAssetId(e).url,type:"vo"};return s.preload=t.preload,await this.loadAudio(e,s,i)}injectAssetConfig(e){e.loop??(e.loop=!1),e.dedupe??(e.dedupe=!1),e.delay??(e.delay=0),e.stagger??(e.stagger=0),e.fade??(e.fade=!1),e.volume??(e.volume=1),e.preload??(e.preload=!0),e.mute??(e.mute=!1);const t=cu.tracks.find((t=>t.name===e.key));t&&(e.volume=t.volume,e.ducking=t.ducking)}async loadAudio(e,t,i){const s=this._loadingMap.get(e);if(s)return this._log.debug(`Audio '${e.name}' loading in progress. Returning cached promise`),await s;const r=new Promise(((s,r)=>{this._log.debug(`Initiating audio '${e.name}' loading`),this.injectAssetConfig(t),this._audioLoader.load(e,{preload:t.preload},i).then((i=>{i.howl?(this.applyClipParams(i.howl,t),lu.registerAudio(e.name,{res:t,snd:i.howl}),s(i),this._log.debug(`Audio '${e.name}' loaded`)):r(new Z(`No Howl was loaded for audio asset id '${e.name}'`))}))}));return this._loadingMap.set(e,r),await r}applyClipParams(e,t){void 0!==t.loop&&null!==t.loop&&e.loop(t.loop),null!==t.volume&&void 0!==t.volume&&e.volume(t.volume),null!==t.mute&&void 0!==t.mute&&e.mute(t.mute)}}class gu{constructor(e,t){this.name=e,this.fontFace=t}}class fu extends nu{async loadInternal(e,t,i,s){const r=new FontFace(e.name,`url(${t.url})`);return await r.load(),document.fonts.add(r),new gu(e.name,r)}releaseInternal(e,t){document.fonts.delete(t.fontFace)}}class mu{constructor(){this._items=[],this._previousItemIndex=-1}add(e){this._items.push(e),this._firstAvailableItemPromiseResolve&&(this._firstAvailableItemPromiseResolve(e),this._firstAvailableItemPromiseResolve=void 0,this._firstAvailableItemPromise=void 0)}getNextRandomItem(e,t){return this._items.length>0?Promise.resolve(this.pickRandomItem(e)):(this._firstAvailableItemPromise||(this._firstAvailableItemPromise=new Promise(((e,i)=>{this._firstAvailableItemPromiseResolve=e,t&&setTimeout((()=>{i(new $)}),t)}))),this._firstAvailableItemPromise)}pickRandomItem(e){if(1==this._items.length)return this._items[0];let t=this._items.map(((e,t)=>({item:e,originalIndex:t})));if(e||(t=t.filter((e=>e.originalIndex!=this._previousItemIndex))),1==t.length)return this._previousItemIndex=t[0].originalIndex,t[0].item;const i=t[Math.floor(Math.random()*t.length)];return this._previousItemIndex=i.originalIndex,i.item}}class bu{constructor(e,t,i){this._audioRequestedThisFrame=new Map,this._sfxPlayer=e,this._voPlayer=t,this._log=i}tick(){this._audioRequestedThisFrame.clear()}async play(e,t){if(this._log.debug(`Sound event: [${e.name}]`),t?.aborted)return;if(e instanceof ar)return this._voPlayer.announceNumber(e.payload,t);let i;switch(e){case or.UI_Click:i=Fe.SFX_UI_Click;break;case or.PlaceSingleChip:i=Fe.SFX_PlacedSingleChip;break;case or.PlaceChipsStack:i=Fe.SFX_PlacedChipStack;break;case or.ClearTable:i=Fe.SFX_ClearTable;break;case or.Win:i=Fe.SFX_Win;break;case or.WinBanner:i=Fe.SFX_WinBanner;break;case or.Lose:i=Fe.SFX_Lose;break;case or.Welcome:return this._voPlayer.welcome(t);case or.WinLow:return this._voPlayer.winLow(t);case or.WinMid:return this._voPlayer.winMid(t);case or.WinHigh:return this._voPlayer.winHigh(t);case or.MaleVoiceSelected:return this._voPlayer.hereWeGo("male",t);case or.FemaleVoiceSelected:return this._voPlayer.hereWeGo("female",t);case or.PlaceYourBets:return this._voPlayer.placeYourBets(t);case or.NoMoreBets:return this._voPlayer.noMoreBets(t);default:this._log.error(`Audio event [${e.name}] handling is not defined`)}if(i){if(this._audioRequestedThisFrame.get(i))return;this._audioRequestedThisFrame.set(i,!0),await this._sfxPlayer.play({name:i.name},t)}}}class vu{constructor(e,t){this.animation=e,this.audioAssetId=t}}class Tu{constructor(e,t){this._spinAnimationLoader=e,this._audioLoader=t}async loadSpinAnimationBundle(e){const t=this._spinAnimationLoader.load(e.animationAssetId),i=e.audioAssetId?this._audioLoader.loadSFX(e.audioAssetId):Promise.resolve(du.Null),[s,r]=await Promise.all([t,i]);let n;if(s.length>1){if(!e.animationId)throw new J(`Could not load spin animation bundle: multiple animations were loaded as '${e.animationAssetId}' but no spin animation id was specified`);n=s.find((t=>t.id===e.animationId))??(()=>{throw new J(`Could not load spin animation bundle: no spin animation with id '${e.animationId}' was found in a list of animations for asset id '${e.animationAssetId}'`)})()}else n=s[0];return new vu(n,e.audioAssetId)}}class yu{static getManifest(){return[{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-12T23:37:00.416Z]",audioAssetId:Fe.SFX_Spin_1},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:04:31.224Z]",audioAssetId:Fe.SFX_Spin_2},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:10:03.854Z]",audioAssetId:Fe.SFX_Spin_3},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:12:11.117Z]",audioAssetId:Fe.SFX_Spin_4},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:16:25.701Z]",audioAssetId:Fe.SFX_Spin_5},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:17:58.060Z]",audioAssetId:Fe.SFX_Spin_6},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:19:16.548Z]",audioAssetId:Fe.SFX_Spin_7},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:21:57.231Z]",audioAssetId:Fe.SFX_Spin_8},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:23:46.535Z]",audioAssetId:Fe.SFX_Spin_9},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:29:52.355Z]",audioAssetId:Fe.SFX_Spin_11},{animationAssetId:Le.BallAnimations,animationId:"Rec Id: [2025-05-13T00:31:48.101Z]",audioAssetId:Fe.SFX_Spin_12}]}}class xu{constructor(e,t){this._subscription=e.subscribe((()=>{t.emit("GameResultShown")}))}dispose(){this._subscription.unsubscribe()}}class Au{static async create(e){console.log("DEVTOOLS: Loading Inspector...");const t=await Promise.resolve().then(o.t.bind(o,7963,23));return console.log("DEVTOOLS: Inspector loaded"),new Au({inspectorApi:{show:()=>{t.Inspector.Show(e.scene,{enablePopup:!0,overlay:!0,embedMode:!0})},hide:()=>{t.Inspector.Hide()}},placedBetsCollection:e.placedBetsCollection,betOptions:e.betOptions,autoplayController:e.autoplayController,timeScaleStore:e.timeScaleStore,showOverBalanceCmd:e.showOverBalanceCmd})}constructor(e){this._inspectorShown=!1,this._api=e.inspectorApi;let t=!1;document.addEventListener("keydown",(i=>{switch(console.log(`Key: ${i.key}`),i.key){case"i":if(!i.ctrlKey)return;this._inspectorShown?this._api.hide():this._api.show(),this._inspectorShown=!this._inspectorShown;break;case"h":if(!i.ctrlKey)return;t=!t,Kr.debug_SetHitzonesVisible(t);break;case"b":{if(!i.ctrlKey)return;const t=e.betOptions.All.map((e=>new j(e,1e4))),s=new te(t);e.placedBetsCollection.tryApplySnapshot(s,!1);break}}}))}}class Cu{constructor(e,t,i){this._enabledObservable=new Q(!1),this._placedBetsCollection=e,this._startGameEvent=i,this._rebetStore=t}get enabled(){return this._enabledObservable.value}set enabled(e){this._enabledObservable.next(e)}get enabledObservable(){return this._enabledObservable}trySpin(){if(!this._enabledObservable.value)return!1;const e=this._rebetStore.rebetSnapshot;return!(!e||0==e.placedBets.length||(this._placedBetsCollection.updateObservable.pipe(Je()).subscribe((()=>{this._startGameEvent.next()})),this._placedBetsCollection.tryApplySnapshot(e,!0),0))}}class Su extends nu{constructor(e,t){super(e),this._getAssetManager=t}loadInternal(e,t,i){return new Promise(((s,r)=>{const n=this._getAssetManager(),o=n.addTextureTask(e.name,t.url,i?.noMipMaps,i?.invertY);o.onError=(e,t,i)=>{r(i??t)},o.onSuccess=()=>{s(o.texture)},n.load()}))}releaseInternal(e,t){t.dispose()}}var Eu=o(3116),Ru=o(1901);class Pu{constructor(e,t={}){this._lodGenerationOffset=0,this._lodGenerationScale=.8,this.quality=4096,this.hdrScale=1,this._engine=e,this.hdrScale=t.hdrScale||this.hdrScale,this.quality=t.quality||this.quality}_createRenderTarget(e){let t=0;this._engine.getCaps().textureHalfFloatRender?t=2:this._engine.getCaps().textureFloatRender&&(t=1);const i=this._engine.createRenderTargetCubeTexture(e,{format:5,type:t,createMipMaps:!0,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:1,label:"HDR_Radiance_Filtering_Target"});return this._engine.updateTextureWrappingMode(i.texture,0,0,0),this._engine.updateTextureSamplingMode(3,i.texture,!0),i}_prefilterInternal(e){const t=e.getSize().width,i=(0,Wo.ILog2)(t)+1,s=this._effectWrapper.effect,r=this._createRenderTarget(t);this._effectRenderer.saveStates(),this._effectRenderer.setViewport();const n=e.getInternalTexture();n&&this._engine.updateTextureSamplingMode(3,n,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper);const o=[[new zl.Pq(0,0,-1),new zl.Pq(0,-1,0),new zl.Pq(1,0,0)],[new zl.Pq(0,0,1),new zl.Pq(0,-1,0),new zl.Pq(-1,0,0)],[new zl.Pq(1,0,0),new zl.Pq(0,0,1),new zl.Pq(0,1,0)],[new zl.Pq(1,0,0),new zl.Pq(0,0,-1),new zl.Pq(0,-1,0)],[new zl.Pq(1,0,0),new zl.Pq(0,-1,0),new zl.Pq(0,0,1)],[new zl.Pq(-1,0,0),new zl.Pq(0,-1,0),new zl.Pq(0,0,-1)]];s.setFloat("hdrScale",this.hdrScale),s.setFloat2("vFilteringInfo",e.getSize().width,i),s.setTexture("inputTexture",e);for(let e=0;e<6;e++){s.setVector3("up",o[e][0]),s.setVector3("right",o[e][1]),s.setVector3("front",o[e][2]);for(let n=0;n<i;n++){this._engine.bindFramebuffer(r,e,void 0,void 0,!0,n),this._effectRenderer.applyEffectWrapper(this._effectWrapper);let i=Math.pow(2,(n-this._lodGenerationOffset)/this._lodGenerationScale)/t;0===n&&(i=0),s.setFloat("alphaG",i),this._effectRenderer.draw()}}this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),this._engine._releaseTexture(e._texture);const a=r.texture.type,h=r.texture.format;return r._swapAndDie(e._texture),e._texture.type=a,e._texture.format=h,e.gammaSpace=!1,e.lodGenerationOffset=this._lodGenerationOffset,e.lodGenerationScale=this._lodGenerationScale,e._prefiltered=!0,e}_createEffect(e,t){const i=[];e.gammaSpace&&i.push("#define GAMMA_INPUT"),i.push("#define NUM_SAMPLES "+this.quality+"u");const s=this._engine.isWebGPU;return new Ta.$({engine:this._engine,name:"hdrFiltering",vertexShader:"hdrFiltering",fragmentShader:"hdrFiltering",samplerNames:["inputTexture"],uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale","alphaG"],useShaderStore:!0,defines:i,onCompiled:t,shaderLanguage:s?1:0,extraInitializationsAsync:async()=>{s?await Promise.all([o.e(5630).then(o.bind(o,5630)),o.e(8080).then(o.bind(o,8080))]):await Promise.all([o.e(5311).then(o.bind(o,5311)),o.e(325).then(o.bind(o,325))])}})}isReady(e){return e.isReady()&&this._effectWrapper.effect.isReady()}async prefilter(e){if(!this._engine._features.allowTexturePrefiltering)throw new Error("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead.");this._effectRenderer=new Ta.J(this._engine),this._effectWrapper=this._createEffect(e),await this._effectWrapper.effect.whenCompiledAsync(),this._prefilterInternal(e),this._effectRenderer.dispose(),this._effectWrapper.dispose()}}var Iu=o(8551);class Mu{get iblSource(){return this._iblSource}set iblSource(e){this._iblSource!==e&&(this._disposeTextures(),this._iblSource=e,e&&(e.isCube,e.isReadyOrNotBlocking()?this._recreateAssetsFromNewIbl():e.onLoadObservable.addOnce(this._recreateAssetsFromNewIbl.bind(this,e))))}_recreateAssetsFromNewIbl(){this._debugPass&&this._debugPass.dispose(),this._createTextures(),this._debugPass&&this._createDebugPass()}getIcdfTexture(){return this._icdfPT?this._icdfPT:this._dummyTexture}setDebugDisplayParams(e,t,i,s){this._debugSizeParams.set(e,t,i,s)}get debugPassName(){return this._debugPassName}getDebugPassPP(){return this._debugPass||this._createDebugPass(),this._debugPass}constructor(e){this.debugEnabled=!1,this._debugSizeParams=new gt.IU(0,0,1,1),this._debugPassName="CDF Debug",this.onGeneratedObservable=new Zi.cP,e?Mu._IsScene(e)?this._scene=e:this._engine=e:this._scene=os.q.LastCreatedScene,this._scene&&(this._engine=this._scene.getEngine());const t=new Uint16Array([0,0,0,255]);this._dummyTexture=new Iu.I(t,1,1,Me.N.TEXTUREFORMAT_RGBA,e,!1,!1,void 0,2),this._scene&&Mu._SceneComponentInitialization(this._scene)}_createTextures(){const e=this._iblSource?{width:this._iblSource.getSize().width,height:this._iblSource.getSize().height}:{width:1,height:1};this._iblSource||(this._iblSource=Iu.I.CreateRTexture(new Uint8Array([255]),1,1,this._engine,!1,!1,1,0),this._iblSource.name="Placeholder IBL Source"),this._iblSource.isCube&&(e.width*=4,e.height*=2,e.width=1<<Math.floor(Math.log2(e.width)),e.height=1<<Math.floor(Math.log2(e.height)));const t=this._engine.isWebGPU,i={generateDepthBuffer:!1,generateMipMaps:!1,format:6,type:1,samplingMode:1,shaderLanguage:t?1:0,gammaSpace:!1,extraInitializationsAsync:async()=>{t?await Promise.all([o.e(3102).then(o.bind(o,3102)),o.e(9815).then(o.bind(o,9815)),o.e(6637).then(o.bind(o,6637))]):await Promise.all([o.e(1061).then(o.bind(o,1061)),o.e(8524).then(o.bind(o,8524)),o.e(1608).then(o.bind(o,1608))])}},s={generateDepthBuffer:!1,generateMipMaps:!1,format:5,type:2,samplingMode:1,shaderLanguage:t?1:0,gammaSpace:!1,extraInitializationsAsync:async()=>{t?await Promise.all([o.e(4831).then(o.bind(o,4831))]):await Promise.all([o.e(4076).then(o.bind(o,4076))])}};this._cdfyPT=new lc("cdfyTexture",{width:e.width,height:e.height+1},"iblCdfy",this._scene,i,!1,!1),this._cdfyPT.autoClear=!1,this._cdfyPT.setTexture("iblSource",this._iblSource),this._cdfyPT.setInt("iblHeight",e.height),this._cdfyPT.wrapV=0,this._cdfyPT.refreshRate=0,this._iblSource.isCube&&(this._cdfyPT.defines="#define IBL_USE_CUBE_MAP\n"),this._cdfxPT=new lc("cdfxTexture",{width:e.width+1,height:1},"iblCdfx",this._scene,i,!1,!1),this._cdfxPT.autoClear=!1,this._cdfxPT.setTexture("cdfy",this._cdfyPT),this._cdfxPT.refreshRate=0,this._cdfxPT.wrapU=0,this._scaledLuminancePT=new lc("iblScaledLuminance",{width:e.width,height:e.height},"iblScaledLuminance",this._scene,{...s,samplingMode:3,generateMipMaps:!0},!0,!1),this._scaledLuminancePT.autoClear=!1,this._scaledLuminancePT.setTexture("iblSource",this._iblSource),this._scaledLuminancePT.setInt("iblHeight",e.height),this._scaledLuminancePT.setInt("iblWidth",e.width),this._scaledLuminancePT.refreshRate=0,this._iblSource.isCube&&(this._scaledLuminancePT.defines="#define IBL_USE_CUBE_MAP\n"),this._icdfPT=new lc("icdfTexture",{width:e.width,height:e.height},"iblIcdf",this._scene,s,!1,!1),this._icdfPT.autoClear=!1,this._icdfPT.setTexture("cdfy",this._cdfyPT),this._icdfPT.setTexture("cdfx",this._cdfxPT),this._icdfPT.setTexture("iblSource",this._iblSource),this._icdfPT.setTexture("scaledLuminanceSampler",this._scaledLuminancePT),this._icdfPT.refreshRate=0,this._icdfPT.wrapV=0,this._icdfPT.wrapU=0,this._iblSource.isCube&&(this._icdfPT.defines="#define IBL_USE_CUBE_MAP\n"),this._icdfPT.onGeneratedObservable.addOnce((()=>{this.onGeneratedObservable.notifyObservers()}))}_disposeTextures(){this._cdfyPT?.dispose(),this._cdfxPT?.dispose(),this._icdfPT?.dispose(),this._scaledLuminancePT?.dispose()}_createDebugPass(){this._debugPass&&this._debugPass.dispose();const e=this._engine.isWebGPU,t={width:this._engine.getRenderWidth(),height:this._engine.getRenderHeight(),samplingMode:Dt.g.BILINEAR_SAMPLINGMODE,engine:this._engine,textureType:0,uniforms:["sizeParams"],samplers:["cdfy","icdf","cdfx","iblSource"],defines:this._iblSource?.isCube?"#define IBL_USE_CUBE_MAP\n":"",shaderLanguage:e?1:0,extraInitializations:(e,t)=>{e?t.push(o.e(8907).then(o.bind(o,8907))):t.push(o.e(2752).then(o.bind(o,2752)))}};this._debugPass=new va.w(this._debugPassName,"iblCdfDebug",t);const i=this._debugPass.getEffect();i&&(i.defines=this._iblSource?.isCube?"#define IBL_USE_CUBE_MAP\n":""),this._iblSource?.isCube&&this._debugPass.updateEffect("#define IBL_USE_CUBE_MAP\n"),this._debugPass.onApplyObservable.add((e=>{e.setTexture("cdfy",this._cdfyPT),e.setTexture("icdf",this._icdfPT),e.setTexture("cdfx",this._cdfxPT),e.setTexture("iblSource",this._iblSource),e.setFloat4("sizeParams",this._debugSizeParams.x,this._debugSizeParams.y,this._debugSizeParams.z,this._debugSizeParams.w)}))}isReady(){return this._iblSource&&"Placeholder IBL Source"!==this._iblSource.name&&this._iblSource.isReady()&&this._cdfyPT&&this._cdfyPT.isReady()&&this._icdfPT&&this._icdfPT.isReady()&&this._cdfxPT&&this._cdfxPT.isReady()&&this._scaledLuminancePT&&this._scaledLuminancePT.isReady()}renderWhenReady(){this._icdfPT.onGeneratedObservable.addOnce((()=>{this.onGeneratedObservable.notifyObservers()}));const e=[],t=[this._cdfyPT,this._cdfxPT,this._scaledLuminancePT,this._icdfPT];return t.forEach((t=>{e.push(new Promise((e=>{t.isReady()?e():t.getEffect().executeWhenCompiled((()=>{e()}))})))})),Promise.all(e).then((()=>{t.forEach((e=>{e.render()}))}))}dispose(){this._disposeTextures(),this._dummyTexture.dispose(),this._debugPass&&this._debugPass.dispose(),this.onGeneratedObservable.clear()}static _IsScene(e){return"Scene"===e.getClassName()}}Mu._SceneComponentInitialization=e=>{throw(0,Aa.n)("IblCdfGeneratorSceneComponentSceneComponent")};class wu{constructor(e,t={}){this.quality=4096,this.hdrScale=1,this.useCdf=!1,this._engine=e,this.hdrScale=t.hdrScale||this.hdrScale,this.quality=t.quality||this.quality,this.useCdf=t.useCdf||this.useCdf}_createRenderTarget(e){let t=0;this._engine.getCaps().textureHalfFloatRender?t=2:this._engine.getCaps().textureFloatRender&&(t=1);const i=this._engine.createRenderTargetCubeTexture(e,{format:5,type:t,createMipMaps:!1,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:2,label:"HDR_Irradiance_Filtering_Target"});return this._engine.updateTextureWrappingMode(i.texture,0,0,0),i}_prefilterInternal(e){const t=e.getSize().width,i=(0,Wo.ILog2)(t),s=this._effectWrapper.effect,r=Math.max(32,1<<(0,Wo.ILog2)(t>>3)),n=this._createRenderTarget(r);this._effectRenderer.saveStates(),this._effectRenderer.setViewport(),this._effectRenderer.applyEffectWrapper(this._effectWrapper);const o=[[new zl.Pq(0,0,-1),new zl.Pq(0,-1,0),new zl.Pq(1,0,0)],[new zl.Pq(0,0,1),new zl.Pq(0,-1,0),new zl.Pq(-1,0,0)],[new zl.Pq(1,0,0),new zl.Pq(0,0,1),new zl.Pq(0,1,0)],[new zl.Pq(1,0,0),new zl.Pq(0,0,-1),new zl.Pq(0,-1,0)],[new zl.Pq(1,0,0),new zl.Pq(0,-1,0),new zl.Pq(0,0,1)],[new zl.Pq(-1,0,0),new zl.Pq(0,-1,0),new zl.Pq(0,0,-1)]];s.setFloat("hdrScale",this.hdrScale),s.setFloat2("vFilteringInfo",e.getSize().width,i),s.setTexture("inputTexture",e),this._cdfGenerator&&s.setTexture("icdfTexture",this._cdfGenerator.getIcdfTexture());for(let e=0;e<6;e++)s.setVector3("up",o[e][0]),s.setVector3("right",o[e][1]),s.setVector3("front",o[e][2]),this._engine.bindFramebuffer(n,e,void 0,void 0,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper),this._effectRenderer.draw();this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),s.setTexture("inputTexture",null),s.setTexture("icdfTexture",null);const a=new dh.t(e.getScene(),n.texture);return a.name=e.name+"_irradiance",a.displayName=e.name+"_irradiance",a.gammaSpace=!1,a}_createEffect(e,t){const i=[];e.gammaSpace&&i.push("#define GAMMA_INPUT"),i.push("#define NUM_SAMPLES "+this.quality+"u");const s=this._engine.isWebGPU,r=["inputTexture"];return this._cdfGenerator&&(r.push("icdfTexture"),i.push("#define IBL_CDF_FILTERING")),new Ta.$({engine:this._engine,name:"HDRIrradianceFiltering",vertexShader:"hdrIrradianceFiltering",fragmentShader:"hdrIrradianceFiltering",samplerNames:r,uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale"],useShaderStore:!0,defines:i,onCompiled:t,shaderLanguage:s?1:0,extraInitializationsAsync:async()=>{s?await Promise.all([o.e(5216).then(o.bind(o,5216)),o.e(1050).then(o.bind(o,1050))]):await Promise.all([o.e(885).then(o.bind(o,885)),o.e(2923).then(o.bind(o,2923))])}})}isReady(e){return e.isReady()&&this._effectWrapper.effect.isReady()}async prefilter(e){if(!this._engine._features.allowTexturePrefiltering)throw new Error("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead.");this.useCdf&&(this._cdfGenerator=new Mu(this._engine),this._cdfGenerator.iblSource=e,await this._cdfGenerator.renderWhenReady()),this._effectRenderer=new Ta.J(this._engine),this._effectWrapper=this._createEffect(e),await this._effectWrapper.effect.whenCompiledAsync();const t=this._prefilterInternal(e);return this._effectRenderer.dispose(),this._effectWrapper.dispose(),this._cdfGenerator?.dispose(),t}}var Ou=o(1498);o(1146);class Bu extends dh.t{set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(gt.uq.RotationY(this._rotationY))}get rotationY(){return this._rotationY}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}constructor(e,t,i,s=!1,r=!0,n=!1,o=!1,a=null,h=null,l=!1,c=!1,u=!1){super(t),this._generateHarmonics=!0,this._onError=null,this._isBlocking=!0,this._rotationY=0,this.boundingBoxPosition=gt.Pq.Zero(),this.onLoadObservable=new Zi.cP,e&&(this._coordinatesMode=Dt.g.CUBIC_MODE,this.name=e,this.url=e,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=gt.uq.Identity(),this._prefilterOnLoad=o,this._prefilterIrradianceOnLoad=c,this._prefilterUsingCdf=u,this._onLoad=()=>{this.onLoadObservable.notifyObservers(this),a&&a()},this._onError=h,this.gammaSpace=n,this._noMipmap=s,this._size=i,this._supersample=l,this._generateHarmonics=r,this._texture=this._getFromCache(e,this._noMipmap,void 0,void 0,void 0,this.isCube),this._texture?this._texture.isReady?$i.S0.SetImmediate((()=>this._onLoad())):this._texture.onLoadedObservable.add(this._onLoad):this.getScene()?.useDelayedTextureLoading?this.delayLoadState=4:this._loadTexture())}getClassName(){return"HDRCubeTexture"}_loadTexture(){const e=this._getEngine(),t=e.getCaps();let i=0;if(t.textureFloat&&t.textureFloatLinearFiltering?i=1:t.textureHalfFloat&&t.textureHalfFloatLinearFiltering&&(i=2),e._features.allowTexturePrefiltering&&(this._prefilterOnLoad||this._prefilterIrradianceOnLoad)){const t=this._onLoad,i=new Pu(e);this._onLoad=()=>{let s=Promise.resolve(null),r=Promise.resolve();this._prefilterIrradianceOnLoad&&(s=new wu(e,{useCdf:this._prefilterUsingCdf}).prefilter(this)),this._prefilterOnLoad&&(r=i.prefilter(this)),Promise.all([s,r]).then((e=>{const i=e[0];if(this._prefilterIrradianceOnLoad&&i){this.irradianceTexture=i;const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}t&&t()}))}}this._texture=e.createRawCubeTextureFromUrl(this.url,this.getScene(),this._size,4,i,this._noMipmap,(e=>{this.lodGenerationOffset=0,this.lodGenerationScale=.8;const t=(0,Eu.VH)(e,this._size,this._supersample);if(this._generateHarmonics){const e=Ru.d.ConvertCubeMapToSphericalPolynomial(t);this.sphericalPolynomial=e}const s=[];let r=null,n=null;for(let e=0;e<6;e++){2===i?n=new Uint16Array(this._size*this._size*3):0===i&&(r=new Uint8Array(this._size*this._size*3));const o=t[Bu._FacesMapping[e]];if(this.gammaSpace||n||r)for(let e=0;e<this._size*this._size;e++)if(this.gammaSpace&&(o[3*e+0]=Math.pow(o[3*e+0],bs.rv),o[3*e+1]=Math.pow(o[3*e+1],bs.rv),o[3*e+2]=Math.pow(o[3*e+2],bs.rv)),n&&(n[3*e+0]=(0,Ou.LZ)(o[3*e+0]),n[3*e+1]=(0,Ou.LZ)(o[3*e+1]),n[3*e+2]=(0,Ou.LZ)(o[3*e+2])),r){let t=Math.max(255*o[3*e+0],0),i=Math.max(255*o[3*e+1],0),s=Math.max(255*o[3*e+2],0);const n=Math.max(Math.max(t,i),s);if(n>255){const e=255/n;t*=e,i*=e,s*=e}r[3*e+0]=t,r[3*e+1]=i,r[3*e+2]=s}n?s.push(n):r?s.push(r):s.push(o)}return s}),null,this._onLoad,this._onError)}clone(){const e=new Bu(this.url,this.getScene()||this._getEngine(),this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e}delayLoad(){4===this.delayLoadState&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this._loadTexture())}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){this._textureMatrix=e,e.updateFlag!==this._textureMatrix.updateFlag&&e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene()?.markAllMaterialsAsDirty(1,(e=>-1!==e.getActiveTextures().indexOf(this)))}dispose(){this.onLoadObservable.clear(),super.dispose()}static Parse(e,t,i){let s=null;return e.name&&!e.isRenderTarget&&(s=new Bu(i+e.name,t,e.size,e.noMipmap,e.generateHarmonics,e.useInGammaSpace),s.name=e.name,s.hasAlpha=e.hasAlpha,s.level=e.level,s.coordinatesMode=e.coordinatesMode,s.isBlocking=e.isBlocking),s&&(e.boundingBoxPosition&&(s.boundingBoxPosition=gt.Pq.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(s.boundingBoxSize=gt.Pq.FromArray(e.boundingBoxSize)),e.rotationY&&(s.rotationY=e.rotationY)),s}serialize(){if(!this.name)return null;const e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this.gammaSpace,e.generateHarmonics=this._generateHarmonics,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e.rotationY=this._rotationY,e}}Bu._FacesMapping=["right","left","up","down","front","back"],(0,Ft.Y5)("BABYLON.HDRCubeTexture",Bu);var Du,Fu=o(7473),Lu=o(9649);class Nu extends dh.t{constructor(e,t,i,s=!1,r=!0,n=null,o=null,a=!1){if(super(t),this._onLoad=null,this._onError=null,!e)throw new Error("Image url is not set");this._coordinatesMode=Dt.g.CUBIC_MODE,this.name=e,this.url=e,this._size=i,this._supersample=a,this._noMipmap=s,this.gammaSpace=r,this._onLoad=n,this._onError=o,this.hasAlpha=!1,this.isCube=!0,this._texture=this._getFromCache(e,this._noMipmap,void 0,void 0,void 0,this.isCube),this._texture?n&&(this._texture.isReady?$i.S0.SetImmediate((()=>n())):this._texture.onLoadedObservable.add(n)):t.useDelayedTextureLoading?this.delayLoadState=4:this._loadImage((()=>this._loadTexture()),this._onError)}_loadImage(e,t){const i=this.getScene();if(!i)return;const s=i.getEngine().createRawCubeTexture(null,this._size,4,i.getEngine().getCaps().textureFloat?1:7,!this._noMipmap,!1,3);s.generateMipMaps=!this._noMipmap,i.addPendingData(s),s.url=this.url,s.isReady=!1,i.getEngine()._internalTexturesCache.push(s),this._texture=s,(0,Lu.W$)(this.url,(t=>{let i;this._width=t.width,this._height=t.height,(0,Fh.Nf)()?(i=document.createElement("canvas"),i.width=this._width,i.height=this._height):i=new OffscreenCanvas(this._width,this._height);const s=i.getContext("2d");s.drawImage(t,0,0);const r=s.getImageData(0,0,t.width,t.height);this._buffer=r.data.buffer,i.remove&&i.remove(),e()}),((e,r)=>{i.removePendingData(s),t&&t(`${this.getClassName()} could not be loaded`,r)}),i?i.offlineProvider:null)}_loadTexture(){const e=this.getScene();if(!e)return;const t=(()=>{const e=this._getFloat32ArrayFromArrayBuffer(this._buffer),t=Fu.D.ConvertPanoramaToCubemap(e,this._width,this._height,this._size,this._supersample),i=[];for(let e=0;e<6;e++){const s=t[Nu._FacesMapping[e]];i.push(s)}return i})(),i=this._texture;e.getEngine().updateRawCubeTexture(i,t,i.format,i.type,i.invertY),i.isReady=!0,e.removePendingData(i),i.onLoadedObservable.notifyObservers(i),i.onLoadedObservable.clear(),this._onLoad&&this._onLoad()}_getFloat32ArrayFromArrayBuffer(e){const t=new DataView(e),i=new Float32Array(3*e.byteLength/4);let s=0;for(let r=0;r<e.byteLength;r++)(r+1)%4!=0&&(i[s++]=t.getUint8(r)/255);return i}getClassName(){return"EquiRectangularCubeTexture"}clone(){const e=this.getScene();if(!e)return this;const t=new Nu(this.url,e,this._size,this._noMipmap,this.gammaSpace);return t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t.coordinatesIndex=this.coordinatesIndex,t.coordinatesMode=this.coordinatesMode,t}}Nu._FacesMapping=["right","left","up","down","front","back"],function(e){e[e.INIT=0]="INIT",e[e.RUNNING=1]="RUNNING",e[e.DONE=2]="DONE",e[e.ERROR=3]="ERROR"}(Du||(Du={}));class ku{constructor(e){this.name=e,this._isCompleted=!1,this._taskState=0}get isCompleted(){return this._isCompleted}get taskState(){return this._taskState}get errorObject(){return this._errorObject}_setErrorObject(e,t){this._errorObject||(this._errorObject={message:e,exception:t})}run(e,t,i){this._taskState=1,this.runTask(e,(()=>{this._onDoneCallback(t,i)}),((e,t)=>{this._onErrorCallback(i,e,t)}))}runTask(e,t,i){throw new Error("runTask is not implemented")}reset(){this._taskState=0}_onErrorCallback(e,t,i){this._taskState=3,this._errorObject={message:t,exception:i},this.onError&&this.onError(this,t,i),e()}_onDoneCallback(e,t){try{this._taskState=2,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),e()}catch(e){this._onErrorCallback(t,"Task is done, error executing success callback(s)",e)}}}class Uu{constructor(e,t,i){this.remainingCount=e,this.totalCount=t,this.task=i}}class Vu extends ku{constructor(e,t,i,s,r){super(e),this.name=e,this.meshesNames=t,this.rootUrl=i,this.sceneFilename=s,this.extension=r}runTask(e,t,i){Ue.cn.LoadAssetContainer(this.rootUrl,this.sceneFilename,e,(e=>{this.loadedContainer=e,this.loadedMeshes=e.meshes,this.loadedTransformNodes=e.transformNodes,this.loadedParticleSystems=e.particleSystems,this.loadedSkeletons=e.skeletons,this.loadedAnimationGroups=e.animationGroups,t()}),null,((e,t,s)=>{i(t,s)}),this.extension)}}class Gu extends ku{constructor(e,t,i,s,r){super(e),this.name=e,this.meshesNames=t,this.rootUrl=i,this.sceneFilename=s,this.extension=r}runTask(e,t,i){Ue.cn.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,e,((e,i,s,r,n)=>{this.loadedMeshes=e,this.loadedTransformNodes=n,this.loadedParticleSystems=i,this.loadedSkeletons=s,this.loadedAnimationGroups=r,t()}),null,((e,t,s)=>{i(t,s)}),this.extension)}}class zu extends ku{constructor(e,t){super(e),this.name=e,this.url=t}runTask(e,t,i){e._loadFile(this.url,(e=>{this.text=e,t()}),void 0,!1,!1,((e,t)=>{e&&i(e.status+" "+e.statusText,t)}))}}class Hu extends ku{constructor(e,t){super(e),this.name=e,this.url=t}runTask(e,t,i){e._loadFile(this.url,(e=>{this.data=e,t()}),void 0,!0,!0,((e,t)=>{e&&i(e.status+" "+e.statusText,t)}))}}class Wu extends ku{constructor(e,t){super(e),this.name=e,this.url=t}runTask(e,t,i){const s=new Image;$i.S0.SetCorsBehavior(this.url,s),s.onload=()=>{this.image=s,t()},s.onerror=e=>{i("Error loading image",e)},s.src=this.url}}class Xu extends ku{constructor(e,t,i,s=!0,r=Dt.g.TRILINEAR_SAMPLINGMODE){super(e),this.name=e,this.url=t,this.noMipmap=i,this.invertY=s,this.samplingMode=r}runTask(e,t,i){this.texture=new Dt.g(this.url,e,this.noMipmap,this.invertY,this.samplingMode,(()=>{t()}),((e,t)=>{i(e,t)}))}}class qu extends ku{constructor(e,t,i,s,r,n){super(e),this.name=e,this.url=t,this.extensions=i,this.noMipmap=s,this.files=r,this.prefiltered=n}runTask(e,t,i){this.texture=new ph.b(this.url,e,this.extensions,this.noMipmap,this.files,(()=>{t()}),((e,t)=>{i(e,t)}),void 0,this.prefiltered)}}class Qu extends ku{constructor(e,t,i,s=!1,r=!0,n=!1,o=!1){super(e),this.name=e,this.url=t,this.size=i,this.noMipmap=s,this.generateHarmonics=r,this.gammaSpace=n,this.reserved=o}runTask(e,t,i){this.texture=new Bu(this.url,e,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,(()=>{t()}),((e,t)=>{i(e,t)}))}}class Ku extends ku{constructor(e,t,i,s=!1,r=!0){super(e),this.name=e,this.url=t,this.size=i,this.noMipmap=s,this.gammaSpace=r}runTask(e,t,i){this.texture=new Nu(this.url,e,this.size,this.noMipmap,this.gammaSpace,(()=>{t()}),((e,t)=>{i(e,t)}))}}class Yu{constructor(e){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new Zi.cP,this.onTaskErrorObservable=new Zi.cP,this.onTasksDoneObservable=new Zi.cP,this.onProgressObservable=new Zi.cP,this.useDefaultLoadingScreen=!0,this.autoHideLoadingUI=!0,this._scene=e||os.q.LastCreatedScene}addContainerTask(e,t,i,s,r){const n=new Vu(e,t,i,s,r);return this._tasks.push(n),n}addMeshTask(e,t,i,s,r){const n=new Gu(e,t,i,s,r);return this._tasks.push(n),n}addTextFileTask(e,t){const i=new zu(e,t);return this._tasks.push(i),i}addBinaryFileTask(e,t){const i=new Hu(e,t);return this._tasks.push(i),i}addImageTask(e,t){const i=new Wu(e,t);return this._tasks.push(i),i}addTextureTask(e,t,i,s,r=Dt.g.TRILINEAR_SAMPLINGMODE){const n=new Xu(e,t,i,s,r);return this._tasks.push(n),n}addCubeTextureTask(e,t,i,s,r,n){const o=new qu(e,t,i,s,r,n);return this._tasks.push(o),o}addHDRCubeTextureTask(e,t,i,s=!1,r=!0,n=!1,o=!1){const a=new Qu(e,t,i,s,r,n,o);return this._tasks.push(a),a}addEquiRectangularCubeTextureAssetTask(e,t,i,s=!1,r=!0){const n=new Ku(e,t,i,s,r);return this._tasks.push(n),n}removeTask(e){const t=this._tasks.indexOf(e);t>-1&&this._tasks.splice(t,1)}_decreaseWaitingTasksCount(e){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,e),this.onProgressObservable.notifyObservers(new Uu(this._waitingTasksCount,this._totalTasksCount,e))}catch(e){It.V.Error("Error running progress callbacks."),It.V.Log(e)}if(0===this._waitingTasksCount){try{const e=this._tasks.slice();this.onFinish&&this.onFinish(e);for(const t of e)if(2===t.taskState){const e=this._tasks.indexOf(t);e>-1&&this._tasks.splice(e,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(e){It.V.Error("Error running tasks-done callbacks."),It.V.Log(e)}this._isLoading=!1,this.autoHideLoadingUI&&this._scene.getEngine().hideLoadingUI()}}_runTask(e){const t=(t,i)=>{e._setErrorObject(t,i),this.onTaskError?this.onTaskError(e):e.onError||It.V.Error(this._formatTaskErrorMessage(e)),this.onTaskErrorObservable.notifyObservers(e),this._decreaseWaitingTasksCount(e)};e.run(this._scene,(()=>{try{this.onTaskSuccess&&this.onTaskSuccess(e),this.onTaskSuccessObservable.notifyObservers(e),this._decreaseWaitingTasksCount(e)}catch(e){t("Error executing task success callbacks",e)}}),t)}_formatTaskErrorMessage(e){let t="Unable to complete task "+e.name;return e.errorObject.message&&(t+=`: ${e.errorObject.message}`),e.errorObject.exception&&(t+=`: ${e.errorObject.exception}`),t}reset(){return this._isLoading=!1,this._tasks=new Array,this}load(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(let e=0;e<this._tasks.length;e++){const t=this._tasks[e];0===t.taskState&&this._runTask(t)}return this}loadAsync(){return new Promise(((e,t)=>{this._isLoading?e():(this.onTasksDoneObservable.addOnce((i=>{i&&i.length?t(i):e()})),this.load())}))}}class ju extends nu{constructor(e,t){super(e),this._getAssetManager=t}loadInternal(e,t){return new Promise(((i,s)=>{const r=this._getAssetManager(),n=r.addImageTask(e.name,t.url);n.onError=(i,r,n)=>{s(new Z(`Error loading image. Asset id: '${e.name}', url: '${t.url}'. Details: ${n??r}`))},n.onSuccess=()=>{i(n.image)},r.load()}))}releaseInternal(e,t){t.parentElement&&t.parentElement.removeChild(t)}}class Zu{setTimeScale(e){}mute(e){}waitForCompletion(){return Promise.resolve(this)}pause(){}stop(){}resume(){}}class $u{constructor(e){this._clip=e.clip,this._id=e.id;const t=this;this._completionPromise=new Promise(((i,s)=>{e.clip.on("end",(()=>{i(t)})),e.clip.on("stop",(()=>{i(t)}))}))}setTimeScale(e){this._clip.rate(e)}mute(e){this._clip.mute(e)}waitForCompletion(){return this._completionPromise}stop(){this._clip.playing(this._id)&&this._clip.stop(this._id)}pause(){this._clip.playing(this._id)&&this._clip.pause(this._id)}resume(){this._clip.playing(this._id)||this._clip.play(this._id)}}class Ju{constructor(){this._lowpassFiltersMap=new Map,this.volumeLvl="high",this.volumeLvls={low:.3,mid:.6,high:1}}get isMute(){return this.muted}get volume(){return Howler.volume()}set volume(e){Howler.volume(e),this.onStateChange&&this.onStateChange()}get volumeLevel(){return this.volumeLvl}set volumeLevel(e){Object.keys(this.volumeLvls).includes(e)&&(this.volumeLvl=e,this.volume=this.volumeLvls[e])}get volumeLevels(){return this.volumeLvls}getAudioClip(e){return lu.Audio.get(e)}getAllAudioClips(){const e=[];for(const t of lu.Audio.values())e.push(t);return e}setVolumeLevels(e){const{low:t,mid:i,high:s}=e;this.volumeLvls.low=t??this.volumeLvls.low,this.volumeLvls.mid=i??this.volumeLvls.mid,this.volumeLvls.high=s??this.volumeLvls.high,this.volumeLevel=this.volumeLvl}setStateChangeHandler(e){this.onStateChange=e}setClipStateChangeHandler(e){this.onClipStateChange=e}updateClip(e){const t=lu.Audio.get(e.key);if(t&&(void 0!==e.volume&&(t.res.volume=e.volume),void 0!==e.delay&&(t.res.delay=e.delay),void 0!==e.stagger&&(t.res.stagger=e.stagger),t.res.mute=e.mute??t.res.mute,t.res.loop=e.loop??t.res.loop,t.res.dedupe=e.dedupe??t.res.dedupe,t.res.fade=e.fade??t.res.fade,t.res.preload=e.preload??t.res.preload,t.snd.mute(t.res.mute??!1),t.snd.volume(t.res.volume??0),t.mute=t.res.mute,e.ducking))for(const i of e.ducking){const e=t.res.ducking?.find((e=>e.id===i.id));e&&(i.name&&(e.name=i.name),i.target&&(e.target=i.target),i.cut&&(e.cut=i.cut),i.end&&(e.end=i.end),i.delta&&(e.delta=i.delta))}}addToClip(e){var t;const i=lu.Audio.get(e.key);if(i&&e.ducking){(t=i.res).ducking??(t.ducking=[]);for(const t of e.ducking)i.res.ducking.push({...t})}}removeFromClip(e){const t=lu.Audio.get(e.key);if(t&&e.ducking)for(const i of e.ducking)t.res.ducking?.splice(t.res.ducking.findIndex((e=>e.id===i.id)))}init(){let e=!1;const t=()=>{this.hidden="hidden"===document.visibilityState,this.hidden&&(e=this.muted),this.mute(this.hidden||e)};t(),document.addEventListener("visibilitychange",t),this.muted=!1,this.hidden=!1}mute(e){this.muted=!!this.hidden||e,Howler.mute(this.muted),this.onStateChange&&this.onStateChange()}playSequence(...e){let t=null;for(const i of e){const e=lu.Audio.get(i.name);if(e){if(t){const e=this,s=i.delay?async()=>{await si.Delay(1e3*(i.delay??0)),e.play(i)}:i.stagger?async()=>{await si.Delay(1e3*(i.stagger??0)),e.play(i)}:()=>{e.play(i)};i.stagger?t.snd.once("play",s):t.snd.once("end",s)}t=e}}this.play(e[0])}play(e,t){return new Promise((i=>{const s=lu.Audio.get(e.name);if(!s)return new Zu;if(s.res.dedupe&&s.last&&performance.now()-s.last<100)return new Zu;if(t?.aborted)return new Zu;s.last=performance.now();const r=()=>{s.snd.stop()};t&&t.addEventListener("abort",r,{once:!0});const n=this,o=()=>{if(s.res.ducking&&n.handlePlayWithDucking(s),e.filters?.lowpass){let t=n._lowpassFiltersMap.get(s.snd);t||(t=Howler.ctx.createBiquadFilter(),t.type="lowpass",t.frequency.value=e.filters.lowpass.frequency,e.filters.lowpass.q&&(t.Q.value=e.filters.lowpass.q),s.snd._sounds[0]._node.connect(t),t.connect(Howler.masterGain),n.registerLowpassFilter(s.snd,t))}else n.tryDeactivateLowpassFilter(s.snd);const t=s.snd.play();s.res.fade&&s.res.volume?s.snd.fade(0,s.res.volume,500):s.res.volume&&s.snd.volume(s.res.volume),s.playing=!0,i(new $u({clip:s.snd,id:t}))};s.res.preload||"loaded"===s.snd.state()?o():(s.snd.load(),s.snd.once("load",(()=>o()))),s.snd.once(s.res.loop?"stop":"end",(()=>{s.playing=!1,t&&t.removeEventListener("abort",r),this.onClipStateChange&&this.onClipStateChange(s)})),this.onClipStateChange&&this.onClipStateChange(s)}))}stop(...e){for(const t of e){const e=lu.Audio.get(t.name);e.res.fade?(e.snd.fade(e.snd.volume(),0,500),e.snd.once("fade",(()=>{e.playing=!1,e.snd.stop()}))):(e.playing=!1,e.snd.stop())}}handlePlayWithDucking(e){if(e.res.ducking)for(const t of e.res.ducking){const{name:i,target:s,cut:r,end:n,delta:o}=t,a="TRACK"===s?lu.Audio.get(i):null;if(!("TRACK"!==s||a&&a.playing))continue;const h=[];if("TRACK"===s&&null!=a)h.push(a);else for(const t of lu.Audio.values())t.res.type===i&&t.res.key!==e.res.key&&h.push(t);let l=!1;for(const e of h)e.playing&&("HARD"===r?e.snd.volume(Math.max(0,(e.res.volume??0)-(o??0))):"FADE"===r?e.snd.fade(e.res.volume??0,Math.max(0,(e.res.volume??0)-(o??0)),250):"MUTE"===r?e.snd.mute(!0):this.stop({name:e.res.key}),l=!0);l&&"RESTORE"===n&&e.snd.once("end",(()=>{for(const e of h)e.playing&&("HARD"===r?e.snd.volume(e.res.volume??0):"FADE"===r?e.snd.fade(Math.max(0,(e.res.volume??0)-(o??0)),e.res.volume??0,250):"MUTE"===r&&e.snd.mute(!1))}))}}registerLowpassFilter(e,t){this._lowpassFiltersMap.set(e,t)}tryDeactivateLowpassFilter(e){const t=this._lowpassFiltersMap.get(e);if(!t)return;Howler.ctx,this._lowpassFiltersMap.delete(e);const i=e._sounds[0];i._node.disconnect(t),i._node.connect(Howler.masterGain)}}class ed{constructor(){this.audioToolExchange=null,this.updatingAudio=!1}async initialize(){this.audioToolExchange=this._createAudioExchange();const e={state:{home:{},scene:{},assets:{},audio:{volume:Ln.volume,level:Ln.volumeLevel,levels:Ln.volumeLevels,mute:Ln.isMute,music:Ln.music.isActive,sfx:Ln.sfx.isActive,voice:Ln.voice.isActive,tracks:this._getAudioTracks()},system:{}},exchange:{refresh:!1,exchanges:{home:null,scene:null,assets:null,audio:this.audioToolExchange,system:null}}};DEV&&await DEV.tools.load(e)}start(){Ln.setStateChangeHandler((()=>this._handleAudioStateChange())),Ln.setClipStateChangeHandler((e=>this._handleAudioTrackStateChange(e)))}_handleAudioStateChange(){this.updatingAudio||this.audioToolExchange.ingress.push({flags:["MASTER"]},{volume:Ln.volume,level:Ln.volumeLevel,levels:Ln.volumeLevels,mute:Ln.isMute,music:Ln.music.isActive,sfx:Ln.sfx.isActive,voice:Ln.voice.isActive})}_handleAudioTrackStateChange(e){this.updatingAudio||this.audioToolExchange.ingress.push({flags:["TRACKS"],items:[e.res.key]},{tracks:this._getAudioTracks([e.res.key])})}_getAudioTracks(e){const t=e=>{const{res:t,snd:i,playing:s,mute:r}=e,{key:n,type:o,volume:a,loop:h,dedupe:l,fade:c,preload:u,delay:d,stagger:_,ducking:p}=t;return{name:n,type:o,volume:a,loop:h,dedupe:l,fade:c,preload:u,delay:d,stagger:_,duration:i.duration().toFixed(1),status:s?"playing":"stopped",mute:r,ducking:(p??[]).map((e=>({...e})))}};return e?e.map((e=>t(Ln.getAudioClip(e)))):Ln.getAllAudioClips().map((e=>t(e)))}_createAudioExchange(){return{egress:{push:(e,t)=>{if(e.flags&&e.flags.includes("PLAY"))for(const t of e.items)Ln.play(t);else{if(this.updatingAudio=!0,(!e.flags||e.flags.includes("ALL")||e.flags.includes("MASTER"))&&(t.volume>=0&&(Ln.volume=t.volume),t.level&&(Ln.volumeLevel=t.level),t.levels&&Ln.setVolumeLevels(t.levels),Ln.mute(t.mute??Ln.isMute),Ln.music.setActive(t.music??Ln.music.isActive),Ln.sfx.setActive(t.sfx??Ln.sfx.isActive),Ln.ui.setActive(Ln.sfx.isActive),Ln.voice.setActive(t.voice??Ln.voice.isActive)),!e.flags||(e.flags.includes("ALL")||e.flags.includes("TRACKS"))&&e.items&&t.tracks)for(const i of e.items){const s=t.tracks.find((e=>e.name===i));s&&(e.flags.includes("EDIT")&&Ln.updateClip({...s,key:s.name}),e.flags.includes("ADD")&&Ln.addToClip({...s,key:s.name}),e.flags.includes("REMOVE")&&Ln.removeFromClip({...s,key:s.name}))}this.updatingAudio=!1}},pull:(e,t)=>{const i={};return(e.flags.includes("ALL")||e.flags.includes("MASTER"))&&(i.volume=Ln.volume,i.levels=Ln.volumeLevels,i.mute=Ln.isMute,i.music=Ln.music.isActive,i.sfx=Ln.sfx.isActive,i.voice=Ln.voice.isActive),e.flags.includes("ALL")?i.tracks=this._getAudioTracks():e.flags.includes("TRACKS")&&e.items&&(i.tracks=this._getAudioTracks(e.items)),i}}}}}class td{constructor(e){this._disposed=!1,this._availabilitySubject=new Q(!1),this._lockingReasons=[td.UnavailableByDefault],this.name=e}dispose(){this._disposed||(this._disposed=!0,this.disposeInternal())}get available(){return this._availabilitySubject.value}get availabilityObservable(){return this._availabilitySubject}execute(){return new Promise(((e,t)=>{this._availabilitySubject.value||t(new Z(`Action [${this.name}] can not be executed since it's not available`)),e(this.executeInternal())}))}disposeInternal(){}enable(){this._availabilitySubject.value||(this._lockingReasons.length=0,this._availabilitySubject.next(!0))}disable(e){this._lockingReasons.length=0,e&&e.length>0&&this._lockingReasons.push(...e),this._availabilitySubject.value&&this._availabilitySubject.next(!1)}get lockingReasons(){return this._lockingReasons}}td.UnavailableByDefault="UnavailableByDefault";class id extends td{constructor(e){super("Double Bets"),this._placedBetsWithErrorsHandling=e.placedBetsWithErrorHandling,this._fromReset=e.fromReset,this._placedBetsWithErrorsHandling.placedBetsCollection.updateObservable.subscribe((()=>{this.checkAndUpdateAvailability(this._placedBetsWithErrorsHandling.placedBetsCollection.getSnapshot())}))}async executeInternal(){const e=this._placedBetsWithErrorsHandling.placedBetsCollection.getSnapshot().placedBets.map((e=>new j(e.spot,2*e.cents))),t=new te(e);this._placedBetsWithErrorsHandling.tryApplySnapshot(t,this._fromReset)}checkAndUpdateAvailability(e){const t=this.checkLockingReasons(e);0===t.length?this.enable():this.disable(t)}checkLockingReasons(e){const t=[];return 0===e.totalBetCents?(t.push(id.LockedNoBetsOnField),t):t}}id.LockedByMaxTotalBet="LockedByMaxTotalBet",id.LockedNotEnoughMoney="LockedNotEnoughMoney",id.LockedNoBetsOnField="LockedNoBetsOnField",id.LockedByBetSpotMaxBet="LockedByBetSpotMaxBet";class sd{constructor(e,t){this._emitter=e,this._muteAll=new Q(t.mute??!1),this._musicEnabled=new Q(t.music??!0),this._sfxEnabled=new Q(t.sfx??!0),this._voiceEnabled=new Q(t.voice??!0),this._voiceType=new Q(t.voiceType??"male"),this._musicType=new Q(t.musicType??"jazz"),this._feltColor=new Q(t.feltColor??0),this._wheelSpinningMode=new Q(t.wheelSpinningMode??"alt"),this._gameSpeed=new Q(t.gameSpeed??Ir.Normal),this._pipEnabled=new Q(t.pip??!0),this._rightHanded=new Q(t.rightHanded??!0),this._skipIntro=new Q(t.skipIntro??!1)}get muteAll(){return this._muteAll}get musicEnabled(){return this._musicEnabled}get sfxEnabled(){return this._sfxEnabled}get voiceEnabled(){return this._voiceEnabled}get voiceType(){return this._voiceType}get musicType(){return this._musicType}get feltColor(){return this._feltColor}get wheelSpinningMode(){return this._wheelSpinningMode}get gameSpeed(){return this._gameSpeed}get pipEnabled(){return this._pipEnabled}get rightHanded(){return this._rightHanded}get skipIntro(){return this._skipIntro}setMute(e){this._muteAll.value!==e&&(this._muteAll.next(e),this._emitter.emit("GameSetOption","mute",e))}setMusicEnabled(e){this._musicEnabled.value!==e&&(this._musicEnabled.next(e),this._emitter.emit("GameSetOption","music",e))}setSFXEnabled(e){this._sfxEnabled.value!==e&&(this._sfxEnabled.next(e),this._emitter.emit("GameSetOption","sfx",e))}setVoiceEnabled(e){this._voiceEnabled.value!==e&&(this._voiceEnabled.next(e),this._emitter.emit("GameSetOption","voice",e))}setVoiceType(e){this._voiceType.value!==e&&(this._voiceType.next(e),this._emitter.emit("GameSetOption","voiceType",e))}setMusicType(e){this._musicType.value!==e&&(this._musicType.next(e),this._emitter.emit("GameSetOption","musicType",e))}setFeltColor(e){this._feltColor.value!==e&&(this._feltColor.next(e),this._emitter.emit("GameSetOption","feltColor",e))}setWheelSpinningMode(e){this._wheelSpinningMode.value!==e&&(this._wheelSpinningMode.next(e),this._emitter.emit("GameSetOption","wheelSpinningMode",e))}setGameSpeed(e){this._gameSpeed.value!==e&&(this._gameSpeed.next(e),this._emitter.emit("GameSetOption","gameSpeed",e))}setPipEnabled(e){this._pipEnabled.value!==e&&(this._pipEnabled.next(e),this._emitter.emit("GameSetOption","pip",e))}setRightHanded(e){this._rightHanded.value!==e&&(this._rightHanded.next(e),this._emitter.emit("GameSetOption","rightHanded",e))}setSkipIntro(e){this._skipIntro.value!==e&&(this._skipIntro.next(e),this._emitter.emit("GameSetOption","skipIntro",e))}}var rd=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(rd||{}),nd=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS",e))(nd||{}),od=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(od||{}),ad=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(ad||{}),hd=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(hd||{}),ld=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(ld||{}),cd=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(cd||{}),ud=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(ud||{}),dd=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(dd||{}),_d=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(_d||{}),pd=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(pd||{}),gd=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(gd||{}),fd=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(fd||{}),md=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(md||{}),bd=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(bd||{}),vd=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(vd||{}),Td=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(Td||{}),yd=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(yd||{}),xd=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(xd||{});const Ad={ADAPTER:{createCanvas:(e,t)=>{const i=document.createElement("canvas");return i.width=e,i.height=t,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>(new DOMParser).parseFromString(e,"text/xml")},RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Cd=/iPhone/i,Sd=/iPod/i,Ed=/iPad/i,Rd=/\biOS-universal(?:.+)Mac\b/i,Pd=/\bAndroid(?:.+)Mobile\b/i,Id=/Android/i,Md=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,wd=/Silk/i,Od=/Windows Phone/i,Bd=/\bWindows(?:.+)ARM\b/i,Dd=/BlackBerry/i,Fd=/BB10/i,Ld=/Opera Mini/i,Nd=/\b(CriOS|Chrome)(?:.+)Mobile/i,kd=/Mobile(?:.+)Firefox\b/i,Ud=function(e){return void 0!==e&&"MacIntel"===e.platform&&"number"==typeof e.maxTouchPoints&&e.maxTouchPoints>1&&"undefined"==typeof MSStream};function Vd(e){var t={userAgent:"",platform:"",maxTouchPoints:0};e||"undefined"==typeof navigator?"string"==typeof e?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}):t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=t.userAgent,s=i.split("[FBAN");void 0!==s[1]&&(i=s[0]),void 0!==(s=i.split("Twitter"))[1]&&(i=s[0]);var r=function(e){return function(t){return t.test(e)}}(i),n={apple:{phone:r(Cd)&&!r(Od),ipod:r(Sd),tablet:!r(Cd)&&(r(Ed)||Ud(t))&&!r(Od),universal:r(Rd),device:(r(Cd)||r(Sd)||r(Ed)||r(Rd)||Ud(t))&&!r(Od)},amazon:{phone:r(Md),tablet:!r(Md)&&r(wd),device:r(Md)||r(wd)},android:{phone:!r(Od)&&r(Md)||!r(Od)&&r(Pd),tablet:!r(Od)&&!r(Md)&&!r(Pd)&&(r(wd)||r(Id)),device:!r(Od)&&(r(Md)||r(wd)||r(Pd)||r(Id))||r(/\bokhttp\b/i)},windows:{phone:r(Od),tablet:r(Bd),device:r(Od)||r(Bd)},other:{blackberry:r(Dd),blackberry10:r(Fd),opera:r(Ld),firefox:r(kd),chrome:r(Nd),device:r(Dd)||r(Fd)||r(Ld)||r(kd)||r(Nd)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Gd=(Vd.default??Vd)(globalThis.navigator);Ad.RETINA_PREFIX=/@([0-9\.]+)x/,Ad.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var zd=o(4272),Hd=o(5230);o(9983);const Wd={};function Xd(e,t,i=3){if(Wd[t])return;let s=(new Error).stack;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`):(s=s.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}\nDeprecated since v${e}`),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`),console.warn(s))),Wd[t]=!0}function qd(e){if("string"!=typeof e)throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function Qd(e){return e.split("?")[0].split("#")[0]}const Kd={toPosix:e=>e.replace(new RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/"),isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl:e=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e),isBlobUrl:e=>e.startsWith("blob:"),hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){qd(e),e=this.toPosix(e);const t=/^file:\/\/\//.exec(e);if(t)return t[0];const i=/^[^/:]+:\/{0,2}/.exec(e);return i?i[0]:""},toAbsolute(e,t,i){if(qd(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;const s=Qd(this.toPosix(t??Ad.ADAPTER.getBaseUrl())),r=Qd(this.toPosix(i??this.rootname(s)));return(e=this.toPosix(e)).startsWith("/")?Kd.join(r,e.slice(1)):this.isAbsolute(e)?e:this.join(s,e)},normalize(e){if(qd(e),0===e.length)return".";if(this.isDataUrl(e)||this.isBlobUrl(e))return e;let t="";const i=(e=this.toPosix(e)).startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const s=e.endsWith("/");return e=function(e){let t="",i=0,s=-1,r=0,n=-1;for(let o=0;o<=e.length;++o){if(o<e.length)n=e.charCodeAt(o);else{if(47===n)break;n=47}if(47===n){if(s!==o-1&&1!==r)if(s!==o-1&&2===r){if(t.length<2||2!==i||46!==t.charCodeAt(t.length-1)||46!==t.charCodeAt(t.length-2))if(t.length>2){const e=t.lastIndexOf("/");if(e!==t.length-1){-1===e?(t="",i=0):(t=t.slice(0,e),i=t.length-1-t.lastIndexOf("/")),s=o,r=0;continue}}else if(2===t.length||1===t.length){t="",i=0,s=o,r=0;continue}}else t.length>0?t+=`/${e.slice(s+1,o)}`:t=e.slice(s+1,o),i=o-s-1;s=o,r=0}else 46===n&&-1!==r?++r:r=-1}return t}(e),e.length>0&&s&&(e+="/"),i?`/${e}`:t+e},isAbsolute(e){return qd(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith("/")},join(...e){if(0===e.length)return".";let t;for(let i=0;i<e.length;++i){const s=e[i];if(qd(s),s.length>0)if(void 0===t)t=s;else{const r=e[i-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?t+=`/../${s}`:t+=`/${s}`}}return void 0===t?".":this.normalize(t)},dirname(e){if(qd(e),0===e.length)return".";let t=(e=this.toPosix(e)).charCodeAt(0);const i=47===t;let s=-1,r=!0;const n=this.getProtocol(e),o=e;for(let i=(e=e.slice(n.length)).length-1;i>=1;--i)if(t=e.charCodeAt(i),47===t){if(!r){s=i;break}}else r=!1;return-1===s?i?"/":this.isUrl(o)?n+e:n:i&&1===s?"//":n+e.slice(0,s)},rootname(e){qd(e);let t="";if(t=(e=this.toPosix(e)).startsWith("/")?"/":this.getProtocol(e),this.isUrl(e)){const i=e.indexOf("/",t.length);t=-1!==i?e.slice(0,i):e,t.endsWith("/")||(t+="/")}return t},basename(e,t){qd(e),t&&qd(t),e=Qd(this.toPosix(e));let i,s=0,r=-1,n=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let o=t.length-1,a=-1;for(i=e.length-1;i>=0;--i){const h=e.charCodeAt(i);if(47===h){if(!n){s=i+1;break}}else-1===a&&(n=!1,a=i+1),o>=0&&(h===t.charCodeAt(o)?-1==--o&&(r=i):(o=-1,r=a))}return s===r?r=a:-1===r&&(r=e.length),e.slice(s,r)}for(i=e.length-1;i>=0;--i)if(47===e.charCodeAt(i)){if(!n){s=i+1;break}}else-1===r&&(n=!1,r=i+1);return-1===r?"":e.slice(s,r)},extname(e){qd(e);let t=-1,i=0,s=-1,r=!0,n=0;for(let o=(e=Qd(this.toPosix(e))).length-1;o>=0;--o){const a=e.charCodeAt(o);if(47!==a)-1===s&&(r=!1,s=o+1),46===a?-1===t?t=o:1!==n&&(n=1):-1!==t&&(n=-1);else if(!r){i=o+1;break}}return-1===t||-1===s||0===n||1===n&&t===s-1&&t===i+1?"":e.slice(t,s)},parse(e){qd(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;let i=(e=Qd(this.toPosix(e))).charCodeAt(0);const s=this.isAbsolute(e);let r;t.root=this.rootname(e),r=s||this.hasProtocol(e)?1:0;let n=-1,o=0,a=-1,h=!0,l=e.length-1,c=0;for(;l>=r;--l)if(i=e.charCodeAt(l),47!==i)-1===a&&(h=!1,a=l+1),46===i?-1===n?n=l:1!==c&&(c=1):-1!==n&&(c=-1);else if(!h){o=l+1;break}return-1===n||-1===a||0===c||1===c&&n===a-1&&n===o+1?-1!==a&&(t.base=t.name=0===o&&s?e.slice(1,a):e.slice(o,a)):(0===o&&s?(t.name=e.slice(1,n),t.base=e.slice(1,a)):(t.name=e.slice(o,n),t.base=e.slice(o,a)),t.ext=e.slice(n,a)),t.dir=this.dirname(e),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let Yd,jd;async function Zd(){return Yd??(Yd=(async()=>{const e=document.createElement("canvas").getContext("webgl");if(!e)return fd.UNPACK;const t=await new Promise((e=>{const t=document.createElement("video");t.onloadeddata=()=>e(t),t.onerror=()=>e(null),t.autoplay=!1,t.crossOrigin="anonymous",t.preload="auto",t.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",t.load()}));if(!t)return fd.UNPACK;const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);const r=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,r),e.deleteFramebuffer(s),e.deleteTexture(i),e.getExtension("WEBGL_lose_context")?.loseContext(),r[0]<=r[3]?fd.PMA:fd.UNPACK})()),Yd}function $d(){return typeof jd>"u"&&(jd=function(){const e={stencil:!0,failIfMajorPerformanceCaveat:Ad.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Ad.ADAPTER.getWebGLRenderingContext())return!1;const t=Ad.ADAPTER.createCanvas();let i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);const s=!!i?.getContextAttributes()?.stencil;if(i){const e=i.getExtension("WEBGL_lose_context");e&&e.loseContext()}return i=null,s}catch{return!1}}()),jd}var Jd={grad:.9,turn:360,rad:360/(2*Math.PI)},e_=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},t_=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=Math.pow(10,t)),Math.round(i*e)/i+0},i_=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),e>i?i:e>t?e:t},s_=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},r_=function(e){return{r:i_(e.r,0,255),g:i_(e.g,0,255),b:i_(e.b,0,255),a:i_(e.a)}},n_=function(e){return{r:t_(e.r),g:t_(e.g),b:t_(e.b),a:t_(e.a,3)}},o_=/^#([0-9a-f]{3,8})$/i,a_=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},h_=function(e){var t=e.r,i=e.g,s=e.b,r=e.a,n=Math.max(t,i,s),o=n-Math.min(t,i,s),a=o?n===t?(i-s)/o:n===i?2+(s-t)/o:4+(t-i)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:r}},l_=function(e){var t=e.h,i=e.s,s=e.v,r=e.a;t=t/360*6,i/=100,s/=100;var n=Math.floor(t),o=s*(1-i),a=s*(1-(t-n)*i),h=s*(1-(1-t+n)*i),l=n%6;return{r:255*[s,a,o,o,h,s][l],g:255*[h,s,s,a,o,o][l],b:255*[o,o,h,s,s,a][l],a:r}},c_=function(e){return{h:s_(e.h),s:i_(e.s,0,100),l:i_(e.l,0,100),a:i_(e.a)}},u_=function(e){return{h:t_(e.h),s:t_(e.s),l:t_(e.l),a:t_(e.a,3)}},d_=function(e){return l_((i=(t=e).s,{h:t.h,s:(i*=((s=t.l)<50?s:100-s)/100)>0?2*i/(s+i)*100:0,v:s+i,a:t.a}));var t,i,s},__=function(e){return{h:(t=h_(e)).h,s:(r=(200-(i=t.s))*(s=t.v)/100)>0&&r<200?i*s/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,i,s,r},p_=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,g_=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,f_=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m_=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,b_={string:[[function(e){var t=o_.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?t_(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?t_(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=f_.exec(e)||m_.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:r_({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=p_.exec(e)||g_.exec(e);if(!t)return null;var i,s,r=c_({h:(i=t[1],s=t[2],void 0===s&&(s="deg"),Number(i)*(Jd[s]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return d_(r)},"hsl"]],object:[[function(e){var t=e.r,i=e.g,s=e.b,r=e.a,n=void 0===r?1:r;return e_(t)&&e_(i)&&e_(s)?r_({r:Number(t),g:Number(i),b:Number(s),a:Number(n)}):null},"rgb"],[function(e){var t=e.h,i=e.s,s=e.l,r=e.a,n=void 0===r?1:r;if(!e_(t)||!e_(i)||!e_(s))return null;var o=c_({h:Number(t),s:Number(i),l:Number(s),a:Number(n)});return d_(o)},"hsl"],[function(e){var t=e.h,i=e.s,s=e.v,r=e.a,n=void 0===r?1:r;if(!e_(t)||!e_(i)||!e_(s))return null;var o=function(e){return{h:s_(e.h),s:i_(e.s,0,100),v:i_(e.v,0,100),a:i_(e.a)}}({h:Number(t),s:Number(i),v:Number(s),a:Number(n)});return l_(o)},"hsv"]]},v_=function(e,t){for(var i=0;i<t.length;i++){var s=t[i][0](e);if(s)return[s,t[i][1]]}return[null,void 0]},T_=function(e,t){var i=__(e);return{h:i.h,s:i_(i.s+100*t,0,100),l:i.l,a:i.a}},y_=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},x_=function(e,t){var i=__(e);return{h:i.h,s:i.s,l:i_(i.l+100*t,0,100),a:i.a}},A_=function(){function e(e){this.parsed=function(e){return"string"==typeof e?v_(e.trim(),b_.string):"object"==typeof e&&null!==e?v_(e,b_.object):[null,void 0]}(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return t_(y_(this.rgba),2)},e.prototype.isDark=function(){return y_(this.rgba)<.5},e.prototype.isLight=function(){return y_(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=n_(this.rgba)).r,i=e.g,s=e.b,n=(r=e.a)<1?a_(t_(255*r)):"","#"+a_(t)+a_(i)+a_(s)+n;var e,t,i,s,r,n},e.prototype.toRgb=function(){return n_(this.rgba)},e.prototype.toRgbString=function(){return t=(e=n_(this.rgba)).r,i=e.g,s=e.b,(r=e.a)<1?"rgba("+t+", "+i+", "+s+", "+r+")":"rgb("+t+", "+i+", "+s+")";var e,t,i,s,r},e.prototype.toHsl=function(){return u_(__(this.rgba))},e.prototype.toHslString=function(){return t=(e=u_(__(this.rgba))).h,i=e.s,s=e.l,(r=e.a)<1?"hsla("+t+", "+i+"%, "+s+"%, "+r+")":"hsl("+t+", "+i+"%, "+s+"%)";var e,t,i,s,r},e.prototype.toHsv=function(){return e=h_(this.rgba),{h:t_(e.h),s:t_(e.s),v:t_(e.v),a:t_(e.a,3)};var e},e.prototype.invert=function(){return C_({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),C_(T_(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),C_(T_(this.rgba,-e))},e.prototype.grayscale=function(){return C_(T_(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),C_(x_(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),C_(x_(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?C_({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):t_(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=__(this.rgba);return"number"==typeof e?C_({h:e,s:t.s,l:t.l,a:t.a}):t_(t.h)},e.prototype.isEqual=function(e){return this.toHex()===C_(e).toHex()},e}(),C_=function(e){return e instanceof A_?e:new A_(e)},S_=[];!function(e){e.forEach((function(e){S_.indexOf(e)<0&&(e(A_,b_),S_.push(e))}))}([function(e,t){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var r in i)s[i[r]]=r;var n={};e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,o,a=s[this.toHex()];if(a)return a;if(null==t?void 0:t.closest){var h=this.toRgb(),l=1/0,c="black";if(!n.length)for(var u in i)n[u]=new e(i[u]).toRgb();for(var d in i){var _=(r=h,o=n[d],Math.pow(r.r-o.r,2)+Math.pow(r.g-o.g,2)+Math.pow(r.b-o.b,2));_<l&&(l=_,c=d)}return c}},t.string.push([function(t){var s=t.toLowerCase(),r="transparent"===s?"#0000":i[s];return r?new e(r).toRgb():null},"name"])}]);const E_=class e{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(t){if(t instanceof e)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(e){return"string"==typeof e||"number"==typeof e||e instanceof Number||null===e?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):"object"==typeof e&&null!==e?{...e}:e}isSourceEqual(e,t){const i=typeof e;if(i!==typeof t)return!1;if("number"===i||"string"===i||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length===t.length&&e.every(((e,i)=>e===t[i]));if(null!==e&&null!==t){const i=Object.keys(e),s=Object.keys(t);return i.length===s.length&&i.every((i=>e[i]===t[i]))}return e===t}toRgba(){const[e,t,i,s]=this._components;return{r:e,g:t,b:i,a:s}}toRgb(){const[e,t,i]=this._components;return{r:e,g:t,b:i}}toRgbaString(){const[e,t,i]=this.toUint8RgbArray();return`rgba(${e},${t},${i},${this.alpha})`}toUint8RgbArray(e){const[t,i,s]=this._components;return(e=e??[])[0]=Math.round(255*t),e[1]=Math.round(255*i),e[2]=Math.round(255*s),e}toRgbArray(e){e=e??[];const[t,i,s]=this._components;return e[0]=t,e[1]=i,e[2]=s,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(65280&e)+((255&e)<<16)}multiply(t){const[i,s,r,n]=e.temp.setValue(t)._components;return this._components[0]*=i,this._components[1]*=s,this._components[2]*=r,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(1===e)return(255<<24)+this._int;if(0===e)return t?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,r=255&this._int;return t&&(i=i*e+.5|0,s=s*e+.5|0,r=r*e+.5|0),(255*e<<24)+(i<<16)+(s<<8)+r}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,i,s]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(i*e)/e,this._components[2]=Math.round(s*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,i,s,r]=this._components;return e[0]=t,e[1]=i,e[2]=s,e[3]=r,e}normalize(t){let i,s,r,n;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215)i=(t>>16&255)/255,s=(t>>8&255)/255,r=(255&t)/255,n=1;else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[i,s,r,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[i,s,r,n=255]=t,i/=255,s/=255,r/=255,n/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const i=e.HEX_PATTERN.exec(t);i&&(t=`#${i[2]}`)}const o=C_(t);o.isValid()&&(({r:i,g:s,b:r,a:n}=o.rgba),i/=255,s/=255,r/=255)}if(void 0===i)throw new Error(`Unable to convert color ${t}`);this._components[0]=i,this._components[1]=s,this._components[2]=r,this._components[3]=n,this.refreshInt()}refreshInt(){this._clamp(this._components);const[e,t,i]=this._components;this._int=(255*e<<16)+(255*t<<8)+(255*i|0)}_clamp(e,t=0,i=1){return"number"==typeof e?Math.min(Math.max(e,t),i):(e.forEach(((s,r)=>{e[r]=Math.min(Math.max(s,t),i)})),e)}};E_.shared=new E_,E_.temp=new E_,E_.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let R_=E_;const P_=function(){const e=[],t=[];for(let i=0;i<32;i++)e[i]=i,t[i]=i;e[ad.NORMAL_NPM]=ad.NORMAL,e[ad.ADD_NPM]=ad.ADD,e[ad.SCREEN_NPM]=ad.SCREEN,t[ad.NORMAL]=ad.NORMAL_NPM,t[ad.ADD]=ad.ADD_NPM,t[ad.SCREEN]=ad.SCREEN_NPM;const i=[];return i.push(t),i.push(e),i}();function I_(e,t){return P_[t?1:0][e]}function M_(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return"Uint16Array"}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return"Uint8Array";return null}function w_(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)}function O_(e){return!(e&e-1||!e)}function B_(e){let t=(e>65535?1:0)<<4,i=((e>>>=t)>255?1:0)<<3;return t|=i,i=((e>>>=i)>15?1:0)<<2,t|=i,i=((e>>>=i)>3?1:0)<<1,t|=i,t|(e>>>=i)>>1}function D_(e,t,i){const s=e.length;let r;if(t>=s||0===i)return;const n=s-(i=t+i>s?s-t:i);for(r=t;r<n;++r)e[r]=e[r+i];e.length=n}function F_(e){return 0===e?0:e<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let L_=0;function N_(){return++L_}const k_=class{constructor(e,t,i,s){this.left=e,this.top=t,this.right=i,this.bottom=s}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};k_.EMPTY=new k_(0,0,0,0);let U_=k_;const V_={},G_=Object.create(null),z_=Object.create(null);class H_{constructor(e,t,i){this._canvas=Ad.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||Ad.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function W_(e,t,i){for(let s=0,r=4*i*t;s<t;++s,r+=4)if(0!==e[r+3])return!1;return!0}function X_(e,t,i,s,r){const n=4*t;for(let t=s,o=s*n+4*i;t<=r;++t,o+=n)if(0!==e[o+3])return!1;return!0}function q_(e,t=1){const i=Ad.RETINA_PREFIX?.exec(e);return i?parseFloat(i[1]):t}var Q_=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(Q_||{});const K_=e=>{if("function"==typeof e||"object"==typeof e&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={..."object"!=typeof e.extension?{type:e.extension}:e.extension,ref:e}}if("object"!=typeof e)throw new Error("Invalid extension type");return"string"==typeof(e={...e}).type&&(e.type=[e.type]),e},Y_=(e,t)=>K_(e).priority??t,j_={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(K_).forEach((e=>{e.type.forEach((t=>this._removeHandlers[t]?.(e)))})),this},add(...e){return e.map(K_).forEach((e=>{e.type.forEach((t=>{const i=this._addHandlers,s=this._queue;i[t]?i[t]?.(e):(s[t]=s[t]||[],s[t]?.push(e))}))})),this},handle(e,t,i){const s=this._addHandlers,r=this._removeHandlers;if(s[e]||r[e])throw new Error(`Extension type ${e} already has a handler`);s[e]=t,r[e]=i;const n=this._queue;return n[e]&&(n[e]?.forEach((e=>t(e))),delete n[e]),this},handleByMap(e,t){return this.handle(e,(e=>{e.name&&(t[e.name]=e.ref)}),(e=>{e.name&&delete t[e.name]}))},handleByList(e,t,i=-1){return this.handle(e,(e=>{t.includes(e.ref)||(t.push(e.ref),t.sort(((e,t)=>Y_(t,i)-Y_(e,i))))}),(e=>{const i=t.indexOf(e.ref);-1!==i&&t.splice(i,1)}))}};class Z_{constructor(e){"number"==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const $_=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function J_(e){let t="";for(let i=0;i<e;++i)i>0&&(t+="\nelse "),i<e-1&&(t+=`if(test == ${i}.0){}`);return t}class ep{constructor(){this.data=0,this.blendMode=ad.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==ad.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new ep;return e.depthTest=!1,e.blend=!0,e}}ep.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const tp=[];function ip(e,t){if(!e)return null;let i="";if("string"==typeof e){const t=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);t&&(i=t[1].toLowerCase())}for(let s=tp.length-1;s>=0;--s){const r=tp[s];if(r.test&&r.test(e,i))return new r(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class sp{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,i,s,r,n,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let c=0,u=l.length;c<u;c++)l[c][h](e,t,i,s,r,n,o,a);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return-1!==t&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(sp.prototype,{dispatch:{value:sp.prototype.emit},run:{value:sp.prototype.emit}});class rp{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new sp("setRealSize"),this.onUpdate=new sp("update"),this.onError=new sp("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class np extends rp{constructor(e,t){const{width:i,height:s}=t||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,i){const s=e.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===fd.UNPACK);const r=t.realWidth,n=t.realHeight;return i.width===r&&i.height===n?s.texSubImage2D(t.target,0,0,0,r,n,t.format,i.type,this.data):(i.width=r,i.height=n,s.texImage2D(t.target,0,i.internalFormat,r,n,0,t.format,i.type,this.data)),!0}dispose(){this.data=null}static test(e){return null===e||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const op={scaleMode:_d.NEAREST,alphaMode:fd.NPM},ap=class e extends zd{constructor(t=null,i=null){super(),i=Object.assign({},e.defaultOptions,i);const{alphaMode:s,mipmap:r,anisotropicLevel:n,scaleMode:o,width:a,height:h,wrapMode:l,format:c,type:u,target:d,resolution:_,resourceOptions:p}=i;t&&!(t instanceof rp)&&((t=ip(t,p)).internal=!0),this.resolution=_||Ad.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=o,this.format=c,this.type=u,this.target=d,this.alphaMode=s,this.uid=N_(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let i;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,i=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,i=!0),i&&this.dirtyStyleId++,this}setSize(e,t,i){return i=i||this.resolution,this.setRealSize(e*i,t*i,i)}setRealSize(e,t,i){return this.resolution=i||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=O_(this.realWidth)&&O_(this.realHeight)}setResolution(e){const t=this.resolution;return t===e||(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT()),this}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete z_[this.cacheId],delete G_[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,i,s=Ad.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let n=null;if(r)n=t;else{if(!t._pixiId){const e=i?.pixiIdPrefix||"pixiid";t._pixiId=`${e}_${N_()}`}n=t._pixiId}let o=z_[n];if(r&&s&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new e(t,i),o.cacheId=n,e.addToCache(o,n)),o}static fromBuffer(t,i,s,r){t=t||new Float32Array(i*s*4);const n=new np(t,{width:i,height:s,...r?.resourceOptions});let o,a;return t instanceof Float32Array?(o=ld.RGBA,a=ud.FLOAT):t instanceof Int32Array?(o=ld.RGBA_INTEGER,a=ud.INT):t instanceof Uint32Array?(o=ld.RGBA_INTEGER,a=ud.UNSIGNED_INT):t instanceof Int16Array?(o=ld.RGBA_INTEGER,a=ud.SHORT):t instanceof Uint16Array?(o=ld.RGBA_INTEGER,a=ud.UNSIGNED_SHORT):t instanceof Int8Array?(o=ld.RGBA,a=ud.BYTE):(o=ld.RGBA,a=ud.UNSIGNED_BYTE),n.internal=!0,new e(n,Object.assign({},op,{type:a,format:o},r))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),z_[t]&&z_[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),z_[t]=e)}static removeFromCache(e){if("string"==typeof e){const t=z_[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete z_[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete z_[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};ap.defaultOptions={mipmap:gd.POW2,anisotropicLevel:0,scaleMode:_d.LINEAR,wrapMode:pd.CLAMP,alphaMode:fd.UNPACK,target:cd.TEXTURE_2D,format:ld.RGBA,type:ud.UNSIGNED_BYTE},ap._globalBatch=0;let hp=ap;class lp{constructor(){this.texArray=null,this.blend=0,this.type=hd.TRIANGLES,this.start=0,this.size=0,this.data=null}}let cp=0;class up{constructor(e,t=!0,i=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=t,this.id=cp++,this.disposeRunner=new sp("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?xd.ELEMENT_ARRAY_BUFFER:xd.ARRAY_BUFFER}get index(){return this.type===xd.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new up(e)}}class dp{constructor(e,t=0,i=!1,s=ud.FLOAT,r,n,o,a=1){this.buffer=e,this.size=t,this.normalized=i,this.type=s,this.stride=r,this.start=n,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(e,t,i,s,r){return new dp(e,t,i,s,r)}}const _p={Float32Array,Uint32Array,Int32Array,Uint8Array},pp={5126:4,5123:2,5121:1};let gp=0;const fp={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class mp{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=gp++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new sp("disposeGeometry"),this.refCount=0}addAttribute(e,t,i=0,s=!1,r,n,o,a=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof up||(t instanceof Array&&(t=new Float32Array(t)),t=new up(t));const h=e.split("|");if(h.length>1){for(let e=0;e<h.length;e++)this.addAttribute(h[e],t,i,s,r);return this}let l=this.buffers.indexOf(t);return-1===l&&(this.buffers.push(t),l=this.buffers.length-1),this.attributes[e]=new dp(l,i,s,r,n,o,a),this.instanced=this.instanced||a,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof up||(e instanceof Array&&(e=new Uint16Array(e)),e=new up(e)),e.type=xd.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const e=[],t=[],i=new up;let s;for(s in this.attributes){const i=this.attributes[s],r=this.buffers[i.buffer];e.push(r.data),t.push(i.size*pp[i.type]/4),i.buffer=0}for(i.data=function(e,t){let i=0,s=0;const r={};for(let r=0;r<e.length;r++)s+=t[r],i+=e[r].length;const n=new ArrayBuffer(4*i);let o=null,a=0;for(let i=0;i<e.length;i++){const h=t[i],l=e[i],c=M_(l);r[c]||(r[c]=new _p[c](n)),o=r[c];for(let e=0;e<l.length;e++)o[(e/h|0)*s+a+e%h]=l[e];a+=h}return new Float32Array(n)}(e,t),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new mp;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new up(this.buffers[t].data.slice(0));for(const t in this.attributes){const i=this.attributes[t];e.attributes[t]=new dp(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=xd.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new mp,i=[],s=[],r=[];let n;for(let t=0;t<e.length;t++){n=e[t];for(let e=0;e<n.buffers.length;e++)s[e]=s[e]||0,s[e]+=n.buffers[e].data.length,r[e]=0}for(let e=0;e<n.buffers.length;e++)i[e]=new(fp[M_(n.buffers[e].data)])(s[e]),t.buffers[e]=new up(i[e]);for(let t=0;t<e.length;t++){n=e[t];for(let e=0;e<n.buffers.length;e++)i[e].set(n.buffers[e].data,r[e]),r[e]+=n.buffers[e].data.length}if(t.attributes=n.attributes,n.indexBuffer){t.indexBuffer=t.buffers[n.buffers.indexOf(n.indexBuffer)],t.indexBuffer.type=xd.ELEMENT_ARRAY_BUFFER;let i=0,s=0,r=0,o=0;for(let e=0;e<n.buffers.length;e++)if(n.buffers[e]!==n.indexBuffer){o=e;break}for(const e in n.attributes){const t=n.attributes[e];(0|t.buffer)===o&&(s+=t.size*pp[t.type]/4)}for(let n=0;n<e.length;n++){const a=e[n].indexBuffer.data;for(let e=0;e<a.length;e++)t.indexBuffer.data[e+r]+=i;i+=e[n].buffers[o].data.length/s,r+=a.length}}return t}}class bp extends mp{constructor(e=!1){super(),this._buffer=new up(null,e,!1),this._indexBuffer=new up(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ud.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ud.FLOAT).addAttribute("aColor",this._buffer,4,!0,ud.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ud.FLOAT).addIndex(this._indexBuffer)}}const vp=2*Math.PI,Tp=180/Math.PI,yp=Math.PI/180;var xp=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(xp||{});class Ap{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new Ap(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}Ap.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Cp=[new Ap,new Ap,new Ap,new Ap];class Sp{constructor(e=0,t=0,i=0,s=0){this.x=Number(e),this.y=Number(t),this.width=Number(i),this.height=Number(s),this.type=xp.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Sp(0,0,0,0)}clone(){return new Sp(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const t=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=t)return!1;const i=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>i}const i=this.left,s=this.right,r=this.top,n=this.bottom;if(s<=i||n<=r)return!1;const o=Cp[0].set(e.left,e.top),a=Cp[1].set(e.left,e.bottom),h=Cp[2].set(e.right,e.top),l=Cp[3].set(e.right,e.bottom);if(h.x<=o.x||a.y<=o.y)return!1;const c=Math.sign(t.a*t.d-t.b*t.c);if(0===c||(t.apply(o,o),t.apply(a,a),t.apply(h,h),t.apply(l,l),Math.max(o.x,a.x,h.x,l.x)<=i||Math.min(o.x,a.x,h.x,l.x)>=s||Math.max(o.y,a.y,h.y,l.y)<=r||Math.min(o.y,a.y,h.y,l.y)>=n))return!1;const u=c*(a.y-o.y),d=c*(o.x-a.x),_=u*i+d*r,p=u*s+d*r,g=u*i+d*n,f=u*s+d*n;if(Math.max(_,p,g,f)<=u*o.x+d*o.y||Math.min(_,p,g,f)>=u*l.x+d*l.y)return!1;const m=c*(o.y-h.y),b=c*(h.x-o.x),v=m*i+b*r,T=m*s+b*r,y=m*i+b*n,x=m*s+b*n;return!(Math.max(v,T,y,x)<=m*o.x+b*o.y||Math.min(v,T,y,x)>=m*l.x+b*l.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}fit(e){const t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),s=Math.max(this.y,e.y),r=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=s,this.height=Math.max(r-s,0),this}ceil(e=1,t=.001){const i=Math.ceil((this.x+this.width-t)*e)/e,s=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=s-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),s=Math.min(this.y,e.y),r=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=s,this.height=r-s,this}}Sp.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Ep{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.radius=i,this.type=xp.CIRC}clone(){return new Ep(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const i=this.radius*this.radius;let s=this.x-e,r=this.y-t;return s*=s,r*=r,s+r<=i}getBounds(){return new Sp(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}Ep.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Rp{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.width=i,this.height=s,this.type=xp.ELIP}clone(){return new Rp(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let i=(e-this.x)/this.width,s=(t-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new Sp(this.x-this.width,this.y-this.height,this.width,this.height)}}Rp.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Pp{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if("number"!=typeof t[0]){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(t[i].x,t[i].y);t=e}this.points=t,this.type=xp.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new Pp(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let i=!1;const s=this.points.length/2;for(let r=0,n=s-1;r<s;n=r++){const s=this.points[2*r],o=this.points[2*r+1],a=this.points[2*n],h=this.points[2*n+1];o>t!=h>t&&e<(t-o)/(h-o)*(a-s)+s&&(i=!i)}return i}}Pp.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((e,t)=>`${e}, ${t}`),"")}]`};class Ip{constructor(e=0,t=0,i=0,s=0,r=20){this.x=e,this.y=t,this.width=i,this.height=s,this.radius=r,this.type=xp.RREC}clone(){return new Ip(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+i&&t<=this.y+this.height-i||e>=this.x+i&&e<=this.x+this.width-i)return!0;let s=e-(this.x+i),r=t-(this.y+i);const n=i*i;if(s*s+r*r<=n||(s=e-(this.x+this.width-i),s*s+r*r<=n)||(r=t-(this.y+this.height-i),s*s+r*r<=n)||(s=e-(this.x+i),s*s+r*r<=n))return!0}return!1}}Ip.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Mp{constructor(e=1,t=0,i=0,s=1,r=0,n=0){this.array=null,this.a=e,this.b=t,this.c=i,this.d=s,this.tx=r,this.ty=n}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,i,s,r,n){return this.a=e,this.b=t,this.c=i,this.d=s,this.tx=r,this.ty=n,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(e,t){t=t||new Ap;const i=e.x,s=e.y;return t.x=this.a*i+this.c*s+this.tx,t.y=this.b*i+this.d*s+this.ty,t}applyInverse(e,t){t=t||new Ap;const i=1/(this.a*this.d+this.c*-this.b),s=e.x,r=e.y;return t.x=this.d*i*s+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*r+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),s=this.a,r=this.c,n=this.tx;return this.a=s*t-this.b*i,this.b=s*i+this.b*t,this.c=r*t-this.d*i,this.d=r*i+this.d*t,this.tx=n*t-this.ty*i,this.ty=n*i+this.ty*t,this}append(e){const t=this.a,i=this.b,s=this.c,r=this.d;return this.a=e.a*t+e.b*s,this.b=e.a*i+e.b*r,this.c=e.c*t+e.d*s,this.d=e.c*i+e.d*r,this.tx=e.tx*t+e.ty*s+this.tx,this.ty=e.tx*i+e.ty*r+this.ty,this}setTransform(e,t,i,s,r,n,o,a,h){return this.a=Math.cos(o+h)*r,this.b=Math.sin(o+h)*r,this.c=-Math.sin(o-a)*n,this.d=Math.cos(o-a)*n,this.tx=e-(i*this.a+s*this.c),this.ty=t-(i*this.b+s*this.d),this}prepend(e){const t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){const t=this.a,i=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,i=this.b,s=this.c,r=this.d,n=e.pivot,o=-Math.atan2(-s,r),a=Math.atan2(i,t),h=Math.abs(o+a);return h<1e-5||Math.abs(vp-h)<1e-5?(e.rotation=a,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=a),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(s*s+r*r),e.position.x=this.tx+(n.x*t+n.y*s),e.position.y=this.ty+(n.x*i+n.y*r),e}invert(){const e=this.a,t=this.b,i=this.c,s=this.d,r=this.tx,n=e*s-t*i;return this.a=s/n,this.b=-t/n,this.c=-i/n,this.d=e/n,this.tx=(i*this.ty-s*r)/n,this.ty=-(e*this.ty-t*r)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new Mp;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new Mp}static get TEMP_MATRIX(){return new Mp}}Mp.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const wp=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Op=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Bp=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Dp=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Fp=[],Lp=[],Np=Math.sign;!function(){for(let e=0;e<16;e++){const t=[];Fp.push(t);for(let i=0;i<16;i++){const s=Np(wp[e]*wp[i]+Bp[e]*Op[i]),r=Np(Op[e]*wp[i]+Dp[e]*Op[i]),n=Np(wp[e]*Bp[i]+Bp[e]*Dp[i]),o=Np(Op[e]*Bp[i]+Dp[e]*Dp[i]);for(let e=0;e<16;e++)if(wp[e]===s&&Op[e]===r&&Bp[e]===n&&Dp[e]===o){t.push(e);break}}}for(let e=0;e<16;e++){const t=new Mp;t.set(wp[e],Op[e],Bp[e],Dp[e],0,0),Lp.push(t)}}();const kp={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>wp[e],uY:e=>Op[e],vX:e=>Bp[e],vY:e=>Dp[e],inv:e=>8&e?15&e:7&-e,add:(e,t)=>Fp[e][t],sub:(e,t)=>Fp[e][kp.inv(t)],rotate180:e=>4^e,isVertical:e=>2==(3&e),byDirection:(e,t)=>2*Math.abs(e)<=Math.abs(t)?t>=0?kp.S:kp.N:2*Math.abs(t)<=Math.abs(e)?e>0?kp.E:kp.W:t>0?e>0?kp.SE:kp.SW:e>0?kp.NE:kp.NW,matrixAppendRotationInv:(e,t,i=0,s=0)=>{const r=Lp[kp.inv(t)];r.tx=i,r.ty=s,e.append(r)}};class Up{constructor(e,t,i=0,s=0){this._x=i,this._y=s,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new Up(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}Up.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Vp=class{constructor(){this.worldTransform=new Mp,this.localTransform=new Mp,this.position=new Up(this.onChange,this,0,0),this.scale=new Up(this.onChange,this,1,1),this.pivot=new Up(this.onChange,this,0,0),this.skew=new Up(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const i=e.worldTransform,s=this.worldTransform;s.a=t.a*i.a+t.b*i.c,s.b=t.a*i.b+t.b*i.d,s.c=t.c*i.a+t.d*i.c,s.d=t.c*i.b+t.d*i.d,s.tx=t.tx*i.a+t.ty*i.c+i.tx,s.ty=t.tx*i.b+t.ty*i.d+i.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};Vp.IDENTITY=new Vp;let Gp=Vp;Gp.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};const zp=[{test:e=>"float"===e.type&&1===e.size&&!e.isArray,code:e=>`\n            if(uv["${e}"] !== ud["${e}"].value)\n            {\n                ud["${e}"].value = uv["${e}"]\n                gl.uniform1f(ud["${e}"].location, uv["${e}"])\n            }\n            `},{test:(e,t)=>!("sampler2D"!==e.type&&"samplerCube"!==e.type&&"sampler2DArray"!==e.type||1!==e.size||e.isArray||null!=t&&void 0===t.castToBaseTexture),code:e=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${e}"], t);\n\n            if(ud["${e}"].value !== t)\n            {\n                ud["${e}"].value = t;\n                gl.uniform1i(ud["${e}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(e,t)=>"mat3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.a,code:e=>`\n            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));\n            `,codeUbo:e=>`\n                var ${e}_matrix = uv.${e}.toArray(true);\n\n                data[offset] = ${e}_matrix[0];\n                data[offset+1] = ${e}_matrix[1];\n                data[offset+2] = ${e}_matrix[2];\n        \n                data[offset + 4] = ${e}_matrix[3];\n                data[offset + 5] = ${e}_matrix[4];\n                data[offset + 6] = ${e}_matrix[5];\n        \n                data[offset + 8] = ${e}_matrix[6];\n                data[offset + 9] = ${e}_matrix[7];\n                data[offset + 10] = ${e}_matrix[8];\n            `},{test:(e,t)=>"vec2"===e.type&&1===e.size&&!e.isArray&&void 0!==t.x,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${e}"].location, v.x, v.y);\n                }`,codeUbo:e=>`\n                v = uv.${e};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:e=>"vec2"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);\n                }\n            `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.width,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(e,t)=>"vec3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:e=>"vec4"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])\n                }`}],Hp={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Wp={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},Xp={};let qp,Qp=Xp;const Kp={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Yp(e){return Kp[e]}let jp=null;const Zp={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function $p(e,t){if(!jp){const t=Object.keys(Zp);jp={};for(let i=0;i<t.length;++i){const s=t[i];jp[e[s]]=Zp[s]}}return jp[t]}function Jp(e,t,i){if("precision"!==e.substring(0,9)){let s=t;return t===vd.HIGH&&i!==vd.HIGH&&(s=vd.MEDIUM),`precision ${s} float;\n${e}`}return i!==vd.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}let eg=0;const tg={},ig=class e{constructor(t,i,s="pixi-shader",r={}){this.extra={},this.id=eg++,this.vertexSrc=t||e.defaultVertexSrc,this.fragmentSrc=i||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,"#version"!==this.vertexSrc.substring(0,8)&&(s=s.replace(/\s+/g,"-"),tg[s]?(tg[s]++,s+=`-${tg[s]}`):tg[s]=1,this.vertexSrc=`#define SHADER_NAME ${s}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${s}\n${this.fragmentSrc}`,this.vertexSrc=Jp(this.vertexSrc,e.defaultVertexPrecision,vd.HIGH),this.fragmentSrc=Jp(this.fragmentSrc,e.defaultFragmentPrecision,function(){if(!qp){qp=vd.MEDIUM;const e=function(){if(Qp===Xp||Qp?.isContextLost()){const e=Ad.ADAPTER.createCanvas();let t;Ad.PREFER_ENV>=rd.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Qp=t}return Qp}();if(e&&e.getShaderPrecisionFormat){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);t&&(qp=t.precision?vd.HIGH:vd.MEDIUM)}}return qp}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,i,s){const r=t+i;let n=V_[r];return n||(V_[r]=n=new e(t,i,s)),n}};ig.defaultVertexPrecision=vd.HIGH,ig.defaultFragmentPrecision=Gd.apple.device?vd.HIGH:vd.MEDIUM;let sg=ig,rg=0;class ng{constructor(e,t,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=rg++,this.static=!!t,this.ubo=!!i,e instanceof up?(this.buffer=e,this.buffer.type=xd.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new up(new Float32Array(1)),this.buffer.type=xd.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new ng(t,i)}static from(e,t,i){return new ng(e,t,i)}static uboFrom(e,t){return new ng(e,t??!0,!0)}}class og{constructor(e,t){this.uniformBindCount=0,this.program=e,this.uniformGroup=t?t instanceof ng?t:new ng(t):new ng({}),this.disposeRunner=new sp("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const i in t.uniforms){const s=t.uniforms[i];if(!0===s.group&&this.checkUniformExists(e,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,i){const s=sg.from(e,t);return new og(s,i)}}class ag{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const t=new Int32Array(e);for(let i=0;i<e;i++)t[i]=i;this.defaultGroupCache[e]=ng.from({uSamplers:t},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${e}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new sg(this.vertexSrc,i)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new Mp,default:this.defaultGroupCache[e]};return new og(this.programCache[e],t)}generateSampleSrc(e){let t="";t+="\n",t+="\n";for(let i=0;i<e;i++)i>0&&(t+="\nelse "),i<e-1&&(t+=`if(vTextureId < ${i}.5)`),t+="\n{",t+=`\n\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`,t+="\n}";return t+="\n",t+="\n",t}}class hg{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}class lg{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}const cg=class e extends lg{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=bp,this.vertexSize=6,this.state=ep.for2d(),this.size=4*e.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(){let e=!0;const t=Ad.ADAPTER.getNavigator();if(Gd.tablet||Gd.phone){if(Gd.apple.device){const i=t.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(e=!1)}if(Gd.android.device){const i=t.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(e=!1)}}return e?32:4}(),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!Gd.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Xd("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=e.defaultVertexSrc,fragment:i=e.defaultFragmentTemplate}={}){this.shaderGenerator=new ag(t,i)}contextChange(){const t=this.renderer.gl;Ad.PREFER_ENV===rd.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),e.defaultMaxTextures),this.maxTextures=function(e,t){if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=t.createShader(t.FRAGMENT_SHADER);for(;;){const s=$_.replace(/%forloop%/gi,J_(e));if(t.shaderSource(i,s),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))break;e=e/2|0}return e}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:i}=e,s=this.size/4,r=Math.floor(s/this.maxTextures)+1;for(;t.length<s;)t.push(new lp);for(;i.length<r;)i.push(new hg);for(let e=0;e<this.maxTextures;e++)this._tempBoundTextures[e]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:i}=this,s=e._textureArrayPool,r=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++hp._globalBatch,h=0,l=s[0],c=0;r.copyBoundTextures(n,i);for(let e=0;e<this._bufferSize;++e){const u=t[e];t[e]=null,u._batchEnabled!==a&&(l.count>=i&&(r.boundArray(l,n,a,i),this.buildDrawCalls(l,c,e),c=e,l=s[++h],++a),u._batchEnabled=a,u.touched=o,l.elements[l.count++]=u)}l.count>0&&(r.boundArray(l,n,a,i),this.buildDrawCalls(l,c,this._bufferSize),++h,++a);for(let e=0;e<n.length;e++)n[e]=null;hp._globalBatch=a}buildDrawCalls(t,i,s){const{_bufferedElements:r,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,h=e._drawCallPool;let l=this._dcIndex,c=this._aIndex,u=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let e=i;e<s;++e){const s=r[e],_=s._texture.baseTexture,p=P_[_.alphaMode?1:0][s.blendMode];r[e]=null,i<e&&d.blend!==p&&(d.size=u-d.start,i=e,d=h[++l],d.texArray=t,d.start=u),this.packInterleavedGeometry(s,n,o,c,u),c+=s.vertexData.length/2*a,u+=s.indices.length,d.blend=p}i<s&&(d.size=u-d.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=u}bindAndClearTexArray(e){const t=this.renderer.texture;for(let i=0;i<e.count;i++)t.bind(e.elements[i],e.ids[i]),e.elements[i]=null;e.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:i,_indexBuffer:s}=this;e.canUploadSameBuffer?(t[this._flushId]._buffer.update(i.rawBinaryData),t[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(i.rawBinaryData),t[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:i,state:s}=this.renderer,r=e._drawCallPool;let n=null;for(let e=0;e<t;e++){const{texArray:t,type:o,size:a,start:h,blend:l}=r[e];n!==t&&(n=t,this.bindAndClearTexArray(t)),this.state.blendMode=l,s.set(this.state),i.drawElements(o,a,i.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),e.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=w_(Math.ceil(e/8)),i=B_(t),s=8*t;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._aBuffers[s];return r||(this._aBuffers[s]=r=new Z_(s*this.vertexSize*4)),r}getIndexBuffer(e){const t=w_(Math.ceil(e/12)),i=B_(t),s=12*t;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._iBuffers[i];return r||(this._iBuffers[i]=r=new Uint16Array(s)),r}packInterleavedGeometry(e,t,i,s,r){const{uint32View:n,float32View:o}=t,a=s/this.vertexSize,h=e.uvs,l=e.indices,c=e.vertexData,u=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),_=R_.shared.setValue(e._tintRGB).toPremultiplied(d,e._texture.baseTexture.alphaMode>0);for(let e=0;e<c.length;e+=2)o[s++]=c[e],o[s++]=c[e+1],o[s++]=h[e],o[s++]=h[e+1],n[s++]=_,o[s++]=u;for(let e=0;e<l.length;e++)i[r++]=a+l[e]}};cg.defaultBatchSize=4096,cg.extension={name:"batch",type:Q_.RendererPlugin},cg._drawCallPool=[],cg._textureArrayPool=[];let ug=cg;j_.add(ug);const dg=class e extends og{constructor(t,i,s){super(sg.from(t||e.defaultVertexSrc,i||e.defaultFragmentSrc),s),this.padding=0,this.resolution=e.defaultResolution,this.multisample=e.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ep}apply(e,t,i,s,r){e.applyFilter(this,t,i,s)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};dg.defaultResolution=1,dg.defaultMultisample=yd.NONE;let _g=dg;class pg{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new R_(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:i,backgroundAlpha:s}=e,r=i??t;void 0!==r&&(this.color=r),this.alpha=s}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}pg.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},pg.extension={type:[Q_.RendererSystem,Q_.CanvasRendererSystem],name:"background"},j_.add(pg);class gg{constructor(e){this.renderer=e,this.emptyRenderer=new lg(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:i}=this.renderer.texture;for(let s=t-1;s>=0;--s)e[s]=i[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,t,i,s){const{elements:r,ids:n,count:o}=e;let a=0;for(let e=0;e<o;e++){const o=r[e],h=o._batchLocation;if(h>=0&&h<s&&t[h]===o)n[e]=h;else for(;a<s;){const s=t[a];if(!s||s._batchEnabled!==i||s._batchLocation!==a){n[e]=a,o._batchLocation=a,t[a]=o;break}a++}}}destroy(){this.renderer=null}}gg.extension={type:Q_.RendererSystem,name:"batch"},j_.add(gg);let fg=0;class mg{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=fg++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,i=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:i,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=fg++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;void 0!==t.addEventListener&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let i;if(Ad.PREFER_ENV>=rd.WEBGL2&&(i=e.getContext("webgl2",t)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};1===this.webGLVersion?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,void 0!==e.removeEventListener&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=i||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}mg.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},mg.extension={type:Q_.RendererSystem,name:"context"},j_.add(mg);class bg{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new sp("disposeFramebuffer"),this.multisample=yd.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new hp(null,{scaleMode:_d.NEAREST,resolution:1,mipmap:gd.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new hp(null,{scaleMode:_d.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:gd.OFF,format:ld.DEPTH_COMPONENT,type:ud.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(e!==this.width||t!==this.height){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const s=this.colorTextures[i],r=s.resolution;s.setSize(e/r,t/r)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(e/i,t/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class vg extends hp{constructor(e={}){"number"==typeof e&&(e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=yd.NONE),super(null,e),this.mipmap=gd.OFF,this.valid=!0,this._clear=new R_([0,0,0,0]),this.framebuffer=new bg(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Tg extends rp{constructor(e){const t=e;super(t.naturalWidth||t.videoWidth||t.displayWidth||t.width,t.naturalHeight||t.videoHeight||t.displayHeight||t.height),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,i){void 0!==i||t.startsWith("data:")?!1!==i&&(e.crossOrigin="string"==typeof i?i:"anonymous"):e.crossOrigin=function(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location;const i=new URL(e,document.baseURI);return i.hostname!==t.hostname||i.port!==t.port||i.protocol!==t.protocol?"anonymous":""}(t)}upload(e,t,i,s){const r=e.gl,n=t.realWidth,o=t.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||0===s.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===fd.UNPACK),this.noSubImage||t.target!==r.TEXTURE_2D||i.width!==n||i.height!==o?(i.width=n,i.height=o,r.texImage2D(t.target,0,i.internalFormat,t.format,i.type,s)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.format,i.type,s),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,i=e.naturalHeight||e.videoHeight||e.height;this.resize(t,i),super.update()}dispose(){this.source=null}}class yg extends Tg{constructor(e,t){if(t=t||{},"string"==typeof e){const i=new Image;Tg.crossOrigin(i,e,t.crossorigin),i.src=e,e=i}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??Ad.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this.bitmap=null,this._load=null,!1!==t.autoLoad&&this.load()}load(e){return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise(((e,t)=>{const i=this.source;this.url=i.src;const s=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};i.complete&&i.src?s():(i.onload=s,i.onerror=e=>{t(e),this.onError.emit(e)})}))),this._load}process(){const e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,i=!e.crossOrigin||"anonymous"===e.crossOrigin;return this._process=fetch(e.src,{mode:i?"cors":"no-cors"}).then((e=>e.blob())).then((i=>t(i,0,0,e.width,e.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===fd.UNPACK?"premultiply":"none"}))).then((e=>this.destroyed?Promise.reject():(this.bitmap=e,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(e,t,i){if("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,i,this.bitmap),!this.preserveBitmap){let e=!0;const s=t._glTextures;for(const r in s){const n=s[r];if(n!==i&&n.dirtyId!==t.dirtyId){e=!1;break}}e&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&("string"==typeof e||e instanceof HTMLImageElement)}}class xg{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,i){const s=t.width,r=t.height;if(i){const t=e.width/2/s,n=e.height/2/r,o=e.x/s+t,a=e.y/r+n;i=kp.add(i,kp.NW),this.x0=o+t*kp.uX(i),this.y0=a+n*kp.uY(i),i=kp.add(i,2),this.x1=o+t*kp.uX(i),this.y1=a+n*kp.uY(i),i=kp.add(i,2),this.x2=o+t*kp.uX(i),this.y2=a+n*kp.uY(i),i=kp.add(i,2),this.x3=o+t*kp.uX(i),this.y3=a+n*kp.uY(i)}else this.x0=e.x/s,this.y0=e.y/r,this.x1=(e.x+e.width)/s,this.y1=e.y/r,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/r,this.x3=e.x/s,this.y3=(e.y+e.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}xg.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Ag=new xg;function Cg(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class Sg extends zd{constructor(e,t,i,s,r,n,o){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new Sp(0,0,1,1)),e instanceof Sg&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=Ag,this.uvMatrix=null,this.orig=i||t,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new Ap(n.x,n.y):new Ap(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:e}=this.baseTexture;e?.url&&G_[e.url]&&Sg.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Sg.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),i=new Sg(this.baseTexture,!this.noFrame&&e,t,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=e),i}updateUvs(){this._uvs===Ag&&(this._uvs=new xg),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},i=Ad.STRICT_TEXTURE_CACHE){const s="string"==typeof e;let r=null;if(s)r=e;else if(e instanceof hp){if(!e.cacheId){const i=t?.pixiIdPrefix||"pixiid";e.cacheId=`${i}-${N_()}`,hp.addToCache(e,e.cacheId)}r=e.cacheId}else{if(!e._pixiId){const i=t?.pixiIdPrefix||"pixiid";e._pixiId=`${i}_${N_()}`}r=e._pixiId}let n=G_[r];if(s&&i&&!n)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return n||e instanceof hp?!n&&e instanceof hp&&(n=new Sg(e),Sg.addToCache(n,r)):(t.resolution||(t.resolution=q_(e)),n=new Sg(new hp(e,t)),n.baseTexture.cacheId=r,hp.addToCache(n.baseTexture,r),Sg.addToCache(n,r)),n}static fromURL(e,t){const i=Object.assign({autoLoad:!1},t?.resourceOptions),s=Sg.from(e,Object.assign({resourceOptions:i},t),!1),r=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):r.load().then((()=>Promise.resolve(s)))}static fromBuffer(e,t,i,s){return new Sg(hp.fromBuffer(e,t,i,s))}static fromLoader(e,t,i,s){const r=new hp(e,Object.assign({scaleMode:hp.defaultOptions.scaleMode,resolution:q_(t)},s)),{resource:n}=r;n instanceof yg&&(n.url=t);const o=new Sg(r);return i||(i=t),hp.addToCache(o.baseTexture,i),Sg.addToCache(o,i),i!==t&&(hp.addToCache(o.baseTexture,t),Sg.addToCache(o,t)),o.baseTexture.valid?Promise.resolve(o):new Promise((e=>{o.baseTexture.once("loaded",(()=>e(o)))}))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),G_[t]&&G_[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),G_[t]=e)}static removeFromCache(e){if("string"==typeof e){const t=G_[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete G_[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)G_[e.textureCacheIds[t]]===e&&delete G_[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:i,width:s,height:r}=e,n=t+s>this.baseTexture.width,o=i+r>this.baseTexture.height;if(n||o){const e=n&&o?"and":"or",a=`X: ${t} + ${s} = ${t+s} > ${this.baseTexture.width}`,h=`Y: ${i} + ${r} = ${i+r} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${e} ${h}`)}this.valid=s&&r&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Sg._EMPTY||(Sg._EMPTY=new Sg(new hp),Cg(Sg._EMPTY),Cg(Sg._EMPTY.baseTexture)),Sg._EMPTY}static get WHITE(){if(!Sg._WHITE){const e=Ad.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),Sg._WHITE=new Sg(hp.from(e)),Cg(Sg._WHITE),Cg(Sg._WHITE.baseTexture)}return Sg._WHITE}}class Eg extends Sg{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,i=!0){const s=this.baseTexture.resolution,r=Math.round(e*s)/s,n=Math.round(t*s)/s;this.valid=r>0&&n>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=n,i&&this.baseTexture.resize(r,n),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new Eg(new vg(e))}}class Rg{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,i=yd.NONE){const s=new vg(Object.assign({width:e,height:t,resolution:1,multisample:i},this.textureOptions));return new Eg(s)}getOptimalTexture(e,t,i=1,s=yd.NONE){let r;e=Math.max(Math.ceil(e*i-1e-6),1),t=Math.max(Math.ceil(t*i-1e-6),1),this.enableFullScreen&&e===this._pixelsWidth&&t===this._pixelsHeight?r=s>1?-s:-1:(r=((65535&(e=w_(e)))<<16|65535&(t=w_(t)))>>>0,s>1&&(r+=4294967296*s)),this.texturePool[r]||(this.texturePool[r]=[]);let n=this.texturePool[r].pop();return n||(n=this.createTexture(e,t,s)),n.filterPoolKey=r,n.setResolution(i),n}getFilterTexture(e,t,i){const s=this.getOptimalTexture(e.width,e.height,t||e.resolution,i||yd.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}Rg.SCREEN_KEY=-1;class Pg extends mp{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Ig extends mp{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new up(this.vertices),this.uvBuffer=new up(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+t.width/e.width,this.uvs[3]=s,this.uvs[4]=i+t.width/e.width,this.uvs[5]=s+t.height/e.height,this.uvs[6]=i,this.uvs[7]=s+t.height/e.height,i=t.x,s=t.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+t.width,this.vertices[3]=s,this.vertices[4]=i+t.width,this.vertices[5]=s+t.height,this.vertices[6]=i,this.vertices[7]=s+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Mg{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=yd.NONE,this.sourceFrame=new Sp,this.destinationFrame=new Sp,this.bindingSourceFrame=new Sp,this.bindingDestinationFrame=new Sp,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const wg=[new Ap,new Ap,new Ap,new Ap],Og=new Mp;class Bg{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Rg,this.statePool=[],this.quad=new Pg,this.quadUv=new Ig,this.tempRect=new Sp,this.activeState={},this.globalUniforms=new ng({outputFrame:new Sp,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const i=this.renderer,s=this.defaultFilterStack,r=this.statePool.pop()||new Mg,n=i.renderTexture;let o,a;if(n.current){const e=n.current;o=e.resolution,a=e.multisample}else o=i.resolution,a=i.multisample;let h=t[0].resolution||o,l=t[0].multisample??a,c=t[0].padding,u=t[0].autoFit,d=t[0].legacy??!0;for(let e=1;e<t.length;e++){const i=t[e];h=Math.min(h,i.resolution||o),l=Math.min(l,i.multisample??a),c=this.useMaxPadding?Math.max(c,i.padding):c+i.padding,u=u&&i.autoFit,d=d||(i.legacy??!0)}1===s.length&&(this.defaultFilterStack[0].renderTexture=n.current),s.push(r),r.resolution=h,r.multisample=l,r.legacy=d,r.target=e,r.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),r.sourceFrame.pad(c);const _=this.tempRect.copyFrom(n.sourceFrame);i.projection.transform&&this.transformAABB(Og.copyFrom(i.projection.transform).invert(),_),u?(r.sourceFrame.fit(_),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(_)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,h,l),r.filters=t,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const p=this.tempRect;p.x=0,p.y=0,p.width=r.sourceFrame.width,p.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(n.sourceFrame),r.bindingDestinationFrame.copyFrom(n.destinationFrame),r.transform=i.projection.transform,i.projection.transform=null,n.bind(r.renderTexture,r.sourceFrame,p),i.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),i=t.filters;this.activeState=t;const s=this.globalUniforms.uniforms;s.outputFrame=t.sourceFrame,s.resolution=t.resolution;const r=s.inputSize,n=s.inputPixel,o=s.inputClamp;if(r[0]=t.destinationFrame.width,r[1]=t.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],n[0]=Math.round(r[0]*t.resolution),n[1]=Math.round(r[1]*t.resolution),n[2]=1/n[0],n[3]=1/n[1],o[0]=.5*n[2],o[1]=.5*n[3],o[2]=t.sourceFrame.width*r[2]-.5*n[2],o[3]=t.sourceFrame.height*r[3]-.5*n[3],t.legacy){const e=s.filterArea;e[0]=t.destinationFrame.width,e[1]=t.destinationFrame.height,e[2]=t.sourceFrame.x,e[3]=t.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const a=e[e.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,t.renderTexture,a.renderTexture,md.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let e=t.renderTexture,s=this.getOptimalFilterTexture(e.width,e.height,t.resolution);s.filterFrame=e.filterFrame;let r=0;for(r=0;r<i.length-1;++r){1===r&&t.multisample>1&&(s=this.getOptimalFilterTexture(e.width,e.height,t.resolution),s.filterFrame=e.filterFrame),i[r].apply(this,e,s,md.CLEAR,t);const n=e;e=s,s=n}i[r].apply(this,e,a.renderTexture,md.BLEND,t),r>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(e),this.returnFilterTexture(s)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=md.CLEAR){const{renderTexture:i,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){const t=this.tempRect;t.x=0,t.y=0,t.width=e.filterFrame.width,t.height=e.filterFrame.height,i.bind(e,e.filterFrame,t)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const r=1&s.stateId||this.forceClear;(t===md.CLEAR||t===md.BLIT&&r)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,i,s){const r=this.renderer;r.state.set(e.state),this.bindAndClear(i,s),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(hd.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(hd.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:r}=t._texture,n=e.set(s.width,0,0,s.height,i.x,i.y),o=t.worldTransform.copyTo(Mp.TEMP_MATRIX);return o.invert(),n.prepend(o),n.scale(1/r.width,1/r.height),n.translate(t.anchor.x,t.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,i=1,s=yd.NONE){return this.texturePool.getOptimalTexture(e,t,i,s)}getFilterTexture(e,t,i){if("number"==typeof e){const i=e;e=t,t=i}e=e||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,i||yd.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const i=wg[0],s=wg[1],r=wg[2],n=wg[3];i.set(t.left,t.top),s.set(t.left,t.bottom),r.set(t.right,t.top),n.set(t.right,t.bottom),e.apply(i,i),e.apply(s,s),e.apply(r,r),e.apply(n,n);const o=Math.min(i.x,s.x,r.x,n.x),a=Math.min(i.y,s.y,r.y,n.y),h=Math.max(i.x,s.x,r.x,n.x),l=Math.max(i.y,s.y,r.y,n.y);t.x=o,t.y=a,t.width=h-o,t.height=l-a}roundFrame(e,t,i,s,r){if(!(e.width<=0||e.height<=0||i.width<=0||i.height<=0)){if(r){const{a:e,b:t,c:i,d:s}=r;if((Math.abs(t)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4))return}(r=r?Og.copyFrom(r):Og.identity()).translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(r,e),e.ceil(t),this.transformAABB(r.invert(),e)}}}Bg.extension={type:Q_.RendererSystem,name:"filter"},j_.add(Bg);class Dg{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=yd.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Fg=new Sp;class Lg{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new bg(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Sp,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let t=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Ad.PREFER_ENV===rd.WEBGL_LEGACY&&(t=null,i=null),t?e.drawBuffers=e=>t.drawBuffersWEBGL(e):(this.hasMRT=!1,e.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,i=0){const{gl:s}=this;if(e){const r=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==i&&(e.dirtyId++,e.dirtyFormat++,r.mipLevel=i),r.dirtyId!==e.dirtyId&&(r.dirtyId=e.dirtyId,r.dirtyFormat!==e.dirtyFormat?(r.dirtyFormat=e.dirtyFormat,r.dirtySize=e.dirtySize,this.updateFramebuffer(e,i)):r.dirtySize!==e.dirtySize&&(r.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let t=0;t<e.colorTextures.length;t++){const i=e.colorTextures[t];this.renderer.texture.unbind(i.parentTextureArray||i)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const e=t.width>>i,s=t.height>>i,r=e/t.width;this.setViewport(t.x*r,t.y*r,e,s)}else{const t=e.width>>i,s=e.height>>i;this.setViewport(0,0,t,s)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,i,s){const r=this.viewport;e=Math.round(e),t=Math.round(t),i=Math.round(i),s=Math.round(s),(r.width!==i||r.height!==s||r.x!==e||r.y!==t)&&(r.x=e,r.y=t,r.width=i,r.height=s,this.gl.viewport(e,t,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,i,s,r=od.COLOR|od.DEPTH){const{gl:n}=this;n.clearColor(e,t,i,s),n.clear(r)}initFramebuffer(e){const{gl:t}=this,i=new Dg(t.createFramebuffer());return i.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(e),e.disposeRunner.add(this),i}resizeFramebuffer(e){const{gl:t}=this,i=e.glFramebuffers[this.CONTEXT_UID];if(i.stencil){let s;t.bindRenderbuffer(t.RENDERBUFFER,i.stencil),s=1===this.renderer.context.webGLVersion?t.DEPTH_STENCIL:e.depth&&e.stencil?t.DEPTH24_STENCIL8:e.depth?t.DEPTH_COMPONENT24:t.STENCIL_INDEX8,i.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,s,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,s,e.width,e.height)}const s=e.colorTextures;let r=s.length;t.drawBuffers||(r=Math.min(r,1));for(let n=0;n<r;n++){const r=s[n],o=r.parentTextureArray||r;this.renderer.texture.bind(o,0),0===n&&i.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,i.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:i}=this,s=e.glFramebuffers[this.CONTEXT_UID],r=e.colorTextures;let n=r.length;i.drawBuffers||(n=Math.min(n,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const o=[];for(let a=0;a<n;a++){const n=r[a],h=n.parentTextureArray||n;this.renderer.texture.bind(h,0),0===a&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,n.target,h._glTextures[this.CONTEXT_UID].texture,t),o.push(i.COLOR_ATTACHMENT0+a))}if(o.length>1&&i.drawBuffers(o),e.depthTexture&&this.writeDepthTexture){const s=e.depthTexture;this.renderer.texture.bind(s,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,t)}if(!e.stencil&&!e.depth||e.depthTexture&&this.writeDepthTexture)s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null);else{let t,r;s.stencil=s.stencil||i.createRenderbuffer(),1===this.renderer.context.webGLVersion?(t=i.DEPTH_STENCIL_ATTACHMENT,r=i.DEPTH_STENCIL):e.depth&&e.stencil?(t=i.DEPTH_STENCIL_ATTACHMENT,r=i.DEPTH24_STENCIL8):e.depth?(t=i.DEPTH_ATTACHMENT,r=i.DEPTH_COMPONENT24):(t=i.STENCIL_ATTACHMENT,r=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,r,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,r,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,s.stencil)}}canMultisampleFramebuffer(e){return 1!==this.renderer.context.webGLVersion&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let i=yd.NONE;if(e<=1||null===t)return i;for(let s=0;s<t.length;s++)if(t[s]<=e){i=t[s];break}return 1===i&&(i=yd.NONE),i}blit(e,t,i){const{current:s,renderer:r,gl:n,CONTEXT_UID:o}=this;if(2!==r.context.webGLVersion||!s)return;const a=s.glFramebuffers[o];if(!a)return;if(!e){if(!a.msaaBuffer)return;const t=s.colorTextures[0];if(!t)return;a.blitFramebuffer||(a.blitFramebuffer=new bg(s.width,s.height),a.blitFramebuffer.addColorTexture(0,t)),(e=a.blitFramebuffer).colorTextures[0]!==t&&(e.colorTextures[0]=t,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}t||((t=Fg).width=s.width,t.height=s.height),i||(i=t);const h=t.width===i.width&&t.height===i.height;this.bind(e),n.bindFramebuffer(n.READ_FRAMEBUFFER,a.framebuffer),n.blitFramebuffer(t.left,t.top,t.right,t.bottom,i.left,i.top,i.right,i.bottom,n.COLOR_BUFFER_BIT,h?n.NEAREST:n.LINEAR),n.bindFramebuffer(n.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const i=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete e.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(e);r>=0&&this.managedFramebuffers.splice(r,1),e.disposeRunner.remove(this),t||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<t.length;i++)this.disposeFramebuffer(t[i],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const i=e.width,s=e.height,r=this.gl,n=t.stencil=r.createRenderbuffer();let o,a;r.bindRenderbuffer(r.RENDERBUFFER,n),1===this.renderer.context.webGLVersion?(o=r.DEPTH_STENCIL_ATTACHMENT,a=r.DEPTH_STENCIL):e.depth?(o=r.DEPTH_STENCIL_ATTACHMENT,a=r.DEPTH24_STENCIL8):(o=r.STENCIL_ATTACHMENT,a=r.STENCIL_INDEX8),t.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,t.multisample,a,i,s):r.renderbufferStorage(r.RENDERBUFFER,a,i,s),r.framebufferRenderbuffer(r.FRAMEBUFFER,o,r.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Sp}destroy(){this.renderer=null}}Lg.extension={type:Q_.RendererSystem,name:"framebuffer"},j_.add(Lg);const Ng={5126:4,5123:2,5121:1};class kg{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==t.webGLVersion){let t=this.renderer.context.extensions.vertexArrayObject;Ad.PREFER_ENV===rd.WEBGL_LEGACY&&(t=null),t?(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=e=>t.bindVertexArrayOES(e),e.deleteVertexArray=e=>t.deleteVertexArrayOES(e)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==t.webGLVersion){const t=e.getExtension("ANGLE_instanced_arrays");t?(e.vertexAttribDivisor=(e,i)=>t.vertexAttribDivisorANGLE(e,i),e.drawElementsInstanced=(e,i,s,r,n)=>t.drawElementsInstancedANGLE(e,i,s,r,n),e.drawArraysInstanced=(e,i,s,r)=>t.drawArraysInstancedANGLE(e,i,s,r)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===t.webGLVersion||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:i}=this;let s=e.glVertexArrayObjects[this.CONTEXT_UID],r=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},r=!0);const n=s[t.program.id]||this.initGeometryVao(e,t,r);this._activeGeometry=e,this._activeVao!==n&&(this._activeVao=n,this.hasVao?i.bindVertexArray(n):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let i=0;i<e.buffers.length;i++){const s=e.buffers[i];t.update(s)}}checkCompatibility(e,t){const i=e.attributes,s=t.attributeData;for(const e in s)if(!i[e])throw new Error(`shader and geometry incompatible, geometry missing the "${e}" attribute`)}getSignature(e,t){const i=e.attributes,s=t.attributeData,r=["g",e.id];for(const e in i)s[e]&&r.push(e,s[e].location);return r.join("-")}initGeometryVao(e,t,i=!0){const s=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,o=t.program;o.glPrograms[r]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,o);const a=this.getSignature(e,o),h=e.glVertexArrayObjects[this.CONTEXT_UID];let l=h[a];if(l)return h[o.id]=l,l;const c=e.buffers,u=e.attributes,d={},_={};for(const e in c)d[e]=0,_[e]=0;for(const e in u)!u[e].size&&o.attributeData[e]?u[e].size=o.attributeData[e].size:u[e].size||console.warn(`PIXI Geometry attribute '${e}' size cannot be determined (likely the bound shader does not have the attribute)`),d[u[e].buffer]+=u[e].size*Ng[u[e].type];for(const e in u){const t=u[e],i=t.size;void 0===t.stride&&(d[t.buffer]===i*Ng[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=_[t.buffer],_[t.buffer]+=i*Ng[t.type])}l=s.createVertexArray(),s.bindVertexArray(l);for(let e=0;e<c.length;e++){const t=c[e];n.bind(t),i&&t._glBuffers[r].refCount++}return this.activateVao(e,o),h[o.id]=l,h[a]=l,s.bindVertexArray(null),n.unbind(xd.ARRAY_BUFFER),l}disposeGeometry(e,t){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const i=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,r=e.buffers,n=this.renderer?.buffer;if(e.disposeRunner.remove(this),i){if(n)for(let e=0;e<r.length;e++){const i=r[e]._glBuffers[this.CONTEXT_UID];i&&(i.refCount--,0===i.refCount&&!t&&n.dispose(r[e],t))}if(!t)for(const e in i)if("g"===e[0]){const t=i[e];this._activeVao===t&&this.unbind(),s.deleteVertexArray(t)}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let i=0;i<t.length;i++)this.disposeGeometry(this.managedGeometries[t[i]],e)}activateVao(e,t){const i=this.gl,s=this.CONTEXT_UID,r=this.renderer.buffer,n=e.buffers,o=e.attributes;e.indexBuffer&&r.bind(e.indexBuffer);let a=null;for(const e in o){const h=o[e],l=n[h.buffer],c=l._glBuffers[s];if(t.attributeData[e]){a!==c&&(r.bind(l),a=c);const s=t.attributeData[e].location;if(i.enableVertexAttribArray(s),i.vertexAttribPointer(s,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(s,h.divisor)}}}}draw(e,t,i,s){const{gl:r}=this,n=this._activeGeometry;if(n.indexBuffer){const o=n.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?n.instanced?r.drawElementsInstanced(e,t||n.indexBuffer.data.length,a,(i||0)*o,s||1):r.drawElements(e,t||n.indexBuffer.data.length,a,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else n.instanced?r.drawArraysInstanced(e,i,t||n.getSize(),s||1):r.drawArrays(e,i,t||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}kg.extension={type:Q_.RendererSystem,name:"geometry"},j_.add(kg);const Ug=new Mp;class Vg{constructor(e,t){this._texture=e,this.mapCoord=new Mp,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){void 0===t&&(t=e);const i=this.mapCoord;for(let s=0;s<e.length;s+=2){const r=e[s],n=e[s+1];t[s]=r*i.a+n*i.c+i.tx,t[s+1]=r*i.b+n*i.d+i.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const i=t._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const s=t.orig,r=t.trim;r&&(Ug.set(s.width/r.width,0,0,s.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Ug));const n=t.baseTexture,o=this.uClampFrame,a=this.clampMargin/n.resolution,h=this.clampOffset;return o[0]=(t._frame.x+a+h)/n.width,o[1]=(t._frame.y+a+h)/n.height,o[2]=(t._frame.x+t._frame.width-a+h)/n.width,o[3]=(t._frame.y+t._frame.height-a+h)/n.height,this.uClampOffset[0]=h/n.realWidth,this.uClampOffset[1]=h/n.realHeight,this.isSimple=t._frame.width===n.width&&t._frame.height===n.height&&0===t.rotate,!0}}class Gg extends _g{constructor(e,t,i){let s=null;"string"!=typeof e&&void 0===t&&void 0===i&&(s=e,e=void 0,t=void 0,i=void 0),super(e||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",t||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i),this.maskSprite=s,this.maskMatrix=new Mp}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,i,s){const r=this._maskSprite,n=r._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new Vg(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,r).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,e.applyFilter(this,t,i,s))}}class zg{constructor(e=null){this.type=Td.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=_g.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Td.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Hg{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let i=t;if(!i.isMaskData){const e=this.maskDataPool.pop()||new zg;e.pooled=!0,e.maskObject=t,i=e}const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=e,i.type!==Td.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Td.SCISSOR:this.renderer.scissor.push(i);break;case Td.STENCIL:this.renderer.stencil.push(i);break;case Td.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Td.COLOR:this.pushColorMask(i)}i.type===Td.SPRITE&&this.maskStack.push(i)}pop(e){const t=this.maskStack.pop();if(t&&t._target===e){if(t.enabled)switch(t.type){case Td.SCISSOR:this.renderer.scissor.pop(t);break;case Td.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case Td.SPRITE:this.popSpriteMask(t);break;case Td.COLOR:this.popColorMask(t)}if(t.reset(),t.pooled&&this.maskDataPool.push(t),0!==this.maskStack.length){const e=this.maskStack[this.maskStack.length-1];e.type===Td.SPRITE&&e._filters&&(e._filters[0].maskSprite=e.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=Td.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=Td.SCISSOR:e.type=Td.STENCIL:e.type=Td.COLOR}pushSpriteMask(e){const{maskObject:t}=e,i=e._target;let s=e._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Gg])),s[0].resolution=e.resolution,s[0].multisample=e.multisample,s[0].maskSprite=t;const r=i.filterArea;i.filterArea=t.getBounds(!0),this.renderer.filter.push(i,s),i.filterArea=r,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,i=e._colorMask=t&e.colorMask;i!==t&&this.renderer.gl.colorMask(!!(1&i),!!(2&i),!!(4&i),!!(8&i))}popColorMask(e){const t=e._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==t&&this.renderer.gl.colorMask(!!(1&i),!!(2&i),!!(4&i),!!(8&i))}destroy(){this.renderer=null}}Hg.extension={type:Q_.RendererSystem,name:"mask"},j_.add(Hg);class Wg{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,i=this.getStackLength();this.maskStack=e;const s=this.getStackLength();s!==i&&(0===s?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Xg=new Mp,qg=[],Qg=class e extends Wg{constructor(e){super(e),this.glConst=Ad.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:i}=e,{renderer:s}=this,r=s.renderTexture,n=i.getBounds(!0,qg.pop()??new Sp);this.roundFrameToPixels(n,r.current?r.current.resolution:s.resolution,r.sourceFrame,r.destinationFrame,s.projection.transform),t&&n.fit(t),e._scissorRectLocal=n}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:i,c:s,d:r}=e;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4)}testScissor(t){const{maskObject:i}=t;if(!i.isFastRect||!i.isFastRect()||e.isMatrixRotated(i.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const s=t._scissorRectLocal;return s.width>0&&s.height>0}roundFrameToPixels(t,i,s,r,n){e.isMatrixRotated(n)||((n=n?Xg.copyFrom(n):Xg.identity()).translate(-s.x,-s.y).scale(r.width/s.width,r.height/s.height).translate(r.x,r.y),this.renderer.filter.transformAABB(n,t),t.fit(r),t.x=Math.round(t.x*i),t.y=Math.round(t.y*i),t.width=Math.round(t.width*i),t.height=Math.round(t.height*i))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&qg.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;t=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};Qg.extension={type:Q_.RendererSystem,name:"scissor"};let Kg=Qg;j_.add(Kg);class Yg extends Wg{constructor(e){super(e),this.glConst=Ad.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:i}=this.renderer,s=e._stencilCounter;0===s&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),e._stencilCounter++;const r=e._colorMask;0!==r&&(e._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==r&&(e._colorMask=r,i.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))),this._useCurrent()}pop(e){const t=this.renderer.gl;if(0===this.getStackLength())t.disable(t.STENCIL_TEST);else{const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;0!==s&&(i._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==s&&(i._colorMask=s,t.colorMask(!!(1&s),!!(2&s),!!(4&s),!!(8&s))),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}Yg.extension={type:Q_.RendererSystem,name:"stencil"},j_.add(Yg);class jg{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(Xd("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract)},prepare:{enumerable:!1,get:()=>(Xd("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare)},interaction:{enumerable:!1,get:()=>(Xd("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events)}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}jg.extension={type:[Q_.RendererSystem,Q_.CanvasRendererSystem],name:"_plugin"},j_.add(jg);class Zg{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Mp,this.transform=null}update(e,t,i,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(e,t,i,s){const r=this.projectionMatrix,n=s?-1:1;r.identity(),r.a=1/t.width*2,r.d=n*(1/t.height*2),r.tx=-1-t.x*r.a,r.ty=-n-t.y*r.d}setTransform(e){}destroy(){this.renderer=null}}Zg.extension={type:Q_.RendererSystem,name:"projection"},j_.add(Zg);const $g=new Gp,Jg=new Sp;class ef{constructor(e){this.renderer=e,this._tempMatrix=new Mp}generateTexture(e,t){const{region:i,...s}=t||{},r=i?.copyTo(Jg)||e.getLocalBounds(Jg,!0),n=s.resolution||this.renderer.resolution;r.width=Math.max(r.width,1/n),r.height=Math.max(r.height,1/n),s.width=r.width,s.height=r.height,s.resolution=n,s.multisample??(s.multisample=this.renderer.multisample);const o=Eg.create(s);this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const a=e.transform;return e.transform=$g,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=a,o}destroy(){}}ef.extension={type:[Q_.RendererSystem,Q_.CanvasRendererSystem],name:"textureGenerator"},j_.add(ef);const tf=new Sp,sf=new Sp;class rf{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Sp,this.destinationFrame=new Sp,this.viewportFrame=new Sp}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,i){const s=this.renderer;let r,n,o;this.current=e,e?(r=e.baseTexture,o=r.resolution,t||(tf.width=e.frame.width,tf.height=e.frame.height,t=tf),i||(sf.x=e.frame.x,sf.y=e.frame.y,sf.width=t.width,sf.height=t.height,i=sf),n=r.framebuffer):(o=s.resolution,t||(tf.width=s._view.screen.width,tf.height=s._view.screen.height,t=tf),i||((i=tf).width=t.width,i.height=t.height));const a=this.viewportFrame;a.x=i.x*o,a.y=i.y*o,a.width=i.width*o,a.height=i.height*o,e||(a.y=s.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(n,a),this.renderer.projection.update(i,t,o,!n),e?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(i)}clear(e,t){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=R_.shared.setValue(e||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const r=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,o=r.width!==n.width||r.height!==n.height;if(o){let{x:e,y:t,width:i,height:s}=this.viewportFrame;e=Math.round(e),t=Math.round(t),i=Math.round(i),s=Math.round(s),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(e,t,i,s)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,t),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}rf.extension={type:Q_.RendererSystem,name:"renderTexture"},j_.add(rf);class nf{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function of(e,t,i){const s=e.createShader(t);return e.shaderSource(s,i),e.compileShader(s),s}function af(e){const t=new Array(e);for(let e=0;e<t.length;e++)t[e]=!1;return t}function hf(e,t){switch(e){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return af(2*t);case"bvec3":return af(3*t);case"bvec4":return af(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function lf(e,t){const i=e.getShaderSource(t).split("\n").map(((e,t)=>`${t}: ${e}`)),s=e.getShaderInfoLog(t),r=s.split("\n"),n={},o=r.map((e=>parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((e=>!(!e||n[e]||(n[e]=!0,0)))),a=[""];o.forEach((e=>{i[e-1]=`%c${i[e-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=i.join("\n");a[0]=h,console.error(s),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function cf(e,t,i,s,r){i.buffer.update(r)}const uf={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},df={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let _f,pf=0;const gf={textureCount:0,uboCount:0};class ff{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=pf++}systemCheck(){if(!function(){if("boolean"==typeof _f)return _f;try{_f=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{_f=!1}return _f}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const i=e.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),t||(gf.textureCount=0,gf.uboCount=0,this.syncUniformGroup(e.uniformGroup,gf)),s}setUniforms(e){const t=this.shader.program,i=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(i.uniformData,e,this.renderer)}syncUniformGroup(e,t){const i=this.getGlProgram();(!e.static||e.dirtyId!==i.uniformDirtyGroups[e.id])&&(i.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,i,t))}syncUniforms(e,t,i){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,i)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=function(e,t){const i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const s in e.uniforms){const r=t[s];if(!r){!0===e.uniforms[s]?.group&&(e.uniforms[s].ubo?i.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');\n                    `):i.push(`\n                        renderer.shader.syncUniformGroup(uv.${s}, syncData);\n                    `));continue}const n=e.uniforms[s];let o=!1;for(let e=0;e<zp.length;e++)if(zp[e].test(r,n)){i.push(zp[e].code(s,n)),o=!0;break}if(!o){const e=(1!==r.size||r.isArray?Wp:Hp)[r.type].replace("location",`ud["${s}"].location`);i.push(`\n            cu = ud["${s}"];\n            cv = cu.value;\n            v = uv["${s}"];\n            ${e};`)}}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const i=this.getGlProgram();if(!e.static||0!==e.dirtyId||!i.uniformGroups[e.id]){e.dirtyId=0;const s=i.uniformGroups[e.id]||this.createSyncBufferGroup(e,i,t);e.buffer.update(),s(i.uniformData,e.uniforms,this.renderer,gf,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,i.uniformBufferBindings[t])}createSyncBufferGroup(e,t,i){const{gl:s}=this.renderer;this.renderer.buffer.bind(e.buffer);const r=this.gl.getUniformBlockIndex(t.program,i);t.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(t.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const n=this.getSignature(e,this.shader.program.uniformData,"ubo");let o=this._uboCache[n];if(o||(o=this._uboCache[n]=function(e,t){if(!e.autoManage)return{size:0,syncFunc:cf};const i=function(e,t){const i=[];for(const s in e)t[s]&&i.push(t[s]);return i.sort(((e,t)=>e.index-t.index)),i}(e.uniforms,t),{uboElements:s,size:r}=function(e){const t=e.map((e=>({data:e,offset:0,dataLen:0,dirty:0})));let i=0,s=0,r=0;for(let e=0;e<t.length;e++){const n=t[e];if(i=df[n.data.type],n.data.size>1&&(i=Math.max(i,16)*n.data.size),n.dataLen=i,s%i!=0&&s<16){const e=s%i%16;s+=e,r+=e}s+i>16?(r=16*Math.ceil(r/16),n.offset=r,r+=i,s=i):(n.offset=r,s+=i,r+=i)}return r=16*Math.ceil(r/16),{uboElements:t,size:r}}(i),n=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let t=0;t<s.length;t++){const i=s[t],r=e.uniforms[i.data.name],o=i.data.name;let a=!1;for(let e=0;e<zp.length;e++){const t=zp[e];if(t.codeUbo&&t.test(i.data,r)){n.push(`offset = ${i.offset/4};`,zp[e].codeUbo(i.data.name,r)),a=!0;break}}if(!a)if(i.data.size>1){const e=Yp(i.data.type),t=Math.max(df[i.data.type]/16,1),s=e/t,r=(4-s%4)%4;n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${i.data.size*t}; i++)\n                {\n                    for(var j = 0; j < ${s}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${r};\n                }\n\n                `)}else{const e=uf[i.data.type];n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n                ${e};\n                `)}}return n.push("\n       renderer.buffer.update(buffer);\n    "),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join("\n"))}}(e,this.shader.program.uniformData)),e.autoManage){const t=new Float32Array(o.size/4);e.buffer.update(t)}return t.uniformGroups[e.id]=o.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,i){const s=e.uniforms,r=[`${i}-`];for(const e in s)r.push(e),t[e]&&r.push(t[e].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,i=e.program,s=function(e,t){const i=of(e,e.VERTEX_SHADER,t.vertexSrc),s=of(e,e.FRAGMENT_SHADER,t.fragmentSrc),r=e.createProgram();e.attachShader(r,i),e.attachShader(r,s);const n=t.extra?.transformFeedbackVaryings;if(n&&("function"!=typeof e.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(r,n.names,"separate"===n.bufferMode?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||function(e,t,i,s){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(i,e.COMPILE_STATUS)||lf(e,i),e.getShaderParameter(s,e.COMPILE_STATUS)||lf(e,s),console.error("PixiJS Error: Could not initialize shader."),""!==e.getProgramInfoLog(t)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}(e,r,i,s),t.attributeData=function(e,t){const i={},s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const s=t.getActiveAttrib(e,r);if(s.name.startsWith("gl_"))continue;const n=$p(t,s.type),o={type:n,name:s.name,size:Yp(n),location:t.getAttribLocation(e,s.name)};i[s.name]=o}return i}(r,e),t.uniformData=function(e,t){const i={},s=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<s;r++){const s=t.getActiveUniform(e,r),n=s.name.replace(/\[.*?\]$/,""),o=!!s.name.match(/\[.*?\]$/),a=$p(t,s.type);i[n]={name:n,index:r,type:a,size:s.size,isArray:o,value:hf(a,s.size)}}return i}(r,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const i=Object.keys(t.attributeData);i.sort(((e,t)=>e>t?1:-1));for(let s=0;s<i.length;s++)t.attributeData[i[s]].location=s,e.bindAttribLocation(r,s,i[s]);e.linkProgram(r)}e.deleteShader(i),e.deleteShader(s);const o={};for(const i in t.uniformData){const s=t.uniformData[i];o[i]={location:e.getUniformLocation(r,i),value:hf(s.type,s.size)}}return new nf(r,o)}(t,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ff.extension={type:Q_.RendererSystem,name:"shader"},j_.add(ff);class mf{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.2 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}mf.defaultOptions={hello:!1},mf.extension={type:[Q_.RendererSystem,Q_.CanvasRendererSystem],name:"startup"},j_.add(mf);const bf=class e{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ad.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ep,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=function(e,t=[]){return t[ad.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.ADD]=[e.ONE,e.ONE],t[ad.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.NONE]=[0,0],t[ad.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[ad.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ad.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[ad.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[ad.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ad.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[ad.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[ad.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[ad.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[ad.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ad.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,i=0;for(;t;)1&t&&this.map[i].call(this,!!(e.data&1<<i)),t>>=1,i++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],i=this.gl;2===t.length?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const i=this.checks.indexOf(e);t&&-1===i?this.checks.push(e):!t&&-1!==i&&this.checks.splice(i,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};bf.extension={type:Q_.RendererSystem,name:"state"};let vf=bf;j_.add(vf);class Tf extends zd{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter((t=>e.systems[t])),i=[...t,...Object.keys(e.systems).filter((e=>!t.includes(e)))];for(const t of i)this.addSystem(e.systems[t],t)}addRunners(...e){e.forEach((e=>{this.runners[e]=new sp(e)}))}addSystem(e,t){const i=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=i,this._systemsHash[t]=i;for(const e in this.runners)this.runners[e].add(i);return this}emitWithCustomOptions(e,t){const i=Object.keys(this._systemsHash);e.items.forEach((s=>{const r=i.find((e=>this._systemsHash[e]===s));s[e.name](t[r])}))}destroy(){Object.values(this.runners).forEach((e=>{e.destroy()})),this._systemsHash={}}}const yf=class e{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=e.defaultMaxIdle,this.checkCountMax=e.defaultCheckCountMax,this.mode=e.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==bd.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let i=!1;for(let s=0;s<t.length;s++){const r=t[s];r.resource&&this.count-r.touched>this.maxIdle&&(e.destroyTexture(r,!0),t[s]=null,i=!0)}if(i){let e=0;for(let i=0;i<t.length;i++)null!==t[i]&&(t[e++]=t[i]);t.length=e}}unload(e){const t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(let t=e.children.length-1;t>=0;t--)this.unload(e.children[t])}destroy(){this.renderer=null}};yf.defaultMode=bd.AUTO,yf.defaultMaxIdle=3600,yf.defaultCheckCountMax=600,yf.extension={type:Q_.RendererSystem,name:"textureGC"};let xf=yf;j_.add(xf);class Af{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ud.UNSIGNED_BYTE,this.internalFormat=ld.RGBA,this.samplerType=0}}class Cf{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new hp,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(e){let t;return t="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[ud.UNSIGNED_BYTE]:{[ld.RGBA]:e.RGBA8,[ld.RGB]:e.RGB8,[ld.RG]:e.RG8,[ld.RED]:e.R8,[ld.RGBA_INTEGER]:e.RGBA8UI,[ld.RGB_INTEGER]:e.RGB8UI,[ld.RG_INTEGER]:e.RG8UI,[ld.RED_INTEGER]:e.R8UI,[ld.ALPHA]:e.ALPHA,[ld.LUMINANCE]:e.LUMINANCE,[ld.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[ud.BYTE]:{[ld.RGBA]:e.RGBA8_SNORM,[ld.RGB]:e.RGB8_SNORM,[ld.RG]:e.RG8_SNORM,[ld.RED]:e.R8_SNORM,[ld.RGBA_INTEGER]:e.RGBA8I,[ld.RGB_INTEGER]:e.RGB8I,[ld.RG_INTEGER]:e.RG8I,[ld.RED_INTEGER]:e.R8I},[ud.UNSIGNED_SHORT]:{[ld.RGBA_INTEGER]:e.RGBA16UI,[ld.RGB_INTEGER]:e.RGB16UI,[ld.RG_INTEGER]:e.RG16UI,[ld.RED_INTEGER]:e.R16UI,[ld.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[ud.SHORT]:{[ld.RGBA_INTEGER]:e.RGBA16I,[ld.RGB_INTEGER]:e.RGB16I,[ld.RG_INTEGER]:e.RG16I,[ld.RED_INTEGER]:e.R16I},[ud.UNSIGNED_INT]:{[ld.RGBA_INTEGER]:e.RGBA32UI,[ld.RGB_INTEGER]:e.RGB32UI,[ld.RG_INTEGER]:e.RG32UI,[ld.RED_INTEGER]:e.R32UI,[ld.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[ud.INT]:{[ld.RGBA_INTEGER]:e.RGBA32I,[ld.RGB_INTEGER]:e.RGB32I,[ld.RG_INTEGER]:e.RG32I,[ld.RED_INTEGER]:e.R32I},[ud.FLOAT]:{[ld.RGBA]:e.RGBA32F,[ld.RGB]:e.RGB32F,[ld.RG]:e.RG32F,[ld.RED]:e.R32F,[ld.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[ud.HALF_FLOAT]:{[ld.RGBA]:e.RGBA16F,[ld.RGB]:e.RGB16F,[ld.RG]:e.RG16F,[ld.RED]:e.R16F},[ud.UNSIGNED_SHORT_5_6_5]:{[ld.RGB]:e.RGB565},[ud.UNSIGNED_SHORT_4_4_4_4]:{[ld.RGBA]:e.RGBA4},[ud.UNSIGNED_SHORT_5_5_5_1]:{[ld.RGBA]:e.RGB5_A1},[ud.UNSIGNED_INT_2_10_10_10_REV]:{[ld.RGBA]:e.RGB10_A2,[ld.RGBA_INTEGER]:e.RGB10_A2UI},[ud.UNSIGNED_INT_10F_11F_11F_REV]:{[ld.RGB]:e.R11F_G11F_B10F},[ud.UNSIGNED_INT_5_9_9_9_REV]:{[ld.RGB]:e.RGB9_E5},[ud.UNSIGNED_INT_24_8]:{[ld.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[ud.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[ld.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:{[ud.UNSIGNED_BYTE]:{[ld.RGBA]:e.RGBA,[ld.RGB]:e.RGB,[ld.ALPHA]:e.ALPHA,[ld.LUMINANCE]:e.LUMINANCE,[ld.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[ud.UNSIGNED_SHORT_5_6_5]:{[ld.RGB]:e.RGB},[ud.UNSIGNED_SHORT_4_4_4_4]:{[ld.RGBA]:e.RGBA},[ud.UNSIGNED_SHORT_5_5_5_1]:{[ld.RGBA]:e.RGBA}},t}(e),this.samplerTypes=function(e){let t;return t="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[e.RGB]:dd.FLOAT,[e.RGBA]:dd.FLOAT,[e.ALPHA]:dd.FLOAT,[e.LUMINANCE]:dd.FLOAT,[e.LUMINANCE_ALPHA]:dd.FLOAT,[e.R8]:dd.FLOAT,[e.R8_SNORM]:dd.FLOAT,[e.RG8]:dd.FLOAT,[e.RG8_SNORM]:dd.FLOAT,[e.RGB8]:dd.FLOAT,[e.RGB8_SNORM]:dd.FLOAT,[e.RGB565]:dd.FLOAT,[e.RGBA4]:dd.FLOAT,[e.RGB5_A1]:dd.FLOAT,[e.RGBA8]:dd.FLOAT,[e.RGBA8_SNORM]:dd.FLOAT,[e.RGB10_A2]:dd.FLOAT,[e.RGB10_A2UI]:dd.FLOAT,[e.SRGB8]:dd.FLOAT,[e.SRGB8_ALPHA8]:dd.FLOAT,[e.R16F]:dd.FLOAT,[e.RG16F]:dd.FLOAT,[e.RGB16F]:dd.FLOAT,[e.RGBA16F]:dd.FLOAT,[e.R32F]:dd.FLOAT,[e.RG32F]:dd.FLOAT,[e.RGB32F]:dd.FLOAT,[e.RGBA32F]:dd.FLOAT,[e.R11F_G11F_B10F]:dd.FLOAT,[e.RGB9_E5]:dd.FLOAT,[e.R8I]:dd.INT,[e.R8UI]:dd.UINT,[e.R16I]:dd.INT,[e.R16UI]:dd.UINT,[e.R32I]:dd.INT,[e.R32UI]:dd.UINT,[e.RG8I]:dd.INT,[e.RG8UI]:dd.UINT,[e.RG16I]:dd.INT,[e.RG16UI]:dd.UINT,[e.RG32I]:dd.INT,[e.RG32UI]:dd.UINT,[e.RGB8I]:dd.INT,[e.RGB8UI]:dd.UINT,[e.RGB16I]:dd.INT,[e.RGB16UI]:dd.UINT,[e.RGB32I]:dd.INT,[e.RGB32UI]:dd.UINT,[e.RGBA8I]:dd.INT,[e.RGBA8UI]:dd.UINT,[e.RGBA16I]:dd.INT,[e.RGBA16UI]:dd.UINT,[e.RGBA32I]:dd.INT,[e.RGBA32UI]:dd.UINT,[e.DEPTH_COMPONENT16]:dd.FLOAT,[e.DEPTH_COMPONENT24]:dd.FLOAT,[e.DEPTH_COMPONENT32F]:dd.FLOAT,[e.DEPTH_STENCIL]:dd.FLOAT,[e.DEPTH24_STENCIL8]:dd.FLOAT,[e.DEPTH32F_STENCIL8]:dd.FLOAT}:{[e.RGB]:dd.FLOAT,[e.RGBA]:dd.FLOAT,[e.ALPHA]:dd.FLOAT,[e.LUMINANCE]:dd.FLOAT,[e.LUMINANCE_ALPHA]:dd.FLOAT,[e.DEPTH_STENCIL]:dd.FLOAT},t}(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let e=0;e<t;e++)this.boundTextures[e]=null;this.emptyTextures={};const i=new Af(e.createTexture());e.bindTexture(e.TEXTURE_2D,i.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=i,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new Af(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let t=0;t<6;t++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let e=0;e<this.boundTextures.length;e++)this.bind(null,e)}bind(e,t=0){const{gl:i}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let e=0;e<i.length;e++)i[e]===this.unknownTexture&&this.bind(null,e)}for(let s=0;s<i.length;s++)i[s]===e&&(this.currentLocation!==s&&(t.activeTexture(t.TEXTURE0+s),this.currentLocation=s),t.bindTexture(e.target,this.emptyTextures[e.target].texture),i[s]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let i=e-1;i>=0;--i){const e=t[i];e&&e._glTextures[s].samplerType!==dd.FLOAT&&this.renderer.texture.unbind(e)}}initTexture(e){const t=new Af(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){t.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??dd.FLOAT,2===this.webGLVersion&&e.type===ud.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const i=this.renderer;if(this.initTextureType(e,t),e.resource?.upload(i,e,t))t.samplerType!==dd.FLOAT&&(this.hasIntegerTextures=!0);else{const s=e.realWidth,r=e.realHeight,n=i.gl;(t.width!==s||t.height!==r||t.dirtyId<0)&&(t.width=s,t.height=r,n.texImage2D(e.target,0,t.internalFormat,s,r,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:i}=this;if((e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),i.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const t=this.managedTextures.indexOf(e);-1!==t&&D_(this.managedTextures,t,1)}}updateTextureStyle(e){const t=e._glTextures[this.CONTEXT_UID];t&&(e.mipmap!==gd.POW2&&2===this.webGLVersion||e.isPowerOfTwo?t.mipmap=e.mipmap>=1:t.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?t.wrapMode=e.wrapMode:t.wrapMode=pd.CLAMP,e.resource?.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const i=this.gl;if(t.mipmap&&e.mipmap!==gd.ON_MANUAL&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,t.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===_d.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const t=this.renderer.context.extensions.anisotropicFiltering;if(t&&e.anisotropicLevel>0&&e.scaleMode===_d.LINEAR){const s=Math.min(e.anisotropicLevel,i.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===_d.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===_d.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Cf.extension={type:Q_.RendererSystem,name:"texture"},j_.add(Cf);class Sf{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,s=e._glTransformFeedbacks[i]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:i,renderer:s}=this;t&&s.shader.bind(t),i.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:i,CONTEXT_UID:s}=this,r=t.createTransformFeedback();e._glTransformFeedbacks[s]=r,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,r);for(let r=0;r<e.buffers.length;r++){const n=e.buffers[r];n&&(i.buffer.update(n),n._glBuffers[s].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,r,n._glBuffers[s].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),r}disposeTransformFeedback(e,t){const i=e._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let i=0;i<e.buffers.length;i++){const s=e.buffers[i];if(!s)continue;const n=s._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0===n.refCount&&!t&&r.dispose(s,t))}i&&(t||s.deleteTransformFeedback(i),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Sf.extension={type:Q_.RendererSystem,name:"transformFeedback"},j_.add(Sf);class Ef{constructor(e){this.renderer=e}init(e){this.screen=new Sp(0,0,e.width,e.height),this.element=e.view||Ad.ADAPTER.createCanvas(),this.resolution=e.resolution||Ad.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Ef.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Ef.extension={type:[Q_.RendererSystem,Q_.CanvasRendererSystem],name:"_view"},j_.add(Ef),Ad.PREFER_ENV=rd.WEBGL2,Ad.STRICT_TEXTURE_CACHE=!1,Ad.RENDER_OPTIONS={...mg.defaultOptions,...pg.defaultOptions,...Ef.defaultOptions,...mf.defaultOptions},Object.defineProperties(Ad,{WRAP_MODE:{get:()=>hp.defaultOptions.wrapMode,set(e){Xd("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),hp.defaultOptions.wrapMode=e}},SCALE_MODE:{get:()=>hp.defaultOptions.scaleMode,set(e){Xd("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),hp.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get:()=>hp.defaultOptions.mipmap,set(e){Xd("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),hp.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get:()=>hp.defaultOptions.anisotropicLevel,set(e){Xd("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),hp.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get:()=>(Xd("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),_g.defaultResolution),set(e){_g.defaultResolution=e}},FILTER_MULTISAMPLE:{get:()=>(Xd("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),_g.defaultMultisample),set(e){_g.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get:()=>ug.defaultMaxTextures,set(e){Xd("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),ug.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get:()=>ug.defaultBatchSize,set(e){Xd("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),ug.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get:()=>ug.canUploadSameBuffer,set(e){Xd("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),ug.canUploadSameBuffer=e}},GC_MODE:{get:()=>xf.defaultMode,set(e){Xd("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),xf.defaultMode=e}},GC_MAX_IDLE:{get:()=>xf.defaultMaxIdle,set(e){Xd("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),xf.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get:()=>xf.defaultCheckCountMax,set(e){Xd("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),xf.defaultCheckCountMax=e}},PRECISION_VERTEX:{get:()=>sg.defaultVertexPrecision,set(e){Xd("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),sg.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get:()=>sg.defaultFragmentPrecision,set(e){Xd("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),sg.defaultFragmentPrecision=e}}});var Rf=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(Rf||{});class Pf{constructor(e,t=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=i,this.once=s}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const If=class e{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Pf(null,null,1/0),this.deltaMS=1/e.targetFPMS,this.elapsedMS=1/e.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=Rf.NORMAL){return this._addListener(new Pf(e,t,i))}addOnce(e,t,i=Rf.NORMAL){return this._addListener(new Pf(e,t,i,!0))}_addListener(e){let t=this._head.next,i=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}else e.connect(i);return this._startIfPossible(),this}remove(e,t){let i=this._head.next;for(;i;)i=i.match(e,t)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let i;if(t>this.lastTime){if(i=this.elapsedMS=t-this.lastTime,i>this._maxElapsedMS&&(i=this._maxElapsedMS),i*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=i,this.deltaTime=this.deltaMS*e.targetFPMS;const s=this._head;let r=s.next;for(;r;)r=r.emit(this.deltaTime);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const i=Math.min(this.maxFPS,t),s=Math.min(Math.max(0,i)/1e3,e.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(0===e)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!e._shared){const t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared}static get system(){if(!e._system){const t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system}};If.targetFPMS=.06;let Mf=If;Object.defineProperties(Ad,{TARGET_FPMS:{get:()=>Mf.targetFPMS,set(e){Xd("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Mf.targetFPMS=e}}});class wf{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Rf.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Mf.shared:new Mf,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}wf.extension=Q_.Application,j_.add(wf);const Of=[];j_.handleByList(Q_.Renderer,Of);const Bf="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Df{constructor(e){this.renderer=e}contextChange(e){let t;if(1===this.renderer.context.webGLVersion){const i=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,i)}else{const i=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i)}t>=yd.HIGH?this.multisample=yd.HIGH:t>=yd.MEDIUM?this.multisample=yd.MEDIUM:t>=yd.LOW?this.multisample=yd.LOW:this.multisample=yd.NONE}destroy(){}}Df.extension={type:Q_.RendererSystem,name:"_multisample"},j_.add(Df);class Ff{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Lf{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,s=e._glBuffers[i]||this.createGLBuffer(e);t.bindBuffer(e.type,s.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[t]!==e){const r=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[t]=e,i.bindBufferBase(i.UNIFORM_BUFFER,t,r.buffer)}}bindBufferRange(e,t,i){const{gl:s,CONTEXT_UID:r}=this;i=i||0;const n=e._glBuffers[r]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,t||0,n.buffer,256*i,256)}update(e){const{gl:t,CONTEXT_UID:i}=this,s=e._glBuffers[i]||this.createGLBuffer(e);if(e._updateID!==s.updateID)if(s.updateID=e._updateID,t.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const i=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,i)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const i=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),i&&(t||s.deleteBuffer(i.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let i=0;i<t.length;i++)this.dispose(this.managedBuffers[t[i]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:i}=this;return e._glBuffers[t]=new Ff(i.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}Lf.extension={type:Q_.RendererSystem,name:"buffer"},j_.add(Lf);class Nf{constructor(e){this.renderer=e}render(e,t){const i=this.renderer;let s,r,n,o;if(t&&(s=t.renderTexture,r=t.clear,n=t.transform,o=t.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=n,!i.context.isLost){if(s||(this.lastObjectRendered=e),!o){const t=e.enableTempParent();e.updateTransform(),e.disableTempParent(t)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(r??i.background.clearBeforeRender)&&i.renderTexture.clear(),e.render(i),i.batch.currentRenderer.flush(),s&&(t.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Nf.extension={type:Q_.RendererSystem,name:"objectRenderer"},j_.add(Nf);const kf=class e extends Tf{constructor(t){super(),this.type=nd.WEBGL,t=Object.assign({},Ad.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ng({projectionMatrix:new Mp},!0);const i={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:e.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(i),"useContextAlpha"in t&&(Xd("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=e.__plugins,this.options=t,this.startup.run(this.options)}static test(e){return!e?.forceCanvas&&$d()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Xd("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Xd("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Xd("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Xd("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Xd("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Xd("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){Xd("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Xd("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};kf.extension={type:Q_.Renderer,priority:1},kf.__plugins={},kf.__systems={};let Uf=kf;j_.handleByMap(Q_.RendererPlugin,Uf.__plugins),j_.handleByMap(Q_.RendererSystem,Uf.__systems),j_.add(Uf);class Vf extends rp{constructor(e,t){const{width:i,height:s}=t||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let t=0;t<e;t++){const e=new hp;this.items.push(e),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let i=0;i<this.length;i++)e[i]&&(e[i].castToBaseTexture?this.addBaseTextureAt(e[i].castToBaseTexture(),i):e[i]instanceof rp?this.addResourceAt(e[i],i):this.addResourceAt(ip(e[i],t),i))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map((e=>e.resource)).filter((e=>e)).map((e=>e.load()));return this._load=Promise.all(e).then((()=>{const{realWidth:e,realHeight:t}=this.items[0];return this.resize(e,t),this.update(),Promise.resolve(this)})),this._load}}const Gf=class e extends Vf{constructor(t,i){const{width:s,height:r,autoLoad:n,linkBaseTexture:o}=i||{};if(t&&t.length!==e.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:s,height:r});for(let t=0;t<e.SIDES;t++)this.items[t].target=cd.TEXTURE_CUBE_MAP_POSITIVE_X+t;this.linkBaseTexture=!1!==o,t&&this.initFromArray(t,i),!1!==n&&this.load()}bind(e){super.bind(e),e.target=cd.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,t)}else e.target=cd.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(t,i,s){const r=this.itemDirtyIds;for(let n=0;n<e.SIDES;n++){const e=this.items[n];(r[n]<e.dirtyId||s.dirtyId<i.dirtyId)&&(e.valid&&e.resource?(e.resource.upload(t,e,s),r[n]=e.dirtyId):r[n]<-1&&(t.gl.texImage2D(e.target,0,s.internalFormat,i.realWidth,i.realHeight,0,i.format,s.type,null),r[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===e.SIDES}};Gf.SIDES=6;let zf=Gf;class Hf extends Tg{constructor(e,t){let i,s,r;t=t||{},"string"==typeof e?(i=Hf.EMPTY,s=e,r=!0):(i=e,s=null,r=!1),super(i),this.url=s,this.crossOrigin=t.crossOrigin??!0,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??r,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(e,t)=>{if(null!==this.url)try{const t=await Ad.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await t.blob();if(this.destroyed)return;const s=await createImageBitmap(i,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===fd.UNPACK?"premultiply":"none"});if(this.destroyed)return void s.close();this.source=s,this.update(),e(this)}catch(e){if(this.destroyed)return;t(e),this.onError.emit(e)}else e(this)}))),this._load}upload(e,t,i){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),super.upload(e,t,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof e||e instanceof ImageBitmap)}static get EMPTY(){return Hf._EMPTY=Hf._EMPTY??Ad.ADAPTER.createCanvas(0,0),Hf._EMPTY}}const Wf=class e extends Tg{constructor(e,t){t=t||{},super(Ad.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.update(),t(this)},e.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const e=new Image;Tg.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,i=e.height;if(!t||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=t*this.scale,r=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*t,r=this._overrideHeight||this._overrideWidth/t*i),s=Math.round(s),r=Math.round(r);const n=this.source;n.width=s,n.height=r,n._pixiId=`canvas_${N_()}`,n.getContext("2d").drawImage(e,0,0,t,i,0,0,s,r),this._resolve(),this._resolve=null}}static getSize(t){const i=e.SVG_SIZE.exec(t),s={};return i&&(s[i[1]]=Math.round(parseFloat(i[3])),s[i[5]]=Math.round(parseFloat(i[7]))),s}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,i){return"svg"===i||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&e.SVG_XML.test(t)}};Wf.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Wf.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Xf=Wf;const qf=class e extends Tg{constructor(t,i){if(i=i||{},!(t instanceof HTMLVideoElement)){const s=document.createElement("video");!1!==i.autoLoad&&s.setAttribute("preload","auto"),!1!==i.playsinline&&(s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline","")),!0===i.muted&&(s.setAttribute("muted",""),s.muted=!0),!0===i.loop&&s.setAttribute("loop",""),!1!==i.autoPlay&&s.setAttribute("autoplay",""),"string"==typeof t&&(t=[t]);const r=t[0].src||t[0];Tg.crossOrigin(s,r,i.crossorigin);for(let i=0;i<t.length;++i){const r=document.createElement("source");let{src:n,mime:o}=t[i];if(n=n||t[i],n.startsWith("data:"))o=n.slice(5,n.indexOf(";"));else if(!n.startsWith("blob:")){const t=n.split("?").shift().toLowerCase(),i=t.slice(t.lastIndexOf(".")+1);o=o||e.MIME_TYPES[i]||`video/${i}`}r.src=n,o&&(r.type=o),s.appendChild(r)}t=s}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=i.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==i.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==i.autoLoad&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const e=Mf.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(((t,i)=>{this.valid?t(this):(this._resolve=t,this._reject=i,e.load())})),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Mf.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Mf.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Mf.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,i){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.includes(i)}};qf.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],qf.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Qf=qf;tp.push(Hf,yg,class extends Tg{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return!!(t&&e instanceof t)||globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}},Qf,class extends Tg{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}},Xf,np,zf,class extends Vf{constructor(e,t){const{width:i,height:s}=t||{};let r,n;Array.isArray(e)?(r=e,n=e.length):n=e,super(n,{width:i,height:s}),r&&this.initFromArray(r,t)}addBaseTextureAt(e,t){if(!e.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(e.resource,t),this}bind(e){super.bind(e),e.target=cd.TEXTURE_2D_ARRAY}upload(e,t,i){const{length:s,itemDirtyIds:r,items:n}=this,{gl:o}=e;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,t.format,i.type,null);for(let e=0;e<s;e++){const s=n[e];r[e]<s.dirtyId&&(r[e]=s.dirtyId,s.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,e,s.resource.width,s.resource.height,1,t.format,i.type,s.resource.source))}return!0}});class Kf{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?Sp.EMPTY:((e=e||new Sp(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:i,b:s,c:r,d:n,tx:o,ty:a}=e,h=i*t.x+r*t.y+o,l=s*t.x+n*t.y+a;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(e){let t=this.minX,i=this.minY,s=this.maxX,r=this.maxY,n=e[0],o=e[1];t=n<t?n:t,i=o<i?o:i,s=n>s?n:s,r=o>r?o:r,n=e[2],o=e[3],t=n<t?n:t,i=o<i?o:i,s=n>s?n:s,r=o>r?o:r,n=e[4],o=e[5],t=n<t?n:t,i=o<i?o:i,s=n>s?n:s,r=o>r?o:r,n=e[6],o=e[7],t=n<t?n:t,i=o<i?o:i,s=n>s?n:s,r=o>r?o:r,this.minX=t,this.minY=i,this.maxX=s,this.maxY=r}addFrame(e,t,i,s,r){this.addFrameMatrix(e.worldTransform,t,i,s,r)}addFrameMatrix(e,t,i,s,r){const n=e.a,o=e.b,a=e.c,h=e.d,l=e.tx,c=e.ty;let u=this.minX,d=this.minY,_=this.maxX,p=this.maxY,g=n*t+a*i+l,f=o*t+h*i+c;u=g<u?g:u,d=f<d?f:d,_=g>_?g:_,p=f>p?f:p,g=n*s+a*i+l,f=o*s+h*i+c,u=g<u?g:u,d=f<d?f:d,_=g>_?g:_,p=f>p?f:p,g=n*t+a*r+l,f=o*t+h*r+c,u=g<u?g:u,d=f<d?f:d,_=g>_?g:_,p=f>p?f:p,g=n*s+a*r+l,f=o*s+h*r+c,u=g<u?g:u,d=f<d?f:d,_=g>_?g:_,p=f>p?f:p,this.minX=u,this.minY=d,this.maxX=_,this.maxY=p}addVertexData(e,t,i){let s=this.minX,r=this.minY,n=this.maxX,o=this.maxY;for(let a=t;a<i;a+=2){const t=e[a],i=e[a+1];s=t<s?t:s,r=i<r?i:r,n=t>n?t:n,o=i>o?i:o}this.minX=s,this.minY=r,this.maxX=n,this.maxY=o}addVertices(e,t,i,s){this.addVerticesMatrix(e.worldTransform,t,i,s)}addVerticesMatrix(e,t,i,s,r=0,n=r){const o=e.a,a=e.b,h=e.c,l=e.d,c=e.tx,u=e.ty;let d=this.minX,_=this.minY,p=this.maxX,g=this.maxY;for(let e=i;e<s;e+=2){const i=t[e],s=t[e+1],f=o*i+h*s+c,m=l*s+a*i+u;d=Math.min(d,f-r),p=Math.max(p,f+r),_=Math.min(_,m-n),g=Math.max(g,m+n)}this.minX=d,this.minY=_,this.maxX=p,this.maxY=g}addBounds(e){const t=this.minX,i=this.minY,s=this.maxX,r=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<i?e.minY:i,this.maxX=e.maxX>s?e.maxX:s,this.maxY=e.maxY>r?e.maxY:r}addBoundsMask(e,t){const i=e.minX>t.minX?e.minX:t.minX,s=e.minY>t.minY?e.minY:t.minY,r=e.maxX<t.maxX?e.maxX:t.maxX,n=e.maxY<t.maxY?e.maxY:t.maxY;if(i<=r&&s<=n){const e=this.minX,t=this.minY,o=this.maxX,a=this.maxY;this.minX=i<e?i:e,this.minY=s<t?s:t,this.maxX=r>o?r:o,this.maxY=n>a?n:a}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const i=e.minX>t.x?e.minX:t.x,s=e.minY>t.y?e.minY:t.y,r=e.maxX<t.x+t.width?e.maxX:t.x+t.width,n=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(i<=r&&s<=n){const e=this.minX,t=this.minY,o=this.maxX,a=this.maxY;this.minX=i<e?i:e,this.minY=s<t?s:t,this.maxX=r>o?r:o,this.maxY=n>a?n:a}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,i,s,r,n){e-=r,t-=n,i+=r,s+=n,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>s?this.maxY:s}}class Yf extends zd{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Gp,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Kf,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let i=0;i<t.length;++i){const s=t[i];Object.defineProperty(Yf.prototype,s,Object.getOwnPropertyDescriptor(e,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new Sp),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new Sp),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Kf);const t=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=i?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const n=this.getBounds(!1,e);return this.parent=i,this.transform=t,this._bounds=s,this._bounds.updateID+=this._boundsID-r,n}toGlobal(e,t,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,i,s){return t&&(e=t.toGlobal(e,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,i)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(e=0,t=0,i=1,s=1,r=0,n=0,o=0,a=0,h=0){return this.position.x=e,this.position.y=t,this.scale.x=i||1,this.scale.y=s||1,this.rotation=r,this.skew.x=n,this.skew.y=o,this.pivot.x=a,this.pivot.y=h,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new jf),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*Tp}set angle(e){this.transform.rotation=e*yp}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=e,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class jf extends Yf{constructor(){super(...arguments),this.sortDirty=null}}Yf.prototype.displayObjectUpdateTransform=Yf.prototype.updateTransform;const Zf=new Mp;function $f(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const Jf=class e extends Yf{constructor(){super(),this.children=[],this.sortableChildren=e.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const i=this.getChildIndex(e),s=this.getChildIndex(t);this.children[i]=t,this.children[s]=e,this.onChildrenChange(i<s?i:s)}getChildIndex(e){const t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(e);D_(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],i=this.children.indexOf(t);if(-1===i)return null;t.parent=null,t.transform._parentID=-1,D_(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,D_(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const i=e,s=t-i;let r;if(s>0&&s<=t){r=this.children.splice(i,s);for(let e=0;e<r.length;++e)r[e].parent=null,r[e].transform&&(r[e].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let e=0;e<r.length;++e)r[e].emit("removed",this),this.emit("childRemoved",r[e],this,e);return r}if(0===s&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,i=this.children.length;t<i;++t){const i=this.children[t];i._lastSortedIndex=t,!e&&0!==i.zIndex&&(e=!0)}e&&this.children.length>1&&this.children.sort($f),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e];t.visible&&t.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.visible&&t.renderable)if(t.calculateBounds(),t._mask){const e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const i=super.getLocalBounds(e);if(!t)for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e];t.visible&&t.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const i=t.renderTexture.sourceFrame;if(!(i.width>0&&i.height>0))return;let s,r;this.cullArea?(s=this.cullArea,r=this.worldTransform):this._render!==e.prototype._render&&(s=this.getBounds(!0));const n=t.projection.transform;if(n&&(r?(r=Zf.copyFrom(r),r.prepend(n)):r=n),s&&i.intersects(s,r))this._render(t);else if(this.cullArea)return;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e],s=i.cullable;i.cullable=s||!this.cullArea,i.render(t),i.cullable=s}}render(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,i=this.children.length;t<i;++t)this.children[t].render(e)}}renderAdvanced(e){const t=this.filters,i=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let e=0;e<t.length;e++)t[e].enabled&&this._enabledFilters.push(t[e])}const s=t&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==Td.NONE));if(s&&e.batch.flush(),t&&this._enabledFilters?.length&&e.filter.push(this,this._enabledFilters),i&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,i=this.children.length;t<i;++t)this.children[t].render(e)}s&&e.batch.flush(),i&&e.mask.pop(this),t&&this._enabledFilters?.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t="boolean"==typeof e?e:e?.children,i=this.removeChildren(0,this.children.length);if(t)for(let t=0;t<i.length;++t)i[t].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}};Jf.defaultSortableChildren=!1;let em=Jf;em.prototype.containerUpdateTransform=em.prototype.updateTransform,Object.defineProperties(Ad,{SORTABLE_CHILDREN:{get:()=>em.defaultSortableChildren,set(e){Xd("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),em.defaultSortableChildren=e}}});const tm=new Ap,im=new Uint16Array([0,1,2,0,2,3]);class sm extends em{constructor(e){super(),this._anchor=new Up(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new R_(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=ad.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||Sg.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=im,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Ad.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=F_(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=F_(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,i=t.a,s=t.b,r=t.c,n=t.d,o=t.tx,a=t.ty,h=this.vertexData,l=e.trim,c=e.orig,u=this._anchor;let d=0,_=0,p=0,g=0;if(l?(_=l.x-u._x*c.width,d=_+l.width,g=l.y-u._y*c.height,p=g+l.height):(_=-u._x*c.width,d=_+c.width,g=-u._y*c.height,p=g+c.height),h[0]=i*_+r*g+o,h[1]=n*g+s*_+a,h[2]=i*d+r*g+o,h[3]=n*g+s*d+a,h[4]=i*d+r*p+o,h[5]=n*p+s*d+a,h[6]=i*_+r*p+o,h[7]=n*p+s*_+a,this._roundPixels){const e=Ad.RESOLUTION;for(let t=0;t<h.length;++t)h[t]=Math.round(h[t]*e)/e}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,i=e.orig,s=this._anchor,r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,h=r.d,l=r.tx,c=r.ty,u=-s._x*i.width,d=u+i.width,_=-s._y*i.height,p=_+i.height;if(t[0]=n*u+a*_+l,t[1]=h*_+o*u+c,t[2]=n*d+a*_+l,t[3]=h*_+o*d+c,t[4]=n*d+a*p+l,t[5]=h*p+o*d+c,t[6]=n*u+a*p+l,t[7]=h*p+o*u+c,this._roundPixels){const e=Ad.RESOLUTION;for(let i=0;i<t.length;++i)t[i]=Math.round(t[i]*e)/e}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return 0===this.children.length?(this._localBounds||(this._localBounds=new Kf),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Sp),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,tm);const t=this._texture.orig.width,i=this._texture.orig.height,s=-t*this.anchor.x;let r=0;return tm.x>=s&&tm.x<s+t&&(r=-i*this.anchor.y,tm.y>=r&&tm.y<r+i)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e?.texture){const t="boolean"==typeof e?e:e?.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const i=e instanceof Sg?e:Sg.from(e,t);return new sm(i)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=F_(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=F_(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||Sg.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const rm=new Mp;Yf.prototype._cacheAsBitmap=!1,Yf.prototype._cacheData=null,Yf.prototype._cacheAsBitmapResolution=null,Yf.prototype._cacheAsBitmapMultisample=null;class nm{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Yf.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;let t;this._cacheAsBitmap=e,e?(this._cacheData||(this._cacheData=new nm),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),Yf.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},Yf.prototype._initCachedDisplayObject=function(e){if(this._cacheData?.sprite)return;const t=this.alpha;this.alpha=1,e.batch.flush();const i=this.getLocalBounds(new Sp,!0);if(this.filters?.length){const e=this.filters[0].padding;i.pad(e)}const s=this.cacheAsBitmapResolution||e.resolution;i.ceil(s),i.width=Math.max(i.width,1/s),i.height=Math.max(i.height,1/s);const r=e.renderTexture.current,n=e.renderTexture.sourceFrame.clone(),o=e.renderTexture.destinationFrame.clone(),a=e.projection.transform,h=Eg.create({width:i.width,height:i.height,resolution:s,multisample:this.cacheAsBitmapMultisample??e.multisample}),l=`cacheAsBitmap_${N_()}`;this._cacheData.textureCacheId=l,hp.addToCache(h.baseTexture,l),Sg.addToCache(h,l);const c=this.transform.localTransform.copyTo(rm).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=a,e.renderTexture.bind(r,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const u=new sm(h);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-i.x/i.width,u.anchor.y=-i.y/i.height,u.alpha=t,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},Yf.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},Yf.prototype._initCachedDisplayObjectCanvas=function(e){if(this._cacheData?.sprite)return;const t=this.getLocalBounds(new Sp,!0),i=this.alpha;this.alpha=1;const s=e.canvasContext.activeContext,r=e._projTransform,n=this.cacheAsBitmapResolution||e.resolution;t.ceil(n),t.width=Math.max(t.width,1/n),t.height=Math.max(t.height,1/n);const o=Eg.create({width:t.width,height:t.height,resolution:n}),a=`cacheAsBitmap_${N_()}`;this._cacheData.textureCacheId=a,hp.addToCache(o.baseTexture,a),Sg.addToCache(o,a);const h=rm;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),e.canvasContext.activeContext=s,e._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const l=new sm(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-t.x/t.width,l.anchor.y=-t.y/t.height,l.alpha=i,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)},Yf.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Yf.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Yf.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,hp.removeFromCache(this._cacheData.textureCacheId),Sg.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Yf.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},Yf.prototype.name=null,em.prototype.getChildByName=function(e,t){for(let t=0,i=this.children.length;t<i;t++)if(this.children[t].name===e)return this.children[t];if(t)for(let t=0,i=this.children.length;t<i;t++){const i=this.children[t];if(!i.getChildByName)continue;const s=i.getChildByName(e,!0);if(s)return s}return null},Yf.prototype.getGlobalPosition=function(e=new Ap,t=!1){return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};const om={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},am=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class hm extends _g{constructor(e,t=8,i=4,s=_g.defaultResolution,r=5){const n=function(e,t){const i=Math.ceil(e/2);let s,r="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",n="";s=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let t=0;t<e;t++){let e=s.replace("%index%",t.toString());e=e.replace("%sampleIndex%",t-(i-1)+".0"),n+=e,n+="\n"}return r=r.replace("%blur%",n),r=r.replace("%size%",e.toString()),r}(r,e),o=function(e){const t=om[e],i=t.length;let s,r=am,n="";for(let r=0;r<e;r++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",r.toString());s=r,r>=i&&(s=e-r-1),o=o.replace("%value%",t[s].toString()),n+=o,n+="\n"}return r=r.replace("%blur%",n),r=r.replace("%size%",e.toString()),r}(r);super(n,o),this.horizontal=e,this.resolution=s,this._quality=0,this.quality=i,this.blur=t}apply(e,t,i,s){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/t.width):this.uniforms.strength=1/i.height*(i.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,i,s);else{const r=e.getFilterTexture(),n=e.renderer;let o=t,a=r;this.state.blend=!1,e.applyFilter(this,o,a,md.CLEAR);for(let t=1;t<this.passes-1;t++){e.bindAndClear(o,md.BLIT),this.uniforms.uSampler=a;const t=a;a=o,o=t,n.shader.bind(this),n.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,a,i,s),e.returnFilterTexture(r)}}get blur(){return this.strength}set blur(e){this.padding=1+2*Math.abs(e),this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class lm extends _g{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Bf,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",e),this.alpha=1}_loadMatrix(e,t=!1){let i=e;t&&(this._multiply(i,this.uniforms.m,e),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(e,t,i){return e[0]=t[0]*i[0]+t[1]*i[5]+t[2]*i[10]+t[3]*i[15],e[1]=t[0]*i[1]+t[1]*i[6]+t[2]*i[11]+t[3]*i[16],e[2]=t[0]*i[2]+t[1]*i[7]+t[2]*i[12]+t[3]*i[17],e[3]=t[0]*i[3]+t[1]*i[8]+t[2]*i[13]+t[3]*i[18],e[4]=t[0]*i[4]+t[1]*i[9]+t[2]*i[14]+t[3]*i[19]+t[4],e[5]=t[5]*i[0]+t[6]*i[5]+t[7]*i[10]+t[8]*i[15],e[6]=t[5]*i[1]+t[6]*i[6]+t[7]*i[11]+t[8]*i[16],e[7]=t[5]*i[2]+t[6]*i[7]+t[7]*i[12]+t[8]*i[17],e[8]=t[5]*i[3]+t[6]*i[8]+t[7]*i[13]+t[8]*i[18],e[9]=t[5]*i[4]+t[6]*i[9]+t[7]*i[14]+t[8]*i[19]+t[9],e[10]=t[10]*i[0]+t[11]*i[5]+t[12]*i[10]+t[13]*i[15],e[11]=t[10]*i[1]+t[11]*i[6]+t[12]*i[11]+t[13]*i[16],e[12]=t[10]*i[2]+t[11]*i[7]+t[12]*i[12]+t[13]*i[17],e[13]=t[10]*i[3]+t[11]*i[8]+t[12]*i[13]+t[13]*i[18],e[14]=t[10]*i[4]+t[11]*i[9]+t[12]*i[14]+t[13]*i[19]+t[14],e[15]=t[15]*i[0]+t[16]*i[5]+t[17]*i[10]+t[18]*i[15],e[16]=t[15]*i[1]+t[16]*i[6]+t[17]*i[11]+t[18]*i[16],e[17]=t[15]*i[2]+t[16]*i[7]+t[17]*i[12]+t[18]*i[17],e[18]=t[15]*i[3]+t[16]*i[8]+t[17]*i[13]+t[18]*i[18],e[19]=t[15]*i[4]+t[16]*i[9]+t[17]*i[14]+t[18]*i[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const i=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}tint(e,t){const[i,s,r]=R_.shared.setValue(e).toArray(),n=[i,0,0,0,0,0,s,0,0,0,0,0,r,0,0,0,0,0,1,0];this._loadMatrix(n,t)}greyscale(e,t){const i=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}blackAndWhite(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)}hue(e,t){e=(e||0)/180*Math.PI;const i=Math.cos(e),s=Math.sin(e),r=1/3,n=(0,Math.sqrt)(r),o=[i+(1-i)*r,r*(1-i)-n*s,r*(1-i)+n*s,0,0,r*(1-i)+n*s,i+r*(1-i),r*(1-i)-n*s,0,0,r*(1-i)-n*s,r*(1-i)+n*s,i+r*(1-i),0,0,0,0,0,1,0];this._loadMatrix(o,t)}contrast(e,t){const i=(e||0)+1,s=-.5*(i-1),r=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(r,t)}saturate(e=0,t){const i=2*e/3+1,s=-.5*(i-1),r=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(r,t)}desaturate(){this.saturate(-1)}negative(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)}sepia(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)}technicolor(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)}polaroid(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)}toBGR(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)}kodachrome(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)}browni(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)}vintage(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)}colorTone(e,t,i,s,r){e=e||.2,t=t||.15,i=i||16770432,s=s||3375104;const n=R_.shared,[o,a,h]=n.setValue(i).toArray(),[l,c,u]=n.setValue(s).toArray(),d=[.3,.59,.11,0,0,o,a,h,e,0,l,c,u,t,0,o-l,a-c,h-u,0,0];this._loadMatrix(d,r)}night(e,t){const i=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}predator(e,t){const i=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(i,t)}lsd(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}lm.prototype.grayscale=lm.prototype.greyscale;const cm={AlphaFilter:class extends _g{constructor(e=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}},BlurFilter:class extends _g{constructor(e=8,t=4,i=_g.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new hm(!0,e,t,i,s),this.blurYFilter=new hm(!1,e,t,i,s),this.resolution=i,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,i,s){const r=Math.abs(this.blurXFilter.strength),n=Math.abs(this.blurYFilter.strength);if(r&&n){const r=e.getFilterTexture();this.blurXFilter.apply(e,t,r,md.CLEAR),this.blurYFilter.apply(e,r,i,s),e.returnFilterTexture(r)}else n?this.blurYFilter.apply(e,t,i,s):this.blurXFilter.apply(e,t,i,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}},BlurFilterPass:hm,ColorMatrixFilter:lm,DisplacementFilter:class extends _g{constructor(e,t){const i=new Mp;e.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=i,null==t&&(t=20),this.scale=new Ap(t,t)}apply(e,t,i,s){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const r=this.maskSprite.worldTransform,n=Math.sqrt(r.a*r.a+r.b*r.b),o=Math.sqrt(r.c*r.c+r.d*r.d);0!==n&&0!==o&&(this.uniforms.rotation[0]=r.a/n,this.uniforms.rotation[1]=r.b/n,this.uniforms.rotation[2]=r.c/o,this.uniforms.rotation[3]=r.d/o),e.applyFilter(this,t,i,s)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}},FXAAFilter:class extends _g{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends _g{constructor(e=.5,t=Math.random()){super(Bf,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}};Object.entries(cm).forEach((([e,t])=>{Object.defineProperty(cm,e,{get:()=>(Xd("7.1.0",`filters.${e} has moved to ${e}`),t)})}));const um=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(Mf.system.add(this.tickerUpdate,this,Rf.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Mf.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class dm{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=dm.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ap,this.page=new Ap,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,i,s,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class _m extends dm{constructor(){super(...arguments),this.client=new Ap,this.movement=new Ap,this.offset=new Ap,this.global=new Ap,this.screen=new Ap}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,i,s,r,n,o,a,h,l,c,u,d,_,p){throw new Error("Method not implemented.")}}class pm extends _m{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class gm extends _m{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}gm.DOM_DELTA_PIXEL=0,gm.DOM_DELTA_LINE=1,gm.DOM_DELTA_PAGE=2;const fm=new Ap,mm=new Ap;class bm{constructor(e){this.dispatch=new zd,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort(((e,t)=>e.priority-t.priority))}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let i=0,s=t.length;i<s;i++)t[i].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){um.pauseUpdate=!0;const i=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,fm.set(e,t),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(e,t){if(!e.target)return;const i=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let s=0,r=i.length-1;s<r;s++)if(e.currentTarget=i[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(e.currentTarget=i[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,i=this._allInteractiveElements){if(0===i.length)return;e.eventPhase=e.BUBBLING_PHASE;const s=Array.isArray(t)?t:[t];for(let t=i.length-1;t>=0;t--)s.forEach((s=>{e.currentTarget=i[t],this.notifyTarget(e,s)}))}propagationPath(e){const t=[e];for(let i=0;i<2048&&e!==this.rootTarget;i++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,i,s,r,n=!1){let o=!1;if(this._interactivePrune(e))return null;if(("dynamic"===e.eventMode||"dynamic"===t)&&(um.pauseUpdate=!1),e.interactiveChildren&&e.children){const a=e.children;for(let h=a.length-1;h>=0;h--){const l=a[h],c=this.hitTestMoveRecursive(l,this._isInteractive(t)?t:l.eventMode,i,s,r,n||r(e,i));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const t=e.isInteractive();(c.length>0||t)&&(t&&this._allInteractiveElements.push(e),c.push(e)),0===this._hitElements.length&&(this._hitElements=c),o=!0}}}const a=this._isInteractive(t),h=e.isInteractive();return a&&h&&this._allInteractiveElements.push(e),n||this._hitElements.length>0?null:o?this._hitElements:a&&!r(e,i)&&s(e,i)?h?[e]:[]:null}hitTestRecursive(e,t,i,s,r){if(this._interactivePrune(e)||r(e,i))return null;if(("dynamic"===e.eventMode||"dynamic"===t)&&(um.pauseUpdate=!1),e.interactiveChildren&&e.children){const n=e.children;for(let o=n.length-1;o>=0;o--){const a=n[o],h=this.hitTestRecursive(a,this._isInteractive(t)?t:a.eventMode,i,s,r);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const t=e.isInteractive();return(h.length>0||t)&&h.push(e),h}}}const n=this._isInteractive(t),o=e.isInteractive();return n&&s(e,i)?o?[e]:[]:null}_isInteractive(e){return"static"===e||"dynamic"===e}_interactivePrune(e){return!(e&&!e.isMask&&e.visible&&e.renderable&&"none"!==e.eventMode&&("passive"!==e.eventMode||e.interactiveChildren)&&!e.isMask)}hitPruneFn(e,t){if(e.hitArea&&(e.worldTransform.applyInverse(t,mm),!e.hitArea.contains(mm.x,mm.y)))return!0;if(e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;if(i&&!i.containsPoint?.(t))return!0}return!1}hitTestFn(e,t){return"passive"!==e.eventMode&&(!!e.hitArea||!!e.containsPoint&&e.containsPoint(t))}notifyTarget(e,t){const i=`on${t=t??e.type}`;e.currentTarget[i]?.(e);const s=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,s),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof pm))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),"touch"===t.pointerType)this.dispatchEvent(t,"touchstart");else if("mouse"===t.pointerType||"pen"===t.pointerType){const e=2===t.button;this.dispatchEvent(t,e?"rightdown":"mousedown")}this.trackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){if(!(e instanceof pm))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const i="mouse"===t.pointerType||"pen"===t.pointerType,s=this.trackingData(e.pointerId),r=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&r!==t.target){const s="mousemove"===e.type?"mouseout":"pointerout",n=this.createPointerEvent(e,s,r);if(this.dispatchEvent(n,"pointerout"),i&&this.dispatchEvent(n,"mouseout"),!t.composedPath().includes(r)){const s=this.createPointerEvent(e,"pointerleave",r);for(s.eventPhase=s.AT_TARGET;s.target&&!t.composedPath().includes(s.target);)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;this.freeEvent(s)}this.freeEvent(n)}if(r!==t.target){const s="mousemove"===e.type?"mouseover":"pointerover",n=this.clonePointerEvent(t,s);this.dispatchEvent(n,"pointerover"),i&&this.dispatchEvent(n,"mouseover");let o=r?.parent;for(;o&&o!==this.rootTarget.parent&&o!==t.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const e=this.clonePointerEvent(t,"pointerenter");for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==r&&e.target!==this.rootTarget.parent;)e.currentTarget=e.target,this.notifyTarget(e),i&&this.notifyTarget(e,"mouseenter"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(n)}const n=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?n.push("pointermove"):this.dispatchEvent(t,"pointermove"),o&&n.push("globalpointermove"),"touch"===t.pointerType&&(this.moveOnAll?n.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),o&&n.push("globaltouchmove")),i&&(this.moveOnAll?n.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),o&&n.push("globalmousemove"),this.cursor=t.target?.cursor),n.length>0&&this.all(t,n),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){if(!(e instanceof pm))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId),i=this.createPointerEvent(e),s="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=i.target?.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),s&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;t.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(r)}mapPointerOut(e){if(!(e instanceof pm))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId);if(t.overTargets){const i="mouse"===e.pointerType||"pen"===e.pointerType,s=this.findMountedTarget(t.overTargets),r=this.createPointerEvent(e,"pointerout",s);this.dispatchEvent(r),i&&this.dispatchEvent(r,"mouseout");const n=this.createPointerEvent(e,"pointerleave",s);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;t.overTargets=null,this.freeEvent(r),this.freeEvent(n)}this.cursor=null}mapPointerUp(e){if(!(e instanceof pm))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=performance.now(),i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType)this.dispatchEvent(i,"touchend");else if("mouse"===i.pointerType||"pen"===i.pointerType){const e=2===i.button;this.dispatchEvent(i,e?"rightup":"mouseup")}const s=this.trackingData(e.pointerId),r=this.findMountedTarget(s.pressTargetsByButton[e.button]);let n=r;if(r&&!i.composedPath().includes(r)){let t=r;for(;t&&!i.composedPath().includes(t);){if(i.currentTarget=t,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType)this.notifyTarget(i,"touchendoutside");else if("mouse"===i.pointerType||"pen"===i.pointerType){const e=2===i.button;this.notifyTarget(i,e?"rightupoutside":"mouseupoutside")}t=t.parent}delete s.pressTargetsByButton[e.button],n=t}if(n){const r=this.clonePointerEvent(i,"click");r.target=n,r.path=null,s.clicksByButton[e.button]||(s.clicksByButton[e.button]={clickCount:0,target:r.target,timeStamp:t});const o=s.clicksByButton[e.button];if(o.target===r.target&&t-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=r.target,o.timeStamp=t,r.detail=o.clickCount,"mouse"===r.pointerType){const e=2===r.button;this.dispatchEvent(r,e?"rightclick":"click")}else"touch"===r.pointerType&&this.dispatchEvent(r,"tap");this.dispatchEvent(r,"pointertap"),this.freeEvent(r)}this.freeEvent(i)}mapPointerUpOutside(e){if(!(e instanceof pm))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId),i=this.findMountedTarget(t.pressTargetsByButton[e.button]),s=this.createPointerEvent(e);if(i){let r=i;for(;r;)s.currentTarget=r,this.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType?this.notifyTarget(s,"touchendoutside"):("mouse"===s.pointerType||"pen"===s.pointerType)&&this.notifyTarget(s,2===s.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(s)}mapWheel(e){if(!(e instanceof gm))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let i=1;i<e.length&&e[i].parent===t;i++)t=e[i];return t}createPointerEvent(e,t,i){const s=this.allocateEvent(pm);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=i??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],"string"==typeof t&&(s.type=t),s}createWheelEvent(e){const t=this.allocateEvent(gm);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const i=this.allocateEvent(pm);return i.nativeEvent=e.nativeEvent,i.originalEvent=e.originalEvent,this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.target=e.target,i.path=e.composedPath().slice(),i.type=t??i.type,i}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof pm&&t instanceof pm&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof _m&&t instanceof _m&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const i=e.currentTarget._events[t];if(i&&e.currentTarget.isInteractive())if("fn"in i)i.once&&e.currentTarget.removeListener(t,i.fn,void 0,!0),i.fn.call(i.context,e);else for(let s=0,r=i.length;s<r&&!e.propagationImmediatelyStopped;s++)i[s].once&&e.currentTarget.removeListener(t,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,e)}}const vm={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Tm=class e{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new bm(null),um.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new pm(null),this.rootWheelEvent=new gm(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...e.defaultEventFeatures},{set:(e,t,i)=>("globalMove"===t&&(this.rootBoundary.enableGlobalMoveEvents=i),e[t]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:i,resolution:s}=this.renderer;this.setTargetElement(i),this.resolution=s,e._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const i=this.cursorStyles[e];if(i)switch(typeof i){case"string":t&&(this.domElement.style.cursor=i);break;case"function":i(e);break;case"object":t&&Object.assign(this.domElement.style,i)}else t&&"string"==typeof e&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let e=0,i=t.length;e<i;e++){const i=t[e],s=this.bootstrapEvent(this.rootPointerEvent,i);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,um.pointerMoved();const t=this.normalizeToPointerData(e);for(let e=0,i=t.length;e<i;e++){const i=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const i=t!==this.domElement?"outside":"",s=this.normalizeToPointerData(e);for(let e=0,t=s.length;e<t;e++){const t=this.bootstrapEvent(this.rootPointerEvent,s[e]);t.type+=i,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let e=0,i=t.length;e<i;e++){const i=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,um.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;um.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;um.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,i){const s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},r=1/this.resolution;e.x=(t-s.left)*(this.domElement.width/s.width)*r,e.y=(i-s.top)*(this.domElement.height/s.height)*r}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let i=0,s=e.changedTouches.length;i<s;i++){const s=e.changedTouches[i];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=1===e.touches.length&&"touchstart"===e.type),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=e.type,t.push(s)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&!(this.supportsPointerEvents&&e instanceof globalThis.PointerEvent)){const i=e;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=1),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,t.push(i)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=vm[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};Tm.extension={name:"events",type:[Q_.RendererSystem,Q_.CanvasRendererSystem]},Tm.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let ym=Tm;function xm(e){return"dynamic"===e||"static"===e}j_.add(ym);const Am={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??xm(ym.defaultEventMode)},set interactive(e){Xd("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=e,this.eventMode=e?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??ym.defaultEventMode},set eventMode(e){this._internalInteractive=xm(e),this._internalEventMode=e},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(e,t,i){const s="boolean"==typeof i&&i||"object"==typeof i&&i.capture,r="object"==typeof i?i.signal:void 0,n="object"==typeof i&&!0===i.once,o="function"==typeof t?void 0:t;e=s?`${e}capture`:e;const a="function"==typeof t?t:t.handleEvent,h=this;r&&r.addEventListener("abort",(()=>{h.off(e,a,o)})),n?h.once(e,a,o):h.on(e,a,o)},removeEventListener(e,t,i){const s="function"==typeof t?void 0:t;e="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${e}capture`:e,t="function"==typeof t?t:t.handleEvent,this.off(e,t,s)},dispatchEvent(e){if(!(e instanceof dm))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};Yf.mixin(Am),Yf.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Cm{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Gd.tablet||Gd.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex=2..toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let e=0;e<t.length;e++)this.updateAccessibleObjects(t[e])}update(){const e=performance.now();if(Gd.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:i,width:s,height:r}=this.renderer.view.getBoundingClientRect(),{width:n,height:o,resolution:a}=this.renderer,h=s/n*a,l=r/o*a;let c=this.div;c.style.left=`${t}px`,c.style.top=`${i}px`,c.style.width=`${n}px`,c.style.height=`${o}px`;for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.renderId!==this.renderId)t._accessibleActive=!1,D_(this.children,e,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,e--;else{c=t._accessibleDiv;let e=t.hitArea;const i=t.worldTransform;t.hitArea?(c.style.left=(i.tx+e.x*i.a)*h+"px",c.style.top=(i.ty+e.y*i.d)*l+"px",c.style.width=e.width*i.a*h+"px",c.style.height=e.height*i.d*l+"px"):(e=t.getBounds(),this.capHitArea(e),c.style.left=e.x*h+"px",c.style.top=e.y*l+"px",c.style.width=e.width*h+"px",c.style.height=e.height*l+"px",c.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(c.title=t.accessibleTitle),c.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&c.setAttribute("aria-label",t.accessibleHint)),(t.accessibleTitle!==c.title||t.tabIndex!==c.tabIndex)&&(c.title=t.accessibleTitle,c.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:i}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>i&&(e.height=i-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2..toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:(!e.accessibleHint||null===e.accessibleHint)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:i}=e.target,s=this.renderer.events.rootBoundary,r=Object.assign(new dm(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,t.forEach((e=>s.dispatchEvent(r,e)))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){9===e.keyCode&&this.activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Cm.extension={name:"accessibility",type:[Q_.RendererPlugin,Q_.CanvasRendererPlugin]},j_.add(Cm);const Sm=class e{constructor(t){this.stage=new em,t=Object.assign({forceCanvas:!1},t),this.renderer=function(e){for(const t of Of)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}(t),e._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,i){const s=e._plugins.slice(0);s.reverse(),s.forEach((e=>{e.destroy.call(this)})),this.stage.destroy(i),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Sm._plugins=[];let Em=Sm;j_.handleByList(Q_.Application,Em._plugins);class Rm{static init(e){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,t;if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,t=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:s}=this._resizeTo;e=i,t=s}this.renderer.resize(e,t),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Rm.extension=Q_.Application,j_.add(Rm);const Pm={loader:Q_.LoadParser,resolver:Q_.ResolveParser,cache:Q_.CacheParser,detection:Q_.DetectionParser};j_.handle(Q_.Asset,(e=>{const t=e.ref;Object.entries(Pm).filter((([e])=>!!t[e])).forEach((([e,i])=>j_.add(Object.assign(t[e],{extension:t[e].extension??i}))))}),(e=>{const t=e.ref;Object.keys(Pm).filter((e=>!!t[e])).forEach((e=>j_.remove(t[e])))}));class Im{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach((e=>{this._assetList.push(e)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<t;i++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function Mm(e,t){const i=e.split("?")[0],s=Kd.extname(i).toLowerCase();return Array.isArray(t)?t.includes(s):s===t}const wm=(e,t,i=!1)=>(Array.isArray(e)||(e=[e]),t?e.map((e=>"string"==typeof e||i?t(e):e)):e),Om=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const i=wm(e);let s;for(let e=0;e<this.parsers.length;e++){const r=this.parsers[e];if(r.test(t)){s=r.getCacheableAssets(i,t);break}}s||(s={},i.forEach((e=>{s[e]=t})));const r=Object.keys(s),n={cacheKeys:r,keys:i};if(i.forEach((e=>{this._cacheMap.set(e,n)})),r.forEach((e=>{this._cache.has(e)&&this._cache.get(e)!==t&&console.warn("[Cache] already has key:",e),this._cache.set(e,s[e])})),t instanceof Sg){const e=t;i.forEach((t=>{e.baseTexture!==Sg.EMPTY.baseTexture&&hp.addToCache(e.baseTexture,t),Sg.addToCache(e,t)}))}}remove(e){if(!this._cacheMap.has(e))return void console.warn(`[Assets] Asset id ${e} was not found in the Cache`);const t=this._cacheMap.get(e);t.cacheKeys.forEach((e=>{this._cache.delete(e)})),t.keys.forEach((e=>{this._cacheMap.delete(e)}))}get parsers(){return this._parsers}},Bm=e=>!Array.isArray(e);class Dm{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,i)=>(this._parsersValidated=!1,e[t]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const i={promise:null,parser:null};return i.promise=(async()=>{let s=null,r=null;if(t.loadParser&&(r=this._parserHash[t.loadParser],r||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!r){for(let i=0;i<this.parsers.length;i++){const s=this.parsers[i];if(s.load&&s.test?.(e,t,this)){r=s;break}}if(!r)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await r.load(e,t,this),i.parser=r;for(let e=0;e<this.parsers.length;e++){const r=this.parsers[e];r.parse&&r.parse&&await(r.testParse?.(s,t,this))&&(s=await r.parse(s,t,this)||s,i.parser=r)}return s})(),i}async load(e,t){this._parsersValidated||this._validateParsers();let i=0;const s={},r=Bm(e),n=wm(e,(e=>({alias:[e],src:e}))),o=n.length,a=n.map((async e=>{const r=Kd.toAbsolute(e.src);if(!s[e.src])try{this.promiseCache[r]||(this.promiseCache[r]=this._getLoadPromiseAndParser(r,e)),s[e.src]=await this.promiseCache[r].promise,t&&t(++i/o)}catch(t){throw delete this.promiseCache[r],delete s[e.src],new Error(`[Loader.load] Failed to load ${r}.\n${t}`)}}));return await Promise.all(a),r?s[n[0].src]:s}async unload(e){const t=wm(e,(e=>({alias:[e],src:e}))).map((async e=>{const t=Kd.toAbsolute(e.src),i=this.promiseCache[t];if(i){const s=await i.promise;delete this.promiseCache[t],i.parser?.unload?.(s,e,this)}}));await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((e=>e.name)).reduce(((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t})),{})}}var Fm=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(Fm||{});function Lm(e,t){if(Array.isArray(t)){for(const i of t)if(e.startsWith(`data:${i}`))return!0;return!1}return e.startsWith(`data:${t}`)}const Nm={extension:{type:Q_.LoadParser,priority:Fm.Low},name:"loadJson",test:e=>Lm(e,"application/json")||Mm(e,".json"),load:async e=>await(await Ad.ADAPTER.fetch(e)).json()};j_.add(Nm);const km={name:"loadTxt",extension:{type:Q_.LoadParser,priority:Fm.Low},test:e=>Lm(e,"text/plain")||Mm(e,".txt"),load:async e=>await(await Ad.ADAPTER.fetch(e)).text()};j_.add(km);const Um=["normal","bold","100","200","300","400","500","600","700","800","900"],Vm=[".ttf",".otf",".woff",".woff2"],Gm=["font/ttf","font/otf","font/woff","font/woff2"],zm=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i,Hm=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/,Wm={extension:{type:Q_.LoadParser,priority:Fm.Low},name:"loadWebFont",test:e=>Lm(e,Gm)||Mm(e,Vm),async load(e,t){const i=Ad.ADAPTER.getFontFaceSet();if(i){const r=[],n=t.data?.family??function(e){const t=Kd.extname(e),i=Kd.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1)));let s=i.length>0;for(const e of i)if(!e.match(zm)){s=!1;break}let r=i.join(" ");return s||(r=`"${r.replace(/[\\"]/g,"\\$&")}"`),r}(e),o=t.data?.weights?.filter((e=>Um.includes(e)))??["normal"],a=t.data??{};for(let t=0;t<o.length;t++){const h=o[t],l=new FontFace(n,`url(${s=e,Hm.test(s)?s:encodeURI(s)})`,{...a,weight:h});await l.load(),i.add(l),r.push(l)}return 1===r.length?r[0]:r}var s;return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach((e=>Ad.ADAPTER.getFontFaceSet().delete(e)))}};j_.add(Wm);let Xm=null;class qm{constructor(){Xm||(Xm=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n  async function checkImageBitmap() {\n    try {\n      if (typeof createImageBitmap != "function")\n        return !1;\n      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap.width === 1 && imageBitmap.height === 1;\n    } catch {\n      return !1;\n    }\n  }\n  checkImageBitmap().then((result) => {\n    self.postMessage(result);\n  });\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(Xm)}}qm.revokeObjectURL=function(){Xm&&(URL.revokeObjectURL(Xm),Xm=null)};let Qm=null;class Km{constructor(){Qm||(Qm=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  async function loadImageBitmap(url) {\n    const response = await fetch(url);\n    if (!response.ok)\n      throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n    const imageBlob = await response.blob();\n    return await createImageBitmap(imageBlob);\n  }\n  self.onmessage = async (event) => {\n    try {\n      const imageBitmap = await loadImageBitmap(event.data.data[0]);\n      self.postMessage({\n        data: imageBitmap,\n        uuid: event.data.uuid,\n        id: event.data.id\n      }, [imageBitmap]);\n    } catch (e) {\n      self.postMessage({\n        error: e,\n        uuid: event.data.uuid,\n        id: event.data.id\n      });\n    }\n  };\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(Qm)}}Km.revokeObjectURL=function(){Qm&&(URL.revokeObjectURL(Qm),Qm=null)};let Ym,jm=0;const Zm=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((e=>{const{worker:t}=new qm;t.addEventListener("message",(i=>{t.terminate(),qm.revokeObjectURL(),e(i.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Ym&&(Ym=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<Ym&&(this._createdWorkers++,e=(new Km).worker,e.addEventListener("message",(e=>{this.complete(e.data),this.returnWorker(e.target),this.next()}))),e}returnWorker(e){this.workerPool.push(e)}complete(e){void 0!==e.error?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const i=new Promise(((i,s)=>{this.queue.push({id:e,arguments:t,resolve:i,reject:s})}));return this.next(),i}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),i=t.id;this.resolveHash[jm]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:jm++,id:i})}};function $m(e,t,i){e.resource.internal=!0;const s=new Sg(e),r=()=>{delete t.promiseCache[i],Om.has(i)&&Om.remove(i)};return s.baseTexture.once("destroyed",(()=>{i in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),r())})),s.once("destroyed",(()=>{e.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())})),s}const Jm=[".jpeg",".jpg",".png",".webp",".avif"],eb=["image/jpeg","image/png","image/webp","image/avif"],tb={name:"loadTextures",extension:{type:Q_.LoadParser,priority:Fm.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:e=>Lm(e,eb)||Mm(e,Jm),async load(e,t,i){const s=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let r;r=s?this.config.preferWorkers&&await Zm.isImageBitmapSupported()?await Zm.loadImageBitmap(e):await async function(e){const t=await Ad.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const i=await t.blob();return await createImageBitmap(i)}(e):await new Promise(((t,i)=>{const s=new Image;s.crossOrigin=this.config.crossOrigin,s.src=e,s.complete?t(s):(s.onload=()=>t(s),s.onerror=e=>i(e))}));const n={...t.data};n.resolution??(n.resolution=q_(e)),s&&void 0===n.resourceOptions?.ownsImageBitmap&&(n.resourceOptions={...n.resourceOptions},n.resourceOptions.ownsImageBitmap=!0);const o=new hp(r,n);return o.resource.src=e,$m(o,i,e)},unload(e){e.destroy(!0)}};j_.add(tb);const ib={extension:{type:Q_.LoadParser,priority:Fm.High},name:"loadSVG",test:e=>Lm(e,"image/svg+xml")||Mm(e,".svg"),testParse:async e=>Xf.test(e),async parse(e,t,i){const s=new Xf(e,t?.data?.resourceOptions);await s.load();const r=new hp(s,{resolution:q_(e),...t?.data});return r.resource.src=t.src,$m(r,i,t.src)},load:async(e,t)=>(await Ad.ADAPTER.fetch(e)).text(),unload:tb.unload};j_.add(ib);const sb=[".mp4",".m4v",".webm",".ogv"],rb=["video/mp4","video/webm","video/ogg"],nb={name:"loadVideo",extension:{type:Q_.LoadParser,priority:Fm.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:e=>Lm(e,rb)||Mm(e,sb),async load(e,t,i){let s;const r=await(await Ad.ADAPTER.fetch(e)).blob(),n=URL.createObjectURL(r);try{const r={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...t?.data?.resourceOptions,autoLoad:!0},o=new Qf(n,r);await o.load();const a=new hp(o,{alphaMode:await Zd(),resolution:q_(e),...t?.data});a.resource.src=e,s=$m(a,i,e),s.baseTexture.once("destroyed",(()=>{URL.revokeObjectURL(n)}))}catch(e){throw URL.revokeObjectURL(n),e}return s},unload(e){e.destroy(!0)}};function ob(e,t,i,s,r){const n=t[i];for(let o=0;o<n.length;o++){const a=n[o];i<t.length-1?ob(e.replace(s[i],a),t,i+1,s,r):r.push(e.replace(s[i],a))}}function ab(e){const t=e.match(/\{(.*?)\}/g),i=[];if(t){const s=[];t.forEach((e=>{const t=e.substring(1,e.length-1).split(",");s.push(t)})),ob(e,s,0,t,i)}else i.push(e);return i}j_.add(nb);class hb{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach((e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))})),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if("string"==typeof e)this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&")}}getAlias(e){const{alias:t,name:i,src:s,srcs:r}=e;return wm(t||i||s||r,(e=>"string"==typeof e?e:Array.isArray(e)?e.map((e=>e?.src??e?.srcs??e)):e?.src||e?.srcs?e.src??e.srcs:e),!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach((e=>{this.addBundle(e.name,e.assets)}))}addBundle(e,t){const i=[];Array.isArray(t)?t.forEach((t=>{const s=t.src??t.srcs,r=t.alias??t.name;let n;if("string"==typeof r){const t=this._createBundleAssetId(e,r);i.push(t),n=[r,t]}else{const t=r.map((t=>this._createBundleAssetId(e,t)));i.push(...t),n=[...r,...t]}this.add({...t,alias:n,src:s})})):Object.keys(t).forEach((s=>{const r=[s,this._createBundleAssetId(e,s)];if("string"==typeof t[s])this.add({alias:r,src:t[s]});else if(Array.isArray(t[s]))this.add({alias:r,src:t[s]});else{const e=t[s],i=e.src??e.srcs;this.add({...e,alias:r,src:Array.isArray(i)?i:[i]})}i.push(...r)})),this._bundles[e]=i}add(e,t,i,s,r){const n=[];let o;"string"==typeof e||Array.isArray(e)&&"string"==typeof e[0]?(Xd("7.2.0","Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead."),n.push({alias:e,src:t,data:i,format:s,loadParser:r})):Array.isArray(e)?n.push(...e):n.push(e),o=e=>{this.hasKey(e)&&console.warn(`[Resolver] already has key: ${e} overwriting`)},wm(n).forEach((e=>{const{src:t,srcs:i}=e;let{data:s,format:r,loadParser:n}=e;const a=wm(t||i).map((e=>"string"==typeof e?ab(e):Array.isArray(e)?e:[e])),h=this.getAlias(e);Array.isArray(h)?h.forEach(o):o(h);const l=[];a.forEach((e=>{e.forEach((e=>{let t={};if("object"!=typeof e){t.src=e;for(let i=0;i<this._parsers.length;i++){const s=this._parsers[i];if(s.test(e)){t=s.parse(e);break}}}else s=e.data??s,r=e.format??r,n=e.loadParser??n,t={...t,...e};if(!h)throw new Error(`[Resolver] alias is undefined for this asset: ${t.src}`);t=this.buildResolvedAsset(t,{aliases:h,data:s,format:r,loadParser:n}),l.push(t)}))})),h.forEach((e=>{this._assetMap[e]=l}))}))}resolveBundle(e){const t=Bm(e);e=wm(e);const i={};return e.forEach((e=>{const t=this._bundles[e];if(t){const s=this.resolve(t),r={};for(const t in s){const i=s[t];r[this._extractAssetIdFromBundle(e,t)]=i}i[e]=r}})),t?i[e[0]]:i}resolveUrl(e){const t=this.resolve(e);if("string"!=typeof e){const e={};for(const i in t)e[i]=t[i].src;return e}return t.src}resolve(e){const t=Bm(e);e=wm(e);const i={};return e.forEach((e=>{if(!this._resolverHash[e])if(this._assetMap[e]){let t=this._assetMap[e];const i=t[0],s=this._getPreferredOrder(t);s?.priority.forEach((e=>{s.params[e].forEach((i=>{const s=t.filter((t=>!!t[e]&&t[e]===i));s.length&&(t=s)}))})),this._resolverHash[e]=t[0]??i}else this._resolverHash[e]=this.buildResolvedAsset({alias:[e],src:e},{});i[e]=this._resolverHash[e]})),t?i[e[0]]:i}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const t=e[0],i=this._preferredOrder.find((e=>e.params.format.includes(t.format)));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(e){return this._defaultSearchParams?`${e}${/\?/.test(e)?"&":"?"}${this._defaultSearchParams}`:e}buildResolvedAsset(e,t){const{aliases:i,data:s,loadParser:r,format:n}=t;return(this._basePath||this._rootPath)&&(e.src=Kd.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=i??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...s||{},...e.data},e.loadParser=r??e.loadParser,e.format=n??e.format??Kd.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}const lb=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new hb,this.loader=new Dm,this.cache=Om,this._backgroundLoader=new Im(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let t=e.manifest;"string"==typeof t&&(t=await this.load(t)),this.resolver.addManifest(t)}const t=e.texturePreference?.resolution??1,i="number"==typeof t?[t]:t,s=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:i}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,i,s,r){this.resolver.add(e,t,i,s,r)}async load(e,t){this._initialized||await this.init();const i=Bm(e),s=wm(e).map((e=>{if("string"!=typeof e){const t=this.resolver.getAlias(e);return t.some((e=>!this.resolver.hasKey(e)))&&this.add(e),Array.isArray(t)?t[0]:t}return this.resolver.hasKey(e)||this.add({alias:e,src:e}),e})),r=this.resolver.resolve(s),n=await this._mapLoadToResolve(r,t);return i?n[s[0]]:n}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let i=!1;"string"==typeof e&&(i=!0,e=[e]);const s=this.resolver.resolveBundle(e),r={},n=Object.keys(s);let o=0,a=0;const h=()=>{t?.(++o/a)},l=n.map((e=>{const t=s[e];return a+=Object.keys(t).length,this._mapLoadToResolve(t,h).then((t=>{r[e]=t}))}));return await Promise.all(l),i?r[e[0]]:r}async backgroundLoad(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach((e=>{this._backgroundLoader.add(Object.values(e))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if("string"==typeof e)return Om.get(e);const t={};for(let i=0;i<e.length;i++)t[i]=Om.get(e[i]);return t}async _mapLoadToResolve(e,t){const i=Object.values(e),s=Object.keys(e);this._backgroundLoader.active=!1;const r=await this.loader.load(i,t);this._backgroundLoader.active=!0;const n={};return i.forEach(((e,t)=>{const i=r[e.src],o=[e.src];e.alias&&o.push(...e.alias),n[s[t]]=i,Om.set(o,i)})),n}async unload(e){this._initialized||await this.init();const t=wm(e).map((e=>"string"!=typeof e?e.src:e)),i=this.resolver.resolve(t);await this._unloadFromResolved(i)}async unloadBundle(e){this._initialized||await this.init(),e=wm(e);const t=this.resolver.resolveBundle(e),i=Object.keys(t).map((e=>this._unloadFromResolved(t[e])));await Promise.all(i)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach((e=>{Om.remove(e.src)})),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const i of e.detections)e.skipDetections||await i.test()?t=await i.add(t):e.skipDetections||(t=await i.remove(t));return t=t.filter(((e,i)=>t.indexOf(e)===i)),t}get detections(){return this._detections}get preferWorkers(){return tb.config.preferWorkers}set preferWorkers(e){Xd("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach((t=>{t.config&&Object.keys(t.config).filter((t=>t in e)).forEach((i=>{t.config[i]=e[i]}))}))}};j_.handleByList(Q_.LoadParser,lb.loader.parsers).handleByList(Q_.ResolveParser,lb.resolver.parsers).handleByList(Q_.CacheParser,lb.cache.parsers).handleByList(Q_.DetectionParser,lb.detections);const cb={extension:Q_.CacheParser,test:e=>Array.isArray(e)&&e.every((e=>e instanceof Sg)),getCacheableAssets:(e,t)=>{const i={};return e.forEach((e=>{t.forEach(((t,s)=>{i[e+(0===s?"":s+1)]=t}))})),i}};async function ub(e){if("Image"in globalThis)return new Promise((t=>{const i=new Image;i.onload=()=>{t(!0)},i.onerror=()=>{t(!1)},i.src=e}));if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(e)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}j_.add(cb);const db={extension:{type:Q_.DetectionParser,priority:1},test:async()=>ub("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async e=>[...e,"avif"],remove:async e=>e.filter((e=>"avif"!==e))};j_.add(db);const _b={extension:{type:Q_.DetectionParser,priority:0},test:async()=>ub("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async e=>[...e,"webp"],remove:async e=>e.filter((e=>"webp"!==e))};j_.add(_b);const pb=["png","jpg","jpeg"],gb={extension:{type:Q_.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...pb],remove:async e=>e.filter((e=>!pb.includes(e)))};j_.add(gb);const fb="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function mb(e){return!fb&&""!==document.createElement("video").canPlayType(e)}const bb={extension:{type:Q_.DetectionParser,priority:0},test:async()=>mb("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter((e=>"webm"!==e))};j_.add(bb);const vb={extension:{type:Q_.DetectionParser,priority:0},test:async()=>mb("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter((e=>"mp4"!==e&&"m4v"!==e))};j_.add(vb);const Tb={extension:{type:Q_.DetectionParser,priority:0},test:async()=>mb("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter((e=>"ogv"!==e))};j_.add(Tb);const yb={extension:Q_.ResolveParser,test:tb.test,parse:e=>({resolution:parseFloat(Ad.RETINA_PREFIX.exec(e)?.[1]??"1"),format:Kd.extname(e).slice(1),src:e})};j_.add(yb);const xb=(e,t)=>{const i=t.split("?")[1];return i&&(e+=`?${i}`),e};var Ab=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e))(Ab||{});const Cb={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Sb,Eb;function Rb(){Eb={bptc:Sb.getExtension("EXT_texture_compression_bptc"),astc:Sb.getExtension("WEBGL_compressed_texture_astc"),etc:Sb.getExtension("WEBGL_compressed_texture_etc"),s3tc:Sb.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Sb.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Sb.getExtension("WEBGL_compressed_texture_pvrtc")||Sb.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Sb.getExtension("WEBGL_compressed_texture_etc1"),atc:Sb.getExtension("WEBGL_compressed_texture_atc")}}const Pb={extension:{type:Q_.DetectionParser,priority:2},test:async()=>{const e=Ad.ADAPTER.createCanvas().getContext("webgl");return e?(Sb=e,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{Eb||Rb();const t=[];for(const e in Eb)Eb[e]&&t.push(e);return[...t,...e]},remove:async e=>(Eb||Rb(),e.filter((e=>!(e in Eb))))};j_.add(Pb);class Ib extends np{constructor(e,t={width:1,height:1,autoLoad:!0}){let i,s;"string"==typeof e?(i=e,s=new Uint8Array):(i=null,s=e),super(s,t),this.origin=i,this.buffer=s?new Z_(s):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==t.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load||(this._load=fetch(this.origin).then((e=>e.blob())).then((e=>e.arrayBuffer())).then((e=>(this.data=new Uint32Array(e),this.buffer=new Z_(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)))),this._load}}class Mb extends Ib{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=Mb._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||Mb._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,i){const s=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let e=0,t=this.levels;e<t;e++){const{levelID:t,levelWidth:i,levelHeight:r,levelBuffer:n}=this._levelBuffers[e];s.compressedTexImage2D(s.TEXTURE_2D,t,this.format,i,r,0,n)}return!0}onBlobLoaded(){this._levelBuffers=Mb._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(36196===e)return"etc1";if(35986===e||35987===e||34798===e)return"atc";if(e>=36492&&e<=36495)return"bptc";if(37808===e)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,i,s,r,n,o){const a=new Array(i);let h=e.byteOffset,l=n,c=o,u=l+s-1&~(s-1),d=c+r-1&~(r-1),_=u*d*Cb[t];for(let n=0;n<i;n++)a[n]={levelID:n,levelWidth:i>1?l:u,levelHeight:i>1?c:d,levelBuffer:new Uint8Array(e.buffer,h,_)},h+=_,l=l>>1||1,c=c>>1||1,u=l+s-1&~(s-1),d=c+r-1&~(r-1),_=u*d*Cb[t];return a}}const wb=827611204,Ob=861165636,Bb=894720068,Db={[wb]:Ab.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Ob]:Ab.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Bb]:Ab.COMPRESSED_RGBA_S3TC_DXT5_EXT},Fb={70:Ab.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Ab.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Ab.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Ab.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Ab.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Ab.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Ab.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Ab.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Ab.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Ab.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Ab.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Ab.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Ab.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT},Lb=[171,75,84,88,32,49,49,187,13,10,26,10],Nb={[ud.UNSIGNED_BYTE]:1,[ud.UNSIGNED_SHORT]:2,[ud.INT]:4,[ud.UNSIGNED_INT]:4,[ud.FLOAT]:4,[ud.HALF_FLOAT]:8},kb={[ld.RGBA]:4,[ld.RGB]:3,[ld.RG]:2,[ld.RED]:1,[ld.LUMINANCE]:1,[ld.LUMINANCE_ALPHA]:2,[ld.ALPHA]:1},Ub={[ud.UNSIGNED_SHORT_4_4_4_4]:2,[ud.UNSIGNED_SHORT_5_5_5_1]:2,[ud.UNSIGNED_SHORT_5_6_5]:2};function Vb(e){switch(e){case ld.RGBA:return ld.RGBA_INTEGER;case ld.RGB:return ld.RGB_INTEGER;case ld.RG:return ld.RG_INTEGER;case ld.RED:return ld.RED_INTEGER;default:return e}}const Gb={extension:{type:Q_.LoadParser,priority:Fm.High},name:"loadDDS",test:e=>Mm(e,".dds"),async load(e,t,i){const s=function(e){const t=new Uint32Array(e);if(542327876!==t[0])throw new Error("Invalid DDS file magic word");const i=new Uint32Array(e,0,124/Uint32Array.BYTES_PER_ELEMENT),s=i[3],r=i[4],n=i[7],o=new Uint32Array(e,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const i=o[2];if(808540228!==i){const t=Db[i],o=new Uint8Array(e,128);return[new Mb(o,{format:t,width:r,height:s,levels:n})]}const a=128,h=new Uint32Array(t.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),l=h[0],c=h[1],u=h[2],d=h[3],_=Fb[l];if(void 0===_)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,g=148;if(1===d)p.push(new Uint8Array(e,g));else{const t=Cb[_];let i=0,o=r,a=s;for(let e=0;e<n;e++)i+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*t,o>>>=1,a>>>=1;let h=g;for(let t=0;t<d;t++)p.push(new Uint8Array(e,h,i)),h+=i}return p.map((e=>new Mb(e,{format:_,width:r,height:s,levels:n})))}throw 64&a?new Error("DDSParser does not support uncompressed texture data."):512&a?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&a?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&a?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await(await Ad.ADAPTER.fetch(e)).arrayBuffer()).map((s=>$m(new hp(s,{mipmap:gd.OFF,alphaMode:fd.NO_PREMULTIPLIED_ALPHA,resolution:q_(e),...t.data}),i,e)));return 1===s.length?s[0]:s},unload(e){Array.isArray(e)?e.forEach((e=>e.destroy(!0))):e.destroy(!0)}};j_.add(Gb);const zb={extension:{type:Q_.LoadParser,priority:Fm.High},name:"loadKTX",test:e=>Mm(e,".ktx"),async load(e,t,i){const s=await(await Ad.ADAPTER.fetch(e)).arrayBuffer(),{compressed:r,uncompressed:n,kvData:o}=function(e,t,i=!1){const s=new DataView(t);if(!function(e,t){for(let i=0;i<Lb.length;i++)if(t.getUint8(i)!==Lb[i])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}(e,s))return null;const r=67305985===s.getUint32(12,!0),n=s.getUint32(16,r),o=s.getUint32(24,r),a=s.getUint32(28,r),h=s.getUint32(36,r),l=s.getUint32(40,r)||1,c=s.getUint32(44,r)||1,u=s.getUint32(48,r)||1,d=s.getUint32(52,r),_=s.getUint32(56,r),p=s.getUint32(60,r);if(0===l||1!==c)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const g=h+3&-4,f=l+3&-4,m=new Array(u);let b,v=h*l;if(0===n&&(v=g*f),b=0!==n?Nb[n]?Nb[n]*kb[o]:Ub[n]:Cb[a],void 0===b)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const T=i?function(e,t,i){const s=new Map;let r=0;for(;r<t;){const n=e.getUint32(64+r,i),o=64+r+4,a=3-(n+3)%4;if(0===n||n>t-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<n&&0!==e.getUint8(o+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(e.buffer,o,h)),c=new DataView(e.buffer,o+h+1,n-h-1);s.set(l,c),r+=4+n+a}return s}(s,p,r):null;let y=v*b,x=h,A=l,C=g,S=f,E=64+p;for(let e=0;e<_;e++){const i=s.getUint32(E,r);let o=E+4;for(let i=0;i<u;i++){let s=m[i];s||(s=m[i]=new Array(_)),s[e]={levelID:e,levelWidth:_>1||0!==n?x:C,levelHeight:_>1||0!==n?A:S,levelBuffer:new Uint8Array(t,o,y)},o+=y}E+=i+4,E=E%4!=0?E+4-E%4:E,x=x>>1||1,A=A>>1||1,C=x+4-1&-4,S=A+4-1&-4,y=C*S*b}return 0!==n?{uncompressed:m.map((e=>{let t=e[0].levelBuffer,i=!1;return n===ud.FLOAT?t=new Float32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4):n===ud.UNSIGNED_INT?(i=!0,t=new Uint32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)):n===ud.INT&&(i=!0,t=new Int32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)),{resource:new np(t,{width:e[0].levelWidth,height:e[0].levelHeight}),type:n,format:i?Vb(o):o}})),kvData:T}:{compressed:m.map((e=>new Mb(null,{format:a,width:h,height:l,levels:_,levelBuffers:e}))),kvData:T}}(e,s),a=r??n,h={mipmap:gd.OFF,alphaMode:fd.NO_PREMULTIPLIED_ALPHA,resolution:q_(e),...t.data},l=a.map((t=>{a===n&&Object.assign(h,{type:t.type,format:t.format});const s=t.resource??t,r=new hp(s,h);return r.ktxKeyValueData=o,$m(r,i,e)}));return 1===l.length?l[0]:l},unload(e){Array.isArray(e)?e.forEach((e=>e.destroy(!0))):e.destroy(!0)}};j_.add(zb);const Hb=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],Wb={extension:Q_.ResolveParser,test:e=>{const t=Kd.extname(e).slice(1);return["basis","ktx","dds"].includes(t)},parse:e=>{const t=e.split("."),i=t.pop();if(["ktx","dds"].includes(i)){const i=t.pop();if(Hb.includes(i))return{resolution:parseFloat(Ad.RETINA_PREFIX.exec(e)?.[1]??"1"),format:i,src:e}}return{resolution:parseFloat(Ad.RETINA_PREFIX.exec(e)?.[1]??"1"),format:i,src:e}}};j_.add(Wb);const Xb=new Sp,qb=class e{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,t,i,s){const r=new Image;return r.src=await this.base64(e,t,i,s),r}async base64(e,t,i,s){const r=this.canvas(e,s);if(void 0!==r.toBlob)return new Promise(((e,s)=>{r.toBlob((t=>{if(!t)return void s(new Error("ICanvas.toBlob failed!"));const i=new FileReader;i.onload=()=>e(i.result),i.onerror=s,i.readAsDataURL(t)}),t,i)}));if(void 0!==r.toDataURL)return r.toDataURL(t,i);if(void 0!==r.convertToBlob){const e=await r.convertToBlob({type:t,quality:i});return new Promise(((t,i)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=i,s.readAsDataURL(e)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,i){const{pixels:s,width:r,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,i);o&&e._flipY(s,r,n),a&&e._unpremultiplyAlpha(s);const h=new H_(r,n,1),l=new ImageData(new Uint8ClampedArray(s.buffer),r,n);return h.context.putImageData(l,0,0),h.canvas}pixels(t,i){const{pixels:s,width:r,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,i);return o&&e._flipY(s,r,n),a&&e._unpremultiplyAlpha(s),s}_rawPixels(e,t){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let s,r,n=!1,o=!1,a=!1;e&&(e instanceof Eg?r=e:(r=i.generateTexture(e,{region:t,resolution:i.resolution,multisample:i.multisample}),a=!0,t&&(Xb.width=t.width,Xb.height=t.height,t=Xb)));const h=i.gl;if(r){if(s=r.baseTexture.resolution,t=t??r.frame,n=!1,o=r.baseTexture.alphaMode>0&&r.baseTexture.format===ld.RGBA,!a){i.renderTexture.bind(r);const e=r.framebuffer.glFramebuffers[i.CONTEXT_UID];e.blitFramebuffer&&i.framebuffer.bind(e.blitFramebuffer)}}else s=i.resolution,t||((t=Xb).width=i.width/s,t.height=i.height/s),n=!0,o=this._rendererPremultipliedAlpha,i.renderTexture.bind();const l=Math.max(Math.round(t.width*s),1),c=Math.max(Math.round(t.height*s),1),u=new Uint8Array(4*l*c);return h.readPixels(Math.round(t.x*s),Math.round(t.y*s),l,c,h.RGBA,h.UNSIGNED_BYTE,u),a&&r?.destroy(!0),{pixels:u,width:l,height:c,flipY:n,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(e,t,i){const s=t<<2,r=i>>1,n=new Uint8Array(s);for(let t=0;t<r;t++){const r=t*s,o=(i-t-1)*s;n.set(e.subarray(r,r+s)),e.copyWithin(r,o,o+s),e.set(n,o)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let i=0;i<t;i+=4){const t=e[i+3];if(0!==t){const s=255.001/t;e[i]=e[i]*s+.5,e[i+1]=e[i+1]*s+.5,e[i+2]=e[i+2]*s+.5}}}};qb.extension={name:"extract",type:Q_.RendererSystem};let Qb=qb;j_.add(Qb);const Kb={build(e){const t=e.points;let i,s,r,n,o,a;if(e.type===xp.CIRC){const t=e.shape;i=t.x,s=t.y,o=a=t.radius,r=n=0}else if(e.type===xp.ELIP){const t=e.shape;i=t.x,s=t.y,o=t.width,a=t.height,r=n=0}else{const t=e.shape,h=t.width/2,l=t.height/2;i=t.x+h,s=t.y+l,o=a=Math.max(0,Math.min(t.radius,Math.min(h,l))),r=h-o,n=l-a}if(!(o>=0&&a>=0&&r>=0&&n>=0))return void(t.length=0);const h=Math.ceil(2.3*Math.sqrt(o+a)),l=8*h+(r?4:0)+(n?4:0);if(t.length=l,0===l)return;if(0===h)return t.length=8,t[0]=t[6]=i+r,t[1]=t[3]=s+n,t[2]=t[4]=i-r,void(t[5]=t[7]=s-n);let c=0,u=4*h+(r?2:0)+2,d=u,_=l;{const e=r+o,a=n,h=i+e,l=i-e,p=s+a;if(t[c++]=h,t[c++]=p,t[--u]=p,t[--u]=l,n){const e=s-a;t[d++]=l,t[d++]=e,t[--_]=e,t[--_]=h}}for(let e=1;e<h;e++){const l=Math.PI/2*(e/h),p=r+Math.cos(l)*o,g=n+Math.sin(l)*a,f=i+p,m=i-p,b=s+g,v=s-g;t[c++]=f,t[c++]=b,t[--u]=b,t[--u]=m,t[d++]=m,t[d++]=v,t[--_]=v,t[--_]=f}{const e=n+a,o=i+r,h=i-r,l=s+e,u=s-e;t[c++]=o,t[c++]=l,t[--_]=u,t[--_]=o,r&&(t[c++]=h,t[c++]=l,t[--_]=u,t[--_]=h)}},triangulate(e,t){const i=e.points,s=t.points,r=t.indices;if(0===i.length)return;let n=s.length/2;const o=n;let a,h;if(e.type!==xp.RREC){const t=e.shape;a=t.x,h=t.y}else{const t=e.shape;a=t.x+t.width/2,h=t.y+t.height/2}const l=e.matrix;s.push(e.matrix?l.a*a+l.c*h+l.tx:a,e.matrix?l.b*a+l.d*h+l.ty:h),n++,s.push(i[0],i[1]);for(let e=2;e<i.length;e+=2)s.push(i[e],i[e+1]),r.push(n++,o,n);r.push(o+1,o,n)}};function Yb(e,t=!1){const i=e.length;if(i<6)return;let s=0;for(let t=0,r=e[i-2],n=e[i-1];t<i;t+=2){const i=e[t],o=e[t+1];s+=(i-r)*(o+n),r=i,n=o}if(!t&&s>0||t&&s<=0){const t=i/2;for(let s=t+t%2;s<i;s+=2){const t=i-s-2,r=i-s-1,n=s,o=s+1;[e[t],e[n]]=[e[n],e[t]],[e[r],e[o]]=[e[o],e[r]]}}}const jb={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let i=e.points;const s=e.holes,r=t.points,n=t.indices;if(i.length>=6){Yb(i,!1);const e=[];for(let t=0;t<s.length;t++){const r=s[t];Yb(r.points,!0),e.push(i.length/2),i=i.concat(r.points)}const t=Hd(i,e,2);if(!t)return;const o=r.length/2;for(let e=0;e<t.length;e+=3)n.push(t[e]+o),n.push(t[e+1]+o),n.push(t[e+2]+o);for(let e=0;e<i.length;e++)r.push(i[e])}}},Zb={build(e){const t=e.shape,i=t.x,s=t.y,r=t.width,n=t.height,o=e.points;o.length=0,r>=0&&n>=0&&o.push(i,s,i+r,s,i+r,s+n,i,s+n)},triangulate(e,t){const i=e.points,s=t.points;if(0===i.length)return;const r=s.length/2;s.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),t.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},$b={build(e){Kb.build(e)},triangulate(e,t){Kb.triangulate(e,t)}};var Jb=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(Jb||{}),ev=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(ev||{});const tv={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let i=Math.ceil(e/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};class iv{static curveTo(e,t,i,s,r,n){const o=n[n.length-2],a=n[n.length-1]-t,h=o-e,l=s-t,c=i-e,u=Math.abs(a*c-h*l);if(u<1e-8||0===r)return(n[n.length-2]!==e||n[n.length-1]!==t)&&n.push(e,t),null;const d=a*a+h*h,_=l*l+c*c,p=a*l+h*c,g=r*Math.sqrt(d)/u,f=r*Math.sqrt(_)/u,m=g*p/d,b=f*p/_,v=g*c+f*h,T=g*l+f*a,y=h*(f+m),x=a*(f+m),A=c*(g+b),C=l*(g+b);return{cx:v+e,cy:T+t,radius:r,startAngle:Math.atan2(x-T,y-v),endAngle:Math.atan2(C-T,A-v),anticlockwise:h*l>c*a}}static arc(e,t,i,s,r,n,o,a,h){const l=o-n,c=tv._segmentsCount(Math.abs(l)*r,40*Math.ceil(Math.abs(l)/vp)),u=l/(2*c),d=2*u,_=Math.cos(u),p=Math.sin(u),g=c-1,f=g%1/g;for(let e=0;e<=g;++e){const t=u+n+d*(e+f*e),o=Math.cos(t),a=-Math.sin(t);h.push((_*o+p*a)*r+i,(_*-a+p*o)*r+s)}}}class sv{static curveLength(e,t,i,s,r,n,o,a){let h=0,l=0,c=0,u=0,d=0,_=0,p=0,g=0,f=0,m=0,b=0,v=e,T=t;for(let y=1;y<=10;++y)l=y/10,c=l*l,u=c*l,d=1-l,_=d*d,p=_*d,g=p*e+3*_*l*i+3*d*c*r+u*o,f=p*t+3*_*l*s+3*d*c*n+u*a,m=v-g,b=T-f,v=g,T=f,h+=Math.sqrt(m*m+b*b);return h}static curveTo(e,t,i,s,r,n,o){const a=o[o.length-2],h=o[o.length-1];o.length-=2;const l=tv._segmentsCount(sv.curveLength(a,h,e,t,i,s,r,n));let c=0,u=0,d=0,_=0,p=0;o.push(a,h);for(let g=1,f=0;g<=l;++g)f=g/l,c=1-f,u=c*c,d=u*c,_=f*f,p=_*f,o.push(d*a+3*u*f*e+3*c*_*i+p*r,d*h+3*u*f*t+3*c*_*s+p*n)}}function rv(e,t,i,s,r,n,o,a){let h,l;o?(h=s,l=-i):(h=-s,l=i);const c=e-i*r+h,u=t-s*r+l,d=e+i*n+h,_=t+s*n+l;return a.push(c,u,d,_),2}function nv(e,t,i,s,r,n,o,a){const h=i-e,l=s-t;let c=Math.atan2(h,l),u=Math.atan2(r-e,n-t);a&&c<u?c+=2*Math.PI:!a&&c>u&&(u+=2*Math.PI);let d=c;const _=u-c,p=Math.abs(_),g=Math.sqrt(h*h+l*l),f=1+(15*p*Math.sqrt(g)/Math.PI|0),m=_/f;if(d+=m,a){o.push(e,t,i,s);for(let i=1,s=d;i<f;i++,s+=m)o.push(e,t,e+Math.sin(s)*g,t+Math.cos(s)*g);o.push(e,t,r,n)}else{o.push(i,s,e,t);for(let i=1,s=d;i<f;i++,s+=m)o.push(e+Math.sin(s)*g,t+Math.cos(s)*g,e,t);o.push(r,n,e,t)}return 2*f}function ov(e,t){e.lineStyle.native?function(e,t){let i=0;const s=e.shape,r=e.points||s.points,n=s.type!==xp.POLY||s.closeStroke;if(0===r.length)return;const o=t.points,a=t.indices,h=r.length/2,l=o.length/2;let c=l;for(o.push(r[0],r[1]),i=1;i<h;i++)o.push(r[2*i],r[2*i+1]),a.push(c,c+1),c++;n&&a.push(c,l)}(e,t):function(e,t){const i=e.shape;let s=e.points||i.points.slice();const r=t.closePointEps;if(0===s.length)return;const n=e.lineStyle,o=new Ap(s[0],s[1]),a=new Ap(s[s.length-2],s[s.length-1]),h=i.type!==xp.POLY||i.closeStroke,l=Math.abs(o.x-a.x)<r&&Math.abs(o.y-a.y)<r;if(h){s=s.slice(),l&&(s.pop(),s.pop(),a.set(s[s.length-2],s[s.length-1]));const e=.5*(o.x+a.x),t=.5*(a.y+o.y);s.unshift(e,t),s.push(e,t)}const c=t.points,u=s.length/2;let d=s.length;const _=c.length/2,p=n.width/2,g=p*p,f=n.miterLimit*n.miterLimit;let m=s[0],b=s[1],v=s[2],T=s[3],y=0,x=0,A=-(b-T),C=m-v,S=0,E=0,R=Math.sqrt(A*A+C*C);A/=R,C/=R,A*=p,C*=p;const P=n.alignment,I=2*(1-P),M=2*P;h||(n.cap===ev.ROUND?d+=nv(m-A*(I-M)*.5,b-C*(I-M)*.5,m-A*I,b-C*I,m+A*M,b+C*M,c,!0)+2:n.cap===ev.SQUARE&&(d+=rv(m,b,A,C,I,M,!0,c))),c.push(m-A*I,b-C*I,m+A*M,b+C*M);for(let e=1;e<u-1;++e){m=s[2*(e-1)],b=s[2*(e-1)+1],v=s[2*e],T=s[2*e+1],y=s[2*(e+1)],x=s[2*(e+1)+1],A=-(b-T),C=m-v,R=Math.sqrt(A*A+C*C),A/=R,C/=R,A*=p,C*=p,S=-(T-x),E=v-y,R=Math.sqrt(S*S+E*E),S/=R,E/=R,S*=p,E*=p;const t=v-m,i=b-T,r=v-y,o=x-T,a=t*r+i*o,h=i*r-o*t,l=h<0;if(Math.abs(h)<.001*Math.abs(a)){c.push(v-A*I,T-C*I,v+A*M,T+C*M),a>=0&&(n.join===Jb.ROUND?d+=nv(v,T,v-A*I,T-C*I,v-S*I,T-E*I,c,!1)+4:d+=2,c.push(v-S*M,T-E*M,v+S*I,T+E*I));continue}const u=(-A+m)*(-C+T)-(-A+v)*(-C+b),_=(-S+y)*(-E+T)-(-S+v)*(-E+x),P=(t*_-r*u)/h,w=(o*u-i*_)/h,O=(P-v)*(P-v)+(w-T)*(w-T),B=v+(P-v)*I,D=T+(w-T)*I,F=v-(P-v)*M,L=T-(w-T)*M,N=l?I:M,k=O<=Math.min(t*t+i*i,r*r+o*o)+N*N*g;let U=n.join;if(U===Jb.MITER&&O/g>f&&(U=Jb.BEVEL),k)switch(U){case Jb.MITER:c.push(B,D,F,L);break;case Jb.BEVEL:l?c.push(B,D,v+A*M,T+C*M,B,D,v+S*M,T+E*M):c.push(v-A*I,T-C*I,F,L,v-S*I,T-E*I,F,L),d+=2;break;case Jb.ROUND:l?(c.push(B,D,v+A*M,T+C*M),d+=nv(v,T,v+A*M,T+C*M,v+S*M,T+E*M,c,!0)+4,c.push(B,D,v+S*M,T+E*M)):(c.push(v-A*I,T-C*I,F,L),d+=nv(v,T,v-A*I,T-C*I,v-S*I,T-E*I,c,!1)+4,c.push(v-S*I,T-E*I,F,L))}else{switch(c.push(v-A*I,T-C*I,v+A*M,T+C*M),U){case Jb.MITER:l?c.push(F,L,F,L):c.push(B,D,B,D),d+=2;break;case Jb.ROUND:d+=l?nv(v,T,v+A*M,T+C*M,v+S*M,T+E*M,c,!0)+2:nv(v,T,v-A*I,T-C*I,v-S*I,T-E*I,c,!1)+2}c.push(v-S*I,T-E*I,v+S*M,T+E*M),d+=2}}m=s[2*(u-2)],b=s[2*(u-2)+1],v=s[2*(u-1)],T=s[2*(u-1)+1],A=-(b-T),C=m-v,R=Math.sqrt(A*A+C*C),A/=R,C/=R,A*=p,C*=p,c.push(v-A*I,T-C*I,v+A*M,T+C*M),h||(n.cap===ev.ROUND?d+=nv(v-A*(I-M)*.5,T-C*(I-M)*.5,v-A*I,T-C*I,v+A*M,T+C*M,c,!1)+2:n.cap===ev.SQUARE&&(d+=rv(v,T,A,C,I,M,!1,c)));const w=t.indices,O=tv.epsilon*tv.epsilon;for(let e=_;e<d+_-2;++e)m=c[2*e],b=c[2*e+1],v=c[2*(e+1)],T=c[2*(e+1)+1],y=c[2*(e+2)],x=c[2*(e+2)+1],!(Math.abs(m*(T-x)+v*(x-b)+y*(b-T))<O)&&w.push(e,e+1,e+2)}(e,t)}class av{static curveLength(e,t,i,s,r,n){const o=e-2*i+r,a=t-2*s+n,h=2*i-2*e,l=2*s-2*t,c=4*(o*o+a*a),u=4*(o*h+a*l),d=h*h+l*l,_=2*Math.sqrt(c+u+d),p=Math.sqrt(c),g=2*c*p,f=2*Math.sqrt(d),m=u/p;return(g*_+p*u*(_-f)+(4*d*c-u*u)*Math.log((2*p+m+_)/(m+f)))/(4*g)}static curveTo(e,t,i,s,r){const n=r[r.length-2],o=r[r.length-1],a=tv._segmentsCount(av.curveLength(n,o,e,t,i,s));let h=0,l=0;for(let c=1;c<=a;++c){const u=c/a;h=n+(e-n)*u,l=o+(t-o)*u,r.push(h+(e+(i-e)*u-h)*u,l+(t+(s-t)*u-l)*u)}}}const hv={[xp.POLY]:jb,[xp.CIRC]:Kb,[xp.ELIP]:Kb,[xp.RECT]:Zb,[xp.RREC]:$b},lv=[],cv=[];class uv{constructor(e,t=null,i=null,s=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=i,this.fillStyle=t,this.matrix=s,this.type=e.type}clone(){return new uv(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class dv{constructor(){this.reset()}begin(e,t,i){this.reset(),this.style=e,this.start=t,this.attribStart=i}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const _v=new Ap,pv=class e extends bp{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Kf,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),cv.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),lv.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,i=null,s=null){const r=new uv(e,t,i,s);return this.graphicsData.push(r),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const i=new uv(e,null,null,t),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let i=0;i<t.length;++i){const s=t[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(e,_v):_v.copyFrom(e),s.shape.contains(_v.x,_v.y))){let e=!1;if(s.holes)for(let t=0;t<s.holes.length;t++)if(s.holes[t].shape.contains(_v.x,_v.y)){e=!0;break}if(!e)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let r=this.shapeIndex;r<t.length;r++){this.shapeIndex++;const n=t[r],o=n.fillStyle,a=n.lineStyle;hv[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix),(o.visible||a.visible)&&this.processHoles(n.holes);for(let t=0;t<2;t++){const r=0===t?o:a;if(!r.visible)continue;const h=r.texture.baseTexture,l=this.indices.length,c=this.points.length/2;h.wrapMode=pd.REPEAT,0===t?this.processFill(n):this.processLine(n);const u=this.points.length/2-c;0!==u&&(i&&!this._compareStyles(s,r)&&(i.end(l,c),i=null),i||(i=lv.pop()||new dv,i.begin(r,l,c),this.batches.push(i),s=r),this.addUvs(this.points,e,r.texture,c,u,r.matrix))}}const r=this.indices.length,n=this.points.length/2;if(i&&i.end(r,n),0===this.batches.length)return void(this.batchable=!0);const o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const t=this.graphicsData[e],i=t.fillStyle,s=t.lineStyle;if(i&&!i.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,i=e.length;t<i;t++){const i=e[t];for(let e=0;e<i.size;e++){const t=i.start+e;this.indicesUint16[t]=this.indicesUint16[t]-i.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE}buildDrawCalls(){let e=++hp._globalBatch;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),cv.push(this.drawCalls[e]);this.drawCalls.length=0;const t=this.colors,i=this.textureIds;let s=cv.pop();s||(s=new lp,s.texArray=new hg),s.texArray.count=0,s.start=0,s.size=0,s.type=hd.TRIANGLES;let r=0,n=null,o=0,a=!1,h=hd.TRIANGLES,l=0;this.drawCalls.push(s);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,_=u.style,p=_.texture.baseTexture;a!==!!_.native&&(a=!!_.native,h=a?hd.LINES:hd.TRIANGLES,n=null,r=d,e++),n!==p&&(n=p,p._batchEnabled!==e&&(r===d&&(e++,r=0,s.size>0&&(s=cv.pop(),s||(s=new lp,s.texArray=new hg),this.drawCalls.push(s)),s.start=l,s.size=0,s.texArray.count=0,s.type=h),p.touched=1,p._batchEnabled=e,p._batchLocation=r,p.wrapMode=pd.REPEAT,s.texArray.elements[s.texArray.count++]=p,r++)),s.size+=u.size,l+=u.size,o=p._batchLocation,this.addColors(t,_.color,_.alpha,u.attribSize,u.attribStart),this.addTextureIds(i,o,u.attribSize,u.attribStart)}hp._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,i=this.colors,s=this.textureIds,r=new ArrayBuffer(3*e.length*4),n=new Float32Array(r),o=new Uint32Array(r);let a=0;for(let r=0;r<e.length/2;r++)n[a++]=e[2*r],n[a++]=e[2*r+1],n[a++]=t[2*r],n[a++]=t[2*r+1],o[a++]=i[r],n[a++]=s[r];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?jb.triangulate(e,this):hv[e.type].triangulate(e,this)}processLine(e){ov(e,this);for(let t=0;t<e.holes.length;t++)ov(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const i=e[t];hv[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let i=0;i<e.length/2;i++){const s=e[2*i],r=e[2*i+1];e[2*i]=t.a*s+t.c*r+t.tx,e[2*i+1]=t.b*s+t.d*r+t.ty}}addColors(e,t,i,s,r=0){const n=R_.shared.setValue(t).toLittleEndianNumber(),o=R_.shared.setValue(n).toPremultiplied(i);e.length=Math.max(e.length,r+s);for(let t=0;t<s;t++)e[r+t]=o}addTextureIds(e,t,i,s=0){e.length=Math.max(e.length,s+i);for(let r=0;r<i;r++)e[s+r]=t}addUvs(e,t,i,s,r,n=null){let o=0;const a=t.length,h=i.frame;for(;o<r;){let i=e[2*(s+o)],r=e[2*(s+o)+1];if(n){const e=n.a*i+n.c*r+n.tx;r=n.b*i+n.d*r+n.ty,i=e}o++,t.push(i/h.width,r/h.height)}const l=i.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(t,i,a,r)}adjustUvs(e,t,i,s){const r=t.baseTexture,n=1e-6,o=i+2*s,a=t.frame,h=a.width/r.width,l=a.height/r.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(e[i]+n),_=Math.floor(e[i+1]+n);for(let t=i+2;t<o;t+=2)d=Math.min(d,Math.floor(e[t]+n)),_=Math.min(_,Math.floor(e[t+1]+n));c-=d,u-=_;for(let t=i;t<o;t+=2)e[t]=(e[t]+c)*h,e[t+1]=(e[t+1]+u)*l}};pv.BATCHABLE_SIZE=100;let gv=pv;class fv{constructor(){this.color=16777215,this.alpha=1,this.texture=Sg.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new fv;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=Sg.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class mv extends fv{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ev.BUTT,this.join=Jb.MITER,this.miterLimit=10}clone(){const e=new mv;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ev.BUTT,this.join=Jb.MITER,this.miterLimit=10}}const bv={},vv=class e extends em{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new fv,this._lineStyle=new mv,this._matrix=null,this._holeMode=!1,this.state=ep.for2d(),this._geometry=e||new gv,this._geometry.refCount++,this._transformID=-1,this._tintColor=new R_(16777215),this.blendMode=ad.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new e(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,i,s=.5,r=!1){return"number"==typeof e&&(e={width:e,color:t,alpha:i,alignment:s,native:r}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:Sg.WHITE,color:e?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ev.BUTT,join:Jb.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.width>0&&e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:i},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Pp,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Pp,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,s=i[i.length-2],r=i[i.length-1];return(s!==e||r!==t)&&i.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this._initCurve();const r=this.currentPath.points;return 0===r.length&&this.moveTo(0,0),av.curveTo(e,t,i,s,r),this}bezierCurveTo(e,t,i,s,r,n){return this._initCurve(),sv.curveTo(e,t,i,s,r,n,this.currentPath.points),this}arcTo(e,t,i,s,r){this._initCurve(e,t);const n=this.currentPath.points,o=iv.curveTo(e,t,i,s,r,n);if(o){const{cx:e,cy:t,radius:i,startAngle:s,endAngle:r,anticlockwise:n}=o;this.arc(e,t,i,s,r,n)}return this}arc(e,t,i,s,r,n=!1){if(s===r)return this;if(!n&&r<=s?r+=vp:n&&s<=r&&(s+=vp),r-s==0)return this;const o=e+Math.cos(s)*i,a=t+Math.sin(s)*i,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const e=Math.abs(l[l.length-2]-o),t=Math.abs(l[l.length-1]-a);e<h&&t<h||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return iv.arc(o,a,e,t,i,s,r,n,l),this}beginFill(e=0,t){return this.beginTextureFill({texture:Sg.WHITE,color:e,alpha:t})}normalizeColor(e){const t=R_.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:Sg.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:i},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,i,s){return this.drawShape(new Sp(e,t,i,s))}drawRoundedRect(e,t,i,s,r){return this.drawShape(new Ip(e,t,i,s,r))}drawCircle(e,t,i){return this.drawShape(new Ep(e,t,i))}drawEllipse(e,t,i,s){return this.drawShape(new Rp(e,t,i,s))}drawPolygon(...e){let t,i=!0;const s=e[0];s.points?(i=s.closeStroke,t=s.points):t=Array.isArray(e[0])?e[0]:e;const r=new Pp(t);return r.closeStroke=i,this.drawShape(r),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return!(1!==e.length||e[0].shape.type!==xp.RECT||e[0].matrix||e[0].holes.length||e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,i=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(e.points);for(let s=0;s<i;s++){const i=e.batches[s],r=i.style.color,n=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),o=new Float32Array(e.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),a={vertexData:n,blendMode:t,indices:new Uint16Array(e.indicesUint16.buffer,2*i.start,i.size),uvs:o,_batchRGB:R_.shared.setValue(r).toRgbArray(),_tintRGB:r,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[s]=a}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,i=this.batches.length;t<i;t++){const i=this.batches[t];i.worldAlpha=this.worldAlpha*i.alpha,e.plugins[this.pluginName].render(i)}}}_renderDirect(e){const t=this._resolveDirectShader(e),i=this._geometry,s=this.worldAlpha,r=t.uniforms,n=i.drawCalls;r.translationMatrix=this.transform.worldTransform,R_.shared.setValue(this._tintColor).premultiply(s).toArray(r.tint),e.shader.bind(t),e.geometry.bind(i,t),e.state.set(this.state);for(let t=0,s=n.length;t<s;t++)this._renderDrawCallDirect(e,i.drawCalls[t])}_renderDrawCallDirect(e,t){const{texArray:i,type:s,size:r,start:n}=t,o=i.count;for(let t=0;t<o;t++)e.texture.bind(i.elements[t],t);e.geometry.draw(s,r,n)}_resolveDirectShader(e){let t=this.shader;const i=this.pluginName;if(!t){if(!bv[i]){const{maxTextures:t}=e.plugins[i],s=new Int32Array(t);for(let e=0;e<t;e++)s[e]=e;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new Mp,default:ng.from({uSamplers:s},!0)},n=e.plugins[i]._shader.program;bv[i]=new og(n,r)}t=bv[i]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:i,maxX:s,maxY:r}=e.bounds;this._bounds.addFrame(this.transform,t,i,s,r)}containsPoint(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=R_.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,i=t.a,s=t.b,r=t.c,n=t.d,o=t.tx,a=t.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let e=0;e<h.length;e+=2){const t=h[e],u=h[e+1];l[c++]=i*t+r*u+o,l[c++]=n*u+s*t+a}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};vv.curves=tv,vv._TEMP_POINT=new Ap;let Tv=vv;class yv{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const xv=new Ap,Av=new Pp,Cv=class e extends em{constructor(e,t,i,s=hd.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=i||ep.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Ad.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(t){const i=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===hd.TRIANGLES&&i.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const s=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[s]),e.plugins[s].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,i=e._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const s=this.transform.worldTransform,r=s.a,n=s.b,o=s.c,a=s.d,h=s.tx,l=s.ty,c=this.vertexData;for(let e=0;e<c.length/2;e++){const i=t[2*e],s=t[2*e+1];c[2*e]=r*i+o*s+h,c[2*e+1]=n*i+a*s+l}if(this._roundPixels){const e=Ad.RESOLUTION;for(let t=0;t<c.length;++t)c[t]=Math.round(c[t]*e)/e}this.vertexDirty=i}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new yv(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,xv);const t=this.geometry.getBuffer("aVertexPosition").data,i=Av.points,s=this.geometry.getIndex().data,r=s.length,n=4===this.drawMode?3:1;for(let e=0;e+2<r;e+=n){const r=2*s[e],n=2*s[e+1],o=2*s[e+2];if(i[0]=t[r],i[1]=t[r+1],i[2]=t[n],i[3]=t[n+1],i[4]=t[o],i[5]=t[o+1],Av.contains(xv.x,xv.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};Cv.BATCHABLE_SIZE=100;let Sv=Cv;class Ev extends mp{constructor(e,t,i){super();const s=new up(e),r=new up(t,!0),n=new up(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,ud.FLOAT).addAttribute("aTextureCoord",r,2,!1,ud.FLOAT).addIndex(n),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class Rv extends og{constructor(e,t){const i={uSampler:e,alpha:1,uTextureMatrix:Mp.IDENTITY,uColor:new Float32Array([1,1,1,1])};(t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t)).uniforms&&Object.assign(i,t.uniforms),super(t.program||sg.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i),this._colorDirty=!1,this.uvMatrix=new Vg(e),this.batchable=void 0===t.program,this.pluginName=t.pluginName,this._tintColor=new R_(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;R_.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Pv{constructor(e,t,i){this.geometry=new mp,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<e.length;++i){let s=e[i];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||ud.FLOAT,offset:s.offset},t[i]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new up(function(e,t=null){const i=6*e;if((t=t||new Uint16Array(i)).length!==i)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${i}`);for(let e=0,s=0;e<i;e+=6,s+=4)t[e+0]=s+0,t[e+1]=s+1,t[e+2]=s+2,t[e+3]=s+0,t[e+4]=s+2,t[e+5]=s+3;return t}(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let e=0;e<this.dynamicProperties.length;++e){const i=this.dynamicProperties[e];i.offset=t,t+=i.size,this.dynamicStride+=i.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new up(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let e=0;e<this.staticProperties.length;++e){const t=this.staticProperties[e];t.offset=s,s+=t.size,this.staticStride+=t.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new up(this.staticData,!0,!1);for(let t=0;t<this.dynamicProperties.length;++t){const i=this.dynamicProperties[t];e.addAttribute(i.attributeName,this.dynamicBuffer,0,i.type===ud.UNSIGNED_BYTE,i.type,4*this.dynamicStride,4*i.offset)}for(let t=0;t<this.staticProperties.length;++t){const i=this.staticProperties[t];e.addAttribute(i.attributeName,this.staticBuffer,0,i.type===ud.UNSIGNED_BYTE,i.type,4*this.staticStride,4*i.offset)}}uploadDynamic(e,t,i){for(let s=0;s<this.dynamicProperties.length;s++){const r=this.dynamicProperties[s];r.uploadFunction(e,t,i,r.type===ud.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,i){for(let s=0;s<this.staticProperties.length;s++){const r=this.staticProperties[s];r.uploadFunction(e,t,i,r.type===ud.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class Iv extends lg{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new Mp,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ud.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=og.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=ep.for2d()}render(e){const t=e.children,i=e._maxSize,s=e._batchSize,r=this.renderer;let n=t.length;if(0===n)return;n>i&&!e.autoResize&&(n=i);let o=e._buffers;o||(o=e._buffers=this.generateBuffers(e));const a=t[0]._texture.baseTexture,h=a.alphaMode>0;this.state.blendMode=I_(e.blendMode,h),r.state.set(this.state);const l=r.gl,c=e.worldTransform.copyTo(this.tempMatrix);c.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=R_.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let u=!1;for(let i=0,a=0;i<n;i+=s,a+=1){let h=n-i;h>s&&(h=s),a>=o.length&&o.push(this._generateOneMoreBuffer(e));const c=o[a];c.uploadDynamic(t,i,h);const d=e._bufferUpdateIDs[a]||0;u=u||c._updateID<d,u&&(c._updateID=e._updateID,c.uploadStatic(t,i,h)),r.geometry.bind(c.geometry),l.drawElements(l.TRIANGLES,6*h,l.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],i=e._maxSize,s=e._batchSize,r=e._properties;for(let e=0;e<i;e+=s)t.push(new Pv(this.properties,r,s));return t}_generateOneMoreBuffer(e){const t=e._batchSize,i=e._properties;return new Pv(this.properties,i,t)}uploadVertices(e,t,i,s,r,n){let o=0,a=0,h=0,l=0;for(let c=0;c<i;++c){const i=e[t+c],u=i._texture,d=i.scale.x,_=i.scale.y,p=u.trim,g=u.orig;p?(a=p.x-i.anchor.x*g.width,o=a+p.width,l=p.y-i.anchor.y*g.height,h=l+p.height):(o=g.width*(1-i.anchor.x),a=g.width*-i.anchor.x,h=g.height*(1-i.anchor.y),l=g.height*-i.anchor.y),s[n]=a*d,s[n+1]=l*_,s[n+r]=o*d,s[n+r+1]=l*_,s[n+2*r]=o*d,s[n+2*r+1]=h*_,s[n+3*r]=a*d,s[n+3*r+1]=h*_,n+=4*r}}uploadPosition(e,t,i,s,r,n){for(let o=0;o<i;o++){const i=e[t+o].position;s[n]=i.x,s[n+1]=i.y,s[n+r]=i.x,s[n+r+1]=i.y,s[n+2*r]=i.x,s[n+2*r+1]=i.y,s[n+3*r]=i.x,s[n+3*r+1]=i.y,n+=4*r}}uploadRotation(e,t,i,s,r,n){for(let o=0;o<i;o++){const i=e[t+o].rotation;s[n]=i,s[n+r]=i,s[n+2*r]=i,s[n+3*r]=i,n+=4*r}}uploadUvs(e,t,i,s,r,n){for(let o=0;o<i;++o){const i=e[t+o]._texture._uvs;i?(s[n]=i.x0,s[n+1]=i.y0,s[n+r]=i.x1,s[n+r+1]=i.y1,s[n+2*r]=i.x2,s[n+2*r+1]=i.y2,s[n+3*r]=i.x3,s[n+3*r+1]=i.y3,n+=4*r):(s[n]=0,s[n+1]=0,s[n+r]=0,s[n+r+1]=0,s[n+2*r]=0,s[n+2*r+1]=0,s[n+3*r]=0,s[n+3*r+1]=0,n+=4*r)}}uploadTint(e,t,i,s,r,n){for(let o=0;o<i;++o){const i=e[t+o],a=R_.shared.setValue(i._tintRGB).toPremultiplied(i.alpha,i.texture.baseTexture.alphaMode>0);s[n]=a,s[n+r]=a,s[n+2*r]=a,s[n+3*r]=a,n+=4*r}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Iv.extension={name:"particle",type:Q_.RendererPlugin},j_.add(Iv);var Mv=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(Mv||{});const wv={willReadFrequently:!0},Ov=class e{static get experimentalLetterSpacingSupported(){let t=e._experimentalLetterSpacingSupported;if(void 0!==t){const i=Ad.ADAPTER.getCanvasRenderingContext2D().prototype;t=e._experimentalLetterSpacingSupported="letterSpacing"in i||"textLetterSpacing"in i}return t}constructor(e,t,i,s,r,n,o,a,h){this.text=e,this.style=t,this.width=i,this.height=s,this.lines=r,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(t,i,s,r=e._canvas){s=s??i.wordWrap;const n=i.toFontString(),o=e.measureFont(n);0===o.fontSize&&(o.fontSize=i.fontSize,o.ascent=i.fontSize);const a=r.getContext("2d",wv);a.font=n;const h=(s?e.wordWrap(t,i,r):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let c=0;for(let t=0;t<h.length;t++){const s=e._measureText(h[t],i.letterSpacing,a);l[t]=s,c=Math.max(c,s)}let u=c+i.strokeThickness;i.dropShadow&&(u+=i.dropShadowDistance);const d=i.lineHeight||o.fontSize+i.strokeThickness;let _=Math.max(d,o.fontSize+2*i.strokeThickness)+i.leading+(h.length-1)*(d+i.leading);return i.dropShadow&&(_+=i.dropShadowDistance),new e(t,i,u,_,h,l,d+i.leading,c,o)}static _measureText(t,i,s){let r=!1;e.experimentalLetterSpacingSupported&&(e.experimentalLetterSpacing?(s.letterSpacing=`${i}px`,s.textLetterSpacing=`${i}px`,r=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));let n=s.measureText(t).width;return n>0&&(r?n-=i:n+=(e.graphemeSegmenter(t).length-1)*i),n}static wordWrap(t,i,s=e._canvas){const r=s.getContext("2d",wv);let n=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:c}=i,u=e.collapseSpaces(c),d=e.collapseNewlines(c);let _=!u;const p=i.wordWrapWidth+l,g=e.tokenize(t);for(let t=0;t<g.length;t++){let s=g[t];if(e.isNewline(s)){if(!d){a+=e.addLine(o),_=!u,o="",n=0;continue}s=" "}if(u){const t=e.isBreakingSpace(s),i=e.isBreakingSpace(o[o.length-1]);if(t&&i)continue}const c=e.getFromCache(s,l,h,r);if(c>p)if(""!==o&&(a+=e.addLine(o),o="",n=0),e.canBreakWords(s,i.breakWords)){const t=e.wordWrapSplit(s);for(let c=0;c<t.length;c++){let u=t[c],d=u,g=1;for(;t[c+g];){const r=t[c+g];if(e.canBreakChars(d,r,s,c,i.breakWords))break;u+=r,d=r,g++}c+=g-1;const f=e.getFromCache(u,l,h,r);f+n>p&&(a+=e.addLine(o),_=!1,o="",n=0),o+=u,n+=f}}else{o.length>0&&(a+=e.addLine(o),o="",n=0);const i=t===g.length-1;a+=e.addLine(s,!i),_=!1,o="",n=0}else c+n>p&&(_=!1,a+=e.addLine(o),o="",n=0),(o.length>0||!e.isBreakingSpace(s)||_)&&(o+=s,n+=c)}return a+=e.addLine(o,!1),a}static addLine(t,i=!0){return t=e.trimRight(t),i?`${t}\n`:t}static getFromCache(t,i,s,r){let n=s[t];return"number"!=typeof n&&(n=e._measureText(t,i,r)+i,s[t]=n),n}static collapseSpaces(e){return"normal"===e||"pre-line"===e}static collapseNewlines(e){return"normal"===e}static trimRight(t){if("string"!=typeof t)return"";for(let i=t.length-1;i>=0;i--){const s=t[i];if(!e.isBreakingSpace(s))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&e._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,i){return"string"==typeof t&&e._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const i=[];let s="";if("string"!=typeof t)return i;for(let r=0;r<t.length;r++){const n=t[r],o=t[r+1];e.isBreakingSpace(n,o)||e.isNewline(n)?(""!==s&&(i.push(s),s=""),i.push(n)):s+=n}return""!==s&&i.push(s),i}static canBreakWords(e,t){return t}static canBreakChars(e,t,i,s,r){return!0}static wordWrapSplit(t){return e.graphemeSegmenter(t)}static measureFont(t){if(e._fonts[t])return e._fonts[t];const i={ascent:0,descent:0,fontSize:0},s=e._canvas,r=e._context;r.font=t;const n=e.METRICS_STRING+e.BASELINE_SYMBOL,o=Math.ceil(r.measureText(n).width);let a=Math.ceil(r.measureText(e.BASELINE_SYMBOL).width);const h=Math.ceil(e.HEIGHT_MULTIPLIER*a);if(a=a*e.BASELINE_MULTIPLIER|0,0===o||0===h)return e._fonts[t]=i,i;s.width=o,s.height=h,r.fillStyle="#f00",r.fillRect(0,0,o,h),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(n,0,a);const l=r.getImageData(0,0,o,h).data,c=l.length,u=4*o;let d=0,_=0,p=!1;for(d=0;d<a;++d){for(let e=0;e<u;e+=4)if(255!==l[_+e]){p=!0;break}if(p)break;_+=u}for(i.ascent=a-d,_=c-u,p=!1,d=h;d>a;--d){for(let e=0;e<u;e+=4)if(255!==l[_+e]){p=!0;break}if(p)break;_-=u}return i.descent=d-a,i.fontSize=i.ascent+i.descent,e._fonts[t]=i,i}static clearMetrics(t=""){t?delete e._fonts[t]:e._fonts={}}static get _canvas(){if(!e.__canvas){let t;try{const i=new OffscreenCanvas(0,0);if(i.getContext("2d",wv)?.measureText)return e.__canvas=i,i;t=Ad.ADAPTER.createCanvas()}catch{t=Ad.ADAPTER.createCanvas()}t.width=t.height=10,e.__canvas=t}return e.__canvas}static get _context(){return e.__context||(e.__context=e._canvas.getContext("2d",wv)),e.__context}};Ov.METRICS_STRING="|q",Ov.BASELINE_SYMBOL="M",Ov.BASELINE_MULTIPLIER=1.4,Ov.HEIGHT_MULTIPLIER=2,Ov.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map((e=>e.segment))}return e=>[...e]})(),Ov.experimentalLetterSpacing=!1,Ov._fonts={},Ov._newlines=[10,13],Ov._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Bv=Ov;const Dv=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Fv=class e{constructor(e){this.styleID=0,this.reset(),kv(this,e,e)}clone(){const t={};return kv(t,this,e.defaultStyle),new e(t)}reset(){kv(this,e.defaultStyle,e.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Nv(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Nv(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){(function(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0})(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Nv(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let e=t.length-1;e>=0;e--){let i=t[e].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!Dv.includes(i)&&(i=`"${i}"`),t[e]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};Fv.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Mv.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Lv=Fv;function Nv(e){const t=R_.shared,i=e=>{const i=t.setValue(e);return 1===i.alpha?i.toHex():i.toRgbaString()};return Array.isArray(e)?e.map(i):i(e)}function kv(e,t,i){for(const s in i)Array.isArray(t[s])?e[s]=t[s].slice():e[s]=t[s]}const Uv={texture:!0,children:!1,baseTexture:!0},Vv=class e extends sm{constructor(t,i,s){let r=!1;s||(s=Ad.ADAPTER.createCanvas(),r=!0),s.width=3,s.height=3;const n=Sg.from(s);n.orig=new Sp,n.trim=new Sp,super(n),this._ownCanvas=r,this.canvas=s,this.context=s.getContext("2d",{willReadFrequently:!0}),this._resolution=e.defaultResolution??Ad.RESOLUTION,this._autoResolution=e.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=i,this.localStyleID=-1}static get experimentalLetterSpacing(){return Bv.experimentalLetterSpacing}static set experimentalLetterSpacing(e){Xd("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Bv.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const i=this.context,s=Bv.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=s.width,n=s.height,o=s.lines,a=s.lineHeight,h=s.lineWidths,l=s.maxLineWidth,c=s.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+2*t.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=t.strokeThickness,i.textBaseline=t.textBaseline,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit;const _=t.dropShadow?2:1;for(let e=0;e<_;++e){const r=t.dropShadow&&0===e,_=r?Math.ceil(Math.max(1,n)+2*t.padding):0,p=_*this._resolution;if(r){i.fillStyle="black",i.strokeStyle="black";const e=t.dropShadowColor,s=t.dropShadowBlur*this._resolution,r=t.dropShadowDistance*this._resolution;i.shadowColor=R_.shared.setValue(e).setAlpha(t.dropShadowAlpha).toRgbaString(),i.shadowBlur=s,i.shadowOffsetX=Math.cos(t.dropShadowAngle)*r,i.shadowOffsetY=Math.sin(t.dropShadowAngle)*r+p}else i.fillStyle=this._generateFillStyle(t,o,s),i.strokeStyle=t.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let g=(a-c.fontSize)/2;a-c.fontSize<0&&(g=0);for(let e=0;e<o.length;e++)u=t.strokeThickness/2,d=t.strokeThickness/2+e*a+c.ascent+g,"right"===t.align?u+=l-h[e]:"center"===t.align&&(u+=(l-h[e])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[e],u+t.padding,d+t.padding-_,!0),t.fill&&this.drawLetterSpacing(o[e],u+t.padding,d+t.padding-_)}this.updateTexture()}drawLetterSpacing(e,t,i,s=!1){const r=this._style.letterSpacing;let n=!1;if(Bv.experimentalLetterSpacingSupported&&(Bv.experimentalLetterSpacing?(this.context.letterSpacing=`${r}px`,this.context.textLetterSpacing=`${r}px`,n=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===r||n)return void(s?this.context.strokeText(e,t,i):this.context.fillText(e,t,i));let o=t;const a=Bv.graphemeSegmenter(e);let h=this.context.measureText(e).width,l=0;for(let e=0;e<a.length;++e){const t=a[e];s?this.context.strokeText(t,o,i):this.context.fillText(t,o,i);let n="";for(let t=e+1;t<a.length;++t)n+=a[t];l=this.context.measureText(n).width,o+=h-l+r,h=l}}updateTexture(){const e=this.canvas;if(this._style.trim){const t=function(e){const t=function(e){const{width:t,height:i}=e,s=e.getContext("2d",{willReadFrequently:!0});if(null===s)throw new TypeError("Failed to get canvas 2D context");const r=s.getImageData(0,0,t,i).data;let n=0,o=0,a=t-1,h=i-1;for(;o<i&&W_(r,t,o);)++o;if(o===i)return U_.EMPTY;for(;W_(r,t,h);)--h;for(;X_(r,t,n,o,h);)++n;for(;X_(r,t,a,o,h);)--a;return++a,++h,new U_(n,o,a,h)}(e),{width:i,height:s}=t;let r=null;if(!t.isEmpty()){const n=e.getContext("2d");if(null===n)throw new TypeError("Failed to get canvas 2D context");r=n.getImageData(t.left,t.top,i,s)}return{width:i,height:s,data:r}}(e);t.data&&(e.width=t.width,e.height=t.height,this.context.putImageData(t.data,0,0))}const t=this._texture,i=this._style,s=i.trim?0:i.padding,r=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-2*s,t.orig.height=t._frame.height-2*s,this._onTextureUpdate(),r.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),-1===this._textureID&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,i){const s=e.fill;if(!Array.isArray(s))return s;if(1===s.length)return s[0];let r;const n=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,a=this.canvas.width/this._resolution-n-2*o,h=this.canvas.height/this._resolution-n-2*o,l=s.slice(),c=e.fillGradientStops.slice();if(!c.length){const e=l.length+1;for(let t=1;t<e;++t)c.push(t/e)}if(l.unshift(s[0]),c.unshift(0),l.push(s[s.length-1]),c.push(1),e.fillGradientType===Mv.LINEAR_VERTICAL){r=this.context.createLinearGradient(a/2,o,a/2,h+o);const s=i.fontProperties.fontSize+e.strokeThickness;for(let e=0;e<t.length;e++){const n=i.lineHeight*(e-1)+s,o=i.lineHeight*e;let a=o;e>0&&n>o&&(a=(o+n)/2);const u=o+s,d=i.lineHeight*(e+1);let _=u;e+1<t.length&&d<u&&(_=(u+d)/2);const p=(_-a)/h;for(let e=0;e<l.length;e++){let t=0;t="number"==typeof c[e]?c[e]:e/l.length;let i=Math.min(1,Math.max(0,a/h+t*p));i=Number(i.toFixed(5)),r.addColorStop(i,l[e])}}}else{r=this.context.createLinearGradient(o,h/2,a+o,h/2);const e=l.length+1;let t=1;for(let i=0;i<l.length;i++){let s;s="number"==typeof c[i]?c[i]:t/e,r.addColorStop(s,l[i]),t++}}return r}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},Uv,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=F_(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=F_(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},this._style=e instanceof Lv?e:new Lv(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};Vv.defaultAutoResolution=!0;let Gv=Vv;class zv{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Hv(e,t){let i=!1;if(e?._textures?.length)for(let s=0;s<e._textures.length;s++)if(e._textures[s]instanceof Sg){const r=e._textures[s].baseTexture;t.includes(r)||(t.push(r),i=!0)}return i}function Wv(e,t){if(e.baseTexture instanceof hp){const i=e.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function Xv(e,t){if(e._texture&&e._texture instanceof Sg){const i=e._texture.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function qv(e,t){return t instanceof Gv&&(t.updateText(!0),!0)}function Qv(e,t){if(t instanceof Lv){const e=t.toFontString();return Bv.measureFont(e),!0}return!1}function Kv(e,t){if(e instanceof Gv){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const i=e._texture.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function Yv(e,t){return e instanceof Lv&&(t.includes(e)||t.push(e),!0)}const jv=class e{constructor(t){this.limiter=new zv(e.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Kv),this.registerFindHook(Yv),this.registerFindHook(Hv),this.registerFindHook(Wv),this.registerFindHook(Xv),this.registerUploadHook(qv),this.registerUploadHook(Qv)}upload(e){return new Promise((t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Mf.system.addOnce(this.tick,this,Rf.UTILITY))):t()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed)for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)Mf.system.addOnce(this.tick,this,Rf.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,i=e.length;t<i;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,i=this.addHooks.length;t<i&&!this.addHooks[t](e,this.queue);t++);if(e instanceof em)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Mf.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};jv.uploadsPerFrame=4;let Zv=jv;function $v(e,t){return t instanceof hp&&(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0)}function Jv(e,t){if(!(t instanceof Tv))return!1;const{geometry:i}=t;t.finishPoly(),i.updateBatches();const{batches:s}=i;for(let t=0;t<s.length;t++){const{texture:i}=s[t].style;i&&$v(e,i.baseTexture)}return i.batchable||e.geometry.bind(i,t._resolveDirectShader(e)),!0}function eT(e,t){return e instanceof Tv&&(t.push(e),!0)}Object.defineProperties(Ad,{UPLOADS_PER_FRAME:{get:()=>Zv.uploadsPerFrame,set(e){Xd("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Zv.uploadsPerFrame=e}}});class tT extends Zv{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(eT),this.registerUploadHook($v),this.registerUploadHook(Jv)}}tT.extension={name:"prepare",type:Q_.RendererSystem},j_.add(tT),new Ap;var iT="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const sT=new Mp;class rT extends lg{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new Ig,this.state=ep.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=og.from(iT,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",t),this.shader=e.context.webGLVersion>1?og.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",t):og.from(iT,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",t)}render(e){const t=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=e._width*-e.anchor.x,s[1]=s[3]=e._height*-e.anchor.y,s[2]=s[4]=e._width*(1-e.anchor.x),s[5]=s[7]=e._height*(1-e.anchor.y);const r=e.uvRespectAnchor?e.anchor.x:0,n=e.uvRespectAnchor?e.anchor.y:0;s=i.uvs,s[0]=s[6]=-r,s[1]=s[3]=-n,s[2]=s[4]=1-r,s[5]=s[7]=1-n,i.invalidate();const o=e._texture,a=o.baseTexture,h=a.alphaMode>0,l=e.tileTransform.localTransform,c=e.uvMatrix;let u=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;u&&(a._glTextures[t.CONTEXT_UID]?u=a.wrapMode!==pd.CLAMP:a.wrapMode===pd.CLAMP&&(a.wrapMode=pd.REPEAT));const d=u?this.simpleShader:this.shader,_=o.width,p=o.height,g=e._width,f=e._height;sT.set(l.a*_/g,l.b*_/f,l.c*p/g,l.d*p/f,l.tx/g,l.ty/f),sT.invert(),u?sT.prepend(c.mapCoord):(d.uniforms.uMapCoord=c.mapCoord.toArray(!0),d.uniforms.uClampFrame=c.uClampFrame,d.uniforms.uClampOffset=c.uClampOffset),d.uniforms.uTransform=sT.toArray(!0),d.uniforms.uColor=R_.shared.setValue(e.tint).premultiply(e.worldAlpha,h).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),d.uniforms.uSampler=o,t.shader.bind(d),t.geometry.bind(i),this.state.blendMode=I_(e.blendMode,h),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}rT.extension={name:"tilingSprite",type:Q_.RendererPlugin},j_.add(rT);const nT=class e{constructor(e,t,i){this.linkedSheets=[],(e instanceof hp||e instanceof Sg)&&(e={texture:e,data:t,resolutionFilename:i});const{texture:s,data:r,resolutionFilename:n=null,cachePrefix:o=""}=e;this.cachePrefix=o,this._texture=s instanceof Sg?s:null,this.baseTexture=s instanceof hp?s:this._texture.baseTexture,this.textures={},this.animations={},this.data=r;const a=this.baseTexture.resource;this.resolution=this._updateResolution(n||(a?a.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let i=q_(e,null);return null===i&&(i="number"==typeof t?t:parseFloat(t??"1")),1!==i&&this.baseTexture.setResolution(i),i}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let i=t;const s=e.BATCH_SIZE;for(;i-t<s&&i<this._frameKeys.length;){const e=this._frameKeys[i],t=this._frames[e],s=t.frame;if(s){let i=null,r=null;const n=!1!==t.trimmed&&t.sourceSize?t.sourceSize:t.frame,o=new Sp(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution);i=t.rotated?new Sp(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):new Sp(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),!1!==t.trimmed&&t.spriteSourceSize&&(r=new Sp(Math.floor(t.spriteSourceSize.x)/this.resolution,Math.floor(t.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[e]=new Sg(this.baseTexture,i,o,r,t.rotated?2:0,t.anchor,t.borders),Sg.addToCache(this.textures[e],this.cachePrefix+e.toString())}i++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let i=0;i<e[t].length;i++){const s=e[t][i];this.animations[t].push(this.textures[s])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*e.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(e=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};nT.BATCH_SIZE=1e3;let oT=nT;const aT=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function hT(e,t,i){const s={};if(e.forEach((e=>{s[e]=t})),Object.keys(t.textures).forEach((e=>{s[`${t.cachePrefix}${e}`]=t.textures[e]})),!i){const i=Kd.dirname(e[0]);t.linkedSheets.forEach(((e,r)=>{Object.assign(s,hT([`${i}/${t.data.meta.related_multi_packs[r]}`],e,!0))}))}return s}const lT={extension:Q_.Asset,cache:{test:e=>e instanceof oT,getCacheableAssets:(e,t)=>hT(e,t,!1)},resolver:{test:e=>{const t=e.split("?")[0].split("."),i=t.pop(),s=t.pop();return"json"===i&&aT.includes(s)},parse:e=>{const t=e.split(".");return{resolution:parseFloat(Ad.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:Q_.LoadParser,priority:Fm.Normal},testParse:async(e,t)=>".json"===Kd.extname(t.src).toLowerCase()&&!!e.frames,async parse(e,t,i){const{texture:s,imageFilename:r,cachePrefix:n}=t?.data??{};let o,a=Kd.dirname(t.src);if(a&&a.lastIndexOf("/")!==a.length-1&&(a+="/"),s&&s.baseTexture)o=s;else{const s=xb(a+(r??e.meta.image),t.src);o=(await i.load([s]))[s]}const h=new oT({texture:o.baseTexture,data:e,resolutionFilename:t.src,cachePrefix:n});await h.parse();const l=e?.meta?.related_multi_packs;if(Array.isArray(l)){const e=[];for(const s of l){if("string"!=typeof s)continue;let r=a+s;t.data?.ignoreMultiPack||(r=xb(r,t.src),e.push(i.load({src:r,data:{ignoreMultiPack:!0}})))}const s=await Promise.all(e);h.linkedSheets=s,s.forEach((e=>{e.linkedSheets=[h].concat(h.linkedSheets.filter((t=>t!==e)))}))}return h},unload(e){e.destroy(!0)}}};j_.add(lT);class cT{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class uT{static test(e){return"string"==typeof e&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const e in t){const s=t[e].match(/^[a-z]+/gm)[0],r=t[e].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),n={};for(const e in r){const t=r[e].split("="),i=t[0],s=t[1].replace(/"/gm,""),o=parseFloat(s),a=isNaN(o)?s:o;n[i]=a}i[s].push(n)}const s=new cT;return i.info.forEach((e=>s.info.push({face:e.face,size:parseInt(e.size,10)}))),i.common.forEach((e=>s.common.push({lineHeight:parseInt(e.lineHeight,10)}))),i.page.forEach((e=>s.page.push({id:parseInt(e.id,10),file:e.file}))),i.char.forEach((e=>s.char.push({id:parseInt(e.id,10),page:parseInt(e.page,10),x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xoffset:parseInt(e.xoffset,10),yoffset:parseInt(e.yoffset,10),xadvance:parseInt(e.xadvance,10)}))),i.kerning.forEach((e=>s.kerning.push({first:parseInt(e.first,10),second:parseInt(e.second,10),amount:parseInt(e.amount,10)}))),i.distanceField.forEach((e=>s.distanceField.push({distanceRange:parseInt(e.distanceRange,10),fieldType:e.fieldType}))),s}}class dT{static test(e){const t=e;return"string"!=typeof e&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")}static parse(e){const t=new cT,i=e.getElementsByTagName("info"),s=e.getElementsByTagName("common"),r=e.getElementsByTagName("page"),n=e.getElementsByTagName("char"),o=e.getElementsByTagName("kerning"),a=e.getElementsByTagName("distanceField");for(let e=0;e<i.length;e++)t.info.push({face:i[e].getAttribute("face"),size:parseInt(i[e].getAttribute("size"),10)});for(let e=0;e<s.length;e++)t.common.push({lineHeight:parseInt(s[e].getAttribute("lineHeight"),10)});for(let e=0;e<r.length;e++)t.page.push({id:parseInt(r[e].getAttribute("id"),10)||0,file:r[e].getAttribute("file")});for(let e=0;e<n.length;e++){const i=n[e];t.char.push({id:parseInt(i.getAttribute("id"),10),page:parseInt(i.getAttribute("page"),10)||0,x:parseInt(i.getAttribute("x"),10),y:parseInt(i.getAttribute("y"),10),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10),xoffset:parseInt(i.getAttribute("xoffset"),10),yoffset:parseInt(i.getAttribute("yoffset"),10),xadvance:parseInt(i.getAttribute("xadvance"),10)})}for(let e=0;e<o.length;e++)t.kerning.push({first:parseInt(o[e].getAttribute("first"),10),second:parseInt(o[e].getAttribute("second"),10),amount:parseInt(o[e].getAttribute("amount"),10)});for(let e=0;e<a.length;e++)t.distanceField.push({fieldType:a[e].getAttribute("fieldType"),distanceRange:parseInt(a[e].getAttribute("distanceRange"),10)});return t}}class _T{static test(e){return!("string"!=typeof e||!e.includes("<font>"))&&dT.test(Ad.ADAPTER.parseXML(e))}static parse(e){return dT.parse(Ad.ADAPTER.parseXML(e))}}const pT=[uT,dT,_T];function gT(e,t,i,s,r,n,o){const a=i.text,h=i.fontProperties;t.translate(s,r),t.scale(n,n);const l=o.strokeThickness/2,c=-o.strokeThickness/2;if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=function(e,t,i,s,r,n){const o=i.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const h=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,c=e.width/s-h-2*l,u=e.height/s-h-2*l,d=o.slice(),_=i.fillGradientStops.slice();if(!_.length){const e=d.length+1;for(let t=1;t<e;++t)_.push(t/e)}if(d.unshift(o[0]),_.unshift(0),d.push(o[o.length-1]),_.push(1),i.fillGradientType===Mv.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,l,c/2,u+l);let e=0;const s=(n.fontProperties.fontSize+i.strokeThickness)/u;for(let t=0;t<r.length;t++){const i=n.lineHeight*t;for(let t=0;t<d.length;t++){let r=0;r="number"==typeof _[t]?_[t]:t/d.length;const n=i/u+r*s;let o=Math.max(e,n);o=Math.min(o,1),a.addColorStop(o,d[t]),e=o}}}else{a=t.createLinearGradient(l,u/2,c+l,u/2);const e=d.length+1;let i=1;for(let t=0;t<d.length;t++){let s;s="number"==typeof _[t]?_[t]:i/e,a.addColorStop(s,d[t]),i++}}return a}(e,t,o,n,[a],i),t.strokeStyle=o.stroke,o.dropShadow){const e=o.dropShadowColor,i=o.dropShadowBlur*n,s=o.dropShadowDistance*n;t.shadowColor=R_.shared.setValue(e).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=i,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*s,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*s}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,l,c+i.lineHeight-h.descent),o.fill&&t.fillText(a,l,c+i.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function fT(e){return Array.from?Array.from(e):e.split("")}function mT(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}const bT=class e{constructor(e,t,i){const[s]=e.info,[r]=e.common,[n]=e.page,[o]=e.distanceField,a=q_(n.file),h={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=r.lineHeight/a,this.chars={},this.pageTextures=h;for(let i=0;i<e.page.length;i++){const{id:s,file:r}=e.page[i];h[s]=t instanceof Array?t[i]:t[r],o?.fieldType&&"none"!==o.fieldType&&(h[s].baseTexture.alphaMode=fd.NO_PREMULTIPLIED_ALPHA,h[s].baseTexture.mipmap=gd.OFF)}for(let t=0;t<e.char.length;t++){const{id:i,page:s}=e.char[t];let{x:r,y:n,width:o,height:l,xoffset:c,yoffset:u,xadvance:d}=e.char[t];r/=a,n/=a,o/=a,l/=a,c/=a,u/=a,d/=a;const _=new Sp(r+h[s].frame.x/a,n+h[s].frame.y/a,o,l);this.chars[i]={xOffset:c,yOffset:u,xAdvance:d,kerning:{},texture:new Sg(h[s].baseTexture,_),page:s}}for(let t=0;t<e.kerning.length;t++){let{first:i,second:s,amount:r}=e.kerning[t];i/=a,s/=a,r/=a,this.chars[s]&&(this.chars[s].kerning[i]=r)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(t,i,s){let r;if(t instanceof cT)r=t;else{const e=function(e){for(let t=0;t<pT.length;t++)if(pT[t].test(e))return pT[t];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");r=e.parse(t)}i instanceof Sg&&(i=[i]);const n=new e(r,i,s);return e.available[n.font]=n,n}static uninstall(t){const i=e.available[t];if(!i)throw new Error(`No font found named '${t}'`);i.destroy(),delete e.available[t]}static from(t,i,s){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:n,resolution:o,textureWidth:a,textureHeight:h,...l}=Object.assign({},e.defaultOptions,s),c=function(e){"string"==typeof e&&(e=[e]);const t=[];for(let i=0,s=e.length;i<s;i++){const s=e[i];if(Array.isArray(s)){if(2!==s.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const e=s[0].charCodeAt(0),i=s[1].charCodeAt(0);if(i<e)throw new Error("[BitmapFont]: Invalid character range.");for(let s=e,r=i;s<=r;s++)t.push(String.fromCharCode(s))}else t.push(...fT(s))}if(0===t.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}(r),u=i instanceof Lv?i:new Lv(i),d=a,_=new cT;_.info[0]={face:u.fontFamily,size:u.fontSize},_.common[0]={lineHeight:u.fontSize};let p,g,f,m=0,b=0,v=0;const T=[],y=[];for(let e=0;e<c.length;e++){p||(p=Ad.ADAPTER.createCanvas(),p.width=a,p.height=h,g=p.getContext("2d"),f=new hp(p,{resolution:o,...l}),T.push(f),y.push(new Sg(f)),_.page.push({id:y.length-1,file:""}));const t=c[e],i=Bv.measureText(t,u,!1,p),s=i.width,r=Math.ceil(i.height),x=Math.ceil(("italic"===u.fontStyle?2:1)*s);if(b>=h-r*o){if(0===b)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--e,p=null,g=null,f=null,b=0,m=0,v=0;continue}if(v=Math.max(r+i.fontProperties.descent,v),x*o+m>=d){if(0===m)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--e,b+=v*o,b=Math.ceil(b),m=0,v=0;continue}gT(p,g,i,m,b,o,u);const A=mT(i.text);_.char.push({id:A,page:y.length-1,x:m/o,y:b/o,width:x,height:r,xoffset:0,yoffset:0,xadvance:s-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),m+=(x+2*n)*o,m=Math.ceil(m)}if(!s?.skipKerning)for(let e=0,t=c.length;e<t;e++){const i=c[e];for(let e=0;e<t;e++){const t=c[e],s=g.measureText(i).width,r=g.measureText(t).width,n=g.measureText(i+t).width-(s+r);n&&_.kerning.push({first:mT(i),second:mT(t),amount:n})}}const x=new e(_,y,!0);return void 0!==e.available[t]&&e.uninstall(t),e.available[t]=x,x}};bT.ALPHA=[["a","z"],["A","Z"]," "],bT.NUMERIC=[["0","9"]],bT.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],bT.ASCII=[[" ","~"]],bT.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:bT.ALPHANUMERIC},bT.available={};let vT=bT;const TT=[],yT=[],xT=[];(class e extends em{constructor(t,i={}){super();const{align:s,tint:r,maxWidth:n,letterSpacing:o,fontName:a,fontSize:h}=Object.assign({},e.styleDefaults,i);if(!vT.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=s,this._tintColor=new R_(r),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=t,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new Up((()=>{this.dirty=!0}),this,0,0),this._roundPixels=Ad.ROUND_PIXELS,this.dirty=!0,this._resolution=Ad.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const e=vT.available[this._fontName],t=this.fontSize,i=t/e.size,s=new Ap,r=[],n=[],o=[],a=fT(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),h=this._maxWidth*e.size/t,l="none"===e.distanceFieldType?TT:yT;let c=null,u=0,d=0,_=0,p=-1,g=0,f=0,m=0,b=0;for(let t=0;t<a.length;t++){const i=a[t],l=mT(i);if(/(?:\s)/.test(i)&&(p=t,g=u,b++),"\r"===i||"\n"===i){n.push(u),o.push(-1),d=Math.max(d,u),++_,++f,s.x=0,s.y+=e.lineHeight,c=null,b=0;continue}const v=e.chars[l];if(!v)continue;c&&v.kerning[c]&&(s.x+=v.kerning[c]);const T=xT.pop()||{texture:Sg.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ap};T.texture=v.texture,T.line=_,T.charCode=l,T.position.x=Math.round(s.x+v.xOffset+this._letterSpacing/2),T.position.y=Math.round(s.y+v.yOffset),T.prevSpaces=b,r.push(T),u=T.position.x+Math.max(v.xAdvance-v.xOffset,v.texture.orig.width),s.x+=v.xAdvance+this._letterSpacing,m=Math.max(m,v.yOffset+v.texture.height),c=l,-1!==p&&h>0&&s.x>h&&(++f,D_(r,1+p-f,1+t-p),t=p,p=-1,n.push(g),o.push(r.length>0?r[r.length-1].prevSpaces:0),d=Math.max(d,g),_++,s.x=0,s.y+=e.lineHeight,c=null,b=0)}const v=a[a.length-1];"\r"!==v&&"\n"!==v&&(/(?:\s)/.test(v)&&(u=g),n.push(u),d=Math.max(d,u),o.push(-1));const T=[];for(let e=0;e<=_;e++){let t=0;"right"===this._align?t=d-n[e]:"center"===this._align?t=(d-n[e])/2:"justify"===this._align&&(t=o[e]<0?0:(d-n[e])/o[e]),T.push(t)}const y=r.length,x={},A=[],C=this._activePagesMeshData;l.push(...C);for(let t=0;t<y;t++){const i=r[t].texture,s=i.baseTexture.uid;if(!x[s]){let t=l.pop();if(!t){const i=new Ev;let s,r;"none"===e.distanceFieldType?(s=new Rv(Sg.EMPTY),r=ad.NORMAL):(s=new Rv(Sg.EMPTY,{program:sg.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),r=ad.NORMAL_NPM);const n=new Sv(i,s);n.blendMode=r,t={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:n,vertices:null,uvs:null,indices:null}}t.index=0,t.indexCount=0,t.vertexCount=0,t.uvsCount=0,t.total=0;const{_textureCache:r}=this;r[s]=r[s]||new Sg(i.baseTexture),t.mesh.texture=r[s],t.mesh.tint=this._tintColor.value,A.push(t),x[s]=t}x[s].total++}for(let e=0;e<C.length;e++)A.includes(C[e])||this.removeChild(C[e].mesh);for(let e=0;e<A.length;e++)A[e].mesh.parent!==this&&this.addChild(A[e].mesh);this._activePagesMeshData=A;for(const e in x){const t=x[e],i=t.total;if(!(t.indices?.length>6*i)||t.vertices.length<2*Sv.BATCHABLE_SIZE)t.vertices=new Float32Array(8*i),t.uvs=new Float32Array(8*i),t.indices=new Uint16Array(6*i);else{const e=t.total,i=t.vertices;for(let t=4*e*2;t<i.length;t++)i[t]=0}t.mesh.size=6*i}for(let e=0;e<y;e++){const t=r[e];let s=t.position.x+T[t.line]*("justify"===this._align?t.prevSpaces:1);this._roundPixels&&(s=Math.round(s));const n=s*i,o=t.position.y*i,a=t.texture,h=x[a.baseTexture.uid],l=a.frame,c=a._uvs,u=h.index++;h.indices[6*u+0]=0+4*u,h.indices[6*u+1]=1+4*u,h.indices[6*u+2]=2+4*u,h.indices[6*u+3]=0+4*u,h.indices[6*u+4]=2+4*u,h.indices[6*u+5]=3+4*u,h.vertices[8*u+0]=n,h.vertices[8*u+1]=o,h.vertices[8*u+2]=n+l.width*i,h.vertices[8*u+3]=o,h.vertices[8*u+4]=n+l.width*i,h.vertices[8*u+5]=o+l.height*i,h.vertices[8*u+6]=n,h.vertices[8*u+7]=o+l.height*i,h.uvs[8*u+0]=c.x0,h.uvs[8*u+1]=c.y0,h.uvs[8*u+2]=c.x1,h.uvs[8*u+3]=c.y1,h.uvs[8*u+4]=c.x2,h.uvs[8*u+5]=c.y2,h.uvs[8*u+6]=c.x3,h.uvs[8*u+7]=c.y3}this._textWidth=d*i,this._textHeight=(s.y+e.lineHeight)*i;for(const e in x){const t=x[e];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const i=this._textWidth*this.anchor.x,s=this._textHeight*this.anchor.y;for(let r=0;r<t.total;r++)t.vertices[e++]-=i,t.vertices[e++]-=s,t.vertices[e++]-=i,t.vertices[e++]-=s,t.vertices[e++]-=i,t.vertices[e++]-=s,t.vertices[e++]-=i,t.vertices[e++]-=s}this._maxLineHeight=m*i;const s=t.mesh.geometry.getBuffer("aVertexPosition"),r=t.mesh.geometry.getBuffer("aTextureCoord"),n=t.mesh.geometry.getIndex();s.data=t.vertices,r.data=t.uvs,n.data=t.indices,s.update(),r.update(),n.update()}for(let e=0;e<r.length;e++)xT.push(r[e]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:i,size:s}=vT.available[this._fontName];if("none"!==i){const{a:i,b:r,c:n,d:o}=this.worldTransform,a=Math.sqrt(i*i+r*r),h=Math.sqrt(n*n+o*o),l=(Math.abs(a)+Math.abs(h))/2,c=this.fontSize/s,u=e._view.resolution;for(const e of this._activePagesMeshData)e.mesh.shader.uniforms.uFWidth=l*t*c*u}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=vT.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!vT.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??vT.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,i="none"===vT.available[this._fontName].distanceFieldType?TT:yT;i.push(...this._activePagesMeshData);for(const e of this._activePagesMeshData)this.removeChild(e.mesh);this._activePagesMeshData=[],i.filter((e=>t[e.mesh.texture.baseTexture.uid])).forEach((e=>{e.mesh.texture=Sg.EMPTY}));for(const e in t)t[e].destroy(),delete t[e];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}}).styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const AT=[".xml",".fnt"],CT={extension:{type:Q_.LoadParser,priority:Fm.Normal},name:"loadBitmapFont",test:e=>AT.includes(Kd.extname(e).toLowerCase()),testParse:async e=>uT.test(e)||_T.test(e),async parse(e,t,i){const s=uT.test(e)?uT.parse(e):_T.parse(e),{src:r}=t,{page:n}=s,o=[];for(let e=0;e<n.length;++e){const t=n[e].file;let i=Kd.join(Kd.dirname(r),t);i=xb(i,r),o.push(i)}const a=await i.load(o),h=o.map((e=>a[e]));return vT.install(s,h,!0)},load:async(e,t)=>(await Ad.ADAPTER.fetch(e)).text(),unload(e){e.destroy()}};j_.add(CT);const ST=class e extends Lv{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new e(Object.keys(e.defaultOptions).reduce(((e,i)=>({...e,[i]:t[i]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete e.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,i={}){const{availableFonts:s}=e;if(s[t]){const e=s[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return Ad.ADAPTER.fetch(t).then((e=>e.blob())).then((async e=>new Promise(((t,i)=>{const s=URL.createObjectURL(e),r=new FileReader;r.onload=()=>t([s,r.result]),r.onerror=i,r.readAsDataURL(e)})))).then((async([e,r])=>{const n=Object.assign({family:Kd.basename(t,Kd.extname(t)),weight:"normal",style:"normal",display:"auto",src:e,dataSrc:r,refs:1,originalUrl:t,fontFace:null},i);s[t]=n,this._fonts.push(n),this.styleID++;const o=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style,display:n.display});n.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...e){const t=e.filter((e=>!this._overrides.includes(e)));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter((e=>this._overrides.includes(e)));t.length>0&&(this._overrides=this._overrides.filter((e=>!t.includes(e))),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((e,t)=>`${e}\n            @font-face {\n                font-family: "${t.family}";\n                src: url('${t.dataSrc}');\n                font-weight: ${t.weight};\n                font-style: ${t.style};\n                font-display: ${t.display};\n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(i=e,Xd("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),e=R_.shared.setValue(i).toNumber()),"number"==typeof e?(t=e,Xd("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),R_.shared.setValue(t).toHex()):e;var t,i}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(255*t|0).toString(16).padStart(2,"0"));const r=`${i}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${r} ${e}`}reset(){Object.assign(this,e.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise((e=>setTimeout(e,100))):Promise.resolve()}get isSafari(){const{userAgent:e}=Ad.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};ST.availableFonts={},ST.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let ET=ST;const RT=class e extends sm{constructor(t="",i={}){super(Sg.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const s=new Image,r=Sg.from(s,{scaleMode:Ad.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new Sp,r.trim=new Sp,this.texture=r;const n="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(n,"svg"),h=document.createElementNS(n,"foreignObject"),l=document.createElementNS(o,"div"),c=document.createElementNS(o,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=e.defaultMaxWidth,this.maxHeight=e.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=s,this._loadImage=new Image,this._autoResolution=e.defaultAutoResolution,this._resolution=e.defaultResolution??Ad.RESOLUTION,this.text=t,this.style=i}measureText(e){const{text:t,style:i,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:i.toCSS(s)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const r=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:n,height:o}=r;(n>this.maxWidth||o>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const a=Math.min(this.maxWidth,Math.ceil(n)),h=Math.min(this.maxHeight,Math.ceil(o));return this._svgRoot.setAttribute("width",a.toString()),this._svgRoot.setAttribute("height",h.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(s)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:a+2*i.padding,height:h+2*i.padding}}async updateText(e=!0){const{style:t,_image:i,_loadImage:s}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:r,height:n}=this.measureText();i.width=s.width=Math.ceil(Math.max(1,r)),i.height=s.height=Math.ceil(Math.max(1,n)),this._updateID++;const o=this._updateID;await new Promise((e=>{s.onload=async()=>{o<this._updateID||(await t.onBeforeDraw(),i.src=s.src,s.onload=null,s.src="",this.updateTexture()),e()};const r=(new XMLSerializer).serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(r)}`}))}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:i,resolution:s}=this,{padding:r}=e,{baseTexture:n}=t;t.trim.width=t._frame.width=i.width/s,t.trim.height=t._frame.height=i.height/s,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-2*r,t.orig.height=t._frame.height-2*r,this._onTextureUpdate(),n.setRealSize(i.width,i.height,s),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},e.defaultDestroyOptions,t),super.destroy(t);const i=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=i,this._svgRoot?.remove(),this._svgRoot=i,this._domElement?.remove(),this._domElement=i,this._foreignObject?.remove(),this._foreignObject=i,this._styleElement?.remove(),this._styleElement=i,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=i,this._image.src="",this._image=i}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=F_(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=F_(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&((e=e||{})instanceof ET?(this.ownsStyle=!1,this._style=e):e instanceof Lv?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=ET.from(e)):(this.ownsStyle=!0,this._style=new ET(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(""===e||null==e?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};RT.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},RT.defaultMaxWidth=2024,RT.defaultMaxHeight=2024,RT.defaultAutoResolution=!0;class PT extends td{constructor(e){super(`Apply bet snapshot ${e.name}`),this._compositeDisposable=new qt,this.betSnapshot=e.betSnapshot,this._betConfiguration=e.betConfiguration,this._placeBetsWithErrorHandling=e.placeBetsWithErrorHandling,this._playerBalance=e.playerBalance,this._fromReset=e.fromReset;const t=this._placeBetsWithErrorHandling.placedBetsCollection.updateObservable.subscribe((()=>{this.checkAndUpdateAvailability()})),i=this._playerBalance.centsObservable.subscribe((()=>{this.checkAndUpdateAvailability()}));this._compositeDisposable.add({dispose:()=>{t.unsubscribe(),i.unsubscribe()}})}async executeInternal(){const e=[...this._placeBetsWithErrorHandling.placedBetsCollection.getSnapshot().placedBets,...this.betSnapshot.placedBets],t=new Map;e.forEach((e=>{const i=t.get(e.spot)??0;t.set(e.spot,i+e.cents)}));const i=[];t.forEach(((e,t)=>{i.push(new j(t,e))}));const s=new te(i);this._placeBetsWithErrorHandling.tryApplySnapshot(s,this._fromReset)}disposeInternal(){this._compositeDisposable.dispose()}checkAndUpdateAvailability(){const e=this.checkLockingReasons();0===e.length?this.enable():this.disable(e)}checkLockingReasons(){return[]}}PT.LockedByMaxTotalBet="LockedByMaxTotalBet",PT.LockedNotEnoughMoney="LockedNotEnoughMoney",PT.LockedByBetSpotMaxBet="LockedByBetSpotMaxBet";class IT{constructor(e){this._betConfiguration=e.betConfiguration,this._placeBetsWithErrorHandling=e.placeBetsWithErrorHandling,this._playerBalance=e.playerBalance}create(e,t,i){return new PT({name:e,betSnapshot:t,betConfiguration:this._betConfiguration,placeBetsWithErrorHandling:this._placeBetsWithErrorHandling,playerBalance:this._playerBalance,fromReset:i})}}class MT{constructor(e){this._feltURLs=e.feltURLs,this._feltTextureUpdater=e.feltTextureUpdater,this._scene=e.scene,this._log=e.log}switchFeltColor(e){const t=this;return this._log.debug(`Setting felt index: ${e}`),new Promise(((i,s)=>{if(e<0||e>=t._feltURLs.length)return void s(new Z(`Felt index out of bounds. Should be [0, ${t._feltURLs.length})`));const r=new Dt.g(t._feltURLs[e],t._scene,{noMipmap:!0,invertY:!1,onLoad:()=>{r.hasAlpha=!0,t._feltTextureUpdater(r).then((()=>i()))},onError:(e,t)=>{s(t??e)}})}))}}class wT{constructor(t){this._playedClips=new Set,this._bjAudioPlayer=t.bjAudioPlayer,this._brand=t.brand,this._gameType=t.gameType,this._voiceType=t.initialVoiceType,this._numSet=t.numSet,this._log=t.log,this._welcomeAssetConfig=[{brand:"cpo",gameType:e.DoubleZero,maleAssetId:Fe.VO_M_Welcome_US_cpo,femaleAssetId:Fe.VO_F_Welcome_US_cpo},{brand:"hso",gameType:e.DoubleZero,maleAssetId:Fe.VO_M_Welcome_US_hso,femaleAssetId:Fe.VO_F_Welcome_US_hso},{brand:"sbk",gameType:e.DoubleZero,maleAssetId:Fe.VO_M_Welcome_US_sbk,femaleAssetId:Fe.VO_F_Welcome_US_sbk},{brand:"cpo",gameType:e.SingleZero,maleAssetId:Fe.VO_M_Welcome_EU_cpo,femaleAssetId:Fe.VO_F_Welcome_EU_cpo},{brand:"hso",gameType:e.SingleZero,maleAssetId:Fe.VO_M_Welcome_EU_hso,femaleAssetId:Fe.VO_F_Welcome_EU_hso},{brand:"sbk",gameType:e.SingleZero,maleAssetId:Fe.VO_M_Welcome_EU_sbk,femaleAssetId:Fe.VO_F_Welcome_EU_sbk}]}setEnabled(e){this._enabled=e,this._playedClips.forEach((t=>{t.mute(!e)}))}setVoiceType(e){this._voiceType=e}async welcome(e){const t=this._welcomeAssetConfig.find((e=>e.brand===this._brand&&e.gameType==this._gameType));if(!t)return void this._log.error(`Could not find welcome audio asset id for brand '${this._brand}', game type '${this._gameType}', voice: '${this._voiceType}'`);const i="female"===this._voiceType?t.femaleAssetId:t.maleAssetId,s=await this.play({name:i.name});await s.waitForCompletion()}async announceNumber(e,t){const i=this.getNumberAssetId(e);if(!i)return void this._log.error(`Could not find an audio asset id for number '${e.name}', voice: '${this._voiceType}'`);const s=await this.play({name:i.name},t);if(await s.waitForCompletion(),t?.aborted)return;const r=this.getColorAssetId(e);if(r){const e=await this.play({name:r.name},t);await e.waitForCompletion()}if(t?.aborted)return;const n=this.getParityAssetId(e);if(n){const e=await this.play({name:n.name},t);await e.waitForCompletion()}}async winLow(e){const t=`VO_${this.voiceToken}_Winner_Reg`,i=await this.play({name:t},e);await i.waitForCompletion()}async winMid(e){const t=`VO_${this.voiceToken}_Winner_High`,i=await this.play({name:t},e);await i.waitForCompletion()}async winHigh(e){const t=`VO_${this.voiceToken}_Winner_Big`,i=await this.play({name:t},e);await i.waitForCompletion()}async placeYourBets(e){const t="male"===this._voiceType?Fe.VO_M_Place_Your_Bets:Fe.VO_F_Place_Your_Bets,i=await this.play({name:t.name},e);await i.waitForCompletion()}async noMoreBets(e){const t="male"===this._voiceType?Fe.VO_M_No_More_Bets:Fe.VO_F_No_More_Bets,i=await this.play({name:t.name},e);await i.waitForCompletion()}async hereWeGo(e,t){this._currentHereWeGoPlayback&&this._currentHereWeGoPlayback.stop();const i="male"===e?Fe.VO_M_HereWeGo:Fe.VO_F_HereWeGo,s=await this.play({name:i.name},t),r=this;this._currentHereWeGoPlayback=s,s.waitForCompletion().then((()=>{r._currentHereWeGoPlayback===s&&(r._currentHereWeGoPlayback=null)}))}get voiceToken(){return"male"===this._voiceType?"M":"F"}getNumberAssetId(e){const t=e===this._numSet.N00?"00":e.value.toString(),i=`VO_${this.voiceToken}_${t}`;return Fe.AllVoiceIDs.find((e=>e.name===i))}getColorAssetId(e){if(e.color===At.None)return;const t=e.color===At.Black?"Black":"Red",i=`VO_${this.voiceToken}_${t}`;return Fe.AllVoiceIDs.find((e=>e.name===i))}getParityAssetId(e){if(e.color===At.None)return;const t=e.value%2==0?"Even":"Odd",i=`VO_${this.voiceToken}_${t}`;return Fe.AllVoiceIDs.find((e=>e.name===i))}async play(e,t){const i=await this._bjAudioPlayer.play(e,t);return i.mute(!this._enabled),this._playedClips.add(i),i.waitForCompletion().then((()=>{this._playedClips.delete(i)})),i}}class OT{constructor(e,t){this._betsStateObservable=e,this._audioEventHandler=t,this._currentAnnouncementTask=null}async announceAfter(e){const t=this,i=new qt;let s;const r=new AbortController,n=this._betsStateObservable.subscribe((e=>{e.placedBetsCollection.currentTotalBet>0&&r.abort("bets placed")}));return i.add(new yt(n)),this._currentAnnouncementTask&&await this._currentAnnouncementTask.abort(),i.add({dispose:()=>{t._currentAnnouncementTask===s&&(t._currentAnnouncementTask=null)}}),s=new ri((s=>new Promise(((r,n)=>e.then((()=>{if(!s.aborted)return t._audioEventHandler.play(or.PlaceYourBets)})).catch((e=>{si.isAbortError(e)?r():n(e)})).finally((()=>{i.dispose(),r()}))))),r.signal),this._currentAnnouncementTask=s,s.promise}}class BT{constructor(e){this._playedClips=new Set,this._enabled=!0,this._bjAudioPlayer=e.bjAudioPlayer}setEnabled(e){this._enabled=e,this._playedClips.forEach((t=>{t.mute(!e)}))}async play(e,t){const i=await this._bjAudioPlayer.play(e,t);return i.mute(!this._enabled),this._playedClips.add(i),i.waitForCompletion().then((()=>{this._playedClips.delete(i)})),i}}class DT{constructor(e,t,i,s){this._offsetPointerObservable=e,this._uiContainer=i;const r=new vr("drag-Indicator");r.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,r.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,r.width=r.height="15px",r.background="#00ff00c8",i.addControl(r,!0),r.isVisible=!1,t.subscribe((e=>{r.isVisible=e})),e.subscribe((e=>{const t=s.getHardwareScalingLevel(),n=s.getRenderWidth()*t,o=s.getRenderHeight()*t,a=i.guiSizeObservable.value;r.left=100*(e.x/n-7.5/a.width)+"%",r.top=100*(e.y/o-7.5/a.height)+"%"}))}}class FT{constructor(e,t,i,s){this._betTypeDisplayPriority=[z.Low,z.Even,z.Red,z.Black,z.Odd,z.High,z.Dozen,z.Column,z.Basket,z.SixLine,z.Corner,z.Street,z.Split,z.StraightUp],this._stacksPool=e,this._betStackPositionGetter=t,this._audioEventHandler=i,this._log=s}async removeLosingBets(e,t){const i=e.Hit,s=e.BetsSnapshot.placedBets.filter((e=>!e.spot.contains(i)&&e.cents>0));if(0==s.length)return;this._audioEventHandler.play(or.ClearTable);let r=[];for(let e=0;e<s.length;e++){const i=s[e],n=this._stacksPool.getChipStackForSpot(i.spot),o=n.absolutePosition.clone(),a=new gt.Pq(-3,o.y,o.z),h={_progress:0,set progress(e){this._progress=e,n.absolutePosition=gt.Pq.Lerp(o,a,e)},get progress(){return this._progress}};r.push(Jt.add({target:h,duration:.8,ease:$t.easeInOutCubic},{progress:1},t).then((()=>{n.clear()})).finally((()=>{n.absolutePosition=this._betStackPositionGetter.getAbsolutePositionForBet(i.spot)})))}await Promise.all(r)}async animateWinningBets(e,t){const i=e.Hit,s=e.BetsSnapshot.placedBets.filter((e=>e.spot.contains(i)&&e.cents>0)).sort(((e,t)=>e.cents-t.cents||this.getBetTypeDisplayPriority(e.spot.type)-this.getBetTypeDisplayPriority(t.spot.type)||e.spot.numbers[0].value-t.spot.numbers[0].value||(e.spot.numbers.at(-1)?.value||0)-(t.spot.numbers.at(-1)?.value||0)));if(0==s.length)return;let r=[];for(let i=0;i<s.length;i++){const n=s[i],o=this._stacksPool.getChipStackForSpot(n.spot),a=e.WinPerSpot?.get(n.spot)??0,h=o.getScale().clone(),l=1.5,c=new gt.Pq(h.x*l,h.y*l,h.z*l),u={_progress:0,set progress(e){this._progress=e;const t=2*(.5-Math.abs(.5-e));o.setScale(gt.Pq.Lerp(h,c,t))},get progress(){return this._progress}};o.setValue(a),t?.aborted||this._audioEventHandler.play(or.PlaceChipsStack),r.push(Jt.add({target:u,duration:.3,ease:$t.easeOutExpo},{progress:1},t).finally((()=>{o.setScale(h)}))),t?.aborted||await si.Delay(750,t)}await Promise.all(r)}getBetTypeDisplayPriority(e){return this._betTypeDisplayPriority.indexOf(e)}}class LT{getWinForBet(e){switch(e.spot.type){case z.StraightUp:return 36*e.cents;case z.Split:return 18*e.cents;case z.Street:return 12*e.cents;case z.Corner:return 9*e.cents;case z.Basket:return 7*e.cents;case z.SixLine:return 6*e.cents;case z.Dozen:case z.Column:return 3*e.cents;case z.Low:case z.High:case z.Black:case z.Red:case z.Odd:case z.Even:return 2*e.cents;default:throw new Z(`Unsupported bet type: ${e.spot.type}`)}}}class NT{constructor(e,t){this._maxHitsNumber=0,this._numbersAges=new Map,this._history=[],this._numberHitsDescending=new Array,this._currentStats=new Q(UT.Empty),this._lastNumbersHistroryLength=e.lastNumbersHistroryLength,this._hotNumbersCount=e.hotNumbersCount,this._coldNumbersCount=e.coldNumbersCount,this._numberHitsDescending=e.allNumbers.map((e=>new kT(e))),this._log=t,this._totalNumbers=0}addWinningNumber(e){this._totalNumbers++,this._log.debug(`Total numbers hit: ${this._totalNumbers}`),this.updateNumbersAges(e);const t=++(this._numberHitsDescending.find((t=>t.number===e))||(()=>{const t=new kT(e);return this._numberHitsDescending.push(t),t})()).hits;t>this._maxHitsNumber&&(this._maxHitsNumber=t);const i=e=>this._numbersAges.get(e)??999999,s=e=>e.value===K.DOUBLE_ZERO_ID?.5:e.value;this._numberHitsDescending.sort(((e,t)=>t.hits-e.hits||i(e.number)-i(t.number)||s(e.number)-s(t.number)));const r=this._numberHitsDescending.slice(0,Math.min(this._hotNumbersCount,this._totalNumbers)),n=0===(this._numberHitsDescending.at(-this._coldNumbersCount-1)?.hits||0)?[]:this._numberHitsDescending.slice(-this._coldNumbersCount);this._history.unshift(e),this._history.length>this._lastNumbersHistroryLength&&(this._history.length=this._lastNumbersHistroryLength),this._currentStats.next(new UT({coldNumbers:n,hotNumbers:r,history:this._history,hitMap:this._numberHitsDescending,totalNumbers:this._totalNumbers,maxHitsNumber:this._maxHitsNumber}))}updateNumbersAges(e){this._numbersAges.forEach(((e,t)=>{this._numbersAges.set(t,e+1)})),this._numbersAges.set(e,0)}get currentStats(){return this._currentStats}}class kT{constructor(e,t){this.number=e,this._hits=t||0}set hits(e){this._hits=e}get hits(){return this._hits}}class UT{constructor(e){this.history=e.history,this.hitMap=e.hitMap,this.hotNumbers=e.hotNumbers,this.coldNumbers=e.coldNumbers,this.totalNumbers=e.totalNumbers,this.maxHitsNumber=e.maxHitsNumber}}UT.Empty=new UT({history:[],hitMap:[],hotNumbers:[],coldNumbers:[],totalNumbers:0,maxHitsNumber:0});class VT{constructor(){this._rebetSnapshot=null}set rebetSnapshot(e){this._rebetSnapshot=e}get rebetSnapshot(){return this._rebetSnapshot}}class GT{constructor(){this._timeScale=new Q(1)}get timeScale(){return this._timeScale}setTimeScale(e){this._timeScale.next(e)}}class zT{constructor(e){this._clientEmitter=e}showOverBalance(){this._clientEmitter.emit("GameShowOverBalance")}}class HT{constructor(e,t,i,s){this._placedBetsCollection=e,this._showOverBalanceCmd=t,this._showOverBetLimitCmd=i,this._showPartialBetPrompt=s}async tryAddBet(e,t,i){const s=this._placedBetsCollection.tryAddBet(e,t,i);switch(s.status){case H.ErrorInsufficientFunds:this._showOverBalanceCmd.showOverBalance();break;case H.ErrorTotalMaxBetExceeded:this._showOverBetLimitCmd.show("table");break;case H.ErrorSpotMaxBetExceeded:this._showOverBetLimitCmd.show("spot");break;case H.WarningPartialLimitedByTable:return await this._showPartialBetPrompt.show("table",s.addedCents),s?await this.tryAddBet(e,s.addedCents,!1):ie.Cancelled;case H.WarningPartialLimitedBySpot:return await this._showPartialBetPrompt.show("spot",s.addedCents)?await this.tryAddBet(e,s.addedCents,!1):ie.Cancelled}return s}async tryDouble(e,t){const i=this._placedBetsCollection.getBetSpotCents(e);return this.tryAddBet(e,i,t)}tryApplySnapshot(e,t){const i=this._placedBetsCollection.tryApplySnapshot(e,t);switch(i){case H.ErrorInsufficientFunds:this._showOverBalanceCmd.showOverBalance();break;case H.ErrorTotalMaxBetExceeded:this._showOverBetLimitCmd.show("table");break;case H.ErrorSpotMaxBetExceeded:this._showOverBetLimitCmd.show("spot")}return i}get placedBetsCollection(){return this._placedBetsCollection}}class WT{constructor(e){this._clientEmitter=e}show(e){this._clientEmitter.emit("GameBetWouldExceedLimit",e)}}class XT{constructor(e,t){this._clientEmitter=e,this._currencyFormatter=t}show(e,t){const i=this;return new Promise((s=>{const r=e=>{i._clientEmitter.removeListener("FramePartialBetAnswer",r),s(e)},n=i._currencyFormatter.centsToCurrencyString(t);i._clientEmitter.addListener("FramePartialBetAnswer",r),i._clientEmitter.emit("GameBetExceedsLimitPartialPrompt",e,n)}))}}class qT{constructor(e){this._timeoutId=void 0,this._minIntervalReached=new Q(!0),this._minIntervalS=e}trackGameStarted(){const e=this;this._minIntervalReached.value&&this._minIntervalReached.next(!1),void 0!==this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=setTimeout((()=>{e._minIntervalReached.next(!0)}),1e3*this._minIntervalS)}get minIntervalReachedObservable(){return this._minIntervalReached}}class QT{constructor(e,t,i,s,r,n,o){this._presetsState=new Q(void 0),this._presetsWithPageInfo=[],this._clientEmitter=e,this._pagingParams=t,this._pagePrefix=i,this._catalogKey=s,this._catalog=new YT(void 0),this._numSet=r,this._betOptions=n,this._log=o}async load(e){const t=this;return new Promise((i=>{if(!e||0===e.length)return void i([]);const s=JSON.parse(e),r=YT.fromJSON(s);if(r===YT.Empty)return void i([]);t._catalog.set(r.favBetsAddresses);const n=[];t._catalog.favBetsAddresses.forEach((e=>{const i=e.segment*t._pagingParams.segmentSize;for(let s=0;s<e.pages;s++){const e=i+s;n.push(`${t._pagePrefix}${e}`)}})),t._clientEmitter.emit("GameGetOptionsKeys",n,!0),t._clientEmitter.once("FrameOptionsKeys",(e=>{try{const s=[];t._catalog.favBetsAddresses.forEach((i=>{let r="";const n=i.segment*t._pagingParams.segmentSize;for(let s=0;s<i.pages;s++){const i=n+s,o=`${t._pagePrefix}${i}`;r+=e.get(o)??""}const o=JSON.parse(r);if(o){const e=Ur.fromJSON(o,t._numSet,t._betOptions);s.push(new KT(e,i))}})),i(s)}catch(e){t._log.error(`Error while loading fav. bets: ${e.message}`),t._catalog.set([]),i([])}}))})).then((e=>(t._presetsWithPageInfo=[...e],t.udpatePresetsState(),e))).catch((e=>(t._log.error(`Error while loading fav. bets: ${e.message}`),t._catalog.set([]),[])))}delete(e){const t=this._presetsWithPageInfo.find((t=>t.preset===e))?.pageInfo;if(!t)return!1;this._catalog.deleteAtSegment(t.segment);const i=new Map;return i.set(this._catalogKey,this._catalog.toJSONString()),this._clientEmitter.emit("GameSetOptions",i,!1),this._presetsWithPageInfo=this._presetsWithPageInfo.filter((t=>t.preset!=e)),this.udpatePresetsState(),!0}async addLast(e){if(this._presetsWithPageInfo.length===this._pagingParams.maxSlots)return!1;let t=0;for(;this._presetsWithPageInfo.find((e=>e.pageInfo.segment===t));)t++;const i=e.toJSONString(),s=Math.ceil(i.length/this._pagingParams.pageSize),r=new Map;for(let e=0;e<s;e++){const s=t*this._pagingParams.segmentSize,n=e*this._pagingParams.pageSize,o=n+this._pagingParams.pageSize,a=i.substring(n,o),h=s+e;r.set(`${this._pagePrefix}${h}`,a)}const n=new jT(t,s);return this._catalog.add(n),this._presetsWithPageInfo.push(new KT(e,n)),r.set(this._catalogKey,JSON.stringify(this._catalog.toJSONString())),this._clientEmitter.emit("GameSetOptions",r,!0),this.udpatePresetsState(),!0}udpatePresetsState(){this._presetsState.next(this._presetsWithPageInfo.map((e=>e.preset)))}get presetsState(){return this._presetsState}}class KT{constructor(e,t){this.preset=e,this.pageInfo=t}}class YT{constructor(e){this._favBetsAddresses=[...e||[]]}set(e){this._favBetsAddresses=[...e]}deleteAtSegment(e){return this._favBetsAddresses=this._favBetsAddresses.filter((t=>t.segment!==e)),this.favBetsAddresses}add(e){return this._favBetsAddresses.push(e),this.favBetsAddresses}get favBetsAddresses(){return[...this._favBetsAddresses]}toJSONString(){return`[${this._favBetsAddresses.map((e=>e.toJSONString())).join(",")}]`}static fromJSON(e){return e?new YT(e.map((e=>jT.fromJSON(e)))):YT.Empty}}YT.Empty=new YT(void 0);class jT{constructor(e,t){this.segment=e,this.pages=t}toJSONString(){return`[${this.segment},${this.pages}]`}static fromJSON(e){return new jT(e[0],e[1])}}class ZT extends Sr{static async build(e,t){const[i,s,r]=await Promise.all([t.load(Ne.IntroDialog_BG),t.load(Ne.IntroDialog_OK),t.load(Ne.IntroDialog_DontShowAgain)]),n=new ZT(e,{background:i,btnOk:s,btnDontShowAgain:r});return n.zIndex=gn.FullScreenOverlay,e.addControl(n),n.onDisposeObservable.addOnce((()=>{t.release(Ne.IntroDialog_BG),t.release(Ne.IntroDialog_OK),t.release(Ne.IntroDialog_DontShowAgain)})),n}get optionSelected(){return this._optionSelected}constructor(e,t){const i={w:t.background.width,h:t.background.height},s=xt;super("dlg-Intro",e,pr.calculateRefSizeConfig({contentRefSize:i,refResLandscape:s,screenFraction:{landscape:{width:.5,height:.9},portrait:{width:.9,height:.9}}}),{shroud:!0}),this._interactive=!1,this._optionSelected=new X;const r=this,n=pr.createImage(t.background,"intro-bg");n.width=n.height="100%",this.addControlToRoot(n);const o=fn.buildStandardRectButton("btn-Ok",t.btnOk,{cornerRadius:.5,height:"72.5%",width:256/280*100+"%",left:"0%",top:"0%",vAlign:xs.VERTICAL_ALIGNMENT_TOP},e,void 0,!0),a={width:1.5*t.background.width,height:1.5*t.background.height};this.addControlToRoot(o),o.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,o.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP;const h=1.3;pr.setRelativeSize({containerSize:a,control:o,controlSize:{width:t.btnOk.width*h,height:t.btnOk.height*h}}),o.left="35%",o.top="85%";const l=new qt,c=o.onPointerClickObservable.addOnce((()=>{r._optionSelected.next("close")})),u=fn.buildStandardRectButton("btn-DSA",t.btnDontShowAgain,{cornerRadius:.5,height:"72.5%",width:422/448*100+"%",left:"0%",top:"0%",vAlign:xs.VERTICAL_ALIGNMENT_TOP},e,void 0,!0);this.addControlToRoot(u),u.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,u.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,u.isVisible=!1,pr.setRelativeSize({containerSize:a,control:u,controlSize:{width:t.btnDontShowAgain.width*h,height:t.btnDontShowAgain.height*h}}),u.left="-5%",u.top="85%";const d=u.onPointerClickObservable.addOnce((()=>{r._optionSelected.next("dontShowAgain")}));l.add({dispose:()=>{c.remove(),d.remove()}}),this._btnOk=o,this._btnDSA=u,o.isEnabled=!1,u.isEnabled=!1,this._disposable=l}dispose(){this._disposable.dispose(),super.dispose()}show(e){const t=this;return super.show(e).then((()=>{setTimeout((()=>{t._btnOk.isEnabled=!0,t._interactive=!0}),750)}))}forceClose(){this._optionSelected.next("close")}onShroudClicked(){this._interactive&&this._optionSelected.next("close")}}class $T{constructor(e){this._viewLoading=e.viewLoading,e.viewLoading.then((t=>{const i=t.optionSelected.subscribe((s=>{i.unsubscribe(),e.audioEventHandler.play(or.UI_Click),"close"===s&&t.dispose()}))}))}get optionSelected(){return this._view.optionSelected}async show(){const e=await this._viewLoading;await e.show(),this._view=e}close(){this._view.forceClose()}}class JT{constructor(e){const t=new Set;let i=null;e.addEventListener("pointerdown",(e=>{e.type,e.pointerId,0===t.size?i=e.pointerId:(t.size,e.preventDefault(),e.stopPropagation()),t.add(e.pointerId),t.size}),{capture:!0,passive:!1}),e.addEventListener("pointerup",(e=>{e.type,e.pointerId,e.pointerId!==i&&(e.preventDefault(),e.stopPropagation()),t.delete(e.pointerId)&&t.size}),{capture:!0,passive:!1}),["pointercancel","pointerenter","pointerleave","pointermove","pointerout","pointerover"].forEach((t=>{e.addEventListener(t,(e=>{e.pointerId!==i&&(e.preventDefault(),e.stopPropagation())}),{capture:!0,passive:!1})})),["touchstart","touchcancel","touchend","touchmove","gotpointercapture","lostpointercapture","mousedown","mousemove","mouseup","click","dblclick"].forEach((t=>{e.addEventListener(t,(e=>{e.preventDefault(),e.stopPropagation()}),{capture:!0,passive:!1})}))}}class ey extends As{get isVertical(){return this._isVertical}set isVertical(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())}get spacing(){return this._spacing}set spacing(e){this._spacing!==e&&(this._spacing=e,this._markAsDirty())}set width(e){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()}get width(){return this._width.toString(this._host)}set height(e){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()}get height(){return this._height.toString(this._host)}constructor(e){super(e),this.name=e,this._isVertical=!0,this._manualWidth=!1,this._manualHeight=!1,this._doNotTrackManualChanges=!1,this._spacing=0,this.ignoreLayoutWarnings=!1}_getTypeName(){return"StackPanel"}_preMeasure(e,t){for(const e of this._children)this._isVertical?e.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP:e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT;super._preMeasure(e,t)}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.copyFrom(e),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)}_postMeasure(){let e=0,t=0;const i=this._children.length;for(let s=0;s<i;s++){const r=this._children[s];if(r.isVisible&&!r.notRenderable)if(this._isVertical){const e=t+"px";r.top!==e&&(r.top=e,this._rebuildLayout=!0,r._top.ignoreAdaptiveScaling=!0),this.ignoreLayoutWarnings||r.isDimensionFullyDefined("height")?t+=r._currentMeasure.height+r._paddingTopInPixels+r._paddingBottomInPixels+(s<i-1?this._spacing:0):It.V.Warn(`Control (Name:${r.name}, UniqueId:${r.uniqueId}) is using height in percentage mode inside a vertical StackPanel`,1)}else{const t=e+"px";r.left!==t&&(r.left=t,this._rebuildLayout=!0,r._left.ignoreAdaptiveScaling=!0),this.ignoreLayoutWarnings||r.isDimensionFullyDefined("width")?e+=r._currentMeasure.width+r._paddingLeftInPixels+r._paddingRightInPixels+(s<i-1?this._spacing:0):It.V.Warn(`Control (Name:${r.name}, UniqueId:${r.uniqueId}) is using width in percentage mode inside a horizontal StackPanel`,1)}}e+=this._paddingLeftInPixels+this._paddingRightInPixels,t+=this._paddingTopInPixels+this._paddingBottomInPixels,this._doNotTrackManualChanges=!0;let s=!1,r=!1;if((!this._manualHeight||this.adaptHeightToChildren)&&this._isVertical){const e=this.height;this.height=t+"px",r=e!==this.height||!this._height.ignoreAdaptiveScaling}if((!this._manualWidth||this.adaptWidthToChildren)&&!this._isVertical){const t=this.width;this.width=e+"px",s=t!==this.width||!this._width.ignoreAdaptiveScaling}r&&(this._height.ignoreAdaptiveScaling=!0),s&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(s||r)&&(this._rebuildLayout=!0),super._postMeasure()}_getManualDim(e){return"width"===e?this._manualWidth:this._manualHeight}isDimensionFullyDefined(e){if("height"===e?this.isVertical:!this.isVertical&&!this._getManualDim(e)){for(const t of this._children)if(!t.isDimensionFullyDefined(e))return!1;return!0}return this.getDimension(e).isPixel||this._getAdaptDimTo(e)}serialize(e,t){super.serialize(e,t),(this.isSerializable||t)&&(e.manualWidth=this._manualWidth,e.manualHeight=this._manualHeight)}_parseFromContent(e,t){this._manualWidth=e.manualWidth,this._manualHeight=e.manualHeight,super._parseFromContent(e,t)}}(0,Et.Cg)([(0,Rt.lK)()],ey.prototype,"ignoreLayoutWarnings",void 0),(0,Et.Cg)([(0,Rt.lK)()],ey.prototype,"isVertical",null),(0,Et.Cg)([(0,Rt.lK)()],ey.prototype,"spacing",null),(0,Et.Cg)([(0,Rt.lK)()],ey.prototype,"width",null),(0,Et.Cg)([(0,Rt.lK)()],ey.prototype,"height",null),(0,Ft.Y5)("BABYLON.GUI.StackPanel",ey);class ty extends xs{get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get checkSizeRatio(){return this._checkSizeRatio}set checkSizeRatio(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get isChecked(){return this._isChecked}set isChecked(e){this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e))}constructor(e){super(e),this.name=e,this._isChecked=!1,this._background="black",this._checkSizeRatio=.8,this._thickness=1,this.onIsCheckedChangedObservable=new Zi.cP,this.isPointerBlocker=!0}_getTypeName(){return"Checkbox"}_draw(e){e.save(),this._applyStates(e);const t=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,t,i),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._isChecked){e.fillStyle=this._isEnabled?this.color?this.color:"#ffffff":this._disabledColorItem;const s=t*this._checkSizeRatio,r=i*this._checkSizeRatio;e.fillRect(this._currentMeasure.left+this._thickness/2+(t-s)/2,this._currentMeasure.top+this._thickness/2+(i-r)/2,s,r)}e.strokeStyle=this.color,e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,t,i),e.restore()}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(this.isReadOnly||(this.isChecked=!this.isChecked),!0)}static AddCheckBoxWithHeader(e,t){const i=new ey;i.isVertical=!1,i.height="30px";const s=new ty;s.width="20px",s.height="20px",s.isChecked=!0,s.color="green",s.onIsCheckedChangedObservable.add(t),i.addControl(s);const r=new lr;return r.text=e,r.width="180px",r.paddingLeft="5px",r.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,r.color="white",i.addControl(r),i}}(0,Et.Cg)([(0,Rt.lK)()],ty.prototype,"thickness",null),(0,Et.Cg)([(0,Rt.lK)()],ty.prototype,"checkSizeRatio",null),(0,Et.Cg)([(0,Rt.lK)()],ty.prototype,"background",null),(0,Et.Cg)([(0,Rt.lK)()],ty.prototype,"isChecked",null),(0,Ft.Y5)("BABYLON.GUI.Checkbox",ty);class iy extends As{set clipContent(e){this._clipContent=e;for(const t in this._cells)this._cells[t].clipContent=e}get clipContent(){return this._clipContent}set clipChildren(e){this._clipChildren=e;for(const t in this._cells)this._cells[t].clipChildren=e}get clipChildren(){return this._clipChildren}get columnCount(){return this._columnDefinitions.length}get rowCount(){return this._rowDefinitions.length}get children(){return this._childControls}get cells(){return this._cells}getRowDefinition(e){return e<0||e>=this._rowDefinitions.length?null:this._rowDefinitions[e]}getColumnDefinition(e){return e<0||e>=this._columnDefinitions.length?null:this._columnDefinitions[e]}addRowDefinition(e,t=!1){return this._rowDefinitions.push(new ds(e,t?ds.UNITMODE_PIXEL:ds.UNITMODE_PERCENTAGE)),this._rowDefinitionObservers.push(this._rowDefinitions[this.rowCount-1].onChangedObservable.add((()=>this._markAsDirty()))),this._markAsDirty(),this}addColumnDefinition(e,t=!1){return this._columnDefinitions.push(new ds(e,t?ds.UNITMODE_PIXEL:ds.UNITMODE_PERCENTAGE)),this._columnDefinitionObservers.push(this._columnDefinitions[this.columnCount-1].onChangedObservable.add((()=>this._markAsDirty()))),this._markAsDirty(),this}setRowDefinition(e,t,i=!1){if(e<0||e>=this._rowDefinitions.length)return this;const s=this._rowDefinitions[e];return s&&s.isPixel===i&&s.value===t||(this._rowDefinitions[e].onChangedObservable.remove(this._rowDefinitionObservers[e]),this._rowDefinitions[e]=new ds(t,i?ds.UNITMODE_PIXEL:ds.UNITMODE_PERCENTAGE),this._rowDefinitionObservers[e]=this._rowDefinitions[e].onChangedObservable.add((()=>this._markAsDirty())),this._markAsDirty()),this}setColumnDefinition(e,t,i=!1){if(e<0||e>=this._columnDefinitions.length)return this;const s=this._columnDefinitions[e];return s&&s.isPixel===i&&s.value===t||(this._columnDefinitions[e].onChangedObservable.remove(this._columnDefinitionObservers[e]),this._columnDefinitions[e]=new ds(t,i?ds.UNITMODE_PIXEL:ds.UNITMODE_PERCENTAGE),this._columnDefinitionObservers[e]=this._columnDefinitions[e].onChangedObservable.add((()=>this._markAsDirty())),this._markAsDirty()),this}getChildrenAt(e,t){const i=this._cells[`${e}:${t}`];return i?i.children:null}getChildCellInfo(e){return e._tag}_removeCell(e,t){if(e){super.removeControl(e);for(const t of e.children){const e=this._childControls.indexOf(t);-1!==e&&this._childControls.splice(e,1)}delete this._cells[t]}}_offsetCell(e,t){if(this._cells[t]){this._cells[e]=this._cells[t];for(const t of this._cells[e].children)t._tag=e;delete this._cells[t]}}removeColumnDefinition(e){if(e<0||e>=this._columnDefinitions.length)return this;for(let t=0;t<this._rowDefinitions.length;t++){const i=`${t}:${e}`,s=this._cells[i];this._removeCell(s,i)}for(let t=0;t<this._rowDefinitions.length;t++)for(let i=e+1;i<this._columnDefinitions.length;i++){const e=`${t}:${i-1}`,s=`${t}:${i}`;this._offsetCell(e,s)}return this._columnDefinitions[e].onChangedObservable.remove(this._columnDefinitionObservers[e]),this._columnDefinitions.splice(e,1),this._columnDefinitionObservers.splice(e,1),this._markAsDirty(),this}removeRowDefinition(e){if(e<0||e>=this._rowDefinitions.length)return this;for(let t=0;t<this._columnDefinitions.length;t++){const i=`${e}:${t}`,s=this._cells[i];this._removeCell(s,i)}for(let t=0;t<this._columnDefinitions.length;t++)for(let i=e+1;i<this._rowDefinitions.length;i++){const e=`${i-1}:${t}`,s=`${i}:${t}`;this._offsetCell(e,s)}return this._rowDefinitions[e].onChangedObservable.remove(this._rowDefinitionObservers[e]),this._rowDefinitions.splice(e,1),this._rowDefinitionObservers.splice(e,1),this._markAsDirty(),this}addControl(e,t=0,i=0){if(0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(e))return $i.S0.Warn(`Control (Name:${e.name}, UniqueId:${e.uniqueId}) is already associated with this grid. You must remove it before reattaching it`),this;const s=`${Math.min(t,this._rowDefinitions.length-1)}:${Math.min(i,this._columnDefinitions.length-1)}`;let r=this._cells[s];return r||(r=new As(s),this._cells[s]=r,r.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,r.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,r.clipContent=this.clipContent,r.clipChildren=this.clipChildren,super.addControl(r)),r.addControl(e),this._childControls.push(e),e._tag=s,e.parent=this,this._markAsDirty(),this}removeControl(e){const t=this._childControls.indexOf(e);-1!==t&&this._childControls.splice(t,1);const i=this._cells[e._tag];return i&&(i.removeControl(e),e._tag=null),this._markAsDirty(),this}constructor(e){super(e),this.name=e,this._rowDefinitions=new Array,this._rowDefinitionObservers=[],this._columnDefinitions=new Array,this._columnDefinitionObservers=[],this._cells={},this._childControls=new Array}_getTypeName(){return"Grid"}_getGridDefinitions(e){const t=[],i=[],s=[],r=[];let n=this._currentMeasure.width,o=0,a=this._currentMeasure.height,h=0,l=0;for(const e of this._rowDefinitions){if(e.isPixel){const t=e.getValue(this._host);a-=t,i[l]=t}else h+=e.value;l++}let c=0;l=0;for(const e of this._rowDefinitions){if(r.push(c),e.isPixel)c+=e.getValue(this._host);else{const t=Math.round(e.value/h*a);c+=t,i[l]=t}l++}l=0;for(const e of this._columnDefinitions){if(e.isPixel){const i=e.getValue(this._host);n-=i,t[l]=i}else o+=e.value;l++}let u=0;l=0;for(const e of this._columnDefinitions){if(s.push(u),e.isPixel)u+=e.getValue(this._host);else{const i=Math.round(e.value/o*n);u+=i,t[l]=i}l++}e(s,r,t,i)}_additionalProcessing(e,t){this._getGridDefinitions(((e,t,i,s)=>{for(const r in this._cells){if(!Object.prototype.hasOwnProperty.call(this._cells,r))continue;const n=r.split(":"),o=parseInt(n[0]),a=parseInt(n[1]),h=this._cells[r];h.leftInPixels=e[a],h.topInPixels=t[o],h.widthInPixels=i[a],h.heightInPixels=s[o],h._left.ignoreAdaptiveScaling=!0,h._top.ignoreAdaptiveScaling=!0,h._width.ignoreAdaptiveScaling=!0,h._height.ignoreAdaptiveScaling=!0}})),super._additionalProcessing(e,t)}_flagDescendantsAsMatrixDirty(){for(const e in this._cells)Object.prototype.hasOwnProperty.call(this._cells,e)&&this._cells[e]._markMatrixAsDirty()}_renderHighlightSpecific(e){super._renderHighlightSpecific(e),this._getGridDefinitions(((t,i,s,r)=>{for(let i=0;i<t.length;i++){const r=this._currentMeasure.left+t[i]+s[i];e.beginPath(),e.moveTo(r,this._currentMeasure.top),e.lineTo(r,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(let t=0;t<i.length;t++){const s=this._currentMeasure.top+i[t]+r[t];e.beginPath(),e.moveTo(this._currentMeasure.left,s),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,s),e.stroke()}})),e.restore()}dispose(){super.dispose();for(const e of this._childControls)e.dispose();for(let e=0;e<this._rowDefinitions.length;e++)this._rowDefinitions[e].onChangedObservable.remove(this._rowDefinitionObservers[e]);for(let e=0;e<this._columnDefinitions.length;e++)this._columnDefinitions[e].onChangedObservable.remove(this._columnDefinitionObservers[e]);this._rowDefinitionObservers.length=0,this._rowDefinitions.length=0,this._columnDefinitionObservers.length=0,this._columnDefinitions.length=0,this._cells={},this._childControls.length=0}serialize(e,t){if(super.serialize(e,t),this.isSerializable||t){e.columnCount=this.columnCount,e.rowCount=this.rowCount,e.columns=[],e.rows=[],e.tags=[];for(let t=0;t<this.columnCount;++t){const i=this.getColumnDefinition(t),s={value:i?.getValue(this.host),unit:i?.unit};e.columns.push(s)}for(let t=0;t<this.rowCount;++t){const i=this.getRowDefinition(t),s={value:i?.getValue(this.host),unit:i?.unit};e.rows.push(s)}this.children.forEach((t=>{e.tags.push(t._tag)}))}}_parseFromContent(e,t){super._parseFromContent(e,t);const i=[];this.children.forEach((e=>{i.push(e)})),this.removeRowDefinition(0),this.removeColumnDefinition(0);for(let t=0;t<e.columnCount;++t){const i=e.columns[t].value,s=e.columns[t].unit;this.addColumnDefinition(i,1===s)}for(let t=0;t<e.rowCount;++t){const i=e.rows[t].value,s=e.rows[t].unit;this.addRowDefinition(i,1===s)}for(let t=0;t<i.length;++t){const s=e.tags[t];let r=parseInt(s.substring(0,s.search(":")));isNaN(r)&&(r=0);let n=parseInt(s.substring(s.search(":")+1));isNaN(n)&&(n=0),this.addControl(i[t],r,n)}}}(0,Et.Cg)([(0,Rt.lK)()],iy.prototype,"clipContent",null),(0,Ft.Y5)("BABYLON.GUI.Grid",iy);class sy extends xs{get value(){return this._value}set value(e){this._value.equals(e)||(this._value.copyFrom(e),this._value.toHSVToRef(this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=sy._Epsilon&&(this._value.r=0),this._value.g<=sy._Epsilon&&(this._value.g=0),this._value.b<=sy._Epsilon&&(this._value.b=0),this._value.r>=1-sy._Epsilon&&(this._value.r=1),this._value.g>=1-sy._Epsilon&&(this._value.g=1),this._value.b>=1-sy._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))}get width(){return this._width.toString(this._host)}set width(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&(0===this._width.getValue(this._host)&&(e="1px",this._width.fromString(e)),this._height.fromString(e),this._markAsDirty())}get height(){return this._height.toString(this._host)}set height(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&(0===this._height.getValue(this._host)&&(e="1px",this._height.fromString(e)),this._width.fromString(e),this._markAsDirty())}get size(){return this.width}set size(e){this.width=e}constructor(e){super(e),this.name=e,this._value=bt.v9.Red(),this._tmpColor=new bt.v9,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._squareLeft=0,this._squareTop=0,this._squareSize=0,this._h=360,this._s=1,this._v=1,this._lastPointerDownId=-1,this.onValueChangedObservable=new Zi.cP,this._pointerIsDown=!1,this.value=new bt.v9(.88,.1,.1),this.size="200px",this.isPointerBlocker=!0}_getTypeName(){return"ColorPicker"}_preMeasure(e){e.width<e.height?this._currentMeasure.height=e.width:this._currentMeasure.width=e.height}_updateSquareProps(){const e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),t=2*(e-.2*e)/Math.sqrt(2),i=e-.5*t;this._squareLeft=this._currentMeasure.left+i,this._squareTop=this._currentMeasure.top+i,this._squareSize=t}_drawGradientSquare(e,t,i,s,r,n){const o=n.createLinearGradient(t,i,s+t,i);o.addColorStop(0,"#fff"),o.addColorStop(1,"hsl("+e+", 100%, 50%)"),n.fillStyle=o,n.fillRect(t,i,s,r);const a=n.createLinearGradient(t,i,t,r+i);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"#000"),n.fillStyle=a,n.fillRect(t,i,s,r)}_drawCircle(e,t,i,s){s.beginPath(),s.arc(e,t,i+1,0,2*Math.PI,!1),s.lineWidth=3,s.strokeStyle="#333333",s.stroke(),s.beginPath(),s.arc(e,t,i,0,2*Math.PI,!1),s.lineWidth=3,s.strokeStyle="#ffffff",s.stroke()}_createColorWheelCanvas(e,t){const i=os.q.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");const s=i.createCanvas(2*e,2*e),r=s.getContext("2d"),n=r.getImageData(0,0,2*e,2*e),o=n.data,a=this._tmpColor,h=e*e,l=e-t,c=l*l;for(let t=-e;t<e;t++)for(let i=-e;i<e;i++){const s=t*t+i*i;if(s>h||s<c)continue;const r=Math.sqrt(s),n=Math.atan2(i,t);bt.v9.HSVtoRGBToRef(180*n/Math.PI+180,r/e,1,a);const u=4*(t+e+2*(i+e)*e);o[u]=255*a.r,o[u+1]=255*a.g,o[u+2]=255*a.b;let d=(r-l)/(e-l),_=.2;const p=.2,g=.04,f=50,m=150;_=e<f?p:e>m?g:(g-p)*(e-f)/(m-f)+p,d=(r-l)/(e-l),o[u+3]=d<_?d/_*255:d>1-_?255*(1-(d-(1-_))/_):255}return r.putImageData(n,0,0),s}_draw(e){e.save(),this._applyStates(e);const t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=.2*t,s=this._currentMeasure.left,r=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*t||(this._colorWheelCanvas=this._createColorWheelCanvas(t,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),e.drawImage(this._colorWheelCanvas,s,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,e);let n=this._squareLeft+this._squareSize*this._s,o=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(n,o,.04*t,e);const a=t-.5*i;n=s+t+Math.cos((this._h-180)*Math.PI/180)*a,o=r+t+Math.sin((this._h-180)*Math.PI/180)*a,this._drawCircle(n,o,.35*i,e),e.restore()}_updateValueFromPointer(e,t){if(this._pointerStartedOnWheel){const i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),s=i+this._currentMeasure.left,r=i+this._currentMeasure.top;this._h=180*Math.atan2(t-r,e-s)/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(e-this._squareLeft)/this._squareSize,this._v=1-(t-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,sy._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,sy._Epsilon));bt.v9.HSVtoRGBToRef(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor}_isPointOnSquare(e,t){this._updateSquareProps();const i=this._squareLeft,s=this._squareTop,r=this._squareSize;return e>=i&&e<=i+r&&t>=s&&t<=s+r}_isPointOnWheel(e,t){const i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),s=i-.2*i,r=e-(i+this._currentMeasure.left),n=t-(i+this._currentMeasure.top),o=r*r+n*n;return o<=i*i&&o>=s*s}_onPointerDown(e,t,i,s,r){if(!super._onPointerDown(e,t,i,s,r))return!1;if(this.isReadOnly)return!0;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(t.x,t.y,this._transformedPosition);const n=this._transformedPosition.x,o=this._transformedPosition.y;return this._isPointOnSquare(n,o)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(n,o)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(n,o),this._host._capturingControl[i]=this,this._lastPointerDownId=i,!0}_onPointerMove(e,t,i,s){if(i==this._lastPointerDownId){if(!this.isReadOnly){this._invertTransformMatrix.transformCoordinates(t.x,t.y,this._transformedPosition);const e=this._transformedPosition.x,i=this._transformedPosition.y;this._pointerIsDown&&this._updateValueFromPointer(e,i)}super._onPointerMove(e,t,i,s)}}_onPointerUp(e,t,i,s,r,n){this._pointerIsDown=!1,delete this._host._capturingControl[i],super._onPointerUp(e,t,i,s,r,n)}_onCanvasBlur(){this._forcePointerUp(),super._onCanvasBlur()}static ShowPickerDialogAsync(e,t){return new Promise((i=>{t.pickerWidth=t.pickerWidth||"640px",t.pickerHeight=t.pickerHeight||"400px",t.headerHeight=t.headerHeight||"35px",t.lastColor=t.lastColor||"#000000",t.swatchLimit=t.swatchLimit||20,t.numSwatchesPerLine=t.numSwatchesPerLine||10;const s=t.swatchLimit/t.numSwatchesPerLine,r=parseFloat(t.pickerWidth)/t.numSwatchesPerLine,n=Math.floor(.25*r),o=n*(t.numSwatchesPerLine+1),a=Math.floor((parseFloat(t.pickerWidth)-o)/t.numSwatchesPerLine),h=a*s+n*(s+1),l=(parseInt(t.pickerHeight)+h+Math.floor(.25*a)).toString()+"px",c="#c0c0c0",u="#535353",d="#414141",_="515151",p=bt.v9.FromHexString("#dddddd"),g=p.r+p.g+p.b;let f,m;const b=["R","G","B"],v="#454545",T="#f0f0f0";let y,x,A,C,S,E=!1;const R=new iy;if(R.name="Dialog Container",R.width=t.pickerWidth,t.savedColors){R.height=l;const e=parseInt(t.pickerHeight)/parseInt(l);R.addRowDefinition(e,!1),R.addRowDefinition(1-e,!1)}else R.height=t.pickerHeight,R.addRowDefinition(1,!1);if(e.addControl(R),t.savedColors){x=new iy,x.name="Swatch Drawer",x.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,x.background=u,x.width=t.pickerWidth;const e=t.savedColors.length/t.numSwatchesPerLine;let i;i=0==e?0:e+1,x.height=(a*e+i*n).toString()+"px",x.top=Math.floor(.25*a).toString()+"px";for(let e=0;e<2*Math.ceil(t.savedColors.length/t.numSwatchesPerLine)+1;e++)e%2!=0?x.addRowDefinition(a,!0):x.addRowDefinition(n,!0);for(let e=0;e<2*t.numSwatchesPerLine+1;e++)e%2!=0?x.addColumnDefinition(a,!0):x.addColumnDefinition(n,!0);R.addControl(x,1,0)}const P=new iy;P.name="Picker Panel",P.height=t.pickerHeight;const I=parseInt(t.headerHeight)/parseInt(t.pickerHeight),M=[I,1-I];P.addRowDefinition(M[0],!1),P.addRowDefinition(M[1],!1),R.addControl(P,0,0);const w=new cr;w.name="Dialogue Header Bar",w.background="#cccccc",w.thickness=0,P.addControl(w,0,0);const O=ur.CreateSimpleButton("closeButton","a");O.fontFamily="coreglyphs";const B=bt.v9.FromHexString(w.background),D=new bt.v9(1-B.r,1-B.g,1-B.b);O.color=D.toHexString(),O.fontSize=Math.floor(.6*parseInt(t.headerHeight)),O.textBlock.textVerticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,O.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_RIGHT,O.height=O.width=t.headerHeight,O.background=w.background,O.thickness=0,O.pointerDownAnimation=()=>{},O.pointerUpAnimation=()=>{O.background=w.background},O.pointerEnterAnimation=()=>{O.color=w.background,O.background="red"},O.pointerOutAnimation=()=>{O.color=D.toHexString(),O.background=w.background},O.onPointerClickObservable.add((()=>{Re(Z.background)})),P.addControl(O,0,0);const F=new iy;F.name="Dialogue Body",F.background=u;const L=[.4375,.5625];F.addRowDefinition(1,!1),F.addColumnDefinition(L[0],!1),F.addColumnDefinition(L[1],!1),P.addControl(F,1,0);const N=new iy;N.name="Picker Grid",N.addRowDefinition(.85,!1),N.addRowDefinition(.15,!1),F.addControl(N,0,0);const k=new sy;k.name="GUI Color Picker",t.pickerHeight<t.pickerWidth?k.width=.89:k.height=.89,k.value=bt.v9.FromHexString(t.lastColor),k.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,k.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,k.onPointerDownObservable.add((()=>{S=k.name,C="",Ae(!1)})),k.onValueChangedObservable.add((function(e){S==k.name&&ve(e,k.name)})),N.addControl(k,0,0);const U=new iy;U.name="Dialogue Right Half",U.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT;const V=[.514,.486];U.addRowDefinition(V[0],!1),U.addRowDefinition(V[1],!1),F.addControl(U,1,1);const G=new iy;G.name="Swatches and Buttons";const z=[.417,.583];G.addRowDefinition(1,!1),G.addColumnDefinition(z[0],!1),G.addColumnDefinition(z[1],!1),U.addControl(G,0,0);const H=new iy;H.name="New and Current Swatches";const W=[.04,.16,.64,.16];H.addRowDefinition(W[0],!1),H.addRowDefinition(W[1],!1),H.addRowDefinition(W[2],!1),H.addRowDefinition(W[3],!1),G.addControl(H,0,0);const X=new iy;X.name="Active Swatches",X.width=.67,X.addRowDefinition(.5,!1),X.addRowDefinition(.5,!1),H.addControl(X,2,0);const q=Math.floor(parseInt(t.pickerWidth)*L[1]*z[0]*.11),Q=Math.floor(parseInt(t.pickerHeight)*M[1]*V[0]*W[1]*.5);let K;K=t.pickerWidth>t.pickerHeight?Q:q;const Y=new lr;Y.text="new",Y.name="New Color Label",Y.color=c,Y.fontSize=K,H.addControl(Y,1,0);const j=new cr;j.name="New Color Swatch",j.background=t.lastColor,j.thickness=0,X.addControl(j,0,0);const Z=ur.CreateSimpleButton("currentSwatch","");Z.background=t.lastColor,Z.thickness=0,Z.onPointerClickObservable.add((()=>{ve(bt.v9.FromHexString(Z.background),Z.name),Ae(!1)})),Z.pointerDownAnimation=()=>{},Z.pointerUpAnimation=()=>{},Z.pointerEnterAnimation=()=>{},Z.pointerOutAnimation=()=>{},X.addControl(Z,1,0);const $=new cr;$.name="Swatch Outline",$.width=.67,$.thickness=2,$.color="#404040",$.isHitTestVisible=!1,H.addControl($,2,0);const J=new lr;J.name="Current Color Label",J.text="current",J.color=c,J.fontSize=K,H.addControl(J,3,0);const ee=new iy;ee.name="Button Grid",ee.height=.8;const te=1/3;ee.addRowDefinition(te,!1),ee.addRowDefinition(te,!1),ee.addRowDefinition(te,!1),G.addControl(ee,0,1);const ie=Math.floor(parseInt(t.pickerWidth)*L[1]*z[1]*.67).toString()+"px",se=Math.floor(parseInt(t.pickerHeight)*M[1]*V[0]*(parseFloat(ee.height.toString())/100)*te*.7).toString()+"px";f=parseFloat(ie)>parseFloat(se)?Math.floor(.45*parseFloat(se)):Math.floor(.11*parseFloat(ie));const re=ur.CreateSimpleButton("butOK","OK");re.width=ie,re.height=se,re.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,re.thickness=2,re.color=c,re.fontSize=f,re.background=u,re.onPointerEnterObservable.add((()=>{re.background=d})),re.onPointerOutObservable.add((()=>{re.background=u})),re.pointerDownAnimation=()=>{re.background=_},re.pointerUpAnimation=()=>{re.background=d},re.onPointerClickObservable.add((()=>{Ae(!1),Re(j.background)})),ee.addControl(re,0,0);const ne=ur.CreateSimpleButton("butCancel","Cancel");ne.width=ie,ne.height=se,ne.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,ne.thickness=2,ne.color=c,ne.fontSize=f,ne.background=u,ne.onPointerEnterObservable.add((()=>{ne.background=d})),ne.onPointerOutObservable.add((()=>{ne.background=u})),ne.pointerDownAnimation=()=>{ne.background=_},ne.pointerUpAnimation=()=>{ne.background=d},ne.onPointerClickObservable.add((()=>{Ae(!1),Re(Z.background)})),ee.addControl(ne,1,0),t.savedColors&&(A=ur.CreateSimpleButton("butSave","Save"),A.width=ie,A.height=se,A.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,A.thickness=2,A.fontSize=f,t.savedColors.length<t.swatchLimit?(A.color=c,A.background=u):Ee(A,!0),A.onPointerEnterObservable.add((()=>{t.savedColors&&t.savedColors.length<t.swatchLimit&&(A.background=d)})),A.onPointerOutObservable.add((()=>{t.savedColors&&t.savedColors.length<t.swatchLimit&&(A.background=u)})),A.pointerDownAnimation=()=>{t.savedColors&&t.savedColors.length<t.swatchLimit&&(A.background=_)},A.pointerUpAnimation=()=>{t.savedColors&&t.savedColors.length<t.swatchLimit&&(A.background=d)},A.onPointerClickObservable.add((()=>{t.savedColors&&(0==t.savedColors.length&&Se(!0),t.savedColors.length<t.swatchLimit&&Ce(j.background,A),Ae(!1))})),t.savedColors.length>0&&Se(!0),ee.addControl(A,2,0));const oe=new iy;oe.name="Dialog Lower Right",oe.addRowDefinition(.02,!1),oe.addRowDefinition(.63,!1),oe.addRowDefinition(.21,!1),oe.addRowDefinition(.14,!1),U.addControl(oe,1,0);const ae=bt.v9.FromHexString(t.lastColor),he=new iy;he.name="RGB Values",he.width=.82,he.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,he.addRowDefinition(1/3,!1),he.addRowDefinition(1/3,!1),he.addRowDefinition(1/3,!1),he.addColumnDefinition(.1,!1),he.addColumnDefinition(.2,!1),he.addColumnDefinition(.7,!1),oe.addControl(he,1,0);for(let e=0;e<b.length;e++){const t=new lr;t.text=b[e],t.color=c,t.fontSize=f,he.addControl(t,e,0)}const le=new Gr;le.width=.83,le.height=.72,le.name="rIntField",le.fontSize=f,le.text=(255*ae.r).toString(),le.color=T,le.background=v,le.onFocusObservable.add((()=>{S=le.name,C=le.text,Ae(!1)})),le.onBlurObservable.add((()=>{""==le.text&&(le.text="0"),Te(le,"r"),S==le.name&&(S="")})),le.onTextChangedObservable.add((()=>{S==le.name&&Te(le,"r")})),he.addControl(le,0,1);const ce=new Gr;ce.width=.83,ce.height=.72,ce.name="gIntField",ce.fontSize=f,ce.text=(255*ae.g).toString(),ce.color=T,ce.background=v,ce.onFocusObservable.add((()=>{S=ce.name,C=ce.text,Ae(!1)})),ce.onBlurObservable.add((()=>{""==ce.text&&(ce.text="0"),Te(ce,"g"),S==ce.name&&(S="")})),ce.onTextChangedObservable.add((()=>{S==ce.name&&Te(ce,"g")})),he.addControl(ce,1,1);const ue=new Gr;ue.width=.83,ue.height=.72,ue.name="bIntField",ue.fontSize=f,ue.text=(255*ae.b).toString(),ue.color=T,ue.background=v,ue.onFocusObservable.add((()=>{S=ue.name,C=ue.text,Ae(!1)})),ue.onBlurObservable.add((()=>{""==ue.text&&(ue.text="0"),Te(ue,"b"),S==ue.name&&(S="")})),ue.onTextChangedObservable.add((()=>{S==ue.name&&Te(ue,"b")})),he.addControl(ue,2,1);const de=new Gr;de.width=.95,de.height=.72,de.name="rDecField",de.fontSize=f,de.text=ae.r.toString(),de.color=T,de.background=v,de.onFocusObservable.add((()=>{S=de.name,C=de.text,Ae(!1)})),de.onBlurObservable.add((()=>{0!=parseFloat(de.text)&&""!=de.text||(de.text="0",ye(de,"r")),S==de.name&&(S="")})),de.onTextChangedObservable.add((()=>{S==de.name&&ye(de,"r")})),he.addControl(de,0,2);const _e=new Gr;_e.width=.95,_e.height=.72,_e.name="gDecField",_e.fontSize=f,_e.text=ae.g.toString(),_e.color=T,_e.background=v,_e.onFocusObservable.add((()=>{S=_e.name,C=_e.text,Ae(!1)})),_e.onBlurObservable.add((()=>{0!=parseFloat(_e.text)&&""!=_e.text||(_e.text="0",ye(_e,"g")),S==_e.name&&(S="")})),_e.onTextChangedObservable.add((()=>{S==_e.name&&ye(_e,"g")})),he.addControl(_e,1,2);const pe=new Gr;pe.width=.95,pe.height=.72,pe.name="bDecField",pe.fontSize=f,pe.text=ae.b.toString(),pe.color=T,pe.background=v,pe.onFocusObservable.add((()=>{S=pe.name,C=pe.text,Ae(!1)})),pe.onBlurObservable.add((()=>{0!=parseFloat(pe.text)&&""!=pe.text||(pe.text="0",ye(pe,"b")),S==pe.name&&(S="")})),pe.onTextChangedObservable.add((()=>{S==pe.name&&ye(pe,"b")})),he.addControl(pe,2,2);const ge=new iy;ge.name="Hex Value",ge.width=.82,ge.addRowDefinition(1,!1),ge.addColumnDefinition(.1,!1),ge.addColumnDefinition(.9,!1),oe.addControl(ge,2,0);const fe=new lr;fe.text="#",fe.color=c,fe.fontSize=f,ge.addControl(fe,0,0);const me=new Gr;me.width=.96,me.height=.72,me.name="hexField",me.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,me.fontSize=f;const be=t.lastColor.split("#");function ve(e,t){S=t;const i=e.toHexString();if(j.background=i,le.name!=S&&(le.text=Math.floor(255*e.r).toString()),ce.name!=S&&(ce.text=Math.floor(255*e.g).toString()),ue.name!=S&&(ue.text=Math.floor(255*e.b).toString()),de.name!=S&&(de.text=e.r.toString()),_e.name!=S&&(_e.text=e.g.toString()),pe.name!=S&&(pe.text=e.b.toString()),me.name!=S){const e=i.split("#");me.text=e[1]}k.name!=S&&(k.value=e)}function Te(e,t){let i=e.text;if(/[^0-9]/g.test(i))e.text=C;else if(""!=i&&(Math.floor(parseInt(i))<0?i="0":Math.floor(parseInt(i))>255?i="255":isNaN(parseInt(i))&&(i="0")),S==e.name&&(C=i),""!=i){i=parseInt(i).toString(),e.text=i;const s=bt.v9.FromHexString(j.background);S==e.name&&ve("r"==t?new bt.v9(parseInt(i)/255,s.g,s.b):"g"==t?new bt.v9(s.r,parseInt(i)/255,s.b):new bt.v9(s.r,s.g,parseInt(i)/255),e.name)}}function ye(e,t){let i=e.text;if(/[^0-9.]/g.test(i))return void(e.text=C);""!=i&&"."!=i&&0!=parseFloat(i)&&(parseFloat(i)<0?i="0.0":parseFloat(i)>1?i="1.0":isNaN(parseFloat(i))&&(i="0.0")),S==e.name&&(C=i),""!=i&&"."!=i&&0!=parseFloat(i)?(i=parseFloat(i).toString(),e.text=i):i="0.0";const s=bt.v9.FromHexString(j.background);S==e.name&&ve("r"==t?new bt.v9(parseFloat(i),s.g,s.b):"g"==t?new bt.v9(s.r,parseFloat(i),s.b):new bt.v9(s.r,s.g,parseFloat(i)),e.name)}function xe(){if(t.savedColors&&t.savedColors[y]){let e;e=E?"b":"";const i=ur.CreateSimpleButton("Swatch_"+y,e);i.fontFamily="coreglyphs";const s=bt.v9.FromHexString(t.savedColors[y]),r=s.r+s.g+s.b;i.color=r>g?"#aaaaaa":"#ffffff",i.fontSize=Math.floor(.7*a),i.textBlock.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,i.height=i.width=a.toString()+"px",i.background=t.savedColors[y],i.thickness=2;const n=y;return i.pointerDownAnimation=()=>{i.thickness=4},i.pointerUpAnimation=()=>{i.thickness=3},i.pointerEnterAnimation=()=>{i.thickness=3},i.pointerOutAnimation=()=>{i.thickness=2},i.onPointerClickObservable.add((()=>{var e;E?(e=n,t.savedColors&&t.savedColors.splice(e,1),t.savedColors&&0==t.savedColors.length&&(Se(!1),E=!1),Ce("",A)):t.savedColors&&ve(bt.v9.FromHexString(t.savedColors[n]),i.name)})),i}return null}function Ae(e){let t;if(void 0!==e&&(E=e),E){for(let e=0;e<x.children.length;e++)t=x.children[e],t.textBlock.text="b";void 0!==m&&(m.textBlock.text="Done")}else{for(let e=0;e<x.children.length;e++)t=x.children[e],t.textBlock.text="";void 0!==m&&(m.textBlock.text="Edit")}}function Ce(e,i){if(t.savedColors){""!=e&&t.savedColors.push(e),y=0,x.clearControls();const s=Math.ceil(t.savedColors.length/t.numSwatchesPerLine);let r;if(r=0==s?0:s+1,x.rowCount!=s+r){const e=x.rowCount;for(let t=0;t<e;t++)x.removeRowDefinition(0);for(let e=0;e<s+r;e++)e%2?x.addRowDefinition(a,!0):x.addRowDefinition(n,!0)}x.height=(a*s+r*n).toString()+"px";for(let e=1,i=1;e<s+r;e+=2,i++){let s;s=t.savedColors.length>i*t.numSwatchesPerLine?t.numSwatchesPerLine:t.savedColors.length-(i-1)*t.numSwatchesPerLine;const r=Math.min(Math.max(s,0),t.numSwatchesPerLine);for(let i=0,s=1;i<r;i++){if(i>t.numSwatchesPerLine)continue;const r=xe();null!=r&&(x.addControl(r,e,s),s+=2,y++)}}t.savedColors.length>=t.swatchLimit?Ee(i,!0):Ee(i,!1)}}function Se(e){e?(m=ur.CreateSimpleButton("butEdit","Edit"),m.width=ie,m.height=se,m.left=Math.floor(.1*parseInt(ie)).toString()+"px",m.top=(-1*parseFloat(m.left)).toString()+"px",m.verticalAlignment=xs.VERTICAL_ALIGNMENT_BOTTOM,m.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,m.thickness=2,m.color=c,m.fontSize=f,m.background=u,m.onPointerEnterObservable.add((()=>{m.background=d})),m.onPointerOutObservable.add((()=>{m.background=u})),m.pointerDownAnimation=()=>{m.background=_},m.pointerUpAnimation=()=>{m.background=d},m.onPointerClickObservable.add((()=>{E=!E,Ae()})),N.addControl(m,1,0)):N.removeControl(m)}function Ee(e,t){t?(e.color="#555555",e.background="#454545"):(e.color=c,e.background=u)}function Re(s){t.savedColors&&t.savedColors.length>0?i({savedColors:t.savedColors,pickedColor:s}):i({pickedColor:s}),e.removeControl(R)}me.text=be[1],me.color=T,me.background=v,me.onFocusObservable.add((()=>{S=me.name,C=me.text,Ae(!1)})),me.onBlurObservable.add((()=>{if(3==me.text.length){const e=me.text.split("");me.text=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}""==me.text&&(me.text="000000",ve(bt.v9.FromHexString(me.text),"b")),S==me.name&&(S="")})),me.onTextChangedObservable.add((()=>{let e=me.text;const t=/[^0-9A-F]/i.test(e);if((me.text.length>6||t)&&S==me.name)me.text=C;else{if(me.text.length<6){const t=6-me.text.length;for(let i=0;i<t;i++)e="0"+e}if(3==me.text.length){const t=me.text.split("");e=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}e="#"+e,S==me.name&&(C=me.text,ve(bt.v9.FromHexString(e),me.name))}})),ge.addControl(me,0,1),t.savedColors&&t.savedColors.length>0&&Ce("",A)}))}}sy._Epsilon=1e-6,(0,Et.Cg)([(0,Rt.lK)()],sy.prototype,"value",null),(0,Et.Cg)([(0,Rt.lK)()],sy.prototype,"width",null),(0,Et.Cg)([(0,Rt.lK)()],sy.prototype,"height",null),(0,Et.Cg)([(0,Rt.lK)()],sy.prototype,"size",null),(0,Ft.Y5)("BABYLON.GUI.ColorPicker",sy),(0,Ft.Y5)("BABYLON.GUI.FocusableButton",class extends ur{constructor(e){super(e),this.name=e,this._unfocusedColor=this.color}_onPointerDown(e,t,i,s,r){return this.isReadOnly||this.focus(),super._onPointerDown(e,t,i,s,r)}});class ry extends Gr{get autoStretchHeight(){return this._autoStretchHeight}set autoStretchHeight(e){this._autoStretchHeight!==e&&(this._autoStretchHeight=e,this._markAsDirty())}set height(e){this.fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==e&&(this._height.fromString(e)&&this._markAsDirty(),this._autoStretchHeight=!1)}get maxHeight(){return this._maxHeight.toString(this._host)}get maxHeightInPixels(){return this._maxHeight.getValueInPixel(this._host,this._cachedParentMeasure.height)}set maxHeight(e){this._maxHeight.toString(this._host)!==e&&this._maxHeight.fromString(e)&&this._markAsDirty()}constructor(e,t=""){super(e),this.name=e,this._textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this._textVerticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this._prevText=this.text,this._lineSpacing=new ds(0),this._maxHeight=new ds(1,ds.UNITMODE_PERCENTAGE,!1),this.onLinesReadyObservable=new Zi.cP,this.text=t,this.isPointerBlocker=!0,this.onLinesReadyObservable.add((()=>this._updateCursorPosition())),this._highlightCursorInfo={initialStartIndex:-1,initialRelativeStartIndex:-1,initialLineIndex:-1},this._cursorInfo={globalStartIndex:0,globalEndIndex:0,relativeEndIndex:0,relativeStartIndex:0,currentLineIndex:0}}_getTypeName(){return"InputTextArea"}processKeyboard(e){this.isReadOnly||(this.alternativeProcessKey(e.code,e.key,e),this.onKeyboardEventProcessedObservable.notifyObservers(e))}alternativeProcessKey(e,t,i){if(!i||!i.ctrlKey&&!i.metaKey||"c"!==t&&"v"!==t&&"x"!==t){switch(e){case"Period":i&&i.shiftKey&&i.preventDefault();break;case"Backspace":!this._isTextHighlightOn&&this._cursorInfo.globalStartIndex>0&&(this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex--),this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,i&&i.preventDefault(),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();break;case"Delete":!this._isTextHighlightOn&&this._cursorInfo.globalEndIndex<this.text.length&&(this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex+1),this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,i&&i.preventDefault(),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();break;case"NumpadEnter":case"Enter":return this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,"\n"),this._cursorInfo.globalStartIndex++,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._textHasChanged();case"End":return this._cursorInfo.globalStartIndex=this.text.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case"Home":return this._cursorInfo.globalStartIndex=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case"ArrowLeft":return this._markAsDirty(),i&&i.shiftKey?((i.ctrlKey||i.metaKey)&&(this._cursorInfo.globalStartIndex-=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex),this._isTextHighlightOn?this._cursorInfo.globalEndIndex>this._highlightCursorInfo.initialStartIndex?this._cursorInfo.globalEndIndex--:this._cursorInfo.globalStartIndex--:(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex--,this._isTextHighlightOn=!0),this._blinkIsEven=!0,void i.preventDefault()):(this._isTextHighlightOn?this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex:i&&(i.ctrlKey||i.metaKey)?(this._cursorInfo.globalStartIndex-=this._cursorInfo.relativeStartIndex,i.preventDefault()):this._cursorInfo.globalStartIndex>0&&this._cursorInfo.globalStartIndex--,this._blinkIsEven=!1,void(this._isTextHighlightOn=!1));case"ArrowRight":if(this._markAsDirty(),i&&i.shiftKey){if(i.ctrlKey||i.metaKey){const e=this._lines[this._cursorInfo.currentLineIndex].text.length-this._cursorInfo.relativeEndIndex-1;this._cursorInfo.globalEndIndex+=e,this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex}return this._isTextHighlightOn?this._cursorInfo.globalStartIndex<this._highlightCursorInfo.initialStartIndex?this._cursorInfo.globalStartIndex++:this._cursorInfo.globalEndIndex++:(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex++,this._isTextHighlightOn=!0),this._blinkIsEven=!0,void i.preventDefault()}if(this._isTextHighlightOn)this._cursorInfo.globalStartIndex=this._cursorInfo.globalEndIndex;else if(i&&(i.ctrlKey||i.metaKey)){const e=this._lines[this._cursorInfo.currentLineIndex].text.length-this._cursorInfo.relativeEndIndex;this._cursorInfo.globalStartIndex+=e}else this._cursorInfo.globalStartIndex<this.text.length&&this._cursorInfo.globalStartIndex++;return this._blinkIsEven=!1,void(this._isTextHighlightOn=!1);case"ArrowUp":if(this._blinkIsEven=!1,i&&(i.shiftKey?(this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex),this._isTextHighlightOn=!0,this._blinkIsEven=!0):this._isTextHighlightOn=!1,i.preventDefault()),0===this._cursorInfo.currentLineIndex)this._cursorInfo.globalStartIndex=0;else{const e=this._lines[this._cursorInfo.currentLineIndex],t=this._lines[this._cursorInfo.currentLineIndex-1];let i=0,s=0;!this._isTextHighlightOn||this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(i=this._cursorInfo.globalStartIndex,s=this._cursorInfo.relativeStartIndex):(i=this._cursorInfo.globalEndIndex,s=this._cursorInfo.relativeEndIndex);const r=e.text.substring(0,s),n=this._contextForBreakLines.measureText(r).width;let o=0,a=0;i-=s,i-=t.text.length+t.lineEnding.length;let h=0;for(;o<n&&h<t.text.length;)i++,h++,a=Math.abs(n-o),o=this._contextForBreakLines.measureText(t.text.substring(0,h)).width;Math.abs(n-o)>a&&h>0&&i--,this._isTextHighlightOn?this._cursorInfo.currentLineIndex<=this._highlightCursorInfo.initialLineIndex?(this._cursorInfo.globalStartIndex=i,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeEndIndex=this._highlightCursorInfo.initialRelativeStartIndex):this._cursorInfo.globalEndIndex=i:this._cursorInfo.globalStartIndex=i}return void this._markAsDirty();case"ArrowDown":if(this._blinkIsEven=!1,i&&(i.shiftKey?(this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex),this._isTextHighlightOn=!0,this._blinkIsEven=!0):this._isTextHighlightOn=!1,i.preventDefault()),this._cursorInfo.currentLineIndex===this._lines.length-1)this._cursorInfo.globalStartIndex=this.text.length;else{const e=this._lines[this._cursorInfo.currentLineIndex],t=this._lines[this._cursorInfo.currentLineIndex+1];let i=0,s=0;!this._isTextHighlightOn||this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(i=this._cursorInfo.globalStartIndex,s=this._cursorInfo.relativeStartIndex):(i=this._cursorInfo.globalEndIndex,s=this._cursorInfo.relativeEndIndex);const r=e.text.substring(0,s),n=this._contextForBreakLines.measureText(r).width;let o=0,a=0;i+=e.text.length-s+e.lineEnding.length;let h=0;for(;o<n&&h<t.text.length;)i++,h++,a=Math.abs(n-o),o=this._contextForBreakLines.measureText(t.text.substring(0,h)).width;Math.abs(n-o)>a&&h>0&&i--,this._isTextHighlightOn?this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(this._cursorInfo.globalStartIndex=i,this._cursorInfo.globalStartIndex>this._cursorInfo.globalEndIndex&&(this._cursorInfo.globalEndIndex+=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex=this._cursorInfo.globalEndIndex-this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex-=this._cursorInfo.globalStartIndex)):(this._cursorInfo.globalEndIndex=i,this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex):this._cursorInfo.globalStartIndex=i}return void this._markAsDirty()}if("a"===t&&i&&(i.ctrlKey||i.metaKey))return this.selectAllText(),void i.preventDefault();1===t?.length&&(i?.preventDefault(),this._currentKey=t,this.onBeforeKeyAddObservable.notifyObservers(this),t=this._currentKey,this._addKey&&(this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,t),this._cursorInfo.globalStartIndex+=t.length,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._textHasChanged()))}}_parseLineWordWrap(e="",t,i){const s=[],r=e.split(" ");let n=0;for(let o=0;o<r.length;o++){const a=o>0?e+" "+r[o]:r[0],h=i.measureText(a).width;if(h>t){o>0&&(n=i.measureText(e).width,s.push({text:e,width:n,lineEnding:" "})),e=r[o];let a="";e.split("").map((e=>{i.measureText(a+e).width>t&&(s.push({text:a,width:i.measureText(a).width,lineEnding:""}),a=""),a+=e})),e=a,n=i.measureText(e).width}else n=h,e=a}return s.push({text:e,width:n,lineEnding:" "}),s}_breakLines(e,t){const i=[],s=(this.text||this.placeholderText).split("\n");if(this.clipContent)for(const r of s)i.push(...this._parseLineWordWrap(r,e,t));else for(const e of s)i.push(this._parseLine(e,t));return i[i.length-1].lineEnding="\n",i}_parseLine(e="",t){return{text:e,width:t.measureText(e).width,lineEnding:" "}}_preMeasure(e,t){this._fontOffset&&!this._wasDirty||(this._fontOffset=xs._GetFontOffset(t.font,this._host.getScene()?.getEngine()));let i=this._beforeRenderText(this._textWrapper).text;!this.text&&this._placeholderText&&(i=this._placeholderText),this._textWidth=t.measureText(i).width;const s=2*this._margin.getValueInPixel(this._host,e.width);if(this._autoStretchWidth){const r=i.split("\n").reduce(((e,i)=>t.measureText(i).width>t.measureText(e).width?i:e),""),n=t.measureText(r).width;this.width=Math.min(this._maxWidth.getValueInPixel(this._host,e.width),n+s)+"px",this.autoStretchWidth=!0}if(this._availableWidth=this._width.getValueInPixel(this._host,e.width)-s,this._lines=this._breakLines(this._availableWidth,t),this._contextForBreakLines=t,this._autoStretchHeight){const t=this._lines.length*this._fontOffset.height+2*this._margin.getValueInPixel(this._host,e.height);this.height=Math.min(this._maxHeight.getValueInPixel(this._host,e.height),t)+"px",this._autoStretchHeight=!0}if(this._availableHeight=this._height.getValueInPixel(this._host,e.height)-s,this._isFocused){this._cursorInfo.currentLineIndex=0;let e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length,t=0;for(;t+e<=this._cursorInfo.globalStartIndex;)t+=e,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length)}}_textHasChanged(){!this._prevText&&this._textWrapper.text&&this.placeholderText&&(this._cursorInfo.currentLineIndex=0,this._cursorInfo.globalStartIndex=1,this._cursorInfo.globalEndIndex=1,this._cursorInfo.relativeStartIndex=1,this._cursorInfo.relativeEndIndex=1),super._textHasChanged()}_computeScroll(){if(this._clipTextLeft=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width),this._clipTextTop=this._currentMeasure.top+this._margin.getValueInPixel(this._host,this._cachedParentMeasure.height),this._isFocused&&this._lines[this._cursorInfo.currentLineIndex].width>this._availableWidth){const e=this._clipTextLeft-this._lines[this._cursorInfo.currentLineIndex].width+this._availableWidth;this._scrollLeft||(this._scrollLeft=e)}else this._scrollLeft=this._clipTextLeft;if(this._isFocused){const e=(this._cursorInfo.currentLineIndex+1)*this._fontOffset.height,t=this._clipTextTop-e;this._scrollTop||(this._scrollTop=t)}else this._scrollTop=this._clipTextTop}_additionalProcessing(){this.highlightedText="",this.onLinesReadyObservable.notifyObservers(this)}_drawText(e,t,i,s){const r=this._currentMeasure.width;let n=this._scrollLeft;switch(this._textHorizontalAlignment){case xs.HORIZONTAL_ALIGNMENT_LEFT:n+=0;break;case xs.HORIZONTAL_ALIGNMENT_RIGHT:n+=r-t;break;case xs.HORIZONTAL_ALIGNMENT_CENTER:n+=(r-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(s.shadowColor=this.shadowColor,s.shadowBlur=this.shadowBlur,s.shadowOffsetX=this.shadowOffsetX,s.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&s.strokeText(e,this._currentMeasure.left+n,i),s.fillText(e,n,i)}_onCopyText(e){this._isTextHighlightOn=!1;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText}_onCutText(e){if(this._highlightedText){try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText,this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._textHasChanged()}}_onPasteText(e){let t="";t=e.clipboardData&&-1!==e.clipboardData.types.indexOf("text/plain")?e.clipboardData.getData("text/plain"):this._host.clipboardData,this._isTextHighlightOn=!1,this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,t);const i=t.length-(this._cursorInfo.globalEndIndex-this._cursorInfo.globalStartIndex);this._cursorInfo.globalStartIndex+=i,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._clickedCoordinateX=null,this._clickedCoordinateY=null,super._textHasChanged()}_draw(e){this._computeScroll(),this._scrollLeft=this._scrollLeft??0,this._scrollTop=this._scrollTop??0,e.save(),this._applyStates(e),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(e.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this.color&&(e.fillStyle=this.color);const t=this._currentMeasure.height,i=this._currentMeasure.width;let s=0;switch(this._textVerticalAlignment){case xs.VERTICAL_ALIGNMENT_TOP:s=this._fontOffset.ascent;break;case xs.VERTICAL_ALIGNMENT_BOTTOM:s=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case xs.VERTICAL_ALIGNMENT_CENTER:s=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}e.save(),e.beginPath(),e.fillStyle=this.fontStyle,!this._textWrapper.text&&this.placeholderText&&(e.fillStyle=this._placeholderColor),e.rect(this._clipTextLeft,this._clipTextTop,this._availableWidth+2,this._availableHeight+2),e.clip(),s+=this._scrollTop;for(let t=0;t<this._lines.length;t++){const i=this._lines[t];0!==t&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?s+=this._lineSpacing.getValue(this._host):s+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(i.text,i.width,s,e),s+=this._fontOffset.height}if(e.restore(),this._isFocused){if(!this._blinkIsEven||this._isTextHighlightOn){let t=this._scrollLeft+e.measureText(this._lines[this._cursorInfo.currentLineIndex].text.substring(0,this._cursorInfo.relativeStartIndex)).width;t<this._clipTextLeft?(this._scrollLeft+=this._clipTextLeft-t,t=this._clipTextLeft,this._markAsDirty()):t>this._clipTextLeft+this._availableWidth&&(this._scrollLeft+=this._clipTextLeft+this._availableWidth-t,t=this._clipTextLeft+this._availableWidth,this._markAsDirty());let i=this._scrollTop+this._cursorInfo.currentLineIndex*this._fontOffset.height;i<this._clipTextTop?(this._scrollTop+=this._clipTextTop-i,i=this._clipTextTop,this._markAsDirty()):i+this._fontOffset.height>this._clipTextTop+this._availableHeight&&this._availableHeight>this._fontOffset.height&&(this._scrollTop+=this._clipTextTop+this._availableHeight-i-this._fontOffset.height,i=this._clipTextTop+this._availableHeight-this._fontOffset.height,this._markAsDirty()),this._isTextHighlightOn||e.fillRect(t,i,2,this._fontOffset.height)}if(this._resetBlinking(),this._isTextHighlightOn){clearTimeout(this._blinkTimeout),this._highlightedText=this.text.substring(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),e.globalAlpha=this._highligherOpacity,e.fillStyle=this._textHighlightColor;const t=Math.min(this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialLineIndex),s=Math.max(this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialLineIndex);let r=this._scrollTop+t*this._fontOffset.height;for(let n=t;n<=s;n++){const o=this._lines[n];let a=this._scrollLeft;switch(this._textHorizontalAlignment){case xs.HORIZONTAL_ALIGNMENT_LEFT:a+=0;break;case xs.HORIZONTAL_ALIGNMENT_RIGHT:a+=i-o.width;break;case xs.HORIZONTAL_ALIGNMENT_CENTER:a+=(i-o.width)/2}const h=n===t?this._cursorInfo.relativeStartIndex:0,l=n===s?this._cursorInfo.relativeEndIndex:o.text.length,c=e.measureText(o.text.substring(0,h)).width,u=o.text.substring(h,l),d=e.measureText(u).width;e.fillRect(a+c,r,d,this._fontOffset.height),r+=this._fontOffset.height}this._cursorInfo.globalEndIndex===this._cursorInfo.globalStartIndex&&this._resetBlinking()}}e.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(e.strokeStyle=this.focusedColor):this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness))}_resetBlinking(){clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout((()=>{this._blinkIsEven=!this._blinkIsEven,this._markAsDirty()}),500)}_onPointerDown(e,t,i,s,r){return!(!super._onPointerDown(e,t,i,s,r)||!this.isReadOnly&&(this._clickedCoordinateX=t.x,this._clickedCoordinateY=t.y,this._isTextHighlightOn=!1,this._highlightedText="",this._isPointerDown=!0,this._host._capturingControl[i]=this,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),0):!this._isEnabled||(this._host.focusedControl=this,0)))}_onPointerMove(e,t,i,s){0===s.event.movementX&&0===s.event.movementY||(this._host.focusedControl===this&&this._isPointerDown&&!this.isReadOnly&&(this._clickedCoordinateX=t.x,this._clickedCoordinateY=t.y,this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._isTextHighlightOn=!0),this._markAsDirty()),super._onPointerMove(e,t,i,s))}_updateCursorPosition(){if(this._isFocused)if(!this._textWrapper.text&&this.placeholderText)this._cursorInfo.currentLineIndex=0,this._cursorInfo.globalStartIndex=0,this._cursorInfo.globalEndIndex=0,this._cursorInfo.relativeStartIndex=0,this._cursorInfo.relativeEndIndex=0;else if(this._clickedCoordinateX&&this._clickedCoordinateY){this._isTextHighlightOn||(this._cursorInfo={globalStartIndex:0,globalEndIndex:0,relativeStartIndex:0,relativeEndIndex:0,currentLineIndex:0});let e=0,t=0;const i=this._clickedCoordinateY-this._scrollTop,s=Math.floor(i/this._fontOffset.height);this._cursorInfo.currentLineIndex=Math.min(Math.max(s,0),this._lines.length-1);let r=0;const n=this._clickedCoordinateX-(this._scrollLeft??0);let o=0;for(let t=0;t<this._cursorInfo.currentLineIndex;t++){const i=this._lines[t];e+=i.text.length+i.lineEnding.length}for(;r<n&&this._lines[this._cursorInfo.currentLineIndex].text.length>t;)t++,o=Math.abs(n-r),r=this._contextForBreakLines.measureText(this._lines[this._cursorInfo.currentLineIndex].text.substring(0,t)).width;Math.abs(n-r)>o&&t>0&&t--,e+=t,this._isTextHighlightOn?e<this._highlightCursorInfo.initialStartIndex?(this._cursorInfo.globalStartIndex=e,this._cursorInfo.relativeStartIndex=t,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeEndIndex=this._highlightCursorInfo.initialRelativeStartIndex):(this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeStartIndex=this._highlightCursorInfo.initialRelativeStartIndex,this._cursorInfo.globalEndIndex=e,this._cursorInfo.relativeEndIndex=t):(this._cursorInfo.globalStartIndex=e,this._cursorInfo.relativeStartIndex=t,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.relativeEndIndex=this._cursorInfo.relativeStartIndex),this._blinkIsEven=this._isTextHighlightOn,this._clickedCoordinateX=null,this._clickedCoordinateY=null}else{this._cursorInfo.relativeStartIndex=0,this._cursorInfo.currentLineIndex=0;let e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length,t=0;for(;t+e<=this._cursorInfo.globalStartIndex;)t+=e,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length);if(this._cursorInfo.relativeStartIndex=this._cursorInfo.globalStartIndex-t,this._isTextHighlightOn){if(-1!==this._highlightCursorInfo.initialStartIndex&&this._cursorInfo.globalStartIndex>=this._highlightCursorInfo.initialStartIndex){for(;t+e<=this._cursorInfo.globalEndIndex;)t+=e,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,e=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length);this._cursorInfo.relativeEndIndex=this._cursorInfo.globalEndIndex-t}}else this._cursorInfo.relativeEndIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex}}_updateValueFromCursorIndex(e){}_processDblClick(e){let t,i;do{t=this._cursorInfo.globalStartIndex>0&&this._textWrapper.isWord(this._cursorInfo.globalStartIndex-1)?--this._cursorInfo.globalStartIndex:0,i=this._cursorInfo.globalEndIndex<this._textWrapper.length&&this._textWrapper.isWord(this._cursorInfo.globalEndIndex)?++this._cursorInfo.globalEndIndex:0}while(t||i);this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._blinkIsEven=!0,this._markAsDirty()}selectAllText(){this._isTextHighlightOn=!0,this._blinkIsEven=!0,this._highlightCursorInfo={initialStartIndex:0,initialRelativeStartIndex:0,initialLineIndex:0},this._cursorInfo={globalStartIndex:0,globalEndIndex:this._textWrapper.length,relativeEndIndex:this._lines[this._lines.length-1].text.length,relativeStartIndex:0,currentLineIndex:this._lines.length-1},this._markAsDirty()}dispose(){super.dispose(),this.onLinesReadyObservable.clear()}}(0,Et.Cg)([(0,Rt.lK)()],ry.prototype,"autoStretchHeight",null),(0,Et.Cg)([(0,Rt.lK)()],ry.prototype,"maxHeight",null),(0,Ft.Y5)("BABYLON.GUI.InputTextArea",ry),(0,Ft.Y5)("BABYLON.GUI.InputPassword",class extends Gr{_getTypeName(){return"InputPassword"}_beforeRenderText(e){const t=new Vr;let i="";for(let t=0;t<e.length;t++)i+="";return t.text=i,t}});class ny extends xs{get dash(){return this._dash}set dash(e){this._dash!==e&&(this._dash=e,this._markAsDirty())}get connectedControl(){return this._connectedControl}set connectedControl(e){this._connectedControl!==e&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),e&&(this._connectedControlDirtyObserver=e.onDirtyObservable.add((()=>this._markAsDirty()))),this._connectedControl=e,this._markAsDirty())}get x1(){return this._x1.toString(this._host)}set x1(e){this._x1.toString(this._host)!==e&&this._x1.fromString(e)&&this._markAsDirty()}get y1(){return this._y1.toString(this._host)}set y1(e){this._y1.toString(this._host)!==e&&this._y1.fromString(e)&&this._markAsDirty()}get x2(){return this._x2.toString(this._host)}set x2(e){this._x2.toString(this._host)!==e&&this._x2.fromString(e)&&this._markAsDirty()}get y2(){return this._y2.toString(this._host)}set y2(e){this._y2.toString(this._host)!==e&&this._y2.fromString(e)&&this._markAsDirty()}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())}set horizontalAlignment(e){}set verticalAlignment(e){}get _effectiveX2(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)}get _effectiveY2(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)}constructor(e){super(e),this.name=e,this._lineWidth=1,this._x1=new ds(0),this._y1=new ds(0),this._x2=new ds(0),this._y2=new ds(0),this._dash=new Array,this._automaticSize=!0,this.isHitTestVisible=!1,this._horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this._verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP}_getTypeName(){return"Line"}_draw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this._getColor(e),e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath(),e.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.top+this._y1.getValue(this._host)),e.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.top+this._effectiveY2),e.stroke(),e.restore()}_measure(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth}_computeAlignment(e){this._currentMeasure.left=e.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=e.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2}moveToVector3(e,t,i=!1){if(!this._host||this.parent!==this._host._rootContainer)return void $i.S0.Error("Cannot move a control to a vector3 if the control is not at root level");const s=this._host._getGlobalViewport(),r=gt.Pq.Project(e,gt.uq.IdentityReadOnly,t.getTransformMatrix(),s);this._moveToProjectedPosition(r,i),r.z<0||r.z>1?this.notRenderable=!0:this.notRenderable=!1}_moveToProjectedPosition(e,t=!1){const i=e.x+this._linkOffsetX.getValue(this._host)+"px",s=e.y+this._linkOffsetY.getValue(this._host)+"px";t?(this.x2=i,this.y2=s,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=s,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)}}(0,Et.Cg)([(0,Rt.lK)()],ny.prototype,"dash",null),(0,Et.Cg)([(0,Rt.lK)()],ny.prototype,"x1",null),(0,Et.Cg)([(0,Rt.lK)()],ny.prototype,"y1",null),(0,Et.Cg)([(0,Rt.lK)()],ny.prototype,"x2",null),(0,Et.Cg)([(0,Rt.lK)()],ny.prototype,"y2",null),(0,Et.Cg)([(0,Rt.lK)()],ny.prototype,"lineWidth",null),(0,Ft.Y5)("BABYLON.GUI.Line",ny);class oy{constructor(e){this._multiLine=e,this._x=new ds(0),this._y=new ds(0),this._point=new gt.Pq(0,0,0)}get x(){return this._x.toString(this._multiLine._host)}set x(e){this._x.toString(this._multiLine._host)!==e&&this._x.fromString(e)&&this._multiLine._markAsDirty()}get y(){return this._y.toString(this._multiLine._host)}set y(e){this._y.toString(this._multiLine._host)!==e&&this._y.fromString(e)&&this._multiLine._markAsDirty()}get control(){return this._control}set control(e){this._control!==e&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=e,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}get mesh(){return this._mesh}set mesh(e){this._mesh!==e&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=e,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}resetLinks(){this.control=null,this.mesh=null}translate(){return this._point=this._translatePoint(),this._point}_translatePoint(){if(null!=this._mesh)return this._multiLine._host.getProjectedPositionWithZ(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new gt.Pq(this._control.centerX,this._control.centerY,1-bs.bH);{const e=this._multiLine._host,t=this._x.getValueInPixel(e,Number(e._canvas.width)),i=this._y.getValueInPixel(e,Number(e._canvas.height));return new gt.Pq(t,i,1-bs.bH)}}dispose(){this.resetLinks()}}class ay extends xs{constructor(e){super(e),this.name=e,this._lineWidth=1,this.onPointUpdate=()=>{this._markAsDirty()},this._automaticSize=!0,this.isHitTestVisible=!1,this._horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this._verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this._dash=[],this._points=[]}get dash(){return this._dash}set dash(e){this._dash!==e&&(this._dash=e,this._markAsDirty())}getAt(e){return this._points[e]||(this._points[e]=new oy(this)),this._points[e]}add(...e){return e.map((e=>this.push(e)))}push(e){const t=this.getAt(this._points.length);return null==e||(e instanceof Sc.u?t.mesh=e:e instanceof xs?t.control=e:null!=e.x&&null!=e.y&&(t.x=e.x,t.y=e.y)),t}remove(e){let t;if(e instanceof oy){if(t=this._points.indexOf(e),-1===t)return}else t=e;const i=this._points[t];i&&(i.dispose(),this._points.splice(t,1))}reset(){for(;this._points.length>0;)this.remove(this._points.length-1)}resetLinks(){this._points.forEach((e=>{null!=e&&e.resetLinks()}))}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())}set horizontalAlignment(e){}set verticalAlignment(e){}_getTypeName(){return"MultiLine"}_draw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath();let t,i=!0;this._points.forEach((s=>{s&&(i?(e.moveTo(s._point.x,s._point.y),i=!1):s._point.z<1&&t.z<1?e.lineTo(s._point.x,s._point.y):e.moveTo(s._point.x,s._point.y),t=s._point)})),e.stroke(),e.restore()}_additionalProcessing(){this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach((e=>{e&&(e.translate(),(null==this._minX||e._point.x<this._minX)&&(this._minX=e._point.x),(null==this._minY||e._point.y<this._minY)&&(this._minY=e._point.y),(null==this._maxX||e._point.x>this._maxX)&&(this._maxX=e._point.x),(null==this._maxY||e._point.y>this._maxY)&&(this._maxY=e._point.y))})),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)}_measure(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)}_computeAlignment(){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)}dispose(){this.reset(),super.dispose()}}(0,Et.Cg)([(0,Rt.lK)()],ay.prototype,"dash",null),(0,Ft.Y5)("BABYLON.GUI.MultiLine",ay);class hy extends xs{get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}get checkSizeRatio(){return this._checkSizeRatio}set checkSizeRatio(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get isChecked(){return this._isChecked}set isChecked(e){this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e),this._isChecked&&this._host&&this._host.executeOnAllControls((e=>{if(e===this)return;if(void 0===e.group)return;const t=e;t.group===this.group&&(t.isChecked=!1)})))}constructor(e){super(e),this.name=e,this._isChecked=!1,this._background="black",this._checkSizeRatio=.8,this._thickness=1,this.group="",this.onIsCheckedChangedObservable=new Zi.cP,this.isPointerBlocker=!0}_getTypeName(){return"RadioButton"}_draw(e){e.save(),this._applyStates(e);const t=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),xs.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,1,e),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this.color,e.lineWidth=this._thickness,e.stroke(),this._isChecked){e.fillStyle=this._isEnabled?this.color:this._disabledColor;const s=t*this._checkSizeRatio,r=i*this._checkSizeRatio;xs.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,s/2-this._thickness/2,r/2-this._thickness/2,1,e),e.fill()}e.restore()}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(this.isReadOnly||this.isChecked||(this.isChecked=!0),!0)}static AddRadioButtonWithHeader(e,t,i,s){const r=new ey;r.isVertical=!1,r.height="30px";const n=new hy;n.width="20px",n.height="20px",n.isChecked=i,n.color="green",n.group=t,n.onIsCheckedChangedObservable.add((e=>s(n,e))),r.addControl(n);const o=new lr;return o.text=e,o.width="180px",o.paddingLeft="5px",o.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,o.color="white",r.addControl(o),r}}(0,Et.Cg)([(0,Rt.lK)()],hy.prototype,"thickness",null),(0,Et.Cg)([(0,Rt.lK)()],hy.prototype,"group",void 0),(0,Et.Cg)([(0,Rt.lK)()],hy.prototype,"checkSizeRatio",null),(0,Et.Cg)([(0,Rt.lK)()],hy.prototype,"background",null),(0,Et.Cg)([(0,Rt.lK)()],hy.prototype,"isChecked",null),(0,Ft.Y5)("BABYLON.GUI.RadioButton",hy);class ly extends xs{get displayThumb(){return this._displayThumb}set displayThumb(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())}get step(){return this._step}set step(e){this._step!==e&&(this._step=e,this._markAsDirty())}get barOffset(){return this._barOffset.toString(this._host)}get barOffsetInPixels(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)}set barOffset(e){this._barOffset.toString(this._host)!==e&&this._barOffset.fromString(e)&&this._markAsDirty()}get thumbWidth(){return this._thumbWidth.toString(this._host)}get thumbWidthInPixels(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)}set thumbWidth(e){this._thumbWidth.toString(this._host)!==e&&this._thumbWidth.fromString(e)&&this._markAsDirty()}get minimum(){return this._minimum}set minimum(e){this._minimum!==e&&(this._minimum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))}get maximum(){return this._maximum}set maximum(e){this._maximum!==e&&(this._maximum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))}get value(){return this._value}set value(e){e=Math.max(Math.min(e,this._maximum),this._minimum),this._value!==e&&(this._value=e,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))}get isVertical(){return this._isVertical}set isVertical(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())}get isThumbClamped(){return this._isThumbClamped}set isThumbClamped(e){this._isThumbClamped!==e&&(this._isThumbClamped=e,this._markAsDirty())}constructor(e){super(e),this.name=e,this._thumbWidth=new ds(20,ds.UNITMODE_PIXEL,!1),this._minimum=0,this._maximum=100,this._value=50,this._isVertical=!1,this._barOffset=new ds(5,ds.UNITMODE_PIXEL,!1),this._isThumbClamped=!1,this._displayThumb=!0,this._step=0,this._lastPointerDownId=-1,this._effectiveBarOffset=0,this.onValueChangedObservable=new Zi.cP,this._pointerIsDown=!1,this.isPointerBlocker=!0}_getTypeName(){return"BaseSlider"}_getThumbPosition(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength}_getThumbThickness(e){let t=0;switch(e){case"circle":t=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":t=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return t}_prepareRenderingData(e){this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(e),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width?It.V.Error("Height should be greater than width"):(this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength))}_updateValueFromPointer(e,t){let i;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),i=this._isVertical?this._minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum),this.value=this._step?Math.round(i/this._step)*this._step:i}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(this.isReadOnly||(this._pointerIsDown=!0,this._updateValueFromPointer(t.x,t.y),this._host._capturingControl[i]=this,this._lastPointerDownId=i),!0)}_onPointerMove(e,t,i,s){i==this._lastPointerDownId&&(this._pointerIsDown&&!this.isReadOnly&&this._updateValueFromPointer(t.x,t.y),super._onPointerMove(e,t,i,s))}_onPointerUp(e,t,i,s,r){this._pointerIsDown=!1,delete this._host._capturingControl[i],super._onPointerUp(e,t,i,s,r)}_onCanvasBlur(){this._forcePointerUp(),super._onCanvasBlur()}}(0,Et.Cg)([(0,Rt.lK)()],ly.prototype,"displayThumb",null),(0,Et.Cg)([(0,Rt.lK)()],ly.prototype,"step",null),(0,Et.Cg)([(0,Rt.lK)()],ly.prototype,"barOffset",null),(0,Et.Cg)([(0,Rt.lK)()],ly.prototype,"thumbWidth",null),(0,Et.Cg)([(0,Rt.lK)()],ly.prototype,"minimum",null),(0,Et.Cg)([(0,Rt.lK)()],ly.prototype,"maximum",null),(0,Et.Cg)([(0,Rt.lK)()],ly.prototype,"value",null),(0,Et.Cg)([(0,Rt.lK)()],ly.prototype,"isVertical",null),(0,Et.Cg)([(0,Rt.lK)()],ly.prototype,"isThumbClamped",null);class cy extends ly{get displayValueBar(){return this._displayValueBar}set displayValueBar(e){this._displayValueBar!==e&&(this._displayValueBar=e,this._markAsDirty())}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(e){this._backgroundGradient!==e&&(this._backgroundGradient=e,this._markAsDirty())}get thumbColor(){return this._thumbColor}set thumbColor(e){this._thumbColor!==e&&(this._thumbColor=e,this._markAsDirty())}get isThumbCircle(){return this._isThumbCircle}set isThumbCircle(e){this._isThumbCircle!==e&&(this._isThumbCircle=e,this._markAsDirty())}constructor(e){super(e),this.name=e,this._background="black",this._borderColor="white",this._thumbColor="",this._isThumbCircle=!1,this._displayValueBar=!0,this._backgroundGradient=null}_getTypeName(){return"Slider"}_getBackgroundColor(e){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(e):this._background}_draw(e){e.save(),this._applyStates(e),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");let t=this._renderLeft,i=this._renderTop;const s=this._renderWidth,r=this._renderHeight;let n=0;this.isThumbClamped&&this.isThumbCircle?(this.isVertical?i+=this._effectiveThumbThickness/2:t+=this._effectiveThumbThickness/2,n=this._backgroundBoxThickness/2):n=(this._effectiveThumbThickness-this._effectiveBarOffset)/2,n=Math.max(0,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY);const o=this._getThumbPosition();e.fillStyle=this._getBackgroundColor(e),this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(t+this._backgroundBoxThickness/2,i,n,Math.PI,2*Math.PI),e.fill(),e.fillRect(t,i,s,r)):e.fillRect(t,i,s,r+this._effectiveThumbThickness):e.fillRect(t,i,s,r):this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(t+this._backgroundBoxLength,i+this._backgroundBoxThickness/2,n,0,2*Math.PI),e.fill(),e.fillRect(t,i,s,r)):e.fillRect(t,i,s+this._effectiveThumbThickness,r):e.fillRect(t,i,s,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.fillStyle=this._getColor(e),this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(t+this._backgroundBoxThickness/2,i+this._backgroundBoxLength,n,0,2*Math.PI),e.fill(),e.fillRect(t,i+o,s,r-o)):e.fillRect(t,i+o,s,r-o+this._effectiveThumbThickness):e.fillRect(t,i+o,s,r-o):this.isThumbClamped&&this.isThumbCircle?(e.beginPath(),e.arc(t,i+this._backgroundBoxThickness/2,n,0,2*Math.PI),e.fill(),e.fillRect(t,i,o,r)):e.fillRect(t,i,o,r)),e.fillStyle=this._thumbColor||this._getColor(e),this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(e.beginPath(),this.isVertical?e.arc(t+this._backgroundBoxThickness/2,i+o,n,0,2*Math.PI):e.arc(t+o,i+this._backgroundBoxThickness/2,n,0,2*Math.PI),e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,e.stroke()):(this.isVertical?e.fillRect(t-this._effectiveBarOffset,this._currentMeasure.top+o,this._currentMeasure.width,this._effectiveThumbThickness):e.fillRect(this._currentMeasure.left+o,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,this.isVertical?e.strokeRect(t-this._effectiveBarOffset,this._currentMeasure.top+o,this._currentMeasure.width,this._effectiveThumbThickness):e.strokeRect(this._currentMeasure.left+o,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),e.restore()}serialize(e){super.serialize(e),this.backgroundGradient&&(e.backgroundGradient={},this.backgroundGradient.serialize(e.backgroundGradient))}_parseFromContent(e,t){if(super._parseFromContent(e,t),e.backgroundGradient){const t=$i.S0.Instantiate("BABYLON.GUI."+e.backgroundGradient.className);this.backgroundGradient=new t,this.backgroundGradient.parse(e.backgroundGradient)}}}(0,Et.Cg)([(0,Rt.lK)()],cy.prototype,"displayValueBar",null),(0,Et.Cg)([(0,Rt.lK)()],cy.prototype,"borderColor",null),(0,Et.Cg)([(0,Rt.lK)()],cy.prototype,"background",null),(0,Et.Cg)([(0,Rt.lK)()],cy.prototype,"thumbColor",null),(0,Et.Cg)([(0,Rt.lK)()],cy.prototype,"isThumbCircle",null),(0,Ft.Y5)("BABYLON.GUI.Slider",cy);class uy extends As{get freezeControls(){return this._freezeControls}set freezeControls(e){if(this._freezeControls===e)return;e||this._restoreMeasures(),this._freezeControls=!1;const t=this.host.getSize(),i=t.width,s=t.height,r=this.host.getContext(),n=new ms(0,0,i,s);this.host._numLayoutCalls=0,this.host._rootContainer._layout(n,r),e&&(this._updateMeasures(),this._useBuckets()&&this._makeBuckets()),this._freezeControls=e,this.host.markAsDirty()}get bucketWidth(){return this._bucketWidth}get bucketHeight(){return this._bucketHeight}setBucketSizes(e,t){this._bucketWidth=e,this._bucketHeight=t,this._useBuckets()?this._freezeControls&&this._makeBuckets():this._buckets={}}_useBuckets(){return this._bucketWidth>0&&this._bucketHeight>0}_makeBuckets(){this._buckets={},this._bucketLen=Math.ceil(this.widthInPixels/this._bucketWidth),this._dispatchInBuckets(this._children),this._oldLeft=null,this._oldTop=null}_dispatchInBuckets(e){for(let t=0;t<e.length;++t){const i=e[t],s=Math.max(0,Math.floor((i._customData._origLeft-this._customData.origLeft)/this._bucketWidth)),r=Math.floor((i._customData._origLeft-this._customData.origLeft+i._currentMeasure.width-1)/this._bucketWidth),n=Math.floor((i._customData._origTop-this._customData.origTop+i._currentMeasure.height-1)/this._bucketHeight);let o=Math.max(0,Math.floor((i._customData._origTop-this._customData.origTop)/this._bucketHeight));for(;o<=n;){for(let e=s;e<=r;++e){const t=o*this._bucketLen+e;let s=this._buckets[t];s||(s=[],this._buckets[t]=s),s.push(i)}o++}i instanceof As&&i._children.length>0&&this._dispatchInBuckets(i._children)}}_updateMeasures(){const e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left-=e,this._measureForChildren.top-=t,this._currentMeasure.left-=e,this._currentMeasure.top-=t,this._customData.origLeftForChildren=this._measureForChildren.left,this._customData.origTopForChildren=this._measureForChildren.top,this._customData.origLeft=this._currentMeasure.left,this._customData.origTop=this._currentMeasure.top,this._updateChildrenMeasures(this._children,e,t)}_updateChildrenMeasures(e,t,i){for(let s=0;s<e.length;++s){const r=e[s];r._currentMeasure.left-=t,r._currentMeasure.top-=i,r._customData._origLeft=r._currentMeasure.left,r._customData._origTop=r._currentMeasure.top,r instanceof As&&r._children.length>0&&this._updateChildrenMeasures(r._children,t,i)}}_restoreMeasures(){const e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left=this._customData.origLeftForChildren+e,this._measureForChildren.top=this._customData.origTopForChildren+t,this._currentMeasure.left=this._customData.origLeft+e,this._currentMeasure.top=this._customData.origTop+t}constructor(e){super(e),this._freezeControls=!1,this._bucketWidth=0,this._bucketHeight=0,this._buckets={}}_getTypeName(){return"ScrollViewerWindow"}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._parentMeasure=e,this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=e.width,this._measureForChildren.height=e.height}_layout(e,t){return this._freezeControls?(this.invalidateRect(),!1):super._layout(e,t)}_scrollChildren(e,t,i){for(let s=0;s<e.length;++s){const r=e[s];r._currentMeasure.left=r._customData._origLeft+t,r._currentMeasure.top=r._customData._origTop+i,r._isClipped=!1,r instanceof As&&r._children.length>0&&this._scrollChildren(r._children,t,i)}}_scrollChildrenWithBuckets(e,t,i,s){const r=Math.max(0,Math.floor(-e/this._bucketWidth)),n=Math.floor((-e+this._parentMeasure.width-1)/this._bucketWidth),o=Math.floor((-t+this._parentMeasure.height-1)/this._bucketHeight);let a=Math.max(0,Math.floor(-t/this._bucketHeight));for(;a<=o;){for(let e=r;e<=n;++e){const t=a*this._bucketLen+e,r=this._buckets[t];if(r)for(let e=0;e<r.length;++e){const t=r[e];t._currentMeasure.left=t._customData._origLeft+i,t._currentMeasure.top=t._customData._origTop+s,t._isClipped=!1}}a++}}_draw(e,t){if(!this._freezeControls)return void super._draw(e,t);this._localDraw(e),this.clipChildren&&this._clipForChildren(e);const i=0|this.leftInPixels,s=0|this.topInPixels;this._useBuckets()&&null!==this._oldLeft&&null!==this._oldTop?(this._scrollChildrenWithBuckets(this._oldLeft,this._oldTop,i,s),this._scrollChildrenWithBuckets(i,s,i,s)):this._scrollChildren(this._children,i,s),this._oldLeft=i,this._oldTop=s;for(const t of this._children)t._intersectsRect(this._parentMeasure)&&t._render(e,this._parentMeasure)}_postMeasure(){if(this._freezeControls)return void super._postMeasure();let e=this.parentClientWidth,t=this.parentClientHeight;for(const i of this.children)i.isVisible&&!i.notRenderable&&(i.horizontalAlignment===xs.HORIZONTAL_ALIGNMENT_CENTER&&i._offsetLeft(this._currentMeasure.left-i._currentMeasure.left),i.verticalAlignment===xs.VERTICAL_ALIGNMENT_CENTER&&i._offsetTop(this._currentMeasure.top-i._currentMeasure.top),e=Math.max(e,i._currentMeasure.left-this._currentMeasure.left+i._currentMeasure.width+i.paddingRightInPixels),t=Math.max(t,i._currentMeasure.top-this._currentMeasure.top+i._currentMeasure.height+i.paddingBottomInPixels));this._currentMeasure.width!==e&&(this._width.updateInPlace(e,ds.UNITMODE_PIXEL),this._currentMeasure.width=e,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==t&&(this._height.updateInPlace(t,ds.UNITMODE_PIXEL),this._currentMeasure.height=t,this._rebuildLayout=!0,this._isDirty=!0),super._postMeasure()}}class dy extends ly{get borderColor(){return this._borderColor}set borderColor(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(e){this._backgroundGradient!==e&&(this._backgroundGradient=e,this._markAsDirty())}get invertScrollDirection(){return this._invertScrollDirection}set invertScrollDirection(e){this._invertScrollDirection=e}constructor(e){super(e),this.name=e,this._background="black",this._borderColor="white",this._tempMeasure=new ms(0,0,0,0),this._invertScrollDirection=!1,this._backgroundGradient=null}_getTypeName(){return"Scrollbar"}_getThumbThickness(){let e=0;return e=this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host),e}_getBackgroundColor(e){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(e):this._background}_draw(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");const t=this._renderLeft,i=this._getThumbPosition();e.fillStyle=this._getBackgroundColor(e),e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.fillStyle=this._getColor(e),this.isVertical?(this._tempMeasure.left=t-this._effectiveBarOffset,this._tempMeasure.top=this._currentMeasure.top+i,this._tempMeasure.width=this._currentMeasure.width,this._tempMeasure.height=this._effectiveThumbThickness):(this._tempMeasure.left=this._currentMeasure.left+i,this._tempMeasure.top=this._currentMeasure.top,this._tempMeasure.width=this._effectiveThumbThickness,this._tempMeasure.height=this._currentMeasure.height),e.fillRect(this._tempMeasure.left,this._tempMeasure.top,this._tempMeasure.width,this._tempMeasure.height),e.restore()}_updateValueFromPointer(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y);const i=this._invertScrollDirection?-1:1;this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));let s=0;s=this.isVertical?-(t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*s*(this.maximum-this.minimum),this._originX=e,this._originY=t}_onPointerDown(e,t,i,s,r){return this._first=!0,super._onPointerDown(e,t,i,s,r)}serialize(e){super.serialize(e),this.backgroundGradient&&(e.backgroundGradient={},this.backgroundGradient.serialize(e.backgroundGradient))}_parseFromContent(e,t){if(super._parseFromContent(e,t),e.backgroundGradient){const t=$i.S0.Instantiate("BABYLON.GUI."+e.backgroundGradient.className);this.backgroundGradient=new t,this.backgroundGradient.parse(e.backgroundGradient)}}}(0,Et.Cg)([(0,Rt.lK)()],dy.prototype,"borderColor",null),(0,Et.Cg)([(0,Rt.lK)()],dy.prototype,"background",null),(0,Et.Cg)([(0,Rt.lK)()],dy.prototype,"invertScrollDirection",null),(0,Ft.Y5)("BABYLON.GUI.Scrollbar",dy);class _y extends ly{get invertScrollDirection(){return this._invertScrollDirection}set invertScrollDirection(e){this._invertScrollDirection=e}get backgroundImage(){return this._backgroundBaseImage}set backgroundImage(e){this._backgroundBaseImage!==e&&(this._backgroundBaseImage=e,this.isVertical&&0!==this.num90RotationInVerticalMode?e.isLoaded?(this._backgroundImage=e._rotate90(this.num90RotationInVerticalMode,!0),this._markAsDirty()):e.onImageLoadedObservable.addOnce((()=>{const t=e._rotate90(this.num90RotationInVerticalMode,!0);this._backgroundImage=t,t.isLoaded||t.onImageLoadedObservable.addOnce((()=>{this._markAsDirty()})),this._markAsDirty()})):(this._backgroundImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((()=>{this._markAsDirty()})),this._markAsDirty()))}get thumbImage(){return this._thumbBaseImage}set thumbImage(e){this._thumbBaseImage!==e&&(this._thumbBaseImage=e,this.isVertical&&0!==this.num90RotationInVerticalMode?e.isLoaded?(this._thumbImage=e._rotate90(-this.num90RotationInVerticalMode,!0),this._markAsDirty()):e.onImageLoadedObservable.addOnce((()=>{const t=e._rotate90(-this.num90RotationInVerticalMode,!0);this._thumbImage=t,t.isLoaded||t.onImageLoadedObservable.addOnce((()=>{this._markAsDirty()})),this._markAsDirty()})):(this._thumbImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((()=>{this._markAsDirty()})),this._markAsDirty()))}get thumbLength(){return this._thumbLength}set thumbLength(e){this._thumbLength!==e&&(this._thumbLength=e,this._markAsDirty())}get thumbHeight(){return this._thumbHeight}set thumbHeight(e){this._thumbLength!==e&&(this._thumbHeight=e,this._markAsDirty())}get barImageHeight(){return this._barImageHeight}set barImageHeight(e){this._barImageHeight!==e&&(this._barImageHeight=e,this._markAsDirty())}constructor(e){super(e),this.name=e,this._thumbLength=.5,this._thumbHeight=1,this._barImageHeight=1,this._tempMeasure=new ms(0,0,0,0),this._invertScrollDirection=!1,this.num90RotationInVerticalMode=1}_getTypeName(){return"ImageScrollBar"}_getThumbThickness(){let e=0;return e=this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host),e}_draw(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");const t=this._getThumbPosition(),i=this._renderLeft,s=this._renderTop,r=this._renderWidth,n=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,s,r,n),this.isVertical?(this._tempMeasure.copyFromFloats(i+r*(1-this._barImageHeight)*.5,this._currentMeasure.top,r*this._barImageHeight,n),this._tempMeasure.height+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)):(this._tempMeasure.copyFromFloats(this._currentMeasure.left,s+n*(1-this._barImageHeight)*.5,r,n*this._barImageHeight),this._tempMeasure.width+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)),this._backgroundImage._draw(e)),this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset+this._currentMeasure.width*(1-this._thumbHeight)*.5,this._currentMeasure.top+t,this._currentMeasure.width*this._thumbHeight,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+t,this._currentMeasure.top+this._currentMeasure.height*(1-this._thumbHeight)*.5,this._effectiveThumbThickness,this._currentMeasure.height*this._thumbHeight),this._thumbImage&&(this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()}_updateValueFromPointer(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y);const i=this._invertScrollDirection?-1:1;this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));let s=0;s=this.isVertical?-(t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*s*(this.maximum-this.minimum),this._originX=e,this._originY=t}_onPointerDown(e,t,i,s,r){return this._first=!0,super._onPointerDown(e,t,i,s,r)}}(0,Et.Cg)([(0,Rt.lK)()],_y.prototype,"num90RotationInVerticalMode",void 0),(0,Et.Cg)([(0,Rt.lK)()],_y.prototype,"invertScrollDirection",null);class py extends cr{get horizontalBar(){return this._horizontalBar}get verticalBar(){return this._verticalBar}addControl(e){return e?(this._window.addControl(e),this):this}removeControl(e){return this._window.removeControl(e),this}get children(){return this._window.children}_flagDescendantsAsMatrixDirty(){for(const e of this._children)e._markMatrixAsDirty()}get freezeControls(){return this._window.freezeControls}set freezeControls(e){this._window.freezeControls=e}get bucketWidth(){return this._window.bucketWidth}get bucketHeight(){return this._window.bucketHeight}setBucketSizes(e,t){this._window.setBucketSizes(e,t)}get forceHorizontalBar(){return this._forceHorizontalBar}set forceHorizontalBar(e){this._grid.setRowDefinition(1,e?this._barSize:0,!0),this._horizontalBar.isVisible=e,this._forceHorizontalBar=e}get forceVerticalBar(){return this._forceVerticalBar}set forceVerticalBar(e){this._grid.setColumnDefinition(1,e?this._barSize:0,!0),this._verticalBar.isVisible=e,this._forceVerticalBar=e}constructor(e,t){super(e),this._barSize=20,this._pointerIsOver=!1,this._wheelPrecision=.05,this._thumbLength=.5,this._thumbHeight=1,this._barImageHeight=1,this._horizontalBarImageHeight=1,this._verticalBarImageHeight=1,this._oldWindowContentsWidth=0,this._oldWindowContentsHeight=0,this._forceHorizontalBar=!1,this._forceVerticalBar=!1,this._useImageBar=t||!1,this.onDirtyObservable.add((()=>{this._horizontalBarSpace.color=this.color,this._verticalBarSpace.color=this.color,this._dragSpace.color=this.color})),this.onPointerEnterObservable.add((()=>{this._pointerIsOver=!0})),this.onPointerOutObservable.add((()=>{this._pointerIsOver=!1})),this._grid=new iy,this._useImageBar?(this._horizontalBar=new _y,this._verticalBar=new _y):(this._horizontalBar=new dy,this._verticalBar=new dy),this._window=new uy("scrollViewer_window"),this._window.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this._window.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this._grid.addColumnDefinition(1),this._grid.addColumnDefinition(0,!0),this._grid.addRowDefinition(1),this._grid.addRowDefinition(0,!0),super.addControl(this._grid),this._grid.addControl(this._window,0,0),this._verticalBarSpace=new cr,this._verticalBarSpace.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this._verticalBarSpace.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this._verticalBarSpace.thickness=1,this._grid.addControl(this._verticalBarSpace,0,1),this._addBar(this._verticalBar,this._verticalBarSpace,!0,Math.PI),this._horizontalBarSpace=new cr,this._horizontalBarSpace.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this._horizontalBarSpace.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,this._horizontalBarSpace.thickness=1,this._grid.addControl(this._horizontalBarSpace,1,0),this._addBar(this._horizontalBar,this._horizontalBarSpace,!1,0),this._dragSpace=new cr,this._dragSpace.thickness=1,this._grid.addControl(this._dragSpace,1,1),this._grid.clipChildren=!1,this._useImageBar||(this.barColor="grey",this.barBackground="transparent")}resetWindow(){this._window.width="100%",this._window.height="100%"}_getTypeName(){return"ScrollViewer"}_buildClientSizes(){const e=this.host.idealRatio;this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible||this.forceVerticalBar?this._barSize*e:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible||this.forceHorizontalBar?this._barSize*e:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._buildClientSizes()}_postMeasure(){super._postMeasure(),this._updateScroller(),this._setWindowPosition(!1)}get wheelPrecision(){return this._wheelPrecision}set wheelPrecision(e){this._wheelPrecision!==e&&(e<0&&(e=0),e>1&&(e=1),this._wheelPrecision=e)}get scrollBackground(){return this._horizontalBarSpace.background}set scrollBackground(e){this._horizontalBarSpace.background!==e&&(this._horizontalBarSpace.background=e,this._verticalBarSpace.background=e)}get barColor(){return this._barColor}set barColor(e){this._barColor!==e&&(this._barColor=e,this._horizontalBar.color=e,this._verticalBar.color=e)}get thumbImage(){return this._barImage}set thumbImage(e){if(this._barImage===e)return;this._barImage=e;const t=this._horizontalBar,i=this._verticalBar;t.thumbImage=e,i.thumbImage=e}get horizontalThumbImage(){return this._horizontalBarImage}set horizontalThumbImage(e){this._horizontalBarImage!==e&&(this._horizontalBarImage=e,this._horizontalBar.thumbImage=e)}get verticalThumbImage(){return this._verticalBarImage}set verticalThumbImage(e){this._verticalBarImage!==e&&(this._verticalBarImage=e,this._verticalBar.thumbImage=e)}get barSize(){return this._barSize}set barSize(e){this._barSize!==e&&(this._barSize=e,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))}get thumbLength(){return this._thumbLength}set thumbLength(e){if(this._thumbLength===e)return;e<=0&&(e=.1),e>1&&(e=1),this._thumbLength=e;const t=this._horizontalBar,i=this._verticalBar;t.thumbLength=e,i.thumbLength=e,this._markAsDirty()}get thumbHeight(){return this._thumbHeight}set thumbHeight(e){if(this._thumbHeight===e)return;e<=0&&(e=.1),e>1&&(e=1),this._thumbHeight=e;const t=this._horizontalBar,i=this._verticalBar;t.thumbHeight=e,i.thumbHeight=e,this._markAsDirty()}get barImageHeight(){return this._barImageHeight}set barImageHeight(e){if(this._barImageHeight===e)return;e<=0&&(e=.1),e>1&&(e=1),this._barImageHeight=e;const t=this._horizontalBar,i=this._verticalBar;t.barImageHeight=e,i.barImageHeight=e,this._markAsDirty()}get horizontalBarImageHeight(){return this._horizontalBarImageHeight}set horizontalBarImageHeight(e){this._horizontalBarImageHeight!==e&&(e<=0&&(e=.1),e>1&&(e=1),this._horizontalBarImageHeight=e,this._horizontalBar.barImageHeight=e,this._markAsDirty())}get verticalBarImageHeight(){return this._verticalBarImageHeight}set verticalBarImageHeight(e){this._verticalBarImageHeight!==e&&(e<=0&&(e=.1),e>1&&(e=1),this._verticalBarImageHeight=e,this._verticalBar.barImageHeight=e,this._markAsDirty())}get barBackground(){return this._barBackground}set barBackground(e){if(this._barBackground===e)return;this._barBackground=e;const t=this._horizontalBar,i=this._verticalBar;t.background=e,i.background=e,this._dragSpace.background=e}get barImage(){return this._barBackgroundImage}set barImage(e){this._barBackgroundImage=e;const t=this._horizontalBar,i=this._verticalBar;t.backgroundImage=e,i.backgroundImage=e}get horizontalBarImage(){return this._horizontalBarBackgroundImage}set horizontalBarImage(e){this._horizontalBarBackgroundImage=e,this._horizontalBar.backgroundImage=e}get verticalBarImage(){return this._verticalBarBackgroundImage}set verticalBarImage(e){this._verticalBarBackgroundImage=e,this._verticalBar.backgroundImage=e}_setWindowPosition(e=!0){const t=this.host.idealRatio,i=this._window._currentMeasure.width,s=this._window._currentMeasure.height;if(!e&&this._oldWindowContentsWidth===i&&this._oldWindowContentsHeight===s)return;this._oldWindowContentsWidth=i,this._oldWindowContentsHeight=s;const r=this._clientWidth-i,n=this._clientHeight-s,o=this._horizontalBar.value/t*r+"px",a=this._verticalBar.value/t*n+"px";o!==this._window.left&&(this._window.left=o,this.freezeControls||(this._rebuildLayout=!0)),a!==this._window.top&&(this._window.top=a,this.freezeControls||(this._rebuildLayout=!0))}_updateScroller(){const e=this._window._currentMeasure.width,t=this._window._currentMeasure.height;this._horizontalBar.isVisible&&e<=this._clientWidth&&!this.forceHorizontalBar?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&(e>this._clientWidth||this.forceHorizontalBar)&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&t<=this._clientHeight&&!this.forceVerticalBar?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&(t>this._clientHeight||this.forceVerticalBar)&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes();const i=this.host.idealRatio;this._horizontalBar.thumbWidth=.9*this._thumbLength*(this._clientWidth/i)+"px",this._verticalBar.thumbWidth=.9*this._thumbLength*(this._clientHeight/i)+"px"}_link(e){super._link(e),this._attachWheel()}_addBar(e,t,i,s){e.paddingLeft=0,e.width="100%",e.height="100%",e.barOffset=0,e.value=0,e.maximum=1,e.horizontalAlignment=xs.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=xs.VERTICAL_ALIGNMENT_CENTER,e.isVertical=i,e.rotation=s,e.isVisible=!1,t.addControl(e),e.onValueChangedObservable.add((()=>{this._setWindowPosition()}))}_attachWheel(){this._host&&!this._onWheelObserver&&(this._onWheelObserver=this.onWheelObservable.add((e=>{this._pointerIsOver&&!this.isReadOnly&&(1==this._verticalBar.isVisible&&(e.y<0&&this._verticalBar.value>0?this._verticalBar.value-=this._wheelPrecision:e.y>0&&this._verticalBar.value<this._verticalBar.maximum&&(this._verticalBar.value+=this._wheelPrecision)),1==this._horizontalBar.isVisible&&(e.x<0&&this._horizontalBar.value<this._horizontalBar.maximum?this._horizontalBar.value+=this._wheelPrecision:e.x>0&&this._horizontalBar.value>0&&(this._horizontalBar.value-=this._wheelPrecision)))})))}_renderHighlightSpecific(e){this.isHighlighted&&(super._renderHighlightSpecific(e),this._grid._renderHighlightSpecific(e),e.restore())}dispose(){this.onWheelObservable.remove(this._onWheelObserver),this._onWheelObserver=null,super.dispose()}}(0,Et.Cg)([(0,Rt.lK)()],py.prototype,"wheelPrecision",null),(0,Et.Cg)([(0,Rt.lK)()],py.prototype,"scrollBackground",null),(0,Et.Cg)([(0,Rt.lK)()],py.prototype,"barColor",null),(0,Et.Cg)([(0,Rt.lK)()],py.prototype,"barSize",null),(0,Et.Cg)([(0,Rt.lK)()],py.prototype,"barBackground",null),(0,Ft.Y5)("BABYLON.GUI.ScrollViewer",py),(0,Ft.Y5)("BABYLON.GUI.ToggleButton",class extends cr{get group(){return this._group}set group(e){this._group!==e&&(this._group=e)}get isActive(){return this._isActive}set isActive(e){this._isActive!==e&&(this._isActive=e,this._isActive?this.toActiveAnimation?.():this.toInactiveAnimation?.(),this._markAsDirty(),this.onIsActiveChangedObservable.notifyObservers(e),this._isActive&&this._host&&this._group&&this._host.executeOnAllControls((e=>{if("ToggleButton"===e.typeName){if(e===this)return;const t=e;t.group===this.group&&(t.isActive=!1)}})))}constructor(e,t){super(e),this.name=e,this.onIsActiveChangedObservable=new Zi.cP,this.delegatePickingToChildren=!1,this._isActive=!1,this.group=t??"",this.thickness=0,this.isPointerBlocker=!0;let i=null;this.toActiveAnimation=()=>{this.thickness=1},this.toInactiveAnimation=()=>{this.thickness=0},this.pointerEnterActiveAnimation=()=>{i=this.alpha,this.alpha-=.1},this.pointerOutActiveAnimation=()=>{null!==i&&(this.alpha=i)},this.pointerDownActiveAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpActiveAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05},this.pointerEnterInactiveAnimation=()=>{i=this.alpha,this.alpha-=.1},this.pointerOutInactiveAnimation=()=>{null!==i&&(this.alpha=i)},this.pointerDownInactiveAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpInactiveAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05}}_getTypeName(){return"ToggleButton"}_processPicking(e,t,i,s,r,n,o,a){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!super.contains(e,t))return!1;if(this.delegatePickingToChildren){let i=!1;for(let s=this._children.length-1;s>=0;s--){const r=this._children[s];if(r.isEnabled&&r.isHitTestVisible&&r.isVisible&&!r.notRenderable&&r.contains(e,t)){i=!0;break}}if(!i)return!1}return this._processObservables(s,e,t,i,r,n,o,a),!0}_onPointerEnter(e,t){return!!super._onPointerEnter(e,t)&&(this.isReadOnly||(this._isActive?this.pointerEnterActiveAnimation&&this.pointerEnterActiveAnimation():this.pointerEnterInactiveAnimation&&this.pointerEnterInactiveAnimation()),!0)}_onPointerOut(e,t,i=!1){this.isReadOnly||(this._isActive?this.pointerOutActiveAnimation&&this.pointerOutActiveAnimation():this.pointerOutInactiveAnimation&&this.pointerOutInactiveAnimation()),super._onPointerOut(e,t,i)}_onPointerDown(e,t,i,s,r){return!!super._onPointerDown(e,t,i,s,r)&&(this.isReadOnly||(this._isActive?this.pointerDownActiveAnimation&&this.pointerDownActiveAnimation():this.pointerDownInactiveAnimation&&this.pointerDownInactiveAnimation()),!0)}_onPointerUp(e,t,i,s,r,n){this.isReadOnly||(this._isActive?this.pointerUpActiveAnimation&&this.pointerUpActiveAnimation():this.pointerUpInactiveAnimation&&this.pointerUpInactiveAnimation()),super._onPointerUp(e,t,i,s,r,n)}});class gy extends ey{constructor(){super(...arguments),this.onKeyPressObservable=new Zi.cP,this.defaultButtonWidth="40px",this.defaultButtonHeight="40px",this.defaultButtonPaddingLeft="2px",this.defaultButtonPaddingRight="2px",this.defaultButtonPaddingTop="2px",this.defaultButtonPaddingBottom="2px",this.defaultButtonColor="#DDD",this.defaultButtonBackground="#070707",this.shiftButtonColor="#7799FF",this.selectedShiftThickness=1,this.shiftState=0,this._currentlyConnectedInputText=null,this._connectedInputTexts=[],this._onKeyPressObserver=null}_getTypeName(){return"VirtualKeyboard"}_createKey(e,t){const i=ur.CreateSimpleButton(e,e);return i.width=t&&t.width?t.width:this.defaultButtonWidth,i.height=t&&t.height?t.height:this.defaultButtonHeight,i.color=t&&t.color?t.color:this.defaultButtonColor,i.background=t&&t.background?t.background:this.defaultButtonBackground,i.paddingLeft=t&&t.paddingLeft?t.paddingLeft:this.defaultButtonPaddingLeft,i.paddingRight=t&&t.paddingRight?t.paddingRight:this.defaultButtonPaddingRight,i.paddingTop=t&&t.paddingTop?t.paddingTop:this.defaultButtonPaddingTop,i.paddingBottom=t&&t.paddingBottom?t.paddingBottom:this.defaultButtonPaddingBottom,i.thickness=0,i.isFocusInvisible=!0,i.shadowColor=this.shadowColor,i.shadowBlur=this.shadowBlur,i.shadowOffsetX=this.shadowOffsetX,i.shadowOffsetY=this.shadowOffsetY,i.onPointerUpObservable.add((()=>{this.onKeyPressObservable.notifyObservers(e)})),i}addKeysRow(e,t){const i=new ey;i.isVertical=!1,i.isFocusInvisible=!0;let s=null;for(let r=0;r<e.length;r++){let n=null;t&&t.length===e.length&&(n=t[r]);const o=this._createKey(e[r],n);(!s||o.heightInPixels>s.heightInPixels)&&(s=o),i.addControl(o)}i.height=s?s.height:this.defaultButtonHeight,this.addControl(i)}applyShiftState(e){if(this.children)for(let t=0;t<this.children.length;t++){const i=this.children[t];if(!i||!i.children)continue;const s=i;for(let t=0;t<s.children.length;t++){const i=s.children[t];if(!i||!i.children[0])continue;const r=i.children[0];""===r.text&&(i.color=e?this.shiftButtonColor:this.defaultButtonColor,i.thickness=e>1?this.selectedShiftThickness:0),r.text=e>0?r.text.toUpperCase():r.text.toLowerCase()}}}get connectedInputText(){return this._currentlyConnectedInputText}connect(e){const t=this._connectedInputTexts.some((t=>t.input===e));if(t)return;null===this._onKeyPressObserver&&(this._onKeyPressObserver=this.onKeyPressObservable.add((e=>{if(this._currentlyConnectedInputText){switch(this._currentlyConnectedInputText._host.focusedControl=this._currentlyConnectedInputText,e){case"":return this.shiftState++,this.shiftState>2&&(this.shiftState=0),void this.applyShiftState(this.shiftState);case"":return void(this._currentlyConnectedInputText instanceof ry?this._currentlyConnectedInputText.alternativeProcessKey("Backspace"):this._currentlyConnectedInputText.processKey(8));case"":return void(this._currentlyConnectedInputText instanceof ry?this._currentlyConnectedInputText.alternativeProcessKey("Enter"):this._currentlyConnectedInputText.processKey(13))}this._currentlyConnectedInputText instanceof ry?this._currentlyConnectedInputText.alternativeProcessKey("",this.shiftState?e.toUpperCase():e):this._currentlyConnectedInputText.processKey(-1,this.shiftState?e.toUpperCase():e),1===this.shiftState&&(this.shiftState=0,this.applyShiftState(this.shiftState))}}))),this.isVisible=!1,this._currentlyConnectedInputText=e,e._connectedVirtualKeyboard=this;const i=e.onFocusObservable.add((()=>{this._currentlyConnectedInputText=e,e._connectedVirtualKeyboard=this,this.isVisible=!0})),s=e.onBlurObservable.add((()=>{e._connectedVirtualKeyboard=null,this._currentlyConnectedInputText=null,this.isVisible=!1}));this._connectedInputTexts.push({input:e,onBlurObserver:s,onFocusObserver:i})}disconnect(e){if(e){const t=this._connectedInputTexts.filter((t=>t.input===e));1===t.length&&(this._removeConnectedInputObservables(t[0]),this._connectedInputTexts=this._connectedInputTexts.filter((t=>t.input!==e)),this._currentlyConnectedInputText===e&&(this._currentlyConnectedInputText=null))}else this._connectedInputTexts.forEach((e=>{this._removeConnectedInputObservables(e)})),this._connectedInputTexts.length=0;0===this._connectedInputTexts.length&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)}_removeConnectedInputObservables(e){e.input._connectedVirtualKeyboard=null,e.input.onFocusObservable.remove(e.onFocusObserver),e.input.onBlurObservable.remove(e.onBlurObserver)}dispose(){super.dispose(),this.disconnect()}static CreateDefaultLayout(e){const t=new gy(e);return t.addKeysRow(["1","2","3","4","5","6","7","8","9","0",""]),t.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),t.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'",""]),t.addKeysRow(["","z","x","c","v","b","n","m",",",".","/"]),t.addKeysRow([" "],[{width:"200px"}]),t}_parseFromContent(e,t){super._parseFromContent(e,t);for(const e of this.children)if("StackPanel"===e.getClassName()){const t=e;for(const e of t.children)"Button"===e.getClassName()&&e.name&&e.onPointerUpObservable.add((()=>{this.onKeyPressObservable.notifyObservers(e.name)}))}}}(0,Ft.Y5)("BABYLON.GUI.VirtualKeyboard",gy);class fy extends xs{get displayMinorLines(){return this._displayMinorLines}set displayMinorLines(e){this._displayMinorLines!==e&&(this._displayMinorLines=e,this._markAsDirty())}get displayMajorLines(){return this._displayMajorLines}set displayMajorLines(e){this._displayMajorLines!==e&&(this._displayMajorLines=e,this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get cellWidth(){return this._cellWidth}set cellWidth(e){this._cellWidth=e,this._markAsDirty()}get cellHeight(){return this._cellHeight}set cellHeight(e){this._cellHeight=e,this._markAsDirty()}get minorLineTickness(){return this._minorLineTickness}set minorLineTickness(e){this._minorLineTickness=e,this._markAsDirty()}get minorLineColor(){return this._minorLineColor}set minorLineColor(e){this._minorLineColor=e,this._markAsDirty()}get majorLineTickness(){return this._majorLineTickness}set majorLineTickness(e){this._majorLineTickness=e,this._markAsDirty()}get majorLineColor(){return this._majorLineColor}set majorLineColor(e){this._majorLineColor=e,this._markAsDirty()}get majorLineFrequency(){return this._majorLineFrequency}set majorLineFrequency(e){this._majorLineFrequency=e,this._markAsDirty()}constructor(e){super(e),this.name=e,this._cellWidth=20,this._cellHeight=20,this._minorLineTickness=1,this._minorLineColor="DarkGray",this._majorLineTickness=2,this._majorLineColor="White",this._majorLineFrequency=5,this._background="Black",this._displayMajorLines=!0,this._displayMinorLines=!0}_draw(e){if(e.save(),this._applyStates(e),this._isEnabled){this._background&&(e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));const t=this._currentMeasure.width/this._cellWidth,i=this._currentMeasure.height/this._cellHeight,s=this._currentMeasure.left+this._currentMeasure.width/2,r=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){e.strokeStyle=this._minorLineColor,e.lineWidth=this._minorLineTickness;for(let i=-t/2+1;i<t/2;i++){const t=s+i*this.cellWidth;e.beginPath(),e.moveTo(t,this._currentMeasure.top),e.lineTo(t,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(let t=-i/2+1;t<i/2;t++){const i=r+t*this.cellHeight;e.beginPath(),e.moveTo(this._currentMeasure.left,i),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,i),e.stroke()}}if(this._displayMajorLines){e.strokeStyle=this._majorLineColor,e.lineWidth=this._majorLineTickness;for(let i=-t/2+this._majorLineFrequency;i<t/2;i+=this._majorLineFrequency){const t=s+i*this.cellWidth;e.beginPath(),e.moveTo(t,this._currentMeasure.top),e.lineTo(t,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(let t=-i/2+this._majorLineFrequency;t<i/2;t+=this._majorLineFrequency){const i=r+t*this.cellHeight;e.moveTo(this._currentMeasure.left,i),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,i),e.closePath(),e.stroke()}}}e.restore()}_getTypeName(){return"DisplayGrid"}}(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"displayMinorLines",null),(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"displayMajorLines",null),(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"background",null),(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"cellWidth",null),(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"cellHeight",null),(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"minorLineTickness",null),(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"minorLineColor",null),(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"majorLineTickness",null),(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"majorLineColor",null),(0,Et.Cg)([(0,Rt.lK)()],fy.prototype,"majorLineFrequency",null),(0,Ft.Y5)("BABYLON.GUI.DisplayGrid",fy);class my extends ly{get displayThumb(){return this._displayThumb&&null!=this.thumbImage}set displayThumb(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())}get backgroundImage(){return this._backgroundImage}set backgroundImage(e){this._backgroundImage!==e&&(this._backgroundImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((()=>this._markAsDirty())),this._markAsDirty())}get valueBarImage(){return this._valueBarImage}set valueBarImage(e){this._valueBarImage!==e&&(this._valueBarImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((()=>this._markAsDirty())),this._markAsDirty())}get thumbImage(){return this._thumbImage}set thumbImage(e){this._thumbImage!==e&&(this._thumbImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((()=>this._markAsDirty())),this._markAsDirty())}constructor(e){super(e),this.name=e,this._tempMeasure=new ms(0,0,0,0)}_getTypeName(){return"ImageBasedSlider"}_draw(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");const t=this._getThumbPosition(),i=this._renderLeft,s=this._renderTop,r=this._renderWidth,n=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,s,r,n),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(e)),this._valueBarImage&&(this.isVertical?this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,s+t,r,n-t+this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(i,s+t,r,n-t):this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,s,t+this._effectiveThumbThickness/2,n):this._tempMeasure.copyFromFloats(i,s,t,n),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(e)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset,this._currentMeasure.top+t,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+t,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()}serialize(e){super.serialize(e);const t={},i={},s={};this.backgroundImage.serialize(t),this.thumbImage.serialize(i),this.valueBarImage.serialize(s),e.backgroundImage=t,e.thumbImage=i,e.valueBarImage=s}_parseFromContent(e,t){super._parseFromContent(e,t),this.backgroundImage=hr.Parse(e.backgroundImage,t),this.thumbImage=hr.Parse(e.thumbImage,t),this.valueBarImage=hr.Parse(e.valueBarImage,t)}}(0,Et.Cg)([(0,Rt.lK)()],my.prototype,"displayThumb",null),(0,Ft.Y5)("BABYLON.GUI.ImageBasedSlider",my),xs.AddHeader=function(e,t,i,s){const r=new ey("panel"),n=!s||s.isHorizontal,o=!s||s.controlFirst;r.isVertical=!n;const a=new lr("header");return a.text=t,a.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,n?a.width=i:a.height=i,o?(r.addControl(e),r.addControl(a),a.paddingLeft="5px"):(r.addControl(a),r.addControl(e),a.paddingRight="5px"),a.shadowBlur=e.shadowBlur,a.shadowColor=e.shadowColor,a.shadowOffsetX=e.shadowOffsetX,a.shadowOffsetY=e.shadowOffsetY,r};class by{constructor(){this._colorStops=[],this._gradientDirty=!0}_addColorStopsToCanvasGradient(){for(const e of this._colorStops)this._canvasGradient.addColorStop(e.offset,e.color)}getCanvasGradient(e){return(this._gradientDirty||this._context!==e)&&(this._context=e,this._canvasGradient=this._createCanvasGradient(e),this._addColorStopsToCanvasGradient(),this._gradientDirty=!1),this._canvasGradient}addColorStop(e,t){this._colorStops.push({offset:e,color:t}),this._gradientDirty=!0}removeColorStop(e){this._colorStops=this._colorStops.filter((t=>t.offset!==e)),this._gradientDirty=!0}clearColorStops(){this._colorStops=[],this._gradientDirty=!0}get colorStops(){return this._colorStops}getClassName(){return"BaseGradient"}serialize(e){e.colorStops=this._colorStops,e.className=this.getClassName()}parse(e){this._colorStops=e.colorStops}}var vy,Ty,yy;(0,Ft.Y5)("BABYLON.GUI.LinearGradient",class extends by{constructor(e,t,i,s){super(),this._x0=e??0,this._y0=t??0,this._x1=i??0,this._y1=s??0}_createCanvasGradient(e){return e.createLinearGradient(this._x0,this._y0,this._x1,this._y1)}get x0(){return this._x0}get x1(){return this._x1}get y0(){return this._y0}get y1(){return this._y1}getClassName(){return"LinearGradient"}serialize(e){super.serialize(e),e.x0=this._x0,e.y0=this._y0,e.x1=this._x1,e.y1=this._y1}parse(e){super.parse(e),this._x0=e.x0,this._y0=e.y0,this._x1=e.x1,this._y1=e.y1}}),(0,Ft.Y5)("BABYLON.GUI.RadialGradient",class extends by{constructor(e,t,i,s,r,n){super(),this._x0=e??0,this._y0=t??0,this._r0=i??0,this._x1=s??0,this._y1=r??0,this._r1=n??0}_createCanvasGradient(e){return e.createRadialGradient(this._x0,this._y0,this._r0,this._x1,this._y1,this._r1)}get x0(){return this._x0}get x1(){return this._x1}get y0(){return this._y0}get y1(){return this._y1}get r0(){return this._r0}get r1(){return this._r1}getClassName(){return"RadialGradient"}serialize(e){super.serialize(e),e.x0=this._x0,e.y0=this._y0,e.r0=this._r0,e.x1=this._x1,e.y1=this._y1,e.r1=this._r1}parse(e){super.parse(e),this._x0=e.x0,this._y0=e.y0,this._r0=e.r0,this._x1=e.x1,this._y1=e.y1,this._r1=e.r1}}),o(1994);class xy{constructor(e,t,i){this.name=e,this._parentTask=t,this._context=i,this.disabled=!1}setExecuteFunc(e){this._executeFunc=e}_execute(){this.disabled||this._executeFunc(this._context)}_isValid(){return void 0!==this._executeFunc?null:"Execute function is not set (call setExecuteFunc to set it)"}}class Ay extends xy{static IsCullPass(e){return void 0!==e.setObjectList}get objectList(){return this._objectList}setObjectList(e){this._objectList=e}constructor(e,t,i,s){super(e,t,i),this._engine=s}_isValid(){return super._isValid()||(void 0!==this._objectList?null:"Object list is not set (call setObjectList to set it)")}}class Cy extends xy{static IsRenderPass(e){return void 0!==e.setRenderTarget}get renderTarget(){return this._renderTarget}get renderTargetDepth(){return this._renderTargetDepth}constructor(e,t,i,s){super(e,t,i),this._dependencies=new Set,this._engine=s}setRenderTarget(e){this._renderTarget=e}setRenderTargetDepth(e){this._renderTargetDepth=e}addDependencies(e){if(Array.isArray(e))for(const t of e)this._dependencies.add(t);else this._dependencies.add(e)}collectDependencies(e){const t=this._dependencies.keys();for(let i=t.next();!0!==i.done;i=t.next())e.add(i.value);if(this._renderTarget)if(Array.isArray(this._renderTarget))for(const t of this._renderTarget)void 0!==t&&e.add(t);else e.add(this._renderTarget);this._renderTargetDepth&&e.add(this._renderTargetDepth)}_execute(){this._frameGraphRenderTarget=this._frameGraphRenderTarget||this._context.createRenderTarget(this.name,this._renderTarget,this._renderTargetDepth),this._context.bindRenderTarget(this._frameGraphRenderTarget,`frame graph render pass - ${this.name}`),super._execute(),this._context._flushDebugMessages()}_isValid(){return super._isValid()||(void 0!==this._renderTarget||void 0!==this.renderTargetDepth?null:"Render target and render target depth cannot both be undefined.")}}class Sy{get name(){return this._name}set name(e){this._name=e}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get passes(){return this._passes}get passesDisabled(){return this._passesDisabled}isReady(){return!0}dispose(){this._reset(),this.onTexturesAllocatedObservable.clear()}constructor(e,t){this._passes=[],this._passesDisabled=[],this._disabled=!1,this.onTexturesAllocatedObservable=new Zi.cP,this.name=e,this._frameGraph=t,this._reset()}_reset(){this._passes.length=0,this._passesDisabled.length=0}_addPass(e,t){t?this._passesDisabled.push(e):this._passes.push(e)}_checkTask(){let e,t=null,i=null;for(const s of this._passes){const r=s._isValid();if(r)throw new Error(`Pass "${s.name}" is not valid. ${r}`);if(Cy.IsRenderPass(s)){const e=Array.isArray(s.renderTarget)?s.renderTarget:[s.renderTarget];t=[];for(const i of e)void 0!==i&&t.push(this._frameGraph.textureManager.getTextureFromHandle(i));i=void 0!==s.renderTargetDepth?this._frameGraph.textureManager.getTextureFromHandle(s.renderTargetDepth):null}else Ay.IsCullPass(s)&&(e=s.objectList)}let s,r=null,n=[],o=null;for(const e of this._passesDisabled){const t=e._isValid();if(t)throw new Error(`Pass "${e.name}" is not valid. ${t}`);if(Cy.IsRenderPass(e)){const t=Array.isArray(e.renderTarget)?e.renderTarget:[e.renderTarget];r=[];for(const e of t)void 0!==e&&r.push(this._frameGraph.textureManager.getTextureFromHandle(e));n=t,o=void 0!==e.renderTargetDepth?this._frameGraph.textureManager.getTextureFromHandle(e.renderTargetDepth):null}else Ay.IsCullPass(e)&&(s=e.objectList)}if(this._passesDisabled.length>0){if(!this._checkSameRenderTarget(t,r)){let e=!0;for(const t of n)if(void 0!==t&&!this._frameGraph.textureManager.isHistoryTexture(t)){e=!1;break}if(!e)throw new Error(`The output texture of the task "${this.name}" is different when it is enabled or disabled.`)}if(i!==o)throw new Error(`The output depth texture of the task "${this.name}" is different when it is enabled or disabled.`);if(e!==s)throw new Error(`The output object list of the task "${this.name}" is different when it is enabled or disabled.`)}}_getPasses(){return this.disabled&&this._passesDisabled.length>0?this._passesDisabled:this._passes}_checkSameRenderTarget(e,t){if(null===e||null===t)return e===t;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}}class Ey extends Sy{get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._adt.disablePicking=e}get gui(){return this._adt}constructor(e,t,i){if(super(e,t),i){if(!i.useStandalone)throw new Error(`AdvancedDynamicTexture "${e}": the texture must have been created with the useStandalone property set to true`)}else i=Ms.CreateFullscreenUI(e,void 0,{useStandalone:!0});this._adt=i,this.outputTexture=this._frameGraph.textureManager.createDanglingHandle()}isReady(){return this._adt.guiIsReady()&&this._adt._layerToDispose.isReady()}record(){if(void 0===this.destinationTexture)throw new Error("FrameGraphGUITask: destinationTexture is required");this._frameGraph.textureManager.resolveDanglingHandle(this.outputTexture,this.destinationTexture);const e=this._frameGraph.addRenderPass(this.name);e.setRenderTarget(this.outputTexture),e.setExecuteFunc((e=>{this._adt._checkUpdate(null),e.render(this._adt._layerToDispose)}));const t=this._frameGraph.addRenderPass(this.name+"_disabled",!0);t.setRenderTarget(this.outputTexture),t.setExecuteFunc((e=>{}))}dispose(){this._adt.dispose(),super.dispose()}}!function(e){e[e.Texture=1]="Texture",e[e.TextureBackBuffer=2]="TextureBackBuffer",e[e.TextureBackBufferDepthStencilAttachment=4]="TextureBackBufferDepthStencilAttachment",e[e.TextureDepthStencilAttachment=8]="TextureDepthStencilAttachment",e[e.TextureViewDepth=16]="TextureViewDepth",e[e.TextureViewNormal=32]="TextureViewNormal",e[e.TextureAlbedo=64]="TextureAlbedo",e[e.TextureReflectivity=128]="TextureReflectivity",e[e.TextureWorldPosition=256]="TextureWorldPosition",e[e.TextureVelocity=512]="TextureVelocity",e[e.TextureIrradiance=1024]="TextureIrradiance",e[e.TextureAlbedoSqrt=2048]="TextureAlbedoSqrt",e[e.TextureScreenDepth=4096]="TextureScreenDepth",e[e.TextureWorldNormal=8192]="TextureWorldNormal",e[e.TextureLocalPosition=16384]="TextureLocalPosition",e[e.TextureLinearVelocity=32768]="TextureLinearVelocity",e[e.TextureAllButBackBufferDepthStencil=1048571]="TextureAllButBackBufferDepthStencil",e[e.TextureAllButBackBuffer=1048569]="TextureAllButBackBuffer",e[e.TextureAll=1048575]="TextureAll",e[e.ResourceContainer=1048576]="ResourceContainer",e[e.ShadowGenerator=2097152]="ShadowGenerator",e[e.ShadowLight=4194304]="ShadowLight",e[e.Camera=16777216]="Camera",e[e.ObjectList=33554432]="ObjectList",e[e.AutoDetect=268435456]="AutoDetect",e[e.BasedOnInput=536870912]="BasedOnInput",e[e.Undefined=1073741824]="Undefined",e[e.Object=2147483648]="Object",e[e.All=4294967295]="All"}(vy||(vy={})),function(e){e[e.Compatible=0]="Compatible",e[e.TypeIncompatible=1]="TypeIncompatible",e[e.HierarchyIssue=2]="HierarchyIssue"}(Ty||(Ty={})),function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(yy||(yy={}));class Ry{get direction(){return this._direction}static IsTextureHandle(e){return void 0!==e&&Number.isFinite(e)}static IsShadowGenerator(e){return void 0!==e&&void 0!==e.mapSize}static IsShadowLight(e){return void 0!==e&&void 0!==e.setShadowProjectionMatrix}get type(){if(this._type===vy.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===vy.BasedOnInput){if(this._typeConnectionSource){const e="function"==typeof this._typeConnectionSource?this._typeConnectionSource():this._typeConnectionSource;return e.isConnected?e._connectedPoint.type:this._defaultConnectionPointType??e.type}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(e){this._type=e}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((e=>e.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}createCustomInputBlock(){return null}constructor(e,t,i){this._connectedPoint=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=vy.Undefined,this._linkedConnectionSource=null,this._isMainLinkSource=!1,this._typeConnectionSource=null,this._defaultConnectionPointType=null,this.needDualDirectionValidation=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new Zi.cP,this.onDisconnectionObservable=new Zi.cP,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this._ownerBlock=t,this.name=e,this._direction=i}getClassName(){return"NodeRenderGraphConnectionPoint"}canConnectTo(e){return 0===this.checkCompatibilityState(e)}checkCompatibilityState(e){const t=this._ownerBlock,i=e.ownerBlock;if(this.type!==e.type&&e.innerType!==vy.AutoDetect)return e.acceptedConnectionPointTypes&&-1!==e.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(e.excludedConnectionPointTypes&&-1!==e.excludedConnectionPointTypes.indexOf(this.type))return 1;let s=i,r=t;return 0===this.direction&&(s=t,r=i),s.isAnAncestorOf(r)?2:0}connectTo(e,t=!1){if(!t&&!this.canConnectTo(e))throw"Cannot connect these two connectors.";return this._endpoints.push(e),e._connectedPoint=this,this.onConnectionObservable.notifyObservers(e),e.onConnectionObservable.notifyObservers(this),this}disconnectFrom(e){const t=this._endpoints.indexOf(e);return-1===t||(this._endpoints.splice(t,1),e._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(e),e.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(e){let t=0,i=2**t;for(;i<vy.All;)e&i||this.excludedConnectionPointTypes.push(i),t++,i=2**t}addAcceptedConnectionPointTypes(e){let t=0,i=2**t;for(;i<vy.All;)e&i&&-1===this.acceptedConnectionPointTypes.indexOf(i)&&this.acceptedConnectionPointTypes.push(i),t++,i=2**t}serialize(e=!0){const t={};return t.name=this.name,t.displayName=this.displayName,e&&this.connectedPoint&&(t.inputName=this.name,t.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,t.targetConnectionName=this.connectedPoint.name,t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),t}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Py{get disabled(){return!!this._frameGraphTask?.disabled}set disabled(e){this._frameGraphTask&&(this._frameGraphTask.disabled=e)}get task(){return this._frameGraphTask}get inputs(){return this._inputs}get outputs(){return this._outputs}get name(){return this._name}set name(e){this._name=e}get isInput(){return this._isInput}get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isDebug(){return this._isDebug}get isUnique(){return this._isUnique}getClassName(){return"NodeRenderGraphBlock"}_inputRename(e){return e}_outputRename(e){return e}isAnAncestorOf(e){for(const t of this._outputs)if(t.hasEndpoints)for(const i of t.endpoints){if(i.ownerBlock===e)return!0;if(i.ownerBlock.isAnAncestorOf(e))return!0}return!1}isAnAncestorOfType(e){if(this.getClassName()===e)return!0;for(const t of this._outputs)if(t.hasEndpoints)for(const i of t.endpoints)if(i.ownerBlock.isAnAncestorOfType(e))return!0;return!1}getDescendantOfPredicate(e){if(e(this))return this;for(const t of this._outputs)if(t.hasEndpoints)for(const i of t.endpoints){const t=i.ownerBlock.getDescendantOfPredicate(e);if(t)return t}return null}constructor(e,t,i,...s){this._name="",this._isInput=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._isDebug=!1,this._isUnique=!1,this.onBuildObservable=new Zi.cP,this._inputs=new Array,this._outputs=new Array,this._codeVariableName="",this._additionalConstructionParameters=null,this.visibleOnFrame=!1,this._name=e,this._frameGraph=t,this._scene=i,this._engine=i.getEngine(),this.uniqueId=Fl.K.UniqueId}registerInput(e,t,i=!1,s){return(s=s??new Ry(e,this,0)).type=t,s.isOptional=i,this._inputs.push(s),this}registerOutput(e,t,i){return(i=i??new Ry(e,this,1)).type=t,this._outputs.push(i),this}_addDependenciesInput(){this.registerInput("dependencies",vy.Texture,!0);const e=this.getInputByName("dependencies");return e.addAcceptedConnectionPointTypes(vy.TextureAllButBackBuffer|vy.ResourceContainer|vy.ShadowGenerator),e}_buildBlock(e){}_customBuildStep(e){}_propagateInputValueToOutput(e,t){e.connectedPoint&&(t.value=e.connectedPoint.value)}build(e){if(this._buildId===e.buildId)return!0;this._buildId=e.buildId;for(const t of this._inputs){if(!t.connectedPoint){t.isOptional||e._notConnectedNonOptionalInputs.push(t);continue}const i=t.connectedPoint.ownerBlock;i&&i!==this&&i.build(e)}if(this._customBuildStep(e),e.verbose&&It.V.Log(`Building ${this.name} [${this.getClassName()}]`),this._frameGraphTask&&(this._frameGraphTask.name=this.name),this._buildBlock(e),this._frameGraphTask){this._frameGraphTask.dependencies=void 0;const e=this.getInputByName("dependencies")?.connectedPoint;if(e)if(e.type===vy.ResourceContainer){const t=e.ownerBlock;for(let e=0;e<t.inputs.length;e++){const i=t.inputs[e];i.connectedPoint&&void 0!==i.connectedPoint.value&&Ry.IsTextureHandle(i.connectedPoint.value)&&(this._frameGraphTask.dependencies=this._frameGraphTask.dependencies||new Set,this._frameGraphTask.dependencies.add(i.connectedPoint.value))}}else Ry.IsTextureHandle(e.value)&&(this._frameGraphTask.dependencies=this._frameGraphTask.dependencies||new Set,this._frameGraphTask.dependencies.add(e.value));this._frameGraph.addTask(this._frameGraphTask)}return this.onBuildObservable.notifyObservers(this),!1}_linkConnectionTypes(e,t,i=!1){i?this._inputs[t]._acceptedConnectionPointType=this._inputs[e]:(this._inputs[e]._linkedConnectionSource=this._inputs[t],this._inputs[e]._isMainLinkSource=!0),this._inputs[t]._linkedConnectionSource=this._inputs[e]}initialize(){}autoConfigure(){}getInputByName(e){const t=this._inputs.filter((t=>t.name===e));return t.length?t[0]:null}getOutputByName(e){const t=this._outputs.filter((t=>t.name===e));return t.length?t[0]:null}serialize(){const e={};e.customType="BABYLON."+this.getClassName(),e.id=this.uniqueId,e.name=this.name,e.visibleOnFrame=this.visibleOnFrame,e.disabled=this.disabled,this._additionalConstructionParameters&&(e.additionalConstructionParameters=this._additionalConstructionParameters),e.inputs=[],e.outputs=[];for(const t of this.inputs)e.inputs.push(t.serialize());for(const t of this.outputs)e.outputs.push(t.serialize(!1));return e}_deserialize(e){this._name=e.name,this.comments=e.comments,this.visibleOnFrame=e.visibleOnFrame,this.disabled=e.disabled,this._deserializePortDisplayNamesAndExposedOnFrame(e)}_deserializePortDisplayNamesAndExposedOnFrame(e){const t=e.inputs,i=e.outputs;t&&t.forEach((e=>{const t=this.inputs.find((t=>t.name===e.name));t&&(e.displayName&&(t.displayName=e.displayName),e.isExposedOnFrame&&(t.isExposedOnFrame=e.isExposedOnFrame,t.exposedPortPosition=e.exposedPortPosition))})),i&&i.forEach(((e,t)=>{e.displayName&&(this.outputs[t].displayName=e.displayName),e.isExposedOnFrame&&(this.outputs[t].isExposedOnFrame=e.isExposedOnFrame,this.outputs[t].exposedPortPosition=e.exposedPortPosition)}))}_dumpPropertiesCode(){const e=this._codeVariableName;return`${e}.visibleOnFrame = ${this.visibleOnFrame};\n${e}.disabled = ${this.disabled};\n`}_dumpCodeForOutputConnections(e){let t="";if(-1!==e.indexOf(this))return t;e.push(this);for(const i of this.inputs){if(!i.isConnected)continue;const s=i.connectedPoint,r=s.ownerBlock;t+=r._dumpCodeForOutputConnections(e),t+=`${r._codeVariableName}.${r._outputRename(s.name)}.connectTo(${this._codeVariableName}.${this._inputRename(i.name)});\n`}return t}_dumpCode(e,t){t.push(this);const i=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=i||`${this.getClassName()}_${this.uniqueId}`,-1!==e.indexOf(this._codeVariableName)){let t=0;do{t++,this._codeVariableName=i+t}while(-1!==e.indexOf(this._codeVariableName))}e.push(this._codeVariableName);let s=`\n// ${this.getClassName()}\n`;this.comments&&(s+=`// ${this.comments}\n`);const r=this.getClassName();if("RenderGraphInputBlock"===r){const e=this.type;s+=`var ${this._codeVariableName} = new BABYLON.NodeRenderGraphInputBlock("${this.name}", nodeRenderGraph.frameGraph, scene, BABYLON.NodeRenderGraphBlockConnectionPointTypes.${vy[e]});\n`}else this._additionalConstructionParameters?s+=`var ${this._codeVariableName} = new BABYLON.${r}("${this.name}", nodeRenderGraph.frameGraph, scene, ...${JSON.stringify(this._additionalConstructionParameters)});\n`:s+=`var ${this._codeVariableName} = new BABYLON.${r}("${this.name}", nodeRenderGraph.frameGraph, scene);\n`;s+=this._dumpPropertiesCode()+"\n";for(const i of this.inputs){if(!i.isConnected)continue;const r=i.connectedPoint.ownerBlock;-1===t.indexOf(r)&&(s+=r._dumpCode(e,t))}for(const i of this.outputs)if(i.hasEndpoints)for(const r of i.endpoints){const i=r.ownerBlock;i&&-1===t.indexOf(i)&&(s+=i._dumpCode(e,t))}return s}clone(){const e=this.serialize(),t=(0,Ft.n9)(e.customType);if(t){const i=e.additionalConstructionParameters,s=i?new t("",this._frameGraph,this._scene,...i):new t("",this._frameGraph,this._scene);return s._deserialize(e),s}return null}dispose(){for(const e of this.inputs)e.dispose();for(const e of this.outputs)e.dispose();this._frameGraphTask?.dispose(),this._frameGraphTask=void 0,this.onBuildObservable.clear()}}(0,Et.Cg)([(0,Rt.lK)("comment")],Py.prototype,"comments",void 0),(0,Ft.Y5)("BABYLON.GUI.NodeRenderGraphGUIBlock",class extends Py{get task(){return this._frameGraphTask}get gui(){return this._frameGraphTask.gui}constructor(e,t,i){super(e,t,i),this.registerInput("destination",vy.Texture),this._addDependenciesInput(),this.registerOutput("output",vy.BasedOnInput),this.destination.addAcceptedConnectionPointTypes(vy.TextureAll),this.output._typeConnectionSource=this.destination,this._gui=Ms.CreateFullscreenUI(this.name,void 0,{useStandalone:!0}),this._frameGraphTask=new Ey(this.name,t,this._gui)}getClassName(){return"GUI.NodeRenderGraphGUIBlock"}get destination(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e),this.output.value=this._frameGraphTask.outputTexture,this._frameGraphTask.destinationTexture=this.destination.connectedPoint?.value}});class Iy extends gt.Pq{constructor(e,t=0){super(e.x,e.y,e.z),this.buttonIndex=t}}class My{get position(){return this._node?this._node.position:(this._position=this._position||gt.Pq.Zero(),this._position)}set position(e){this._position=e,this._node&&(this._node.position=this._position)}get scaling(){return this._node?this._node.scaling:(this._scaling=this.scaling||new gt.Pq(1,1,1),this._scaling)}set scaling(e){this._scaling=e,this._node&&(this._isScaledByManager=!1,this._node.scaling=this._scaling)}get behaviors(){return this._behaviors}addBehavior(e){if(-1!==this._behaviors.indexOf(e))return this;e.init();const t=this._host.scene;return t.isLoading?t.onDataLoadedObservable.addOnce((()=>{e.attach(this)})):e.attach(this),this._behaviors.push(e),this}removeBehavior(e){const t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}getBehaviorByName(e){for(const t of this._behaviors)if(t.name===e)return t;return null}get isVisible(){return this._isVisible}set isVisible(e){if(this._isVisible===e)return;this._isVisible=e;const t=this.mesh;t&&t.setEnabled(e)}constructor(e){this.name=e,this._downCount=0,this._enterCount=-1,this._downPointerIds={},this._isVisible=!0,this._isScaledByManager=!1,this.onPointerMoveObservable=new Zi.cP,this.onPointerOutObservable=new Zi.cP,this.onPointerDownObservable=new Zi.cP,this.onPointerUpObservable=new Zi.cP,this.onPointerClickObservable=new Zi.cP,this.onPointerEnterObservable=new Zi.cP,this._behaviors=new Array}get typeName(){return this._getTypeName()}getClassName(){return this._getTypeName()}_getTypeName(){return"Control3D"}get node(){return this._node}get mesh(){return this._node instanceof Sc.u?this._node:null}linkToTransformNode(e){return this._node&&(this._node.parent=e),this}_prepareNode(e){if(!this._node){if(this._node=this._createNode(e),!this.node)return;this._position&&(this.node.position=this._position),this._scaling&&(this.node.scaling=this._scaling),this._injectGUI3DReservedDataStore(this.node).control=this;const t=this.mesh;t&&(t.isPickable=!0,this._affectMaterial(t))}}_injectGUI3DReservedDataStore(e){return e.reservedDataStore=e.reservedDataStore??{},e.reservedDataStore.GUI3D=e.reservedDataStore.GUI3D??{},e.reservedDataStore.GUI3D}_createNode(e){return null}_affectMaterial(e){e.material=null}_isTouchButton3D(e){return void 0!==e._generatePointerEventType}_onPointerMove(e,t){this.onPointerMoveObservable.notifyObservers(t,-1,e,this)}_onPointerEnter(e){return-1===this._enterCount&&(this._enterCount=0),this._enterCount++,!(this._enterCount>1||(this.onPointerEnterObservable.notifyObservers(this,-1,e,this),this.pointerEnterAnimation&&this.pointerEnterAnimation(),0))}_onPointerOut(e){this._enterCount--,this._enterCount>0||(this._enterCount=0,this.onPointerOutObservable.notifyObservers(this,-1,e,this),this.pointerOutAnimation&&this.pointerOutAnimation())}_onPointerDown(e,t,i,s){return this._downCount++,this._downPointerIds[i]=this._downPointerIds[i]+1||1,1===this._downCount&&(this.onPointerDownObservable.notifyObservers(new Iy(t,s),-1,e,this),this.pointerDownAnimation&&this.pointerDownAnimation(),!0)}_onPointerUp(e,t,i,s,r){this._downCount--,this._downPointerIds[i]--,this._downPointerIds[i]<=0&&delete this._downPointerIds[i],this._downCount<0?this._downCount=0:0==this._downCount&&(r&&(this._enterCount>0||-1===this._enterCount)&&this.onPointerClickObservable.notifyObservers(new Iy(t,s),-1,e,this),this.onPointerUpObservable.notifyObservers(new Iy(t,s),-1,e,this),this.pointerUpAnimation&&this.pointerUpAnimation())}forcePointerUp(e=null){if(null!==e)this._onPointerUp(this,gt.Pq.Zero(),e,0,!0);else{for(const e in this._downPointerIds)this._onPointerUp(this,gt.Pq.Zero(),+e,0,!0);this._downCount>0&&(this._downCount=1,this._onPointerUp(this,gt.Pq.Zero(),0,0,!0))}}_processObservables(e,t,i,s,r){if(this._isTouchButton3D(this)&&i&&(e=this._generatePointerEventType(e,i,this._downCount)),e===tt.Zp.POINTERMOVE){this._onPointerMove(this,t);const e=this._host._lastControlOver[s];return e&&e!==this&&e._onPointerOut(this),e!==this&&this._onPointerEnter(this),this._host._lastControlOver[s]=this,!0}return e===tt.Zp.POINTERDOWN?(this._onPointerDown(this,t,s,r),this._host._lastControlDown[s]=this,this._host._lastPickedControl=this,!0):(e===tt.Zp.POINTERUP||e===tt.Zp.POINTERDOUBLETAP)&&(this._host._lastControlDown[s]&&this._host._lastControlDown[s]._onPointerUp(this,t,s,r,!0),delete this._host._lastControlDown[s],!0)}_disposeNode(){this._node&&(this._node.dispose(),this._node=null)}dispose(){this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this._disposeNode();for(const e of this._behaviors)e.detach()}}class wy extends My{constructor(){super(...arguments),this._contentResolution=512,this._contentScaleRatio=2}get content(){return this._content}set content(e){if(this._content=e,e&&this._host&&this._host.utilityLayer){if(this._facadeTexture)this._facadeTexture.rootContainer.clearControls();else{const e="number"==typeof this._contentResolution?this._contentResolution:this._contentResolution.width,t="number"==typeof this._contentResolution?this._contentResolution:this._contentResolution.height;this._facadeTexture=new Ms("Facade",e,t,this._host.utilityLayer.utilityLayerScene,!0,Dt.g.TRILINEAR_SAMPLINGMODE),this._setFacadeTextureScaling(),this._facadeTexture.premulAlpha=!0}this._facadeTexture.addControl(e),this._applyFacade(this._facadeTexture)}}_setFacadeTextureScaling(){this._facadeTexture&&("number"!=typeof this._contentResolution&&(this._contentScaleRatioY=this._contentResolution.height/this._contentResolution.width*this._contentScaleRatio),this._facadeTexture.rootContainer.scaleX=this._contentScaleRatio,this._facadeTexture.rootContainer.scaleY=this._contentScaleRatioY??this._contentScaleRatio)}get contentResolution(){return this._contentResolution}set contentResolution(e){const t="number"==typeof e?e:e.width,i="number"==typeof e?e:e.height,s="number"==typeof this._contentResolution?this._contentResolution:this._contentResolution.width,r="number"==typeof this._contentResolution?this._contentResolution:this._contentResolution.height;t===s&&i===r||(this._contentResolution=e,this._resetContent())}_disposeFacadeTexture(){this._facadeTexture&&(this._facadeTexture.dispose(),this._facadeTexture=null)}_resetContent(){this._disposeFacadeTexture(),this.content=this._content}_applyFacade(e){}}class Oy extends wy{constructor(e){super(e)}_getTypeName(){return"AbstractButton3D"}_createNode(e){return new Gn.V("button"+this.name,e)}}class By extends Oy{constructor(e,t){super(e),this._options={width:1,height:1,depth:.08,...t},this.pointerEnterAnimation=()=>{this.mesh&&(this._currentMaterial.emissiveColor=bt.v9.Red())},this.pointerOutAnimation=()=>{this._currentMaterial.emissiveColor=bt.v9.Black()},this.pointerDownAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(.95)},this.pointerUpAnimation=()=>{this.mesh&&this.mesh.scaling.scaleInPlace(1/.95)}}_applyFacade(e){this._currentMaterial.emissiveTexture=e}_getTypeName(){return"Button3D"}_createNode(e){const t=new Array(6);for(let e=0;e<6;e++)t[e]=new gt.IU(0,0,0,0);e.useRightHandedSystem?t[0].copyFromFloats(1,0,0,1):t[1].copyFromFloats(0,0,1,1);const i=so(this.name+"_rootMesh",{width:this._options.width,height:this._options.height,depth:this._options.depth,faceUV:t,wrap:!0},e);return this._contentScaleRatioY=this._contentScaleRatio*this._options.width/this._options.height,this._setFacadeTextureScaling(),i}_affectMaterial(e){const t=new ft.F(this.name+"Material",e.getScene());t.specularColor=bt.v9.Black(),e.material=t,this._currentMaterial=t,this._resetContent()}dispose(){super.dispose(),this._disposeFacadeTexture(),this._currentMaterial&&this._currentMaterial.dispose()}}class Dy extends My{get children(){return this._children}get blockLayout(){return this._blockLayout}set blockLayout(e){this._blockLayout!==e&&(this._blockLayout=e,this._blockLayout||this._arrangeChildren())}constructor(e){super(e),this._blockLayout=!1,this._children=new Array}updateLayout(){return this._arrangeChildren(),this}containsControl(e){return-1!==this._children.indexOf(e)}addControl(e){return-1!==this._children.indexOf(e)||(e.parent=this,e._host=this._host,this._children.push(e),this._host.utilityLayer&&(e._prepareNode(this._host.utilityLayer.utilityLayerScene),e.node&&(e.node.parent=this.node),this.blockLayout||this._arrangeChildren())),this}_arrangeChildren(){}_createNode(e){return new Gn.V("ContainerNode",e)}removeControl(e){const t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null,e._disposeNode()),this}_getTypeName(){return"Container3D"}dispose(){for(const e of this._children)e.dispose();this._children.length=0,super.dispose()}}Dy.UNSET_ORIENTATION=0,Dy.FACEORIGIN_ORIENTATION=1,Dy.FACEORIGINREVERSED_ORIENTATION=2,Dy.FACEFORWARD_ORIENTATION=3,Dy.FACEFORWARDREVERSED_ORIENTATION=4;class Fy extends Dy{get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._orientation=e,$i.S0.SetImmediate((()=>{this._arrangeChildren()})))}get columns(){return this._columns}set columns(e){this._columns!==e&&(this._columns=e,this._rowThenColum=!0,$i.S0.SetImmediate((()=>{this._arrangeChildren()})))}get rows(){return this._rows}set rows(e){this._rows!==e&&(this._rows=e,this._rowThenColum=!1,$i.S0.SetImmediate((()=>{this._arrangeChildren()})))}constructor(e){super(e),this._columns=10,this._rows=0,this._rowThenColum=!0,this._orientation=Dy.FACEORIGIN_ORIENTATION,this.margin=0}_arrangeChildren(){this._cellWidth=0,this._cellHeight=0;let e=0,t=0,i=0;for(const e of this._children){if(!e.mesh)continue;i++,e.mesh.computeWorldMatrix(!0);const t=e.mesh.getBoundingInfo().boundingBox.extendSize,s=e.mesh.getDescendants(!1);for(const e of s){e.computeWorldMatrix(!0);const i=e;if("function"==typeof i.getBoundingInfo){const e=i.getBoundingInfo().boundingBox.extendSize;t.x=Math.max(t.x,e.x),t.y=Math.max(t.y,e.y),t.z=Math.max(t.z,e.z)}}this._cellWidth=Math.max(this._cellWidth,2*t.x),this._cellHeight=Math.max(this._cellHeight,2*t.y)}this._cellWidth+=2*this.margin,this._cellHeight+=2*this.margin,this._rowThenColum?(t=this._columns,e=Math.ceil(i/this._columns)):(e=this._rows,t=Math.ceil(i/this._rows));const s=.5*t*this._cellWidth,r=.5*e*this._cellHeight,n=[];let o=0;if(this._rowThenColum)for(let a=0;a<e;a++)for(let e=0;e<t&&(n.push(new gt.Pq(e*this._cellWidth-s+this._cellWidth/2,a*this._cellHeight-r+this._cellHeight/2,0)),o++,!(o>i));e++);else for(let a=0;a<t;a++)for(let t=0;t<e&&(n.push(new gt.Pq(a*this._cellWidth-s+this._cellWidth/2,t*this._cellHeight-r+this._cellHeight/2,0)),o++,!(o>i));t++);o=0;for(const e of this._children)e.mesh&&(this._mapGridNode(e,n[o]),o++);this._finalProcessing()}_finalProcessing(){}}Ma.l.ShadersStore.fluentVertexShader="precision highp float;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform mat4 world;uniform mat4 viewProjection;varying vec2 vUV;\n#ifdef BORDER\nvarying vec2 scaleInfo;uniform float borderWidth;uniform vec3 scaleFactor;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\n#endif\nvoid main(void) {vUV=uv;\n#ifdef BORDER\nvec3 scale=scaleFactor;float minScale=min(min(scale.x,scale.y),scale.z);float maxScale=max(max(scale.x,scale.y),scale.z);float minOverMiddleScale=minScale/(scale.x+scale.y+scale.z-minScale-maxScale);float areaYZ=scale.y*scale.z;float areaXZ=scale.x*scale.z;float areaXY=scale.x*scale.y;float scaledBorderWidth=borderWidth; \nif (abs(normal.x)==1.0) \n{scale.x=scale.y;scale.y=scale.z;if (areaYZ>areaXZ && areaYZ>areaXY)\n{scaledBorderWidth*=minOverMiddleScale;}}\nelse if (abs(normal.y)==1.0) \n{scale.x=scale.z;if (areaXZ>areaXY && areaXZ>areaYZ)\n{scaledBorderWidth*=minOverMiddleScale;}}\nelse \n{if (areaXY>areaYZ && areaXY>areaXZ)\n{scaledBorderWidth*=minOverMiddleScale;}}\nfloat scaleRatio=min(scale.x,scale.y)/max(scale.x,scale.y);if (scale.x>scale.y)\n{scaleInfo.x=1.0-(scaledBorderWidth*scaleRatio);scaleInfo.y=1.0-scaledBorderWidth;}\nelse\n{scaleInfo.x=1.0-scaledBorderWidth;scaleInfo.y=1.0-(scaledBorderWidth*scaleRatio);} \n#endif \nvec4 worldPos=world*vec4(position,1.0);\n#ifdef HOVERLIGHT\nworldPosition=worldPos.xyz;\n#endif\ngl_Position=viewProjection*worldPos;}\n";Ma.l.ShadersStore.fluentPixelShader="precision highp float;varying vec2 vUV;uniform vec4 albedoColor;\n#ifdef INNERGLOW\nuniform vec4 innerGlowColor;\n#endif\n#ifdef BORDER\nvarying vec2 scaleInfo;uniform float edgeSmoothingValue;uniform float borderMinValue;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;uniform vec3 hoverPosition;uniform vec4 hoverColor;uniform float hoverRadius;\n#endif\n#ifdef TEXTURE\nuniform sampler2D albedoSampler;uniform mat4 textureMatrix;vec2 finalUV;\n#endif\nvoid main(void) {vec3 albedo=albedoColor.rgb;float alpha=albedoColor.a;\n#ifdef TEXTURE\nfinalUV=vec2(textureMatrix*vec4(vUV,1.0,0.0));albedo=texture2D(albedoSampler,finalUV).rgb;\n#endif\n#ifdef HOVERLIGHT\nfloat pointToHover=(1.0-clamp(length(hoverPosition-worldPosition)/hoverRadius,0.,1.))*hoverColor.a;albedo=clamp(albedo+hoverColor.rgb*pointToHover,0.,1.);\n#else\nfloat pointToHover=1.0;\n#endif\n#ifdef BORDER \nfloat borderPower=10.0;float inverseBorderPower=1.0/borderPower;vec3 borderColor=albedo*borderPower;vec2 distanceToEdge;distanceToEdge.x=abs(vUV.x-0.5)*2.0;distanceToEdge.y=abs(vUV.y-0.5)*2.0;float borderValue=max(smoothstep(scaleInfo.x-edgeSmoothingValue,scaleInfo.x+edgeSmoothingValue,distanceToEdge.x),\nsmoothstep(scaleInfo.y-edgeSmoothingValue,scaleInfo.y+edgeSmoothingValue,distanceToEdge.y));borderColor=borderColor*borderValue*max(borderMinValue*inverseBorderPower,pointToHover); \nalbedo+=borderColor;alpha=max(alpha,borderValue);\n#endif\n#ifdef INNERGLOW\nvec2 uvGlow=(vUV-vec2(0.5,0.5))*(innerGlowColor.a*2.0);uvGlow=uvGlow*uvGlow;uvGlow=uvGlow*uvGlow;albedo+=mix(vec3(0.0,0.0,0.0),innerGlowColor.rgb,uvGlow.x+uvGlow.y); \n#endif\ngl_FragColor=vec4(albedo,alpha);}";class Ly extends wt.M{constructor(){super(),this.INNERGLOW=!1,this.BORDER=!1,this.HOVERLIGHT=!1,this.TEXTURE=!1,this.rebuild()}}class Ny extends Ot.E{constructor(e,t){super(e,t),this.innerGlowColorIntensity=.5,this.innerGlowColor=new bt.v9(1,1,1),this.albedoColor=new bt.v9(.3,.35,.4),this.renderBorders=!1,this.borderWidth=.5,this.edgeSmoothingValue=.02,this.borderMinValue=.1,this.renderHoverLight=!1,this.hoverRadius=.01,this.hoverColor=new bt.ov(.3,.3,.3,1),this.hoverPosition=gt.Pq.Zero()}needAlphaBlending(){return 1!==this.alpha}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new Ly);const s=this.getScene(),r=t.materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&r._renderId===s.getRenderId())return!0;if(r._areTexturesDirty)if(r.INNERGLOW=this.innerGlowColorIntensity>0,r.BORDER=this.renderBorders,r.HOVERLIGHT=this.renderHoverLight,this._albedoTexture){if(!this._albedoTexture.isReadyOrNotBlocking())return!1;r.TEXTURE=!0}else r.TEXTURE=!1;const n=s.getEngine();if(r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();const e=[Mt.R.PositionKind];e.push(Mt.R.NormalKind),e.push(Mt.R.UVKind);const i="fluent",o=["world","viewProjection","innerGlowColor","albedoColor","borderWidth","edgeSmoothingValue","scaleFactor","borderMinValue","hoverColor","hoverPosition","hoverRadius","textureMatrix"],a=["albedoSampler"],h=[];(0,Ut.Bb)({uniformsNames:o,uniformBuffersNames:h,samplers:a,defines:r,maxSimultaneousLights:4});const l=r.toString();t.setEffect(s.getEngine().createEffect(i,{attributes:e,uniformsNames:o,uniformBuffersNames:h,samplers:a,defines:l,fallbacks:null,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),r,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,0))}bindForSubMesh(e,t,i){const s=this.getScene(),r=i.materialDefines;if(!r)return;const n=i.effect;if(n){if(this._activeEffect=n,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._mustRebind(s,n,i)&&(this._activeEffect.setColor4("albedoColor",this.albedoColor,this.alpha),r.INNERGLOW&&this._activeEffect.setColor4("innerGlowColor",this.innerGlowColor,this.innerGlowColorIntensity),r.BORDER&&(this._activeEffect.setFloat("borderWidth",this.borderWidth),this._activeEffect.setFloat("edgeSmoothingValue",this.edgeSmoothingValue),this._activeEffect.setFloat("borderMinValue",this.borderMinValue),t.getBoundingInfo().boundingBox.extendSize.multiplyToRef(t.scaling,gt.AA.Vector3[0]),this._activeEffect.setVector3("scaleFactor",gt.AA.Vector3[0])),r.HOVERLIGHT&&(this._activeEffect.setDirectColor4("hoverColor",this.hoverColor),this._activeEffect.setFloat("hoverRadius",this.hoverRadius),this._activeEffect.setVector3("hoverPosition",this.hoverPosition)),r.TEXTURE&&this._albedoTexture)){this._activeEffect.setTexture("albedoSampler",this._albedoTexture);const e=this._albedoTexture.getTextureMatrix();this._activeEffect.setMatrix("textureMatrix",e)}this._afterBind(t,this._activeEffect,i)}}getActiveTextures(){return super.getActiveTextures()}hasTexture(e){return!!super.hasTexture(e)}dispose(e){super.dispose(e)}clone(e){return Vt.p.Clone((()=>new Ny(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.GUI.FluentMaterial",e}getClassName(){return"FluentMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new Ny(e.name,t)),e,t,i)}}(0,Et.Cg)([(0,Rt.lK)(),(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],Ny.prototype,"innerGlowColorIntensity",void 0),(0,Et.Cg)([(0,Rt.jT)()],Ny.prototype,"innerGlowColor",void 0),(0,Et.Cg)([(0,Rt.jT)()],Ny.prototype,"albedoColor",void 0),(0,Et.Cg)([(0,Rt.lK)(),(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],Ny.prototype,"renderBorders",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ny.prototype,"borderWidth",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ny.prototype,"edgeSmoothingValue",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ny.prototype,"borderMinValue",void 0),(0,Et.Cg)([(0,Rt.lK)(),(0,Rt.$z)("_markAllSubMeshesAsTexturesDirty")],Ny.prototype,"renderHoverLight",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ny.prototype,"hoverRadius",void 0),(0,Et.Cg)([(0,Rt.qK)()],Ny.prototype,"hoverColor",void 0),(0,Et.Cg)([(0,Rt.P_)()],Ny.prototype,"hoverPosition",void 0),(0,Et.Cg)([(0,Rt.uM)("albedoTexture")],Ny.prototype,"_albedoTexture",void 0),(0,Et.Cg)([(0,Rt.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],Ny.prototype,"albedoTexture",void 0),(0,Ft.Y5)("BABYLON.GUI.FluentMaterial",Ny);class ky extends Fy{get backPlateMargin(){return this._backPlateMargin}set backPlateMargin(e){this._backPlateMargin=e,this._children.length>=1&&(this.children.forEach((e=>{this._updateCurrentMinMax(e.position)})),this._updateMargins())}_createNode(e){const t=new zn.e(`menu_${this.name}`,e);return this._backPlate=so("backPlate"+this.name,{size:1},e),this._backPlate.parent=t,t}_affectMaterial(e){this._backPlateMaterial=new Ny(this.name+"backPlateMaterial",e.getScene()),this._backPlateMaterial.albedoColor=new bt.v9(.08,.15,.55),this._backPlateMaterial.renderBorders=!0,this._backPlateMaterial.renderHoverLight=!0,this._pickedPointObserver=this._host.onPickedPointChangedObservable.add((e=>{e?(this._backPlateMaterial.hoverPosition=e,this._backPlateMaterial.hoverColor.a=1):this._backPlateMaterial.hoverColor.a=0})),this._backPlate.material=this._backPlateMaterial}_mapGridNode(e,t){e.mesh&&(e.position=t.clone(),this._updateCurrentMinMax(t))}_finalProcessing(){this._updateMargins()}_updateCurrentMinMax(e){this._currentMin||(this._currentMin=e.clone(),this._currentMax=e.clone()),this._currentMin.minimizeInPlace(e),this._currentMax.maximizeInPlace(e)}_updateMargins(){if(this._children.length>0){this._currentMin.addInPlaceFromFloats(-this._cellWidth/2,-this._cellHeight/2,0),this._currentMax.addInPlaceFromFloats(this._cellWidth/2,this._cellHeight/2,0);const e=this._currentMax.subtract(this._currentMin);this._backPlate.scaling.x=e.x+this._cellWidth*this.backPlateMargin,this._backPlate.scaling.y=e.y+this._cellHeight*this.backPlateMargin,this._backPlate.scaling.z=.001;for(let t=0;t<this._children.length;t++)this._children[t].position.subtractInPlace(this._currentMin).subtractInPlace(e.scale(.5)),this._children[t].position.z-=.01}this._currentMin=null,this._currentMax=null}constructor(e){super(e),this._backPlateMargin=1.25}addButton(e){const t=this.blockLayout;return t||(this.blockLayout=!0),super.addControl(e),e.isBackplateVisible=!1,e.scaling.scaleInPlace(ky.MENU_BUTTON_SCALE),t||(this.blockLayout=!1),this}addControl(e){return It.V.Warn("TouchHolographicMenu can only contain buttons. Please use the method `addButton` instead."),this}dispose(){super.dispose(),this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver)}}var Uy,Vy,Gy;ky.MENU_BUTTON_SCALE=1,function(e){e[e.ABOVE_FINGER_TIPS=0]="ABOVE_FINGER_TIPS",e[e.RADIAL_SIDE=1]="RADIAL_SIDE",e[e.ULNAR_SIDE=2]="ULNAR_SIDE",e[e.BELOW_WRIST=3]="BELOW_WRIST"}(Uy||(Uy={})),function(e){e[e.LOOK_AT_CAMERA=0]="LOOK_AT_CAMERA",e[e.HAND_ROTATION=1]="HAND_ROTATION"}(Vy||(Vy={})),function(e){e[e.ALWAYS_VISIBLE=0]="ALWAYS_VISIBLE",e[e.PALM_UP=1]="PALM_UP",e[e.GAZE_FOCUS=2]="GAZE_FOCUS",e[e.PALM_AND_GAZE=3]="PALM_AND_GAZE"}(Gy||(Gy={}));Ma.l.ShadersStore.fluentBackplatePixelShader="uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform float _Angle_;uniform float _Fade_Out_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform sampler2D _Iridescent_Map_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;void Round_Rect_Fragment_B31(\nfloat Radius,\nfloat Line_Width,\nvec4 Line_Color,\nfloat Filter_Width,\nvec2 UV,\nfloat Line_Visibility,\nvec4 Rect_Parms,\nvec4 Fill_Color,\nout vec4 Color)\n{float d=length(max(abs(UV)-Rect_Parms.xy,0.0));float dx=max(fwidth(d)*Filter_Width,0.00001);float g=min(Rect_Parms.z,Rect_Parms.w);float dgrad=max(fwidth(g)*Filter_Width,0.00001);float Inside_Rect=clamp(g/dgrad,0.0,1.0);float inner=clamp((d+dx*0.5-max(Radius-Line_Width,d-dx*0.5))/dx,0.0,1.0);Color=clamp(mix(Fill_Color,Line_Color,inner),0.0,1.0)*Inside_Rect;}\nvoid Blob_Fragment_B71(\nsampler2D Blob_Texture,\nvec4 Blob_Info1,\nvec4 Blob_Info2,\nout vec4 Blob_Color)\n{float k1=dot(Blob_Info1.xy,Blob_Info1.xy);float k2=dot(Blob_Info2.xy,Blob_Info2.xy);vec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);Blob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);}\nvoid Line_Fragment_B48(\nvec4 Base_Color,\nvec4 Highlight_Color,\nfloat Highlight_Width,\nvec3 Line_Vertex,\nfloat Highlight,\nout vec4 Line_Color)\n{float k2=1.0-clamp(abs(Line_Vertex.y/Highlight_Width),0.0,1.0);Line_Color=mix(Base_Color,Highlight_Color,Highlight*k2);}\nvoid Scale_RGB_B54(\nvec4 Color,\nfloat Scalar,\nout vec4 Result)\n{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}\nvoid Conditional_Float_B38(\nbool Which,\nfloat If_True,\nfloat If_False,\nout float Result)\n{Result=Which ? If_True : If_False;}\nvoid main()\n{float R_Q72;float G_Q72;float B_Q72;float A_Q72;R_Q72=vColor.r; G_Q72=vColor.g; B_Q72=vColor.b; A_Q72=vColor.a;vec4 Blob_Color_Q71;\n#if BLOB_ENABLE\nfloat k1=dot(vExtra2.xy,vExtra2.xy);float k2=dot(vExtra3.xy,vExtra3.xy);vec3 closer=k1<k2 ? vec3(k1,vExtra2.z,vExtra2.w) : vec3(k2,vExtra3.z,vExtra3.w);Blob_Color_Q71=closer.z*texture(_Blob_Texture_,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);\n#else\nBlob_Color_Q71=vec4(0,0,0,0);\n#endif\nvec4 Line_Color_Q48;Line_Fragment_B48(_Line_Color_,_Highlight_Color_,_Highlight_Width_,vTangent,_Highlight_,Line_Color_Q48);float X_Q67;float Y_Q67;X_Q67=vUV.x;Y_Q67=vUV.y;vec3 Incident_Q66=normalize(vPosition-cameraPosition);vec3 Reflected_Q60=reflect(Incident_Q66,vBinormal);float Product_Q63=Y_Q67*_Vertical_Offset_;float Dot_Q68=dot(Incident_Q66, Reflected_Q60);float Dot_Q57=dot(vNormal, Incident_Q66);float Result_Q38;Conditional_Float_B38(_Reflected_,Dot_Q68,Dot_Q57,Result_Q38);float Product_Q64=Result_Q38*_Frequency_;float Sum_Q69=Product_Q64+1.0;float Product_Q70=Sum_Q69*0.5;float Sum_Q62=Product_Q63+Product_Q70;float FractF_Q59=fract(Sum_Q62);vec2 Vec2_Q65=vec2(FractF_Q59,0.5);vec4 Color_Q58;\n#if IRIDESCENT_MAP_ENABLE\nColor_Q58=texture(_Iridescent_Map_,Vec2_Q65);\n#else\nColor_Q58=vec4(0,0,0,0);\n#endif\nvec4 Result_Q54;Scale_RGB_B54(Color_Q58,_Iridescence_Edge_Intensity_,Result_Q54);vec4 Result_Q55;Scale_RGB_B54(Color_Q58,_Iridescence_Intensity_,Result_Q55);vec4 Base_And_Iridescent_Q53;Base_And_Iridescent_Q53=Line_Color_Q48+vec4(Result_Q54.rgb,0.0);vec4 Base_And_Iridescent_Q56;Base_And_Iridescent_Q56=_Base_Color_+vec4(Result_Q55.rgb,0.0);vec4 Result_Q52=Base_And_Iridescent_Q53; Result_Q52.a=1.0;vec4 Result_Q35=Blob_Color_Q71+(1.0-Blob_Color_Q71.a)*Base_And_Iridescent_Q56;vec4 Color_Q31;Round_Rect_Fragment_B31(R_Q72,G_Q72,Result_Q52,_Filter_Width_,vUV,1.0,vExtra1,Result_Q35,Color_Q31);vec4 Result_Q47=_Fade_Out_*Color_Q31;vec4 Out_Color=Result_Q47;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}";Ma.l.ShadersStore.fluentBackplateVertexShader="uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;\n#ifdef TANGENT\nattribute vec3 tangent;\n#else\nconst vec3 tangent=vec3(0.);\n#endif\nuniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform float _Angle_;uniform float _Fade_Out_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform sampler2D _Iridescent_Map_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Object_To_World_Pos_B115(\nvec3 Pos_Object,\nout vec3 Pos_World)\n{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}\nvoid PickDir_B140(\nfloat Degrees,\nvec3 DirX,\nvec3 DirY,\nout vec3 Dir)\n{float a=Degrees*3.14159/180.0;Dir=cos(a)*DirX+sin(a)*DirY;}\nvoid Round_Rect_Vertex_B139(\nvec2 UV,\nfloat Radius,\nfloat Margin,\nfloat Anisotropy,\nfloat Gradient1,\nfloat Gradient2,\nout vec2 Rect_UV,\nout vec4 Rect_Parms,\nout vec2 Scale_XY,\nout vec2 Line_UV)\n{Scale_XY=vec2(Anisotropy,1.0);Line_UV=(UV-vec2(0.5,0.5));Rect_UV=Line_UV*Scale_XY;Rect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius)-vec2(Margin,Margin);Rect_Parms.z=Gradient1; \nRect_Parms.w=Gradient2;}\nvoid Line_Vertex_B135(\nvec2 Scale_XY,\nvec2 UV,\nfloat Time,\nfloat Rate,\nvec4 Highlight_Transform,\nout vec3 Line_Vertex)\n{float angle2=(Rate*Time)*2.0*3.1416;float sinAngle2=sin(angle2);float cosAngle2=cos(angle2);vec2 xformUV=UV*Highlight_Transform.xy+Highlight_Transform.zw;Line_Vertex.x=0.0;Line_Vertex.y=cosAngle2*xformUV.x-sinAngle2*xformUV.y;Line_Vertex.z=0.0; }\nvoid Blob_Vertex_B180(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nvec3 Blob_Position,\nfloat Intensity,\nfloat Blob_Near_Size,\nfloat Blob_Far_Size,\nfloat Blob_Near_Distance,\nfloat Blob_Far_Distance,\nfloat Blob_Fade_Length,\nfloat Blob_Pulse,\nfloat Blob_Fade,\nout vec4 Blob_Info)\n{vec3 blob=Blob_Position;vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}\nvoid Move_Verts_B129(\nfloat Anisotropy,\nvec3 P,\nfloat Radius,\nout vec3 New_P,\nout vec2 New_UV,\nout float Radial_Gradient,\nout vec3 Radial_Dir)\n{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);New_UV=center+r2*(UV-2.0*center+0.5);New_P=vec3(New_UV-0.5,P.z);Radial_Gradient=1.0-length(delta)*2.0;Radial_Dir=vec3(delta*r2,0.0);}\nvoid Object_To_World_Dir_B132(\nvec3 Dir_Object,\nout vec3 Binormal_World,\nout vec3 Binormal_World_N,\nout float Binormal_Length)\n{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}\nvoid RelativeOrAbsoluteDetail_B147(\nfloat Nominal_Radius,\nfloat Nominal_LineWidth,\nbool Absolute_Measurements,\nfloat Height,\nout float Radius,\nout float Line_Width)\n{float scale=Absolute_Measurements ? 1.0/Height : 1.0;Radius=Nominal_Radius*scale;Line_Width=Nominal_LineWidth*scale;}\nvoid Edge_AA_Vertex_B130(\nvec3 Position_World,\nvec3 Position_Object,\nvec3 Normal_Object,\nvec3 Eye,\nfloat Radial_Gradient,\nvec3 Radial_Dir,\nvec3 Tangent,\nout float Gradient1,\nout float Gradient2)\n{vec3 I=(Eye-Position_World);vec3 T=(world* vec4(Tangent,0.0)).xyz;float g=(dot(T,I)<0.0) ? 0.0 : 1.0;if (Normal_Object.z==0.0) { \nGradient1=Position_Object.z>0.0 ? g : 1.0;Gradient2=Position_Object.z>0.0 ? 1.0 : g;} else {Gradient1=g+(1.0-g)*(Radial_Gradient);Gradient2=1.0;}}\nvoid Pick_Radius_B144(\nfloat Radius,\nfloat Radius_Top_Left,\nfloat Radius_Top_Right,\nfloat Radius_Bottom_Left,\nfloat Radius_Bottom_Right,\nvec3 Position,\nout float Result)\n{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}\nvoid main()\n{vec3 Nrm_World_Q128;Nrm_World_Q128=normalize((world*vec4(normal,0.0)).xyz);vec3 Tangent_World_Q131;vec3 Tangent_World_N_Q131;float Tangent_Length_Q131;Tangent_World_Q131=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q131=length(Tangent_World_Q131);Tangent_World_N_Q131=Tangent_World_Q131/Tangent_Length_Q131;vec3 Binormal_World_Q132;vec3 Binormal_World_N_Q132;float Binormal_Length_Q132;Object_To_World_Dir_B132(vec3(0,1,0),Binormal_World_Q132,Binormal_World_N_Q132,Binormal_Length_Q132);float Anisotropy_Q133=Tangent_Length_Q131/Binormal_Length_Q132;vec3 Result_Q177;Result_Q177=mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(_Use_Global_Left_Index_));vec3 Result_Q178;Result_Q178=mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(_Use_Global_Right_Index_));float Result_Q144;Pick_Radius_B144(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q144);vec3 Dir_Q140;PickDir_B140(_Angle_,Tangent_World_N_Q131,Binormal_World_N_Q132,Dir_Q140);float Radius_Q147;float Line_Width_Q147;RelativeOrAbsoluteDetail_B147(Result_Q144,_Line_Width_,_Absolute_Sizes_,Binormal_Length_Q132,Radius_Q147,Line_Width_Q147);vec4 Out_Color_Q145=vec4(Radius_Q147,Line_Width_Q147,0,1);vec3 New_P_Q129;vec2 New_UV_Q129;float Radial_Gradient_Q129;vec3 Radial_Dir_Q129;Move_Verts_B129(Anisotropy_Q133,position,Radius_Q147,New_P_Q129,New_UV_Q129,Radial_Gradient_Q129,Radial_Dir_Q129);vec3 Pos_World_Q115;Object_To_World_Pos_B115(New_P_Q129,Pos_World_Q115);vec4 Blob_Info_Q180;\n#if BLOB_ENABLE\nBlob_Vertex_B180(Pos_World_Q115,Nrm_World_Q128,Tangent_World_N_Q131,Binormal_World_N_Q132,Result_Q177,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q180);\n#else\nBlob_Info_Q180=vec4(0,0,0,0);\n#endif\nvec4 Blob_Info_Q181;\n#if BLOB_ENABLE_2\nBlob_Vertex_B180(Pos_World_Q115,Nrm_World_Q128,Tangent_World_N_Q131,Binormal_World_N_Q132,Result_Q178,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q181);\n#else\nBlob_Info_Q181=vec4(0,0,0,0);\n#endif\nfloat Gradient1_Q130;float Gradient2_Q130;\n#if SMOOTH_EDGES\nEdge_AA_Vertex_B130(Pos_World_Q115,position,normal,cameraPosition,Radial_Gradient_Q129,Radial_Dir_Q129,tangent,Gradient1_Q130,Gradient2_Q130);\n#else\nGradient1_Q130=1.0;Gradient2_Q130=1.0;\n#endif\nvec2 Rect_UV_Q139;vec4 Rect_Parms_Q139;vec2 Scale_XY_Q139;vec2 Line_UV_Q139;Round_Rect_Vertex_B139(New_UV_Q129,Radius_Q147,0.0,Anisotropy_Q133,Gradient1_Q130,Gradient2_Q130,Rect_UV_Q139,Rect_Parms_Q139,Scale_XY_Q139,Line_UV_Q139);vec3 Line_Vertex_Q135;Line_Vertex_B135(Scale_XY_Q139,Line_UV_Q139,0.0,_Rate_,_Highlight_Transform_,Line_Vertex_Q135);vec3 Position=Pos_World_Q115;vec3 Normal=Dir_Q140;vec2 UV=Rect_UV_Q139;vec3 Tangent=Line_Vertex_Q135;vec3 Binormal=Nrm_World_Q128;vec4 Color=Out_Color_Q145;vec4 Extra1=Rect_Parms_Q139;vec4 Extra2=Blob_Info_Q180;vec4 Extra3=Blob_Info_Q181;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}";class zy extends wt.M{constructor(){super(),this.BLOB_ENABLE=!0,this.BLOB_ENABLE_2=!0,this.SMOOTH_EDGES=!0,this.IRIDESCENT_MAP_ENABLE=!0,this._needNormals=!0,this.rebuild()}}class Hy extends Ot.E{constructor(e,t){super(e,t),this.radius=.03,this.lineWidth=.01,this.absoluteSizes=!1,this._filterWidth=1,this.baseColor=new bt.ov(.0392157,.0666667,.207843,1),this.lineColor=new bt.ov(.14902,.133333,.384314,1),this.blobIntensity=.98,this.blobFarSize=.04,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.08,this.blobNearSize=.22,this.blobPulse=0,this.blobFade=0,this.blobNearSize2=.22,this.blobPulse2=0,this.blobFade2=0,this._rate=.135,this.highlightColor=new bt.ov(.98,.98,.98,1),this.highlightWidth=.25,this._highlightTransform=new gt.IU(1,1,0,0),this._highlight=1,this.iridescenceIntensity=0,this.iridescenceEdgeIntensity=1,this._angle=-45,this.fadeOut=1,this._reflected=!0,this._frequency=1,this._verticalOffset=0,this.globalLeftIndexTipPosition=gt.Pq.Zero(),this._globalLeftIndexTipPosition4=gt.IU.Zero(),this.globalRightIndexTipPosition=gt.Pq.Zero(),this._globalRightIndexTipPosition4=gt.IU.Zero(),this.alphaMode=ui.Y.ALPHA_DISABLE,this.backFaceCulling=!1;const i=$i.S0.GetAssetUrl(Hy.BLOB_TEXTURE_URL),s=$i.S0.GetAssetUrl(Hy.IM_TEXTURE_URL);this._blobTexture=new Dt.g(i,this.getScene(),!0,!1,Dt.g.NEAREST_SAMPLINGMODE),this._iridescentMap=new Dt.g(s,this.getScene(),!0,!1,Dt.g.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new zy);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;const n=r.getEngine();if((0,Ut.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const e=new Nt.J;s.FOG&&e.addFallback(1,"FOG"),(0,Ut.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;const i=[Mt.R.PositionKind];s.NORMAL&&i.push(Mt.R.NormalKind),s.UV1&&i.push(Mt.R.UVKind),s.UV2&&i.push(Mt.R.UV2Kind),s.VERTEXCOLOR&&i.push(Mt.R.ColorKind),s.TANGENT&&i.push(Mt.R.TangentKind),(0,Ut.ER)(i,s);const o="fluentBackplate",a=s.toString(),h=["world","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Absolute_Sizes_","_Filter_Width_","_Base_Color_","_Line_Color_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Rate_","_Highlight_Color_","_Highlight_Width_","_Highlight_Transform_","_Highlight_","_Iridescence_Intensity_","_Iridescence_Edge_Intensity_","_Angle_","_Fade_Out_","_Reflected_","_Frequency_","_Vertical_Offset_","_Iridescent_Map_","_Use_Global_Left_Index_","_Use_Global_Right_Index_","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position"],l=["_Blob_Texture_","_Iridescent_Map_"],c=[];(0,Ut.Bb)({uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect(o,{attributes:i,uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),s,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,0))}bindForSubMesh(e,t,i){if(!i.materialDefines)return;const s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera?.position??gt.Pq.ZeroReadOnly),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",this.absoluteSizes?1:0),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Base_Color_",this.baseColor),this._activeEffect.setDirectColor4("_Line_Color_",this.lineColor),this._activeEffect.setFloat("_Radius_Top_Left_",1),this._activeEffect.setFloat("_Radius_Top_Right_",1),this._activeEffect.setFloat("_Radius_Bottom_Left_",1),this._activeEffect.setFloat("_Radius_Bottom_Right_",1),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setFloat("_Rate_",this._rate),this._activeEffect.setDirectColor4("_Highlight_Color_",this.highlightColor),this._activeEffect.setFloat("_Highlight_Width_",this.highlightWidth),this._activeEffect.setVector4("_Highlight_Transform_",this._highlightTransform),this._activeEffect.setFloat("_Highlight_",this._highlight),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setFloat("_Iridescence_Edge_Intensity_",this.iridescenceEdgeIntensity),this._activeEffect.setFloat("_Angle_",this._angle),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._activeEffect.setFloat("_Reflected_",this._reflected?1:0),this._activeEffect.setFloat("_Frequency_",this._frequency),this._activeEffect.setFloat("_Vertical_Offset_",this._verticalOffset),this._activeEffect.setTexture("_Iridescent_Map_",this._iridescentMap),this._activeEffect.setFloat("_Use_Global_Left_Index_",1),this._activeEffect.setFloat("_Use_Global_Right_Index_",1),this._globalLeftIndexTipPosition4.set(this.globalLeftIndexTipPosition.x,this.globalLeftIndexTipPosition.y,this.globalLeftIndexTipPosition.z,1),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this._globalLeftIndexTipPosition4),this._globalRightIndexTipPosition4.set(this.globalRightIndexTipPosition.x,this.globalRightIndexTipPosition.y,this.globalRightIndexTipPosition.z,1),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this._globalRightIndexTipPosition4),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e),this._blobTexture.dispose(),this._iridescentMap.dispose()}clone(e){return Vt.p.Clone((()=>new Hy(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.FluentBackplateMaterial",e}getClassName(){return"FluentBackplateMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new Hy(e.name,t)),e,t,i)}}Hy.BLOB_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/mrtk-fluent-backplate-blob.png",Hy.IM_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/mrtk-fluent-backplate-iridescence.png",(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"radius",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"lineWidth",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"absoluteSizes",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"baseColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"lineColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobFarSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobNearDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobFarDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobFadeLength",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobNearSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobPulse",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobNearSize2",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobPulse2",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"blobFade2",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"highlightColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"highlightWidth",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"iridescenceIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"iridescenceEdgeIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Hy.prototype,"fadeOut",void 0),(0,Et.Cg)([(0,Rt.P_)()],Hy.prototype,"globalLeftIndexTipPosition",void 0),(0,Et.Cg)([(0,Rt.P_)()],Hy.prototype,"globalRightIndexTipPosition",void 0),(0,Ft.Y5)("BABYLON.GUI.FluentBackplateMaterial",Hy);class Wy extends My{set renderingGroupId(e){this._model.renderingGroupId=e}get renderingGroupId(){return this._model.renderingGroupId}get material(){return this._material}get shareMaterials(){return this._shareMaterials}constructor(e,t=!0){super(e),this._shareMaterials=t}_getTypeName(){return"HolographicBackplate"}_createNode(e){const t=so((this.name??"HolographicBackplate")+"_CollisionMesh",{width:1,height:1,depth:1},e);t.isPickable=!0,t.visibility=0;const i=$i.S0.GetAssetUrl(Wy.MODEL_BASE_URL);return Ue.cn.ImportMeshAsync(void 0,i,Wy.MODEL_FILENAME,e).then((e=>{const i=e.meshes[1];i.name=`${this.name}_frontPlate`,i.isPickable=!1,i.parent=t,this._material&&(i.material=this._material),this._model=i})),t}_createMaterial(e){this._material=new Hy(this.name+" Material",e.getScene())}_affectMaterial(e){this._shareMaterials?this._host._touchSharedMaterials.fluentBackplateMaterial?this._material=this._host._touchSharedMaterials.fluentBackplateMaterial:(this._createMaterial(e),this._host._touchSharedMaterials.fluentBackplateMaterial=this._material):this._createMaterial(e)}dispose(){super.dispose(),this.shareMaterials||this._material.dispose(),this._model.dispose()}}Wy.MODEL_BASE_URL="https://assets.babylonjs.com/core/MRTK/",Wy.MODEL_FILENAME="mrtk-fluent-backplate.glb";class Xy{get delay(){return this.fadeInDelay}set delay(e){this.fadeInDelay=e,this.fadeOutDelay=e}constructor(){this.fadeInDelay=0,this.fadeOutDelay=0,this.fadeInTime=300,this.fadeOutTime=300,this._millisecondsPerFrame=1e3/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._delay=0,this._time=300,this._update=()=>{if(this._ownerNode){if(this._hoverValue+=this._hovered?this._millisecondsPerFrame:-this._millisecondsPerFrame,this._setAllVisibility(this._ownerNode,(this._hoverValue-this._delay)/this._time),this._ownerNode.visibility>1){if(this._setAllVisibility(this._ownerNode,1),this._hoverValue>this._time)return this._hoverValue=this._time,void this._detachObserver()}else if(this._ownerNode.visibility<0&&(this._setAllVisibility(this._ownerNode,0),this._hoverValue<0))return this._hoverValue=0,void this._detachObserver();this._attachObserver()}}}get name(){return"FadeInOut"}init(){}attach(e){this._ownerNode=e,this._setAllVisibility(this._ownerNode,0)}detach(){this._ownerNode=null}fadeIn(e=!0){this._delay=e?this.fadeInDelay:this.fadeOutDelay,this._time=e?this.fadeInTime:this.fadeOutTime,this._detachObserver(),this._ownerNode&&(e&&this._ownerNode.visibility>=1||!e&&this._ownerNode.visibility<=0)||(this._hovered=e,this._hovered||(this._delay*=-1),this._ownerNode.visibility>=1?this._hoverValue=this._time:this._ownerNode.visibility<=0&&(this._hoverValue=0),this._update())}fadeOut(){this.fadeIn(!1)}_setAllVisibility(e,t){e.visibility=t,e.getChildMeshes().forEach((e=>{this._setAllVisibility(e,t)}))}_attachObserver(){this._onBeforeRenderObserver||(this._onBeforeRenderObserver=this._ownerNode?.getScene().onBeforeRenderObservable.add(this._update))}_detachObserver(){this._onBeforeRenderObserver&&(this._ownerNode?.getScene().onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=null)}}Ma.l.ShadersStore.fluentButtonPixelShader="uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;uniform float _Edge_Width_;uniform vec4 _Edge_Color_;uniform bool _Relative_Width_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Active_Face_Dir_;uniform vec3 _Active_Face_Up_;uniform bool Enable_Fade;uniform float _Fade_Width_;uniform bool _Smooth_Active_Face_;uniform bool _Show_Frame_;uniform bool _Use_Blob_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;void Holo_Edge_Fragment_B35(\nvec4 Edges,\nfloat Edge_Width,\nout float NotEdge)\n{vec2 c=vec2(min(Edges.r,Edges.g),min(Edges.b,Edges.a));vec2 df=fwidth(c)*Edge_Width;vec2 g=clamp(c/df,0.0,1.0);NotEdge=g.x*g.y;}\nvoid Blob_Fragment_B39(\nvec2 UV,\nvec3 Blob_Info,\nsampler2D Blob_Texture,\nout vec4 Blob_Color)\n{float k=dot(UV,UV);Blob_Color=Blob_Info.y*texture(Blob_Texture,vec2(vec2(sqrt(k),Blob_Info.x).x,1.0-vec2(sqrt(k),Blob_Info.x).y))*(1.0-clamp(k,0.0,1.0));}\nvec2 FilterStep(vec2 Edge,vec2 X)\n{vec2 dX=max(fwidth(X),vec2(0.00001,0.00001));return clamp( (X+dX-max(Edge,X-dX))/(dX*2.0),0.0,1.0);}\nvoid Wireframe_Fragment_B59(\nvec3 Widths,\nvec2 UV,\nfloat Proximity,\nvec4 Edge_Color,\nout vec4 Wireframe)\n{vec2 c=min(UV,vec2(1.0,1.0)-UV);vec2 g=FilterStep(Widths.xy*0.5,c); \nWireframe=(1.0-min(g.x,g.y))*Proximity*Edge_Color;}\nvoid Proximity_B53(\nvec3 Proximity_Center,\nvec3 Proximity_Center_2,\nfloat Proximity_Max_Intensity,\nfloat Proximity_Near_Radius,\nvec3 Position,\nvec3 Show_Selection,\nvec4 Extra1,\nfloat Dist_To_Face,\nfloat Intensity,\nout float Proximity)\n{vec2 delta1=Extra1.xy;vec2 delta2=Extra1.zw;float d2=sqrt(min(dot(delta1,delta1),dot(delta2,delta2))+Dist_To_Face*Dist_To_Face);Proximity=Intensity*Proximity_Max_Intensity*(1.0-clamp(d2/Proximity_Near_Radius,0.0,1.0))*(1.0-Show_Selection.x)+Show_Selection.x;}\nvoid To_XYZ_B46(\nvec3 Vec3,\nout float X,\nout float Y,\nout float Z)\n{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}\nvoid main()\n{float NotEdge_Q35;\n#if ENABLE_FADE\nHolo_Edge_Fragment_B35(vColor,_Fade_Width_,NotEdge_Q35);\n#else\nNotEdge_Q35=1.0;\n#endif\nvec4 Blob_Color_Q39;float k=dot(vUV,vUV);vec2 blobTextureCoord=vec2(vec2(sqrt(k),vTangent.x).x,1.0-vec2(sqrt(k),vTangent.x).y);vec4 blobColor=mix(vec4(1.0,1.0,1.0,1.0)*step(1.0-vTangent.x,clamp(sqrt(k)+0.1,0.0,1.0)),texture(_Blob_Texture_,blobTextureCoord),float(_Use_Blob_Texture_));Blob_Color_Q39=vTangent.y*blobColor*(1.0-clamp(k,0.0,1.0));float Is_Quad_Q24;Is_Quad_Q24=vNormal.z;vec3 Blob_Position_Q41= mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(Use_Global_Left_Index));vec3 Blob_Position_Q42= mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(Use_Global_Right_Index));float X_Q46;float Y_Q46;float Z_Q46;To_XYZ_B46(vBinormal,X_Q46,Y_Q46,Z_Q46);float Proximity_Q53;Proximity_B53(Blob_Position_Q41,Blob_Position_Q42,_Proximity_Max_Intensity_,_Proximity_Near_Radius_,vPosition,vBinormal,vExtra1,Y_Q46,Z_Q46,Proximity_Q53);vec4 Wireframe_Q59;Wireframe_Fragment_B59(vNormal,vUV,Proximity_Q53,_Edge_Color_,Wireframe_Q59);vec4 Wire_Or_Blob_Q23=mix(Wireframe_Q59,Blob_Color_Q39,Is_Quad_Q24);vec4 Result_Q22;Result_Q22=mix(Wire_Or_Blob_Q23,vec4(0.3,0.3,0.3,0.3),float(_Show_Frame_));vec4 Final_Color_Q37=NotEdge_Q35*Result_Q22;vec4 Out_Color=Final_Color_Q37;float Clip_Threshold=0.0;bool To_sRGB=false;gl_FragColor=Out_Color;}";Ma.l.ShadersStore.fluentButtonVertexShader="uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;attribute vec4 color;uniform float _Edge_Width_;uniform vec4 _Edge_Color_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Active_Face_Dir_;uniform vec3 _Active_Face_Up_;uniform bool _Enable_Fade_;uniform float _Fade_Width_;uniform bool _Smooth_Active_Face_;uniform bool _Show_Frame_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;void Blob_Vertex_B47(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nvec3 Blob_Position,\nfloat Intensity,\nfloat Blob_Near_Size,\nfloat Blob_Far_Size,\nfloat Blob_Near_Distance,\nfloat Blob_Far_Distance,\nvec4 Vx_Color,\nvec2 UV,\nvec3 Face_Center,\nvec2 Face_Size,\nvec2 In_UV,\nfloat Blob_Fade_Length,\nfloat Selection_Fade,\nfloat Selection_Fade_Size,\nfloat Inner_Fade,\nvec3 Active_Face_Center,\nfloat Blob_Pulse,\nfloat Blob_Fade,\nfloat Blob_Enabled,\nout vec3 Out_Position,\nout vec2 Out_UV,\nout vec3 Blob_Info)\n{float blobSize,fadeIn;vec3 Hit_Position;Blob_Info=vec3(0.0,0.0,0.0);float Hit_Distance=dot(Blob_Position-Face_Center,Normal);Hit_Position=Blob_Position-Hit_Distance*Normal;float absD=abs(Hit_Distance);float lerpVal=clamp((absD-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);fadeIn=1.0-clamp((absD-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float innerFade=1.0-clamp(-Hit_Distance/Inner_Fade,0.0,1.0);float farClip=clamp(1.0-step(Blob_Far_Distance+Blob_Fade_Length,absD),0.0,1.0);float size=mix(Blob_Near_Size,Blob_Far_Size,lerpVal)*farClip;blobSize=mix(size,Selection_Fade_Size,Selection_Fade)*innerFade*Blob_Enabled;Blob_Info.x=lerpVal*0.5+0.5;Blob_Info.y=fadeIn*Intensity*(1.0-Selection_Fade)*Blob_Fade;Blob_Info.x*=(1.0-Blob_Pulse);vec3 delta=Hit_Position-Face_Center;vec2 blobCenterXY=vec2(dot(delta,Tangent),dot(delta,Bitangent));vec2 quadUVin=2.0*UV-1.0; \nvec2 blobXY=blobCenterXY+quadUVin*blobSize;vec2 blobClipped=clamp(blobXY,-Face_Size*0.5,Face_Size*0.5);vec2 blobUV=(blobClipped-blobCenterXY)/max(blobSize,0.0001)*2.0;vec3 blobCorner=Face_Center+blobClipped.x*Tangent+blobClipped.y*Bitangent;Out_Position=mix(Position,blobCorner,Vx_Color.rrr);Out_UV=mix(In_UV,blobUV,Vx_Color.rr);}\nvec2 ProjectProximity(\nvec3 blobPosition,\nvec3 position,\nvec3 center,\nvec3 dir,\nvec3 xdir,\nvec3 ydir,\nout float vdistance\n)\n{vec3 delta=blobPosition-position;vec2 xy=vec2(dot(delta,xdir),dot(delta,ydir));vdistance=abs(dot(delta,dir));return xy;}\nvoid Proximity_Vertex_B66(\nvec3 Blob_Position,\nvec3 Blob_Position_2,\nvec3 Active_Face_Center,\nvec3 Active_Face_Dir,\nvec3 Position,\nfloat Proximity_Far_Distance,\nfloat Relative_Scale,\nfloat Proximity_Anisotropy,\nvec3 Up,\nout vec4 Extra1,\nout float Distance_To_Face,\nout float Intensity)\n{vec3 Active_Face_Dir_X=normalize(cross(Active_Face_Dir,Up));vec3 Active_Face_Dir_Y=cross(Active_Face_Dir,Active_Face_Dir_X);float distz1,distz2;Extra1.xy=ProjectProximity(Blob_Position,Position,Active_Face_Center,Active_Face_Dir,Active_Face_Dir_X*Proximity_Anisotropy,Active_Face_Dir_Y,distz1)/Relative_Scale;Extra1.zw=ProjectProximity(Blob_Position_2,Position,Active_Face_Center,Active_Face_Dir,Active_Face_Dir_X*Proximity_Anisotropy,Active_Face_Dir_Y,distz2)/Relative_Scale;Distance_To_Face=dot(Active_Face_Dir,Position-Active_Face_Center);Intensity=1.0-clamp(min(distz1,distz2)/Proximity_Far_Distance,0.0,1.0);}\nvoid Holo_Edge_Vertex_B44(\nvec3 Incident,\nvec3 Normal,\nvec2 UV,\nvec3 Tangent,\nvec3 Bitangent,\nbool Smooth_Active_Face,\nfloat Active,\nout vec4 Holo_Edges)\n{float NdotI=dot(Incident,Normal);vec2 flip=(UV-vec2(0.5,0.5));float udot=dot(Incident,Tangent)*flip.x*NdotI;float uval=1.0-float(udot>0.0);float vdot=-dot(Incident,Bitangent)*flip.y*NdotI;float vval=1.0-float(vdot>0.0);float Smooth_And_Active=step(1.0,float(Smooth_Active_Face && Active>0.0));uval=mix(uval,max(1.0,uval),Smooth_And_Active); \nvval=mix(vval,max(1.0,vval),Smooth_And_Active);Holo_Edges=vec4(1.0,1.0,1.0,1.0)-vec4(uval*UV.x,uval*(1.0-UV.x),vval*UV.y,vval*(1.0-UV.y));}\nvoid Object_To_World_Pos_B13(\nvec3 Pos_Object,\nout vec3 Pos_World)\n{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}\nvoid Choose_Blob_B38(\nvec4 Vx_Color,\nvec3 Position1,\nvec3 Position2,\nbool Blob_Enable_1,\nbool Blob_Enable_2,\nfloat Near_Size_1,\nfloat Near_Size_2,\nfloat Blob_Inner_Fade_1,\nfloat Blob_Inner_Fade_2,\nfloat Blob_Pulse_1,\nfloat Blob_Pulse_2,\nfloat Blob_Fade_1,\nfloat Blob_Fade_2,\nout vec3 Position,\nout float Near_Size,\nout float Inner_Fade,\nout float Blob_Enable,\nout float Fade,\nout float Pulse)\n{Position=Position1*(1.0-Vx_Color.g)+Vx_Color.g*Position2;float b1=float(Blob_Enable_1);float b2=float(Blob_Enable_2);Blob_Enable=b1+(b2-b1)*Vx_Color.g;Pulse=Blob_Pulse_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Pulse_2;Fade=Blob_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Fade_2;Near_Size=Near_Size_1*(1.0-Vx_Color.g)+Vx_Color.g*Near_Size_2;Inner_Fade=Blob_Inner_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Inner_Fade_2;}\nvoid Wireframe_Vertex_B51(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nfloat Edge_Width,\nvec2 Face_Size,\nout vec3 Wire_Vx_Pos,\nout vec2 UV,\nout vec2 Widths)\n{Widths.xy=Edge_Width/Face_Size;float x=dot(Position,Tangent);float y=dot(Position,Bitangent);float dx=0.5-abs(x);float newx=(0.5-dx*Widths.x*2.0)*sign(x);float dy=0.5-abs(y);float newy=(0.5-dy*Widths.y*2.0)*sign(y);Wire_Vx_Pos=Normal*0.5+newx*Tangent+newy*Bitangent;UV.x=dot(Wire_Vx_Pos,Tangent)+0.5;UV.y=dot(Wire_Vx_Pos,Bitangent)+0.5;}\nvec2 ramp2(vec2 start,vec2 end,vec2 x)\n{return clamp((x-start)/(end-start),vec2(0.0,0.0),vec2(1.0,1.0));}\nfloat computeSelection(\nvec3 blobPosition,\nvec3 normal,\nvec3 tangent,\nvec3 bitangent,\nvec3 faceCenter,\nvec2 faceSize,\nfloat selectionFuzz,\nfloat farDistance,\nfloat fadeLength\n)\n{vec3 delta=blobPosition-faceCenter;float absD=abs(dot(delta,normal));float fadeIn=1.0-clamp((absD-farDistance)/fadeLength,0.0,1.0);vec2 blobCenterXY=vec2(dot(delta,tangent),dot(delta,bitangent));vec2 innerFace=faceSize*(1.0-selectionFuzz)*0.5;vec2 selectPulse=ramp2(-faceSize*0.5,-innerFace,blobCenterXY)-ramp2(innerFace,faceSize*0.5,blobCenterXY);return selectPulse.x*selectPulse.y*fadeIn;}\nvoid Selection_Vertex_B48(\nvec3 Blob_Position,\nvec3 Blob_Position_2,\nvec3 Face_Center,\nvec2 Face_Size,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nfloat Selection_Fuzz,\nfloat Selected,\nfloat Far_Distance,\nfloat Fade_Length,\nvec3 Active_Face_Dir,\nout float Show_Selection)\n{float select1=computeSelection(Blob_Position,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);float select2=computeSelection(Blob_Position_2,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);float Active=max(0.0,dot(Active_Face_Dir,Normal));Show_Selection=mix(max(select1,select2),1.0,Selected)*Active;}\nvoid Proximity_Visibility_B54(\nfloat Selection,\nvec3 Proximity_Center,\nvec3 Proximity_Center_2,\nfloat Input_Width,\nfloat Proximity_Far_Distance,\nfloat Proximity_Radius,\nvec3 Active_Face_Center,\nvec3 Active_Face_Dir,\nout float Width)\n{vec3 boxEdges=(world*vec4(vec3(0.5,0.5,0.5),0.0)).xyz;float boxMaxSize=length(boxEdges);float d1=dot(Proximity_Center-Active_Face_Center,Active_Face_Dir);vec3 blob1=Proximity_Center-d1*Active_Face_Dir;float d2=dot(Proximity_Center_2-Active_Face_Center,Active_Face_Dir);vec3 blob2=Proximity_Center_2-d2*Active_Face_Dir;vec3 delta1=blob1-Active_Face_Center;vec3 delta2=blob2-Active_Face_Center;float dist1=dot(delta1,delta1);float dist2=dot(delta2,delta2);float nearestProxDist=sqrt(min(dist1,dist2));Width=Input_Width*(1.0-step(boxMaxSize+Proximity_Radius,nearestProxDist))*(1.0-step(Proximity_Far_Distance,min(d1,d2))*(1.0-step(0.0001,Selection)));}\nvoid Object_To_World_Dir_B67(\nvec3 Dir_Object,\nout vec3 Dir_World)\n{Dir_World=(world*vec4(Dir_Object,0.0)).xyz;}\nvoid main()\n{vec3 Active_Face_Center_Q49;Active_Face_Center_Q49=(world*vec4(_Active_Face_Dir_*0.5,1.0)).xyz;vec3 Blob_Position_Q41= mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(Use_Global_Left_Index));vec3 Blob_Position_Q42= mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(Use_Global_Right_Index));vec3 Active_Face_Dir_Q64=normalize((world*vec4(_Active_Face_Dir_,0.0)).xyz);float Relative_Scale_Q57;\n#if RELATIVE_WIDTH\nRelative_Scale_Q57=length((world*vec4(vec3(0,1,0),0.0)).xyz);\n#else\nRelative_Scale_Q57=1.0;\n#endif\nvec3 Tangent_World_Q30;Tangent_World_Q30=(world*vec4(tangent,0.0)).xyz;vec3 Binormal_World_Q31;Binormal_World_Q31=(world*vec4((cross(normal,tangent)),0.0)).xyz;vec3 Normal_World_Q60;Normal_World_Q60=(world*vec4(normal,0.0)).xyz;vec3 Result_Q18=0.5*normal;vec3 Dir_World_Q67;Object_To_World_Dir_B67(_Active_Face_Up_,Dir_World_Q67);float Product_Q56=_Edge_Width_*Relative_Scale_Q57;vec3 Normal_World_N_Q29=normalize(Normal_World_Q60);vec3 Tangent_World_N_Q28=normalize(Tangent_World_Q30);vec3 Binormal_World_N_Q32=normalize(Binormal_World_Q31);vec3 Position_Q38;float Near_Size_Q38;float Inner_Fade_Q38;float Blob_Enable_Q38;float Fade_Q38;float Pulse_Q38;Choose_Blob_B38(color,Blob_Position_Q41,Blob_Position_Q42,_Blob_Enable_,_Blob_Enable_2_,_Blob_Near_Size_,_Blob_Near_Size_2_,_Blob_Inner_Fade_,_Blob_Inner_Fade_2_,_Blob_Pulse_,_Blob_Pulse_2_,_Blob_Fade_,_Blob_Fade_2_,Position_Q38,Near_Size_Q38,Inner_Fade_Q38,Blob_Enable_Q38,Fade_Q38,Pulse_Q38);vec3 Face_Center_Q33;Face_Center_Q33=(world*vec4(Result_Q18,1.0)).xyz;vec2 Face_Size_Q50=vec2(length(Tangent_World_Q30),length(Binormal_World_Q31));float Show_Selection_Q48;Selection_Vertex_B48(Blob_Position_Q41,Blob_Position_Q42,Face_Center_Q33,Face_Size_Q50,Normal_World_N_Q29,Tangent_World_N_Q28,Binormal_World_N_Q32,_Selection_Fuzz_,_Selected_,_Selected_Distance_,_Selected_Fade_Length_,Active_Face_Dir_Q64,Show_Selection_Q48);vec3 Normalized_Q72=normalize(Dir_World_Q67);float Active_Q34=max(0.0,dot(Active_Face_Dir_Q64,Normal_World_N_Q29));float Width_Q54;Proximity_Visibility_B54(Show_Selection_Q48,Blob_Position_Q41,Blob_Position_Q42,Product_Q56,_Proximity_Far_Distance_,_Proximity_Near_Radius_,Active_Face_Center_Q49,Active_Face_Dir_Q64,Width_Q54);vec3 Wire_Vx_Pos_Q51;vec2 UV_Q51;vec2 Widths_Q51;Wireframe_Vertex_B51(position,normal,tangent,(cross(normal,tangent)),Width_Q54,Face_Size_Q50,Wire_Vx_Pos_Q51,UV_Q51,Widths_Q51);vec3 Vec3_Q27=vec3(Widths_Q51.x,Widths_Q51.y,color.r);vec3 Pos_World_Q13;Object_To_World_Pos_B13(Wire_Vx_Pos_Q51,Pos_World_Q13);vec3 Incident_Q36=normalize(Pos_World_Q13-cameraPosition);vec3 Out_Position_Q47;vec2 Out_UV_Q47;vec3 Blob_Info_Q47;Blob_Vertex_B47(Pos_World_Q13,Normal_World_N_Q29,Tangent_World_N_Q28,Binormal_World_N_Q32,Position_Q38,_Blob_Intensity_,Near_Size_Q38,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,color,uv,Face_Center_Q33,Face_Size_Q50,UV_Q51,_Blob_Fade_Length_,_Selection_Fade_,_Selection_Fade_Size_,Inner_Fade_Q38,Active_Face_Center_Q49,Pulse_Q38,Fade_Q38,Blob_Enable_Q38,Out_Position_Q47,Out_UV_Q47,Blob_Info_Q47);vec4 Extra1_Q66;float Distance_To_Face_Q66;float Intensity_Q66;Proximity_Vertex_B66(Blob_Position_Q41,Blob_Position_Q42,Active_Face_Center_Q49,Active_Face_Dir_Q64,Pos_World_Q13,_Proximity_Far_Distance_,Relative_Scale_Q57,_Proximity_Anisotropy_,Normalized_Q72,Extra1_Q66,Distance_To_Face_Q66,Intensity_Q66);vec4 Holo_Edges_Q44;Holo_Edge_Vertex_B44(Incident_Q36,Normal_World_N_Q29,uv,Tangent_World_Q30,Binormal_World_Q31,_Smooth_Active_Face_,Active_Q34,Holo_Edges_Q44);vec3 Vec3_Q19=vec3(Show_Selection_Q48,Distance_To_Face_Q66,Intensity_Q66);vec3 Position=Out_Position_Q47;vec2 UV=Out_UV_Q47;vec3 Tangent=Blob_Info_Q47;vec3 Binormal=Vec3_Q19;vec3 Normal=Vec3_Q27;vec4 Extra1=Extra1_Q66;vec4 Color=Holo_Edges_Q44;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;}";class qy extends wt.M{constructor(){super(),this.RELATIVE_WIDTH=!0,this.ENABLE_FADE=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class Qy extends Ot.E{constructor(e,t){super(e,t),this.edgeWidth=.04,this.edgeColor=new bt.ov(.592157,.592157,.592157,1),this.proximityMaxIntensity=.45,this.proximityFarDistance=.16,this.proximityNearRadius=1.5,this.proximityAnisotropy=1,this.selectionFuzz=.5,this.selected=0,this.selectionFade=0,this.selectionFadeSize=.3,this.selectedDistance=.08,this.selectedFadeLength=.08,this.blobIntensity=.5,this.blobFarSize=.05,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.08,this.leftBlobEnable=!0,this.leftBlobNearSize=.025,this.leftBlobPulse=0,this.leftBlobFade=1,this.leftBlobInnerFade=.01,this.rightBlobEnable=!0,this.rightBlobNearSize=.025,this.rightBlobPulse=0,this.rightBlobFade=1,this.rightBlobInnerFade=.01,this.activeFaceDir=new gt.Pq(0,0,-1),this.activeFaceUp=new gt.Pq(0,1,0),this.enableFade=!0,this.fadeWidth=1.5,this.smoothActiveFace=!0,this.showFrame=!1,this.useBlobTexture=!0,this.globalLeftIndexTipPosition=gt.Pq.Zero(),this.globalRightIndexTipPosition=gt.Pq.Zero(),this.alphaMode=ui.Y.ALPHA_ADD,this.disableDepthWrite=!0,this.backFaceCulling=!1;const i=$i.S0.GetAssetUrl(Qy.BLOB_TEXTURE_URL);this._blobTexture=new Dt.g(i,this.getScene(),!0,!1,Dt.g.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!0}needAlphaTesting(){return!0}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new qy);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;const n=r.getEngine();if((0,Ut.qB)(e,s,!0,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const e=new Nt.J;s.FOG&&e.addFallback(1,"FOG"),(0,Ut.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;const i=[Mt.R.PositionKind];s.NORMAL&&i.push(Mt.R.NormalKind),s.UV1&&i.push(Mt.R.UVKind),s.UV2&&i.push(Mt.R.UV2Kind),s.VERTEXCOLOR&&i.push(Mt.R.ColorKind),s.TANGENT&&i.push(Mt.R.TangentKind),(0,Ut.ER)(i,s);const o="fluentButton",a=s.toString(),h=["world","viewProjection","cameraPosition","_Edge_Width_","_Edge_Color_","_Relative_Width_","_Proximity_Max_Intensity_","_Proximity_Far_Distance_","_Proximity_Near_Radius_","_Proximity_Anisotropy_","_Selection_Fuzz_","_Selected_","_Selection_Fade_","_Selection_Fade_Size_","_Selected_Distance_","_Selected_Fade_Length_","_Blob_Enable_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Inner_Fade_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Enable_2_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Inner_Fade_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Active_Face_Dir_","_Active_Face_Up_","_Enable_Fade_","_Fade_Width_","_Smooth_Active_Face_","_Show_Frame_","_Use_Blob_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],l=["_Blob_Texture_"],c=[];(0,Ut.Bb)({uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect(o,{attributes:i,uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),s,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,0))}bindForSubMesh(e,t,i){const s=this.getScene();if(!i.materialDefines)return;const r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",s.activeCamera.position),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Edge_Width_",this.edgeWidth),this._activeEffect.setColor4("_Edge_Color_",new bt.v9(this.edgeColor.r,this.edgeColor.g,this.edgeColor.b),this.edgeColor.a),this._activeEffect.setFloat("_Proximity_Max_Intensity_",this.proximityMaxIntensity),this._activeEffect.setFloat("_Proximity_Far_Distance_",this.proximityFarDistance),this._activeEffect.setFloat("_Proximity_Near_Radius_",this.proximityNearRadius),this._activeEffect.setFloat("_Proximity_Anisotropy_",this.proximityAnisotropy),this._activeEffect.setFloat("_Selection_Fuzz_",this.selectionFuzz),this._activeEffect.setFloat("_Selected_",this.selected),this._activeEffect.setFloat("_Selection_Fade_",this.selectionFade),this._activeEffect.setFloat("_Selection_Fade_Size_",this.selectionFadeSize),this._activeEffect.setFloat("_Selected_Distance_",this.selectedDistance),this._activeEffect.setFloat("_Selected_Fade_Length_",this.selectedFadeLength),this._activeEffect.setFloat("_Blob_Enable_",this.leftBlobEnable?1:0),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.leftBlobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Inner_Fade_",this.leftBlobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_",this.leftBlobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.leftBlobFade),this._activeEffect.setFloat("_Blob_Enable_2_",this.rightBlobEnable?1:0),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.rightBlobNearSize),this._activeEffect.setFloat("_Blob_Inner_Fade_2_",this.rightBlobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_2_",this.rightBlobPulse),this._activeEffect.setFloat("_Blob_Fade_2_",this.rightBlobFade),this._activeEffect.setVector3("_Active_Face_Dir_",this.activeFaceDir),this._activeEffect.setVector3("_Active_Face_Up_",this.activeFaceUp),this._activeEffect.setFloat("_Fade_Width_",this.fadeWidth),this._activeEffect.setFloat("_Smooth_Active_Face_",this.smoothActiveFace?1:0),this._activeEffect.setFloat("_Show_Frame_",this.showFrame?1:0),this._activeEffect.setFloat("_Use_Blob_Texture_",this.useBlobTexture?1:0),this._activeEffect.setFloat("Use_Global_Left_Index",1),this._activeEffect.setFloat("Use_Global_Right_Index",1),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",new gt.IU(this.globalLeftIndexTipPosition.x,this.globalLeftIndexTipPosition.y,this.globalLeftIndexTipPosition.z,1)),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",new gt.IU(this.globalRightIndexTipPosition.x,this.globalRightIndexTipPosition.y,this.globalRightIndexTipPosition.z,1)),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return Vt.p.Clone((()=>new Qy(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.FluentButtonMaterial",e}getClassName(){return"FluentButtonMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new Qy(e.name,t)),e,t,i)}}Qy.BLOB_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/mrtk-fluent-button-blob.png",(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"edgeWidth",void 0),(0,Et.Cg)([(0,Rt.qK)()],Qy.prototype,"edgeColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"proximityMaxIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"proximityFarDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"proximityNearRadius",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"proximityAnisotropy",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"selectionFuzz",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"selected",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"selectionFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"selectionFadeSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"selectedDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"selectedFadeLength",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"blobIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"blobFarSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"blobNearDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"blobFarDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"blobFadeLength",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"leftBlobEnable",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"leftBlobNearSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"leftBlobPulse",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"leftBlobFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"leftBlobInnerFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"rightBlobEnable",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"rightBlobNearSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"rightBlobPulse",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"rightBlobFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"rightBlobInnerFade",void 0),(0,Et.Cg)([(0,Rt.P_)()],Qy.prototype,"activeFaceDir",void 0),(0,Et.Cg)([(0,Rt.P_)()],Qy.prototype,"activeFaceUp",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"enableFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"fadeWidth",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"smoothActiveFace",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"showFrame",void 0),(0,Et.Cg)([(0,Rt.lK)()],Qy.prototype,"useBlobTexture",void 0),(0,Et.Cg)([(0,Rt.P_)()],Qy.prototype,"globalLeftIndexTipPosition",void 0),(0,Et.Cg)([(0,Rt.P_)()],Qy.prototype,"globalRightIndexTipPosition",void 0),(0,Ft.Y5)("BABYLON.GUI.FluentButtonMaterial",Qy);class Ky extends By{constructor(e,t){super(e),this._isNearPressed=!1,this._interactionSurfaceHeight=0,this._isToggleButton=!1,this._toggleState=!1,this._toggleButtonCallback=()=>{this._onToggle(!this._toggleState)},this.onToggleObservable=new Zi.cP,this.collidableFrontDirection=gt.Pq.Zero(),t&&(this.collisionMesh=t)}get isActiveNearInteraction(){return this._isNearPressed}set collidableFrontDirection(e){if(this._collidableFrontDirection=e.normalize(),this._collisionMesh){const e=gt.AA.Matrix[0];e.copyFrom(this._collisionMesh.getWorldMatrix()),e.invert(),gt.Pq.TransformNormalToRef(this._collidableFrontDirection,e,this._collidableFrontDirection),this._collidableFrontDirection.normalize()}}get collidableFrontDirection(){if(this._collisionMesh){const e=gt.AA.Vector3[0];return gt.Pq.TransformNormalToRef(this._collidableFrontDirection,this._collisionMesh.getWorldMatrix(),e),e.normalize()}return this._collidableFrontDirection}set collisionMesh(e){this._collisionMesh&&(this._collisionMesh.isNearPickable=!1,this._collisionMesh.reservedDataStore?.GUI3D&&(this._collisionMesh.reservedDataStore.GUI3D={}),this._collisionMesh.getChildMeshes().forEach((e=>{e.isNearPickable=!1,e.reservedDataStore?.GUI3D&&(e.reservedDataStore.GUI3D={})}))),this._collisionMesh=e,this._injectGUI3DReservedDataStore(this._collisionMesh).control=this,this._collisionMesh.isNearPickable=!0,this._collisionMesh.getChildMeshes().forEach((e=>{this._injectGUI3DReservedDataStore(e).control=this,e.isNearPickable=!0})),this.collidableFrontDirection=e.forward}set isToggleButton(e){e!==this._isToggleButton&&(this._isToggleButton=e,e?this.onPointerUpObservable.add(this._toggleButtonCallback):(this.onPointerUpObservable.removeCallback(this._toggleButtonCallback),this._toggleState&&this._onToggle(!1)))}get isToggleButton(){return this._isToggleButton}set isToggled(e){this._isToggleButton&&this._toggleState!==e&&this._onToggle(e)}get isToggled(){return this._toggleState}_onToggle(e){this._toggleState=e,this.onToggleObservable.notifyObservers(e)}_isInteractionInFrontOfButton(e){return this._getInteractionHeight(e,this._collisionMesh.getAbsolutePosition())>0}getPressDepth(e){if(!this._isNearPressed)return 0;const t=this._getInteractionHeight(e,this._collisionMesh.getAbsolutePosition());return this._interactionSurfaceHeight-t}_getInteractionHeight(e,t){const i=this.collidableFrontDirection;if(0===i.length())return gt.Pq.Distance(e,t);const s=gt.Pq.Dot(t,i);return gt.Pq.Dot(e,i)-s}_generatePointerEventType(e,t,i){if(e===tt.Zp.POINTERDOWN||e===tt.Zp.POINTERMOVE){if(!this._isInteractionInFrontOfButton(t))return tt.Zp.POINTERMOVE;this._isNearPressed=!0,this._interactionSurfaceHeight=this._getInteractionHeight(t,this._collisionMesh.getAbsolutePosition())}if(e===tt.Zp.POINTERUP){if(0==i)return tt.Zp.POINTERMOVE;this._isNearPressed=!1}return e}_getTypeName(){return"TouchButton3D"}_createNode(e){return super._createNode(e)}dispose(){super.dispose(),this.onPointerUpObservable.removeCallback(this._toggleButtonCallback),this.onToggleObservable.clear(),this._collisionMesh&&this._collisionMesh.dispose()}}var Yy,jy,Zy=o(2746);class $y extends Ky{_disposeTooltip(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)}set renderingGroupId(e){this._backPlate.renderingGroupId=e,this._textPlate.renderingGroupId=e,this._frontPlate.renderingGroupId=e,this._tooltipMesh&&(this._tooltipMesh.renderingGroupId=e)}get renderingGroupId(){return this._backPlate.renderingGroupId}get mesh(){return this._backPlate}set tooltipText(e){if(e){if(!this._tooltipFade){const e=this._backPlate._scene.useRightHandedSystem;this._tooltipMesh=ko("",{size:1},this._backPlate._scene);const t=ko("",{size:1,sideOrientation:zn.e.DOUBLESIDE},this._backPlate._scene),i=new ft.F("",this._backPlate._scene);i.diffuseColor=bt.v9.FromHexString("#212121"),t.material=i,t.isPickable=!1,this._tooltipMesh.addChild(t),t.position=gt.Pq.Forward(e).scale(.05),this._tooltipMesh.scaling.y=1/3,this._tooltipMesh.position=gt.Pq.Up().scale(.7).add(gt.Pq.Forward(e).scale(-.15)),this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._backPlate,this._tooltipTexture=Ms.CreateForMesh(this._tooltipMesh),this._tooltipTextBlock=new lr,this._tooltipTextBlock.scaleY=3,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=130,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new Xy,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add((()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!0)})),this._tooltipOutObserver=this.onPointerOutObservable.add((()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!1)}))}this._tooltipTextBlock&&(this._tooltipTextBlock.text=e)}else this._disposeTooltip()}get tooltipText(){return this._tooltipTextBlock?this._tooltipTextBlock.text:null}get text(){return this._text}set text(e){this._text!==e&&(this._text=e,this._rebuildContent())}get imageUrl(){return this._imageUrl}set imageUrl(e){this._imageUrl!==e&&(this._imageUrl=e,this._rebuildContent())}get backMaterial(){return this._backMaterial}get frontMaterial(){return this._frontMaterial}get plateMaterial(){return this._plateMaterial}get shareMaterials(){return this._shareMaterials}set isBackplateVisible(e){this.mesh&&this._backMaterial&&(e&&!this._isBackplateVisible?this._backPlate.visibility=1:!e&&this._isBackplateVisible&&(this._backPlate.visibility=0)),this._isBackplateVisible=e}constructor(e,t=!0){super(e),this._shareMaterials=!0,this._isBackplateVisible=!0,this._frontPlateDepth=.5,this._backPlateDepth=.04,this._backplateColor=new bt.v9(.08,.15,.55),this._backplateToggledColor=new bt.v9(.25,.4,.95),this._shareMaterials=t,this.pointerEnterAnimation=()=>{this._frontMaterial.leftBlobEnable=!0,this._frontMaterial.rightBlobEnable=!0},this.pointerOutAnimation=()=>{this._frontMaterial.leftBlobEnable=!1,this._frontMaterial.rightBlobEnable=!1},this.pointerDownAnimation=()=>{this._frontPlate&&!this.isActiveNearInteraction&&(this._frontPlate.scaling.z=.2*this._frontPlateDepth,this._frontPlate.position=gt.Pq.Forward(this._frontPlate._scene.useRightHandedSystem).scale((this._frontPlateDepth-.2*this._frontPlateDepth)/2),this._textPlate.position=gt.Pq.Forward(this._textPlate._scene.useRightHandedSystem).scale(-(this._backPlateDepth+.2*this._frontPlateDepth)/2))},this.pointerUpAnimation=()=>{this._frontPlate&&(this._frontPlate.scaling.z=this._frontPlateDepth,this._frontPlate.position=gt.Pq.Forward(this._frontPlate._scene.useRightHandedSystem).scale((this._frontPlateDepth-this._frontPlateDepth)/2),this._textPlate.position=gt.Pq.Forward(this._textPlate._scene.useRightHandedSystem).scale(-(this._backPlateDepth+this._frontPlateDepth)/2))},this.onPointerMoveObservable.add((e=>{if(this._frontPlate&&this.isActiveNearInteraction){const t=gt.Pq.Zero();if(this._backPlate.getWorldMatrix().decompose(t,void 0,void 0)){let i=this._getInteractionHeight(e,this._backPlate.getAbsolutePosition())/t.z;i=Zy.X.Clamp(i-this._backPlateDepth/2,.2*this._frontPlateDepth,this._frontPlateDepth),this._frontPlate.scaling.z=i,this._frontPlate.position=gt.Pq.Forward(this._frontPlate._scene.useRightHandedSystem).scale((this._frontPlateDepth-i)/2),this._textPlate.position=gt.Pq.Forward(this._textPlate._scene.useRightHandedSystem).scale(-(this._backPlateDepth+i)/2)}}})),this._pointerHoverObserver=this.onPointerMoveObservable.add((e=>{this._frontMaterial.globalLeftIndexTipPosition=e}))}_getTypeName(){return"TouchHolographicButton"}_rebuildContent(){this._disposeFacadeTexture();const e=new ey;if(e.isVertical=!0,(0,Fh.Nf)()&&document.createElement&&this._imageUrl){const t=new hr;t.source=this._imageUrl,t.paddingTop="40px",t.height="180px",t.width="100px",t.paddingBottom="40px",e.addControl(t)}if(this._text){const t=new lr;t.text=this._text,t.color="white",t.height="30px",t.fontSize=24,e.addControl(t)}this.content=e}_createNode(e){this.name=this.name??"TouchHolographicButton";const t=so(`${this.name}_collisionMesh`,{width:1,height:1,depth:this._frontPlateDepth},e);t.isPickable=!0,t.isNearPickable=!0,t.visibility=0,t.position=gt.Pq.Forward(e.useRightHandedSystem).scale(-this._frontPlateDepth/2);const i=$i.S0.GetAssetUrl($y.MODEL_BASE_URL);Ue.cn.ImportMeshAsync(void 0,i,$y.MODEL_FILENAME,e).then((i=>{const s=so("${this.name}_alphaMesh",{width:1,height:1,depth:1},e);s.isPickable=!1,s.material=new ft.F("${this.name}_alphaMesh_material",e),s.material.alpha=.15;const r=i.meshes[1];r.name=`${this.name}_frontPlate`,r.isPickable=!1,r.scaling.z=this._frontPlateDepth,s.parent=r,r.parent=t,this._frontMaterial&&(r.material=this._frontMaterial),this._frontPlate=r})),this._backPlate=so(`${this.name}_backPlate`,{width:1,height:1,depth:this._backPlateDepth},e),this._backPlate.position=gt.Pq.Forward(e.useRightHandedSystem).scale(this._backPlateDepth/2),this._backPlate.isPickable=!1,this._textPlate=super._createNode(e),this._textPlate.name=`${this.name}_textPlate`,this._textPlate.isPickable=!1,this._textPlate.position=gt.Pq.Forward(e.useRightHandedSystem).scale(-this._frontPlateDepth/2),this._backPlate.addChild(t),this._backPlate.addChild(this._textPlate);const s=new Gn.V("{this.name}_root",e);return this._backPlate.setParent(s),this.collisionMesh=t,this.collidableFrontDirection=this._backPlate.forward.negate(),s}_applyFacade(e){this._plateMaterial.emissiveTexture=e,this._plateMaterial.opacityTexture=e,this._plateMaterial.diffuseColor=new bt.v9(.4,.4,.4)}_createBackMaterial(e){this._backMaterial=new Ny(this.name+"backPlateMaterial",e.getScene()),this._backMaterial.albedoColor=this._backplateColor,this._backMaterial.renderBorders=!0,this._backMaterial.renderHoverLight=!1}_createFrontMaterial(e){this._frontMaterial=new Qy(this.name+"Front Material",e.getScene())}_createPlateMaterial(e){this._plateMaterial=new ft.F(this.name+"Plate Material",e.getScene()),this._plateMaterial.specularColor=bt.v9.Black()}_onToggle(e){this._backMaterial&&(this._backMaterial.albedoColor=e?this._backplateToggledColor:this._backplateColor),super._onToggle(e)}_affectMaterial(e){this._shareMaterials?(this._host._touchSharedMaterials.backFluentMaterial?this._backMaterial=this._host._touchSharedMaterials.backFluentMaterial:(this._createBackMaterial(e),this._host._touchSharedMaterials.backFluentMaterial=this._backMaterial),this._host._touchSharedMaterials.frontFluentMaterial?this._frontMaterial=this._host._touchSharedMaterials.frontFluentMaterial:(this._createFrontMaterial(e),this._host._touchSharedMaterials.frontFluentMaterial=this._frontMaterial)):(this._createBackMaterial(e),this._createFrontMaterial(e)),this._createPlateMaterial(e),this._backPlate.material=this._backMaterial,this._textPlate.material=this._plateMaterial,this._isBackplateVisible||(this._backPlate.visibility=0),this._frontPlate&&(this._frontPlate.material=this._frontMaterial),this._rebuildContent()}dispose(){super.dispose(),this._disposeTooltip(),this.onPointerMoveObservable.remove(this._pointerHoverObserver),this.shareMaterials||(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))}}$y.MODEL_BASE_URL="https://assets.babylonjs.com/core/MRTK/",$y.MODEL_FILENAME="mrtk-fluent-button.glb";class Jy{constructor(){this._tmpQuaternion=new gt.PT,this._tmpVectors=[new gt.Pq,new gt.Pq,new gt.Pq,new gt.Pq,new gt.Pq,new gt.Pq,new gt.Pq],this._tmpMatrix=new gt.uq,this._tmpInvertView=new gt.uq,this._tmpForward=new gt.Pq,this._tmpNodeForward=new gt.Pq,this._tmpPosition=new gt.Pq,this._workingPosition=new gt.Pq,this._workingQuaternion=new gt.PT,this._lastTick=-1,this._recenterNextUpdate=!0,this.interpolatePose=!0,this.lerpTime=500,this.ignoreCameraPitchAndRoll=!1,this.pitchOffset=15,this.maxViewVerticalDegrees=30,this.maxViewHorizontalDegrees=30,this.orientToCameraDeadzoneDegrees=60,this.ignoreDistanceClamp=!1,this.ignoreAngleClamp=!1,this.verticalMaxDistance=0,this.defaultDistance=.8,this.maximumDistance=2,this.minimumDistance=.3,this.useFixedVerticalOffset=!1,this.fixedVerticalOffset=0,this._enabled=!0}get followedCamera(){return this._followedCamera||this._scene.activeCamera}set followedCamera(e){this._followedCamera=e}get name(){return"Follow"}init(){}attach(e,t){this._scene=e.getScene(),this.attachedNode=e,t&&(this.followedCamera=t),this._addObservables()}detach(){this.attachedNode=null,this._removeObservables()}recenter(){this._recenterNextUpdate=!0}_angleBetweenVectorAndPlane(e,t){return this._tmpVectors[0].copyFrom(e),e=this._tmpVectors[0],this._tmpVectors[1].copyFrom(t),t=this._tmpVectors[1],e.normalize(),t.normalize(),Math.PI/2-Math.acos(gt.Pq.Dot(e,t))}_length2D(e){return Math.sqrt(e.x*e.x+e.z*e.z)}_distanceClamp(e,t=!1){let i=this.minimumDistance,s=this.maximumDistance;const r=this.defaultDistance,n=this._tmpVectors[0];n.copyFrom(e);let o=n.length();if(n.normalizeFromLength(o),this.ignoreCameraPitchAndRoll){i=this._length2D(n)*i,s=this._length2D(n)*s;const t=this._length2D(e);n.scaleInPlace(o/t),o=t}let a=o;return a=t?r:(0,Wo.Clamp)(o,i,s),e.copyFrom(n).scaleInPlace(a),o!==a}_applyVerticalClamp(e){0!==this.verticalMaxDistance&&(e.y=(0,Wo.Clamp)(e.y,-this.verticalMaxDistance,this.verticalMaxDistance))}_toOrientationQuatToRef(e,t){gt.PT.RotationYawPitchRollToRef(Math.atan2(e.x,e.z),Math.atan2(e.y,Math.sqrt(e.z*e.z+e.x*e.x)),0,t)}_applyPitchOffset(e){const t=this._tmpVectors[0],i=this._tmpVectors[1];t.copyFromFloats(0,0,this._scene.useRightHandedSystem?-1:1),i.copyFromFloats(1,0,0),gt.Pq.TransformNormalToRef(t,e,t),t.y=0,t.normalize(),gt.Pq.TransformNormalToRef(i,e,i),gt.PT.RotationAxisToRef(i,this.pitchOffset*Math.PI/180,this._tmpQuaternion),t.rotateByQuaternionToRef(this._tmpQuaternion,t),this._toOrientationQuatToRef(t,this._tmpQuaternion),this._tmpQuaternion.toRotationMatrix(this._tmpMatrix),e.copyFrom(this._tmpMatrix)}_angularClamp(e,t){const i=this._tmpVectors[5];i.copyFromFloats(0,0,this._scene.useRightHandedSystem?-1:1);const s=this._tmpVectors[6];s.copyFromFloats(1,0,0),gt.Pq.TransformNormalToRef(i,e,i),gt.Pq.TransformNormalToRef(s,e,s);const r=gt.Pq.UpReadOnly;if(t.length()<bs.bH)return!1;let n=!1;const o=this._tmpQuaternion;if(this.ignoreCameraPitchAndRoll){const e=gt.Pq.GetAngleBetweenVectorsOnPlane(t,i,s);gt.PT.RotationAxisToRef(s,e,o),t.rotateByQuaternionToRef(o,t)}else{const e=-gt.Pq.GetAngleBetweenVectorsOnPlane(t,i,s),r=this.maxViewVerticalDegrees*Math.PI/180*.5;e<-r?(gt.PT.RotationAxisToRef(s,-e-r,o),t.rotateByQuaternionToRef(o,t),n=!0):e>r&&(gt.PT.RotationAxisToRef(s,-e+r,o),t.rotateByQuaternionToRef(o,t),n=!0)}const a=this._angleBetweenVectorAndPlane(t,s)*(this._scene.useRightHandedSystem?-1:1),h=this.maxViewHorizontalDegrees*Math.PI/180*.5;return a<-h?(gt.PT.RotationAxisToRef(r,-a-h,o),t.rotateByQuaternionToRef(o,t),n=!0):a>h&&(gt.PT.RotationAxisToRef(r,-a+h,o),t.rotateByQuaternionToRef(o,t),n=!0),n}_orientationClamp(e,t){const i=this._tmpVectors[0];i.copyFrom(e).scaleInPlace(-1).normalize();const s=this._tmpVectors[1],r=this._tmpVectors[2];s.copyFromFloats(0,1,0),gt.Pq.CrossToRef(i,s,r);const n=r.length();n<bs.bH||(r.normalizeFromLength(n),gt.Pq.CrossToRef(r,i,s),this.attachedNode?.getScene().useRightHandedSystem?gt.PT.FromLookDirectionRHToRef(i,s,t):gt.PT.FromLookDirectionLHToRef(i,s,t))}_passedOrientationDeadzone(e,t){const i=this._tmpVectors[5];return i.copyFrom(e),i.normalize(),180*Math.abs(gt.Pq.GetAngleBetweenVectorsOnPlane(t,i,gt.Pq.UpReadOnly))/Math.PI>this.orientToCameraDeadzoneDegrees}_updateLeashing(e){if(this.attachedNode&&this._enabled){const t=this.attachedNode.parent;this.attachedNode.setParent(null);const i=this.attachedNode.getWorldMatrix(),s=this._workingPosition,r=this._workingQuaternion,n=this.attachedNode.getPivotPoint(),o=this._tmpInvertView;o.copyFrom(e.getViewMatrix()),o.invert(),gt.Pq.TransformCoordinatesToRef(n,i,s);const a=this._tmpPosition;a.copyFromFloats(0,0,0),gt.Pq.TransformCoordinatesToRef(a,i,a),a.scaleInPlace(-1).subtractInPlace(n),s.subtractInPlace(e.globalPosition),this.ignoreCameraPitchAndRoll&&this._applyPitchOffset(o);let h=!1;const l=this._tmpForward;l.copyFromFloats(0,0,this._scene.useRightHandedSystem?-1:1),gt.Pq.TransformNormalToRef(l,o,l);const c=this._tmpNodeForward;if(c.copyFromFloats(0,0,this._scene.useRightHandedSystem?-1:1),gt.Pq.TransformNormalToRef(c,i,c),this._recenterNextUpdate)s.copyFrom(l).scaleInPlace(this.defaultDistance);else if(this.ignoreAngleClamp){const e=s.length();s.copyFrom(l).scaleInPlace(e)}else h=this._angularClamp(o,s);let u=!1;this.ignoreDistanceClamp||(u=this._distanceClamp(s,h),this._applyVerticalClamp(s)),this.useFixedVerticalOffset&&(s.y=a.y-e.globalPosition.y+this.fixedVerticalOffset),(h||u||this._passedOrientationDeadzone(s,c)||this._recenterNextUpdate)&&this._orientationClamp(s,r),this._workingPosition.subtractInPlace(n),this._recenterNextUpdate=!1,this.attachedNode.setParent(t)}}_updateTransformToGoal(e){if(!this.attachedNode||!this.followedCamera||!this._enabled)return;this.attachedNode.rotationQuaternion||(this.attachedNode.rotationQuaternion=gt.PT.Identity());const t=this.attachedNode.parent;if(this.attachedNode.setParent(null),!this.interpolatePose)return this.attachedNode.position.copyFrom(this.followedCamera.globalPosition).addInPlace(this._workingPosition),void this.attachedNode.rotationQuaternion.copyFrom(this._workingQuaternion);const i=new gt.Pq;i.copyFrom(this.attachedNode.position).subtractInPlace(this.followedCamera.globalPosition),gt.Pq.SmoothToRef(i,this._workingPosition,e,this.lerpTime,i),i.addInPlace(this.followedCamera.globalPosition),this.attachedNode.position.copyFrom(i);const s=new gt.PT;s.copyFrom(this.attachedNode.rotationQuaternion),gt.PT.SmoothToRef(s,this._workingQuaternion,e,this.lerpTime,this.attachedNode.rotationQuaternion),this.attachedNode.setParent(t)}_addObservables(){this._lastTick=Date.now(),this._onBeforeRender=this._scene.onBeforeRenderObservable.add((()=>{if(!this.followedCamera)return;const e=Date.now();this._updateLeashing(this.followedCamera),this._updateTransformToGoal(e-this._lastTick),this._lastTick=e}))}_removeObservables(){this._onBeforeRender&&this._scene.onBeforeRenderObservable.remove(this._onBeforeRender)}}class ex{constructor(){this._attachedToElement=!1,this._virtualMeshesInfo={},this._tmpVector=new gt.Pq,this._tmpQuaternion=new gt.PT,this._dragType={NONE:0,DRAG:1,DRAG_WITH_CONTROLLER:2,NEAR_DRAG:3},this._moving=!1,this._dragging=this._dragType.NONE,this.draggableMeshes=null,this.zDragFactor=3,this.currentDraggingPointerIds=[],this.detachCameraControls=!0,this.onDragStartObservable=new Zi.cP,this.onDragObservable=new Zi.cP,this.onDragEndObservable=new Zi.cP,this.allowMultiPointer=!0}get currentDraggingPointerId(){return void 0!==this.currentDraggingPointerIds[0]?this.currentDraggingPointerIds[0]:-1}set currentDraggingPointerId(e){this.currentDraggingPointerIds[0]=e}get currentDraggingPointerID(){return this.currentDraggingPointerId}set currentDraggingPointerID(e){this.currentDraggingPointerId=e}get name(){return"BaseSixDofDrag"}get isMoving(){return this._moving}init(){}get _pointerCamera(){return this._scene.cameraToUseForPointers?this._scene.cameraToUseForPointers:this._scene.activeCamera}_createVirtualMeshInfo(){const e=new Gn.V("",ex._virtualScene);e.rotationQuaternion=new gt.PT;const t=new Gn.V("",ex._virtualScene);t.rotationQuaternion=new gt.PT;const i=new Gn.V("",ex._virtualScene);return i.rotationQuaternion=new gt.PT,{dragging:!1,moving:!1,dragMesh:e,originMesh:t,pivotMesh:i,startingPivotPosition:new gt.Pq,startingPivotOrientation:new gt.PT,startingPosition:new gt.Pq,startingOrientation:new gt.PT,lastOriginPosition:new gt.Pq,lastDragPosition:new gt.Pq}}_resetVirtualMeshesPosition(){for(let e=0;e<this.currentDraggingPointerIds.length;e++)this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.position.copyFrom(this._ownerNode.getAbsolutePivotPoint()),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.rotationQuaternion.copyFrom(this._ownerNode.rotationQuaternion),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingPivotPosition.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.position),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingPivotOrientation.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.rotationQuaternion),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingPosition.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].dragMesh.position),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingOrientation.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].dragMesh.rotationQuaternion)}_pointerUpdate2D(e,t,i){!this._pointerCamera||this._pointerCamera.cameraRigMode!=Ra.i.RIG_MODE_NONE||this._pointerCamera._isLeftCamera||this._pointerCamera._isRightCamera||(e.origin.copyFrom(this._pointerCamera.globalPosition),i=0);const s=this._virtualMeshesInfo[t],r=gt.AA.Vector3[11];e.origin.subtractToRef(s.lastOriginPosition,r),s.lastOriginPosition.copyFrom(e.origin);const n=-gt.Pq.Dot(r,e.direction);s.originMesh.addChild(s.dragMesh),s.originMesh.addChild(s.pivotMesh),this._applyZOffset(s.dragMesh,n,i),this._applyZOffset(s.pivotMesh,n,i),s.originMesh.position.copyFrom(e.origin);const o=gt.AA.Vector3[10];e.origin.addToRef(e.direction,o),s.originMesh.lookAt(o),s.originMesh.removeChild(s.dragMesh),s.originMesh.removeChild(s.pivotMesh)}_pointerUpdateXR(e,t,i,s){const r=this._virtualMeshesInfo[i];if(r.originMesh.position.copyFrom(e.position),this._dragging===this._dragType.NEAR_DRAG&&t?r.originMesh.rotationQuaternion.copyFrom(t.rotationQuaternion):r.originMesh.rotationQuaternion.copyFrom(e.rotationQuaternion),r.pivotMesh.computeWorldMatrix(!0),r.dragMesh.computeWorldMatrix(!0),0!==s){const e=gt.AA.Vector3[10],t=gt.AA.Vector3[11];e.copyFrom(this._pointerCamera.getForwardRay().direction),r.originMesh.position.subtractToRef(r.lastOriginPosition,t),r.lastOriginPosition.copyFrom(r.originMesh.position);const i=t.length();t.normalize();const n=gt.AA.Vector3[12],o=gt.AA.Vector3[9];r.dragMesh.absolutePosition.subtractToRef(this._pointerCamera.globalPosition,n),r.dragMesh.absolutePosition.subtractToRef(r.originMesh.position,o);const a=o.length();n.normalize(),o.normalize();let h=Math.abs(gt.Pq.Dot(t,o))*gt.Pq.Dot(t,e)*s*i*a;const l=.01;h<0&&l-a>h&&(h=Math.min(l-a,0)),o.scaleInPlace(h),o.addToRef(r.pivotMesh.absolutePosition,this._tmpVector),r.pivotMesh.setAbsolutePosition(this._tmpVector),o.addToRef(r.dragMesh.absolutePosition,this._tmpVector),r.dragMesh.setAbsolutePosition(this._tmpVector)}}attach(e){this._ownerNode=e,this._scene=this._ownerNode.getScene(),ex._virtualScene||(ex._virtualScene=new Ie.Z(this._scene.getEngine(),{virtual:!0}),ex._virtualScene.detachControl());const t=e=>this._ownerNode===e||e.isDescendantOf(this._ownerNode)&&(!this.draggableMeshes||-1!==this.draggableMeshes.indexOf(e));this._pointerObserver=this._scene.onPointerObservable.add((e=>{const i=e.event.pointerId;this._virtualMeshesInfo[i]||(this._virtualMeshesInfo[i]=this._createVirtualMeshInfo());const s=this._virtualMeshesInfo[i],r="xr-near"===e.event.pointerType||"xr"===e.event.pointerType,n="xr-near"===e.event.pointerType;if(e.type==tt.Zp.POINTERDOWN){if(!s.dragging&&e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh&&e.pickInfo.pickedPoint&&e.pickInfo.ray&&(!n||e.pickInfo.aimTransform)&&t(e.pickInfo.pickedMesh)){if((!this.allowMultiPointer||r)&&this.currentDraggingPointerIds.length>0)return;!this._pointerCamera||this._pointerCamera.cameraRigMode!==Ra.i.RIG_MODE_NONE||this._pointerCamera._isLeftCamera||this._pointerCamera._isRightCamera||e.pickInfo.ray.origin.copyFrom(this._pointerCamera.globalPosition),this._ownerNode.computeWorldMatrix(!0);const t=this._virtualMeshesInfo[i];r?(this._dragging=e.pickInfo.originMesh?this._dragType.NEAR_DRAG:this._dragType.DRAG_WITH_CONTROLLER,t.originMesh.position.copyFrom(e.pickInfo.aimTransform.position),this._dragging===this._dragType.NEAR_DRAG&&e.pickInfo.gripTransform?t.originMesh.rotationQuaternion.copyFrom(e.pickInfo.gripTransform.rotationQuaternion):t.originMesh.rotationQuaternion.copyFrom(e.pickInfo.aimTransform.rotationQuaternion)):(this._dragging=this._dragType.DRAG,t.originMesh.position.copyFrom(e.pickInfo.ray.origin)),t.lastOriginPosition.copyFrom(t.originMesh.position),t.dragMesh.position.copyFrom(e.pickInfo.pickedPoint),t.lastDragPosition.copyFrom(e.pickInfo.pickedPoint),t.pivotMesh.position.copyFrom(this._ownerNode.getAbsolutePivotPoint()),t.pivotMesh.rotationQuaternion.copyFrom(this._ownerNode.absoluteRotationQuaternion),t.startingPosition.copyFrom(t.dragMesh.position),t.startingPivotPosition.copyFrom(t.pivotMesh.position),t.startingOrientation.copyFrom(t.dragMesh.rotationQuaternion),t.startingPivotOrientation.copyFrom(t.pivotMesh.rotationQuaternion),n?(t.originMesh.addChild(t.dragMesh),t.originMesh.addChild(t.pivotMesh)):t.originMesh.lookAt(t.dragMesh.position),t.dragging=!0,-1===this.currentDraggingPointerIds.indexOf(i)&&this.currentDraggingPointerIds.push(i),this.detachCameraControls&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._pointerCamera.inputs&&this._pointerCamera.inputs.attachedToElement?(this._pointerCamera.detachControl(),this._attachedToElement=!0):this.allowMultiPointer&&0!==this.currentDraggingPointerIds.length||(this._attachedToElement=!1)),this._targetDragStart(t.pivotMesh.position,t.pivotMesh.rotationQuaternion,i),this.onDragStartObservable.notifyObservers({position:t.pivotMesh.position})}}else if(e.type==tt.Zp.POINTERUP||e.type==tt.Zp.POINTERDOUBLETAP){const e=this.currentDraggingPointerIds.indexOf(i);s.dragging=!1,-1!==e&&(this.currentDraggingPointerIds.splice(e,1),0===this.currentDraggingPointerIds.length&&(this._moving=!1,this._dragging=this._dragType.NONE,this.detachCameraControls&&this._attachedToElement&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._reattachCameraControls(),this._attachedToElement=!1)),s.originMesh.removeChild(s.dragMesh),s.originMesh.removeChild(s.pivotMesh),this._targetDragEnd(i),this.onDragEndObservable.notifyObservers({}))}else if(e.type==tt.Zp.POINTERMOVE&&-1!==this.currentDraggingPointerIds.indexOf(i)&&s.dragging&&e.pickInfo&&(e.pickInfo.ray||e.pickInfo.aimTransform)){let t=this.zDragFactor;(this.currentDraggingPointerIds.length>1||e.pickInfo.originMesh)&&(t=0),this._ownerNode.computeWorldMatrix(!0),n?this._pointerUpdateXR(e.pickInfo.aimTransform,e.pickInfo.gripTransform,i,t):this._pointerUpdate2D(e.pickInfo.ray,i,t),this._tmpQuaternion.copyFrom(s.startingPivotOrientation),this._tmpQuaternion.x=-this._tmpQuaternion.x,this._tmpQuaternion.y=-this._tmpQuaternion.y,this._tmpQuaternion.z=-this._tmpQuaternion.z,s.pivotMesh.absoluteRotationQuaternion.multiplyToRef(this._tmpQuaternion,this._tmpQuaternion),s.pivotMesh.absolutePosition.subtractToRef(s.startingPivotPosition,this._tmpVector),this.onDragObservable.notifyObservers({delta:this._tmpVector,position:s.pivotMesh.position,pickInfo:e.pickInfo}),this._targetDrag(this._tmpVector,this._tmpQuaternion,i),s.lastDragPosition.copyFrom(s.dragMesh.absolutePosition),this._moving=!0}}))}_applyZOffset(e,t,i){e.position.z-=e.position.z<1?t*i:t*i*e.position.z,e.position.z<0&&(e.position.z=0)}_targetDragStart(e,t,i){}_targetDrag(e,t,i){}_targetDragEnd(e){}_reattachCameraControls(){if(this._pointerCamera)if("ArcRotateCamera"===this._pointerCamera.getClassName()){const e=this._pointerCamera;e.attachControl(!e.inputs||e.inputs.noPreventDefault,e._useCtrlForPanning,e._panningMouseButton)}else this._pointerCamera.attachControl(!this._pointerCamera.inputs||this._pointerCamera.inputs.noPreventDefault)}detach(){this._scene&&(this.detachCameraControls&&this._attachedToElement&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._reattachCameraControls(),this._attachedToElement=!1),this._scene.onPointerObservable.remove(this._pointerObserver));for(const e in this._virtualMeshesInfo)this._virtualMeshesInfo[e].originMesh.dispose(),this._virtualMeshesInfo[e].dragMesh.dispose();this.onDragEndObservable.clear(),this.onDragObservable.clear(),this.onDragStartObservable.clear()}}class tx extends ex{constructor(){super(...arguments),this._sceneRenderObserver=null,this._targetPosition=new gt.Pq(0,0,0),this._targetOrientation=new gt.PT,this._targetScaling=new gt.Pq(1,1,1),this._startingPosition=new gt.Pq(0,0,0),this._startingOrientation=new gt.PT,this._startingScaling=new gt.Pq(1,1,1),this.onPositionChangedObservable=new Zi.cP,this.dragDeltaRatio=.2,this.rotateDraggedObject=!0,this.rotateAroundYOnly=!1,this.rotateWithMotionController=!0,this.disableMovement=!1,this.faceCameraOnDragStart=!1}get name(){return"SixDofDrag"}attach(e){super.attach(e),e.isNearGrabbable=!0,e.getChildMeshes().forEach((e=>{e.isNearGrabbable=!0})),this._virtualTransformNode=new Gn.V("virtual_sixDof",ex._virtualScene),this._virtualTransformNode.rotationQuaternion=gt.PT.Identity(),this._sceneRenderObserver=e.getScene().onBeforeRenderObservable.add((()=>{if(1===this.currentDraggingPointerIds.length&&this._moving&&!this.disableMovement){const t=gt.AA.Vector3[0];t.copyFrom(this._targetPosition).subtractInPlace(e.absolutePosition).scaleInPlace(this.dragDeltaRatio);const i=gt.AA.Vector3[1];if(i.copyFrom(t),e.parent){const s=gt.AA.Matrix[0];e.parent.absoluteRotationQuaternion.toRotationMatrix(s),s.invert(),gt.Pq.TransformNormalToRef(t,s,i)}if(e.position.addInPlace(i),this.onPositionChangedObservable.notifyObservers({position:e.absolutePosition}),!e.parent||e.parent.scaling&&!e.parent.scaling.isNonUniformWithinEpsilon(.001)){const t=gt.AA.Quaternion[0];if(t.copyFrom(this._targetOrientation),e.parent){const i=gt.AA.Quaternion[0];i.copyFrom(e.parent.absoluteRotationQuaternion),i.invertInPlace(),i.multiplyToRef(this._targetOrientation,t)}gt.PT.SlerpToRef(e.rotationQuaternion,t,this.dragDeltaRatio,e.rotationQuaternion)}}}))}_getPositionOffsetAround(e,t,i){const s=gt.AA.Matrix[0],r=gt.AA.Matrix[1],n=gt.AA.Matrix[2],o=gt.AA.Matrix[3],a=gt.AA.Matrix[4];return gt.uq.TranslationToRef(e.x,e.y,e.z,s),gt.uq.TranslationToRef(-e.x,-e.y,-e.z,r),gt.uq.FromQuaternionToRef(i,n),gt.uq.ScalingToRef(t,t,t,o),r.multiplyToRef(n,a),a.multiplyToRef(o,a),a.multiplyToRef(s,a),a.getTranslation()}_onePointerPositionUpdated(e,t){gt.AA.Vector3[0].setAll(0),this._dragging===this._dragType.DRAG?this.rotateDraggedObject&&(this.rotateAroundYOnly?gt.PT.RotationYawPitchRollToRef(t.toEulerAngles().y,0,0,gt.AA.Quaternion[0]):gt.AA.Quaternion[0].copyFrom(t),gt.AA.Quaternion[0].multiplyToRef(this._startingOrientation,this._targetOrientation)):(this._dragging===this._dragType.NEAR_DRAG||this._dragging===this._dragType.DRAG_WITH_CONTROLLER&&this.rotateWithMotionController)&&t.multiplyToRef(this._startingOrientation,this._targetOrientation),this._targetPosition.copyFrom(this._startingPosition).addInPlace(e)}_twoPointersPositionUpdated(){const e=this._virtualMeshesInfo[this.currentDraggingPointerIds[0]].startingPosition,t=this._virtualMeshesInfo[this.currentDraggingPointerIds[1]].startingPosition,i=gt.AA.Vector3[0];e.addToRef(t,i),i.scaleInPlace(.5);const s=gt.AA.Vector3[1];t.subtractToRef(e,s);const r=this._virtualMeshesInfo[this.currentDraggingPointerIds[0]].dragMesh.absolutePosition,n=this._virtualMeshesInfo[this.currentDraggingPointerIds[1]].dragMesh.absolutePosition,o=gt.AA.Vector3[2];r.addToRef(n,o),o.scaleInPlace(.5);const a=gt.AA.Vector3[3];n.subtractToRef(r,a);const h=a.length()/s.length(),l=o.subtract(i),c=gt.PT.FromEulerAngles(0,gt.Pq.GetAngleBetweenVectorsOnPlane(s.normalize(),a.normalize(),gt.Pq.UpReadOnly),0),u=this._ownerNode.parent;this._ownerNode.setParent(null);const d=this._getPositionOffsetAround(i.subtract(this._virtualTransformNode.getAbsolutePivotPoint()),h,c);this._virtualTransformNode.rotationQuaternion.multiplyToRef(c,this._ownerNode.rotationQuaternion),this._virtualTransformNode.scaling.scaleToRef(h,this._ownerNode.scaling),this._virtualTransformNode.position.addToRef(l.addInPlace(d),this._ownerNode.position),this.onPositionChangedObservable.notifyObservers({position:this._ownerNode.position}),this._ownerNode.setParent(u)}_targetDragStart(){const e=this.currentDraggingPointerIds.length;this._ownerNode.rotationQuaternion||(this._ownerNode.rotationQuaternion=gt.PT.RotationYawPitchRoll(this._ownerNode.rotation.y,this._ownerNode.rotation.x,this._ownerNode.rotation.z));const t=this._ownerNode.getAbsolutePivotPoint();if(1===e){if(this._targetPosition.copyFrom(this._ownerNode.absolutePosition),this._targetOrientation.copyFrom(this._ownerNode.rotationQuaternion),this._targetScaling.copyFrom(this._ownerNode.absoluteScaling),this.faceCameraOnDragStart&&this._scene.activeCamera){const e=gt.AA.Vector3[0];this._scene.activeCamera.position.subtractToRef(t,e),e.normalize();const i=gt.AA.Quaternion[0];this._scene.useRightHandedSystem?gt.PT.FromLookDirectionRHToRef(e,new gt.Pq(0,1,0),i):gt.PT.FromLookDirectionLHToRef(e,new gt.Pq(0,1,0),i),i.normalize(),gt.PT.RotationYawPitchRollToRef(i.toEulerAngles().y,0,0,gt.AA.Quaternion[0]),this._targetOrientation.copyFrom(gt.AA.Quaternion[0])}this._startingPosition.copyFrom(this._targetPosition),this._startingOrientation.copyFrom(this._targetOrientation),this._startingScaling.copyFrom(this._targetScaling)}else 2===e&&(this._virtualTransformNode.setPivotPoint(new gt.Pq(0,0,0),0),this._virtualTransformNode.position.copyFrom(this._ownerNode.absolutePosition),this._virtualTransformNode.scaling.copyFrom(this._ownerNode.absoluteScaling),this._virtualTransformNode.rotationQuaternion.copyFrom(this._ownerNode.absoluteRotationQuaternion),this._virtualTransformNode.setPivotPoint(t,1),this._resetVirtualMeshesPosition())}_targetDrag(e,t){1===this.currentDraggingPointerIds.length?this._onePointerPositionUpdated(e,t):2===this.currentDraggingPointerIds.length&&this._twoPointersPositionUpdated()}_targetDragEnd(){if(1===this.currentDraggingPointerIds.length){this._resetVirtualMeshesPosition();const e=this.faceCameraOnDragStart;this.faceCameraOnDragStart=!1,this._targetDragStart(),this.faceCameraOnDragStart=e}}detach(){super.detach(),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualTransformNode&&this._virtualTransformNode.dispose()}}class ix{constructor(){this._attachPointLocalOffset=new gt.Pq,this._workingPosition=new gt.Pq,this._workingQuaternion=new gt.PT,this._lastTick=-1,this._hit=!1,this.hitNormalOffset=.05,this.meshes=[],this.interpolatePose=!0,this.lerpTime=250,this.keepOrientationVertical=!0,this.enabled=!0,this.maxStickingDistance=.8}get name(){return"SurfaceMagnetism"}init(){}attach(e,t){this._attachedMesh=e,this._scene=t||e.getScene(),this._attachedMesh.rotationQuaternion||(this._attachedMesh.rotationQuaternion=gt.PT.RotationYawPitchRoll(this._attachedMesh.rotation.y,this._attachedMesh.rotation.x,this._attachedMesh.rotation.z)),this.updateAttachPoint(),this._workingPosition.copyFrom(this._attachedMesh.position),this._workingQuaternion.copyFrom(this._attachedMesh.rotationQuaternion),this._addObservables()}detach(){this._attachedMesh=null,this._removeObservables()}_getTargetPose(e){if(!this._attachedMesh)return null;if(e&&e.hit){const t=e.getNormal(!0,!0),i=e.pickedPoint;if(!t||!i)return null;t.normalize();const s=gt.AA.Vector3[0];return s.copyFrom(t),s.scaleInPlace(this.hitNormalOffset),s.addInPlace(i),this._attachedMesh.parent&&(gt.AA.Matrix[0].copyFrom(this._attachedMesh.parent.getWorldMatrix()).invert(),gt.Pq.TransformNormalToRef(s,gt.AA.Matrix[0],s)),{position:s,quaternion:gt.PT.RotationYawPitchRoll(-Math.atan2(t.x,-t.z),this.keepOrientationVertical?0:Math.atan2(t.y,Math.sqrt(t.z*t.z+t.x*t.x)),0)}}return null}updateAttachPoint(){this._getAttachPointOffsetToRef(this._attachPointLocalOffset)}findAndUpdateTarget(e){if(this._hit=!1,!e.ray)return!1;const t=e.ray.intersectsMeshes(this.meshes)[0];if(this._attachedMesh&&t&&t.hit&&t.pickedMesh){const e=this._getTargetPose(t);e&&gt.Pq.Distance(this._attachedMesh.position,e.position)<this.maxStickingDistance&&(this._workingPosition.copyFrom(e.position),this._workingQuaternion.copyFrom(e.quaternion),this._hit=!0)}return this._hit}_getAttachPointOffsetToRef(e){if(!this._attachedMesh)return void e.setAll(0);const t=gt.AA.Quaternion[0];t.copyFrom(this._attachedMesh.rotationQuaternion),this._attachedMesh.rotationQuaternion.copyFromFloats(0,0,0,1),this._attachedMesh.computeWorldMatrix();const i=this._attachedMesh.getHierarchyBoundingVectors(),s=gt.AA.Vector3[0];i.max.addToRef(i.min,s),s.scaleInPlace(.5),s.z=i.max.z;const r=gt.AA.Matrix[0];this._attachedMesh.getWorldMatrix().invertToRef(r),gt.Pq.TransformCoordinatesToRef(s,r,e),this._attachedMesh.rotationQuaternion.copyFrom(t)}_updateTransformToGoal(e){if(!this._attachedMesh||!this._hit)return;const t=this._attachedMesh.parent;this._attachedMesh.setParent(null);const i=gt.AA.Vector3[0];if(gt.Pq.TransformNormalToRef(this._attachPointLocalOffset,this._attachedMesh.getWorldMatrix(),i),!this.interpolatePose)return this._attachedMesh.position.copyFrom(this._workingPosition).subtractInPlace(i),void this._attachedMesh.rotationQuaternion.copyFrom(this._workingQuaternion);const s=new gt.Pq;gt.Pq.SmoothToRef(this._attachedMesh.position,this._workingPosition,e,this.lerpTime,s),this._attachedMesh.position.copyFrom(s);const r=new gt.PT;r.copyFrom(this._attachedMesh.rotationQuaternion),gt.PT.SmoothToRef(r,this._workingQuaternion,e,this.lerpTime,this._attachedMesh.rotationQuaternion),this._attachedMesh.setParent(t)}_addObservables(){this._pointerObserver=this._scene.onPointerObservable.add((e=>{this.enabled&&e.type==tt.Zp.POINTERMOVE&&e.pickInfo&&this.findAndUpdateTarget(e.pickInfo)})),this._lastTick=Date.now(),this._onBeforeRender=this._scene.onBeforeRenderObservable.add((()=>{const e=Date.now();this._updateTransformToGoal(e-this._lastTick),this._lastTick=e}))}_removeObservables(){this._scene.onPointerObservable.remove(this._pointerObserver),this._scene.onBeforeRenderObservable.remove(this._onBeforeRender),this._pointerObserver=null,this._onBeforeRender=null}}class sx{constructor(){this.followBehaviorEnabled=!1,this.sixDofDragBehaviorEnabled=!0,this.surfaceMagnetismBehaviorEnabled=!0,this._followBehavior=new Jy,this._sixDofDragBehavior=new tx,this._surfaceMagnetismBehavior=new ix}get name(){return"Default"}get followBehavior(){return this._followBehavior}get sixDofDragBehavior(){return this._sixDofDragBehavior}get surfaceMagnetismBehavior(){return this._surfaceMagnetismBehavior}init(){}attach(e,t,i){this._scene=e.getScene(),this.attachedNode=e,this._addObservables(),this._followBehavior.attach(e),this._sixDofDragBehavior.attach(e),this._sixDofDragBehavior.draggableMeshes=t||null,this._sixDofDragBehavior.faceCameraOnDragStart=!0,this._surfaceMagnetismBehavior.attach(e,this._scene),i&&(this._surfaceMagnetismBehavior.meshes=i),this._surfaceMagnetismBehavior.enabled=!1}detach(){this.attachedNode=null,this._removeObservables(),this._followBehavior.detach(),this._sixDofDragBehavior.detach(),this._surfaceMagnetismBehavior.detach()}_addObservables(){this._onBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{this._followBehavior._enabled=!this._sixDofDragBehavior.isMoving&&this.followBehaviorEnabled})),this._onDragObserver=this._sixDofDragBehavior.onDragObservable.add((e=>{this._sixDofDragBehavior.disableMovement=this._surfaceMagnetismBehavior.findAndUpdateTarget(e.pickInfo)}))}_removeObservables(){this._scene.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._sixDofDragBehavior.onDragObservable.remove(this._onDragObserver)}}!function(e){e[e.Origin=0]="Origin",e[e.Pivot=1]="Pivot"}(Yy||(Yy={})),function(e){e[e.World=0]="World",e[e.Local=1]="Local"}(jy||(jy={}));class rx{set scaleRatio(e){this._scaleRatio=e}get scaleRatio(){return this._scaleRatio}get isHovered(){return this._isHovered}get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh=e,e&&(this._attachedNode=e),this._rootMesh.setEnabled(!!e),this._attachedNodeChanged(e)}get attachedNode(){return this._attachedNode}set attachedNode(e){this._attachedNode=e,this._attachedMesh=null,this._rootMesh.setEnabled(!!e),this._attachedNodeChanged(e)}setCustomMesh(e){if(e.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach((e=>{e.dispose()})),e.parent=this._rootMesh,this._customMeshSet=!0}get additionalTransformNode(){return this._additionalTransformNode}set additionalTransformNode(e){this._additionalTransformNode=e}set updateGizmoRotationToMatchAttachedMesh(e){this._updateGizmoRotationToMatchAttachedMesh=e}get updateGizmoRotationToMatchAttachedMesh(){return this._updateGizmoRotationToMatchAttachedMesh}set updateGizmoPositionToMatchAttachedMesh(e){this._updateGizmoPositionToMatchAttachedMesh=e}get updateGizmoPositionToMatchAttachedMesh(){return this._updateGizmoPositionToMatchAttachedMesh}set anchorPoint(e){this._anchorPoint=e}get anchorPoint(){return this._anchorPoint}set coordinatesMode(e){this._coordinatesMode=e;const t=1==e;this.updateGizmoRotationToMatchAttachedMesh=t,this.updateGizmoPositionToMatchAttachedMesh=!0}get coordinatesMode(){return this._coordinatesMode}set updateScale(e){this._updateScale=e}get updateScale(){return this._updateScale}_attachedNodeChanged(e){}constructor(e=yl.DefaultUtilityLayer){this.gizmoLayer=e,this._attachedMesh=null,this._attachedNode=null,this._customRotationQuaternion=null,this._scaleRatio=1,this._isHovered=!1,this._customMeshSet=!1,this._updateGizmoRotationToMatchAttachedMesh=!0,this._updateGizmoPositionToMatchAttachedMesh=!0,this._anchorPoint=0,this._updateScale=!0,this._coordinatesMode=1,this._interactionsEnabled=!0,this._rightHandtoLeftHandMatrix=gt.uq.RotationY(Math.PI),this._rootMesh=new zn.e("gizmoRootNode",e.utilityLayerScene),this._rootMesh.rotationQuaternion=gt.PT.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add((()=>{this._update()}))}get customRotationQuaternion(){return this._customRotationQuaternion}set customRotationQuaternion(e){this._customRotationQuaternion=e}_update(){if(this.attachedNode){let e=this.attachedNode;if(this.attachedMesh&&(e=this.attachedMesh||this.attachedNode),this.updateGizmoPositionToMatchAttachedMesh)if(1==this.anchorPoint&&e.getAbsolutePivotPoint){const t=e.getAbsolutePivotPoint();this._rootMesh.position.copyFrom(t)}else{const t=e.getWorldMatrix().getRow(3),i=t?t.toVector3():new gt.Pq(0,0,0);this._rootMesh.position.copyFrom(i)}if(this.updateGizmoRotationToMatchAttachedMesh){const t=e._isMesh||"AbstractMesh"===e.getClassName()||"TransformNode"===e.getClassName()||"InstancedMesh"===e.getClassName()?e:void 0;e.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion,void 0,rx.PreserveScaling?t:void 0),this._rootMesh.rotationQuaternion.normalize()}else this._customRotationQuaternion?this._rootMesh.rotationQuaternion.copyFrom(this._customRotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1);if(this.updateScale){const t=this.gizmoLayer.utilityLayerScene.activeCamera,i=t.globalPosition;this._rootMesh.position.subtractToRef(i,gt.AA.Vector3[0]);let s=this.scaleRatio;if(t.mode==Ra.i.ORTHOGRAPHIC_CAMERA)t.orthoTop&&t.orthoBottom&&(s*=t.orthoTop-t.orthoBottom);else{const e=t.getScene().useRightHandedSystem?gt.Pq.RightHandedForwardReadOnly:gt.Pq.LeftHandedForwardReadOnly,i=t.getDirection(e);s*=gt.Pq.Dot(gt.AA.Vector3[0],i)}this._rootMesh.scaling.setAll(s),e._getWorldMatrixDeterminant()<0&&!rx.PreserveScaling&&(this._rootMesh.scaling.y*=-1)}else this._rootMesh.scaling.setAll(this.scaleRatio)}this.additionalTransformNode&&(this._rootMesh.computeWorldMatrix(!0),this._rootMesh.getWorldMatrix().multiplyToRef(this.additionalTransformNode.getWorldMatrix(),gt.AA.Matrix[0]),gt.AA.Matrix[0].decompose(this._rootMesh.scaling,this._rootMesh.rotationQuaternion,this._rootMesh.position))}_handlePivotMatrixInverse(e,t,i){if(e.isUsingPivotMatrix()&&!e.isUsingPostMultiplyPivotMatrix())return e.getPivotMatrix().invertToRef(gt.AA.Matrix[5]),void gt.AA.Matrix[5].multiplyToRef(t,i);i.copyFrom(t)}_matrixChanged(){if(this._attachedNode)if(this._attachedNode._isCamera){const e=this._attachedNode;let t,i;if(e.parent){const i=gt.AA.Matrix[1];e.parent._worldMatrix.invertToRef(i),this._attachedNode._worldMatrix.multiplyToRef(i,gt.AA.Matrix[0]),t=gt.AA.Matrix[0]}else t=this._attachedNode._worldMatrix;if(e.getScene().useRightHandedSystem?(this._rightHandtoLeftHandMatrix.multiplyToRef(t,gt.AA.Matrix[1]),i=gt.AA.Matrix[1]):i=t,i.decompose(gt.AA.Vector3[1],gt.AA.Quaternion[0],gt.AA.Vector3[0]),"FreeCamera"===this._attachedNode.getClassName()||"FlyCamera"===this._attachedNode.getClassName()||"ArcFollowCamera"===this._attachedNode.getClassName()||"TargetCamera"===this._attachedNode.getClassName()||"TouchCamera"===this._attachedNode.getClassName()||"UniversalCamera"===this._attachedNode.getClassName()){const e=this._attachedNode;e.rotation=gt.AA.Quaternion[0].toEulerAngles(),e.rotationQuaternion&&(e.rotationQuaternion.copyFrom(gt.AA.Quaternion[0]),e.rotationQuaternion.normalize())}e.position.copyFrom(gt.AA.Vector3[0])}else if(this._attachedNode._isMesh||"AbstractMesh"===this._attachedNode.getClassName()||"TransformNode"===this._attachedNode.getClassName()||"InstancedMesh"===this._attachedNode.getClassName()){const e=this._attachedNode;if(e.parent){const t=gt.AA.Matrix[0],i=gt.AA.Matrix[1];e.parent.getWorldMatrix().invertToRef(t),this._attachedNode.getWorldMatrix().multiplyToRef(t,i);const s=gt.AA.Matrix[4];if(this._handlePivotMatrixInverse(e,i,s),s.decompose(gt.AA.Vector3[0],gt.AA.Quaternion[0],e.position,rx.PreserveScaling?e:void 0,rx.UseAbsoluteScaling),gt.AA.Quaternion[0].normalize(),e.isUsingPivotMatrix()){const t=gt.AA.Quaternion[1];gt.PT.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,e.rotation.z,t);const i=gt.AA.Matrix[2];gt.uq.ScalingToRef(e.scaling.x,e.scaling.y,e.scaling.z,i);const s=gt.AA.Matrix[2];t.toRotationMatrix(s);const r=e.getPivotMatrix(),n=gt.AA.Matrix[3];r.invertToRef(n),r.multiplyToRef(i,gt.AA.Matrix[4]),gt.AA.Matrix[4].multiplyToRef(s,gt.AA.Matrix[5]),gt.AA.Matrix[5].multiplyToRef(n,gt.AA.Matrix[6]),gt.AA.Matrix[6].getTranslationToRef(gt.AA.Vector3[1]),e.position.subtractInPlace(gt.AA.Vector3[1])}}else{const t=gt.AA.Matrix[4];this._handlePivotMatrixInverse(e,this._attachedNode._worldMatrix,t),t.decompose(gt.AA.Vector3[0],gt.AA.Quaternion[0],e.position,rx.PreserveScaling?e:void 0,rx.UseAbsoluteScaling)}gt.AA.Vector3[0].scaleInPlace(1/e.scalingDeterminant),e.scaling.copyFrom(gt.AA.Vector3[0]),e.billboardMode||(e.rotationQuaternion?(e.rotationQuaternion.copyFrom(gt.AA.Quaternion[0]),e.rotationQuaternion.normalize()):e.rotation=gt.AA.Quaternion[0].toEulerAngles())}else if("Bone"===this._attachedNode.getClassName()){const e=this._attachedNode,t=e.getParent();if(t){const i=gt.AA.Matrix[0],s=gt.AA.Matrix[1];t.getFinalMatrix().invertToRef(i),e.getFinalMatrix().multiplyToRef(i,s),e.getLocalMatrix().copyFrom(s)}else e.getLocalMatrix().copyFrom(e.getFinalMatrix());e.markAsDirty()}else{const e=this._attachedNode;if(e.getTypeID){const t=e.getTypeID();if(t===ma.v.LIGHTTYPEID_DIRECTIONALLIGHT||t===ma.v.LIGHTTYPEID_SPOTLIGHT||t===ma.v.LIGHTTYPEID_POINTLIGHT){const t=e.parent;if(t){const i=gt.AA.Matrix[0],s=gt.AA.Matrix[1];t.getWorldMatrix().invertToRef(i),e.getWorldMatrix().multiplyToRef(i,s),s.decompose(void 0,gt.AA.Quaternion[0],gt.AA.Vector3[0])}else this._attachedNode._worldMatrix.decompose(void 0,gt.AA.Quaternion[0],gt.AA.Vector3[0]);e.position=new gt.Pq(gt.AA.Vector3[0].x,gt.AA.Vector3[0].y,gt.AA.Vector3[0].z),e.direction&&(e.direction=new gt.Pq(e.direction.x,e.direction.y,e.direction.z))}}}}_setGizmoMeshMaterial(e,t){e&&e.forEach((e=>{e.material=t,e.color&&(e.color=t.diffuseColor)}))}static GizmoAxisPointerObserver(e,t){let i=!1;const s=e.utilityLayerScene.onPointerObservable.add((e=>{if(e.pickInfo){if(e.type===tt.Zp.POINTERMOVE){if(i)return;t.forEach((t=>{if(t.colliderMeshes&&t.gizmoMeshes){const i=-1!=t.colliderMeshes?.indexOf(e?.pickInfo?.pickedMesh),s=t.dragBehavior.enabled?i||t.active?t.hoverMaterial:t.material:t.disableMaterial;t.gizmoMeshes.forEach((e=>{e.material=s,e.color&&(e.color=s.diffuseColor)}))}}))}e.type===tt.Zp.POINTERDOWN&&t.has(e.pickInfo.pickedMesh?.parent)&&(i=!0,t.get(e.pickInfo.pickedMesh?.parent).active=!0,t.forEach((t=>{const i=(-1!=t.colliderMeshes?.indexOf(e?.pickInfo?.pickedMesh)||t.active)&&t.dragBehavior.enabled?t.hoverMaterial:t.disableMaterial;t.gizmoMeshes.forEach((e=>{e.material=i,e.color&&(e.color=i.diffuseColor)}))}))),e.type===tt.Zp.POINTERUP&&t.forEach((e=>{e.active=!1,i=!1,e.gizmoMeshes.forEach((t=>{t.material=e.dragBehavior.enabled?e.material:e.disableMaterial,t.color&&(t.color=e.material.diffuseColor)}))}))}}));return s}dispose(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)}}rx.PreserveScaling=!1,rx.UseAbsoluteScaling=!0;class nx{static _RemoveAndStorePivotPoint(e){e&&0===nx._PivotCached&&(e.getPivotPointToRef(nx._OldPivotPoint),nx._PivotPostMultiplyPivotMatrix=e._postMultiplyPivotMatrix,nx._OldPivotPoint.equalsToFloats(0,0,0)||(e.setPivotMatrix(gt.uq.IdentityReadOnly),nx._OldPivotPoint.subtractToRef(e.getPivotPoint(),nx._PivotTranslation),nx._PivotTmpVector.copyFromFloats(1,1,1),nx._PivotTmpVector.subtractInPlace(e.scaling),nx._PivotTmpVector.multiplyInPlace(nx._PivotTranslation),e.position.addInPlace(nx._PivotTmpVector))),nx._PivotCached++}static _RestorePivotPoint(e){e&&!nx._OldPivotPoint.equalsToFloats(0,0,0)&&1===nx._PivotCached&&(e.setPivotPoint(nx._OldPivotPoint),e._postMultiplyPivotMatrix=nx._PivotPostMultiplyPivotMatrix,nx._PivotTmpVector.copyFromFloats(1,1,1),nx._PivotTmpVector.subtractInPlace(e.scaling),nx._PivotTmpVector.multiplyInPlace(nx._PivotTranslation),e.position.subtractInPlace(nx._PivotTmpVector)),this._PivotCached--}}nx._PivotCached=0,nx._OldPivotPoint=new gt.Pq,nx._PivotTranslation=new gt.Pq,nx._PivotTmpVector=new gt.Pq,nx._PivotPostMultiplyPivotMatrix=!1;Ma.l.ShadersStore.handleVertexShader="precision highp float;attribute vec3 position;uniform vec3 positionOffset;uniform mat4 worldViewProjection;uniform float scale;void main(void) {vec4 vPos=vec4((vec3(position)+positionOffset)*scale,1.0);gl_Position=worldViewProjection*vPos;}";Ma.l.ShadersStore.handlePixelShader="uniform vec3 color;void main(void) {gl_FragColor=vec4(color,1.0);}";class ox extends bo{get hover(){return this._hover}set hover(e){this._hover=e,this._updateInterpolationTarget()}get drag(){return this._drag}set drag(e){this._drag=e,this._updateInterpolationTarget()}constructor(e,t){super(e,t,"handle",{attributes:["position"],uniforms:["worldViewProjection","color","scale","positionOffset"],needAlphaBlending:!1,needAlphaTesting:!1}),this._hover=!1,this._drag=!1,this._color=new bt.v9,this._scale=1,this._lastTick=-1,this.animationLength=100,this.hoverColor=new bt.v9(0,.467,.84),this.baseColor=new bt.v9(1,1,1),this.hoverScale=.75,this.baseScale=.35,this.dragScale=.55,this._positionOffset=gt.Pq.Zero(),this._updateInterpolationTarget(),this._lastTick=Date.now(),this._onBeforeRender=this.getScene().onBeforeRenderObservable.add((()=>{const e=Date.now(),t=e-this._lastTick,i=this._targetScale-this._scale,s=bt.IG.Color3[0].copyFrom(this._targetColor).subtractToRef(this._color,bt.IG.Color3[0]);this._scale=this._scale+i*t/this.animationLength,s.scaleToRef(t/this.animationLength,s),this._color.addToRef(s,this._color),this.setColor3("color",this._color),this.setFloat("scale",this._scale),this.setVector3("positionOffset",this._positionOffset),this._lastTick=e}))}_updateInterpolationTarget(){this.drag?(this._targetColor=this.hoverColor,this._targetScale=this.dragScale):this.hover?(this._targetColor=this.hoverColor,this._targetScale=this.hoverScale):(this._targetColor=this.baseColor,this._targetScale=this.baseScale)}dispose(){super.dispose(),this.getScene().onBeforeRenderObservable.remove(this._onBeforeRender)}}var ax;!function(e){e[e.IDLE=0]="IDLE",e[e.HOVER=1]="HOVER",e[e.DRAG=2]="DRAG"}(ax||(ax={}));class hx{get state(){return this._state}get gizmo(){return this._gizmo}set hover(e){e?this._state|=1:this._state&=-2,this._updateMaterial()}set drag(e){e?this._state|=2:this._state&=-3,this._updateMaterial()}constructor(e,t){this._state=0,this._materials=[],this._scene=t,this._gizmo=e,this.node=this.createNode(),this.node.reservedDataStore={handle:this}}_createMaterial(e){const t=new ox("handle",this._scene);return e&&(t._positionOffset=e),t}_updateMaterial(){const e=this._state;for(const e of this._materials)e.hover=!1,e.drag=!1;if(2&e)for(const e of this._materials)e.drag=!0;else if(1&e)for(const e of this._materials)e.hover=!0}setDragBehavior(e,t,i){const s=new ex;this._dragBehavior=s,this._dragStartObserver=s.onDragStartObservable.add(e),this._draggingObserver=s.onDragObservable.add(t),this._dragEndObserver=s.onDragEndObservable.add(i),this._dragBehavior.attach(this.node)}dispose(){this._dragBehavior.onDragStartObservable.remove(this._dragStartObserver),this._dragBehavior.onDragObservable.remove(this._draggingObserver),this._dragBehavior.onDragEndObservable.remove(this._dragEndObserver),this._dragBehavior.detach();for(const e of this._materials)e.dispose();this.node.dispose()}}class lx extends hx{createNode(){const e=so("sideVert",{width:1,height:10,depth:.1},this._scene),t=new Gn.V("side",this._scene);e.parent=t;const i=this._createMaterial();return e.material=i,e.isNearGrabbable=!0,this._materials.push(i),t}}class cx extends hx{createNode(){const e=so("angleHor",{width:3,height:1,depth:.1},this._scene),t=so("angleVert",{width:1,height:3,depth:.1},this._scene),i=new Gn.V("angle",this._scene);return e.parent=i,t.parent=i,e.material=this._createMaterial(new gt.Pq(1,0,0)),t.material=this._createMaterial(new gt.Pq(0,1,0)),t.isNearGrabbable=!0,e.isNearGrabbable=!0,this._materials.push(e.material),this._materials.push(t.material),i}}class ux extends rx{set attachedSlate(e){e?(this.attachedMesh=e.mesh,this.updateBoundingBox(),this._pickedPointObserver=e._host.onPickingObservable.add((e=>{if(!this._handleHovered||e&&e.parent===this._handleHovered.node||(this._handleHovered.hover=!1,this._handleHovered=null),e&&e.parent&&e.parent.reservedDataStore&&e.parent.reservedDataStore.handle){const t=e.parent.reservedDataStore.handle;t.gizmo===this&&(this._handleHovered=t,this._handleHovered.hover=!0)}}))):this._attachedSlate&&this._attachedSlate._host.onPickingObservable.remove(this._pickedPointObserver),this._attachedSlate=e}get attachedSlate(){return this._attachedSlate}constructor(e){super(e),this._boundingDimensions=new gt.Pq(0,0,0),this._renderObserver=null,this._tmpQuaternion=new gt.PT,this._tmpVector=new gt.Pq(0,0,0),this._corners=[],this._sides=[],this._boundingBoxGizmo={min:new gt.Pq,max:new gt.Pq},this._margin=.35,this._handleSize=.075,this._attachedSlate=null,this._existingSlateScale=new gt.Pq,this.fixedScreenSize=!1,this.fixedScreenSizeDistanceFactor=10,this._createNode(),this.updateScale=!1,this._renderObserver=this.gizmoLayer.originalScene.onBeforeRenderObservable.add((()=>{this.attachedMesh&&!this._existingSlateScale.equals(this.attachedMesh.scaling)&&this.updateBoundingBox()}))}_createNode(){this._handlesParent=new Gn.V("handlesParent",this.gizmoLayer.utilityLayerScene),this._handlesParent.rotationQuaternion=gt.PT.Identity();const e=[{dimensions:new gt.Pq(-1,-1,0),origin:new gt.Pq(1,0,0)},{dimensions:new gt.Pq(1,-1,0),origin:new gt.Pq(0,0,0)},{dimensions:new gt.Pq(1,1,0),origin:new gt.Pq(0,1,0)},{dimensions:new gt.Pq(-1,1,0),origin:new gt.Pq(1,1,0)}];for(let t=0;t<4;t++){const i=new cx(this,this.gizmoLayer.utilityLayerScene);this._corners.push(i),i.node.rotation.z=Math.PI/2*t,i.node.parent=this._handlesParent,this._assignDragBehaviorCorners(i,((e,t,i,s)=>this._moveHandle(e,t,i,s,!0)),e[t])}for(let e=0;e<4;e++){const t=new lx(this,this.gizmoLayer.utilityLayerScene);this._sides.push(t),t.node.rotation.z=Math.PI/2*e,t.node.parent=this._handlesParent,this._assignDragBehaviorSides(t,e%2==0?new gt.Pq(0,1,0):new gt.Pq(1,0,0))}this._handlesParent.parent=this._rootMesh}_keepAspectRatio(e,t,i=!1){const s=gt.AA.Vector3[0];s.copyFromFloats(t,1,0).normalize(),i&&(s.y*=-1);const r=gt.Pq.Dot(e,s);e.copyFrom(s).scaleInPlace(r)}_clampDimensions(e,t,i,s=!1){const r=gt.AA.Vector3[0];r.copyFrom(e).multiplyInPlace(i);const n=gt.AA.Vector3[1];if(n.copyFromFloats(Math.max(this._attachedSlate.minDimensions.x,r.x+t.x),Math.max(this._attachedSlate.minDimensions.y,r.y+t.y),0),s){const e=t.x/t.y;n.x=Math.max(n.x,n.y*e),n.y=Math.max(n.y,n.x/e)}r.copyFrom(n).subtractInPlace(t),e.x=Math.sign(e.x)*Math.abs(r.x),e.y=Math.sign(e.y)*Math.abs(r.y)}_moveHandle(e,t,i,s,r){if(!this._attachedSlate)return;if(r){const e=t.x/t.y;this._keepAspectRatio(i,e,s.dimensions.x*s.dimensions.y<0)}this._clampDimensions(i,t,s.dimensions,r);const n=gt.AA.Vector3[0],o=gt.AA.Vector3[1];n.copyFrom(i).multiplyInPlace(s.origin),o.copyFrom(i).multiplyInPlace(s.dimensions),this._attachedSlate.origin.copyFrom(e).addInPlace(n),this._attachedSlate.dimensions.set(t.x+o.x,t.y+o.y)}_assignDragBehaviorCorners(e,t,i){const s=new gt.Pq,r=new gt.Pq,n=new gt.Pq,o=new gt.uq,a=new gt.Pq;e.setDragBehavior((e=>{this.attachedSlate&&this.attachedMesh&&(s.set(this.attachedSlate.dimensions.x,this.attachedSlate.dimensions.y,bs.bH),r.copyFrom(this.attachedSlate.origin),n.copyFrom(e.position),o.copyFrom(this.attachedMesh.computeWorldMatrix(!0)),o.invert(),this.attachedSlate._followButton.isToggled=!1,gt.Pq.TransformNormalToRef(gt.Pq.Forward(),this.attachedMesh.getWorldMatrix(),a),a.normalize(),this._handleHovered&&(this._handleDragged=this._handleHovered,this._handleDragged.drag=!0))}),(e=>{this.attachedSlate&&this.attachedMesh&&(((e,t,i,s)=>{e.subtractToRef(i,gt.AA.Vector3[0]);const r=gt.Pq.Dot(gt.AA.Vector3[0],t);gt.AA.Vector3[1].copyFrom(t).scaleInPlace(r),gt.AA.Vector3[0].subtractInPlace(gt.AA.Vector3[1]),gt.AA.Vector3[0].addToRef(i,s)})(e.position,a,n,this._tmpVector),this._tmpVector.subtractInPlace(n),gt.Pq.TransformNormalToRef(this._tmpVector,o,this._tmpVector),t(r,s,this._tmpVector,i),this.attachedSlate._positionElements(),this.updateBoundingBox())}),(()=>{this.attachedSlate&&this.attachedNode&&(this.attachedSlate._updatePivot(),this._handleDragged&&(this._handleDragged.drag=!1,this._handleDragged=null))}))}_assignDragBehaviorSides(e,t){const i=new gt.PT,s=new gt.Pq,r=new gt.Pq,n=new gt.Pq,o=new gt.Pq;e.setDragBehavior((e=>{this.attachedSlate&&this.attachedMesh&&(i.copyFrom(this.attachedMesh.rotationQuaternion),s.copyFrom(e.position),n.copyFrom(this.attachedMesh.getAbsolutePivotPoint()),r.copyFrom(s).subtractInPlace(n).normalize(),this.attachedSlate._followButton.isToggled=!1,gt.Pq.TransformNormalToRef(t,this.attachedMesh.getWorldMatrix(),o),o.normalize(),this._handleHovered&&(this._handleDragged=this._handleHovered,this._handleDragged.drag=!0))}),(e=>{if(this.attachedSlate&&this.attachedMesh){this._tmpVector.copyFrom(e.position),this._tmpVector.subtractInPlace(n),this._tmpVector.normalize();const s=-gt.Pq.GetAngleBetweenVectorsOnPlane(this._tmpVector,r,o);gt.PT.RotationAxisToRef(t,s,this._tmpQuaternion),i.multiplyToRef(this._tmpQuaternion,this.attachedMesh.rotationQuaternion)}}),(()=>{this.attachedSlate&&this.attachedNode&&(this.attachedSlate._updatePivot(),this._handleDragged&&(this._handleDragged.drag=!1,this._handleDragged=null))}))}_attachedNodeChanged(e){e&&this.updateBoundingBox()}updateBoundingBox(){if(this.attachedMesh){nx._RemoveAndStorePivotPoint(this.attachedMesh);const e=this.attachedMesh.parent;this.attachedMesh.setParent(null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=gt.PT.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);const t=this.attachedMesh.getHierarchyBoundingVectors();t.max.subtractToRef(t.min,this._boundingDimensions),this._boundingBoxGizmo.min=t.min,this._boundingBoxGizmo.max=t.max,this._updateHandlesPosition(),this._updateHandlesScaling(),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),nx._RestorePivotPoint(this.attachedMesh),this.attachedMesh.setParent(e),this.attachedMesh.computeWorldMatrix(!0),this._existingSlateScale.copyFrom(this.attachedMesh.scaling)}}_updateHandlesPosition(){const e=this._boundingBoxGizmo.min.clone(),t=this._boundingBoxGizmo.max.clone(),i=this._corners[0].node.scaling.length();e.x-=this._margin*i,e.y-=this._margin*i,t.x+=this._margin*i,t.y+=this._margin*i;const s=e.add(t).scaleInPlace(.5);this._corners[0].node.position.copyFromFloats(e.x,e.y,0),this._corners[1].node.position.copyFromFloats(t.x,e.y,0),this._corners[2].node.position.copyFromFloats(t.x,t.y,0),this._corners[3].node.position.copyFromFloats(e.x,t.y,0),this._sides[0].node.position.copyFromFloats(e.x,s.y,0),this._sides[1].node.position.copyFromFloats(s.x,e.y,0),this._sides[2].node.position.copyFromFloats(t.x,s.y,0),this._sides[3].node.position.copyFromFloats(s.x,t.y,0)}_updateHandlesScaling(){if(this._attachedSlate&&this._attachedSlate.mesh){const e=this._attachedSlate.mesh.scaling.x*this._attachedSlate.dimensions.x,t=this._attachedSlate.mesh.scaling.y*this._attachedSlate.dimensions.y,i=Math.min(e,t)*this._handleSize;for(let e=0;e<this._corners.length;e++)this._corners[e].node.scaling.setAll(i);for(let e=0;e<this._sides.length;e++)this._sides[e].node.scaling.setAll(i)}}_update(){if(super._update(),this.gizmoLayer.utilityLayerScene.activeCamera&&this._attachedSlate&&this._attachedSlate.mesh){if(this.fixedScreenSize){this._attachedSlate.mesh.absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);const e=this._handleSize*this._tmpVector.length()/this.fixedScreenSizeDistanceFactor;for(let t=0;t<this._corners.length;t++)this._corners[t].node.scaling.set(e,e,e);for(let t=0;t<this._sides.length;t++)this._sides[t].node.scaling.set(e,e,e)}this._updateHandlesPosition()}}dispose(){this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),super.dispose();for(const e of this._corners)e.dispose();for(const e of this._sides)e.dispose()}}class dx{get currentDraggingPointerID(){return this.currentDraggingPointerId}set currentDraggingPointerID(e){this.currentDraggingPointerId=e}set enabled(e){e!=this._enabled&&this.onEnabledObservable.notifyObservers(e),this._enabled=e}get enabled(){return this._enabled}get options(){return this._options}set options(e){this._options=e}constructor(e){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this._activeDragButton=-1,this.maxDragAngle=0,this.dragButtons=[0,1,2],this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerId=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new Zi.cP,this.onDragStartObservable=new Zi.cP,this.onDragEndObservable=new Zi.cP,this.onEnabledObservable=new Zi.cP,this.moveAttached=!0,this._enabled=!0,this.startAndReleaseDragOnPointerEvents=!0,this.detachCameraControls=!0,this.useObjectOrientationForDragging=!0,this.validateDrag=e=>!0,this._tmpVector=new gt.Pq(0,0,0),this._alternatePickedPoint=new gt.Pq(0,0,0),this._worldDragAxis=new gt.Pq(0,0,0),this._targetPosition=new gt.Pq(0,0,0),this._attachedToElement=!1,this._startDragRay=new fa.Rl(new gt.Pq,new gt.Pq),this._lastPointerRay={},this._dragDelta=new gt.Pq,this._pointA=new gt.Pq(0,0,0),this._pointC=new gt.Pq(0,0,0),this._localAxis=new gt.Pq(0,0,0),this._lookAt=new gt.Pq(0,0,0),this._options=e||{};let t=0;if(this._options.dragAxis&&t++,this._options.dragPlaneNormal&&t++,t>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}get name(){return"PointerDrag"}init(){}attach(e,t){this._scene=e.getScene(),e.isNearGrabbable=!0,this.attachedNode=e,dx._PlaneScene||(this._debugMode?dx._PlaneScene=this._scene:(dx._PlaneScene=new Ie.Z(this._scene.getEngine(),{virtual:!0}),dx._PlaneScene.detachControl(),this._scene.onDisposeObservable.addOnce((()=>{dx._PlaneScene.dispose(),dx._PlaneScene=null})))),this._dragPlane=ko("pointerDragPlane",{size:this._debugMode?1:1e4,updatable:!1,sideOrientation:zn.e.DOUBLESIDE},dx._PlaneScene),this.lastDragPosition=new gt.Pq(0,0,0);const i=t||(e=>this.attachedNode==e||e.isDescendantOf(this.attachedNode));this._pointerObserver=this._scene.onPointerObservable.add((e=>{if(this.enabled){if(e.type==tt.Zp.POINTERDOWN)this.startAndReleaseDragOnPointerEvents&&!this.dragging&&e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh&&e.pickInfo.pickedPoint&&e.pickInfo.ray&&i(e.pickInfo.pickedMesh)&&-1===this._activeDragButton&&-1!==this.dragButtons.indexOf(e.event.button)&&(this._activeDragButton=e.event.button,this._activePointerInfo=e,this._startDrag(e.event.pointerId,e.pickInfo.ray,e.pickInfo.pickedPoint));else if(e.type==tt.Zp.POINTERUP)!this.startAndReleaseDragOnPointerEvents||this.currentDraggingPointerId!=e.event.pointerId||this._activeDragButton!==e.event.button&&-1!==this._activeDragButton||this.releaseDrag();else if(e.type==tt.Zp.POINTERMOVE){const t=e.event.pointerId;if(this.currentDraggingPointerId===dx._AnyMouseId&&t!==dx._AnyMouseId){const i=e.event;("mouse"===i.pointerType||!this._scene.getEngine().hostInformation.isMobile&&i instanceof MouseEvent)&&(this._lastPointerRay[this.currentDraggingPointerId]&&(this._lastPointerRay[t]=this._lastPointerRay[this.currentDraggingPointerId],delete this._lastPointerRay[this.currentDraggingPointerId]),this.currentDraggingPointerId=t)}this._lastPointerRay[t]||(this._lastPointerRay[t]=new fa.Rl(new gt.Pq,new gt.Pq)),e.pickInfo&&e.pickInfo.ray&&(this._lastPointerRay[t].origin.copyFrom(e.pickInfo.ray.origin),this._lastPointerRay[t].direction.copyFrom(e.pickInfo.ray.direction),this.currentDraggingPointerId==t&&this.dragging&&this._moveDrag(e.pickInfo.ray))}}else this._attachedToElement&&this.releaseDrag()})),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{if(this._moving&&this.moveAttached){let e=!1;nx._RemoveAndStorePivotPoint(this.attachedNode),this._targetPosition.subtractToRef(this.attachedNode.absolutePosition,this._tmpVector),this._tmpVector.scaleInPlace(this.dragDeltaRatio),this.attachedNode.getAbsolutePosition().addToRef(this._tmpVector,this._tmpVector),this.validateDrag(this._tmpVector)&&(this.attachedNode.setAbsolutePosition(this._tmpVector),e=!0),nx._RestorePivotPoint(this.attachedNode),e&&this.attachedNode.computeWorldMatrix()}}))}releaseDrag(){if(this.dragging&&(this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerId,pointerInfo:this._activePointerInfo})),this.currentDraggingPointerId=-1,this._activeDragButton=-1,this._activePointerInfo=null,this._moving=!1,this.detachCameraControls&&this._attachedToElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera){if("ArcRotateCamera"===this._scene.activeCamera.getClassName()){const e=this._scene.activeCamera;e.attachControl(!e.inputs||e.inputs.noPreventDefault,e._useCtrlForPanning,e._panningMouseButton)}else this._scene.activeCamera.attachControl(!this._scene.activeCamera.inputs||this._scene.activeCamera.inputs.noPreventDefault);this._attachedToElement=!1}}startDrag(e=dx._AnyMouseId,t,i){this._startDrag(e,t,i);let s=this._lastPointerRay[e];e===dx._AnyMouseId&&(s=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),s&&this._moveDrag(s)}_startDrag(e,t,i){if(!this._scene.activeCamera||this.dragging||!this.attachedNode)return;nx._RemoveAndStorePivotPoint(this.attachedNode),t?(this._startDragRay.direction.copyFrom(t.direction),this._startDragRay.origin.copyFrom(t.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this.attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,i||this._tmpVector);const s=this._pickWithRayOnDragPlane(this._startDragRay);s?(this.dragging=!0,this.currentDraggingPointerId=e,this.lastDragPosition.copyFrom(s),this.onDragStartObservable.notifyObservers({dragPlanePoint:s,pointerId:this.currentDraggingPointerId,pointerInfo:this._activePointerInfo}),this._targetPosition.copyFrom(this.attachedNode.getAbsolutePosition()),this.detachCameraControls&&this._scene.activeCamera&&this._scene.activeCamera.inputs&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedToElement?(this._scene.activeCamera.detachControl(),this._attachedToElement=!0):this._attachedToElement=!1)):this.releaseDrag(),nx._RestorePivotPoint(this.attachedNode)}_moveDrag(e){this._moving=!0;const t=this._pickWithRayOnDragPlane(e);if(t){nx._RemoveAndStorePivotPoint(this.attachedNode),this.updateDragPlane&&this._updateDragPlanePosition(e,t);let i=0;this._options.dragAxis?(this.useObjectOrientationForDragging?gt.Pq.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis):this._worldDragAxis.copyFrom(this._options.dragAxis),t.subtractToRef(this.lastDragPosition,this._tmpVector),this._worldDragAxis.normalize(),i=gt.Pq.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(i,this._dragDelta)):(i=this._dragDelta.length(),t.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:i,delta:this._dragDelta,dragPlanePoint:t,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerId,pointerInfo:this._activePointerInfo}),this.lastDragPosition.copyFrom(t),nx._RestorePivotPoint(this.attachedNode)}}_pickWithRayOnDragPlane(e){if(!e)return null;let t=Math.acos(gt.Pq.Dot(this._dragPlane.forward,e.direction));if(t>Math.PI/2&&(t=Math.PI-t),this.maxDragAngle>0&&t>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(e.direction),this.attachedNode.absolutePosition.subtractToRef(e.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*gt.Pq.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);const t=gt.Pq.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-t,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this.attachedNode.absolutePosition),this._alternatePickedPoint}return null}const i=this._dragPlane.forward,s=this._dragPlane.position,r=e.direction.dot(i);if(Math.abs(r)<bs.bH)return null;s.subtractToRef(e.origin,gt.AA.Vector3[0]);const n=gt.AA.Vector3[0].dot(i)/r;return n<0?null:(e.direction.scaleToRef(n,gt.AA.Vector3[0]),e.origin.add(gt.AA.Vector3[0]))}_updateDragPlanePosition(e,t){this._pointA.copyFrom(t),this._options.dragAxis?(this.useObjectOrientationForDragging?gt.Pq.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),e.origin.subtractToRef(this._pointA,this._pointC),this._pointC.normalize(),Math.abs(gt.Pq.Dot(this._localAxis,this._pointC))>.999?Math.abs(gt.Pq.Dot(gt.Pq.UpReadOnly,this._pointC))>.999?this._lookAt.copyFrom(gt.Pq.Right()):this._lookAt.copyFrom(gt.Pq.UpReadOnly):(gt.Pq.CrossToRef(this._localAxis,this._pointC,this._lookAt),gt.Pq.CrossToRef(this._localAxis,this._lookAt,this._lookAt),this._lookAt.normalize()),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrientationForDragging?gt.Pq.TransformCoordinatesToRef(this._options.dragPlaneNormal,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._scene.activeCamera&&this._scene.activeCamera.getForwardRay().direction.normalizeToRef(this._localAxis),this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(this._pointA.add(this._localAxis))),this._dragPlane.position.copyFrom(this.attachedNode.getAbsolutePosition()),this._dragPlane.computeWorldMatrix(!0)}detach(){this._lastPointerRay={},this.attachedNode&&(this.attachedNode.isNearGrabbable=!1),this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this._dragPlane&&this._dragPlane.dispose(),this.releaseDrag()}}dx._AnyMouseId=-2;class _x extends wy{get defaultBehavior(){return this._defaultBehavior}get dimensions(){return this._dimensions}set dimensions(e){let t=1;if(e.x<this.minDimensions.x||e.y<this.minDimensions.y){const i=e.x/e.y;t=this.minDimensions.x/this.minDimensions.y>i?this.minDimensions.x/e.x:this.minDimensions.y/e.y}this._dimensions.copyFrom(e).scaleInPlace(t),this._updatePivot(),this._positionElements()}get titleBarHeight(){return this._titleBarHeight}set titleBarHeight(e){this._titleBarHeight=e}set renderingGroupId(e){this._titleBar.renderingGroupId=e,this._titleBarTitle.renderingGroupId=e,this._contentPlate.renderingGroupId=e,this._backPlate.renderingGroupId=e}get renderingGroupId(){return this._titleBar.renderingGroupId}set title(e){this._titleText=e,this._titleTextComponent&&(this._titleTextComponent.text=e)}get title(){return this._titleText}constructor(e){super(e),this.titleBarMargin=.005,this.origin=new gt.Pq(0,0,0),this._dimensions=new gt.I9(21.875,12.5),this._titleBarHeight=.625,this._titleText="",this.fitContentToDimensions=!1,this._contentScaleRatio=1,this.minDimensions=new gt.I9(15.625,6.25),this.defaultDimensions=this._dimensions.clone(),this._followButton=new $y("followButton"+this.name),this._followButton.isToggleButton=!0,this._closeButton=new $y("closeButton"+this.name),this._contentViewport=new Es.L(0,0,1,1),this._contentDragBehavior=new dx({dragPlaneNormal:new gt.Pq(0,0,-1)})}_applyFacade(e){this._contentMaterial.albedoTexture=e,this._resetContentPositionAndZoom(),this._applyContentViewport(),e.attachToMesh(this._contentPlate,!0)}_addControl(e){e._host=this._host,this._host.utilityLayer&&e._prepareNode(this._host.utilityLayer.utilityLayerScene)}_getTypeName(){return"HolographicSlate"}_positionElements(){const e=this._followButton,t=this._closeButton,i=this._titleBar,s=this._titleBarTitle,r=this._contentPlate,n=this._backPlate;if(e&&t&&i){t.scaling.setAll(this.titleBarHeight),e.scaling.setAll(this.titleBarHeight),t.position.copyFromFloats(this.dimensions.x-this.titleBarHeight/2,-this.titleBarHeight/2,0).addInPlace(this.origin),e.position.copyFromFloats(this.dimensions.x-3*this.titleBarHeight/2,-this.titleBarHeight/2,0).addInPlace(this.origin);const o=this.dimensions.y-this.titleBarHeight-this.titleBarMargin,a=r.getScene().useRightHandedSystem;i.scaling.set(this.dimensions.x,this.titleBarHeight,bs.bH),s.scaling.set(this.dimensions.x-2*this.titleBarHeight,this.titleBarHeight,bs.bH),r.scaling.copyFromFloats(this.dimensions.x,o,bs.bH),n.scaling.copyFromFloats(this.dimensions.x,o,bs.bH),i.position.copyFromFloats(this.dimensions.x/2,-this.titleBarHeight/2,0).addInPlace(this.origin),s.position.copyFromFloats(this.dimensions.x/2-this.titleBarHeight,-this.titleBarHeight/2,a?bs.bH:-bs.bH).addInPlace(this.origin),r.position.copyFromFloats(this.dimensions.x/2,-(this.titleBarHeight+this.titleBarMargin+o/2),0).addInPlace(this.origin),n.position.copyFromFloats(this.dimensions.x/2,-(this.titleBarHeight+this.titleBarMargin+o/2),a?-bs.bH:bs.bH).addInPlace(this.origin),this._titleTextComponent.host.scaleTo(_x._DEFAULT_TEXT_RESOLUTION_Y*s.scaling.x/s.scaling.y,_x._DEFAULT_TEXT_RESOLUTION_Y);const h=this.dimensions.x/o;this._contentViewport.width=this._contentScaleRatio,this._contentViewport.height=this._contentScaleRatio/h,this._applyContentViewport(),this._gizmo&&this._gizmo.updateBoundingBox()}}_applyContentViewport(){if(this._contentPlate?.material&&this._contentPlate.material.albedoTexture){const e=this._contentPlate.material.albedoTexture;e.uScale=this._contentScaleRatio,e.vScale=this.fitContentToDimensions?this._contentScaleRatio:this._contentScaleRatio/this._contentViewport.width*this._contentViewport.height,e.uOffset=this._contentViewport.x,e.vOffset=this._contentViewport.y}}_resetContentPositionAndZoom(){this._contentViewport.x=0,this._contentViewport.y=0,this._contentScaleRatio=1}_updatePivot(){if(!this.mesh)return;const e=new gt.Pq(.5*this.dimensions.x,.5*-this.dimensions.y,bs.bH);e.addInPlace(this.origin),e.z=0;const t=new gt.Pq(0,0,0);gt.Pq.TransformCoordinatesToRef(t,this.mesh.computeWorldMatrix(!0),t),this.mesh.setPivotPoint(e);const i=new gt.Pq(0,0,0);gt.Pq.TransformCoordinatesToRef(i,this.mesh.computeWorldMatrix(!0),i),this.mesh.position.addInPlace(t).subtractInPlace(i)}_createNode(e){const t=new zn.e("slate_"+this.name,e);this._titleBar=so("titleBar_"+this.name,{size:1},e),this._titleBarTitle=ko("titleText_"+this.name,{size:1},e),this._titleBarTitle.parent=t,this._titleBarTitle.isPickable=!1;const i=Ms.CreateForMesh(this._titleBarTitle);if(this._titleTextComponent=new lr("titleText_"+this.name,this._titleText),this._titleTextComponent.textWrapping=2,this._titleTextComponent.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,this._titleTextComponent.color="white",this._titleTextComponent.fontSize=_x._DEFAULT_TEXT_RESOLUTION_Y/2,this._titleTextComponent.paddingLeft=_x._DEFAULT_TEXT_RESOLUTION_Y/4,i.addControl(this._titleTextComponent),e.useRightHandedSystem){const t=new zl.IU(0,0,1,1);this._contentPlate=ko("contentPlate_"+this.name,{size:1,sideOrientation:Hn.P.BACKSIDE,frontUVs:t},e),this._backPlate=ko("backPlate_"+this.name,{size:1,sideOrientation:Hn.P.FRONTSIDE},e)}else{const t=new zl.IU(0,0,1,1);this._contentPlate=ko("contentPlate_"+this.name,{size:1,sideOrientation:Hn.P.FRONTSIDE,frontUVs:t},e),this._backPlate=ko("backPlate_"+this.name,{size:1,sideOrientation:Hn.P.BACKSIDE},e)}this._titleBar.parent=t,this._titleBar.isNearGrabbable=!0,this._contentPlate.parent=t,this._backPlate.parent=t,this._attachContentPlateBehavior(),this._addControl(this._followButton),this._addControl(this._closeButton);const s=this._followButton,r=this._closeButton;s.node.parent=t,r.node.parent=t,this._positionElements();const n=$i.S0.GetAssetUrl(_x.ASSETS_BASE_URL);return this._followButton.imageUrl=n+_x.FOLLOW_ICON_FILENAME,this._closeButton.imageUrl=n+_x.CLOSE_ICON_FILENAME,this._followButton.isBackplateVisible=!1,this._closeButton.isBackplateVisible=!1,this._followButton.onToggleObservable.add((e=>{this._defaultBehavior.followBehaviorEnabled=e,this._defaultBehavior.followBehaviorEnabled&&this._defaultBehavior.followBehavior.recenter()})),this._closeButton.onPointerClickObservable.add((()=>{this.dispose()})),t.rotationQuaternion=gt.PT.Identity(),t.isVisible=!1,t}_attachContentPlateBehavior(){this._contentDragBehavior.attach(this._contentPlate),this._contentDragBehavior.moveAttached=!1,this._contentDragBehavior.useObjectOrientationForDragging=!0,this._contentDragBehavior.updateDragPlane=!1;const e=new gt.Pq,t=new gt.Pq,i=new gt.Pq,s=new gt.Pq,r=new gt.I9;let n,o;this._contentDragBehavior.onDragStartObservable.add((r=>{this.node&&(n=this._contentViewport.clone(),o=this.node.computeWorldMatrix(!0),e.copyFrom(r.dragPlanePoint),t.set(this.dimensions.x,this.dimensions.y,bs.bH),t.y-=this.titleBarHeight+this.titleBarMargin,gt.Pq.TransformNormalToRef(t,o,t),i.copyFromFloats(0,1,0),gt.Pq.TransformNormalToRef(i,o,i),s.copyFromFloats(1,0,0),gt.Pq.TransformNormalToRef(s,o,s),i.normalize(),i.scaleInPlace(1/gt.Pq.Dot(i,t)),s.normalize(),s.scaleInPlace(1/gt.Pq.Dot(s,t)))}));const a=new gt.Pq;this._contentDragBehavior.onDragObservable.add((t=>{this.fitContentToDimensions||(a.copyFrom(t.dragPlanePoint),a.subtractInPlace(e),r.copyFromFloats(gt.Pq.Dot(a,s),gt.Pq.Dot(a,i)),this._contentViewport.x=Zy.X.Clamp(n.x-a.x,0,1-this._contentViewport.width*this._contentScaleRatio),this._contentViewport.y=Zy.X.Clamp(n.y-a.y,0,1-this._contentViewport.height*this._contentScaleRatio),this._applyContentViewport())}))}_affectMaterial(e){this._titleBarMaterial=new Hy(`${this.name} plateMaterial`,e.getScene()),this._contentMaterial=new Ny(`${this.name} contentMaterial`,e.getScene()),this._contentMaterial.renderBorders=!0,this._backMaterial=new Hy(`${this.name} backPlate`,e.getScene()),this._backMaterial.lineWidth=bs.bH,this._backMaterial.radius=.005,this._backMaterial.backFaceCulling=!0,this._titleBar.material=this._titleBarMaterial,this._contentPlate.material=this._contentMaterial,this._backPlate.material=this._backMaterial,this._resetContent(),this._applyContentViewport()}_prepareNode(e){super._prepareNode(e),this._gizmo=new ux(this._host.utilityLayer),this._gizmo.attachedSlate=this,this._defaultBehavior=new sx,this._defaultBehavior.attach(this.node,[this._titleBar]),this._defaultBehavior.sixDofDragBehavior.onDragStartObservable.add((()=>{this._followButton.isToggled=!1})),this._positionChangedObserver=this._defaultBehavior.sixDofDragBehavior.onPositionChangedObservable.add((()=>{this._gizmo.updateBoundingBox()})),this._updatePivot(),this.resetDefaultAspectAndPose(!1)}resetDefaultAspectAndPose(e=!0){if(!this._host||!this._host.utilityLayer||!this.node)return;const t=this._host.utilityLayer.utilityLayerScene,i=t.activeCamera;if(i){const s=i.getWorldMatrix(),r=gt.Pq.TransformNormal(gt.Pq.Backward(t.useRightHandedSystem),s);this.origin.setAll(0),this._gizmo.updateBoundingBox();const n=this.node.getAbsolutePivotPoint();this.node.position.equalsToFloats(0,0,0)&&this.node.position.copyFrom(i.position).subtractInPlace(r).subtractInPlace(n),this.node.rotationQuaternion=gt.PT.FromLookDirectionLH(r,new gt.Pq(0,1,0)),e&&(this.dimensions=this.defaultDimensions)}}dispose(){super.dispose(),this._titleBarMaterial.dispose(),this._contentMaterial.dispose(),this._titleBar.dispose(),this._titleBarTitle.dispose(),this._contentPlate.dispose(),this._backPlate.dispose(),this._followButton.dispose(),this._closeButton.dispose(),this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._defaultBehavior.sixDofDragBehavior.onPositionChangedObservable.remove(this._positionChangedObserver),this._defaultBehavior.detach(),this._gizmo.dispose(),this._contentDragBehavior.detach()}}_x.ASSETS_BASE_URL="https://assets.babylonjs.com/core/MRTK/",_x.CLOSE_ICON_FILENAME="IconClose.png",_x.FOLLOW_ICON_FILENAME="IconFollowMe.png",_x._DEFAULT_TEXT_RESOLUTION_Y=102.4;class px extends ky{get defaultBehavior(){return this._defaultBehavior}get isPinned(){return this._isPinned}set isPinned(e){this._pinButton.isToggled===e?(this._isPinned=e,this._defaultBehavior.followBehaviorEnabled=!e):this._pinButton.isToggled=e}_createPinButton(e){const t=new $y("pin"+this.name,!1),i=$i.S0.GetAssetUrl(px._ASSETS_BASE_URL);return t.imageUrl=i+px._PIN_ICON_FILENAME,t.parent=this,t._host=this._host,t.isToggleButton=!0,t.onToggleObservable.add((e=>{this.isPinned=e})),this._host.utilityLayer&&(t._prepareNode(this._host.utilityLayer.utilityLayerScene),t.scaling.scaleInPlace(ky.MENU_BUTTON_SCALE),t.node&&(t.node.parent=e)),t}_createNode(e){const t=super._createNode(e);return this._pinButton=this._createPinButton(t),this.isPinned=!1,this._defaultBehavior.attach(t,[this._backPlate]),this._defaultBehavior.followBehavior.ignoreCameraPitchAndRoll=!0,this._defaultBehavior.followBehavior.pitchOffset=-15,this._defaultBehavior.followBehavior.minimumDistance=.3,this._defaultBehavior.followBehavior.defaultDistance=.4,this._defaultBehavior.followBehavior.maximumDistance=.6,this._backPlate.isNearGrabbable=!0,t.isVisible=!1,t}_finalProcessing(){super._finalProcessing(),this._pinButton.position.copyFromFloats((this._backPlate.scaling.x+ky.MENU_BUTTON_SCALE)/2,this._backPlate.scaling.y/2,0)}constructor(e){super(e),this._isPinned=!1,this._defaultBehavior=new sx,this._dragObserver=this._defaultBehavior.sixDofDragBehavior.onDragObservable.add((()=>{this.isPinned=!0})),this.backPlateMargin=1}dispose(){super.dispose(),this._defaultBehavior.sixDofDragBehavior.onDragObservable.remove(this._dragObserver),this._defaultBehavior.detach()}}px._ASSETS_BASE_URL="https://assets.babylonjs.com/core/MRTK/",px._PIN_ICON_FILENAME="IconPin.png";Ma.l.ShadersStore.mrdlSliderBarPixelShader="uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform vec4 Global_Left_Index_Middle_Position;uniform vec4 Global_Right_Index_Middle_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;void Blob_Fragment_B30(\nsampler2D Blob_Texture,\nvec4 Blob_Info1,\nvec4 Blob_Info2,\nout vec4 Blob_Color)\n{float k1=dot(Blob_Info1.xy,Blob_Info1.xy);float k2=dot(Blob_Info2.xy,Blob_Info2.xy);vec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);Blob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);}\nvoid FastLinearTosRGB_B42(\nvec4 Linear,\nout vec4 sRGB)\n{sRGB.rgb=sqrt(clamp(Linear.rgb,0.0,1.0));sRGB.a=Linear.a;}\nvoid Scale_RGB_B59(\nvec4 Color,\nfloat Scalar,\nout vec4 Result)\n{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}\nvoid Fragment_Main_B121(\nfloat Sun_Intensity,\nfloat Sun_Theta,\nfloat Sun_Phi,\nvec3 Normal,\nvec4 Albedo,\nfloat Fresnel_Reflect,\nfloat Shininess,\nvec3 Incident,\nvec4 Horizon_Color,\nvec4 Sky_Color,\nvec4 Ground_Color,\nfloat Indirect_Diffuse,\nfloat Specular,\nfloat Horizon_Power,\nfloat Reflection,\nvec4 Reflection_Sample,\nvec4 Indirect_Sample,\nfloat Sharpness,\nfloat SSS,\nfloat Subsurface,\nvec4 Translucence,\nvec4 Rim_Light,\nvec4 Iridescence,\nout vec4 Result)\n{float theta=Sun_Theta*2.0*3.14159;float phi=Sun_Phi*3.14159;vec3 lightDir= vec3(cos(phi)*cos(theta),sin(phi),cos(phi)*sin(theta));float NdotL=max(dot(lightDir,Normal),0.0);vec3 R=reflect(Incident,Normal);float RdotL=max(0.0,dot(R,lightDir));float specular=pow(RdotL,Shininess);specular=mix(specular,smoothstep(0.495*Sharpness,1.0-0.495*Sharpness,specular),Sharpness);vec4 gi=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);Result=((Sun_Intensity*NdotL+Indirect_Sample*Indirect_Diffuse+Translucence)*(1.0+SSS*Subsurface))*Albedo*(1.0-Fresnel_Reflect)+(Sun_Intensity*specular*Specular+Fresnel_Reflect*Reflection*Reflection_Sample)+Fresnel_Reflect*Rim_Light+Iridescence;}\nvoid Bulge_B79(\nbool Enabled,\nvec3 Normal,\nvec3 Tangent,\nfloat Bulge_Height,\nvec4 UV,\nfloat Bulge_Radius,\nvec3 ButtonN,\nout vec3 New_Normal)\n{vec2 xy=clamp(UV.xy*2.0,vec2(-1,-1),vec2(1,1));vec3 B=(cross(Normal,Tangent));float k=-clamp(1.0-length(xy)/Bulge_Radius,0.0,1.0)*Bulge_Height;k=sin(k*3.14159*0.5);k*=smoothstep(0.9998,0.9999,abs(dot(ButtonN,Normal)));New_Normal=Normal*sqrt(1.0-k*k)+(xy.x*Tangent+xy.y*B)*k;New_Normal=Enabled ? New_Normal : Normal;}\nvoid SSS_B77(\nvec3 ButtonN,\nvec3 Normal,\nvec3 Incident,\nout float Result)\n{float NdotI=abs(dot(Normal,Incident));float BdotI=abs(dot(ButtonN,Incident));Result=(abs(NdotI-BdotI)); }\nvoid FingerOcclusion_B67(\nfloat Width,\nfloat DistToCenter,\nfloat Fuzz,\nfloat Min_Fuzz,\nvec3 Position,\nvec3 Forward,\nvec3 Nearest,\nfloat Fade_Out,\nout float NotInShadow)\n{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}\nvoid FingerOcclusion_B68(\nfloat Width,\nfloat DistToCenter,\nfloat Fuzz,\nfloat Min_Fuzz,\nvec3 Position,\nvec3 Forward,\nvec3 Nearest,\nfloat Fade_Out,\nout float NotInShadow)\n{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}\nvoid Scale_Color_B91(\nvec4 Color,\nfloat Scalar,\nout vec4 Result)\n{Result=Scalar*Color;}\nvoid From_HSV_B73(\nfloat Hue,\nfloat Saturation,\nfloat Value,\nfloat Alpha,\nout vec4 Color)\n{vec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(vec3(Hue,Hue,Hue)+K.xyz)*6.0-K.www);Color.rgb=Value*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),Saturation);Color.a=Alpha;}\nvoid Fast_Fresnel_B122(\nfloat Front_Reflect,\nfloat Edge_Reflect,\nfloat Power,\nvec3 Normal,\nvec3 Incident,\nout float Transmit,\nout float Reflect)\n{float d=max(-dot(Incident,Normal),0.0);Reflect=Front_Reflect+(Edge_Reflect-Front_Reflect)*pow(.01-d,Power);Transmit=1.0-Reflect;}\nvoid Mapped_Environment_B51(\nsampler2D Reflected_Environment,\nsampler2D Indirect_Environment,\nvec3 Dir,\nout vec4 Reflected_Color,\nout vec4 Indirect_Diffuse)\n{Reflected_Color=texture(Reflected_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));Indirect_Diffuse=texture(Indirect_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));}\nvec4 SampleEnv_Bid50(vec3 D,vec4 S,vec4 H,vec4 G,float exponent)\n{float k=pow(abs(D.y),exponent);vec4 C;if (D.y>0.0) {C=mix(H,S,k);} else {C=mix(H,G,k); }\nreturn C;}\nvoid Sky_Environment_B50(\nvec3 Normal,\nvec3 Reflected,\nvec4 Sky_Color,\nvec4 Horizon_Color,\nvec4 Ground_Color,\nfloat Horizon_Power,\nout vec4 Reflected_Color,\nout vec4 Indirect_Color)\n{Reflected_Color=SampleEnv_Bid50(Reflected,Sky_Color,Horizon_Color,Ground_Color,Horizon_Power);Indirect_Color=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);}\nvoid Min_Segment_Distance_B65(\nvec3 P0,\nvec3 P1,\nvec3 Q0,\nvec3 Q1,\nout vec3 NearP,\nout vec3 NearQ,\nout float Distance)\n{vec3 u=P1-P0;vec3 v=Q1-Q0;vec3 w=P0-Q0;float a=dot(u,u);float b=dot(u,v);float c=dot(v,v);float d=dot(u,w);float e=dot(v,w);float D=a*c-b*b;float sD=D;float tD=D;float sc,sN,tc,tN;if (D<0.00001) {sN=0.0;sD=1.0;tN=e;tD=c;} else {sN=(b*e-c*d);tN=(a*e-b*d);if (sN<0.0) {sN=0.0;tN=e;tD=c;} else if (sN>sD) {sN=sD;tN=e+b;tD=c;}}\nif (tN<0.0) {tN=0.0;if (-d<0.0) {sN=0.0;} else if (-d>a) {sN=sD;} else {sN=-d;sD=a;}} else if (tN>tD) {tN=tD;if ((-d+b)<0.0) {sN=0.0;} else if ((-d+b)>a) {sN=sD;} else {sN=(-d+b);sD=a;}}\nsc=abs(sN)<0.000001 ? 0.0 : sN/sD;tc=abs(tN)<0.000001 ? 0.0 : tN/tD;NearP=P0+sc*u;NearQ=Q0+tc*v;Distance=distance(NearP,NearQ);}\nvoid To_XYZ_B74(\nvec3 Vec3,\nout float X,\nout float Y,\nout float Z)\n{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}\nvoid Finger_Positions_B64(\nvec3 Left_Index_Pos,\nvec3 Right_Index_Pos,\nvec3 Left_Index_Middle_Pos,\nvec3 Right_Index_Middle_Pos,\nout vec3 Left_Index,\nout vec3 Right_Index,\nout vec3 Left_Index_Middle,\nout vec3 Right_Index_Middle)\n{Left_Index= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Left_Index_Pos);Right_Index= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Right_Index_Pos);Left_Index_Middle= (Use_Global_Left_Index ? Global_Left_Index_Middle_Position.xyz : Left_Index_Middle_Pos);Right_Index_Middle= (Use_Global_Right_Index ? Global_Right_Index_Middle_Position.xyz : Right_Index_Middle_Pos);}\nvoid VaryHSV_B108(\nvec3 HSV_In,\nfloat Hue_Shift,\nfloat Saturation_Shift,\nfloat Value_Shift,\nout vec3 HSV_Out)\n{HSV_Out=vec3(fract(HSV_In.x+Hue_Shift),clamp(HSV_In.y+Saturation_Shift,0.0,1.0),clamp(HSV_In.z+Value_Shift,0.0,1.0));}\nvoid Remap_Range_B114(\nfloat In_Min,\nfloat In_Max,\nfloat Out_Min,\nfloat Out_Max,\nfloat In,\nout float Out)\n{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}\nvoid To_HSV_B75(\nvec4 Color,\nout float Hue,\nout float Saturation,\nout float Value,\nout float Alpha,\nout vec3 HSV)\n{vec4 K=vec4(0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=Color.g<Color.b ? vec4(Color.bg,K.wz) : vec4(Color.gb,K.xy);vec4 q=Color.r<p.x ? vec4(p.xyw,Color.r) : vec4(Color.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;Hue=abs(q.z+(q.w-q.y)/(6.0*d+e));Saturation=d/(q.x+e);Value=q.x;Alpha=Color.a;HSV=vec3(Hue,Saturation,Value);}\nvoid Code_B110(\nfloat X,\nout float Result)\n{Result=(acos(X)/3.14159-0.5)*2.0;}\nvoid Rim_Light_B132(\nvec3 Front,\nvec3 Normal,\nvec3 Incident,\nfloat Rim_Intensity,\nsampler2D Texture,\nout vec4 Result)\n{vec3 R=reflect(Incident,Normal);float RdotF=dot(R,Front);float RdotL=sqrt(1.0-RdotF*RdotF);vec2 UV=vec2(R.y*0.5+0.5,0.5);vec4 Color=texture(Texture,UV);Result=Color;}\nvoid main()\n{vec4 Blob_Color_Q30;\n#if BLOB_ENABLE\nBlob_Fragment_B30(_Blob_Texture_,vExtra2,vExtra3,Blob_Color_Q30);\n#else\nBlob_Color_Q30=vec4(0,0,0,0);\n#endif\nvec3 Incident_Q39=normalize(vPosition-cameraPosition);vec3 Normalized_Q38=normalize(vNormal);vec3 Normalized_Q71=normalize(vTangent);vec4 Color_Q83;\n#if DECAL_ENABLE\nColor_Q83=texture(_Decal_,vUV);\n#else\nColor_Q83=vec4(0,0,0,0);\n#endif\nfloat X_Q90;float Y_Q90;float Z_Q90;float W_Q90;X_Q90=vExtra1.x;Y_Q90=vExtra1.y;Z_Q90=vExtra1.z;W_Q90=vExtra1.w;vec4 Linear_Q43;Linear_Q43.rgb=clamp(_Sky_Color_.rgb*_Sky_Color_.rgb,0.0,1.0);Linear_Q43.a=_Sky_Color_.a;vec4 Linear_Q44;Linear_Q44.rgb=clamp(_Horizon_Color_.rgb*_Horizon_Color_.rgb,0.0,1.0);Linear_Q44.a=_Horizon_Color_.a;vec4 Linear_Q45;Linear_Q45.rgb=clamp(_Ground_Color_.rgb*_Ground_Color_.rgb,0.0,1.0);Linear_Q45.a=_Ground_Color_.a;vec3 Left_Index_Q64;vec3 Right_Index_Q64;vec3 Left_Index_Middle_Q64;vec3 Right_Index_Middle_Q64;Finger_Positions_B64(_Left_Index_Pos_,_Right_Index_Pos_,_Left_Index_Middle_Pos_,_Right_Index_Middle_Pos_,Left_Index_Q64,Right_Index_Q64,Left_Index_Middle_Q64,Right_Index_Middle_Q64);vec4 Linear_Q46;Linear_Q46.rgb=clamp(_Albedo_.rgb*_Albedo_.rgb,0.0,1.0);Linear_Q46.a=_Albedo_.a;vec3 Normalized_Q107=normalize(vBinormal);vec3 Incident_Q70=normalize(vPosition-cameraPosition);vec3 New_Normal_Q79;Bulge_B79(_Bulge_Enabled_,Normalized_Q38,Normalized_Q71,_Bulge_Height_,vColor,_Bulge_Radius_,vBinormal,New_Normal_Q79);float Result_Q77;SSS_B77(vBinormal,New_Normal_Q79,Incident_Q39,Result_Q77);vec4 Result_Q91;Scale_Color_B91(Color_Q83,X_Q90,Result_Q91);float Transmit_Q122;float Reflect_Q122;Fast_Fresnel_B122(_Front_Reflect_,_Edge_Reflect_,_Power_,New_Normal_Q79,Incident_Q39,Transmit_Q122,Reflect_Q122);float Product_Q125=Y_Q90*Y_Q90;vec3 NearP_Q65;vec3 NearQ_Q65;float Distance_Q65;Min_Segment_Distance_B65(Left_Index_Q64,Left_Index_Middle_Q64,vPosition,cameraPosition,NearP_Q65,NearQ_Q65,Distance_Q65);vec3 NearP_Q63;vec3 NearQ_Q63;float Distance_Q63;Min_Segment_Distance_B65(Right_Index_Q64,Right_Index_Middle_Q64,vPosition,cameraPosition,NearP_Q63,NearQ_Q63,Distance_Q63);vec3 Reflected_Q47=reflect(Incident_Q39,New_Normal_Q79);vec4 Product_Q103=Linear_Q46*vec4(1,1,1,1);vec4 Result_Q132;Rim_Light_B132(Normalized_Q107,Normalized_Q38,Incident_Q70,_Rim_Intensity_,_Rim_Texture_,Result_Q132);float Dot_Q72=dot(Incident_Q70, Normalized_Q71);float MaxAB_Q123=max(Reflect_Q122,Product_Q125);float NotInShadow_Q67;\n#if OCCLUSION_ENABLED\nFingerOcclusion_B67(_Width_,Distance_Q65,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q65,_Clip_Fade_,NotInShadow_Q67);\n#else\nNotInShadow_Q67=1.0;\n#endif\nfloat NotInShadow_Q68;\n#if OCCLUSION_ENABLED\nFingerOcclusion_B68(_Width_,Distance_Q63,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q63,_Clip_Fade_,NotInShadow_Q68);\n#else\nNotInShadow_Q68=1.0;\n#endif\nvec4 Reflected_Color_Q51;vec4 Indirect_Diffuse_Q51;\n#if ENV_ENABLE\nMapped_Environment_B51(_Reflection_Map_,_Indirect_Environment_,Reflected_Q47,Reflected_Color_Q51,Indirect_Diffuse_Q51);\n#else\nReflected_Color_Q51=vec4(0,0,0,1);Indirect_Diffuse_Q51=vec4(0,0,0,1);\n#endif\nvec4 Reflected_Color_Q50;vec4 Indirect_Color_Q50;\n#if SKY_ENABLED\nSky_Environment_B50(New_Normal_Q79,Reflected_Q47,Linear_Q43,Linear_Q44,Linear_Q45,_Horizon_Power_,Reflected_Color_Q50,Indirect_Color_Q50);\n#else\nReflected_Color_Q50=vec4(0,0,0,1);Indirect_Color_Q50=vec4(0,0,0,1);\n#endif\nfloat Hue_Q75;float Saturation_Q75;float Value_Q75;float Alpha_Q75;vec3 HSV_Q75;To_HSV_B75(Product_Q103,Hue_Q75,Saturation_Q75,Value_Q75,Alpha_Q75,HSV_Q75);float Hue_Q127;float Saturation_Q127;float Value_Q127;float Alpha_Q127;vec3 HSV_Q127;To_HSV_B75(Result_Q132,Hue_Q127,Saturation_Q127,Value_Q127,Alpha_Q127,HSV_Q127);float Result_Q110;Code_B110(Dot_Q72,Result_Q110);float AbsA_Q76=abs(Result_Q110);float MinAB_Q58=min(NotInShadow_Q67,NotInShadow_Q68);vec4 Sum_Q48=Reflected_Color_Q51+Reflected_Color_Q50;vec4 Sum_Q49=Indirect_Diffuse_Q51+Indirect_Color_Q50;vec3 HSV_Out_Q126;VaryHSV_B108(HSV_Q127,_Rim_Hue_Shift_,_Rim_Saturation_Shift_,_Rim_Value_Shift_,HSV_Out_Q126);float Out_Q114;Remap_Range_B114(-1.0,1.0,0.0,1.0,Result_Q110,Out_Q114);float Product_Q106;Product_Q106=AbsA_Q76*_Hue_Shift_;float X_Q128;float Y_Q128;float Z_Q128;To_XYZ_B74(HSV_Out_Q126,X_Q128,Y_Q128,Z_Q128);vec2 Vec2_Q112=vec2(Out_Q114,0.5);vec3 HSV_Out_Q108;VaryHSV_B108(HSV_Q75,Product_Q106,_Saturation_Shift_,_Value_Shift_,HSV_Out_Q108);vec4 Color_Q129;From_HSV_B73(X_Q128,Y_Q128,Z_Q128,0.0,Color_Q129);vec4 Color_Q111;\n#if IRIDESCENCE_ENABLED\nColor_Q111=texture(_Iridescence_Texture_,Vec2_Q112);\n#else\nColor_Q111=vec4(0,0,0,0);\n#endif\nfloat X_Q74;float Y_Q74;float Z_Q74;To_XYZ_B74(HSV_Out_Q108,X_Q74,Y_Q74,Z_Q74);vec4 Result_Q131=_Rim_Intensity_*Color_Q129;vec4 Result_Q113=_Iridescence_Intensity_*Color_Q111;vec4 Color_Q73;From_HSV_B73(X_Q74,Y_Q74,Z_Q74,0.0,Color_Q73);vec4 Result_Q84=Result_Q91+(1.0-Result_Q91.a)*Color_Q73;vec4 Result_Q121;Fragment_Main_B121(_Sun_Intensity_,_Sun_Theta_,_Sun_Phi_,New_Normal_Q79,Result_Q84,MaxAB_Q123,_Shininess_,Incident_Q39,_Horizon_Color_,_Sky_Color_,_Ground_Color_,_Indirect_Diffuse_,_Specular_,_Horizon_Power_,_Reflection_,Sum_Q48,Sum_Q49,_Sharpness_,Result_Q77,_Subsurface_,vec4(0,0,0,0),Result_Q131,Result_Q113,Result_Q121);vec4 Result_Q59;Scale_RGB_B59(Result_Q121,MinAB_Q58,Result_Q59);vec4 sRGB_Q42;FastLinearTosRGB_B42(Result_Q59,sRGB_Q42);vec4 Result_Q31=Blob_Color_Q30+(1.0-Blob_Color_Q30.a)*sRGB_Q42;vec4 Result_Q40=Result_Q31; Result_Q40.a=1.0;vec4 Out_Color=Result_Q40;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}";Ma.l.ShadersStore.mrdlSliderBarVertexShader="uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;\n#ifdef TANGENT\nattribute vec3 tangent;\n#else\nconst vec3 tangent=vec3(0.);\n#endif\nuniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Object_To_World_Pos_B12(\nvec3 Pos_Object,\nout vec3 Pos_World)\n{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}\nvoid Object_To_World_Normal_B32(\nvec3 Nrm_Object,\nout vec3 Nrm_World)\n{Nrm_World=(vec4(Nrm_Object,0.0)).xyz;}\nvoid Blob_Vertex_B23(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nvec3 Blob_Position,\nfloat Intensity,\nfloat Blob_Near_Size,\nfloat Blob_Far_Size,\nfloat Blob_Near_Distance,\nfloat Blob_Far_Distance,\nfloat Blob_Fade_Length,\nfloat Blob_Pulse,\nfloat Blob_Fade,\nout vec4 Blob_Info)\n{vec3 blob= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}\nvoid Blob_Vertex_B24(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nvec3 Blob_Position,\nfloat Intensity,\nfloat Blob_Near_Size,\nfloat Blob_Far_Size,\nfloat Blob_Near_Distance,\nfloat Blob_Far_Distance,\nfloat Blob_Fade_Length,\nfloat Blob_Pulse,\nfloat Blob_Fade,\nout vec4 Blob_Info)\n{vec3 blob= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}\nvoid Move_Verts_B130(\nfloat Anisotropy,\nvec3 P,\nfloat Radius,\nfloat Bevel,\nvec3 Normal_Object,\nfloat ScaleZ,\nfloat Stretch,\nout vec3 New_P,\nout vec2 New_UV,\nout float Radial_Gradient,\nout vec3 Radial_Dir,\nout vec3 New_Normal)\n{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;float deltad=(length(delta)*2.0);float f=(Bevel+(Radius-Bevel)*Stretch)/Radius;float innerd=clamp(deltad*2.0,0.0,1.0);float outerd=clamp(deltad*2.0-1.0,0.0,1.0);float bevelAngle=outerd*3.14159*0.5;float sinb=sin(bevelAngle);float cosb=cos(bevelAngle);float beveld=(1.0-f)*innerd+f*sinb;float br=outerd;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);float dir=P.z<0.0001 ? 1.0 : -1.0;New_UV=center+r2*((0.5-center)+normalize(delta+vec2(0.0,0.000001))*beveld*0.5);New_P=vec3(New_UV-0.5,P.z+dir*(1.0-cosb)*Bevel*ScaleZ);Radial_Gradient=clamp((deltad-0.5)*2.0,0.0,1.0);Radial_Dir=vec3(delta*r2,0.0);vec3 beveledNormal=cosb*Normal_Object+sinb*vec3(delta.x,delta.y,0.0);New_Normal=Normal_Object.z==0.0 ? Normal_Object : beveledNormal;}\nvoid Object_To_World_Dir_B60(\nvec3 Dir_Object,\nout vec3 Normal_World,\nout vec3 Normal_World_N,\nout float Normal_Length)\n{Normal_World=(world*vec4(Dir_Object,0.0)).xyz;Normal_Length=length(Normal_World);Normal_World_N=Normal_World/Normal_Length;}\nvoid To_XYZ_B78(\nvec3 Vec3,\nout float X,\nout float Y,\nout float Z)\n{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}\nvoid Conditional_Float_B93(\nbool Which,\nfloat If_True,\nfloat If_False,\nout float Result)\n{Result=Which ? If_True : If_False;}\nvoid Object_To_World_Dir_B28(\nvec3 Dir_Object,\nout vec3 Binormal_World,\nout vec3 Binormal_World_N,\nout float Binormal_Length)\n{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}\nvoid Pick_Radius_B69(\nfloat Radius,\nfloat Radius_Top_Left,\nfloat Radius_Top_Right,\nfloat Radius_Bottom_Left,\nfloat Radius_Bottom_Right,\nvec3 Position,\nout float Result)\n{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}\nvoid Conditional_Float_B36(\nbool Which,\nfloat If_True,\nfloat If_False,\nout float Result)\n{Result=Which ? If_True : If_False;}\nvoid Greater_Than_B37(\nfloat Left,\nfloat Right,\nout bool Not_Greater_Than,\nout bool Greater_Than)\n{Greater_Than=Left>Right;Not_Greater_Than=!Greater_Than;}\nvoid Remap_Range_B105(\nfloat In_Min,\nfloat In_Max,\nfloat Out_Min,\nfloat Out_Max,\nfloat In,\nout float Out)\n{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}\nvoid main()\n{vec2 XY_Q85;XY_Q85=(uv-vec2(0.5,0.5))*_Decal_Scale_XY_+vec2(0.5,0.5);vec3 Tangent_World_Q27;vec3 Tangent_World_N_Q27;float Tangent_Length_Q27;Tangent_World_Q27=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q27=length(Tangent_World_Q27);Tangent_World_N_Q27=Tangent_World_Q27/Tangent_Length_Q27;vec3 Normal_World_Q60;vec3 Normal_World_N_Q60;float Normal_Length_Q60;Object_To_World_Dir_B60(vec3(0,0,1),Normal_World_Q60,Normal_World_N_Q60,Normal_Length_Q60);float X_Q78;float Y_Q78;float Z_Q78;To_XYZ_B78(position,X_Q78,Y_Q78,Z_Q78);vec3 Nrm_World_Q26;Nrm_World_Q26=normalize((world*vec4(normal,0.0)).xyz);vec3 Binormal_World_Q28;vec3 Binormal_World_N_Q28;float Binormal_Length_Q28;Object_To_World_Dir_B28(vec3(0,1,0),Binormal_World_Q28,Binormal_World_N_Q28,Binormal_Length_Q28);float Anisotropy_Q29=Tangent_Length_Q27/Binormal_Length_Q28;float Result_Q69;Pick_Radius_B69(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q69);float Anisotropy_Q53=Binormal_Length_Q28/Normal_Length_Q60;bool Not_Greater_Than_Q37;bool Greater_Than_Q37;Greater_Than_B37(Z_Q78,0.0,Not_Greater_Than_Q37,Greater_Than_Q37);vec4 Linear_Q101;Linear_Q101.rgb=clamp(_Left_Color_.rgb*_Left_Color_.rgb,0.0,1.0);Linear_Q101.a=_Left_Color_.a;vec4 Linear_Q102;Linear_Q102.rgb=clamp(_Right_Color_.rgb*_Right_Color_.rgb,0.0,1.0);Linear_Q102.a=_Right_Color_.a;vec3 Difference_Q61=vec3(0,0,0)-Normal_World_N_Q60;vec4 Out_Color_Q34=vec4(X_Q78,Y_Q78,Z_Q78,1);float Result_Q36;Conditional_Float_B36(Greater_Than_Q37,_Bevel_Back_,_Bevel_Front_,Result_Q36);float Result_Q94;Conditional_Float_B36(Greater_Than_Q37,_Bevel_Back_Stretch_,_Bevel_Front_Stretch_,Result_Q94);vec3 New_P_Q130;vec2 New_UV_Q130;float Radial_Gradient_Q130;vec3 Radial_Dir_Q130;vec3 New_Normal_Q130;Move_Verts_B130(Anisotropy_Q29,position,Result_Q69,Result_Q36,normal,Anisotropy_Q53,Result_Q94,New_P_Q130,New_UV_Q130,Radial_Gradient_Q130,Radial_Dir_Q130,New_Normal_Q130);float X_Q98;float Y_Q98;X_Q98=New_UV_Q130.x;Y_Q98=New_UV_Q130.y;vec3 Pos_World_Q12;Object_To_World_Pos_B12(New_P_Q130,Pos_World_Q12);vec3 Nrm_World_Q32;Object_To_World_Normal_B32(New_Normal_Q130,Nrm_World_Q32);vec4 Blob_Info_Q23;\n#if BLOB_ENABLE\nBlob_Vertex_B23(Pos_World_Q12,Nrm_World_Q26,Tangent_World_N_Q27,Binormal_World_N_Q28,_Blob_Position_,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q23);\n#else\nBlob_Info_Q23=vec4(0,0,0,0);\n#endif\nvec4 Blob_Info_Q24;\n#if BLOB_ENABLE_2\nBlob_Vertex_B24(Pos_World_Q12,Nrm_World_Q26,Tangent_World_N_Q27,Binormal_World_N_Q28,_Blob_Position_2_,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q24);\n#else\nBlob_Info_Q24=vec4(0,0,0,0);\n#endif\nfloat Out_Q105;Remap_Range_B105(0.0,1.0,0.0,1.0,X_Q98,Out_Q105);float X_Q86;float Y_Q86;float Z_Q86;To_XYZ_B78(Nrm_World_Q32,X_Q86,Y_Q86,Z_Q86);vec4 Color_At_T_Q97=mix(Linear_Q101,Linear_Q102,Out_Q105);float Minus_F_Q87=-Z_Q86;float R_Q99;float G_Q99;float B_Q99;float A_Q99;R_Q99=Color_At_T_Q97.r; G_Q99=Color_At_T_Q97.g; B_Q99=Color_At_T_Q97.b; A_Q99=Color_At_T_Q97.a;float ClampF_Q88=clamp(0.0,Minus_F_Q87,1.0);float Result_Q93;Conditional_Float_B93(_Decal_Front_Only_,ClampF_Q88,1.0,Result_Q93);vec4 Vec4_Q89=vec4(Result_Q93,Radial_Gradient_Q130,G_Q99,B_Q99);vec3 Position=Pos_World_Q12;vec3 Normal=Nrm_World_Q32;vec2 UV=XY_Q85;vec3 Tangent=Tangent_World_N_Q27;vec3 Binormal=Difference_Q61;vec4 Color=Out_Color_Q34;vec4 Extra1=Vec4_Q89;vec4 Extra2=Blob_Info_Q23;vec4 Extra3=Blob_Info_Q24;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}";class gx extends wt.M{constructor(){super(),this.SKY_ENABLED=!0,this.BLOB_ENABLE_2=!0,this.IRIDESCENCE_ENABLED=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class fx extends Ot.E{constructor(e,t){super(e,t),this.radius=.6,this.bevelFront=.6,this.bevelFrontStretch=.077,this.bevelBack=0,this.bevelBackStretch=0,this.radiusTopLeft=1,this.radiusTopRight=1,this.radiusBottomLeft=1,this.radiusBottomRight=1,this.bulgeEnabled=!1,this.bulgeHeight=-.323,this.bulgeRadius=.73,this.sunIntensity=1.102,this.sunTheta=.76,this.sunPhi=.526,this.indirectDiffuse=.658,this.albedo=new bt.ov(.0117647,.505882,.996078,1),this.specular=0,this.shininess=10,this.sharpness=0,this.subsurface=0,this.leftGradientColor=new bt.ov(.0117647,.505882,.996078,1),this.rightGradientColor=new bt.ov(.0117647,.505882,.996078,1),this.reflection=.749,this.frontReflect=0,this.edgeReflect=.09,this.power=8.13,this.skyColor=new bt.ov(.0117647,.964706,.996078,1),this.horizonColor=new bt.ov(.0117647,.333333,.996078,1),this.groundColor=new bt.ov(0,.254902,.996078,1),this.horizonPower=1,this.width=.02,this.fuzz=.5,this.minFuzz=.001,this.clipFade=.01,this.hueShift=0,this.saturationShift=0,this.valueShift=0,this.blobPosition=new gt.Pq(0,0,.1),this.blobIntensity=.5,this.blobNearSize=.01,this.blobFarSize=.03,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.576,this.blobPulse=0,this.blobFade=1,this.blobPosition2=new gt.Pq(.2,0,.1),this.blobNearSize2=.01,this.blobPulse2=0,this.blobFade2=1,this.blobTexture=new Dt.g("",this.getScene()),this.leftIndexPosition=new gt.Pq(0,0,1),this.rightIndexPosition=new gt.Pq(-1,-1,-1),this.leftIndexMiddlePosition=new gt.Pq(0,0,0),this.rightIndexMiddlePosition=new gt.Pq(0,0,0),this.decalScaleXY=new gt.I9(1.5,1.5),this.decalFrontOnly=!0,this.rimIntensity=.287,this.rimHueShift=0,this.rimSaturationShift=0,this.rimValueShift=-1,this.iridescenceIntensity=0,this.useGlobalLeftIndex=1,this.useGlobalRightIndex=1,this.globalLeftIndexTipProximity=0,this.globalRightIndexTipProximity=0,this.globalLeftIndexTipPosition=new gt.IU(.5,0,-.55,1),this.globaRightIndexTipPosition=new gt.IU(0,0,0,1),this.globalLeftThumbTipPosition=new gt.IU(.5,0,-.55,1),this.globalRightThumbTipPosition=new gt.IU(0,0,0,1),this.globalLeftIndexMiddlePosition=new gt.IU(.5,0,-.55,1),this.globalRightIndexMiddlePosition=new gt.IU(0,0,0,1),this.alphaMode=ui.Y.ALPHA_DISABLE,this.backFaceCulling=!1;const i=$i.S0.GetAssetUrl(fx.BLUE_GRADIENT_TEXTURE_URL);this._blueGradientTexture=new Dt.g(i,this.getScene(),!0,!1,Dt.g.NEAREST_SAMPLINGMODE),this._decalTexture=new Dt.g("",this.getScene()),this._reflectionMapTexture=new Dt.g("",this.getScene()),this._indirectEnvTexture=new Dt.g("",this.getScene())}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new gx);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;const n=r.getEngine();if((0,Ut.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const e=new Nt.J;s.FOG&&e.addFallback(1,"FOG"),(0,Ut.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;const i=[Mt.R.PositionKind];s.NORMAL&&i.push(Mt.R.NormalKind),s.UV1&&i.push(Mt.R.UVKind),s.UV2&&i.push(Mt.R.UV2Kind),s.VERTEXCOLOR&&i.push(Mt.R.ColorKind),s.TANGENT&&i.push(Mt.R.TangentKind),(0,Ut.ER)(i,s);const o="mrdlSliderBar",a=s.toString(),h=["world","viewProjection","cameraPosition","_Radius_","_Bevel_Front_","_Bevel_Front_Stretch_","_Bevel_Back_","_Bevel_Back_Stretch_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Bulge_Enabled_","_Bulge_Height_","_Bulge_Radius_","_Sun_Intensity_","_Sun_Theta_","_Sun_Phi_","_Indirect_Diffuse_","_Albedo_","_Specular_","_Shininess_","_Sharpness_","_Subsurface_","_Left_Color_","_Right_Color_","_Reflection_","_Front_Reflect_","_Edge_Reflect_","_Power_","_Sky_Color_","_Horizon_Color_","_Ground_Color_","_Horizon_Power_","_Reflection_Map_","_Indirect_Environment_","_Width_","_Fuzz_","_Min_Fuzz_","_Clip_Fade_","_Hue_Shift_","_Saturation_Shift_","_Value_Shift_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Left_Index_Pos_","_Right_Index_Pos_","_Left_Index_Middle_Pos_","_Right_Index_Middle_Pos_","_Decal_","_Decal_Scale_XY_","_Decal_Front_Only_","_Rim_Intensity_","_Rim_Texture_","_Rim_Hue_Shift_","_Rim_Saturation_Shift_","_Rim_Value_Shift_","_Iridescence_Intensity_","_Iridescence_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Middle_Position;","Global_Right_Index_Middle_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],l=["_Rim_Texture_","_Iridescence_Texture_"],c=[];(0,Ut.Bb)({uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect(o,{attributes:i,uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),s,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,0))}bindForSubMesh(e,t,i){if(!i.materialDefines)return;const s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Bevel_Front_",this.bevelFront),this._activeEffect.setFloat("_Bevel_Front_Stretch_",this.bevelFrontStretch),this._activeEffect.setFloat("_Bevel_Back_",this.bevelBack),this._activeEffect.setFloat("_Bevel_Back_Stretch_",this.bevelBackStretch),this._activeEffect.setFloat("_Radius_Top_Left_",this.radiusTopLeft),this._activeEffect.setFloat("_Radius_Top_Right_",this.radiusTopRight),this._activeEffect.setFloat("_Radius_Bottom_Left_",this.radiusBottomLeft),this._activeEffect.setFloat("_Radius_Bottom_Right_",this.radiusBottomRight),this._activeEffect.setFloat("_Bulge_Enabled_",this.bulgeEnabled?1:0),this._activeEffect.setFloat("_Bulge_Height_",this.bulgeHeight),this._activeEffect.setFloat("_Bulge_Radius_",this.bulgeRadius),this._activeEffect.setFloat("_Sun_Intensity_",this.sunIntensity),this._activeEffect.setFloat("_Sun_Theta_",this.sunTheta),this._activeEffect.setFloat("_Sun_Phi_",this.sunPhi),this._activeEffect.setFloat("_Indirect_Diffuse_",this.indirectDiffuse),this._activeEffect.setDirectColor4("_Albedo_",this.albedo),this._activeEffect.setFloat("_Specular_",this.specular),this._activeEffect.setFloat("_Shininess_",this.shininess),this._activeEffect.setFloat("_Sharpness_",this.sharpness),this._activeEffect.setFloat("_Subsurface_",this.subsurface),this._activeEffect.setDirectColor4("_Left_Color_",this.leftGradientColor),this._activeEffect.setDirectColor4("_Right_Color_",this.rightGradientColor),this._activeEffect.setFloat("_Reflection_",this.reflection),this._activeEffect.setFloat("_Front_Reflect_",this.frontReflect),this._activeEffect.setFloat("_Edge_Reflect_",this.edgeReflect),this._activeEffect.setFloat("_Power_",this.power),this._activeEffect.setDirectColor4("_Sky_Color_",this.skyColor),this._activeEffect.setDirectColor4("_Horizon_Color_",this.horizonColor),this._activeEffect.setDirectColor4("_Ground_Color_",this.groundColor),this._activeEffect.setFloat("_Horizon_Power_",this.horizonPower),this._activeEffect.setTexture("_Reflection_Map_",this._reflectionMapTexture),this._activeEffect.setTexture("_Indirect_Environment_",this._indirectEnvTexture),this._activeEffect.setFloat("_Width_",this.width),this._activeEffect.setFloat("_Fuzz_",this.fuzz),this._activeEffect.setFloat("_Min_Fuzz_",this.minFuzz),this._activeEffect.setFloat("_Clip_Fade_",this.clipFade),this._activeEffect.setFloat("_Hue_Shift_",this.hueShift),this._activeEffect.setFloat("_Saturation_Shift_",this.saturationShift),this._activeEffect.setFloat("_Value_Shift_",this.valueShift),this._activeEffect.setVector3("_Blob_Position_",this.blobPosition),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this.blobTexture),this._activeEffect.setVector3("_Blob_Position_2_",this.blobPosition2),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setVector3("_Left_Index_Pos_",this.leftIndexPosition),this._activeEffect.setVector3("_Right_Index_Pos_",this.rightIndexPosition),this._activeEffect.setVector3("_Left_Index_Middle_Pos_",this.leftIndexMiddlePosition),this._activeEffect.setVector3("_Right_Index_Middle_Pos_",this.rightIndexMiddlePosition),this._activeEffect.setTexture("_Decal_",this._decalTexture),this._activeEffect.setVector2("_Decal_Scale_XY_",this.decalScaleXY),this._activeEffect.setFloat("_Decal_Front_Only_",this.decalFrontOnly?1:0),this._activeEffect.setFloat("_Rim_Intensity_",this.rimIntensity),this._activeEffect.setTexture("_Rim_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("_Rim_Hue_Shift_",this.rimHueShift),this._activeEffect.setFloat("_Rim_Saturation_Shift_",this.rimSaturationShift),this._activeEffect.setFloat("_Rim_Value_Shift_",this.rimValueShift),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setTexture("_Iridescence_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("Use_Global_Left_Index",this.useGlobalLeftIndex),this._activeEffect.setFloat("Use_Global_Right_Index",this.useGlobalRightIndex),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this.globalLeftIndexTipPosition),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this.globaRightIndexTipPosition),this._activeEffect.setVector4("Global_Left_Thumb_Tip_Position",this.globalLeftThumbTipPosition),this._activeEffect.setVector4("Global_Right_Thumb_Tip_Position",this.globalRightThumbTipPosition),this._activeEffect.setVector4("Global_Left_Index_Middle_Position",this.globalLeftIndexMiddlePosition),this._activeEffect.setVector4("Global_Right_Index_Middle_Position",this.globalRightIndexMiddlePosition),this._activeEffect.setFloat("Global_Left_Index_Tip_Proximity",this.globalLeftIndexTipProximity),this._activeEffect.setFloat("Global_Right_Index_Tip_Proximity",this.globalRightIndexTipProximity),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e),this._reflectionMapTexture.dispose(),this._indirectEnvTexture.dispose(),this._blueGradientTexture.dispose(),this._decalTexture.dispose()}clone(e){return Vt.p.Clone((()=>new fx(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.MRDLSliderBarMaterial",e}getClassName(){return"MRDLSliderBarMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new fx(e.name,t)),e,t,i)}}fx.BLUE_GRADIENT_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/MRDL/mrtk-mrdl-blue-gradient.png",(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"radius",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"bevelFront",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"bevelFrontStretch",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"bevelBack",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"bevelBackStretch",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"radiusTopLeft",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"radiusTopRight",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"radiusBottomLeft",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"radiusBottomRight",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"bulgeEnabled",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"bulgeHeight",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"bulgeRadius",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"sunIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"sunTheta",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"sunPhi",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"indirectDiffuse",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"albedo",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"specular",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"shininess",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"sharpness",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"subsurface",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"leftGradientColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"rightGradientColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"reflection",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"frontReflect",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"edgeReflect",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"power",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"skyColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"horizonColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"groundColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"horizonPower",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"width",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"fuzz",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"minFuzz",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"clipFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"hueShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"saturationShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"valueShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobPosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobNearSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobFarSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobNearDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobFarDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobFadeLength",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobPulse",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobPosition2",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobNearSize2",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobPulse2",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobFade2",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"blobTexture",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"leftIndexPosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"rightIndexPosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"leftIndexMiddlePosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"rightIndexMiddlePosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"decalScaleXY",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"decalFrontOnly",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"rimIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"rimHueShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"rimSaturationShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"rimValueShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],fx.prototype,"iridescenceIntensity",void 0),(0,Ft.Y5)("BABYLON.GUI.MRDLSliderBarMaterial",fx);Ma.l.ShadersStore.mrdlSliderThumbPixelShader="uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform vec4 Global_Left_Index_Middle_Position;uniform vec4 Global_Right_Index_Middle_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;void Blob_Fragment_B180(\nsampler2D Blob_Texture,\nvec4 Blob_Info1,\nvec4 Blob_Info2,\nout vec4 Blob_Color)\n{float k1=dot(Blob_Info1.xy,Blob_Info1.xy);float k2=dot(Blob_Info2.xy,Blob_Info2.xy);vec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);Blob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);}\nvoid FastLinearTosRGB_B192(\nvec4 Linear,\nout vec4 sRGB)\n{sRGB.rgb=sqrt(clamp(Linear.rgb,0.0,1.0));sRGB.a=Linear.a;}\nvoid Scale_RGB_B209(\nvec4 Color,\nfloat Scalar,\nout vec4 Result)\n{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}\nvoid Fragment_Main_B271(\nfloat Sun_Intensity,\nfloat Sun_Theta,\nfloat Sun_Phi,\nvec3 Normal,\nvec4 Albedo,\nfloat Fresnel_Reflect,\nfloat Shininess,\nvec3 Incident,\nvec4 Horizon_Color,\nvec4 Sky_Color,\nvec4 Ground_Color,\nfloat Indirect_Diffuse,\nfloat Specular,\nfloat Horizon_Power,\nfloat Reflection,\nvec4 Reflection_Sample,\nvec4 Indirect_Sample,\nfloat Sharpness,\nfloat SSS,\nfloat Subsurface,\nvec4 Translucence,\nvec4 Rim_Light,\nvec4 Iridescence,\nout vec4 Result)\n{float theta=Sun_Theta*2.0*3.14159;float phi=Sun_Phi*3.14159;vec3 lightDir= vec3(cos(phi)*cos(theta),sin(phi),cos(phi)*sin(theta));float NdotL=max(dot(lightDir,Normal),0.0);vec3 R=reflect(Incident,Normal);float RdotL=max(0.0,dot(R,lightDir));float specular=pow(RdotL,Shininess);specular=mix(specular,smoothstep(0.495*Sharpness,1.0-0.495*Sharpness,specular),Sharpness);vec4 gi=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);Result=((Sun_Intensity*NdotL+Indirect_Sample*Indirect_Diffuse+Translucence)*(1.0+SSS*Subsurface))*Albedo*(1.0-Fresnel_Reflect)+(Sun_Intensity*specular*Specular+Fresnel_Reflect*Reflection*Reflection_Sample)+Fresnel_Reflect*Rim_Light+Iridescence;}\nvoid Bulge_B229(\nbool Enabled,\nvec3 Normal,\nvec3 Tangent,\nfloat Bulge_Height,\nvec4 UV,\nfloat Bulge_Radius,\nvec3 ButtonN,\nout vec3 New_Normal)\n{vec2 xy=clamp(UV.xy*2.0,vec2(-1,-1),vec2(1,1));vec3 B=(cross(Normal,Tangent));float k=-clamp(1.0-length(xy)/Bulge_Radius,0.0,1.0)*Bulge_Height;k=sin(k*3.14159*0.5);k*=smoothstep(0.9998,0.9999,abs(dot(ButtonN,Normal)));New_Normal=Normal*sqrt(1.0-k*k)+(xy.x*Tangent+xy.y*B)*k;New_Normal=Enabled ? New_Normal : Normal;}\nvoid SSS_B227(\nvec3 ButtonN,\nvec3 Normal,\nvec3 Incident,\nout float Result)\n{float NdotI=abs(dot(Normal,Incident));float BdotI=abs(dot(ButtonN,Incident));Result=(abs(NdotI-BdotI)); }\nvoid FingerOcclusion_B217(\nfloat Width,\nfloat DistToCenter,\nfloat Fuzz,\nfloat Min_Fuzz,\nvec3 Position,\nvec3 Forward,\nvec3 Nearest,\nfloat Fade_Out,\nout float NotInShadow)\n{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}\nvoid FingerOcclusion_B218(\nfloat Width,\nfloat DistToCenter,\nfloat Fuzz,\nfloat Min_Fuzz,\nvec3 Position,\nvec3 Forward,\nvec3 Nearest,\nfloat Fade_Out,\nout float NotInShadow)\n{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}\nvoid Scale_Color_B241(\nvec4 Color,\nfloat Scalar,\nout vec4 Result)\n{Result=Scalar*Color;}\nvoid From_HSV_B223(\nfloat Hue,\nfloat Saturation,\nfloat Value,\nfloat Alpha,\nout vec4 Color)\n{vec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(vec3(Hue,Hue,Hue)+K.xyz)*6.0-K.www);Color.rgb=Value*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),Saturation);Color.a=Alpha;}\nvoid Fast_Fresnel_B272(\nfloat Front_Reflect,\nfloat Edge_Reflect,\nfloat Power,\nvec3 Normal,\nvec3 Incident,\nout float Transmit,\nout float Reflect)\n{float d=max(-dot(Incident,Normal),0.0);Reflect=Front_Reflect+(Edge_Reflect-Front_Reflect)*pow(1.0-d,Power);Transmit=1.0-Reflect;}\nvoid Mapped_Environment_B201(\nsampler2D Reflected_Environment,\nsampler2D Indirect_Environment,\nvec3 Dir,\nout vec4 Reflected_Color,\nout vec4 Indirect_Diffuse)\n{Reflected_Color=texture(Reflected_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));Indirect_Diffuse=texture(Indirect_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));}\nvec4 SampleEnv_Bid200(vec3 D,vec4 S,vec4 H,vec4 G,float exponent)\n{float k=pow(abs(D.y),exponent);vec4 C;if (D.y>0.0) {C=mix(H,S,k);} else {C=mix(H,G,k); }\nreturn C;}\nvoid Sky_Environment_B200(\nvec3 Normal,\nvec3 Reflected,\nvec4 Sky_Color,\nvec4 Horizon_Color,\nvec4 Ground_Color,\nfloat Horizon_Power,\nout vec4 Reflected_Color,\nout vec4 Indirect_Color)\n{Reflected_Color=SampleEnv_Bid200(Reflected,Sky_Color,Horizon_Color,Ground_Color,Horizon_Power);Indirect_Color=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);}\nvoid Min_Segment_Distance_B215(\nvec3 P0,\nvec3 P1,\nvec3 Q0,\nvec3 Q1,\nout vec3 NearP,\nout vec3 NearQ,\nout float Distance)\n{vec3 u=P1-P0;vec3 v=Q1-Q0;vec3 w=P0-Q0;float a=dot(u,u);float b=dot(u,v);float c=dot(v,v);float d=dot(u,w);float e=dot(v,w);float D=a*c-b*b;float sD=D;float tD=D;float sc,sN,tc,tN;if (D<0.00001) {sN=0.0;sD=1.0;tN=e;tD=c;} else {sN=(b*e-c*d);tN=(a*e-b*d);if (sN<0.0) {sN=0.0;tN=e;tD=c;} else if (sN>sD) {sN=sD;tN=e+b;tD=c;}}\nif (tN<0.0) {tN=0.0;if (-d<0.0) {sN=0.0;} else if (-d>a) {sN=sD;} else {sN=-d;sD=a;}} else if (tN>tD) {tN=tD;if ((-d+b)<0.0) {sN=0.0;} else if ((-d+b)>a) {sN=sD;} else {sN=(-d+b);sD=a;}}\nsc=abs(sN)<0.000001 ? 0.0 : sN/sD;tc=abs(tN)<0.000001 ? 0.0 : tN/tD;NearP=P0+sc*u;NearQ=Q0+tc*v;Distance=distance(NearP,NearQ);}\nvoid To_XYZ_B224(\nvec3 Vec3,\nout float X,\nout float Y,\nout float Z)\n{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}\nvoid Finger_Positions_B214(\nvec3 Left_Index_Pos,\nvec3 Right_Index_Pos,\nvec3 Left_Index_Middle_Pos,\nvec3 Right_Index_Middle_Pos,\nout vec3 Left_Index,\nout vec3 Right_Index,\nout vec3 Left_Index_Middle,\nout vec3 Right_Index_Middle)\n{Left_Index= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Left_Index_Pos);Right_Index= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Right_Index_Pos);Left_Index_Middle= (Use_Global_Left_Index ? Global_Left_Index_Middle_Position.xyz : Left_Index_Middle_Pos);Right_Index_Middle= (Use_Global_Right_Index ? Global_Right_Index_Middle_Position.xyz : Right_Index_Middle_Pos);}\nvoid VaryHSV_B258(\nvec3 HSV_In,\nfloat Hue_Shift,\nfloat Saturation_Shift,\nfloat Value_Shift,\nout vec3 HSV_Out)\n{HSV_Out=vec3(fract(HSV_In.x+Hue_Shift),clamp(HSV_In.y+Saturation_Shift,0.0,1.0),clamp(HSV_In.z+Value_Shift,0.0,1.0));}\nvoid Remap_Range_B264(\nfloat In_Min,\nfloat In_Max,\nfloat Out_Min,\nfloat Out_Max,\nfloat In,\nout float Out)\n{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}\nvoid To_HSV_B225(\nvec4 Color,\nout float Hue,\nout float Saturation,\nout float Value,\nout float Alpha,\nout vec3 HSV)\n{vec4 K=vec4(0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=Color.g<Color.b ? vec4(Color.bg,K.wz) : vec4(Color.gb,K.xy);vec4 q=Color.r<p.x ? vec4(p.xyw,Color.r) : vec4(Color.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;Hue=abs(q.z+(q.w-q.y)/(6.0*d+e));Saturation=d/(q.x+e);Value=q.x;Alpha=Color.a;HSV=vec3(Hue,Saturation,Value);}\nvoid Code_B260(\nfloat X,\nout float Result)\n{Result=(acos(X)/3.14159-0.5)*2.0;}\nvoid Rim_Light_B282(\nvec3 Front,\nvec3 Normal,\nvec3 Incident,\nfloat Rim_Intensity,\nsampler2D Texture,\nout vec4 Result)\n{vec3 R=reflect(Incident,Normal);float RdotF=dot(R,Front);float RdotL=sqrt(1.0-RdotF*RdotF);vec2 UV=vec2(R.y*0.5+0.5,0.5);vec4 Color=texture(Texture,UV);Result=Color;}\nvoid main()\n{vec4 Blob_Color_Q180;\n#if BLOB_ENABLE\nBlob_Fragment_B180(_Blob_Texture_,vExtra2,vExtra3,Blob_Color_Q180);\n#else\nBlob_Color_Q180=vec4(0,0,0,0);\n#endif\nvec3 Incident_Q189=normalize(vPosition-cameraPosition);vec3 Normalized_Q188=normalize(vNormal);vec3 Normalized_Q221=normalize(vTangent);vec4 Color_Q233;\n#if DECAL_ENABLE\nColor_Q233=texture(_Decal_,vUV);\n#else\nColor_Q233=vec4(0,0,0,0);\n#endif\nfloat X_Q240;float Y_Q240;float Z_Q240;float W_Q240;X_Q240=vExtra1.x;Y_Q240=vExtra1.y;Z_Q240=vExtra1.z;W_Q240=vExtra1.w;vec4 Linear_Q193;Linear_Q193.rgb=clamp(_Sky_Color_.rgb*_Sky_Color_.rgb,0.0,1.0);Linear_Q193.a=_Sky_Color_.a;vec4 Linear_Q194;Linear_Q194.rgb=clamp(_Horizon_Color_.rgb*_Horizon_Color_.rgb,0.0,1.0);Linear_Q194.a=_Horizon_Color_.a;vec4 Linear_Q195;Linear_Q195.rgb=clamp(_Ground_Color_.rgb*_Ground_Color_.rgb,0.0,1.0);Linear_Q195.a=_Ground_Color_.a;vec3 Left_Index_Q214;vec3 Right_Index_Q214;vec3 Left_Index_Middle_Q214;vec3 Right_Index_Middle_Q214;Finger_Positions_B214(_Left_Index_Pos_,_Right_Index_Pos_,_Left_Index_Middle_Pos_,_Right_Index_Middle_Pos_,Left_Index_Q214,Right_Index_Q214,Left_Index_Middle_Q214,Right_Index_Middle_Q214);vec4 Linear_Q196;Linear_Q196.rgb=clamp(_Albedo_.rgb*_Albedo_.rgb,0.0,1.0);Linear_Q196.a=_Albedo_.a;vec3 Normalized_Q257=normalize(vBinormal);vec3 Incident_Q220=normalize(vPosition-cameraPosition);vec3 New_Normal_Q229;Bulge_B229(_Bulge_Enabled_,Normalized_Q188,Normalized_Q221,_Bulge_Height_,vColor,_Bulge_Radius_,vBinormal,New_Normal_Q229);float Result_Q227;SSS_B227(vBinormal,New_Normal_Q229,Incident_Q189,Result_Q227);vec4 Result_Q241;Scale_Color_B241(Color_Q233,X_Q240,Result_Q241);float Transmit_Q272;float Reflect_Q272;Fast_Fresnel_B272(_Front_Reflect_,_Edge_Reflect_,_Power_,New_Normal_Q229,Incident_Q189,Transmit_Q272,Reflect_Q272);float Product_Q275=Y_Q240*Y_Q240;vec3 NearP_Q215;vec3 NearQ_Q215;float Distance_Q215;Min_Segment_Distance_B215(Left_Index_Q214,Left_Index_Middle_Q214,vPosition,cameraPosition,NearP_Q215,NearQ_Q215,Distance_Q215);vec3 NearP_Q213;vec3 NearQ_Q213;float Distance_Q213;Min_Segment_Distance_B215(Right_Index_Q214,Right_Index_Middle_Q214,vPosition,cameraPosition,NearP_Q213,NearQ_Q213,Distance_Q213);vec3 Reflected_Q197=reflect(Incident_Q189,New_Normal_Q229);vec4 Product_Q253=Linear_Q196*vec4(1,1,1,1);vec4 Result_Q282;Rim_Light_B282(Normalized_Q257,Normalized_Q188,Incident_Q220,_Rim_Intensity_,_Rim_Texture_,Result_Q282);float Dot_Q222=dot(Incident_Q220, Normalized_Q221);float MaxAB_Q273=max(Reflect_Q272,Product_Q275);float NotInShadow_Q217;\n#if OCCLUSION_ENABLED\nFingerOcclusion_B217(_Width_,Distance_Q215,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q215,_Clip_Fade_,NotInShadow_Q217);\n#else\nNotInShadow_Q217=1.0;\n#endif\nfloat NotInShadow_Q218;\n#if OCCLUSION_ENABLED\nFingerOcclusion_B218(_Width_,Distance_Q213,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q213,_Clip_Fade_,NotInShadow_Q218);\n#else\nNotInShadow_Q218=1.0;\n#endif\nvec4 Reflected_Color_Q201;vec4 Indirect_Diffuse_Q201;\n#if ENV_ENABLE\nMapped_Environment_B201(_Reflection_Map_,_Indirect_Environment_,Reflected_Q197,Reflected_Color_Q201,Indirect_Diffuse_Q201);\n#else\nReflected_Color_Q201=vec4(0,0,0,1);Indirect_Diffuse_Q201=vec4(0,0,0,1);\n#endif\nvec4 Reflected_Color_Q200;vec4 Indirect_Color_Q200;\n#if SKY_ENABLED\nSky_Environment_B200(New_Normal_Q229,Reflected_Q197,Linear_Q193,Linear_Q194,Linear_Q195,_Horizon_Power_,Reflected_Color_Q200,Indirect_Color_Q200);\n#else\nReflected_Color_Q200=vec4(0,0,0,1);Indirect_Color_Q200=vec4(0,0,0,1);\n#endif\nfloat Hue_Q225;float Saturation_Q225;float Value_Q225;float Alpha_Q225;vec3 HSV_Q225;To_HSV_B225(Product_Q253,Hue_Q225,Saturation_Q225,Value_Q225,Alpha_Q225,HSV_Q225);float Hue_Q277;float Saturation_Q277;float Value_Q277;float Alpha_Q277;vec3 HSV_Q277;To_HSV_B225(Result_Q282,Hue_Q277,Saturation_Q277,Value_Q277,Alpha_Q277,HSV_Q277);float Result_Q260;Code_B260(Dot_Q222,Result_Q260);float AbsA_Q226=abs(Result_Q260);float MinAB_Q208=min(NotInShadow_Q217,NotInShadow_Q218);vec4 Sum_Q198=Reflected_Color_Q201+Reflected_Color_Q200;vec4 Sum_Q199=Indirect_Diffuse_Q201+Indirect_Color_Q200;vec3 HSV_Out_Q276;VaryHSV_B258(HSV_Q277,_Rim_Hue_Shift_,_Rim_Saturation_Shift_,_Rim_Value_Shift_,HSV_Out_Q276);float Out_Q264;Remap_Range_B264(-1.0,1.0,0.0,1.0,Result_Q260,Out_Q264);float Product_Q256;Product_Q256=AbsA_Q226*_Hue_Shift_;float X_Q278;float Y_Q278;float Z_Q278;To_XYZ_B224(HSV_Out_Q276,X_Q278,Y_Q278,Z_Q278);vec2 Vec2_Q262=vec2(Out_Q264,0.5);vec3 HSV_Out_Q258;VaryHSV_B258(HSV_Q225,Product_Q256,_Saturation_Shift_,_Value_Shift_,HSV_Out_Q258);vec4 Color_Q279;From_HSV_B223(X_Q278,Y_Q278,Z_Q278,0.0,Color_Q279);vec4 Color_Q261;\n#if IRIDESCENCE_ENABLED\nColor_Q261=texture(_Iridescence_Texture_,Vec2_Q262);\n#else\nColor_Q261=vec4(0,0,0,0);\n#endif\nfloat X_Q224;float Y_Q224;float Z_Q224;To_XYZ_B224(HSV_Out_Q258,X_Q224,Y_Q224,Z_Q224);vec4 Result_Q281=_Rim_Intensity_*Color_Q279;vec4 Result_Q263=_Iridescence_Intensity_*Color_Q261;vec4 Color_Q223;From_HSV_B223(X_Q224,Y_Q224,Z_Q224,0.0,Color_Q223);vec4 Result_Q234=Result_Q241+(1.0-Result_Q241.a)*Color_Q223;vec4 Result_Q271;Fragment_Main_B271(_Sun_Intensity_,_Sun_Theta_,_Sun_Phi_,New_Normal_Q229,Result_Q234,MaxAB_Q273,_Shininess_,Incident_Q189,_Horizon_Color_,_Sky_Color_,_Ground_Color_,_Indirect_Diffuse_,_Specular_,_Horizon_Power_,_Reflection_,Sum_Q198,Sum_Q199,_Sharpness_,Result_Q227,_Subsurface_,vec4(0,0,0,0),Result_Q281,Result_Q263,Result_Q271);vec4 Result_Q209;Scale_RGB_B209(Result_Q271,MinAB_Q208,Result_Q209);vec4 sRGB_Q192;FastLinearTosRGB_B192(Result_Q209,sRGB_Q192);vec4 Result_Q181=Blob_Color_Q180+(1.0-Blob_Color_Q180.a)*sRGB_Q192;vec4 Result_Q190=Result_Q181; Result_Q190.a=1.0;vec4 Out_Color=Result_Q190;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}";Ma.l.ShadersStore.mrdlSliderThumbVertexShader="uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;\n#ifdef TANGENT\nattribute vec3 tangent;\n#else\nconst vec3 tangent=vec3(0.);\n#endif\nuniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Object_To_World_Pos_B162(\nvec3 Pos_Object,\nout vec3 Pos_World)\n{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}\nvoid Object_To_World_Normal_B182(\nvec3 Nrm_Object,\nout vec3 Nrm_World)\n{Nrm_World=(vec4(Nrm_Object,0.0)).xyz;}\nvoid Blob_Vertex_B173(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nvec3 Blob_Position,\nfloat Intensity,\nfloat Blob_Near_Size,\nfloat Blob_Far_Size,\nfloat Blob_Near_Distance,\nfloat Blob_Far_Distance,\nfloat Blob_Fade_Length,\nfloat Blob_Pulse,\nfloat Blob_Fade,\nout vec4 Blob_Info)\n{vec3 blob= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}\nvoid Blob_Vertex_B174(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nvec3 Blob_Position,\nfloat Intensity,\nfloat Blob_Near_Size,\nfloat Blob_Far_Size,\nfloat Blob_Near_Distance,\nfloat Blob_Far_Distance,\nfloat Blob_Fade_Length,\nfloat Blob_Pulse,\nfloat Blob_Fade,\nout vec4 Blob_Info)\n{vec3 blob= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}\nvoid Move_Verts_B280(\nfloat Anisotropy,\nvec3 P,\nfloat Radius,\nfloat Bevel,\nvec3 Normal_Object,\nfloat ScaleZ,\nfloat Stretch,\nout vec3 New_P,\nout vec2 New_UV,\nout float Radial_Gradient,\nout vec3 Radial_Dir,\nout vec3 New_Normal)\n{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;float deltad=(length(delta)*2.0);float f=(Bevel+(Radius-Bevel)*Stretch)/Radius;float innerd=clamp(deltad*2.0,0.0,1.0);float outerd=clamp(deltad*2.0-1.0,0.0,1.0);float bevelAngle=outerd*3.14159*0.5;float sinb=sin(bevelAngle);float cosb=cos(bevelAngle);float beveld=(1.0-f)*innerd+f*sinb;float br=outerd;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);float dir=P.z<0.0001 ? 1.0 : -1.0;New_UV=center+r2*((0.5-center)+normalize(delta+vec2(0.0,0.000001))*beveld*0.5);New_P=vec3(New_UV-0.5,P.z+dir*(1.0-cosb)*Bevel*ScaleZ);Radial_Gradient=clamp((deltad-0.5)*2.0,0.0,1.0);Radial_Dir=vec3(delta*r2,0.0);vec3 beveledNormal=cosb*Normal_Object+sinb*vec3(delta.x,delta.y,0.0);New_Normal=Normal_Object.z==0.0 ? Normal_Object : beveledNormal;}\nvoid Object_To_World_Dir_B210(\nvec3 Dir_Object,\nout vec3 Normal_World,\nout vec3 Normal_World_N,\nout float Normal_Length)\n{Normal_World=(world*vec4(Dir_Object,0.0)).xyz;Normal_Length=length(Normal_World);Normal_World_N=Normal_World/Normal_Length;}\nvoid To_XYZ_B228(\nvec3 Vec3,\nout float X,\nout float Y,\nout float Z)\n{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}\nvoid Conditional_Float_B243(\nbool Which,\nfloat If_True,\nfloat If_False,\nout float Result)\n{Result=Which ? If_True : If_False;}\nvoid Object_To_World_Dir_B178(\nvec3 Dir_Object,\nout vec3 Binormal_World,\nout vec3 Binormal_World_N,\nout float Binormal_Length)\n{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}\nvoid Pick_Radius_B219(\nfloat Radius,\nfloat Radius_Top_Left,\nfloat Radius_Top_Right,\nfloat Radius_Bottom_Left,\nfloat Radius_Bottom_Right,\nvec3 Position,\nout float Result)\n{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}\nvoid Conditional_Float_B186(\nbool Which,\nfloat If_True,\nfloat If_False,\nout float Result)\n{Result=Which ? If_True : If_False;}\nvoid Greater_Than_B187(\nfloat Left,\nfloat Right,\nout bool Not_Greater_Than,\nout bool Greater_Than)\n{Greater_Than=Left>Right;Not_Greater_Than=!Greater_Than;}\nvoid Remap_Range_B255(\nfloat In_Min,\nfloat In_Max,\nfloat Out_Min,\nfloat Out_Max,\nfloat In,\nout float Out)\n{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}\nvoid main()\n{vec2 XY_Q235;XY_Q235=(uv-vec2(0.5,0.5))*_Decal_Scale_XY_+vec2(0.5,0.5);vec3 Tangent_World_Q177;vec3 Tangent_World_N_Q177;float Tangent_Length_Q177;Tangent_World_Q177=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q177=length(Tangent_World_Q177);Tangent_World_N_Q177=Tangent_World_Q177/Tangent_Length_Q177;vec3 Normal_World_Q210;vec3 Normal_World_N_Q210;float Normal_Length_Q210;Object_To_World_Dir_B210(vec3(0,0,1),Normal_World_Q210,Normal_World_N_Q210,Normal_Length_Q210);float X_Q228;float Y_Q228;float Z_Q228;To_XYZ_B228(position,X_Q228,Y_Q228,Z_Q228);vec3 Nrm_World_Q176;Nrm_World_Q176=normalize((world*vec4(normal,0.0)).xyz);vec3 Binormal_World_Q178;vec3 Binormal_World_N_Q178;float Binormal_Length_Q178;Object_To_World_Dir_B178(vec3(0,1,0),Binormal_World_Q178,Binormal_World_N_Q178,Binormal_Length_Q178);float Anisotropy_Q179=Tangent_Length_Q177/Binormal_Length_Q178;float Result_Q219;Pick_Radius_B219(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q219);float Anisotropy_Q203=Binormal_Length_Q178/Normal_Length_Q210;bool Not_Greater_Than_Q187;bool Greater_Than_Q187;Greater_Than_B187(Z_Q228,0.0,Not_Greater_Than_Q187,Greater_Than_Q187);vec4 Linear_Q251;Linear_Q251.rgb=clamp(_Left_Color_.rgb*_Left_Color_.rgb,0.0,1.0);Linear_Q251.a=_Left_Color_.a;vec4 Linear_Q252;Linear_Q252.rgb=clamp(_Right_Color_.rgb*_Right_Color_.rgb,0.0,1.0);Linear_Q252.a=_Right_Color_.a;vec3 Difference_Q211=vec3(0,0,0)-Normal_World_N_Q210;vec4 Out_Color_Q184=vec4(X_Q228,Y_Q228,Z_Q228,1);float Result_Q186;Conditional_Float_B186(Greater_Than_Q187,_Bevel_Back_,_Bevel_Front_,Result_Q186);float Result_Q244;Conditional_Float_B186(Greater_Than_Q187,_Bevel_Back_Stretch_,_Bevel_Front_Stretch_,Result_Q244);vec3 New_P_Q280;vec2 New_UV_Q280;float Radial_Gradient_Q280;vec3 Radial_Dir_Q280;vec3 New_Normal_Q280;Move_Verts_B280(Anisotropy_Q179,position,Result_Q219,Result_Q186,normal,Anisotropy_Q203,Result_Q244,New_P_Q280,New_UV_Q280,Radial_Gradient_Q280,Radial_Dir_Q280,New_Normal_Q280);float X_Q248;float Y_Q248;X_Q248=New_UV_Q280.x;Y_Q248=New_UV_Q280.y;vec3 Pos_World_Q162;Object_To_World_Pos_B162(New_P_Q280,Pos_World_Q162);vec3 Nrm_World_Q182;Object_To_World_Normal_B182(New_Normal_Q280,Nrm_World_Q182);vec4 Blob_Info_Q173;\n#if BLOB_ENABLE\nBlob_Vertex_B173(Pos_World_Q162,Nrm_World_Q176,Tangent_World_N_Q177,Binormal_World_N_Q178,_Blob_Position_,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q173);\n#else\nBlob_Info_Q173=vec4(0,0,0,0);\n#endif\nvec4 Blob_Info_Q174;\n#if BLOB_ENABLE_2\nBlob_Vertex_B174(Pos_World_Q162,Nrm_World_Q176,Tangent_World_N_Q177,Binormal_World_N_Q178,_Blob_Position_2_,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q174);\n#else\nBlob_Info_Q174=vec4(0,0,0,0);\n#endif\nfloat Out_Q255;Remap_Range_B255(0.0,1.0,0.0,1.0,X_Q248,Out_Q255);float X_Q236;float Y_Q236;float Z_Q236;To_XYZ_B228(Nrm_World_Q182,X_Q236,Y_Q236,Z_Q236);vec4 Color_At_T_Q247=mix(Linear_Q251,Linear_Q252,Out_Q255);float Minus_F_Q237=-Z_Q236;float R_Q249;float G_Q249;float B_Q249;float A_Q249;R_Q249=Color_At_T_Q247.r; G_Q249=Color_At_T_Q247.g; B_Q249=Color_At_T_Q247.b; A_Q249=Color_At_T_Q247.a;float ClampF_Q238=clamp(0.0,Minus_F_Q237,1.0);float Result_Q243;Conditional_Float_B243(_Decal_Front_Only_,ClampF_Q238,1.0,Result_Q243);vec4 Vec4_Q239=vec4(Result_Q243,Radial_Gradient_Q280,G_Q249,B_Q249);vec3 Position=Pos_World_Q162;vec3 Normal=Nrm_World_Q182;vec2 UV=XY_Q235;vec3 Tangent=Tangent_World_N_Q177;vec3 Binormal=Difference_Q211;vec4 Color=Out_Color_Q184;vec4 Extra1=Vec4_Q239;vec4 Extra2=Blob_Info_Q173;vec4 Extra3=Blob_Info_Q174;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}";class mx extends wt.M{constructor(){super(),this.SKY_ENABLED=!0,this.BLOB_ENABLE_2=!0,this.IRIDESCENCE_ENABLED=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class bx extends Ot.E{constructor(e,t){super(e,t),this.radius=.157,this.bevelFront=.065,this.bevelFrontStretch=.077,this.bevelBack=.031,this.bevelBackStretch=0,this.radiusTopLeft=1,this.radiusTopRight=1,this.radiusBottomLeft=1,this.radiusBottomRight=1,this.bulgeEnabled=!1,this.bulgeHeight=-.323,this.bulgeRadius=.73,this.sunIntensity=2,this.sunTheta=.937,this.sunPhi=.555,this.indirectDiffuse=1,this.albedo=new bt.ov(.0117647,.505882,.996078,1),this.specular=0,this.shininess=10,this.sharpness=0,this.subsurface=.31,this.leftGradientColor=new bt.ov(.0117647,.505882,.996078,1),this.rightGradientColor=new bt.ov(.0117647,.505882,.996078,1),this.reflection=.749,this.frontReflect=0,this.edgeReflect=.09,this.power=8.1,this.skyColor=new bt.ov(.0117647,.960784,.996078,1),this.horizonColor=new bt.ov(.0117647,.333333,.996078,1),this.groundColor=new bt.ov(0,.254902,.996078,1),this.horizonPower=1,this.width=.02,this.fuzz=.5,this.minFuzz=.001,this.clipFade=.01,this.hueShift=0,this.saturationShift=0,this.valueShift=0,this.blobPosition=new gt.Pq(0,0,.1),this.blobIntensity=.5,this.blobNearSize=.01,this.blobFarSize=.03,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.576,this.blobPulse=0,this.blobFade=1,this.blobPosition2=new gt.Pq(.2,0,.1),this.blobNearSize2=.01,this.blobPulse2=0,this.blobFade2=1,this.blobTexture=new Dt.g("",this.getScene()),this.leftIndexPosition=new gt.Pq(0,0,1),this.rightIndexPosition=new gt.Pq(-1,-1,-1),this.leftIndexMiddlePosition=new gt.Pq(0,0,0),this.rightIndexMiddlePosition=new gt.Pq(0,0,0),this.decalScaleXY=new gt.I9(1.5,1.5),this.decalFrontOnly=!0,this.rimIntensity=.287,this.rimHueShift=0,this.rimSaturationShift=0,this.rimValueShift=-1,this.iridescenceIntensity=0,this.useGlobalLeftIndex=1,this.useGlobalRightIndex=1,this.globalLeftIndexTipProximity=0,this.globalRightIndexTipProximity=0,this.globalLeftIndexTipPosition=new gt.IU(.5,0,-.55,1),this.globaRightIndexTipPosition=new gt.IU(0,0,0,1),this.globalLeftThumbTipPosition=new gt.IU(.5,0,-.55,1),this.globalRightThumbTipPosition=new gt.IU(0,0,0,1),this.globalLeftIndexMiddlePosition=new gt.IU(.5,0,-.55,1),this.globalRightIndexMiddlePosition=new gt.IU(0,0,0,1),this.alphaMode=ui.Y.ALPHA_DISABLE,this.backFaceCulling=!1;const i=$i.S0.GetAssetUrl(bx.BLUE_GRADIENT_TEXTURE_URL);this._blueGradientTexture=new Dt.g(i,t,!0,!1,Dt.g.NEAREST_SAMPLINGMODE),this._decalTexture=new Dt.g("",this.getScene()),this._reflectionMapTexture=new Dt.g("",this.getScene()),this._indirectEnvTexture=new Dt.g("",this.getScene())}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new mx);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;const n=r.getEngine();if((0,Ut.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const e=new Nt.J;s.FOG&&e.addFallback(1,"FOG"),(0,Ut.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;const i=[Mt.R.PositionKind];s.NORMAL&&i.push(Mt.R.NormalKind),s.UV1&&i.push(Mt.R.UVKind),s.UV2&&i.push(Mt.R.UV2Kind),s.VERTEXCOLOR&&i.push(Mt.R.ColorKind),s.TANGENT&&i.push(Mt.R.TangentKind),(0,Ut.ER)(i,s);const o="mrdlSliderThumb",a=s.toString(),h=["world","viewProjection","cameraPosition","_Radius_","_Bevel_Front_","_Bevel_Front_Stretch_","_Bevel_Back_","_Bevel_Back_Stretch_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Bulge_Enabled_","_Bulge_Height_","_Bulge_Radius_","_Sun_Intensity_","_Sun_Theta_","_Sun_Phi_","_Indirect_Diffuse_","_Albedo_","_Specular_","_Shininess_","_Sharpness_","_Subsurface_","_Left_Color_","_Right_Color_","_Reflection_","_Front_Reflect_","_Edge_Reflect_","_Power_","_Sky_Color_","_Horizon_Color_","_Ground_Color_","_Horizon_Power_","_Reflection_Map_","_Indirect_Environment_","_Width_","_Fuzz_","_Min_Fuzz_","_Clip_Fade_","_Hue_Shift_","_Saturation_Shift_","_Value_Shift_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Left_Index_Pos_","_Right_Index_Pos_","_Left_Index_Middle_Pos_","_Right_Index_Middle_Pos_","_Decal_","_Decal_Scale_XY_","_Decal_Front_Only_","_Rim_Intensity_","_Rim_Texture_","_Rim_Hue_Shift_","_Rim_Saturation_Shift_","_Rim_Value_Shift_","_Iridescence_Intensity_","_Iridescence_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Middle_Position;","Global_Right_Index_Middle_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],l=["_Rim_Texture_","_Iridescence_Texture_"],c=[];(0,Ut.Bb)({uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect(o,{attributes:i,uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),s)}return!(!t.effect||!t.effect.isReady()||(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,0))}bindForSubMesh(e,t,i){if(!i.materialDefines)return;const s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Bevel_Front_",this.bevelFront),this._activeEffect.setFloat("_Bevel_Front_Stretch_",this.bevelFrontStretch),this._activeEffect.setFloat("_Bevel_Back_",this.bevelBack),this._activeEffect.setFloat("_Bevel_Back_Stretch_",this.bevelBackStretch),this._activeEffect.setFloat("_Radius_Top_Left_",this.radiusTopLeft),this._activeEffect.setFloat("_Radius_Top_Right_",this.radiusTopRight),this._activeEffect.setFloat("_Radius_Bottom_Left_",this.radiusBottomLeft),this._activeEffect.setFloat("_Radius_Bottom_Right_",this.radiusBottomRight),this._activeEffect.setFloat("_Bulge_Enabled_",this.bulgeEnabled?1:0),this._activeEffect.setFloat("_Bulge_Height_",this.bulgeHeight),this._activeEffect.setFloat("_Bulge_Radius_",this.bulgeRadius),this._activeEffect.setFloat("_Sun_Intensity_",this.sunIntensity),this._activeEffect.setFloat("_Sun_Theta_",this.sunTheta),this._activeEffect.setFloat("_Sun_Phi_",this.sunPhi),this._activeEffect.setFloat("_Indirect_Diffuse_",this.indirectDiffuse),this._activeEffect.setDirectColor4("_Albedo_",this.albedo),this._activeEffect.setFloat("_Specular_",this.specular),this._activeEffect.setFloat("_Shininess_",this.shininess),this._activeEffect.setFloat("_Sharpness_",this.sharpness),this._activeEffect.setFloat("_Subsurface_",this.subsurface),this._activeEffect.setDirectColor4("_Left_Color_",this.leftGradientColor),this._activeEffect.setDirectColor4("_Right_Color_",this.rightGradientColor),this._activeEffect.setFloat("_Reflection_",this.reflection),this._activeEffect.setFloat("_Front_Reflect_",this.frontReflect),this._activeEffect.setFloat("_Edge_Reflect_",this.edgeReflect),this._activeEffect.setFloat("_Power_",this.power),this._activeEffect.setDirectColor4("_Sky_Color_",this.skyColor),this._activeEffect.setDirectColor4("_Horizon_Color_",this.horizonColor),this._activeEffect.setDirectColor4("_Ground_Color_",this.groundColor),this._activeEffect.setFloat("_Horizon_Power_",this.horizonPower),this._activeEffect.setTexture("_Reflection_Map_",this._reflectionMapTexture),this._activeEffect.setTexture("_Indirect_Environment_",this._indirectEnvTexture),this._activeEffect.setFloat("_Width_",this.width),this._activeEffect.setFloat("_Fuzz_",this.fuzz),this._activeEffect.setFloat("_Min_Fuzz_",this.minFuzz),this._activeEffect.setFloat("_Clip_Fade_",this.clipFade),this._activeEffect.setFloat("_Hue_Shift_",this.hueShift),this._activeEffect.setFloat("_Saturation_Shift_",this.saturationShift),this._activeEffect.setFloat("_Value_Shift_",this.valueShift),this._activeEffect.setVector3("_Blob_Position_",this.blobPosition),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this.blobTexture),this._activeEffect.setVector3("_Blob_Position_2_",this.blobPosition2),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setVector3("_Left_Index_Pos_",this.leftIndexPosition),this._activeEffect.setVector3("_Right_Index_Pos_",this.rightIndexPosition),this._activeEffect.setVector3("_Left_Index_Middle_Pos_",this.leftIndexMiddlePosition),this._activeEffect.setVector3("_Right_Index_Middle_Pos_",this.rightIndexMiddlePosition),this._activeEffect.setTexture("_Decal_",this._decalTexture),this._activeEffect.setVector2("_Decal_Scale_XY_",this.decalScaleXY),this._activeEffect.setFloat("_Decal_Front_Only_",this.decalFrontOnly?1:0),this._activeEffect.setFloat("_Rim_Intensity_",this.rimIntensity),this._activeEffect.setTexture("_Rim_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("_Rim_Hue_Shift_",this.rimHueShift),this._activeEffect.setFloat("_Rim_Saturation_Shift_",this.rimSaturationShift),this._activeEffect.setFloat("_Rim_Value_Shift_",this.rimValueShift),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setTexture("_Iridescence_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("Use_Global_Left_Index",this.useGlobalLeftIndex),this._activeEffect.setFloat("Use_Global_Right_Index",this.useGlobalRightIndex),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this.globalLeftIndexTipPosition),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this.globaRightIndexTipPosition),this._activeEffect.setVector4("Global_Left_Thumb_Tip_Position",this.globalLeftThumbTipPosition),this._activeEffect.setVector4("Global_Right_Thumb_Tip_Position",this.globalRightThumbTipPosition),this._activeEffect.setVector4("Global_Left_Index_Middle_Position",this.globalLeftIndexMiddlePosition),this._activeEffect.setVector4("Global_Right_Index_Middle_Position",this.globalRightIndexMiddlePosition),this._activeEffect.setFloat("Global_Left_Index_Tip_Proximity",this.globalLeftIndexTipProximity),this._activeEffect.setFloat("Global_Right_Index_Tip_Proximity",this.globalRightIndexTipProximity),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e),this._reflectionMapTexture.dispose(),this._indirectEnvTexture.dispose(),this._blueGradientTexture.dispose(),this._decalTexture.dispose()}clone(e){return Vt.p.Clone((()=>new bx(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.MRDLSliderThumbMaterial",e}getClassName(){return"MRDLSliderThumbMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new bx(e.name,t)),e,t,i)}}bx.BLUE_GRADIENT_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/MRDL/mrtk-mrdl-blue-gradient.png",(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"radius",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"bevelFront",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"bevelFrontStretch",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"bevelBack",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"bevelBackStretch",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"radiusTopLeft",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"radiusTopRight",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"radiusBottomLeft",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"radiusBottomRight",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"bulgeEnabled",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"bulgeHeight",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"bulgeRadius",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"sunIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"sunTheta",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"sunPhi",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"indirectDiffuse",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"albedo",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"specular",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"shininess",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"sharpness",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"subsurface",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"leftGradientColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"rightGradientColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"reflection",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"frontReflect",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"edgeReflect",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"power",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"skyColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"horizonColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"groundColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"horizonPower",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"width",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"fuzz",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"minFuzz",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"clipFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"hueShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"saturationShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"valueShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobPosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobNearSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobFarSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobNearDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobFarDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobFadeLength",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobPulse",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobPosition2",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobNearSize2",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobPulse2",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobFade2",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"blobTexture",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"leftIndexPosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"rightIndexPosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"leftIndexMiddlePosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"rightIndexMiddlePosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"decalScaleXY",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"decalFrontOnly",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"rimIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"rimHueShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"rimSaturationShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"rimValueShift",void 0),(0,Et.Cg)([(0,Rt.lK)()],bx.prototype,"iridescenceIntensity",void 0),(0,Ft.Y5)("BABYLON.GUI.MRDLSliderThumbMaterial",bx);Ma.l.ShadersStore.mrdlBackplatePixelShader="uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vExtra1;varying vec4 vExtra2;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform vec4 _Iridescence_Tint_;uniform sampler2D _Iridescent_Map_;uniform float _Angle_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform vec4 _Gradient_Color_;uniform vec4 _Top_Left_;uniform vec4 _Top_Right_;uniform vec4 _Bottom_Left_;uniform vec4 _Bottom_Right_;uniform float _Edge_Width_;uniform float _Edge_Power_;uniform float _Line_Gradient_Blend_;uniform float _Fade_Out_;void FastLinearTosRGB_B353(\nvec4 Linear,\nout vec4 sRGB)\n{sRGB.rgb=sqrt(clamp(Linear.rgb,0.0,1.0));sRGB.a=Linear.a;}\nvoid Round_Rect_Fragment_B332(\nfloat Radius,\nfloat Line_Width,\nvec4 Line_Color,\nfloat Filter_Width,\nvec2 UV,\nfloat Line_Visibility,\nvec4 Rect_Parms,\nvec4 Fill_Color,\nout vec4 Color)\n{float d=length(max(abs(UV)-Rect_Parms.xy,0.0));float dx=max(fwidth(d)*Filter_Width,0.00001);float g=min(Rect_Parms.z,Rect_Parms.w);float dgrad=max(fwidth(g)*Filter_Width,0.00001);float Inside_Rect=clamp(g/dgrad,0.0,1.0);float inner=clamp((d+dx*0.5-max(Radius-Line_Width,d-dx*0.5))/dx,0.0,1.0);Color=clamp(mix(Fill_Color,Line_Color,inner),0.0,1.0)*Inside_Rect;}\nvoid Iridescence_B343(\nvec3 Position,\nvec3 Normal,\nvec2 UV,\nvec3 Axis,\nvec3 Eye,\nvec4 Tint,\nsampler2D Texture,\nbool Reflected,\nfloat Frequency,\nfloat Vertical_Offset,\nout vec4 Color)\n{vec3 i=normalize(Position-Eye);vec3 r=reflect(i,Normal);float idota=dot(i,Axis);float idotr=dot(i,r);float x=Reflected ? idotr : idota;vec2 xy;xy.x=fract((x*Frequency+1.0)*0.5+UV.y*Vertical_Offset);xy.y=0.5;Color=texture(Texture,xy);Color.rgb*=Tint.rgb;}\nvoid Scale_RGB_B346(\nvec4 Color,\nfloat Scalar,\nout vec4 Result)\n{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}\nvoid Scale_RGB_B344(\nfloat Scalar,\nvec4 Color,\nout vec4 Result)\n{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}\nvoid Line_Fragment_B362(\nvec4 Base_Color,\nvec4 Highlight_Color,\nfloat Highlight_Width,\nvec3 Line_Vertex,\nfloat Highlight,\nout vec4 Line_Color)\n{float k2=1.0-clamp(abs(Line_Vertex.y/Highlight_Width),0.0,1.0);Line_Color=mix(Base_Color,Highlight_Color,Highlight*k2);}\nvoid Edge_B356(\nvec4 RectParms,\nfloat Radius,\nfloat Line_Width,\nvec2 UV,\nfloat Edge_Width,\nfloat Edge_Power,\nout float Result)\n{float d=length(max(abs(UV)-RectParms.xy,0.0));float edge=1.0-clamp((1.0-d/(Radius-Line_Width))/Edge_Width,0.0,1.0);Result=pow(edge,Edge_Power);}\nvoid Gradient_B355(\nvec4 Gradient_Color,\nvec4 Top_Left,\nvec4 Top_Right,\nvec4 Bottom_Left,\nvec4 Bottom_Right,\nvec2 UV,\nout vec4 Result)\n{vec3 top=Top_Left.rgb+(Top_Right.rgb-Top_Left.rgb)*UV.x;vec3 bottom=Bottom_Left.rgb+(Bottom_Right.rgb-Bottom_Left.rgb)*UV.x;Result.rgb=Gradient_Color.rgb*(bottom+(top-bottom)*UV.y);Result.a=1.0;}\nvoid main()\n{float X_Q338;float Y_Q338;float Z_Q338;float W_Q338;X_Q338=vExtra2.x;Y_Q338=vExtra2.y;Z_Q338=vExtra2.z;W_Q338=vExtra2.w;vec4 Color_Q343;\n#if IRIDESCENCE_ENABLE\nIridescence_B343(vPosition,vNormal,vUV,vBinormal,cameraPosition,_Iridescence_Tint_,_Iridescent_Map_,_Reflected_,_Frequency_,_Vertical_Offset_,Color_Q343);\n#else\nColor_Q343=vec4(0,0,0,0);\n#endif\nvec4 Result_Q344;Scale_RGB_B344(_Iridescence_Intensity_,Color_Q343,Result_Q344);vec4 Line_Color_Q362;Line_Fragment_B362(_Line_Color_,_Highlight_Color_,_Highlight_Width_,vTangent,_Highlight_,Line_Color_Q362);float Result_Q356;\n#if EDGE_ONLY\nEdge_B356(vExtra1,Z_Q338,W_Q338,vUV,_Edge_Width_,_Edge_Power_,Result_Q356);\n#else\nResult_Q356=1.0;\n#endif\nvec2 Vec2_Q339=vec2(X_Q338,Y_Q338);vec4 Result_Q355;Gradient_B355(_Gradient_Color_,_Top_Left_,_Top_Right_,_Bottom_Left_,_Bottom_Right_,Vec2_Q339,Result_Q355);vec4 Linear_Q348;Linear_Q348.rgb=clamp(Result_Q355.rgb*Result_Q355.rgb,0.0,1.0);Linear_Q348.a=Result_Q355.a;vec4 Result_Q346;Scale_RGB_B346(Linear_Q348,Result_Q356,Result_Q346);vec4 Sum_Q345=Result_Q346+Result_Q344;vec4 Color_At_T_Q347=mix(Line_Color_Q362,Result_Q346,_Line_Gradient_Blend_);vec4 Base_And_Iridescent_Q350;Base_And_Iridescent_Q350=_Base_Color_+vec4(Sum_Q345.rgb,0.0);vec4 Sum_Q349=Color_At_T_Q347+_Iridescence_Edge_Intensity_*Color_Q343;vec4 Result_Q351=Sum_Q349; Result_Q351.a=1.0;vec4 Color_Q332;Round_Rect_Fragment_B332(Z_Q338,W_Q338,Result_Q351,_Filter_Width_,vUV,1.0,vExtra1,Base_And_Iridescent_Q350,Color_Q332);vec4 Result_Q354=_Fade_Out_*Color_Q332;vec4 sRGB_Q353;FastLinearTosRGB_B353(Result_Q354,sRGB_Q353);vec4 Out_Color=sRGB_Q353;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}";Ma.l.ShadersStore.mrdlBackplateVertexShader="uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec3 tangent;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform vec4 _Iridescence_Tint_;uniform sampler2D _Iridescent_Map_;uniform float _Angle_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform vec4 _Gradient_Color_;uniform vec4 _Top_Left_;uniform vec4 _Top_Right_;uniform vec4 _Bottom_Left_;uniform vec4 _Bottom_Right_;uniform float _Edge_Width_;uniform float _Edge_Power_;uniform float _Line_Gradient_Blend_;uniform float _Fade_Out_;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vExtra1;varying vec4 vExtra2;void Object_To_World_Pos_B314(\nvec3 Pos_Object,\nout vec3 Pos_World)\n{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}\nvoid Round_Rect_Vertex_B357(\nvec2 UV,\nfloat Radius,\nfloat Margin,\nfloat Anisotropy,\nfloat Gradient1,\nfloat Gradient2,\nvec3 Normal,\nvec4 Color_Scale_Translate,\nout vec2 Rect_UV,\nout vec4 Rect_Parms,\nout vec2 Scale_XY,\nout vec2 Line_UV,\nout vec2 Color_UV_Info)\n{Scale_XY=vec2(Anisotropy,1.0);Line_UV=(UV-vec2(0.5,0.5));Rect_UV=Line_UV*Scale_XY;Rect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius)-vec2(Margin,Margin);Rect_Parms.z=Gradient1; \nRect_Parms.w=Gradient2;Color_UV_Info=(Line_UV+vec2(0.5,0.5))*Color_Scale_Translate.xy+Color_Scale_Translate.zw;}\nvoid Line_Vertex_B333(\nvec2 Scale_XY,\nvec2 UV,\nfloat Time,\nfloat Rate,\nvec4 Highlight_Transform,\nout vec3 Line_Vertex)\n{float angle2=(Rate*Time)*2.0*3.1416;float sinAngle2=sin(angle2);float cosAngle2=cos(angle2);vec2 xformUV=UV*Highlight_Transform.xy+Highlight_Transform.zw;Line_Vertex.x=0.0;Line_Vertex.y=cosAngle2*xformUV.x-sinAngle2*xformUV.y;Line_Vertex.z=0.0; }\nvoid PickDir_B334(\nfloat Degrees,\nvec3 DirX,\nvec3 DirY,\nout vec3 Dir)\n{float a=Degrees*3.14159/180.0;Dir=cos(a)*DirX+sin(a)*DirY;}\nvoid Move_Verts_B327(\nfloat Anisotropy,\nvec3 P,\nfloat Radius,\nout vec3 New_P,\nout vec2 New_UV,\nout float Radial_Gradient,\nout vec3 Radial_Dir)\n{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);New_UV=center+r2*(UV-2.0*center+0.5);New_P=vec3(New_UV-0.5,P.z);Radial_Gradient=1.0-length(delta)*2.0;Radial_Dir=vec3(delta*r2,0.0);}\nvoid Pick_Radius_B336(\nfloat Radius,\nfloat Radius_Top_Left,\nfloat Radius_Top_Right,\nfloat Radius_Bottom_Left,\nfloat Radius_Bottom_Right,\nvec3 Position,\nout float Result)\n{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}\nvoid Edge_AA_Vertex_B328(\nvec3 Position_World,\nvec3 Position_Object,\nvec3 Normal_Object,\nvec3 Eye,\nfloat Radial_Gradient,\nvec3 Radial_Dir,\nvec3 Tangent,\nout float Gradient1,\nout float Gradient2)\n{vec3 I=(Eye-Position_World);vec3 T=(vec4(Tangent,0.0)).xyz;float g=(dot(T,I)<0.0) ? 0.0 : 1.0;if (Normal_Object.z==0.0) { \nGradient1=Position_Object.z>0.0 ? g : 1.0;Gradient2=Position_Object.z>0.0 ? 1.0 : g;} else {Gradient1=g+(1.0-g)*(Radial_Gradient);Gradient2=1.0;}}\nvoid Object_To_World_Dir_B330(\nvec3 Dir_Object,\nout vec3 Binormal_World,\nout vec3 Binormal_World_N,\nout float Binormal_Length)\n{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}\nvoid RelativeOrAbsoluteDetail_B341(\nfloat Nominal_Radius,\nfloat Nominal_LineWidth,\nbool Absolute_Measurements,\nfloat Height,\nout float Radius,\nout float Line_Width)\n{float scale=Absolute_Measurements ? 1.0/Height : 1.0;Radius=Nominal_Radius*scale;Line_Width=Nominal_LineWidth*scale;}\nvoid main()\n{vec3 Nrm_World_Q326;Nrm_World_Q326=normalize((world*vec4(normal,0.0)).xyz);vec3 Tangent_World_Q329;vec3 Tangent_World_N_Q329;float Tangent_Length_Q329;Tangent_World_Q329=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q329=length(Tangent_World_Q329);Tangent_World_N_Q329=Tangent_World_Q329/Tangent_Length_Q329;vec3 Binormal_World_Q330;vec3 Binormal_World_N_Q330;float Binormal_Length_Q330;Object_To_World_Dir_B330(vec3(0,1,0),Binormal_World_Q330,Binormal_World_N_Q330,Binormal_Length_Q330);float Radius_Q341;float Line_Width_Q341;RelativeOrAbsoluteDetail_B341(_Radius_,_Line_Width_,_Absolute_Sizes_,Binormal_Length_Q330,Radius_Q341,Line_Width_Q341);vec3 Dir_Q334;PickDir_B334(_Angle_,Tangent_World_N_Q329,Binormal_World_N_Q330,Dir_Q334);float Result_Q336;Pick_Radius_B336(Radius_Q341,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q336);float Anisotropy_Q331=Tangent_Length_Q329/Binormal_Length_Q330;vec4 Out_Color_Q337=vec4(Result_Q336,Line_Width_Q341,0,1);vec3 New_P_Q327;vec2 New_UV_Q327;float Radial_Gradient_Q327;vec3 Radial_Dir_Q327;Move_Verts_B327(Anisotropy_Q331,position,Result_Q336,New_P_Q327,New_UV_Q327,Radial_Gradient_Q327,Radial_Dir_Q327);vec3 Pos_World_Q314;Object_To_World_Pos_B314(New_P_Q327,Pos_World_Q314);float Gradient1_Q328;float Gradient2_Q328;\n#if SMOOTH_EDGES\nEdge_AA_Vertex_B328(Pos_World_Q314,position,normal,cameraPosition,Radial_Gradient_Q327,Radial_Dir_Q327,tangent,Gradient1_Q328,Gradient2_Q328);\n#else\nGradient1_Q328=1.0;Gradient2_Q328=1.0;\n#endif\nvec2 Rect_UV_Q357;vec4 Rect_Parms_Q357;vec2 Scale_XY_Q357;vec2 Line_UV_Q357;vec2 Color_UV_Info_Q357;Round_Rect_Vertex_B357(New_UV_Q327,Result_Q336,0.0,Anisotropy_Q331,Gradient1_Q328,Gradient2_Q328,normal,vec4(1,1,0,0),Rect_UV_Q357,Rect_Parms_Q357,Scale_XY_Q357,Line_UV_Q357,Color_UV_Info_Q357);vec3 Line_Vertex_Q333;Line_Vertex_B333(Scale_XY_Q357,Line_UV_Q357,(20.0),_Rate_,_Highlight_Transform_,Line_Vertex_Q333);float X_Q359;float Y_Q359;X_Q359=Color_UV_Info_Q357.x;Y_Q359=Color_UV_Info_Q357.y;vec4 Vec4_Q358=vec4(X_Q359,Y_Q359,Result_Q336,Line_Width_Q341);vec3 Position=Pos_World_Q314;vec3 Normal=Nrm_World_Q326;vec2 UV=Rect_UV_Q357;vec3 Tangent=Line_Vertex_Q333;vec3 Binormal=Dir_Q334;vec4 Color=Out_Color_Q337;vec4 Extra1=Rect_Parms_Q357;vec4 Extra2=Vec4_Q358;vec4 Extra3=vec4(0,0,0,0);gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vExtra1=Extra1;vExtra2=Extra2;}";class vx extends wt.M{constructor(){super(),this.IRIDESCENCE_ENABLE=!0,this.SMOOTH_EDGES=!0,this._needNormals=!0,this.rebuild()}}class Tx extends Ot.E{constructor(e,t){super(e,t),this.radius=.3,this.lineWidth=.003,this.absoluteSizes=!1,this._filterWidth=1,this.baseColor=new bt.ov(0,0,0,1),this.lineColor=new bt.ov(.2,.262745,.4,1),this.radiusTopLeft=1,this.radiusTopRight=1,this.radiusBottomLeft=1,this.radiusBottomRight=1,this._rate=0,this.highlightColor=new bt.ov(.239216,.435294,.827451,1),this.highlightWidth=0,this._highlightTransform=new gt.IU(1,1,0,0),this._highlight=1,this.iridescenceIntensity=.45,this.iridescenceEdgeIntensity=1,this.iridescenceTint=new bt.ov(1,1,1,1),this._angle=-45,this.fadeOut=1,this._reflected=!0,this._frequency=1,this._verticalOffset=0,this.gradientColor=new bt.ov(.74902,.74902,.74902,1),this.topLeftGradientColor=new bt.ov(.00784314,.294118,.580392,1),this.topRightGradientColor=new bt.ov(.305882,0,1,1),this.bottomLeftGradientColor=new bt.ov(.133333,.258824,.992157,1),this.bottomRightGradientColor=new bt.ov(.176471,.176471,.619608,1),this.edgeWidth=.5,this.edgePower=1,this.edgeLineGradientBlend=.5,this.alphaMode=ui.Y.ALPHA_DISABLE,this.backFaceCulling=!1;const i=$i.S0.GetAssetUrl(Tx.IRIDESCENT_MAP_TEXTURE_URL);this._iridescentMapTexture=new Dt.g(i,this.getScene(),!0,!1,Dt.g.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new vx);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;const n=r.getEngine();if((0,Ut.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const e=new Nt.J;s.FOG&&e.addFallback(1,"FOG"),(0,Ut.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;const i=[Mt.R.PositionKind];s.NORMAL&&i.push(Mt.R.NormalKind),s.UV1&&i.push(Mt.R.UVKind),s.UV2&&i.push(Mt.R.UV2Kind),s.VERTEXCOLOR&&i.push(Mt.R.ColorKind),s.TANGENT&&i.push(Mt.R.TangentKind),(0,Ut.ER)(i,s);const o="mrdlBackplate",a=s.toString(),h=["world","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Absolute_Sizes_","_Filter_Width_","_Base_Color_","_Line_Color_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Rate_","_Highlight_Color_","_Highlight_Width_","_Highlight_Transform_","_Highlight_","_Iridescence_Intensity_","_Iridescence_Edge_Intensity_","_Iridescence_Tint_","_Iridescent_Map_","_Angle_","_Reflected_","_Frequency_","_Vertical_Offset_","_Gradient_Color_","_Top_Left_","_Top_Right_","_Bottom_Left_","_Bottom_Right_","_Edge_Width_","_Edge_Power_","_Line_Gradient_Blend_","_Fade_Out_"],l=["_Iridescent_Map_"],c=[];(0,Ut.Bb)({uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect(o,{attributes:i,uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),s)}return!(!t.effect||!t.effect.isReady()||(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,0))}bindForSubMesh(e,t,i){if(!i.materialDefines)return;const s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",this.absoluteSizes?1:0),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Base_Color_",this.baseColor),this._activeEffect.setDirectColor4("_Line_Color_",this.lineColor),this._activeEffect.setFloat("_Radius_Top_Left_",this.radiusTopLeft),this._activeEffect.setFloat("_Radius_Top_Right_",this.radiusTopRight),this._activeEffect.setFloat("_Radius_Bottom_Left_",this.radiusBottomLeft),this._activeEffect.setFloat("_Radius_Bottom_Right_",this.radiusBottomRight),this._activeEffect.setFloat("_Rate_",this._rate),this._activeEffect.setDirectColor4("_Highlight_Color_",this.highlightColor),this._activeEffect.setFloat("_Highlight_Width_",this.highlightWidth),this._activeEffect.setVector4("_Highlight_Transform_",this._highlightTransform),this._activeEffect.setFloat("_Highlight_",this._highlight),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setFloat("_Iridescence_Edge_Intensity_",this.iridescenceEdgeIntensity),this._activeEffect.setDirectColor4("_Iridescence_Tint_",this.iridescenceTint),this._activeEffect.setTexture("_Iridescent_Map_",this._iridescentMapTexture),this._activeEffect.setFloat("_Angle_",this._angle),this._activeEffect.setFloat("_Reflected_",this._reflected?1:0),this._activeEffect.setFloat("_Frequency_",this._frequency),this._activeEffect.setFloat("_Vertical_Offset_",this._verticalOffset),this._activeEffect.setDirectColor4("_Gradient_Color_",this.gradientColor),this._activeEffect.setDirectColor4("_Top_Left_",this.topLeftGradientColor),this._activeEffect.setDirectColor4("_Top_Right_",this.topRightGradientColor),this._activeEffect.setDirectColor4("_Bottom_Left_",this.bottomLeftGradientColor),this._activeEffect.setDirectColor4("_Bottom_Right_",this.bottomRightGradientColor),this._activeEffect.setFloat("_Edge_Width_",this.edgeWidth),this._activeEffect.setFloat("_Edge_Power_",this.edgePower),this._activeEffect.setFloat("_Line_Gradient_Blend_",this.edgeLineGradientBlend),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return Vt.p.Clone((()=>new Tx(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.MRDLBackplateMaterial",e}getClassName(){return"MRDLBackplateMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new Tx(e.name,t)),e,t,i)}}Tx.IRIDESCENT_MAP_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/MRDL/mrtk-mrdl-backplate-iridescence.png",(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"radius",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"lineWidth",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"absoluteSizes",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"baseColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"lineColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"radiusTopLeft",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"radiusTopRight",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"radiusBottomLeft",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"radiusBottomRight",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"highlightColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"highlightWidth",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"iridescenceIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"iridescenceEdgeIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"iridescenceTint",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"fadeOut",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"gradientColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"topLeftGradientColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"topRightGradientColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"bottomLeftGradientColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"bottomRightGradientColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"edgeWidth",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"edgePower",void 0),(0,Et.Cg)([(0,Rt.lK)()],Tx.prototype,"edgeLineGradientBlend",void 0),(0,Ft.Y5)("BABYLON.GUI.MRDLBackplateMaterial",Tx);class yx extends My{constructor(e,t){super(e),this.onValueChangedObservable=new Zi.cP,this._sliderBackplateVisible=t||!1,this._minimum=0,this._maximum=100,this._step=0,this._value=50}get mesh(){return this.node?this._sliderThumb:null}get minimum(){return this._minimum}set minimum(e){this._minimum!==e&&(this._minimum=Math.max(e,0),this._value=Math.max(Math.min(this._value,this._maximum),this._minimum))}get maximum(){return this._maximum}set maximum(e){this._maximum!==e&&(this._maximum=Math.max(e,this._minimum),this._value=Math.max(Math.min(this._value,this._maximum),this._minimum))}get step(){return this._step}set step(e){this._step!==e&&(this._step=Math.max(Math.min(e,this._maximum-this._minimum),0))}get value(){return this._value}set value(e){this._value!==e&&(this._value=Math.max(Math.min(e,this._maximum),this._minimum),this._sliderThumb&&(this._sliderThumb.position.x=this._convertToPosition(this.value)),this.onValueChangedObservable.notifyObservers(this._value))}get start(){return this.node?this._sliderBar.position.x-this._sliderBar.scaling.x/2:-.5}get end(){return this.node?this._sliderBar.position.x+this._sliderBar.scaling.x/2:.5}get sliderBarMaterial(){return this._sliderBarMaterial}get sliderThumbMaterial(){return this._sliderThumbMaterial}get sliderBackplateMaterial(){return this._sliderBackplateMaterial}get sliderBar(){return this._sliderBar}get sliderThumb(){return this._sliderThumb}get sliderBackplate(){return this._sliderBackplate}set isVisible(e){this._isVisible!==e&&(this._isVisible=e,this.node?.setEnabled(e))}_createNode(e){const t=so(`${this.name}_sliderbackplate`,{width:1,height:1,depth:1},e);t.isPickable=!1,t.visibility=0,t.scaling=new gt.Pq(1,.5,.8);const i=$i.S0.GetAssetUrl(yx.MODEL_BASE_URL);return Ue.cn.ImportMeshAsync(void 0,i,yx.MODEL_FILENAME,e).then((e=>{e.meshes.forEach((e=>{e.isPickable=!1}));const i=e.meshes[1],s=e.meshes[1].clone(`${this.name}_sliderbar`,t),r=e.meshes[1].clone(`${this.name}_sliderthumb`,t);i.visibility=0,this._sliderBackplateVisible&&(i.visibility=1,i.name=`${this.name}_sliderbackplate`,i.scaling.x=1,i.scaling.z=.2,i.parent=t,this._sliderBackplateMaterial&&(i.material=this._sliderBackplateMaterial),this._sliderBackplate=i),s&&(s.parent=t,s.position.z=-.1,s.scaling=new gt.Pq(.8,.04,.3),this._sliderBarMaterial&&(s.material=this._sliderBarMaterial),this._sliderBar=s),r&&(r.parent=t,r.isPickable=!0,r.position.z=-.115,r.scaling=new gt.Pq(.025,.3,.6),r.position.x=this._convertToPosition(this.value),r.addBehavior(this._createBehavior()),this._sliderThumbMaterial&&(r.material=this._sliderThumbMaterial),this._sliderThumb=r),this._injectGUI3DReservedDataStore(t).control=this,t.getChildMeshes().forEach((e=>{this._injectGUI3DReservedDataStore(e).control=this}))})),this._affectMaterial(t),t}_affectMaterial(e){this._sliderBackplateMaterial=this._sliderBackplateMaterial??new Tx(`${this.name}_sliderbackplate_material`,e.getScene()),this._sliderBarMaterial=this._sliderBarMaterial??new fx(`${this.name}_sliderbar_material`,e.getScene()),this._sliderThumbMaterial=this._sliderThumbMaterial??new bx(`${this.name}_sliderthumb_material`,e.getScene())}_createBehavior(){const e=new dx({dragAxis:gt.Pq.Right()});return e.moveAttached=!1,e.onDragStartObservable.add((()=>{this._draggedPosition=this._sliderThumb.position.x})),e.onDragObservable.add((e=>{this._draggedPosition+=e.dragDistance/this.scaling.x,this.value=this._convertToValue(this._draggedPosition)})),e}_convertToPosition(e){const t=(e-this.minimum)/(this.maximum-this.minimum)*(this.end-this.start)+this.start;return Math.min(Math.max(t,this.start),this.end)}_convertToValue(e){let t=(e-this.start)/(this.end-this.start)*(this.maximum-this.minimum);return t=this.step?Math.round(t/this.step)*this.step:t,Math.max(Math.min(this.minimum+t,this._maximum),this._minimum)}dispose(){super.dispose(),this._sliderBar?.dispose(),this._sliderThumb?.dispose(),this._sliderBarMaterial?.dispose(),this._sliderThumbMaterial?.dispose(),this._sliderBackplate?.dispose(),this._sliderBackplateMaterial?.dispose()}}yx.MODEL_BASE_URL="https://assets.babylonjs.com/core/MRTK/",yx.MODEL_FILENAME="mrtk-fluent-backplate.glb";var xx=o(4951);Ma.l.ShadersStore.mrdlBackglowPixelShader="uniform vec3 cameraPosition;varying vec3 vNormal;varying vec2 vUV;uniform float _Bevel_Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Tuning_Motion_;uniform float _Motion_;uniform float _Max_Intensity_;uniform float _Intensity_Fade_In_Exponent_;uniform float _Outer_Fuzz_Start_;uniform float _Outer_Fuzz_End_;uniform vec4 _Color_;uniform vec4 _Inner_Color_;uniform float _Blend_Exponent_;uniform float _Falloff_;uniform float _Bias_;float BiasFunc(float b,float v) {return pow(v,log(clamp(b,0.001,0.999))/log(0.5));}\nvoid Fuzzy_Round_Rect_B33(\nfloat Size_X,\nfloat Size_Y,\nfloat Radius_X,\nfloat Radius_Y,\nfloat Line_Width,\nvec2 UV,\nfloat Outer_Fuzz,\nfloat Max_Outer_Fuzz,\nout float Rect_Distance,\nout float Inner_Distance)\n{vec2 halfSize=vec2(Size_X,Size_Y)*0.5;vec2 r=max(min(vec2(Radius_X,Radius_Y),halfSize),vec2(0.001,0.001));float radius=min(r.x,r.y)-Max_Outer_Fuzz;vec2 v=abs(UV);vec2 nearestp=min(v,halfSize-r);float d=distance(nearestp,v);Inner_Distance=clamp(1.0-(radius-d)/Line_Width,0.0,1.0);Rect_Distance=clamp(1.0-(d-radius)/Outer_Fuzz,0.0,1.0)*Inner_Distance;}\nvoid main()\n{float X_Q42;float Y_Q42;X_Q42=vNormal.x;Y_Q42=vNormal.y;float MaxAB_Q24=max(_Tuning_Motion_,_Motion_);float Sqrt_F_Q27=sqrt(MaxAB_Q24);float Power_Q43=pow(MaxAB_Q24,_Intensity_Fade_In_Exponent_);float Value_At_T_Q26=mix(_Outer_Fuzz_Start_,_Outer_Fuzz_End_,Sqrt_F_Q27);float Product_Q23=_Max_Intensity_*Power_Q43;float Rect_Distance_Q33;float Inner_Distance_Q33;Fuzzy_Round_Rect_B33(X_Q42,Y_Q42,_Bevel_Radius_,_Bevel_Radius_,_Line_Width_,vUV,Value_At_T_Q26,_Outer_Fuzz_Start_,Rect_Distance_Q33,Inner_Distance_Q33);float Power_Q44=pow(Inner_Distance_Q33,_Blend_Exponent_);float Result_Q45=pow(BiasFunc(_Bias_,Rect_Distance_Q33),_Falloff_);vec4 Color_At_T_Q25=mix(_Inner_Color_,_Color_,Power_Q44);float Product_Q22=Result_Q45*Product_Q23;vec4 Result_Q28=Product_Q22*Color_At_T_Q25;vec4 Out_Color=Result_Q28;float Clip_Threshold=0.0;gl_FragColor=Out_Color;}";Ma.l.ShadersStore.mrdlBackglowVertexShader="uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;uniform float _Bevel_Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Tuning_Motion_;uniform float _Motion_;uniform float _Max_Intensity_;uniform float _Intensity_Fade_In_Exponent_;uniform float _Outer_Fuzz_Start_;uniform float _Outer_Fuzz_End_;uniform vec4 _Color_;uniform vec4 _Inner_Color_;uniform float _Blend_Exponent_;uniform float _Falloff_;uniform float _Bias_;varying vec3 vNormal;varying vec2 vUV;void main()\n{vec3 Dir_World_Q41=(world*vec4(tangent,0.0)).xyz;vec3 Dir_World_Q40=(world*vec4((cross(normal,tangent)),0.0)).xyz;float MaxAB_Q24=max(_Tuning_Motion_,_Motion_);float Length_Q16=length(Dir_World_Q41);float Length_Q17=length(Dir_World_Q40);bool Greater_Than_Q37=MaxAB_Q24>0.0;vec3 Sizes_Q35;vec2 XY_Q35;Sizes_Q35=(_Absolute_Sizes_ ? vec3(Length_Q16,Length_Q17,0) : vec3(Length_Q16/Length_Q17,1,0));XY_Q35=(uv-vec2(0.5,0.5))*Sizes_Q35.xy;vec3 Result_Q38=Greater_Than_Q37 ? position : vec3(0,0,0);vec3 Pos_World_Q39=(world*vec4(Result_Q38,1.0)).xyz;vec3 Position=Pos_World_Q39;vec3 Normal=Sizes_Q35;vec2 UV=XY_Q35;vec3 Tangent=vec3(0,0,0);vec3 Binormal=vec3(0,0,0);vec4 Color=vec4(1,1,1,1);gl_Position=viewProjection*vec4(Position,1);vNormal=Normal;vUV=UV;}";class Ax extends wt.M{constructor(){super(),this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class Cx extends Ot.E{constructor(e,t){super(e,t),this.bevelRadius=.16,this.lineWidth=.16,this.absoluteSizes=!1,this.tuningMotion=0,this.motion=1,this.maxIntensity=.7,this.intensityFadeInExponent=2,this.outerFuzzStart=.04,this.outerFuzzEnd=.04,this.color=new bt.ov(.682353,.698039,1,1),this.innerColor=new bt.ov(.356863,.392157,.796078,1),this.blendExponent=1.5,this.falloff=2,this.bias=.5,this.alphaMode=ui.Y.ALPHA_ADD,this.disableDepthWrite=!0,this.backFaceCulling=!1}needAlphaBlending(){return!0}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new Ax);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;const n=r.getEngine();if((0,Ut.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const e=new Nt.J;s.FOG&&e.addFallback(1,"FOG"),(0,Ut.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;const i=[Mt.R.PositionKind];s.NORMAL&&i.push(Mt.R.NormalKind),s.UV1&&i.push(Mt.R.UVKind),s.UV2&&i.push(Mt.R.UV2Kind),s.VERTEXCOLOR&&i.push(Mt.R.ColorKind),s.TANGENT&&i.push(Mt.R.TangentKind),(0,Ut.ER)(i,s);const o="mrdlBackglow",a=s.toString(),h=["world","worldView","worldViewProjection","view","projection","viewProjection","cameraPosition","_Bevel_Radius_","_Line_Width_","_Absolute_Sizes_","_Tuning_Motion_","_Motion_","_Max_Intensity_","_Intensity_Fade_In_Exponent_","_Outer_Fuzz_Start_","_Outer_Fuzz_End_","_Color_","_Inner_Color_","_Blend_Exponent_","_Falloff_","_Bias_"],l=[],c=[];(0,Ut.Bb)({uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect(o,{attributes:i,uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),s)}return!(!t.effect||!t.effect.isReady()||(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,0))}bindForSubMesh(e,t,i){const s=this.getScene();if(!i.materialDefines)return;const r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",s.activeCamera.position),this._activeEffect.setFloat("_Bevel_Radius_",this.bevelRadius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",this.absoluteSizes?1:0),this._activeEffect.setFloat("_Tuning_Motion_",this.tuningMotion),this._activeEffect.setFloat("_Motion_",this.motion),this._activeEffect.setFloat("_Max_Intensity_",this.maxIntensity),this._activeEffect.setFloat("_Intensity_Fade_In_Exponent_",this.intensityFadeInExponent),this._activeEffect.setFloat("_Outer_Fuzz_Start_",this.outerFuzzStart),this._activeEffect.setFloat("_Outer_Fuzz_End_",this.outerFuzzEnd),this._activeEffect.setDirectColor4("_Color_",this.color),this._activeEffect.setDirectColor4("_Inner_Color_",this.innerColor),this._activeEffect.setFloat("_Blend_Exponent_",this.blendExponent),this._activeEffect.setFloat("_Falloff_",this.falloff),this._activeEffect.setFloat("_Bias_",this.bias),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return Vt.p.Clone((()=>new Cx(e,this.getScene())),this)}serialize(){const e=Vt.p.Serialize(this);return e.customType="BABYLON.MRDLBackglowMaterial",e}getClassName(){return"MRDLBackglowMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new Cx(e.name,t)),e,t,i)}}(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"bevelRadius",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"lineWidth",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"absoluteSizes",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"tuningMotion",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"motion",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"maxIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"intensityFadeInExponent",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"outerFuzzStart",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"outerFuzzEnd",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"color",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"innerColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"blendExponent",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"falloff",void 0),(0,Et.Cg)([(0,Rt.lK)()],Cx.prototype,"bias",void 0),(0,Ft.Y5)("BABYLON.GUI.MRDLBackglowMaterial",Cx);Ma.l.ShadersStore.mrdlFrontplatePixelShader="uniform vec3 cameraPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Relative_To_Height_;uniform float _Filter_Width_;uniform vec4 _Edge_Color_;uniform float _Fade_Out_;uniform bool _Smooth_Edges_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform float _Blob_Pulse_Max_Size_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Gaze_Intensity_;uniform float _Gaze_Focus_;uniform sampler2D _Blob_Texture_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;void Scale_Color_B54(\nvec4 Color,\nfloat Scalar,\nout vec4 Result)\n{Result=Scalar*Color;}\nvoid Scale_RGB_B50(\nvec4 Color,\nfloat Scalar,\nout vec4 Result)\n{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}\nvoid Proximity_Fragment_B51(\nfloat Proximity_Max_Intensity,\nfloat Proximity_Near_Radius,\nvec4 Deltas,\nfloat Show_Selection,\nfloat Distance_Fade1,\nfloat Distance_Fade2,\nfloat Strength,\nout float Proximity)\n{float proximity1=(1.0-clamp(length(Deltas.xy)/Proximity_Near_Radius,0.0,1.0))*Distance_Fade1;float proximity2=(1.0-clamp(length(Deltas.zw)/Proximity_Near_Radius,0.0,1.0))*Distance_Fade2;Proximity=Strength*(Proximity_Max_Intensity*max(proximity1,proximity2) *(1.0-Show_Selection)+Show_Selection);}\nvoid Blob_Fragment_B56(\nvec2 UV,\nvec3 Blob_Info,\nsampler2D Blob_Texture,\nout vec4 Blob_Color)\n{float k=dot(UV,UV);Blob_Color=Blob_Info.y*texture(Blob_Texture,vec2(vec2(sqrt(k),Blob_Info.x).x,1.0-vec2(sqrt(k),Blob_Info.x).y))*(1.0-clamp(k,0.0,1.0));}\nvoid Round_Rect_Fragment_B61(\nfloat Radius,\nvec4 Line_Color,\nfloat Filter_Width,\nfloat Line_Visibility,\nvec4 Fill_Color,\nbool Smooth_Edges,\nvec4 Rect_Parms,\nout float Inside_Rect)\n{float d=length(max(abs(Rect_Parms.zw)-Rect_Parms.xy,0.0));float dx=max(fwidth(d)*Filter_Width,0.00001);Inside_Rect=Smooth_Edges ? clamp((Radius-d)/dx,0.0,1.0) : 1.0-step(Radius,d);}\nvoid main()\n{float Is_Quad_Q53;Is_Quad_Q53=vNormal.z;vec4 Blob_Color_Q56;Blob_Fragment_B56(vUV,vTangent,_Blob_Texture_,Blob_Color_Q56);float X_Q52;float Y_Q52;float Z_Q52;float W_Q52;X_Q52=vExtra3.x;Y_Q52=vExtra3.y;Z_Q52=vExtra3.z;W_Q52=vExtra3.w;float Proximity_Q51;Proximity_Fragment_B51(_Proximity_Max_Intensity_,_Proximity_Near_Radius_,vExtra2,X_Q52,Y_Q52,Z_Q52,1.0,Proximity_Q51);float Inside_Rect_Q61;Round_Rect_Fragment_B61(W_Q52,vec4(1,1,1,1),_Filter_Width_,1.0,vec4(0,0,0,0),_Smooth_Edges_,vExtra1,Inside_Rect_Q61);vec4 Result_Q50;Scale_RGB_B50(_Edge_Color_,Proximity_Q51,Result_Q50);vec4 Result_Q47=Inside_Rect_Q61*Blob_Color_Q56;vec4 Color_At_T_Q48=mix(Result_Q50,Result_Q47,Is_Quad_Q53);vec4 Result_Q54;Scale_Color_B54(Color_At_T_Q48,_Fade_Out_,Result_Q54);vec4 Out_Color=Result_Q54;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}";Ma.l.ShadersStore.mrdlFrontplateVertexShader="uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;attribute vec4 color;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Relative_To_Height_;uniform float _Filter_Width_;uniform vec4 _Edge_Color_;uniform float _Fade_Out_;uniform bool _Smooth_Edges_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform float _Blob_Pulse_Max_Size_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Gaze_Intensity_;uniform float _Gaze_Focus_;uniform sampler2D _Blob_Texture_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Blob_Vertex_B40(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nvec3 Blob_Position,\nfloat Intensity,\nfloat Blob_Near_Size,\nfloat Blob_Far_Size,\nfloat Blob_Near_Distance,\nfloat Blob_Far_Distance,\nvec4 Vx_Color,\nvec2 UV,\nvec3 Face_Center,\nvec2 Face_Size,\nvec2 In_UV,\nfloat Blob_Fade_Length,\nfloat Selection_Fade,\nfloat Selection_Fade_Size,\nfloat Inner_Fade,\nfloat Blob_Pulse,\nfloat Blob_Fade,\nfloat Blob_Enabled,\nfloat DistanceOffset,\nout vec3 Out_Position,\nout vec2 Out_UV,\nout vec3 Blob_Info,\nout vec2 Blob_Relative_UV)\n{float blobSize,fadeIn;vec3 Hit_Position;Blob_Info=vec3(0.0,0.0,0.0);float Hit_Distance=dot(Blob_Position-Face_Center,Normal)+DistanceOffset*Blob_Far_Distance;Hit_Position=Blob_Position-Hit_Distance*Normal;float absD=abs(Hit_Distance);float lerpVal=clamp((absD-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);fadeIn=1.0-clamp((absD-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float innerFade=1.0-clamp(-Hit_Distance/Inner_Fade,0.0,1.0);float farClip=clamp(1.0-step(Blob_Far_Distance+Blob_Fade_Length,absD),0.0,1.0);float size=mix(Blob_Near_Size,Blob_Far_Size,lerpVal)*farClip;blobSize=mix(size,Selection_Fade_Size,Selection_Fade)*innerFade*Blob_Enabled;Blob_Info.x=lerpVal*0.5+0.5;Blob_Info.y=fadeIn*Intensity*(1.0-Selection_Fade)*Blob_Fade;Blob_Info.x*=(1.0-Blob_Pulse);vec3 delta=Hit_Position-Face_Center;vec2 blobCenterXY=vec2(dot(delta,Tangent),dot(delta,Bitangent));vec2 quadUVin=2.0*UV-1.0; \nvec2 blobXY=blobCenterXY+quadUVin*blobSize;vec2 blobClipped=clamp(blobXY,-Face_Size*0.5,Face_Size*0.5);vec2 blobUV=(blobClipped-blobCenterXY)/max(blobSize,0.0001)*2.0;vec3 blobCorner=Face_Center+blobClipped.x*Tangent+blobClipped.y*Bitangent;Out_Position=mix(Position,blobCorner,Vx_Color.rrr);Out_UV=mix(In_UV,blobUV,Vx_Color.rr);Blob_Relative_UV=blobClipped/Face_Size.y;}\nvoid Round_Rect_Vertex_B36(\nvec2 UV,\nvec3 Tangent,\nvec3 Binormal,\nfloat Radius,\nfloat Anisotropy,\nvec2 Blob_Center_UV,\nout vec2 Rect_UV,\nout vec2 Scale_XY,\nout vec4 Rect_Parms)\n{Scale_XY=vec2(Anisotropy,1.0);Rect_UV=(UV-vec2(0.5,0.5))*Scale_XY;Rect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius);Rect_Parms.zw=Blob_Center_UV;}\nvec2 ProjectProximity(\nvec3 blobPosition,\nvec3 position,\nvec3 center,\nvec3 dir,\nvec3 xdir,\nvec3 ydir,\nout float vdistance\n)\n{vec3 delta=blobPosition-position;vec2 xy=vec2(dot(delta,xdir),dot(delta,ydir));vdistance=abs(dot(delta,dir));return xy;}\nvoid Proximity_Vertex_B33(\nvec3 Blob_Position,\nvec3 Blob_Position_2,\nvec3 Face_Center,\nvec3 Position,\nfloat Proximity_Far_Distance,\nfloat Relative_Scale,\nfloat Proximity_Anisotropy,\nvec3 Normal,\nvec3 Tangent,\nvec3 Binormal,\nout vec4 Extra,\nout float Distance_To_Face,\nout float Distance_Fade1,\nout float Distance_Fade2)\n{float distz1,distz2;Extra.xy=ProjectProximity(Blob_Position,Position,Face_Center,Normal,Tangent*Proximity_Anisotropy,Binormal,distz1)/Relative_Scale;Extra.zw=ProjectProximity(Blob_Position_2,Position,Face_Center,Normal,Tangent*Proximity_Anisotropy,Binormal,distz2)/Relative_Scale;Distance_To_Face=dot(Normal,Position-Face_Center);Distance_Fade1=1.0-clamp(distz1/Proximity_Far_Distance,0.0,1.0);Distance_Fade2=1.0-clamp(distz2/Proximity_Far_Distance,0.0,1.0);}\nvoid Object_To_World_Pos_B12(\nvec3 Pos_Object,\nout vec3 Pos_World)\n{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}\nvoid Choose_Blob_B27(\nvec4 Vx_Color,\nvec3 Position1,\nvec3 Position2,\nbool Blob_Enable_1,\nbool Blob_Enable_2,\nfloat Near_Size_1,\nfloat Near_Size_2,\nfloat Blob_Inner_Fade_1,\nfloat Blob_Inner_Fade_2,\nfloat Blob_Pulse_1,\nfloat Blob_Pulse_2,\nfloat Blob_Fade_1,\nfloat Blob_Fade_2,\nout vec3 Position,\nout float Near_Size,\nout float Inner_Fade,\nout float Blob_Enable,\nout float Fade,\nout float Pulse)\n{Position=Position1*(1.0-Vx_Color.g)+Vx_Color.g*Position2;float b1=Blob_Enable_1 ? 1.0 : 0.0;float b2=Blob_Enable_2 ? 1.0 : 0.0;Blob_Enable=b1+(b2-b1)*Vx_Color.g;Pulse=Blob_Pulse_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Pulse_2;Fade=Blob_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Fade_2;Near_Size=Near_Size_1*(1.0-Vx_Color.g)+Vx_Color.g*Near_Size_2;Inner_Fade=Blob_Inner_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Inner_Fade_2;}\nvoid Move_Verts_B32(\nvec2 UV,\nfloat Radius,\nfloat Anisotropy,\nfloat Line_Width,\nfloat Visible,\nout vec3 New_P,\nout vec2 New_UV)\n{vec2 xy=2.0*UV-vec2(0.5,0.5);vec2 center=clamp(xy,0.0,1.0);vec2 delta=2.0*(xy-center);float deltaLength=length(delta);vec2 aniso=vec2(1.0/Anisotropy,1.0);center=(center-vec2(0.5,0.5))*(1.0-2.0*Radius*aniso);New_UV=vec2((2.0-2.0*deltaLength)*Visible,0.0);float deltaRadius= (Radius-Line_Width*New_UV.x);New_P.xy=(center+deltaRadius/deltaLength *aniso*delta);New_P.z=0.0;}\nvoid Object_To_World_Dir_B14(\nvec3 Dir_Object,\nout vec3 Binormal_World)\n{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;}\nvoid Proximity_Visibility_B55(\nfloat Selection,\nvec3 Proximity_Center,\nvec3 Proximity_Center_2,\nfloat Proximity_Far_Distance,\nfloat Proximity_Radius,\nvec3 Face_Center,\nvec3 Normal,\nvec2 Face_Size,\nfloat Gaze,\nout float Width)\n{float boxMaxSize=length(Face_Size)*0.5;float d1=dot(Proximity_Center-Face_Center,Normal);vec3 blob1=Proximity_Center-d1*Normal;float d2=dot(Proximity_Center_2-Face_Center,Normal);vec3 blob2=Proximity_Center_2-d2*Normal;vec3 delta1=blob1-Face_Center;vec3 delta2=blob2-Face_Center;float dist1=dot(delta1,delta1);float dist2=dot(delta2,delta2);float nearestProxDist=sqrt(min(dist1,dist2));Width=(1.0-step(boxMaxSize+Proximity_Radius,nearestProxDist))*(1.0-step(Proximity_Far_Distance,min(d1,d2))*(1.0-step(0.0001,Selection)));Width=max(Gaze,Width);}\nvec2 ramp2(vec2 start,vec2 end,vec2 x)\n{return clamp((x-start)/(end-start),vec2(0.0,0.0),vec2(1.0,1.0));}\nfloat computeSelection(\nvec3 blobPosition,\nvec3 normal,\nvec3 tangent,\nvec3 bitangent,\nvec3 faceCenter,\nvec2 faceSize,\nfloat selectionFuzz,\nfloat farDistance,\nfloat fadeLength\n)\n{vec3 delta=blobPosition-faceCenter;float absD=abs(dot(delta,normal));float fadeIn=1.0-clamp((absD-farDistance)/fadeLength,0.0,1.0);vec2 blobCenterXY=vec2(dot(delta,tangent),dot(delta,bitangent));vec2 innerFace=faceSize*(1.0-selectionFuzz)*0.5;vec2 selectPulse=ramp2(-faceSize*0.5,-innerFace,blobCenterXY)-ramp2(innerFace,faceSize*0.5,blobCenterXY);return selectPulse.x*selectPulse.y*fadeIn;}\nvoid Selection_Vertex_B31(\nvec3 Blob_Position,\nvec3 Blob_Position_2,\nvec3 Face_Center,\nvec2 Face_Size,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nfloat Selection_Fuzz,\nfloat Selected,\nfloat Far_Distance,\nfloat Fade_Length,\nvec3 Active_Face_Dir,\nout float Show_Selection)\n{float select1=computeSelection(Blob_Position,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);float select2=computeSelection(Blob_Position_2,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);Show_Selection=mix(max(select1,select2),1.0,Selected);}\nvoid main()\n{vec3 Vec3_Q29=vec3(vec2(0,0).x,vec2(0,0).y,color.r);vec3 Nrm_World_Q24;Nrm_World_Q24=normalize((world*vec4(normal,0.0)).xyz);vec3 Face_Center_Q30;Face_Center_Q30=(world*vec4(vec3(0,0,0),1.0)).xyz;vec3 Tangent_World_Q13;Tangent_World_Q13=(world*vec4(tangent,0.0)).xyz;vec3 Result_Q42;Result_Q42=_Use_Global_Left_Index_ ? Global_Left_Index_Tip_Position.xyz : _Blob_Position_;vec3 Result_Q43;Result_Q43=_Use_Global_Right_Index_ ? Global_Right_Index_Tip_Position.xyz : _Blob_Position_2_;float Value_At_T_Q58=mix(_Blob_Near_Size_,_Blob_Pulse_Max_Size_,_Blob_Pulse_);float Value_At_T_Q59=mix(_Blob_Near_Size_2_,_Blob_Pulse_Max_Size_,_Blob_Pulse_2_);vec3 Cross_Q70=cross(normal,tangent);float Product_Q45=_Gaze_Intensity_*_Gaze_Focus_;float Step_Q46=step(0.0001,Product_Q45);vec3 Tangent_World_N_Q15=normalize(Tangent_World_Q13);vec3 Position_Q27;float Near_Size_Q27;float Inner_Fade_Q27;float Blob_Enable_Q27;float Fade_Q27;float Pulse_Q27;Choose_Blob_B27(color,Result_Q42,Result_Q43,_Blob_Enable_,_Blob_Enable_2_,Value_At_T_Q58,Value_At_T_Q59,_Blob_Inner_Fade_,_Blob_Inner_Fade_2_,_Blob_Pulse_,_Blob_Pulse_2_,_Blob_Fade_,_Blob_Fade_2_,Position_Q27,Near_Size_Q27,Inner_Fade_Q27,Blob_Enable_Q27,Fade_Q27,Pulse_Q27);vec3 Binormal_World_Q14;Object_To_World_Dir_B14(Cross_Q70,Binormal_World_Q14);float Anisotropy_Q21=length(Tangent_World_Q13)/length(Binormal_World_Q14);vec3 Binormal_World_N_Q16=normalize(Binormal_World_Q14);vec2 Face_Size_Q35;float ScaleY_Q35;Face_Size_Q35=vec2(length(Tangent_World_Q13),length(Binormal_World_Q14));ScaleY_Q35=Face_Size_Q35.y;float Out_Radius_Q38;float Out_Line_Width_Q38;Out_Radius_Q38=_Relative_To_Height_ ? _Radius_ : _Radius_/ScaleY_Q35;Out_Line_Width_Q38=_Relative_To_Height_ ? _Line_Width_ : _Line_Width_/ScaleY_Q35;float Show_Selection_Q31;Selection_Vertex_B31(Result_Q42,Result_Q43,Face_Center_Q30,Face_Size_Q35,Nrm_World_Q24,Tangent_World_N_Q15,Binormal_World_N_Q16,_Selection_Fuzz_,_Selected_,_Selected_Distance_,_Selected_Fade_Length_,vec3(0,0,-1),Show_Selection_Q31);float MaxAB_Q41=max(Show_Selection_Q31,Product_Q45);float Width_Q55;Proximity_Visibility_B55(Show_Selection_Q31,Result_Q42,Result_Q43,_Proximity_Far_Distance_,_Proximity_Near_Radius_,Face_Center_Q30,Nrm_World_Q24,Face_Size_Q35,Step_Q46,Width_Q55);vec3 New_P_Q32;vec2 New_UV_Q32;Move_Verts_B32(uv,Out_Radius_Q38,Anisotropy_Q21,Out_Line_Width_Q38,Width_Q55,New_P_Q32,New_UV_Q32);vec3 Pos_World_Q12;Object_To_World_Pos_B12(New_P_Q32,Pos_World_Q12);vec3 Out_Position_Q40;vec2 Out_UV_Q40;vec3 Blob_Info_Q40;vec2 Blob_Relative_UV_Q40;Blob_Vertex_B40(Pos_World_Q12,Nrm_World_Q24,Tangent_World_N_Q15,Binormal_World_N_Q16,Position_Q27,_Blob_Intensity_,Near_Size_Q27,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,color,uv,Face_Center_Q30,Face_Size_Q35,New_UV_Q32,_Blob_Fade_Length_,_Selection_Fade_,_Selection_Fade_Size_,Inner_Fade_Q27,Pulse_Q27,Fade_Q27,Blob_Enable_Q27,0.0,Out_Position_Q40,Out_UV_Q40,Blob_Info_Q40,Blob_Relative_UV_Q40);vec2 Rect_UV_Q36;vec2 Scale_XY_Q36;vec4 Rect_Parms_Q36;Round_Rect_Vertex_B36(New_UV_Q32,Tangent_World_Q13,Binormal_World_Q14,Out_Radius_Q38,Anisotropy_Q21,Blob_Relative_UV_Q40,Rect_UV_Q36,Scale_XY_Q36,Rect_Parms_Q36);vec4 Extra_Q33;float Distance_To_Face_Q33;float Distance_Fade1_Q33;float Distance_Fade2_Q33;Proximity_Vertex_B33(Result_Q42,Result_Q43,Face_Center_Q30,Pos_World_Q12,_Proximity_Far_Distance_,1.0,_Proximity_Anisotropy_,Nrm_World_Q24,Tangent_World_N_Q15,Binormal_World_N_Q16,Extra_Q33,Distance_To_Face_Q33,Distance_Fade1_Q33,Distance_Fade2_Q33);vec4 Vec4_Q37=vec4(MaxAB_Q41,Distance_Fade1_Q33,Distance_Fade2_Q33,Out_Radius_Q38);vec3 Position=Out_Position_Q40;vec3 Normal=Vec3_Q29;vec2 UV=Out_UV_Q40;vec3 Tangent=Blob_Info_Q40;vec3 Binormal=vec3(0,0,0);vec4 Color=vec4(1,1,1,1);vec4 Extra1=Rect_Parms_Q36;vec4 Extra2=Extra_Q33;vec4 Extra3=Vec4_Q37;gl_Position=viewProjection*vec4(Position,1);vNormal=Normal;vUV=UV;vTangent=Tangent;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}";class Sx extends wt.M{constructor(){super(),this.SMOOTH_EDGES=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class Ex extends Ot.E{constructor(e,t){super(e,t),this.radius=.12,this.lineWidth=.01,this.relativeToHeight=!1,this._filterWidth=1,this.edgeColor=new bt.ov(.53,.53,.53,1),this.blobEnable=!0,this.blobPosition=new gt.Pq(100,100,100),this.blobIntensity=.5,this.blobNearSize=.032,this.blobFarSize=.048,this.blobNearDistance=.008,this.blobFarDistance=.064,this.blobFadeLength=.04,this.blobInnerFade=.01,this.blobPulse=0,this.blobFade=1,this.blobPulseMaxSize=.05,this.blobEnable2=!0,this.blobPosition2=new gt.Pq(10,10.1,-.6),this.blobNearSize2=.008,this.blobInnerFade2=.1,this.blobPulse2=0,this.blobFade2=1,this.gazeIntensity=.8,this.gazeFocus=0,this.selectionFuzz=.5,this.selected=1,this.selectionFade=.2,this.selectionFadeSize=0,this.selectedDistance=.08,this.selectedFadeLength=.08,this.proximityMaxIntensity=.45,this.proximityFarDistance=.16,this.proximityNearRadius=.016,this.proximityAnisotropy=1,this.useGlobalLeftIndex=!0,this.useGlobalRightIndex=!0,this.fadeOut=1,this.alphaMode=ui.Y.ALPHA_ADD,this.disableDepthWrite=!0,this.backFaceCulling=!1,this._blobTexture=new Dt.g(Ex.BLOB_TEXTURE_URL,t,!0,!1,Dt.g.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!0}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new Sx);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;const n=r.getEngine();if((0,Ut.qB)(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const e=new Nt.J;s.FOG&&e.addFallback(1,"FOG"),(0,Ut.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;const i=[Mt.R.PositionKind];s.NORMAL&&i.push(Mt.R.NormalKind),s.UV1&&i.push(Mt.R.UVKind),s.UV2&&i.push(Mt.R.UV2Kind),s.VERTEXCOLOR&&i.push(Mt.R.ColorKind),s.TANGENT&&i.push(Mt.R.TangentKind),(0,Ut.ER)(i,s);const o="mrdlFrontplate",a=s.toString(),h=["world","worldView","worldViewProjection","view","projection","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Relative_To_Height_","_Filter_Width_","_Edge_Color_","_Fade_Out_","_Smooth_Edges_","_Blob_Enable_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Inner_Fade_","_Blob_Pulse_","_Blob_Fade_","_Blob_Pulse_Max_Size_","_Blob_Enable_2_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Inner_Fade_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Gaze_Intensity_","_Gaze_Focus_","_Blob_Texture_","_Selection_Fuzz_","_Selected_","_Selection_Fade_","_Selection_Fade_Size_","_Selected_Distance_","_Selected_Fade_Length_","_Proximity_Max_Intensity_","_Proximity_Far_Distance_","_Proximity_Near_Radius_","_Proximity_Anisotropy_","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","_Use_Global_Left_Index_","_Use_Global_Right_Index_"],l=[],c=[];(0,Ut.Bb)({uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect(o,{attributes:i,uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),s)}return!(!t.effect||!t.effect.isReady()||(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,0))}bindForSubMesh(e,t,i){const s=this.getScene();if(!i.materialDefines)return;const r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",s.activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Relative_To_Height_",this.relativeToHeight?1:0),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Edge_Color_",this.edgeColor),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._activeEffect.setFloat("_Blob_Enable_",this.blobEnable?1:0),this._activeEffect.setVector3("_Blob_Position_",this.blobPosition),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Inner_Fade_",this.blobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setFloat("_Blob_Pulse_Max_Size_",this.blobPulseMaxSize),this._activeEffect.setFloat("_Blob_Enable_2_",this.blobEnable2?1:0),this._activeEffect.setVector3("_Blob_Position_2_",this.blobPosition2),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Inner_Fade_2_",this.blobInnerFade2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setFloat("_Gaze_Intensity_",this.gazeIntensity),this._activeEffect.setFloat("_Gaze_Focus_",this.gazeFocus),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Selection_Fuzz_",this.selectionFuzz),this._activeEffect.setFloat("_Selected_",this.selected),this._activeEffect.setFloat("_Selection_Fade_",this.selectionFade),this._activeEffect.setFloat("_Selection_Fade_Size_",this.selectionFadeSize),this._activeEffect.setFloat("_Selected_Distance_",this.selectedDistance),this._activeEffect.setFloat("_Selected_Fade_Length_",this.selectedFadeLength),this._activeEffect.setFloat("_Proximity_Max_Intensity_",this.proximityMaxIntensity),this._activeEffect.setFloat("_Proximity_Far_Distance_",this.proximityFarDistance),this._activeEffect.setFloat("_Proximity_Near_Radius_",this.proximityNearRadius),this._activeEffect.setFloat("_Proximity_Anisotropy_",this.proximityAnisotropy),this._activeEffect.setFloat("_Use_Global_Left_Index_",this.useGlobalLeftIndex?1:0),this._activeEffect.setFloat("_Use_Global_Right_Index_",this.useGlobalRightIndex?1:0),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return Vt.p.Clone((()=>new Ex(e,this.getScene())),this)}serialize(){const e=Vt.p.Serialize(this);return e.customType="BABYLON.MRDLFrontplateMaterial",e}getClassName(){return"MRDLFrontplateMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new Ex(e.name,t)),e,t,i)}}Ex.BLOB_TEXTURE_URL="",(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"radius",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"lineWidth",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"relativeToHeight",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"edgeColor",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobEnable",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobPosition",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobNearSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobFarSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobNearDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobFarDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobFadeLength",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobInnerFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobPulse",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobPulseMaxSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobEnable2",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobPosition2",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobNearSize2",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobInnerFade2",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobPulse2",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"blobFade2",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"gazeIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"gazeFocus",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"selectionFuzz",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"selected",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"selectionFade",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"selectionFadeSize",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"selectedDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"selectedFadeLength",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"proximityMaxIntensity",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"proximityFarDistance",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"proximityNearRadius",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"proximityAnisotropy",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"useGlobalLeftIndex",void 0),(0,Et.Cg)([(0,Rt.lK)()],Ex.prototype,"useGlobalRightIndex",void 0),(0,Ft.Y5)("BABYLON.GUI.MRDLFrontplateMaterial",Ex);Ma.l.ShadersStore.mrdlInnerquadPixelShader="uniform vec3 cameraPosition;varying vec2 vUV;varying vec3 vTangent;uniform vec4 _Color_;uniform float _Radius_;uniform bool _Fixed_Radius_;uniform float _Filter_Width_;uniform float _Glow_Fraction_;uniform float _Glow_Max_;uniform float _Glow_Falloff_;float FilterStep_Bid194(float edge,float x,float filterWidth)\n{float dx=max(1.0E-5,fwidth(x)*filterWidth);return max((x+dx*0.5-max(edge,x-dx*0.5))/dx,0.0);}\nvoid Round_Rect_B194(\nfloat Size_X,\nfloat Size_Y,\nfloat Radius,\nvec4 Rect_Color,\nfloat Filter_Width,\nvec2 UV,\nfloat Glow_Fraction,\nfloat Glow_Max,\nfloat Glow_Falloff,\nout vec4 Color)\n{vec2 halfSize=vec2(Size_X,Size_Y)*0.5;vec2 r=max(min(vec2(Radius,Radius),halfSize),vec2(0.01,0.01));vec2 v=abs(UV);vec2 nearestp=min(v,halfSize-r);vec2 delta=(v-nearestp)/max(vec2(0.01,0.01),r);float Distance=length(delta);float insideRect=1.0-FilterStep_Bid194(1.0-Glow_Fraction,Distance,Filter_Width);float glow=clamp((1.0-Distance)/Glow_Fraction,0.0,1.0);glow=pow(glow,Glow_Falloff);Color=Rect_Color*max(insideRect,glow*Glow_Max);}\nvoid main()\n{float X_Q192;float Y_Q192;float Z_Q192;X_Q192=vTangent.x;Y_Q192=vTangent.y;Z_Q192=vTangent.z;vec4 Color_Q194;Round_Rect_B194(X_Q192,1.0,Y_Q192,_Color_,_Filter_Width_,vUV,_Glow_Fraction_,_Glow_Max_,_Glow_Falloff_,Color_Q194);vec4 Out_Color=Color_Q194;float Clip_Threshold=0.0;gl_FragColor=Out_Color;}\n";Ma.l.ShadersStore.mrdlInnerquadVertexShader="uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;attribute vec4 color;uniform vec4 _Color_;uniform float _Radius_;uniform bool _Fixed_Radius_;uniform float _Filter_Width_;uniform float _Glow_Fraction_;uniform float _Glow_Max_;uniform float _Glow_Falloff_;varying vec2 vUV;varying vec3 vTangent;void main()\n{vec3 Pos_World_Q189;Pos_World_Q189=(world*vec4(position,1.0)).xyz;vec3 Dir_World_Q190;Dir_World_Q190=(world*vec4(tangent,0.0)).xyz;vec3 Dir_World_Q191;Dir_World_Q191=(world*vec4((cross(normal,tangent)),0.0)).xyz;float Length_Q180=length(Dir_World_Q190);float Length_Q181=length(Dir_World_Q191);float Quotient_Q184=Length_Q180/Length_Q181;float Quotient_Q195=_Radius_/Length_Q181;vec2 Result_Q193;Result_Q193=vec2((uv.x-0.5)*Length_Q180/Length_Q181,(uv.y-0.5));float Result_Q198=_Fixed_Radius_ ? Quotient_Q195 : _Radius_;vec3 Vec3_Q183=vec3(Quotient_Q184,Result_Q198,0);vec3 Position=Pos_World_Q189;vec3 Normal=vec3(0,0,0);vec2 UV=Result_Q193;vec3 Tangent=Vec3_Q183;vec3 Binormal=vec3(0,0,0);vec4 Color=color;gl_Position=viewProjection*vec4(Position,1);vUV=UV;vTangent=Tangent;}\n";class Rx extends wt.M{constructor(){super(),this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class Px extends Ot.E{constructor(e,t){super(e,t),this.color=new bt.ov(1,1,1,.05),this.radius=.12,this.fixedRadius=!0,this._filterWidth=1,this.glowFraction=0,this.glowMax=.5,this.glowFalloff=2,this.alphaMode=ui.Y.ALPHA_COMBINE,this.backFaceCulling=!1}needAlphaBlending(){return!0}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new Rx);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;const n=r.getEngine();if((0,Ut.qB)(e,s,!0,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const e=new Nt.J;s.FOG&&e.addFallback(1,"FOG"),(0,Ut.c4)(s,e),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;const i=[Mt.R.PositionKind];s.NORMAL&&i.push(Mt.R.NormalKind),s.UV1&&i.push(Mt.R.UVKind),s.UV2&&i.push(Mt.R.UV2Kind),s.VERTEXCOLOR&&i.push(Mt.R.ColorKind),s.TANGENT&&i.push(Mt.R.TangentKind),(0,Ut.ER)(i,s);const o="mrdlInnerquad",a=s.toString(),h=["world","worldView","worldViewProjection","view","projection","viewProjection","cameraPosition","_Color_","_Radius_","_Fixed_Radius_","_Filter_Width_","_Glow_Fraction_","_Glow_Max_","_Glow_Falloff_"],l=[],c=[];(0,Ut.Bb)({uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:s,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect(o,{attributes:i,uniformsNames:h,uniformBuffersNames:c,samplers:l,defines:a,fallbacks:e,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),s)}return!(!t.effect||!t.effect.isReady()||(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,0))}bindForSubMesh(e,t,i){const s=this.getScene();if(!i.materialDefines)return;const r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",s.activeCamera.position),this._activeEffect.setDirectColor4("_Color_",this.color),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Fixed_Radius_",this.fixedRadius?1:0),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setFloat("_Glow_Fraction_",this.glowFraction),this._activeEffect.setFloat("_Glow_Max_",this.glowMax),this._activeEffect.setFloat("_Glow_Falloff_",this.glowFalloff),this._afterBind(t,this._activeEffect,i))}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return Vt.p.Clone((()=>new Px(e,this.getScene())),this)}serialize(){const e=Vt.p.Serialize(this);return e.customType="BABYLON.MRDLInnerquadMaterial",e}getClassName(){return"MRDLInnerquadMaterial"}static Parse(e,t,i){return Vt.p.Parse((()=>new Px(e.name,t)),e,t,i)}}(0,Et.Cg)([(0,Rt.lK)()],Px.prototype,"color",void 0),(0,Et.Cg)([(0,Rt.lK)()],Px.prototype,"radius",void 0),(0,Et.Cg)([(0,Rt.lK)()],Px.prototype,"fixedRadius",void 0),(0,Et.Cg)([(0,Rt.lK)()],Px.prototype,"glowFraction",void 0),(0,Et.Cg)([(0,Rt.lK)()],Px.prototype,"glowMax",void 0),(0,Et.Cg)([(0,Rt.lK)()],Px.prototype,"glowFalloff",void 0),(0,Ft.Y5)("BABYLON.GUI.MRDLInnerquadMaterial",Px);class Ix extends Ky{_disposeTooltip(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)}set renderingGroupId(e){this._backPlate.renderingGroupId=e,this._textPlate.renderingGroupId=e,this._frontPlate.renderingGroupId=e,this._backGlow.renderingGroupId=e,this._innerQuad.renderingGroupId=e,this._tooltipMesh&&(this._tooltipMesh.renderingGroupId=e)}get renderingGroupId(){return this._backPlate.renderingGroupId}get mesh(){return this._backPlate}set tooltipText(e){if(e){if(!this._tooltipFade){const e=this._backPlate._scene.useRightHandedSystem;this._tooltipMesh=ko("",{size:1},this._backPlate._scene),this._tooltipMesh.position=gt.Pq.Down().scale(.7).add(gt.Pq.Forward(e).scale(-.15)),this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._frontPlateCollisionMesh,this._tooltipTexture=Ms.CreateForMesh(this._tooltipMesh);const t=new cr;t.height=.25,t.width=.8,t.cornerRadius=25,t.color="#ffffff",t.thickness=20,t.background="#060668",this._tooltipTexture.addControl(t),this._tooltipTextBlock=new lr,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=100,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new Xy,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add((()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!0)})),this._tooltipOutObserver=this.onPointerOutObservable.add((()=>{this._tooltipFade&&this._tooltipFade.fadeIn(!1)}))}this._tooltipTextBlock&&(this._tooltipTextBlock.text=e)}else this._disposeTooltip()}get tooltipText(){return this._tooltipTextBlock?.text||null}get text(){return this._text}set text(e){this._text!==e&&(this._text=e,this._rebuildContent())}get subtext(){return this._subtext}set subtext(e){this._subtext!==e&&(this._subtext=e,this._rebuildContent())}get imageUrl(){return this._imageUrl}set imageUrl(e){this._imageUrl!==e&&(this._imageUrl=e,this._rebuildContent())}get backMaterial(){return this._backMaterial}get frontMaterial(){return this._frontMaterial}get backGlowMaterial(){return this._backGlowMaterial}get innerQuadMaterial(){return this._innerQuadMaterial}get plateMaterial(){return this._plateMaterial}get shareMaterials(){return this._shareMaterials}set isBackplateVisible(e){this.mesh&&this._backMaterial&&(e&&!this._isBackplateVisible?this._backPlate.visibility=1:!e&&this._isBackplateVisible&&(this._backPlate.visibility=0)),this._isBackplateVisible=e}constructor(e,t=!0){super(e),this.width=1,this.height=1,this.radius=.14,this.textSizeInPixels=18,this.imageSizeInPixels=40,this.plateMaterialColor=new bt.v9(.4,.4,.4),this.frontPlateDepth=.2,this.backPlateDepth=.04,this.backGlowOffset=.1,this.flatPlaneDepth=.001,this.innerQuadRadius=this.radius-.04,this.innerQuadColor=new bt.ov(0,0,0,0),this.innerQuadToggledColor=new bt.ov(.5197843,.6485234,.9607843,.6),this.innerQuadHoverColor=new bt.ov(1,1,1,.05),this.innerQuadToggledHoverColor=new bt.ov(.5197843,.6485234,.9607843,1),this._isBackplateVisible=!0,this._shareMaterials=!0,this._shareMaterials=t,this.pointerEnterAnimation=()=>{this._frontPlate&&this._textPlate&&!this.isToggleButton&&this._performEnterExitAnimation(1),this.isToggleButton&&this._innerQuadMaterial&&(this.isToggled?this._innerQuadMaterial.color=this.innerQuadToggledHoverColor:this._innerQuadMaterial.color=this.innerQuadHoverColor)},this.pointerOutAnimation=()=>{this._frontPlate&&this._textPlate&&!this.isToggleButton&&this._performEnterExitAnimation(-.8),this.isToggleButton&&this._innerQuadMaterial&&this._onToggle(this.isToggled)},this.pointerDownAnimation=()=>{},this.pointerUpAnimation=()=>{},this._pointerClickObserver=this.onPointerClickObservable.add((()=>{this._frontPlate&&this._backGlow&&!this.isActiveNearInteraction&&this._performClickAnimation(),this.isToggleButton&&this._innerQuadMaterial&&this._onToggle(this.isToggled)})),this._pointerEnterObserver=this.onPointerEnterObservable.add((()=>{this.pointerEnterAnimation()})),this._pointerOutObserver=this.onPointerOutObservable.add((()=>{this.pointerOutAnimation()})),this._toggleObserver=this.onToggleObservable.add((e=>{this._innerQuadMaterial.color=e?this.innerQuadToggledColor:this.innerQuadColor}))}_getTypeName(){return"TouchHolographicButton"}_rebuildContent(){let e;e=this._getAspectRatio()<=1?this._alignContentVertically():this._alignContentHorizontally(),this.content=e}_getAspectRatio(){return this.width/this.height}_alignContentVertically(){const e=new ey;if(e.isVertical=!0,(0,Fh.Nf)()&&document.createElement&&this._imageUrl){const t=new hr;t.source=this._imageUrl,t.heightInPixels=180,t.widthInPixels=100,t.paddingTopInPixels=40,t.paddingBottomInPixels=40,e.addControl(t)}if(this._text){const t=new lr;t.text=this._text,t.color="white",t.heightInPixels=30,t.fontSize=24,e.addControl(t)}return e}_alignContentHorizontally(){let e=240;const t=15,i=new cr;i.widthInPixels=e,i.heightInPixels=e,i.color="transparent",i.setPaddingInPixels(t,t,t,t),e-=30;const s=new ey;if(s.isVertical=!1,s.scaleY=this._getAspectRatio(),(0,Fh.Nf)()&&document.createElement&&this._imageUrl){const t=new cr(`${this.name}_image`);t.widthInPixels=this.imageSizeInPixels,t.heightInPixels=this.imageSizeInPixels,t.color="transparent",e-=this.imageSizeInPixels;const i=new hr;i.source=this._imageUrl,t.addControl(i),s.addControl(t)}if(this._text){const i=new lr(`${this.name}_text`);if(i.text=this._text,i.color="white",i.fontSize=this.textSizeInPixels,i.widthInPixels=e,this._imageUrl&&(i.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,i.paddingLeftInPixels=t),this._subtext){const r=new iy;r.addColumnDefinition(1),r.addRowDefinition(.5),r.addRowDefinition(.5),r.widthInPixels=e,r.heightInPixels=45;const n=new lr(`${this.name}_subtext`);n.text=this._subtext,n.color="#EEEEEEAB",n.fontSize=.75*this.textSizeInPixels,n.fontWeight="600",this._imageUrl&&(n.textHorizontalAlignment=xs.HORIZONTAL_ALIGNMENT_LEFT,n.paddingLeftInPixels=t),r.addControl(i,0),r.addControl(n,1),s.addControl(r)}else s.addControl(i)}return i.addControl(s),i}_createNode(e){this.name=this.name??"TouchHolographicButton";const t=this._createBackPlate(e),i=this._createFrontPlate(e),s=this._createInnerQuad(e),r=this._createBackGlow(e);this._frontPlateCollisionMesh=i,this._textPlate=super._createNode(e),this._textPlate.name=`${this.name}_textPlate`,this._textPlate.isPickable=!1,this._textPlate.scaling.x=this.width,this._textPlate.parent=i,this._backPlate=t,this._backPlate.position=gt.Pq.Forward(e.useRightHandedSystem).scale(this.backPlateDepth/2),this._backPlate.isPickable=!1,this._backPlate.addChild(i),this._backPlate.addChild(s),r&&this._backPlate.addChild(r);const n=new Gn.V(`${this.name}_root`,e);return this._backPlate.setParent(n),this.collisionMesh=i,this.collidableFrontDirection=this._backPlate.forward.negate(),n}_createBackPlate(e){const t=so(`${this.name}_backPlate`,{},e);t.isPickable=!1,t.visibility=0,t.scaling.z=.2;const i=$i.S0.GetAssetUrl(Ix.MRTK_ASSET_BASE_URL);return Ue.cn.ImportMeshAsync(void 0,i,Ix.BACKPLATE_MODEL_FILENAME,e).then((e=>{const i=e.meshes[1];i.visibility=0,this._isBackplateVisible&&(i.visibility=1,i.name=`${this.name}_backPlate`,i.isPickable=!1,i.scaling.x=this.width,i.scaling.y=this.height,i.parent=t),this._backMaterial&&(i.material=this._backMaterial),this._backPlate=i})),t}_createFrontPlate(e){const t=so(`${this.name}_frontPlate`,{width:this.width,height:this.height,depth:this.frontPlateDepth},e);t.isPickable=!0,t.isNearPickable=!0,t.visibility=0,t.position=gt.Pq.Forward(e.useRightHandedSystem).scale((this.backPlateDepth-this.frontPlateDepth)/2);const i=$i.S0.GetAssetUrl(Ix.MRTK_ASSET_BASE_URL);return Ue.cn.ImportMeshAsync(void 0,i,Ix.FRONTPLATE_MODEL_FILENAME,e).then((i=>{const s=so(`${this.name}_collisionPlate`,{width:this.width,height:this.height},e);s.isPickable=!1,s.scaling.z=this.frontPlateDepth,s.visibility=0,s.parent=t,this._collisionPlate=s;const r=i.meshes[1];r.name=`${this.name}_frontPlate`,r.isPickable=!1,r.scaling.x=this.width-this.backGlowOffset,r.scaling.y=this.height-this.backGlowOffset,r.position=gt.Pq.Forward(e.useRightHandedSystem).scale(-.5),r.parent=s,this.isToggleButton&&(r.visibility=0),this._frontMaterial&&(r.material=this._frontMaterial),this._textPlate.scaling.x=1,this._textPlate.parent=r,this._frontPlate=r})),t}_createInnerQuad(e){const t=so(`${this.name}_innerQuad`,{},e);t.isPickable=!1,t.visibility=0,t.scaling.z=this.flatPlaneDepth,t.position.z+=this.backPlateDepth/2-this.flatPlaneDepth;const i=$i.S0.GetAssetUrl(Ix.MRTK_ASSET_BASE_URL);return Ue.cn.ImportMeshAsync(void 0,i,Ix.INNERQUAD_MODEL_FILENAME,e).then((e=>{const i=e.meshes[1];i.name=`${this.name}_innerQuad`,i.isPickable=!1,i.scaling.x=this.width-this.backGlowOffset,i.scaling.y=this.height-this.backGlowOffset,i.parent=t,this._innerQuadMaterial&&(i.material=this._innerQuadMaterial),this._innerQuad=i})),t}_createBackGlow(e){if(this.isToggleButton)return;const t=so(`${this.name}_backGlow`,{},e);t.isPickable=!1,t.visibility=0,t.scaling.z=this.flatPlaneDepth,t.position.z+=this.backPlateDepth/2-2*this.flatPlaneDepth;const i=$i.S0.GetAssetUrl(Ix.MRTK_ASSET_BASE_URL);return Ue.cn.ImportMeshAsync(void 0,i,Ix.BACKGLOW_MODEL_FILENAME,e).then((e=>{const i=e.meshes[1];i.name=`${this.name}_backGlow`,i.isPickable=!1,i.scaling.x=this.width-this.backGlowOffset,i.scaling.y=this.height-this.backGlowOffset,i.parent=t,this._backGlowMaterial&&(i.material=this._backGlowMaterial),this._backGlow=i})),t}_applyFacade(e){this._plateMaterial.emissiveTexture=e,this._plateMaterial.opacityTexture=e,this._plateMaterial.diffuseColor=this.plateMaterialColor}_performClickAnimation(){const e=new xx.AnimationGroup("Click Animation Group"),t=[{name:"backGlowMotion",mesh:this._backGlow,property:"material.motion",keys:[{frame:0,values:[0,0,0]},{frame:20,values:[1,.0144,.0144]},{frame:40,values:[.0027713229489760476,0,0]},{frame:45,values:[.0027713229489760476]}]},{name:"_collisionPlateZSlide",mesh:this._collisionPlate,property:"position.z",keys:[{frame:0,values:[0,0,0]},{frame:20,values:[gt.Pq.Forward(this._collisionPlate._scene.useRightHandedSystem).scale(this.frontPlateDepth/2).z,0,0]},{frame:40,values:[0,.005403332496794331]},{frame:45,values:[0]}]},{name:"_collisionPlateZScale",mesh:this._collisionPlate,property:"scaling.z",keys:[{frame:0,values:[this.frontPlateDepth,0,0]},{frame:20,values:[this.backPlateDepth,0,0]},{frame:40,values:[this.frontPlateDepth,.0054]},{frame:45,values:[this.frontPlateDepth]}]}];for(const i of t){const t=new Ja.X5(i.name,i.property,60,Ja.X5.ANIMATIONTYPE_FLOAT,Ja.X5.ANIMATIONLOOPMODE_CYCLE),s=[];for(const e of i.keys)s.push({frame:e.frame,value:e.values[0],inTangent:e.values[1],outTangent:e.values[2],interpolation:e.values[3]});t.setKeys(s),i.mesh&&e.addTargetedAnimation(t,i.mesh)}e.normalize(0,45),e.speedRatio=1,e.play()}_performEnterExitAnimation(e){const t=new xx.AnimationGroup("Enter Exit Animation Group"),i=[{name:"frontPlateFadeOut",mesh:this._frontPlate,property:"material.fadeOut",keys:[{frame:0,values:[0,0,.025045314830017686,0]},{frame:40,values:[1.00205599570012,.025045314830017686,0,0]}]},{name:"textPlateZSlide",mesh:this._textPlate,property:"position.z",keys:[{frame:0,values:[0,0,0]},{frame:40,values:[gt.Pq.Forward(this._textPlate._scene.useRightHandedSystem).scale(-.15).z,0,0]}]}];for(const e of i){const i=new Ja.X5(e.name,e.property,60,Ja.X5.ANIMATIONTYPE_FLOAT,Ja.X5.ANIMATIONLOOPMODE_CYCLE),s=[];for(const t of e.keys)s.push({frame:t.frame,value:t.values[0],inTangent:t.values[1],outTangent:t.values[2],interpolation:t.values[3]});i.setKeys(s),e.mesh&&t.addTargetedAnimation(i,e.mesh)}t.normalize(0,45),t.speedRatio=e,t.play()}_createBackMaterial(e){this._backMaterial=this._backMaterial??new Tx(this.name+"backPlateMaterial",e.getScene()),this._backMaterial.absoluteSizes=!0,this._backMaterial.radius=this.radius,this._backMaterial.lineWidth=.02}_createFrontMaterial(e){this._frontMaterial=this._frontMaterial??new Ex(this.name+"Front Material",e.getScene()),this.frontMaterial.radius=this.innerQuadRadius,this.frontMaterial.fadeOut=0}_createBackGlowMaterial(e){const t=this.radius+.04;this._backGlowMaterial=this._backGlowMaterial??new Cx(this.name+"Back Glow Material",e.getScene()),this._backGlowMaterial.bevelRadius=t,this._backGlowMaterial.lineWidth=t,this._backGlowMaterial.motion=0}_createInnerQuadMaterial(e){this._innerQuadMaterial=this._innerQuadMaterial??new Px("inner_quad",e.getScene()),this._innerQuadMaterial.radius=this.innerQuadRadius,this.isToggleButton&&(this._innerQuadMaterial.color=this.innerQuadColor)}_createPlateMaterial(e){this._plateMaterial=this._plateMaterial??new ft.F(this.name+"Plate Material",e.getScene()),this._plateMaterial.specularColor=bt.v9.Black()}_onToggle(e){super._onToggle(e)}_affectMaterial(e){this._shareMaterials?(this._host._touchSharedMaterials.mrdlBackplateMaterial?this._backMaterial=this._host._touchSharedMaterials.mrdlBackplateMaterial:(this._createBackMaterial(e),this._host._touchSharedMaterials.mrdlBackplateMaterial=this._backMaterial),this._host._touchSharedMaterials.mrdlFrontplateMaterial?this._frontMaterial=this._host._touchSharedMaterials.mrdlFrontplateMaterial:(this._createFrontMaterial(e),this._host._touchSharedMaterials.mrdlFrontplateMaterial=this._frontMaterial),this._host._touchSharedMaterials.mrdlBackglowMaterial?this._backGlowMaterial=this._host._touchSharedMaterials.mrdlBackglowMaterial:(this._createBackGlowMaterial(e),this._host._touchSharedMaterials.mrdlBackglowMaterial=this._backGlowMaterial),this._host._touchSharedMaterials.mrdlInnerQuadMaterial?this._innerQuadMaterial=this._host._touchSharedMaterials.mrdlInnerQuadMaterial:(this._createInnerQuadMaterial(e),this._host._touchSharedMaterials.mrdlInnerQuadMaterial=this._innerQuadMaterial)):(this._createBackMaterial(e),this._createFrontMaterial(e),this._createBackGlowMaterial(e),this._createInnerQuadMaterial(e)),this._createPlateMaterial(e),this._backPlate.material=this._backMaterial,this._textPlate.material=this._plateMaterial,this._isBackplateVisible||(this._backPlate.visibility=0),this._frontPlate&&(this._frontPlate.material=this._frontMaterial),this._backGlow&&(this._backGlow.material=this._backGlowMaterial),this._innerQuad&&(this._innerQuad.material=this._innerQuadMaterial),this._rebuildContent()}dispose(){super.dispose(),this._disposeTooltip(),this.onPointerClickObservable.remove(this._pointerClickObserver),this.onPointerEnterObservable.remove(this._pointerEnterObserver),this.onPointerOutObservable.remove(this._pointerOutObserver),this.onToggleObservable.remove(this._toggleObserver),this.shareMaterials||(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._backGlowMaterial.dispose(),this._innerQuadMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))}}Ix.MRTK_ASSET_BASE_URL="https://assets.babylonjs.com/core/MRTK/",Ix.FRONTPLATE_MODEL_FILENAME="mrtk-fluent-frontplate.glb",Ix.BACKPLATE_MODEL_FILENAME="mrtk-fluent-backplate.glb",Ix.BACKGLOW_MODEL_FILENAME="mrtk-fluent-button.glb",Ix.INNERQUAD_MODEL_FILENAME="SlateProximity.glb";class Mx{get scene(){return this._scene}get utilityLayer(){return this._utilityLayer}get controlScaling(){return this._customControlScaling}set controlScaling(e){if(this._customControlScaling!==e&&e>0){const t=e/this._customControlScaling;this._customControlScaling=e,this._rootContainer.children.forEach((i=>{i.scaling.scaleInPlace(t),1!==e&&(i._isScaledByManager=!0)}))}}get useRealisticScaling(){return this.controlScaling===Mx.MRTK_REALISTIC_SCALING}set useRealisticScaling(e){this.controlScaling=e?Mx.MRTK_REALISTIC_SCALING:1}constructor(e){this._customControlScaling=1,this._lastControlOver={},this._lastControlDown={},this.onPickedPointChangedObservable=new Zi.cP,this.onPickingObservable=new Zi.cP,this._sharedMaterials={},this._touchSharedMaterials={},this._scene=e||os.q.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add((()=>{this._sceneDisposeObserver=null,this._utilityLayer=null,this.dispose()})),this._utilityLayer=yl._CreateDefaultUtilityLayerFromScene(this._scene),this._utilityLayer.onlyCheckPointerDownEvents=!1,this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.mainSceneTrackerPredicate=e=>e&&e.reservedDataStore?.GUI3D?.control?._node,this._rootContainer=new Dy("RootContainer"),this._rootContainer._host=this;const t=this._utilityLayer.utilityLayerScene;this._pointerOutObserver=this._utilityLayer.onPointerOutObservable.add((e=>{this._handlePointerOut(e,!0)})),this._pointerObserver=t.onPointerObservable.add((e=>{this._doPicking(e)})),this._utilityLayer.utilityLayerScene.autoClear=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,new qa("hemi",gt.Pq.Up(),this._utilityLayer.utilityLayerScene)}_handlePointerOut(e,t){const i=this._lastControlOver[e];i&&(i._onPointerOut(i),delete this._lastControlOver[e]),t&&this._lastControlDown[e]&&(this._lastControlDown[e].forcePointerUp(),delete this._lastControlDown[e]),this.onPickedPointChangedObservable.notifyObservers(null)}_doPicking(e){if(!this._utilityLayer||!this._utilityLayer.shouldRender||!this._utilityLayer.utilityLayerScene.activeCamera)return!1;const t=e.event,i=t.pointerId||0,s=t.button,r=e.pickInfo;if(r&&this.onPickingObservable.notifyObservers(r.pickedMesh),!r||!r.hit)return this._handlePointerOut(i,e.type===tt.Zp.POINTERUP),!1;r.pickedPoint&&this.onPickedPointChangedObservable.notifyObservers(r.pickedPoint);const n=r.pickedMesh.reservedDataStore?.GUI3D?.control;return n&&!n._processObservables(e.type,r.pickedPoint,r.originMesh?.position||null,i,s)&&e.type===tt.Zp.POINTERMOVE&&(this._lastControlOver[i]&&this._lastControlOver[i]._onPointerOut(this._lastControlOver[i]),delete this._lastControlOver[i]),e.type===tt.Zp.POINTERUP&&(this._lastControlDown[t.pointerId]&&(this._lastControlDown[t.pointerId].forcePointerUp(),delete this._lastControlDown[t.pointerId]),("touch"===t.pointerType||"xr"===t.pointerType&&this._scene.getEngine().hostInformation.isMobile)&&this._handlePointerOut(i,!1)),!0}get rootContainer(){return this._rootContainer}containsControl(e){return this._rootContainer.containsControl(e)}addControl(e){return this._rootContainer.addControl(e),1!==this._customControlScaling&&(e.scaling.scaleInPlace(this._customControlScaling),e._isScaledByManager=!0),this}removeControl(e){return this._rootContainer.removeControl(e),e._isScaledByManager&&(e.scaling.scaleInPlace(1/this._customControlScaling),e._isScaledByManager=!1),this}dispose(){this._rootContainer.dispose();for(const e in this._sharedMaterials)Object.prototype.hasOwnProperty.call(this._sharedMaterials,e)&&this._sharedMaterials[e].dispose();this._sharedMaterials={};for(const e in this._touchSharedMaterials)Object.prototype.hasOwnProperty.call(this._touchSharedMaterials,e)&&this._touchSharedMaterials[e].dispose();this._touchSharedMaterials={},this._pointerOutObserver&&this._utilityLayer&&(this._utilityLayer.onPointerOutObservable.remove(this._pointerOutObserver),this._pointerOutObserver=null),this.onPickedPointChangedObservable.clear(),this.onPickingObservable.clear();const e=this._utilityLayer?this._utilityLayer.utilityLayerScene:null;e&&this._pointerObserver&&(e.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=null),this._scene&&this._sceneDisposeObserver&&(this._scene.onDisposeObservable.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null),this._utilityLayer&&this._utilityLayer.dispose()}}Mx.MRTK_REALISTIC_SCALING=.032;class wx{static async create(e,t,i,s,r,n){return new wx(e,t,i,s,r,n)}constructor(e,t,i,s,r,n){this._splash=i,this._stateBetsPlacement=s,this._uiController=r,this._newGameEvent=n,this._gameActive=!1,this._currentTimeout=15e3;const o=this,a=Ms.CreateFullscreenUI("OverylayCapture",!0,t);a.usePointerTapForClickEvent=!0,a.attach(),a.onControlPickedObservable.add((e=>{o._currentTimeout=15e3}));const h=async()=>{for(;o._currentTimeout>0;)await si.Delay(500),o._currentTimeout-=500;o._gameActive||o._splash.isOpen?(!o._splash.isSplashOpen&&o._splash.isOpen&&o._splash.showDemo(),o._currentTimeout=15e3):(o._splash.showDemo(),o._newGameEvent.next("NewGame"),o._stateBetsPlacement.clearBets(),o._uiController.hideAllDialogs(),o._gameActive=!1,o._currentTimeout=15e3),h()};h()}gameBegin(){this._gameActive=!0}gameEnd(){this._gameActive=!1,this._currentTimeout=25e3}}class Ox{constructor(e,t,i,s,r,n,o,a,h){Xe(),Nc.ImportAndPatch({isMobile:Gd.any});const l=this._logManager=a.manager;this._logSettings=a.settings,this._assetPathResolver=i,this._log=l.getLogger("CompositionRoot"),this._brand=n,this._gameType=r,this._historySettings=o,this._clientEmitter=t,this._production=h,this._formatAmount=s,this._compositeResizeHandler=new xe,this._numSet=new Ti,this._betOptions=new Qi(this._numSet,this._gameType);const c=this._canvas=e.ownerDocument.createElement("canvas");e.style.outline="none",e.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",new JT(c),e.appendChild(c),c.style.width="100%",c.style.outline="none",c.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",c.style.position="absolute";const u=new Me.N(c,!0,{adaptToDeviceRatio:!1,alpha:!1,deterministicLockstep:!0,premultipliedAlpha:!1,timeStep:1/60});u.compatibilityMode=!0,u.setHardwareScalingLevel(.5),Ca.m.MAX_RENDERINGGROUPS=Tt.MaxRenderingGroups;const d=new Ie.Z(u,{useGeometryUniqueIdsMap:!0});d.skipFrustumClipping=!0,d.clearColor=new bt.ov(0,0,0,1),d.useRightHandedSystem=!0;const _=this._compositeTickable=new Qt;Jt.init(_),si.init(_);const p=new Zt(_,100,.1);if(!h){const e=5,t={timeToLog:e,tick(t){if(oi.tick(t),this.timeToLog-=t,this.timeToLog<=0){this.timeToLog=e;const t=oi.getPendingPromises();t.length>0&&console.log(`Pending Promises: ${t.length}\n\t${t.map((e=>`${e.name}: ${e.runningTimeMS.toFixed(0)}`)).join("\n\t")}`)}}};_.register(t)}let g=performance.now();u.runRenderLoop((()=>{const e=performance.now()-g;g+=e,p.tick(e/1e3),d.activeCamera&&d.render(!1,!0)})),this._scene=d,this._engine=u;let f={x:0,y:0};u.hostInformation.isMobile&&(f={x:0,y:-96*window.devicePixelRatio*.2}),this._interactiveSystem=new it(d,l.getLogger("IntSys"),{x:0,y:0},f),this._interactiveMeshFactory=new _t(this._interactiveSystem);const m=this._loaderGLTF=new hu(i,d),b=this._loaderSpinAnimation=new au(i,{gzip:["gz","gzip"],json:["json"]},this._numSet),v=this._loaderAudio=new _u(i),T=(this._loaderAudioBJ=new pu(v,i,this._logManager.getLogger("BJAudioLoader")),(()=>{const e=new Yu(this._scene);return e.useDefaultLoadingScreen=!1,e}).bind(this));this._textureLoader=new Su(i,T),this._imageLoader=new ju(i,T),this._loaderFont=new fu(i),this._rouletteAssetsLoader=new ru({gltf:m,ballAnimations:b,audio:v})}async build(t,i,s,r,n){const o=this,a=this._compositeTickable,h=new Bx;h.progress.subscribe((e=>{n(e)}));const l=new Ra.i("ui-Camera",gt.Pq.ZeroReadOnly,this._scene,!1);l.layerMask=Ct.GUI,l.mode=Ra.i.ORTHOGRAPHIC_CAMERA,this._scene.activeCameras?.push(l);const c=new Os(this._logManager.getLogger("UI Container"),this._scene,l,{idealResolution:{width:1920,height:1080},layerMask:Ct.GUI});this._compositeTickable.register(c),this._compositeResizeHandler.register(c),this._interactiveSystem.registerFullScreenUI(c);const u=new mu,d=new Tu(this._loaderSpinAnimation,this._loaderAudioBJ),_=new fn(this._imageLoader,Gd.any),p=new X,g=new X,f=iu.create("SplashScreen",c,this._imageLoader,g),m=new Tn(this._formatAmount),b=new Tn(this._formatAmount,{trailingZero:!1,useCurrency:!0}),v=new yn,T=new yn,y=this._rouletteAssetsLoader.loadGLTF(Oe.MainSceneNoCamAnimation),x=_.buildMainUI(c,t,m,T,this._compositeResizeHandler,this._scene),A=_.buildWinningNumberPopup({uiContainer:c,currencyFormatter:b,resizeHandler:this._compositeResizeHandler}),C=_.buildFavBetDialog({uiContainer:c,currentcyFormatter:m,resizeHandlerRegsitry:this._compositeResizeHandler,maxSlots:8}),S=_.buildAddFavBetDialog({uiContainer:c,resizeRegistry:this._compositeResizeHandler,maxNameLength:20}),E=_.buildBetSpotHintPopup({uiContainer:c,resizeRegistry:this._compositeResizeHandler}),R=(this.loadSpinAnimationBundles(d,u),new QT(this._clientEmitter,{maxSlots:8,pageSize:100,segmentSize:25},"fbp","favBetsPages",this._numSet,this._betOptions,this._logManager.getLogger("FavBetsController"))),P=this.loadAndInitiateSettingsController(i,R,this._numSet,this._betOptions),I=new Ju,M=new $r(I,this._loaderAudioBJ,this._logManager.getLogger("MusicPlayer")),w=this.preloadBJAudio(this._loaderAudioBJ,I,M,r,P,this._gameType,this._brand),O=this.preloadFonts(this._loaderFont);function B(e,t,i){return h.addTask(t),e.then((()=>{h.addCompletedWeight(t)})),oi.track(e,i),e}function D(e){return h.addTask(e),()=>{h.addCompletedWeight(e)}}const F=B(_.buildRacetrackDialog({container:c,resizeRegistry:this._compositeResizeHandler,numSet:this._numSet}),1,"racetrackLoading"),L=D(1),N=D(1),k=_.buildStatsDialog({uiContainer:c,resizeHandlerRegistry:this._compositeResizeHandler,zeroBasedCWNnumbers:this._numSet.getZeroBasedSequenceClockwise(this._gameType)}),U=new NT({allNumbers:this._numSet.getAllNumbersForGameType(this._gameType),coldNumbersCount:5,hotNumbersCount:5,lastNumbersHistroryLength:14},this._logManager.getLogger("Stats")),V=_.buildInfoDialog({uiContainer:c}),[G,z,H,W,,,q,Q,K,Y,j]=await Promise.all([f,B(y,5,"rouletteGLTFLoading"),B(x,1,"uiLoading"),B(A,1,"winPopupLoading"),B(w,5,"audioLoading"),B(O,1,"fontsLoading"),B(P,1,"settingsLoading"),B(S,1,"favBetsDialog"),B(this.loadSkyboxTexture(this._assetPathResolver,this._scene),2,"skyboxTexture"),B(E,1,"betHintPopup"),B((async()=>{const e=await this._imageLoader.load(Ne.UI_PIP_Frame),t=pr.createImage(e,"pip-Frame");return c.addControl(t),t})(),.1,"PiPFrame")]),$=new eu(!1),J=new Uc($),ee=new GT;q.gameSpeed.subscribe((e=>{ee.setTimeScale(e===Ir.Turbo?3:1.5)})),q.pipEnabled.subscribe((e=>{W.updateLayoutForPiPCameraEnabled(e)})),q.rightHanded.subscribe((e=>{H.setRightHanded(e)}));const te=new jt(J,1);ee.timeScale.subscribe((e=>{te.setTimeScale(e)})),a.register(te);const ie=await t,se=new ne(ie,this._historySettings,s),re=new wT({bjAudioPlayer:I,brand:this._brand,gameType:this._gameType,initialVoiceType:q.voiceType.value,numSet:this._numSet,log:this._logManager.getLogger("VO Player")});q.voiceType.subscribe((e=>{re.setVoiceType(e)}));const oe=new BT({bjAudioPlayer:I}),ae=new bu(oe,re,this._logManager.getLogger("AudioEventsHandler"));a.register(ae);const he=new pn(V,this._clientEmitter,ae),le=new ln({viewLoading:k,statsController:U,audioEventHandler:ae}),ce=new zT(this._clientEmitter),ue=new WT(this._clientEmitter),de=new XT(this._clientEmitter,m),_e=new HT(se,ce,ue,de),pe=new IT({betConfiguration:ie,placeBetsWithErrorHandling:_e,playerBalance:s}),ge=_.buildFavBetDeleteConfirmationDialog({uiContainer:c,resizeRegistry:this._compositeResizeHandler}),fe=new Qr(ge,ae),me=new Wr({viewLoading:C,favBetController:R,maxSlots:8,enterPresetNameDialog:Q,deleteConfirmPresenter:fe,placedBetsCollection:se,audioEvents:ae,applySnapshotActionFactory:pe,log:this._logManager.getLogger("FavBetController")}),be=new ji(ie.chipValuesAscending.includes(ie.defaultChip)?ie.defaultChip:ie.chipValuesAscending[0]),ve=new An,Te=new xn(0);this._interactiveSystem.start();const ye=this.createCameraController(this._scene,z,l,j,q.pipEnabled.value);q.pipEnabled.subscribe((e=>{ye.setPiPEnabled(e)})),this._compositeResizeHandler.register(ye);const xe=await pi.create({rouletteSceneContainer:z,betOptions:this._betOptions,interactiveMeshFactory:this._interactiveMeshFactory,numSet:this._numSet,skyboxTexture:K,log:this._logManager.getLogger("FieldView"),defaultHitZoneParams:{stationaryTouchSettings:{stationaryTouchTimeoutMS:1e3}},tickableRegistry:a,brand:this._brand,brandedAssets:{hso:{woodBaseTextureId:De.BaseWoodTexture},carpetTextureId:De.Carpet}},this._compositeResizeHandler,this._textureLoader);L();const Ae=this.createFeltController(xe,this._brand),Ce=Ae.switchFeltColor(q.feltColor.value).then((()=>N())),Se=new X,Ee=Jc.create({assetContainer:z,numSet:this._numSet,gameType:this._gameType,canvas:this._canvas,skyboxTexture:K,log:this._logManager.getLogger("MainScene")},this._compositeResizeHandler);this._interactiveSystem.setEventsCamera(Ee.mainCamera),new ga(H.getBetSelectorUI(),be,ae,s,se);const Re=new id({placedBetsWithErrorHandling:_e,fromReset:!1}),Pe=new jr({viewLoading:_.buildSettingsDialog({container:c,resizeRegistry:this._compositeResizeHandler}),feltController:Ae,settingController:q,audioEvents:ae}),Ie=new en({viewLoading:_.buildAudioSettingsDialog({container:c,resizeRegistry:this._compositeResizeHandler}),settingsController:q,audioEventHandler:ae}),Me=new an({viewLoading:F,initialNeighborsSelected:1,maxNeighbors:8,applyBetSnapshotActionFactory:pe,currentChip:be,placedBetsCollection:se,straightBets:this._betOptions.StraightUp,audioEventHandler:ae}),we=new VT,Be=new mn(H,_e,s,m,p,Te,ve,ae,ye,Se,{double:Re},me,Pe,Ie,ie,q,Me,le,we,U,g,he,Y),Fe=new sn({popup:Y,betConfig:ie,currencyFormatter:b,betSpotPositionGetter:xe,cameraController:ye,scene:Ee.scene,fieldView:xe,currentChip:be,audioEventHandler:ae,mainUILayerManipulator:Be,placeBetWithMessage:_e});this._compositeResizeHandler.register(Fe);const Le=new Yi(xe,be,Fe,_e,this._logManager.getLogger("Field")),ke=(new Cn(this._numSet,99),this.createPlayGameCmdLocal({numSet:this._numSet,gameType:e.DoubleZero,playerBalance:s})),Ue=new tu(ye);a.register(Ue),Ue.setTargetDelegate((()=>Ee.getBallPosition()));const Ve=new $c(Ee.wheelView);a.register(Ve);const Ge=new jc({wheelView:Ee.wheelView,wheelSpinner:Ve,wheelSpinningSpeed:vt.WheelSpinSpeedRadPerSec,spinAnimRegistry:u,motionPlayer:J,sfxPlayer:oe,pipController:Ue,pipTimeBeforeStopS:5,timeScaleObservable:ee,wheelSpinningMode:q.wheelSpinningMode}),ze=new X,He=new X;new xu(ze,this._clientEmitter);const We=new ua(ie.chipValuesAscending),Xe=this.buildChipsCollection(z,ie.chipValuesAscending,1),qe=new pa(this._scene,Xe,{instancesPerValue:10}),Qe=new ca(this._scene,qe,xe.getChipsStacksParent(),xe,v,ie.chipValuesAscending,this._logManager),Ke=new Vn(Qe),Ye=new Un(Ke,se,We,ae);this._compositeResizeHandler.register(Ye);const je=new OT(se.updateObservable,ae),Ze=new FT(Ke,xe,ae,this._logManager.getLogger("ChipsAnimator")),$e=new Cu(se,we,p),Je=new qT(2.5),et=new kn(se,Le,p,Ge,Te,Be,ae,$e,Je,this._logManager.getLogger("State: Placing Bets")),tt=await wx.create("DemoShroud",this._scene,G,et,Be,g),it=new Nn(Ye,ye,Ue,G,tt,this._logManager.getLogger("State: Init"),Ln.music,Be,q,ae,je,I,oe,re,(async()=>{let e=ZT.build(c,o._imageLoader),t=new $T({viewLoading:e??(()=>{throw new Z("Intro view loading was not initialized")})(),audioEventHandler:ae,settingsController:q});return await t.show(),t})),st=new Sn(ke,Se,Ge,this._logManager.getLogger("State: Fetch")),rt=new En(Ge,ye,Te,ze,He,Ue,ae,W,Se,Be,xe,je,p,Ze,U,g,H,ve,_e,Be,Je,this._logManager.getLogger("State: Show Results"));if(this._engine.hostInformation.isMobile&&new DT(this._interactiveSystem.offsetPointerPosition,this._interactiveSystem.offsetDragState,c,this._engine),this._gameController=new Pn(it,et,st,rt),!this._production&&(Au.create({scene:this._scene,placedBetsCollection:se,betOptions:this._betOptions,autoplayController:$e,timeScaleStore:ee,showOverBalanceCmd:ce}),"localhost"===window.location.hostname))try{this._devtoolsLinker=new ed,await this._devtoolsLinker.initialize(),this._devtoolsLinker.start()}catch(e){this._log.error(`Could not load dev tools: ${e}`)}await Ce,n(1)}buildChipsCollection(e,t,i=0){const s=["Chip_Grey","Chip_White","Chip_Red","Chip_Green","Chip_Black","Chip_Blue","Chip_Yellow","Chip_Purple","Chip_Orange"].map((t=>{const i=e.meshes.find((e=>e.name===t))??(()=>{throw new Z})(),s=i.material,r=new zt(`mat-${i.name}`,e.scene);return r.diffuseTexture=s.albedoTexture,i.material=r,s.dispose(),i.isVisible=!1,i.setParent(null),i})),r=new Map;return t.forEach(((e,t)=>{const n=s[t+i];r.set(e,n)})),r}createFeltController(e,t){const i=(()=>{switch(t){case"cpo":return[De.Felt_CPO_Green_SD,De.Felt_CPO_Red_SD,De.Felt_CPO_Gray_SD,De.Felt_CPO_Blue_SD];case"hso":return[De.Felt_HSO_Blue_SD,De.Felt_HSO_Black_SD,De.Felt_HSO_Tan_SD,De.Felt_HSO_Gold_SD];case"sbk":return[De.Felt_SBK_Green_SD,De.Felt_SBK_Blue_SD,De.Felt_SBK_Red_SD,De.Felt_SBK_Gold_SD]}})().map((e=>this._assetPathResolver.resolveAssetId(e).url));return new MT({feltURLs:i,feltTextureUpdater:t=>e.setFeltTexture(t),scene:this._scene,log:this._logManager.getLogger("FeltController")})}async preloadBJAudio(t,i,s,r,n,o,a,h){this._log.debug("Audio preloading start...");const l=new Map,c=async(e,i)=>{this._log.debug(`SFX '${e.name}' loading started...`);const s=await t.loadSFX(e,i);return l.set(e,s),this._log.debug(`SFX '${e.name}' loading completed`),[e,s]},u=async(e,i,s)=>{this._log.debug(`VO '${e.name}' loading started...`);const r=await t.loadVO(e,i,s);return l.set(e,r),this._log.debug(`VO '${e.name}' loading completed`),[e,r]},d=async(e,i)=>{this._log.debug(`Music '${e.name}' loading started...`);const s=await t.loadMusic(e,i);return l.set(e,s),this._log.debug(`Music '${e.name}' loading completed`),[e,s]},_=(r?Fe.AllSFXIDs:[Fe.SFX_UI_Click,Fe.SFX_Win,Fe.SFX_WinBanner,Fe.SFX_Lose,Fe.SFX_ClearTable,Fe.SFX_PlacedChipStack,Fe.SFX_PlacedSingleChip]).map((e=>c(e,h))),p=n.then((t=>{const i=t.voiceType.value,s=Fe.AllWelcomeIDs,n=(()=>{if(o===e.SingleZero)if("female"===i)switch(a){case"cpo":return Fe.VO_F_Welcome_EU_cpo;case"hso":return Fe.VO_F_Welcome_EU_hso;case"sbk":return Fe.VO_F_Welcome_EU_sbk;default:throw new Z}else switch(a){case"cpo":return Fe.VO_M_Welcome_EU_cpo;case"hso":return Fe.VO_M_Welcome_EU_hso;case"sbk":return Fe.VO_M_Welcome_EU_sbk;default:throw new Z}else if("female"===i)switch(a){case"cpo":return Fe.VO_F_Welcome_US_cpo;case"hso":return Fe.VO_F_Welcome_US_hso;case"sbk":return Fe.VO_F_Welcome_US_sbk;default:throw new Z}else switch(a){case"cpo":return Fe.VO_M_Welcome_US_cpo;case"hso":return Fe.VO_M_Welcome_US_hso;case"sbk":return Fe.VO_M_Welcome_US_sbk;default:throw new Z}})(),l=r?Fe.AllVoiceIDs:"male"===i?[...Fe.AllMaleVoiceIDs.filter((e=>!s.includes(e))),Fe.VO_F_HereWeGo,n]:[...Fe.AllFemaleVoiceIDs.filter((e=>!s.includes(e))),Fe.VO_M_HereWeGo,n],c=Fe.AllVoiceIDs.map((e=>u(e,{preload:l.includes(e)},h)));return Promise.all(c)})),g=r?[Fe.Music_Blues,Fe.Music_CasinoAmbient,Fe.Music_Chill,Fe.Music_Classical,Fe.Music_Groovy,Fe.Music_Heavy,Fe.Music_Jazz,Fe.Music_Lounge,Fe.Music_Neon].map((e=>d(e,h))):[];return await Promise.all([..._,...g,p]),this._log.debug("Audio preloading complete"),Ln.init(i,s),l}async preloadFonts(e){this._log.debug("Fonts preloading start...");const t=async t=>{this._log.debug(`Font '${t.name}' loading started...`);const i=await e.load(t);return this._log.debug(`Font '${t.name}' loading completed`),i};await Promise.all([ke.Rubik].map((e=>t(e)))),this._log.debug("Fonts preloading completed")}loadSkyboxTexture(e,t){return new Promise((i=>{this._log.debug("Loading skybox");const s=e.resolveAssetId(Be.Skybox),r=new ph.b(s.url,t,null,void 0,null,(()=>{i(r),r.level=2,this._log.debug("Skybox loaded")}));r.rotationY=4.6565}))}async loadAndInitiateSettingsController(e,t,i,s){this._log.debug("Waiting for player options...");const r=await e,n=new sd(this._clientEmitter,r);return await t.load(r.favBetsPages),this._log.debug(`Player options retrieved: ${JSON.stringify(r)}`),n}createCameraController(e,t,i,s,r){const n=e=>t.cameras.find((t=>t.name==e))??(()=>{throw new Z(`'${e}' was not found`)})(),o=n("MainCamera_Landscape"),a=n("MainCamera_Landscape_Zoom"),h=n("MainCamera_Portrait"),l=n("MainCamera_Portrait"),c=n("PiPCamera");return h.setEnabled(!1),t.scene.activeCamera=o,o.parent,h.parent,a.parent,l.parent,o.layerMask=~(Ct.GUI|Ct.PiPOnly),h.layerMask=~(Ct.GUI|Ct.PiPOnly),c.layerMask=Ct.Wheel|Ct.PiPOnly,new kc(e,{landscape:{default:o,zoomed:a},portrait:{default:h,zoomed:l},pipCamera:c,gui:i},s,r)}async loadSpinAnimationBundles(e,t){const i=yu.getManifest();this._log.trace("SPIN ANIMATIONS LOADING STARTED"),await Promise.all(i.map((i=>e.loadSpinAnimationBundle(i).then((e=>{this._log.trace(`Spin animation bundle loaded '${e.animation.id}'`),t.add(e)}))))),this._log.trace("SPIN ANIMATIONS LOADING COMPLETE")}async start(){await this._gameController.start()}createPlayGameCmdRGS(e,t,i){return new wn(e,t,i,new LT)}createPlayGameCmdLocal(e){return new Mn(e.numSet,e.gameType,e.playerBalance,new LT)}onResize(e){const[t,i]=[e.referenceSizeLandscape.w,e.referenceSizeLandscape.h],s=t/i,r=e.width/e.height;if(e.orientation===ue.landscape)if(this._canvas.style.aspectRatio=`${t}/${i}`,r<=s){const t=e.width/s,i=(e.height-t)/2;this._canvas.style.top=`${i}px`,this._canvas.style.left="0px",this._canvas.style.height="",this._canvas.style.width="100%"}else{const t=e.height*s;this._canvas.style.width="",this._canvas.style.height="100%",this._canvas.style.top="0px";const i=(e.width-t)/2;this._canvas.style.left=`${i}px`}else this._canvas.style.top="0px",this._canvas.style.left="0px",this._canvas.style.width="100%",this._canvas.style.height="100%";this._compositeResizeHandler.onResize(e),this._engine.resize()}}class Bx{constructor(){this._progress=new Q(0),this._totalWeight=0,this._currentProgress=0}addTask(e){this._totalWeight+=e,this.notifyUpdate()}addCompletedWeight(e){this._currentProgress+=e,this.notifyUpdate()}notifyUpdate(){0===this._totalWeight?this._progress.next(0):this._progress.next(this._currentProgress/this._totalWeight)}get progress(){return this._progress}}var Dx,Fx,Lx,Nx,kx,Ux,Vx,Gx,zx;!function(e){e[e.FREE=0]="FREE",e[e.LIMITED=1]="LIMITED",e[e.LOCKED=2]="LOCKED"}(Dx||(Dx={})),function(e){e[e.LINEAR_X=0]="LINEAR_X",e[e.LINEAR_Y=1]="LINEAR_Y",e[e.LINEAR_Z=2]="LINEAR_Z",e[e.ANGULAR_X=3]="ANGULAR_X",e[e.ANGULAR_Y=4]="ANGULAR_Y",e[e.ANGULAR_Z=5]="ANGULAR_Z",e[e.LINEAR_DISTANCE=6]="LINEAR_DISTANCE"}(Fx||(Fx={})),function(e){e[e.BALL_AND_SOCKET=1]="BALL_AND_SOCKET",e[e.DISTANCE=2]="DISTANCE",e[e.HINGE=3]="HINGE",e[e.SLIDER=4]="SLIDER",e[e.LOCK=5]="LOCK",e[e.PRISMATIC=6]="PRISMATIC",e[e.SIX_DOF=7]="SIX_DOF"}(Lx||(Lx={})),function(e){e[e.SPHERE=0]="SPHERE",e[e.CAPSULE=1]="CAPSULE",e[e.CYLINDER=2]="CYLINDER",e[e.BOX=3]="BOX",e[e.CONVEX_HULL=4]="CONVEX_HULL",e[e.CONTAINER=5]="CONTAINER",e[e.MESH=6]="MESH",e[e.HEIGHTFIELD=7]="HEIGHTFIELD"}(Nx||(Nx={})),function(e){e[e.NONE=0]="NONE",e[e.VELOCITY=1]="VELOCITY",e[e.POSITION=2]="POSITION"}(kx||(kx={})),function(e){e.COLLISION_STARTED="COLLISION_STARTED",e.COLLISION_CONTINUED="COLLISION_CONTINUED",e.COLLISION_FINISHED="COLLISION_FINISHED",e.TRIGGER_ENTERED="TRIGGER_ENTERED",e.TRIGGER_EXITED="TRIGGER_EXITED"}(Ux||(Ux={})),function(e){e[e.STATIC=0]="STATIC",e[e.ANIMATED=1]="ANIMATED",e[e.DYNAMIC=2]="DYNAMIC"}(Vx||(Vx={})),function(e){e[e.DISABLED=0]="DISABLED",e[e.TELEPORT=1]="TELEPORT",e[e.ACTION=2]="ACTION"}(Gx||(Gx={})),function(e){e[e.SIMULATION_CONTROLLED=0]="SIMULATION_CONTROLLED",e[e.ALWAYS_ACTIVE=1]="ALWAYS_ACTIVE",e[e.ALWAYS_INACTIVE=2]="ALWAYS_INACTIVE"}(zx||(zx={}));class Hx{get disablePreStep(){return this._prestepType==Gx.DISABLED}set disablePreStep(e){this._prestepType=e?Gx.DISABLED:Gx.TELEPORT}constructor(e,t,i,s){if(this._pluginData=void 0,this._pluginDataInstances=[],this._collisionCBEnabled=!1,this._collisionEndedCBEnabled=!1,this.disableSync=!1,this._isDisposed=!1,this._shape=null,this._prestepType=Gx.DISABLED,!s)return;const r=s.getPhysicsEngine();if(!r)throw new Error("No Physics Engine available.");if(this._physicsEngine=r,2!=r.getPluginVersion())throw new Error("Plugin version is incorrect. Expected version 2.");const n=r.getPhysicsPlugin();if(!n)throw new Error("No Physics Plugin available.");this._physicsPlugin=n,e.rotationQuaternion||(e.rotationQuaternion=gt.PT.FromEulerAngles(e.rotation.x,e.rotation.y,e.rotation.z)),this.startAsleep=i,this._motionType=t,this.disableSync=0==t;const o=e;o.hasThinInstances?this._physicsPlugin.initBodyInstances(this,t,o):(e.parent&&e.computeWorldMatrix(!0),this._physicsPlugin.initBody(this,t,e.absolutePosition,e.absoluteRotationQuaternion)),this.transformNode=e,e.physicsBody=this,r.addBody(this),this._nodeDisposeObserver=e.onDisposeObservable.add((()=>{this.dispose()}))}getClassName(){return"PhysicsBody"}clone(e){const t=new Hx(e,this.getMotionType(),this.startAsleep,this.transformNode.getScene());return t.shape=this.shape,t.setMassProperties(this.getMassProperties()),t.setLinearDamping(this.getLinearDamping()),t.setAngularDamping(this.getAngularDamping()),t}updateBodyInstances(){const e=this.transformNode;e.hasThinInstances&&this._physicsPlugin.updateBodyInstances(this,e)}get numInstances(){return this._pluginDataInstances.length}get motionType(){return this._motionType}set shape(e){this._shape=e,e&&this._physicsPlugin.setShape(this,e)}get shape(){return this._shape}getBoundingBox(){return this._physicsPlugin.getBodyBoundingBox(this)}setEventMask(e,t){this._physicsPlugin.setEventMask(this,e,t)}getEventMask(e){return this._physicsPlugin.getEventMask(this,e)}setMotionType(e,t){this.disableSync=0==e,this._physicsPlugin.setMotionType(this,e,t)}getMotionType(e){return this._physicsPlugin.getMotionType(this,e)}setPrestepType(e){this._prestepType=e}getPrestepType(){return this._prestepType}computeMassProperties(e){return this._physicsPlugin.computeMassProperties(this,e)}setMassProperties(e,t){this._physicsPlugin.setMassProperties(this,e,t)}getMassProperties(e){return this._physicsPlugin.getMassProperties(this,e)}setLinearDamping(e,t){this._physicsPlugin.setLinearDamping(this,e,t)}getLinearDamping(e){return this._physicsPlugin.getLinearDamping(this,e)}setAngularDamping(e,t){this._physicsPlugin.setAngularDamping(this,e,t)}getAngularDamping(e){return this._physicsPlugin.getAngularDamping(this,e)}setLinearVelocity(e,t){this._physicsPlugin.setLinearVelocity(this,e,t)}getLinearVelocityToRef(e,t){this._physicsPlugin.getLinearVelocityToRef(this,e,t)}getLinearVelocity(e){const t=new gt.Pq;return this.getLinearVelocityToRef(t,e),t}setAngularVelocity(e,t){this._physicsPlugin.setAngularVelocity(this,e,t)}getAngularVelocityToRef(e,t){this._physicsPlugin.getAngularVelocityToRef(this,e,t)}getAngularVelocity(e){const t=new gt.Pq;return this.getAngularVelocityToRef(t,e),t}applyImpulse(e,t,i){this._physicsPlugin.applyImpulse(this,e,t,i)}applyAngularImpulse(e,t){this._physicsPlugin.applyAngularImpulse(this,e,t)}applyForce(e,t,i){this._physicsPlugin.applyForce(this,e,t,i)}getGeometry(){return this._physicsPlugin.getBodyGeometry(this)}getCollisionObservable(){return this._physicsPlugin.getCollisionObservable(this)}getCollisionEndedObservable(){return this._physicsPlugin.getCollisionEndedObservable(this)}setCollisionCallbackEnabled(e){this._collisionCBEnabled=e,this._physicsPlugin.setCollisionCallbackEnabled(this,e)}setCollisionEndedCallbackEnabled(e){this._collisionEndedCBEnabled=e,this._physicsPlugin.setCollisionEndedCallbackEnabled(this,e)}getObjectCenterWorld(e){const t=new gt.Pq;return this.getObjectCenterWorldToRef(t,e)}getObjectCenterWorldToRef(e,t){if(this._pluginDataInstances?.length>0){const i=t||0,s=this.transformNode._thinInstanceDataStorage.matrixData;s&&e.set(s[16*i+12],s[16*i+13],s[16*i+14])}else e.copyFrom(this.transformNode.position);return e}addConstraint(e,t,i,s){this._physicsPlugin.addConstraint(this,e,t,i,s)}syncWithBone(e,t,i,s,r,n){const o=this.transformNode;if(o.rotationQuaternion)if(r){const i=gt.AA.Quaternion[0];e.getRotationQuaternionToRef(1,t,i),i.multiplyToRef(r,o.rotationQuaternion)}else e.getRotationQuaternionToRef(1,t,o.rotationQuaternion);const a=gt.AA.Vector3[0],h=gt.AA.Vector3[1];n||((n=gt.AA.Vector3[2]).x=0,n.y=1,n.z=0),e.getDirectionToRef(n,t,h),e.getAbsolutePositionToRef(t,a),null==s&&i&&(s=i.length()),null!=s&&(a.x+=h.x*s,a.y+=h.y*s,a.z+=h.z*s),o.setAbsolutePosition(a)}iterateOverAllInstances(e){if(this._pluginDataInstances?.length>0)for(let t=0;t<this._pluginDataInstances.length;t++)e(this,t);else e(this,void 0)}setGravityFactor(e,t){this._physicsPlugin.setGravityFactor(this,e,t)}getGravityFactor(e){return this._physicsPlugin.getGravityFactor(this,e)}setTargetTransform(e,t,i){this._physicsPlugin.setTargetTransform(this,e,t,i)}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._collisionCBEnabled&&this.setCollisionCallbackEnabled(!1),this._collisionEndedCBEnabled&&this.setCollisionEndedCallbackEnabled(!1),this._nodeDisposeObserver&&(this.transformNode.onDisposeObservable.remove(this._nodeDisposeObserver),this._nodeDisposeObserver=null),this._physicsEngine.removeBody(this),this._physicsPlugin.removeBody(this),this._physicsPlugin.disposeBody(this),this.transformNode.physicsBody=null,this._pluginData=null,this._pluginDataInstances.length=0,this._isDisposed=!0,this.shape=null)}}class Wx{constructor(e,t){if(this._pluginData=void 0,this._isTrigger=!1,this._isDisposed=!1,!t)return;const i=t.getPhysicsEngine();if(!i)throw new Error("No Physics Engine available.");if(2!=i.getPluginVersion())throw new Error("Plugin version is incorrect. Expected version 2.");const s=i.getPhysicsPlugin();if(!s)throw new Error("No Physics Plugin available.");if(this._physicsPlugin=s,void 0!==e.pluginData&&null!==e.pluginData)this._pluginData=e.pluginData,this._type=this._physicsPlugin.getShapeType(this);else if(void 0!==e.type&&null!==e.type){this._type=e.type;const t=e.parameters??{};this._physicsPlugin.initShape(this,e.type,t)}}getClassName(){return"PhysicsShape"}get type(){return this._type}set filterMembershipMask(e){this._physicsPlugin.setShapeFilterMembershipMask(this,e)}get filterMembershipMask(){return this._physicsPlugin.getShapeFilterMembershipMask(this)}set filterCollideMask(e){this._physicsPlugin.setShapeFilterCollideMask(this,e)}get filterCollideMask(){return this._physicsPlugin.getShapeFilterCollideMask(this)}set material(e){this._physicsPlugin.setMaterial(this,e),this._material=e}get material(){return this._material||(this._material=this._physicsPlugin.getMaterial(this)),this._material}set density(e){this._physicsPlugin.setDensity(this,e)}get density(){return this._physicsPlugin.getDensity(this)}addChildFromParent(e,t,i){const s=i.computeWorldMatrix(!0),r=e.computeWorldMatrix(!0),n=gt.AA.Matrix[0];s.multiplyToRef(gt.uq.Invert(r),n);const o=gt.AA.Vector3[0],a=gt.AA.Quaternion[0],h=gt.AA.Vector3[1];n.decompose(h,a,o),this._physicsPlugin.addChild(this,t,o,a,h)}addChild(e,t,i,s){this._physicsPlugin.addChild(this,e,t,i,s)}removeChild(e){this._physicsPlugin.removeChild(this,e)}getNumChildren(){return this._physicsPlugin.getNumChildren(this)}getBoundingBox(){return this._physicsPlugin.getBoundingBox(this)}set isTrigger(e){this._isTrigger!==e&&(this._isTrigger=e,this._physicsPlugin.setTrigger(this,e))}get isTrigger(){return this._isTrigger}dispose(){this._isDisposed||(this._physicsPlugin.disposeShape(this),this._isDisposed=!0)}}class Xx extends Wx{constructor(e,t,i){super({type:0,parameters:{center:e,radius:t}},i)}static FromMesh(e){const t=e.getBoundingInfo(),i=t.boundingSphere.center,s=t.boundingBox.extendSize,r=Math.max(s.x,s.y,s.z);return new Xx(i,r,e.getScene())}}class qx extends Wx{constructor(e,t,i,s){super({type:1,parameters:{pointA:e,pointB:t,radius:i}},s)}static FromMesh(e){const t=e.getBoundingInfo(),i=t.boundingBox.extendSize.x,s=new gt.Pq(0,t.boundingBox.extendSize.y-i,0),r=t.boundingBox.center.add(s),n=t.boundingBox.center.subtract(s);return new qx(r,n,i,e.getScene())}}class Qx extends Wx{constructor(e,t){super({type:6,parameters:{mesh:e}},t)}}class Kx extends Wx{constructor(e){super({type:5,parameters:{}},e)}}var Yx=o(6632);class jx extends rx{get coloredMaterial(){return this._coloredMaterial}get hoverMaterial(){return this._hoverMaterial}get disableMaterial(){return this._disableMaterial}static _CreateArrow(e,t,i=1,s=!1){const r=new Gn.V("arrow",e),n=co("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375*(1+(i-1)/4),tessellation:96},e),o=co("cylinder",{diameterTop:.005*i,height:.275,diameterBottom:.005*i,tessellation:96},e);return n.parent=r,n.material=t,n.rotation.x=Math.PI/2,n.position.z+=.3,o.parent=r,o.material=t,o.position.z+=.1375,o.rotation.x=Math.PI/2,s&&(o.visibility=0,n.visibility=0),r}static _CreateArrowInstance(e,t){const i=new Gn.V("arrow",e);for(const e of t.getChildMeshes())e.createInstance(e.name).parent=i;return i}constructor(e,t=bt.v9.Gray(),i=yl.DefaultUtilityLayer,s=null,r=1,n=bt.v9.Yellow(),o=bt.v9.Gray()){super(i),this._pointerObserver=null,this.snapDistance=0,this.onSnapObservable=new Zi.cP,this._isEnabled=!0,this._parent=null,this._dragging=!1,this._parent=s,this._coloredMaterial=new ft.F("",i.utilityLayerScene),this._coloredMaterial.diffuseColor=t,this._coloredMaterial.specularColor=t.subtract(new bt.v9(.1,.1,.1)),this._hoverMaterial=new ft.F("",i.utilityLayerScene),this._hoverMaterial.diffuseColor=n,this._disableMaterial=new ft.F("",i.utilityLayerScene),this._disableMaterial.diffuseColor=o,this._disableMaterial.alpha=.4;const a=jx._CreateArrow(i.utilityLayerScene,this._coloredMaterial,r),h=jx._CreateArrow(i.utilityLayerScene,this._coloredMaterial,r+4,!0);this._gizmoMesh=new zn.e("",i.utilityLayerScene),this._gizmoMesh.addChild(a),this._gizmoMesh.addChild(h),this._gizmoMesh.lookAt(this._rootMesh.position.add(e)),this._gizmoMesh.scaling.scaleInPlace(1/3),this._gizmoMesh.parent=this._rootMesh;let l=0;const c={snapDistance:0};this.dragBehavior=new dx({dragAxis:e}),this.dragBehavior.moveAttached=!1,this.dragBehavior.updateDragPlane=!1,this._rootMesh.addBehavior(this.dragBehavior),this.dragBehavior.onDragObservable.add((e=>{if(this.attachedNode){let t=!1;if(0==this.snapDistance)this.attachedNode.getWorldMatrix().getTranslationToRef(gt.AA.Vector3[2]),gt.AA.Vector3[2].addInPlace(e.delta),this.dragBehavior.validateDrag(gt.AA.Vector3[2])&&(this.attachedNode.position&&this.attachedNode.position.addInPlaceFromFloats(e.delta.x,e.delta.y,e.delta.z),this.attachedNode.getWorldMatrix().addTranslationFromFloats(e.delta.x,e.delta.y,e.delta.z),this.attachedNode.updateCache(),t=!0);else if(l+=e.dragDistance,Math.abs(l)>this.snapDistance){const i=Math.floor(Math.abs(l)/this.snapDistance);l%=this.snapDistance,e.delta.normalizeToRef(gt.AA.Vector3[1]),gt.AA.Vector3[1].scaleInPlace(this.snapDistance*i),this.attachedNode.getWorldMatrix().getTranslationToRef(gt.AA.Vector3[2]),gt.AA.Vector3[2].addInPlace(gt.AA.Vector3[1]),this.dragBehavior.validateDrag(gt.AA.Vector3[2])&&(this.attachedNode.getWorldMatrix().addTranslationFromFloats(gt.AA.Vector3[1].x,gt.AA.Vector3[1].y,gt.AA.Vector3[1].z),this.attachedNode.updateCache(),c.snapDistance=this.snapDistance*i*Math.sign(l),this.onSnapObservable.notifyObservers(c),t=!0)}t&&this._matrixChanged()}})),this.dragBehavior.onDragStartObservable.add((()=>{this._dragging=!0})),this.dragBehavior.onDragEndObservable.add((()=>{this._dragging=!1}));const u=i._getSharedGizmoLight();u.includedOnlyMeshes=u.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(!1));const d={gizmoMeshes:a.getChildMeshes(),colliderMeshes:h.getChildMeshes(),material:this._coloredMaterial,hoverMaterial:this._hoverMaterial,disableMaterial:this._disableMaterial,active:!1,dragBehavior:this.dragBehavior};this._parent?.addToAxisCache(h,d),this._pointerObserver=i.utilityLayerScene.onPointerObservable.add((e=>{if(!this._customMeshSet&&(this._isHovered=!(-1==d.colliderMeshes.indexOf(e?.pickInfo?.pickedMesh)),!this._parent)){const e=this.dragBehavior.enabled?this._isHovered||this._dragging?this._hoverMaterial:this._coloredMaterial:this._disableMaterial;this._setGizmoMeshMaterial(d.gizmoMeshes,e)}})),this.dragBehavior.onEnabledObservable.add((e=>{this._setGizmoMeshMaterial(d.gizmoMeshes,e?d.material:d.disableMaterial)}))}_attachedNodeChanged(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)}set isEnabled(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)}get isEnabled(){return this._isEnabled}dispose(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach((e=>{e&&e.dispose()})),super.dispose()}}class Zx{get scaleLines(){return this._scaleLines}set scaleLines(e){this._scaleLines=e,this._xAxis.scaling.setAll(this._scaleLines*this._scaleLinesFactor),this._yAxis.scaling.setAll(this._scaleLines*this._scaleLinesFactor),this._zAxis.scaling.setAll(this._scaleLines*this._scaleLinesFactor)}get xAxis(){return this._xAxis}get yAxis(){return this._yAxis}get zAxis(){return this._zAxis}constructor(e,t=1,i=2,s,r,n,o=1){if(this._scaleLinesFactor=4,this._instanced=!1,this.scene=null,this._scaleLines=1,e=e||os.q.LastCreatedScene){if(!s){const t=new ft.F("xAxisMaterial",e);t.disableLighting=!0,t.emissiveColor=bt.v9.Red().scale(.5),s=jx._CreateArrow(e,t,o)}if(!r){const t=new ft.F("yAxisMaterial",e);t.disableLighting=!0,t.emissiveColor=bt.v9.Green().scale(.5),r=jx._CreateArrow(e,t,o)}if(!n){const t=new ft.F("zAxisMaterial",e);t.disableLighting=!0,t.emissiveColor=bt.v9.Blue().scale(.5),n=jx._CreateArrow(e,t,o)}this._xAxis=s,this._yAxis=r,this._zAxis=n,this.scaleLines=t,null!=i&&(Zx._SetRenderingGroupId(this._xAxis,i),Zx._SetRenderingGroupId(this._yAxis,i),Zx._SetRenderingGroupId(this._zAxis,i)),this.scene=e,this.update(new gt.Pq,gt.Pq.Right(),gt.Pq.Up(),gt.Pq.Forward())}}update(e,t,i,s){this._xAxis.position.copyFrom(e),this._xAxis.setDirection(t),this._yAxis.position.copyFrom(e),this._yAxis.setDirection(i),this._zAxis.position.copyFrom(e),this._zAxis.setDirection(s)}createInstance(){const e=jx._CreateArrowInstance(this.scene,this._xAxis),t=jx._CreateArrowInstance(this.scene,this._yAxis),i=jx._CreateArrowInstance(this.scene,this._zAxis),s=new Zx(this.scene,this.scaleLines,null,e,t,i);return s._instanced=!0,s}dispose(){this._xAxis&&this._xAxis.dispose(!1,!this._instanced),this._yAxis&&this._yAxis.dispose(!1,!this._instanced),this._zAxis&&this._zAxis.dispose(!1,!this._instanced),this.scene=null}static _SetRenderingGroupId(e,t){e.getChildMeshes().forEach((e=>{e.renderingGroupId=t}))}}class $x{constructor(e,t){if(this._impostors=[],this._meshes=[],this._bodies=[],this._inertiaBodies=[],this._constraints=[],this._bodyMeshes=[],this._inertiaMeshes=[],this._constraintMeshes=[],this._numMeshes=0,this._numBodies=0,this._numInertiaBodies=0,this._numConstraints=0,this._debugMeshMeshes=new Array,this._constraintAxesSize=.4,this._constraintAngularSize=.4,this._scene=e||os.q.LastCreatedScene,!this._scene)return;const i=this._scene.getPhysicsEngine();i&&(this._physicsEnginePlugin=i.getPhysicsPlugin()),this._utilityLayer=new yl(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0,t&&(this._constraintAxesSize=.4*t,this._constraintAngularSize=.4*t)}_updateDebugMeshes(){const e=this._physicsEnginePlugin;1===e?.getPluginVersion()?this._updateDebugMeshesV1():this._updateDebugMeshesV2()}_updateDebugMeshesV1(){const e=this._physicsEnginePlugin;for(let t=0;t<this._numMeshes;t++){const i=this._impostors[t];if(i)if(i.isDisposed)this.hideImpostor(this._impostors[t--]);else{if(i.type===Rc.MeshImpostor)continue;const s=this._meshes[t];s&&e&&e.syncMeshWithImpostor(s,i)}}}_updateDebugMeshesV2(){const e=this._physicsEnginePlugin;for(let t=0;t<this._numBodies;){const i=this._bodies[t];if(i&&i.isDisposed&&this.hideBody(i))continue;const s=this._bodyMeshes[t];i&&s&&e.syncTransform(i,s),t++}}_updateInertiaMeshes(){for(let e=0;e<this._numInertiaBodies;){const t=this._inertiaBodies[e];if(t&&t.isDisposed&&this.hideInertia(t))continue;const i=this._inertiaMeshes[e];t&&i&&this._updateDebugInertia(t,i),e++}}_updateDebugInertia(e,t){const i=gt.uq.Identity(),s=gt.uq.Identity(),r=gt.uq.Identity();if(e._pluginDataInstances.length){const n=t,o=n._thinInstanceDataStorage.matrixData,a=e.transformNode._thinInstanceDataStorage.matrixData;for(let t=0;t<e._pluginDataInstances.length;t++){const n=e.getMassProperties(t);this._getMeshDebugInertiaMatrixToRef(n,i),gt.uq.FromArrayToRef(a,16*t,s),i.multiplyToRef(s,r),r.copyToArray(o,16*t)}n.thinInstanceBufferUpdated("matrix")}else{const r=e.getMassProperties();if(this._getMeshDebugInertiaMatrixToRef(r,i),e.transformNode.rotationQuaternion?.toRotationMatrix(s),s.setTranslation(e.transformNode.position),e.transformNode.parent){const t=e.transformNode.parent.computeWorldMatrix(!0);s.multiplyToRef(t,s)}i.multiplyToRef(s,i),i.decomposeToTransformNode(t)}}_updateDebugConstraints(){for(let e=0;e<this._numConstraints;e++){const t=this._constraints[e],i=this._constraintMeshes[e];t&&i&&this._updateDebugConstraint(t,i[0])}}_makeScalingUnitInPlace(e){Math.abs(e.x-1)>bs.bH&&(e.x=1*Math.sign(e.x)),Math.abs(e.y-1)>bs.bH&&(e.y=1*Math.sign(e.y)),Math.abs(e.z-1)>bs.bH&&(e.z=1*Math.sign(e.z))}_updateDebugConstraint(e,t){if(!e._initOptions)return;const{pivotA:i,pivotB:s,axisA:r,axisB:n,perpAxisA:o,perpAxisB:a}=e._initOptions;i&&s&&r&&n&&o&&a&&t.getDescendants(!0).forEach((e=>{const t=e.getDescendants(!0)[0],h=e.getDescendants(!0)[1],{parentBody:l,parentBodyIndex:c}=t.metadata,{childBody:u,childBodyIndex:d}=h.metadata,_=this._getTransformFromBodyToRef(l,gt.AA.Matrix[0],c),p=this._getTransformFromBodyToRef(u,gt.AA.Matrix[1],d);_.decomposeToTransformNode(t),this._makeScalingUnitInPlace(t.scaling),p.decomposeToTransformNode(h),this._makeScalingUnitInPlace(h.scaling);const g=t.getDescendants(!0)[0];g.position.copyFrom(i);const f=h.getDescendants(!0)[0];f.position.copyFrom(s),gt.PT.FromRotationMatrixToRef(gt.uq.FromXYZAxesToRef(r,o,gt.Pq.CrossToRef(r,o,gt.AA.Vector3[0]),gt.AA.Matrix[0]),g.rotationQuaternion),gt.PT.FromRotationMatrixToRef(gt.uq.FromXYZAxesToRef(n,a,gt.Pq.CrossToRef(n,a,gt.AA.Vector3[1]),gt.AA.Matrix[1]),f.rotationQuaternion)}))}showImpostor(e,t){if(!this._scene)return null;for(let t=0;t<this._numMeshes;t++)if(this._impostors[t]==e)return null;const i=this._getDebugMesh(e,t);return i&&(this._impostors[this._numMeshes]=e,this._meshes[this._numMeshes]=i,0===this._numMeshes&&(this._renderFunction=()=>this._updateDebugMeshes(),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),i}showBody(e){if(!this._scene)return null;for(let t=0;t<this._numBodies;t++)if(this._bodies[t]==e)return null;const t=this._getDebugBodyMesh(e);return t&&(this._bodies[this._numBodies]=e,this._bodyMeshes[this._numBodies]=t,0===this._numBodies&&(this._renderFunction=()=>this._updateDebugMeshes(),this._scene.registerBeforeRender(this._renderFunction)),this._numBodies++),t}showInertia(e){if(!this._scene)return null;for(let t=0;t<this._numInertiaBodies;t++)if(this._inertiaBodies[t]==e)return null;const t=this._getDebugInertiaMesh(e);return t&&(this._inertiaBodies[this._numInertiaBodies]=e,this._inertiaMeshes[this._numInertiaBodies]=t,0===this._numInertiaBodies&&(this._inertiaRenderFunction=()=>this._updateInertiaMeshes(),this._scene.registerBeforeRender(this._inertiaRenderFunction)),this._numInertiaBodies++),t}showConstraint(e){if(!this._scene)return null;for(let t=0;t<this._numConstraints;t++)if(this._constraints[t]==e)return null;const t=this._getDebugConstraintMesh(e);return t&&(this._constraints[this._numConstraints]=e,this._constraintMeshes[this._numConstraints]=t,0===this._numConstraints&&(this._constraintRenderFunction=()=>this._updateDebugConstraints(),this._scene.registerBeforeRender(this._constraintRenderFunction)),this._numConstraints++),t?t[0]:null}hideImpostor(e){if(!e||!this._scene||!this._utilityLayer)return;let t=!1;const i=this._utilityLayer.utilityLayerScene;for(let s=0;s<this._numMeshes;s++)if(this._impostors[s]==e){const e=this._meshes[s];if(!e)continue;i.removeMesh(e),e.dispose();const r=this._debugMeshMeshes.indexOf(e);r>-1&&this._debugMeshMeshes.splice(r,1),this._numMeshes--,this._numMeshes>0?(this._meshes[s]=this._meshes[this._numMeshes],this._impostors[s]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),t=!0;break}t&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}hideBody(e){if(!e||!this._scene||!this._utilityLayer)return!1;let t=!1;const i=this._utilityLayer.utilityLayerScene;for(let s=0;s<this._numBodies;s++)if(this._bodies[s]===e){const e=this._bodyMeshes[s];if(!e)continue;i.removeMesh(e),e.dispose(),this._numBodies--,this._numBodies>0?(this._bodyMeshes[s]=this._bodyMeshes[this._numBodies],this._bodies[s]=this._bodies[this._numBodies],this._bodyMeshes[this._numBodies]=null,this._bodies[this._numBodies]=null):(this._bodyMeshes[0]=null,this._bodies[0]=null),t=!0;break}return t&&0===this._numBodies&&this._scene.unregisterBeforeRender(this._renderFunction),t}hideInertia(e){if(!e||!this._scene||!this._utilityLayer)return!1;let t=!1;const i=this._utilityLayer.utilityLayerScene;for(let s=0;s<this._numInertiaBodies;s++)if(this._inertiaBodies[s]===e){const e=this._inertiaMeshes[s];if(!e)continue;i.removeMesh(e),e.dispose(),this._inertiaBodies.splice(s,1),this._inertiaMeshes.splice(s,1),this._numInertiaBodies--,t=!0;break}return t&&0===this._numInertiaBodies&&this._scene.unregisterBeforeRender(this._inertiaRenderFunction),t}hideConstraint(e){if(!e||!this._scene||!this._utilityLayer)return;let t=!1;const i=this._utilityLayer.utilityLayerScene;for(let s=0;s<this._numConstraints;s++)if(this._constraints[s]===e){const e=this._constraintMeshes[s];if(!e)continue;e.forEach((e=>{i.removeMesh(e),e.dispose()})),this._constraints.splice(s,1),this._constraintMeshes.splice(s,1),this._numConstraints--,this._numConstraints>0?(this._constraints[s]=this._constraints[this._numConstraints],this._constraintMeshes[s]=this._constraintMeshes[this._numConstraints],this._constraints[this._numConstraints]=null,this._constraintMeshes[this._numConstraints]=null):(this._constraints[0]=null,this._constraintMeshes[0]=null),t=!0;break}t&&0===this._numConstraints&&this._scene.unregisterBeforeRender(this._constraintRenderFunction)}_getDebugMaterial(e){return this._debugMaterial||(this._debugMaterial=new ft.F("",e),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=bt.v9.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial}_getDebugInertiaMaterial(e){return this._debugInertiaMaterial||(this._debugInertiaMaterial=new ft.F("",e),this._debugInertiaMaterial.disableLighting=!0,this._debugInertiaMaterial.alpha=0),this._debugInertiaMaterial}_getDebugAxisColoredMaterial(e,t){const i=new ft.F("",t);return i.emissiveColor=0==e?bt.v9.Red():1==e?bt.v9.Green():bt.v9.Blue(),i.disableLighting=!0,i}_getDebugBoxMesh(e){return this._debugBoxMesh||(this._debugBoxMesh=so("physicsBodyBoxViewMesh",{size:1},e),this._debugBoxMesh.rotationQuaternion=gt.PT.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(e),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")}_getDebugSphereMesh(e){return this._debugSphereMesh||(this._debugSphereMesh=ao("physicsBodySphereViewMesh",{diameter:1},e),this._debugSphereMesh.rotationQuaternion=gt.PT.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(e),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodySphereViewInstance")}_getDebugCapsuleMesh(e){return this._debugCapsuleMesh||(this._debugCapsuleMesh=ea("physicsBodyCapsuleViewMesh",{height:1},e),this._debugCapsuleMesh.rotationQuaternion=gt.PT.Identity(),this._debugCapsuleMesh.material=this._getDebugMaterial(e),this._debugCapsuleMesh.setEnabled(!1)),this._debugCapsuleMesh.createInstance("physicsBodyCapsuleViewInstance")}_getDebugCylinderMesh(e){return this._debugCylinderMesh||(this._debugCylinderMesh=co("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},e),this._debugCylinderMesh.rotationQuaternion=gt.PT.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(e),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyCylinderViewInstance")}_getDebugMeshMesh(e,t){const i=new zn.e(e.name,t,null,e);return i.setParent(e),i.position=gt.Pq.Zero(),i.material=this._getDebugMaterial(t),this._debugMeshMeshes.push(i),i}_getDebugMesh(e,t){if(!this._utilityLayer)return null;if(t&&t.parent&&t.parent.physicsImpostor)return null;let i=null;const s=this._utilityLayer.utilityLayerScene;if(!e.physicsBody)return It.V.Warn("Unable to get physicsBody of impostor. It might be initialized later by its parent's impostor."),null;switch(e.type){case Rc.BoxImpostor:i=this._getDebugBoxMesh(s),e.getBoxSizeToRef(i.scaling);break;case Rc.SphereImpostor:{i=this._getDebugSphereMesh(s);const t=e.getRadius();i.scaling.x=2*t,i.scaling.y=2*t,i.scaling.z=2*t;break}case Rc.CapsuleImpostor:{i=this._getDebugCapsuleMesh(s);const t=e.object.getBoundingInfo();i.scaling.x=2*(t.boundingBox.maximum.x-t.boundingBox.minimum.x)*e.object.scaling.x,i.scaling.y=(t.boundingBox.maximum.y-t.boundingBox.minimum.y)*e.object.scaling.y,i.scaling.z=2*(t.boundingBox.maximum.z-t.boundingBox.minimum.z)*e.object.scaling.z;break}case Rc.MeshImpostor:t&&(i=this._getDebugMeshMesh(t,s));break;case Rc.NoImpostor:if(t){const e=t.getChildMeshes().filter((e=>e.physicsImpostor?1:0));e.forEach((e=>{if(e.physicsImpostor&&"Mesh"===e.getClassName()){const t=e.getBoundingInfo(),r=t.boundingBox.minimum,n=t.boundingBox.maximum;switch(e.physicsImpostor.type){case Rc.BoxImpostor:i=this._getDebugBoxMesh(s),i.position.copyFrom(r),i.position.addInPlace(n),i.position.scaleInPlace(.5);break;case Rc.SphereImpostor:i=this._getDebugSphereMesh(s);break;case Rc.CylinderImpostor:i=this._getDebugCylinderMesh(s);break;default:i=null}i&&(i.scaling.x=n.x-r.x,i.scaling.y=n.y-r.y,i.scaling.z=n.z-r.z,i.parent=e)}}))}else It.V.Warn("No target mesh parameter provided for NoImpostor. Skipping.");i=null;break;case Rc.CylinderImpostor:{i=this._getDebugCylinderMesh(s);const t=e.object.getBoundingInfo();i.scaling.x=(t.boundingBox.maximum.x-t.boundingBox.minimum.x)*e.object.scaling.x,i.scaling.y=(t.boundingBox.maximum.y-t.boundingBox.minimum.y)*e.object.scaling.y,i.scaling.z=(t.boundingBox.maximum.z-t.boundingBox.minimum.z)*e.object.scaling.z;break}}return i}_getDebugBodyMesh(e){if(!this._utilityLayer)return null;const t=this._utilityLayer.utilityLayerScene,i=new zn.e("custom",t),s=new Hn.P,r=e.getGeometry();if(s.positions=r.positions,s.indices=r.indices,s.applyToMesh(i),e._pluginDataInstances){const t=new Float32Array(16*e._pluginDataInstances.length);i.thinInstanceSetBuffer("matrix",t,16,!1)}return i.material=this._getDebugMaterial(t),i}_getMeshDebugInertiaMatrixToRef(e,t){const i=e.inertiaOrientation??gt.PT.Identity(),s=e.inertia??gt.Pq.Zero(),r=e.centerOfMass??gt.Pq.Zero(),n=6*(s.x-s.y+s.z),o=Math.sqrt(Math.max(n,0)),a=12*s.x-n,h=Math.sqrt(Math.max(a,0)),l=12*s.z-n,c=Math.sqrt(Math.max(l,0)),u=gt.AA.Vector3[0];u.set(c,o,h);const d=gt.uq.ScalingToRef(u.x,u.y,u.z,gt.AA.Matrix[0]),_=i.toRotationMatrix(gt.AA.Matrix[1]),p=gt.uq.TranslationToRef(r.x,r.y,r.z,gt.AA.Matrix[2]);return d.multiplyToRef(_,t),t.multiplyToRef(p,t),t}_getDebugInertiaMesh(e){if(!this._utilityLayer)return null;const t=this._utilityLayer.utilityLayerScene,i=ha.CreateBox("custom",{size:1},t),s=gt.uq.Identity();if(e._pluginDataInstances.length){const t=new Float32Array(16*e._pluginDataInstances.length);for(let i=0;i<e._pluginDataInstances.length;++i){const r=e.getMassProperties(i);this._getMeshDebugInertiaMatrixToRef(r,s),s.copyToArray(t,16*i)}i.thinInstanceSetBuffer("matrix",t,16,!1)}else{const t=e.getMassProperties();this._getMeshDebugInertiaMatrixToRef(t,s),s.decomposeToTransformNode(i)}return i.enableEdgesRendering(),i.edgesWidth=2,i.edgesColor=new bt.ov(1,0,1,1),i.material=this._getDebugInertiaMaterial(t),i}_getTransformFromBodyToRef(e,t,i){const s=e.transformNode;return i&&i>=0?gt.uq.FromArrayToRef(s._thinInstanceDataStorage.matrixData,i,t):t.copyFrom(s.getWorldMatrix())}_createAngularConstraintMesh(e,t,i,s,r){const n=(t-e)/(2*Math.PI),o=ha.CreateCylinder("ConstraintCylinder",{height:1e-4,diameter:3*this._constraintAngularSize,arc:n},r);o.material=this._getDebugAxisColoredMaterial(i,r),o.parent=s;const a=s.absoluteScaling;switch(i){case 0:o.rotation.z=.5*Math.PI,o.rotation.x=-e+.5*Math.PI,o.scaling.x=1/a.x,o.scaling.y=1/a.z,o.scaling.z=1/a.y;break;case 1:o.rotation.y=1.5*Math.PI+e,o.scaling.x=1/a.z,o.scaling.y=1/a.y,o.scaling.z=1/a.x;break;case 2:o.rotation.x=.5*Math.PI,o.scaling.x=1/a.x,o.scaling.y=1/a.z,o.scaling.z=1/a.y}return o}_createCage(e,t){const i=ha.CreateBox("cage",{size:1},t);i.setPivotPoint(new gt.Pq(-.5,-.5,-.5));const s=new ft.F("cage_material",t);return s.alpha=0,i.material=s,i.enableEdgesRendering(),i.edgesWidth=4,i.edgesColor=new bt.ov(1,1,1,1),i.parent=e,i}_getDebugConstraintMesh(e){if(!this._utilityLayer)return null;const t=this._utilityLayer.utilityLayerScene;if(!e._initOptions)return null;const{pivotA:i,pivotB:s,axisA:r,axisB:n,perpAxisA:o,perpAxisB:a}=e._initOptions;if(!(i&&s&&r&&n&&o&&a))return null;const h=new zn.e("parentingDebugConstraint",t),l=e.getBodiesUsingConstraint(),c=[];c.push(h);for(const u of l){const l=new Gn.V("parentOfPair",t);l.parent=h;const{parentBody:d,parentBodyIndex:_,childBody:p,childBodyIndex:g}=u,f=this._getTransformFromBodyToRef(d,gt.AA.Matrix[0],_),m=this._getTransformFromBodyToRef(p,gt.AA.Matrix[1],g),b=new Gn.V("parentCoordSystem",t);b.parent=l,b.metadata={parentBody:d,parentBodyIndex:_},f.decomposeToTransformNode(b);const v=new Gn.V("childCoordSystem",t);v.parent=l,v.metadata={childBody:p,childBodyIndex:g},m.decomposeToTransformNode(v);const T=gt.PT.FromRotationMatrix(gt.uq.FromXYZAxesToRef(r,o,r.cross(o),gt.AA.Matrix[0])),y=gt.PT.FromRotationMatrix(gt.uq.FromXYZAxesToRef(n,a,n.cross(a),gt.AA.Matrix[0])),x=i,A=s,C=new Gn.V("constraint_parent",t);C.position.copyFrom(x),C.rotationQuaternion=T,C.parent=b;const S=new Gn.V("constraint_child",t);S.parent=v,S.position.copyFrom(A),S.rotationQuaternion=y;const E=new Zx(t,this._constraintAxesSize);E.xAxis.parent=C,E.yAxis.parent=C,E.zAxis.parent=C;const R=new Zx(t,this._constraintAxesSize);R.xAxis.parent=S,R.yAxis.parent=S,R.zAxis.parent=S;const P=this._physicsEnginePlugin,I=[3,4,5],M=[I,[0,1,2]],w=[0,0];for(let t=0;t<2;t++)for(let i=0;i<3;i++){const s=M[t][i];2==P.getAxisMode(e,s)&&w[t]++}if(3!=w[1]){const i=this._createCage(C,t),s=gt.AA.Vector3[0],r=gt.AA.Vector3[1],n=[!1,!1,!1];n[0]=1==P.getAxisMode(e,0),n[1]=1==P.getAxisMode(e,1),n[2]=1==P.getAxisMode(e,2),s.x=n[0]?P.getAxisMinLimit(e,0):0,r.x=n[0]?P.getAxisMaxLimit(e,0):0,s.y=n[1]?P.getAxisMinLimit(e,1):0,r.y=n[1]?P.getAxisMaxLimit(e,1):0,s.z=n[2]?P.getAxisMinLimit(e,2):0,r.z=n[2]?P.getAxisMaxLimit(e,2):0,i.position.x=s.x+.5,i.position.y=s.y+.5,i.position.z=s.z+.5,i.scaling.x=r.x-s.x+bs.bH,i.scaling.y=r.y-s.y+bs.bH,i.scaling.z=r.z-s.z+bs.bH,c.push(i)}if(3!=w[0])for(let i=0;i<3;i++){const s=I[i],r=P.getAxisMode(e,s);let n=0,o=2*Math.PI;if(1==r&&(n=P.getAxisMinLimit(e,s),o=P.getAxisMaxLimit(e,s)),2!=r&&e.options.pivotB){const s=this._createAngularConstraintMesh(n,o,i,p.transformNode,t);s.position.copyFrom(e.options.pivotB),c.push(s)}}}return c}dispose(){for(let e=this._numMeshes-1;e>=0;e--)this.hideImpostor(this._impostors[0]);for(let e=this._numBodies-1;e>=0;e--)this.hideBody(this._bodies[0]);for(let e=this._numInertiaBodies-1;e>=0;e--)this.hideInertia(this._inertiaBodies[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)}}var Jx,eA=o(7963),tA=o.n(eA),iA=o(156);class sA{constructor(e,t,i){this._vertices=[],this._indices=[],this._isRightHanded=i.useRightHandedSystem,this._collectIndices=t}addNodeMeshes(e,t){e.computeWorldMatrix(!0);const i=gt.AA.Matrix[0];if(gt.uq.ScalingToRef(e.absoluteScaling.x,e.absoluteScaling.y,e.absoluteScaling.z,i),e instanceof zn.e?this._addMesh(e,i):e instanceof fo.Z&&this._addMesh(e.sourceMesh,i),t){const t=gt.AA.Matrix[1];e.computeWorldMatrix().invertToRef(t);const s=gt.AA.Matrix[2];t.multiplyToRef(i,s),e.getChildMeshes(!1).filter((e=>!e.physicsBody)).forEach((e=>{const t=e.computeWorldMatrix(),i=gt.AA.Matrix[3];t.multiplyToRef(s,i),e instanceof zn.e?this._addMesh(e,i):e instanceof fo.Z&&this._addMesh(e.sourceMesh,i)}))}}_addMesh(e,t){const i=e.getVerticesData(Mt.R.PositionKind)||[],s=i.length/3,r=this._vertices.length;for(let e=0;e<s;e++){const s=new gt.Pq(i[3*e+0],i[3*e+1],i[3*e+2]);this._vertices.push(gt.Pq.TransformCoordinates(s,t))}if(this._collectIndices){const t=e.getIndices();if(t)for(let e=0;e<t.length;e+=3)this._isRightHanded?(this._indices.push(t[e+0]+r),this._indices.push(t[e+1]+r),this._indices.push(t[e+2]+r)):(this._indices.push(t[e+2]+r),this._indices.push(t[e+1]+r),this._indices.push(t[e+0]+r))}}getVertices(e){const t=3*this._vertices.length,i=4*t,s=e._malloc(i),r=new Float32Array(e.HEAPU8.buffer,s,t);for(let e=0;e<this._vertices.length;e++)r[3*e+0]=this._vertices[e].x,r[3*e+1]=this._vertices[e].y,r[3*e+2]=this._vertices[e].z;return{offset:s,numObjects:t}}freeBuffer(e,t){e._free(t.offset)}getTriangles(e){const t=4*this._indices.length,i=e._malloc(t),s=new Int32Array(e.HEAPU8.buffer,i,this._indices.length);for(let e=0;e<this._indices.length;e++)s[e]=this._indices[e];return{offset:i,numObjects:this._indices.length}}}class rA{constructor(e){this.hpBodyId=e,this.userMassProps={centerOfMass:void 0,mass:void 0,inertia:void 0,inertiaOrientation:void 0}}}class nA{constructor(){this.bodyId=BigInt(0),this.position=new gt.Pq,this.normal=new gt.Pq}}class oA{constructor(){this.contactOnA=new nA,this.contactOnB=new nA,this.impulseApplied=0,this.type=0}static readToRef(e,t,i){const s=new Int32Array(e,t),r=new Float32Array(e,t);i.contactOnA.bodyId=BigInt(s[2]),i.contactOnA.position.set(r[10],r[11],r[12]),i.contactOnA.normal.set(r[13],r[14],r[15]),i.contactOnB.bodyId=BigInt(s[18]),i.contactOnB.position.set(r[26],r[27],r[28]),i.contactOnB.normal.set(r[29],r[30],r[31]),i.impulseApplied=r[34],i.type=s[0]}}class aA{constructor(){this.bodyIdA=BigInt(0),this.bodyIdB=BigInt(0),this.type=0}static readToRef(e,t,i){const s=new Int32Array(e,t);i.type=s[0],i.bodyIdA=BigInt(s[2]),i.bodyIdB=BigInt(s[6])}}class hA{constructor(e=!0,t=HK){this._useDeltaForWorldStep=e,this._hknp={},this.name="HavokPlugin",this._fixedTimeStep=1/60,this._tmpVec3=(0,Cc.mI)(3,gt.Pq.Zero),this._bodies=new Map,this._shapes=new Map,this._bodyCollisionObservable=new Map,this._constraintToBodyIdPair=new Map,this._bodyCollisionEndedObservable=new Map,this.onCollisionObservable=new Zi.cP,this.onCollisionEndedObservable=new Zi.cP,this.onTriggerCollisionObservable=new Zi.cP,"function"!=typeof t?(this._hknp=t,this.isSupported()?(this.world=this._hknp.HP_World_Create()[1],this._queryCollector=this._hknp.HP_QueryCollector_Create(1)[1]):It.V.Error("Havok is not available. Please make sure you included the js file.")):It.V.Error("Havok is not ready. Please make sure you await HK() before using the plugin.")}isSupported(){return void 0!==this._hknp}setGravity(e){this._hknp.HP_World_SetGravity(this.world,this._bVecToV3(e))}setTimeStep(e){this._fixedTimeStep=e}getTimeStep(){return this._fixedTimeStep}executeStep(e,t){for(const e of t)e.disablePreStep||this.setPhysicsBodyTransformation(e,e.transformNode);const i=this._useDeltaForWorldStep?e:this._fixedTimeStep;this._hknp.HP_World_SetIdealStepTime(this.world,i),this._hknp.HP_World_Step(this.world,i),this._bodyBuffer=this._hknp.HP_World_GetBodyBuffer(this.world)[1];for(const e of t)e.disableSync||this.sync(e);this._notifyCollisions(),this._notifyTriggers()}getPluginVersion(){return 2}setVelocityLimits(e,t){this._hknp.HP_World_SetSpeedLimit(this.world,e,t)}getMaxLinearVelocity(){return this._hknp.HP_World_GetSpeedLimit(this.world)[1]}getMaxAngularVelocity(){return this._hknp.HP_World_GetSpeedLimit(this.world)[2]}initBody(e,t,i,s){e._pluginData=new rA(this._hknp.HP_Body_Create()[1]),this._internalSetMotionType(e._pluginData,t);const r=[this._bVecToV3(i),this._bQuatToV4(s)];this._hknp.HP_Body_SetQTransform(e._pluginData.hpBodyId,r),this._hknp.HP_World_AddBody(this.world,e._pluginData.hpBodyId,e.startAsleep),this._bodies.set(e._pluginData.hpBodyId[0],{body:e,index:0})}removeBody(e){if(e._pluginDataInstances&&e._pluginDataInstances.length>0)for(const t of e._pluginDataInstances)this._bodyCollisionObservable.delete(t.hpBodyId[0]),this._hknp.HP_World_RemoveBody(this.world,t.hpBodyId),this._bodies.delete(t.hpBodyId[0]);e._pluginData&&(this._bodyCollisionObservable.delete(e._pluginData.hpBodyId[0]),this._hknp.HP_World_RemoveBody(this.world,e._pluginData.hpBodyId),this._bodies.delete(e._pluginData.hpBodyId[0]))}initBodyInstances(e,t,i){const s=i._thinInstanceDataStorage?.instancesCount??0,r=i._thinInstanceDataStorage.matrixData;r&&(this._createOrUpdateBodyInstances(e,t,r,0,s,!1),e._pluginDataInstances.forEach(((t,i)=>{this._bodies.set(t.hpBodyId[0],{body:e,index:i})})))}_createOrUpdateBodyInstances(e,t,i,s,r,n){const o=gt.AA.Quaternion[0],a=gt.uq.Identity();for(let h=s;h<r;h++){const s=[i[16*h+12],i[16*h+13],i[16*h+14]];let r;r=n?e._pluginDataInstances[h].hpBodyId:this._hknp.HP_Body_Create()[1],a.setRowFromFloats(0,i[16*h+0],i[16*h+1],i[16*h+2],0),a.setRowFromFloats(1,i[16*h+4],i[16*h+5],i[16*h+6],0),a.setRowFromFloats(2,i[16*h+8],i[16*h+9],i[16*h+10],0),gt.PT.FromRotationMatrixToRef(a,o);const l=[s,[o.x,o.y,o.z,o.w]];if(this._hknp.HP_Body_SetQTransform(r,l),!n){const i=new rA(r);e._pluginDataInstances.length&&(i.userMassProps=e._pluginDataInstances[0].userMassProps),this._internalSetMotionType(i,t),this._internalUpdateMassProperties(i),e._pluginDataInstances.push(i),this._hknp.HP_World_AddBody(this.world,r,e.startAsleep),i.worldTransformOffset=this._hknp.HP_Body_GetWorldTransformOffset(r)[1]}}}updateBodyInstances(e,t){const i=t._thinInstanceDataStorage?.instancesCount??0,s=t._thinInstanceDataStorage.matrixData;if(!s)return;const r=e._pluginDataInstances.length,n=this.getMotionType(e);if(i>r){this._createOrUpdateBodyInstances(e,n,s,r,i,!1);const t=this._hknp.HP_Body_GetShape(e._pluginDataInstances[0].hpBodyId)[1];t[0]||(t[0]=e.shape?._pluginData[0]);for(let s=r;s<i;s++)this._hknp.HP_Body_SetShape(e._pluginDataInstances[s].hpBodyId,t),this._internalUpdateMassProperties(e._pluginDataInstances[s]),this._bodies.set(e._pluginDataInstances[s].hpBodyId[0],{body:e,index:s})}else if(i<r){const t=r-i;for(let i=0;i<t;i++){const t=e._pluginDataInstances.pop();this._bodies.delete(t.hpBodyId[0]),this._hknp.HP_World_RemoveBody(this.world,t.hpBodyId),this._hknp.HP_Body_Release(t.hpBodyId)}this._createOrUpdateBodyInstances(e,n,s,0,i,!0)}}sync(e){this.syncTransform(e,e.transformNode)}syncTransform(e,t){if(e._pluginDataInstances.length){const i=t,s=i._thinInstanceDataStorage.matrixData;if(!s)return;const r=e._pluginDataInstances.length;for(let t=0;t<r;t++){const i=e._pluginDataInstances[t].worldTransformOffset,r=new Float32Array(this._hknp.HEAPU8.buffer,this._bodyBuffer+i,16),n=16*t;for(let e=0;e<15;e++)3&~e&&(s[n+e]=r[e]);s[n+15]=1}i.thinInstanceBufferUpdated("matrix")}else try{const i=this._hknp.HP_Body_GetQTransform(e._pluginData.hpBodyId)[1],s=i[0],r=i[1],n=gt.AA.Quaternion[0];n.set(r[0],r[1],r[2],r[3]);const o=t.parent;if(o&&!o.getWorldMatrix().isIdentity()){o.computeWorldMatrix(!0),gt.AA.Vector3[1].copyFrom(t.scaling),n.normalize();const e=gt.AA.Matrix[0],i=gt.AA.Vector3[0];i.copyFromFloats(s[0],s[1],s[2]),gt.uq.ComposeToRef(t.absoluteScaling,n,i,e);const r=gt.AA.Matrix[1];o.getWorldMatrix().invertToRef(r);const a=gt.AA.Matrix[2];e.multiplyToRef(r,a),a.decomposeToTransformNode(t),t.rotationQuaternion?.normalize(),t.scaling.copyFrom(gt.AA.Vector3[1])}else t.position.set(s[0],s[1],s[2]),t.rotationQuaternion?t.rotationQuaternion.copyFrom(n):n.toEulerAnglesToRef(t.rotation)}catch(e){It.V.Error(`Syncing transform failed for node ${t.name}: ${e.message}...`)}}setShape(e,t){const i=t&&t._pluginData?t._pluginData:BigInt(0);if(!(e.transformNode instanceof zn.e&&e.transformNode._thinInstanceDataStorage?.matrixData))return this._hknp.HP_Body_SetShape(e._pluginData.hpBodyId,i),void this._internalUpdateMassProperties(e._pluginData);const s=e.transformNode,r=s._thinInstanceDataStorage?.instancesCount??0;for(let t=0;t<r;t++)this._hknp.HP_Body_SetShape(e._pluginDataInstances[t].hpBodyId,i),this._internalUpdateMassProperties(e._pluginDataInstances[t])}_getPluginReference(e,t){return e._pluginDataInstances?.length?e._pluginDataInstances[t??0]:e._pluginData}getShape(e){const t=this._getPluginReference(e),i=this._hknp.HP_Body_GetShape(t.hpBodyId)[1];if(0!=i){const t=e.transformNode.getScene();return new Wx({pluginData:i},t)}return null}getShapeType(e){return e.type?e.type:this._hknp.HP_Shape_GetType(e._pluginData)}setEventMask(e,t,i){this._applyToBodyOrInstances(e,(e=>{this._hknp.HP_Body_SetEventMask(e.hpBodyId,t)}),i)}getEventMask(e,t){const i=this._getPluginReference(e,t);return this._hknp.HP_Body_GetEventMask(i.hpBodyId)[1]}_fromMassPropertiesTuple(e){return{centerOfMass:gt.Pq.FromArray(e[0]),mass:e[1],inertia:gt.Pq.FromArray(e[2]),inertiaOrientation:gt.PT.FromArray(e[3])}}_internalUpdateMassProperties(e){const t=this._internalComputeMassProperties(e),i=e.userMassProps;i.centerOfMass&&(t[0]=i.centerOfMass.asArray()),null!=i.mass&&(t[1]=i.mass),i.inertia&&(t[2]=i.inertia.asArray()),i.inertiaOrientation&&(t[3]=i.inertiaOrientation.asArray()),this._hknp.HP_Body_SetMassProperties(e.hpBodyId,t)}_internalSetMotionType(e,t){switch(t){case 0:this._hknp.HP_Body_SetMotionType(e.hpBodyId,this._hknp.MotionType.STATIC);break;case 1:this._hknp.HP_Body_SetMotionType(e.hpBodyId,this._hknp.MotionType.KINEMATIC);break;case 2:this._hknp.HP_Body_SetMotionType(e.hpBodyId,this._hknp.MotionType.DYNAMIC)}}setMotionType(e,t,i){this._applyToBodyOrInstances(e,(e=>{this._internalSetMotionType(e,t)}),i)}getMotionType(e,t){const i=this._getPluginReference(e,t),s=this._hknp.HP_Body_GetMotionType(i.hpBodyId)[1];switch(s){case this._hknp.MotionType.STATIC:return 0;case this._hknp.MotionType.KINEMATIC:return 1;case this._hknp.MotionType.DYNAMIC:return 2}throw new Error("Unknown motion type: "+s)}setActivationControl(e,t){switch(t){case 1:this._hknp.HP_Body_SetActivationControl(e._pluginData.hpBodyId,this._hknp.ActivationControl.ALWAYS_ACTIVE);break;case 2:this._hknp.HP_Body_SetActivationControl(e._pluginData.hpBodyId,this._hknp.ActivationControl.ALWAYS_INACTIVE);break;case 0:this._hknp.HP_Body_SetActivationControl(e._pluginData.hpBodyId,this._hknp.ActivationControl.SIMULATION_CONTROLLED)}}_internalComputeMassProperties(e){const t=this._hknp.HP_Body_GetShape(e.hpBodyId);if(t[0]==this._hknp.Result.RESULT_OK){const e=this._hknp.HP_Shape_BuildMassProperties(t[1]);if(e[0]==this._hknp.Result.RESULT_OK)return e[1]}return[[0,0,0],1,[1,1,1],[0,0,0,1]]}computeMassProperties(e,t){const i=this._getPluginReference(e,t),s=this._internalComputeMassProperties(i);return this._fromMassPropertiesTuple(s)}setMassProperties(e,t,i){this._applyToBodyOrInstances(e,(e=>{e.userMassProps=t,this._internalUpdateMassProperties(e)}),i)}getMassProperties(e,t){const i=this._getPluginReference(e,t),s=this._hknp.HP_Body_GetMassProperties(i.hpBodyId)[1];return this._fromMassPropertiesTuple(s)}setLinearDamping(e,t,i){this._applyToBodyOrInstances(e,(e=>{this._hknp.HP_Body_SetLinearDamping(e.hpBodyId,t)}),i)}getLinearDamping(e,t){const i=this._getPluginReference(e,t);return this._hknp.HP_Body_GetLinearDamping(i.hpBodyId)[1]}setAngularDamping(e,t,i){this._applyToBodyOrInstances(e,(e=>{this._hknp.HP_Body_SetAngularDamping(e.hpBodyId,t)}),i)}getAngularDamping(e,t){const i=this._getPluginReference(e,t);return this._hknp.HP_Body_GetAngularDamping(i.hpBodyId)[1]}setLinearVelocity(e,t,i){this._applyToBodyOrInstances(e,(e=>{this._hknp.HP_Body_SetLinearVelocity(e.hpBodyId,this._bVecToV3(t))}),i)}getLinearVelocityToRef(e,t,i){const s=this._getPluginReference(e,i),r=this._hknp.HP_Body_GetLinearVelocity(s.hpBodyId)[1];this._v3ToBvecRef(r,t)}_applyToBodyOrInstances(e,t,i){if(e._pluginDataInstances?.length>0&&void 0===i)for(let i=0;i<e._pluginDataInstances.length;i++)t(e._pluginDataInstances[i]);else t(this._getPluginReference(e,i))}applyImpulse(e,t,i,s){this._applyToBodyOrInstances(e,(e=>{this._hknp.HP_Body_ApplyImpulse(e.hpBodyId,this._bVecToV3(i),this._bVecToV3(t))}),s)}applyAngularImpulse(e,t,i){this._applyToBodyOrInstances(e,(e=>{this._hknp.HP_Body_ApplyAngularImpulse(e.hpBodyId,this._bVecToV3(t))}),i)}applyForce(e,t,i,s){t.scaleToRef(this.getTimeStep(),this._tmpVec3[0]),this.applyImpulse(e,this._tmpVec3[0],i,s)}setAngularVelocity(e,t,i){this._applyToBodyOrInstances(e,(e=>{this._hknp.HP_Body_SetAngularVelocity(e.hpBodyId,this._bVecToV3(t))}),i)}getAngularVelocityToRef(e,t,i){const s=this._getPluginReference(e,i),r=this._hknp.HP_Body_GetAngularVelocity(s.hpBodyId)[1];this._v3ToBvecRef(r,t)}setPhysicsBodyTransformation(e,t){if(e.getPrestepType()==Gx.TELEPORT){const i=e.transformNode;if(e.numInstances>0){const t=i._thinInstanceDataStorage.matrixData;if(!t)return;const s=e.numInstances;this._createOrUpdateBodyInstances(e,e.getMotionType(),t,0,s,!0)}else this._hknp.HP_Body_SetQTransform(e._pluginData.hpBodyId,this._getTransformInfos(t))}else e.getPrestepType()==Gx.ACTION?this.setTargetTransform(e,t.absolutePosition,t.absoluteRotationQuaternion):e.getPrestepType()==Gx.DISABLED?It.V.Warn("Prestep type is set to DISABLED. Unable to set physics body transformation."):It.V.Warn("Invalid prestep type set to physics body.")}setTargetTransform(e,t,i,s){this._applyToBodyOrInstances(e,(e=>{this._hknp.HP_Body_SetTargetQTransform(e.hpBodyId,[this._bVecToV3(t),this._bQuatToV4(i)])}),s)}setGravityFactor(e,t,i){this._applyToBodyOrInstances(e,(e=>{this._hknp.HP_Body_SetGravityFactor(e.hpBodyId,t)}),i)}getGravityFactor(e,t){const i=this._getPluginReference(e,t);return this._hknp.HP_Body_GetGravityFactor(i.hpBodyId)[1]}disposeBody(e){if(e._pluginDataInstances&&e._pluginDataInstances.length>0)for(const t of e._pluginDataInstances)this._hknp.HP_Body_Release(t.hpBodyId),t.hpBodyId=void 0;e._pluginData&&(this._hknp.HP_Body_Release(e._pluginData.hpBodyId),e._pluginData.hpBodyId=void 0)}_createOptionsFromGroundMesh(e){const t=e.groundMesh;if(!t)return;let i=t.getVerticesData(Mt.R.PositionKind);const s=t.computeWorldMatrix(!0),r=[];let n;for(n=0;n<i.length;n+=3)gt.Pq.FromArrayToRef(i,n,gt.AA.Vector3[0]),gt.Pq.TransformCoordinatesToRef(gt.AA.Vector3[0],s,gt.AA.Vector3[1]),gt.AA.Vector3[1].toArray(r,n);i=r;const o=~~(Math.sqrt(i.length/3)-1),a=t.getBoundingInfo(),h=Math.min(a.boundingBox.extendSizeWorld.x,a.boundingBox.extendSizeWorld.z),l=a.boundingBox.minimumWorld.x,c=a.boundingBox.minimumWorld.y,u=a.boundingBox.minimumWorld.z,d=new Float32Array((o+1)*(o+1)),_=2*h/o;for(let e=0;e<d.length;e++)d[e]=c;for(let e=0;e<i.length;e+=3){const t=Math.round((i[e+0]-l)/_),s=o-Math.round((i[e+2]-u)/_),r=i[e+1]-c;d[s*(o+1)+t]=r}e.numHeightFieldSamplesX=o+1,e.numHeightFieldSamplesZ=o+1,e.heightFieldSizeX=2*a.boundingBox.extendSizeWorld.x,e.heightFieldSizeZ=2*a.boundingBox.extendSizeWorld.z,e.heightFieldData=d}initShape(e,t,i){switch(t){case 0:{const t=i.radius||1,s=i.center?this._bVecToV3(i.center):[0,0,0];e._pluginData=this._hknp.HP_Shape_CreateSphere(s,t)[1]}break;case 3:{const t=i.rotation?this._bQuatToV4(i.rotation):[0,0,0,1],s=i.extents?this._bVecToV3(i.extents):[1,1,1],r=i.center?this._bVecToV3(i.center):[0,0,0];e._pluginData=this._hknp.HP_Shape_CreateBox(r,t,s)[1]}break;case 1:{const t=i.pointA?this._bVecToV3(i.pointA):[0,0,0],s=i.pointB?this._bVecToV3(i.pointB):[0,1,0],r=i.radius||0;e._pluginData=this._hknp.HP_Shape_CreateCapsule(t,s,r)[1]}break;case 5:e._pluginData=this._hknp.HP_Shape_CreateContainer()[1];break;case 2:{const t=i.pointA?this._bVecToV3(i.pointA):[0,0,0],s=i.pointB?this._bVecToV3(i.pointB):[0,1,0],r=i.radius||0;e._pluginData=this._hknp.HP_Shape_CreateCylinder(t,s,r)[1]}break;case 4:case 6:{const s=i.mesh;if(!s)throw new Error("No mesh provided to create physics shape.");{const r=!!i.includeChildMeshes,n=new sA(s,4!=t,s?.getScene());n.addNodeMeshes(s,r);const o=n.getVertices(this._hknp),a=o.numObjects/3;if(4==t)e._pluginData=this._hknp.HP_Shape_CreateConvexHull(o.offset,a)[1];else{const t=n.getTriangles(this._hknp),i=t.numObjects/3;e._pluginData=this._hknp.HP_Shape_CreateMesh(o.offset,a,t.offset,i)[1],n.freeBuffer(this._hknp,t)}n.freeBuffer(this._hknp,o)}}break;case 7:if(i.groundMesh&&this._createOptionsFromGroundMesh(i),!(i.numHeightFieldSamplesX&&i.numHeightFieldSamplesZ&&i.heightFieldSizeX&&i.heightFieldSizeZ&&i.heightFieldData))throw new Error("Missing required heightfield parameters");{const t=i.numHeightFieldSamplesX*i.numHeightFieldSamplesZ,s=4*t,r=this._hknp._malloc(s),n=new Float32Array(this._hknp.HEAPU8.buffer,r,t);for(let e=0;e<i.numHeightFieldSamplesX;e++)for(let t=0;t<i.numHeightFieldSamplesZ;t++){const s=t*i.numHeightFieldSamplesX+e,r=(i.numHeightFieldSamplesX-1-e)*i.numHeightFieldSamplesZ+t;n[s]=i.heightFieldData[r]}const o=i.heightFieldSizeX/(i.numHeightFieldSamplesX-1),a=i.heightFieldSizeZ/(i.numHeightFieldSamplesZ-1);e._pluginData=this._hknp.HP_Shape_CreateHeightField(i.numHeightFieldSamplesX,i.numHeightFieldSamplesZ,[o,1,a],r)[1],this._hknp._free(r)}break;default:throw new Error("Unsupported Shape Type.")}this._shapes.set(e._pluginData[0],e)}setShapeFilterMembershipMask(e,t){const i=this._hknp.HP_Shape_GetFilterInfo(e._pluginData)[1][1];this._hknp.HP_Shape_SetFilterInfo(e._pluginData,[t,i])}getShapeFilterMembershipMask(e){return this._hknp.HP_Shape_GetFilterInfo(e._pluginData)[1][0]}setShapeFilterCollideMask(e,t){const i=this._hknp.HP_Shape_GetFilterInfo(e._pluginData)[1][0];this._hknp.HP_Shape_SetFilterInfo(e._pluginData,[i,t])}getShapeFilterCollideMask(e){return this._hknp.HP_Shape_GetFilterInfo(e._pluginData)[1][1]}setMaterial(e,t){const i=t.friction??.5,s=t.staticFriction??i,r=t.restitution??0,n=t.frictionCombine??1,o=t.restitutionCombine??2,a=[s,i,r,this._materialCombineToNative(n),this._materialCombineToNative(o)];this._hknp.HP_Shape_SetMaterial(e._pluginData,a)}getMaterial(e){const t=this._hknp.HP_Shape_GetMaterial(e._pluginData)[1];return{staticFriction:t[0],friction:t[1],restitution:t[2],frictionCombine:this._nativeToMaterialCombine(t[3]),restitutionCombine:this._nativeToMaterialCombine(t[4])}}setDensity(e,t){this._hknp.HP_Shape_SetDensity(e._pluginData,t)}getDensity(e){return this._hknp.HP_Shape_GetDensity(e._pluginData)[1]}_getTransformInfos(e){if(e.parent)return e.computeWorldMatrix(!0),[this._bVecToV3(e.absolutePosition),this._bQuatToV4(e.absoluteRotationQuaternion)];let t=gt.AA.Quaternion[0];if(e.rotationQuaternion)t=e.rotationQuaternion;else{const i=e.rotation;gt.PT.FromEulerAnglesToRef(i.x,i.y,i.z,t)}return[this._bVecToV3(e.position),this._bQuatToV4(t)]}addChild(e,t,i,s,r){const n=[i?this._bVecToV3(i):[0,0,0],s?this._bQuatToV4(s):[0,0,0,1],r?this._bVecToV3(r):[1,1,1]];this._hknp.HP_Shape_AddChild(e._pluginData,t._pluginData,n)}removeChild(e,t){this._hknp.HP_Shape_RemoveChild(e._pluginData,t)}getNumChildren(e){return this._hknp.HP_Shape_GetNumChildren(e._pluginData)[1]}setTrigger(e,t){this._hknp.HP_Shape_SetTrigger(e._pluginData,t)}getBoundingBox(e){const t=this._hknp.HP_Shape_GetBoundingBox(e._pluginData,[[0,0,0],[0,0,0,1]])[1];return gt.AA.Vector3[0].set(t[0][0],t[0][1],t[0][2]),gt.AA.Vector3[1].set(t[1][0],t[1][1],t[1][2]),new iA.I(gt.AA.Vector3[0],gt.AA.Vector3[1],gt.uq.IdentityReadOnly)}getBodyBoundingBox(e){const t=this.getBoundingBox(e.shape);return new iA.I(t.minimum,t.maximum,e.transformNode.getWorldMatrix())}getBodyGeometry(e){const t=e._pluginDataInstances?.length>0?e._pluginDataInstances[0]:e._pluginData,i=this._hknp.HP_Body_GetShape(t.hpBodyId)[1],s=this._hknp.HP_Shape_CreateDebugDisplayGeometry(i);if(s[0]!=this._hknp.Result.RESULT_OK)return{positions:[],indices:[]};const r=this._hknp.HP_DebugGeometry_GetInfo(s[1])[1],n=new Float32Array(this._hknp.HEAPU8.buffer,r[0],3*r[1]),o=new Uint32Array(this._hknp.HEAPU8.buffer,r[2],3*r[3]),a=n.slice(0),h=o.slice(0);return this._hknp.HP_DebugGeometry_Release(s[1]),{positions:a,indices:h}}disposeShape(e){this._hknp.HP_Shape_Release(e._pluginData),e._pluginData=void 0}initConstraint(e,t,i,s,r){const n=e.type,o=e.options;if(!n||!o)return void It.V.Warn("No constraint type or options. Constraint is invalid.");if(t._pluginDataInstances.length>0&&void 0===s||i._pluginDataInstances.length>0&&void 0===r)return void It.V.Warn("Body is instanced but no instance index was specified. Constraint will not be applied.");e._pluginData=e._pluginData??[];const a=this._hknp.HP_Constraint_Create()[1];e._pluginData.push(a);const h=this._getPluginReference(t,s).hpBodyId,l=this._getPluginReference(i,r).hpBodyId;this._hknp.HP_Constraint_SetParentBody(a,h),this._hknp.HP_Constraint_SetChildBody(a,l),this._constraintToBodyIdPair.set(a[0],[h[0],l[0]]);const c=o.pivotA?this._bVecToV3(o.pivotA):this._bVecToV3(gt.Pq.Zero()),u=o.axisA??new gt.Pq(1,0,0),d=this._tmpVec3[0];o.perpAxisA?d.copyFrom(o.perpAxisA):u.getNormalToRef(d),this._hknp.HP_Constraint_SetAnchorInParent(a,c,this._bVecToV3(u),this._bVecToV3(d));const _=o.pivotB?this._bVecToV3(o.pivotB):this._bVecToV3(gt.Pq.Zero()),p=o.axisB??new gt.Pq(1,0,0),g=this._tmpVec3[0];if(o.perpAxisB?g.copyFrom(o.perpAxisB):p.getNormalToRef(g),this._hknp.HP_Constraint_SetAnchorInChild(a,_,this._bVecToV3(p),this._bVecToV3(g)),e._initOptions||(e._initOptions={axisA:u.clone(),axisB:p.clone(),perpAxisA:d.clone(),perpAxisB:g.clone(),pivotA:new gt.Pq(c[0],c[1],c[2]),pivotB:new gt.Pq(_[0],_[1],_[2])}),5==n)this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(2==n){const e=o.maxDistance||0,t=this._hknp.ConstraintAxis.LINEAR_DISTANCE;this._hknp.HP_Constraint_SetAxisMode(a,t,this._hknp.ConstraintAxisLimitMode.LIMITED),this._hknp.HP_Constraint_SetAxisMinLimit(a,t,e),this._hknp.HP_Constraint_SetAxisMaxLimit(a,t,e)}else if(3==n)this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(6==n)this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(4==n)this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(1==n)this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(a,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else{if(7!=n)throw new Error("Unsupported Constraint Type.");{const t=e;for(const e of t.limits){const t=this._constraintAxisToNative(e.axis);0==(e.minLimit??-1)&&0==(e.maxLimit??-1)?this._hknp.HP_Constraint_SetAxisMode(a,t,this._hknp.ConstraintAxisLimitMode.LOCKED):(null!=e.minLimit&&(this._hknp.HP_Constraint_SetAxisMode(a,t,this._hknp.ConstraintAxisLimitMode.LIMITED),this._hknp.HP_Constraint_SetAxisMinLimit(a,t,e.minLimit)),null!=e.maxLimit&&(this._hknp.HP_Constraint_SetAxisMode(a,t,this._hknp.ConstraintAxisLimitMode.LIMITED),this._hknp.HP_Constraint_SetAxisMaxLimit(a,t,e.maxLimit))),e.stiffness&&this._hknp.HP_Constraint_SetAxisStiffness(a,t,e.stiffness),e.damping&&this._hknp.HP_Constraint_SetAxisDamping(a,t,e.damping)}}}const f=!!o.collision;this._hknp.HP_Constraint_SetCollisionsEnabled(a,f),this._hknp.HP_Constraint_SetEnabled(a,!0)}getBodiesUsingConstraint(e){const t=[];for(const i of e._pluginData){const e=this._constraintToBodyIdPair.get(i[0]);if(e){const i=this._bodies.get(e[0]),s=this._bodies.get(e[1]);i&&s&&t.push({parentBody:i.body,parentBodyIndex:i.index,childBody:s.body,childBodyIndex:s.index})}}return t}addConstraint(e,t,i,s,r){this.initConstraint(i,e,t,s,r)}setEnabled(e,t){for(const i of e._pluginData)this._hknp.HP_Constraint_SetEnabled(i,t)}getEnabled(e){const t=e._pluginData&&e._pluginData[0];return!!t&&this._hknp.HP_Constraint_GetEnabled(t)[1]}setCollisionsEnabled(e,t){for(const i of e._pluginData)this._hknp.HP_Constraint_SetCollisionsEnabled(i,t)}getCollisionsEnabled(e){const t=e._pluginData&&e._pluginData[0];return!!t&&this._hknp.HP_Constraint_GetCollisionsEnabled(t)[1]}setAxisFriction(e,t,i){for(const s of e._pluginData)this._hknp.HP_Constraint_SetAxisFriction(s,this._constraintAxisToNative(t),i)}getAxisFriction(e,t){const i=e._pluginData&&e._pluginData[0];return i?this._hknp.HP_Constraint_GetAxisFriction(i,this._constraintAxisToNative(t))[1]:null}setAxisMode(e,t,i){for(const s of e._pluginData)this._hknp.HP_Constraint_SetAxisMode(s,this._constraintAxisToNative(t),this._limitModeToNative(i))}getAxisMode(e,t){const i=e._pluginData&&e._pluginData[0];if(i){const e=this._hknp.HP_Constraint_GetAxisMode(i,this._constraintAxisToNative(t))[1];return this._nativeToLimitMode(e)}return null}setAxisMinLimit(e,t,i){for(const s of e._pluginData)this._hknp.HP_Constraint_SetAxisMinLimit(s,this._constraintAxisToNative(t),i)}getAxisMinLimit(e,t){const i=e._pluginData&&e._pluginData[0];return i?this._hknp.HP_Constraint_GetAxisMinLimit(i,this._constraintAxisToNative(t))[1]:null}setAxisMaxLimit(e,t,i){for(const s of e._pluginData)this._hknp.HP_Constraint_SetAxisMaxLimit(s,this._constraintAxisToNative(t),i)}getAxisMaxLimit(e,t){const i=e._pluginData&&e._pluginData[0];return i?this._hknp.HP_Constraint_GetAxisMaxLimit(i,this._constraintAxisToNative(t))[1]:null}setAxisMotorType(e,t,i){for(const s of e._pluginData)this._hknp.HP_Constraint_SetAxisMotorType(s,this._constraintAxisToNative(t),this._constraintMotorTypeToNative(i))}getAxisMotorType(e,t){const i=e._pluginData&&e._pluginData[0];return i?this._nativeToMotorType(this._hknp.HP_Constraint_GetAxisMotorType(i,this._constraintAxisToNative(t))[1]):null}setAxisMotorTarget(e,t,i){for(const s of e._pluginData)this._hknp.HP_Constraint_SetAxisMotorTarget(s,this._constraintAxisToNative(t),i)}getAxisMotorTarget(e,t){return e._pluginData&&e._pluginData[0]?this._hknp.HP_Constraint_GetAxisMotorTarget(e._pluginData,this._constraintAxisToNative(t))[1]:null}setAxisMotorMaxForce(e,t,i){for(const s of e._pluginData)this._hknp.HP_Constraint_SetAxisMotorMaxForce(s,this._constraintAxisToNative(t),i)}getAxisMotorMaxForce(e,t){const i=e._pluginData&&e._pluginData[0];return i?this._hknp.HP_Constraint_GetAxisMotorMaxForce(i,this._constraintAxisToNative(t))[1]:null}disposeConstraint(e){for(const t of e._pluginData)this._hknp.HP_Constraint_SetEnabled(t,!1),this._hknp.HP_Constraint_Release(t);e._pluginData.length=0}_populateHitData(e,t){const i=this._bodies.get(e[0][0]);t.body=i?.body,t.bodyIndex=i?.index;const s=this._shapes.get(e[1][0]);t.shape=s;const r=e[3],n=e[4],o=e[5];t.setHitData({x:n[0],y:n[1],z:n[2]},{x:r[0],y:r[1],z:r[2]},o)}raycast(e,t,i,s){const r=s?.membership??-1,n=s?.collideWith??-1,o=s?.shouldHitTriggers??!1;i.reset(e,t);const a=[BigInt(0)],h=[this._bVecToV3(e),this._bVecToV3(t),[r,n],o,a];if(this._hknp.HP_World_CastRayWithCollector(this.world,this._queryCollector,h),this._hknp.HP_QueryCollector_GetNumHits(this._queryCollector)[1]>0){const[,e]=this._hknp.HP_QueryCollector_GetCastRayResult(this._queryCollector,0)[1];this._populateHitData(e,i),i.calculateHitDistance()}}pointProximity(e,t){const i=e?.collisionFilter?.membership??-1,s=e?.collisionFilter?.collideWith??-1;t.reset();const r=e.ignoreBody?[BigInt(e.ignoreBody._pluginData.hpBodyId[0])]:[BigInt(0)],n=[this._bVecToV3(e.position),e.maxDistance,[i,s],e.shouldHitTriggers,r];if(this._hknp.HP_World_PointProximityWithCollector(this.world,this._queryCollector,n),this._hknp.HP_QueryCollector_GetNumHits(this._queryCollector)[1]>0){const[e,i]=this._hknp.HP_QueryCollector_GetPointProximityResult(this._queryCollector,0)[1];this._populateHitData(i,t),t.setHitDistance(e)}}shapeProximity(e,t,i){t.reset(),i.reset();const s=e.shape._pluginData,r=e.ignoreBody?[BigInt(e.ignoreBody._pluginData.hpBodyId[0])]:[BigInt(0)],n=[s,this._bVecToV3(e.position),this._bQuatToV4(e.rotation),e.maxDistance,e.shouldHitTriggers,r];if(this._hknp.HP_World_ShapeProximityWithCollector(this.world,this._queryCollector,n),this._hknp.HP_QueryCollector_GetNumHits(this._queryCollector)[1]>0){const[e,s,r]=this._hknp.HP_QueryCollector_GetShapeProximityResult(this._queryCollector,0)[1];this._populateHitData(s,t),this._populateHitData(r,i),t.setHitDistance(e),i.setHitDistance(e)}}shapeCast(e,t,i){t.reset(),i.reset();const s=e.shape._pluginData,r=e.ignoreBody?[BigInt(e.ignoreBody._pluginData.hpBodyId[0])]:[BigInt(0)],n=[s,this._bQuatToV4(e.rotation),this._bVecToV3(e.startPosition),this._bVecToV3(e.endPosition),e.shouldHitTriggers,r];if(this._hknp.HP_World_ShapeCastWithCollector(this.world,this._queryCollector,n),this._hknp.HP_QueryCollector_GetNumHits(this._queryCollector)[1]>0){const[e,s,r]=this._hknp.HP_QueryCollector_GetShapeCastResult(this._queryCollector,0)[1];this._populateHitData(s,t),this._populateHitData(r,i),t.setHitFraction(e),i.setHitFraction(e)}}getCollisionObservable(e){const t=e._pluginData.hpBodyId[0];let i=this._bodyCollisionObservable.get(t);return i||(i=new Zi.cP,this._bodyCollisionObservable.set(t,i)),i}getCollisionEndedObservable(e){const t=e._pluginData.hpBodyId[0];let i=this._bodyCollisionEndedObservable.get(t);return i||(i=new Zi.cP,this._bodyCollisionEndedObservable.set(t,i)),i}setCollisionCallbackEnabled(e,t){const i=this._hknp.EventType.COLLISION_STARTED.value|this._hknp.EventType.COLLISION_CONTINUED.value|this._hknp.EventType.COLLISION_FINISHED.value;e._pluginDataInstances&&e._pluginDataInstances.length?e._pluginDataInstances.forEach((e=>{this._hknp.HP_Body_SetEventMask(e.hpBodyId,t?i:0)})):e._pluginData&&this._hknp.HP_Body_SetEventMask(e._pluginData.hpBodyId,t?i:0)}setCollisionEndedCallbackEnabled(e,t){const i=this._getPluginReference(e);let s=this._hknp.HP_Body_GetEventMask(i.hpBodyId)[1];s=t?s|this._hknp.EventType.COLLISION_FINISHED.value:s&~this._hknp.EventType.COLLISION_FINISHED.value,e._pluginDataInstances&&e._pluginDataInstances.length?e._pluginDataInstances.forEach((e=>{this._hknp.HP_Body_SetEventMask(e.hpBodyId,s)})):e._pluginData&&this._hknp.HP_Body_SetEventMask(e._pluginData.hpBodyId,s)}_notifyTriggers(){let e=this._hknp.HP_World_GetTriggerEvents(this.world)[1];const t=new aA;for(;e;){aA.readToRef(this._hknp.HEAPU8.buffer,e,t);const i=this._bodies.get(t.bodyIdA),s=this._bodies.get(t.bodyIdB);if(i&&s){const e={collider:i.body,colliderIndex:i.index,collidedAgainst:s.body,collidedAgainstIndex:s.index,type:this._nativeTriggerCollisionValueToCollisionType(t.type)};this.onTriggerCollisionObservable.notifyObservers(e)}e=this._hknp.HP_World_GetNextTriggerEvent(this.world,e)}}_notifyCollisions(){let e=this._hknp.HP_World_GetCollisionEvents(this.world)[1];const t=new oA,i=Number(this.world);for(;e;){oA.readToRef(this._hknp.HEAPU8.buffer,e,t);const s=this._bodies.get(t.contactOnA.bodyId),r=this._bodies.get(t.contactOnB.bodyId);if(s&&r){const e={collider:s.body,colliderIndex:s.index,collidedAgainst:r.body,collidedAgainstIndex:r.index,type:this._nativeCollisionValueToCollisionType(t.type)};if("COLLISION_FINISHED"===e.type)this.onCollisionEndedObservable.notifyObservers(e);else{t.contactOnB.position.subtractToRef(t.contactOnA.position,this._tmpVec3[0]);const i=gt.Pq.Dot(this._tmpVec3[0],t.contactOnA.normal);e.point=t.contactOnA.position,e.distance=i,e.impulse=t.impulseApplied,e.normal=t.contactOnA.normal,this.onCollisionObservable.notifyObservers(e)}if(this._bodyCollisionObservable.size&&"COLLISION_FINISHED"!==e.type){const i=this._bodyCollisionObservable.get(t.contactOnA.bodyId),n=this._bodyCollisionObservable.get(t.contactOnB.bodyId);t.contactOnA.position.subtractToRef(t.contactOnB.position,this._tmpVec3[0]);const o=gt.Pq.Dot(this._tmpVec3[0],t.contactOnB.normal);if(i&&i.notifyObservers(e),n){const e={collider:r.body,colliderIndex:r.index,collidedAgainst:s.body,collidedAgainstIndex:s.index,point:t.contactOnB.position,distance:o,impulse:t.impulseApplied,normal:t.contactOnB.normal,type:this._nativeCollisionValueToCollisionType(t.type)};n.notifyObservers(e)}}else if(this._bodyCollisionEndedObservable.size){const i=this._bodyCollisionEndedObservable.get(t.contactOnA.bodyId),n=this._bodyCollisionEndedObservable.get(t.contactOnB.bodyId);t.contactOnA.position.subtractToRef(t.contactOnB.position,this._tmpVec3[0]);const o=gt.Pq.Dot(this._tmpVec3[0],t.contactOnB.normal);if(i&&i.notifyObservers(e),n){const e={collider:r.body,colliderIndex:r.index,collidedAgainst:s.body,collidedAgainstIndex:s.index,point:t.contactOnB.position,distance:o,impulse:t.impulseApplied,normal:t.contactOnB.normal,type:this._nativeCollisionValueToCollisionType(t.type)};n.notifyObservers(e)}}}e=this._hknp.HP_World_GetNextCollisionEvent(i,e)}}get numBodies(){return this._hknp.HP_World_GetNumBodies(this.world)[1]}dispose(){this._queryCollector&&(this._hknp.HP_QueryCollector_Release(this._queryCollector),this._queryCollector=void 0),this.world&&(this._hknp.HP_World_Release(this.world),this.world=void 0)}_v3ToBvecRef(e,t){t.set(e[0],e[1],e[2])}_bVecToV3(e){return[e._x,e._y,e._z]}_bQuatToV4(e){return[e._x,e._y,e._z,e._w]}_constraintMotorTypeToNative(e){switch(e){case 2:return this._hknp.ConstraintMotorType.POSITION;case 1:return this._hknp.ConstraintMotorType.VELOCITY}return this._hknp.ConstraintMotorType.NONE}_nativeToMotorType(e){switch(e){case this._hknp.ConstraintMotorType.POSITION:return 2;case this._hknp.ConstraintMotorType.VELOCITY:return 1}return 0}_materialCombineToNative(e){switch(e){case 0:return this._hknp.MaterialCombine.GEOMETRIC_MEAN;case 1:return this._hknp.MaterialCombine.MINIMUM;case 2:return this._hknp.MaterialCombine.MAXIMUM;case 3:return this._hknp.MaterialCombine.ARITHMETIC_MEAN;case 4:return this._hknp.MaterialCombine.MULTIPLY}}_nativeToMaterialCombine(e){switch(e){case this._hknp.MaterialCombine.GEOMETRIC_MEAN:return 0;case this._hknp.MaterialCombine.MINIMUM:return 1;case this._hknp.MaterialCombine.MAXIMUM:return 2;case this._hknp.MaterialCombine.ARITHMETIC_MEAN:return 3;case this._hknp.MaterialCombine.MULTIPLY:return 4;default:return}}_constraintAxisToNative(e){switch(e){case 0:return this._hknp.ConstraintAxis.LINEAR_X;case 1:return this._hknp.ConstraintAxis.LINEAR_Y;case 2:return this._hknp.ConstraintAxis.LINEAR_Z;case 3:return this._hknp.ConstraintAxis.ANGULAR_X;case 4:return this._hknp.ConstraintAxis.ANGULAR_Y;case 5:return this._hknp.ConstraintAxis.ANGULAR_Z;case 6:return this._hknp.ConstraintAxis.LINEAR_DISTANCE}}_nativeToLimitMode(e){switch(e){case this._hknp.ConstraintAxisLimitMode.FREE:return 0;case this._hknp.ConstraintAxisLimitMode.LIMITED:return 1;case this._hknp.ConstraintAxisLimitMode.LOCKED:return 2}return 0}_limitModeToNative(e){switch(e){case 0:return this._hknp.ConstraintAxisLimitMode.FREE;case 1:return this._hknp.ConstraintAxisLimitMode.LIMITED;case 2:return this._hknp.ConstraintAxisLimitMode.LOCKED}}_nativeCollisionValueToCollisionType(e){switch(e){case this._hknp.EventType.COLLISION_STARTED.value:return"COLLISION_STARTED";case this._hknp.EventType.COLLISION_FINISHED.value:return"COLLISION_FINISHED";case this._hknp.EventType.COLLISION_CONTINUED.value:return"COLLISION_CONTINUED"}return"COLLISION_STARTED"}_nativeTriggerCollisionValueToCollisionType(e){switch(e){case 8:return"TRIGGER_ENTERED";case 16:return"TRIGGER_EXITED"}return"TRIGGER_ENTERED"}}class lA{constructor(e,t,i){if(this._pluginData=void 0,!i)throw new Error("Missing scene parameter for constraint constructor.");const s=i.getPhysicsEngine();if(!s)throw new Error("No Physics Engine available.");if(2!=s.getPluginVersion())throw new Error("Plugin version is incorrect. Expected version 2.");const r=s.getPhysicsPlugin();if(!r)throw new Error("No Physics Plugin available.");this._physicsPlugin=r,this._options=t,this._type=e}get type(){return this._type}get options(){return this._options}set isEnabled(e){this._physicsPlugin.setEnabled(this,e)}get isEnabled(){return this._physicsPlugin.getEnabled(this)}set isCollisionsEnabled(e){this._physicsPlugin.setCollisionsEnabled(this,e)}get isCollisionsEnabled(){return this._physicsPlugin.getCollisionsEnabled(this)}getBodiesUsingConstraint(){return this._physicsPlugin.getBodiesUsingConstraint(this)}dispose(){this._physicsPlugin.disposeConstraint(this)}}!function(e){e[e.GEOMETRIC_MEAN=0]="GEOMETRIC_MEAN",e[e.MINIMUM=1]="MINIMUM",e[e.MAXIMUM=2]="MAXIMUM",e[e.ARITHMETIC_MEAN=3]="ARITHMETIC_MEAN",e[e.MULTIPLY=4]="MULTIPLY"}(Jx||(Jx={}));class cA{constructor(){this._sessions=new Set}tick(e){[...this._sessions].forEach((t=>t.tick(e)))}beginRecording(e){const t=new _A(e,this.onSessionEnd.bind(this));return this._sessions.add(t),t}onSessionEnd(e){this._sessions.delete(e)}}class uA{constructor(e,t,i){this.name=e,this.stateGetter=t,this.frameIntervalS=i}}class dA{constructor(e){this._points=[],this._currentTimeS=0,this._settings=e;const t=this.getState();t&&this._points.push(new Yc(0,t))}tick(e){if(this._currentTimeS+=e,0==this._points.length)return;const t=this._points[this._points.length-1];if(this._currentTimeS-t.timeS>=this._settings.frameIntervalS){const e=this.getState();e&&this._points.push(new Yc(this._currentTimeS,e))}}end(){const e=this._points[this._points.length-1];if(this._currentTimeS-e.timeS>0){const e=this.getState();e&&this._points.push(new Yc(this._currentTimeS,e))}return new qc(this._settings.name,this._points)}getState(){return this._settings.stateGetter()}}class _A{constructor(e,t){this._markers=[],this._currentTimeS=0,this._currentMarkers=new Set,this._sessionEndDelegate=t,this._tracksRecordings=[],this._tracksRecordings=e.map((e=>new dA(e)))}addMarker(e){this._currentMarkers.add(e)}tick(e){this.saveCurrentMarkers(),this._currentTimeS+=e,this._tracksRecordings.forEach((t=>{t.tick(e)}))}end(){this.saveCurrentMarkers();const e=this._tracksRecordings.map((e=>e.end())),t=new Qc(e,this._markers.length>0?this._markers:void 0);return this._sessionEndDelegate(this),t}saveCurrentMarkers(){this._currentMarkers.size>0&&(this._markers.push(new Kc(this._currentTimeS,Array.from(this._currentMarkers))),this.resetCurrentMarkers())}resetCurrentMarkers(){this._currentMarkers.clear()}}const pA={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]};function gA(e,t,i,s=!1){const r=String(t),n=(e,t)=>`[${t[0]}m${e}[${t[1]}m`,o=(e,t)=>null!=t&&"string"==typeof t?n(e,pA[t]):null!=t&&Array.isArray(t)?t.reduce(((e,t)=>o(e,t)),e):null!=t&&null!=t[e.trim()]?o(e,t[e.trim()]):null!=t&&null!=t["*"]?o(e,t["*"]):e;return r.replace(/{{(.+?)}}/g,((t,r)=>{const a=null!=i[r]?String(i[r]):s?"":t;return e.stylePrettyLogs?o(a,e?.prettyLogStyles?.[r]??null)+n("",pA.reset):a}))}function fA(e,t=2,i=0){return null!=e&&isNaN(e)?"":(e=null!=e?e+i:e,2===t?null==e?"--":e<10?"0"+e:e.toString():null==e?"---":e<10?"00"+e:e<100?"0"+e:e.toString())}function mA(e){const t=new Set;return JSON.stringify(e,((e,i)=>{if("object"==typeof i&&null!==i){if(t.has(i))return"[Circular]";t.add(i)}return"bigint"==typeof i?`${i}`:i}))}function bA(e,t){const i={seen:[],stylize:TA};return null!=t&&FA(i,t),vA(i.showHidden)&&(i.showHidden=!1),vA(i.depth)&&(i.depth=2),vA(i.colors)&&(i.colors=!0),vA(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=yA),OA(i,e,i.depth)}function vA(e){return void 0===e}function TA(e){return e}function yA(e,t){const i=bA.styles[t];return null!=i&&null!=bA?.colors?.[i]?.[0]&&null!=bA?.colors?.[i]?.[1]?"["+bA.colors[i][0]+"m"+e+"["+bA.colors[i][1]+"m":e}function xA(e){return"function"==typeof e}function AA(e){return"string"==typeof e}function CA(e){return null===e}function SA(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function EA(e){return RA(e)&&"[object RegExp]"===MA(e)}function RA(e){return"object"==typeof e&&null!==e}function PA(e){return RA(e)&&("[object Error]"===MA(e)||e instanceof Error)}function IA(e){return RA(e)&&"[object Date]"===MA(e)}function MA(e){return Object.prototype.toString.call(e)}function wA(e){return"["+Error.prototype.toString.call(e)+"]"}function OA(e,t,i=0){if(e.customInspect&&null!=t&&xA(t)&&t?.inspect!==bA&&(!t?.constructor||t?.constructor.prototype!==t)){if("function"!=typeof t.inspect&&null!=t.toString)return t.toString();let s=t?.inspect(i,e);return AA(s)||(s=OA(e,s,i)),s}const s=DA(e,t);if(s)return s;let r=Object.keys(t);const n=function(e){const t={};return e.forEach((e=>{t[e]=!0})),t}(r);try{e.showHidden&&Object.getOwnPropertyNames&&(r=Object.getOwnPropertyNames(t))}catch(e){}if(PA(t)&&(r.indexOf("message")>=0||r.indexOf("description")>=0))return wA(t);if(0===r.length){if(!xA(e.stylize))return t;if(xA(t)){const i=t.name?": "+t.name:"";return e.stylize("[Function"+i+"]","special")}if(EA(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(IA(t))return e.stylize(Date.prototype.toISOString.call(t),"date");if(PA(t))return wA(t)}let o,a="",h=!1,l=["{\n","\n}"];return Array.isArray(t)&&(h=!0,l=["[\n","\n]"]),xA(t)&&(a=" [Function"+(t.name?": "+t.name:"")+"]"),EA(t)&&(a=" "+RegExp.prototype.toString.call(t)),IA(t)&&(a=" "+Date.prototype.toUTCString.call(t)),PA(t)&&(a=" "+wA(t)),0!==r.length||h&&0!=t.length?i<0?EA(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),o=h?function(e,t,i,s,r){const n=[];for(let r=0,o=t.length;r<o;++r)SA(t,String(r))?n.push(BA(e,t,i,s,String(r),!0)):n.push("");return r.forEach((r=>{r.match(/^\d+$/)||n.push(BA(e,t,i,s,r,!0))})),n}(e,t,i,n,r):r.map((s=>BA(e,t,i,n,s,h))),e.seen.pop(),function(e,t,i){return i[0]+(""===t?"":t+"\n")+"  "+e.join(",\n  ")+" "+i[1]}(o,a,l)):l[0]+a+l[1]}function BA(e,t,i,s,r,n){let o,a,h={value:void 0};try{h.value=t[r]}catch(e){}try{Object.getOwnPropertyDescriptor&&(h=Object.getOwnPropertyDescriptor(t,r)||h)}catch(e){}if(h.get?a=h.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):h.set&&(a=e.stylize("[Setter]","special")),SA(s,r)||(o="["+r+"]"),a||(e.seen.indexOf(h.value)<0?(a=CA(i)?OA(e,h.value,void 0):OA(e,h.value,i-1),a.indexOf("\n")>-1&&(a=n?a.split("\n").map((e=>"  "+e)).join("\n").substr(2):"\n"+a.split("\n").map((e=>"   "+e)).join("\n"))):a=e.stylize("[Circular]","special")),vA(o)){if(n&&r.match(/^\d+$/))return a;o=JSON.stringify(""+r),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,"\\'").replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function DA(e,t){if(vA(t))return e.stylize("undefined","undefined");if(AA(t)){const i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\\'")+"'";return e.stylize(i,"string")}return"number"==typeof t?e.stylize(""+t,"number"):"boolean"==typeof t?e.stylize(""+t,"boolean"):CA(t)?e.stylize("null","null"):void 0}function FA(e,t){const i={...e};if(!t||!RA(t))return e;const s={...t},r=Object.keys(t);let n=r.length;for(;n--;)i[r[n]]=s[r[n]];return i}bA.colors=pA,bA.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};const LA={getCallerStackFrame:UA,getErrorTrace:VA,getMeta:function(e,t,i,s,r,n){return Object.assign({},NA,{name:r,parentNames:n,date:new Date,logLevelId:e,logLevelName:t,path:s?void 0:UA(i)})},transportJSON:function(e){console.log(mA(e))},transportFormatted:function(e,t,i,s){const r=(i.length>0&&t.length>0?"\n":"")+i.join("\n");s.prettyInspectOptions.colors=s.stylePrettyLogs,console.log(e+function(e,...t){const i={seen:[],stylize:TA};null!=e&&FA(i,e);const s=t[0];let r=0,n="",o="";if("string"==typeof s){if(1===t.length)return s;let a,h=0;for(let o=0;o<s.length-1;o++)if(37===s.charCodeAt(o)){const l=s.charCodeAt(++o);if(r+1!==t.length){switch(l){case 115:{const s=t[++r];a="number"==typeof s||"bigint"==typeof s?DA(i,s):"object"!=typeof s||null===s?String(s):bA(s,{...e,compact:3,colors:!1,depth:0});break}case 106:a=mA(t[++r]);break;case 100:{const e=t[++r];a="bigint"==typeof e?DA(i,e):"symbol"==typeof e?"NaN":DA(i,e);break}case 79:a=bA(t[++r],e);break;case 111:a=bA(t[++r],{...e,showHidden:!0,showProxy:!0,depth:4});break;case 105:{const e=t[++r];a="bigint"==typeof e?DA(i,e):"symbol"==typeof e?"NaN":DA(i,parseInt(a));break}case 102:{const e=t[++r];a="symbol"==typeof e?"NaN":DA(i,parseInt(e));break}case 99:r+=1,a="";break;case 37:n+=s.slice(h,o),h=o+1;continue;default:continue}h!==o-1&&(n+=s.slice(h,o-1)),n+=a,h=o+1}else 37===l&&(n+=s.slice(h,o),h=o+1)}0!==h&&(r++,o=" ",h<s.length&&(n+=s.slice(h)))}for(;r<t.length;){const i=t[r];n+=o,n+="string"!=typeof i?bA(i,e):i,o=" ",r++}return n}(s.prettyInspectOptions,...t)+r)},isBuffer:function(e){return!1},isError:zA,prettyFormatLogObj:function(e,t){return e.reduce(((e,i)=>(zA(i)?e.errors.push(HA(i,t)):e.args.push(i),e)),{args:[],errors:[]})},prettyFormatErrorObj:HA},NA={runtime:[typeof window,typeof document].includes("undefined")?"Generic":"Browser",browser:globalThis?.navigator?.userAgent},kA=/(?:(?:file|https?|global code|[^@]+)@)?(?:file:)?((?:\/[^:/]+){2,})(?::(\d+))?(?::(\d+))?/;function UA(e,t=Error()){return GA(t?.stack?.split("\n")?.filter((e=>!e.includes("Error: ")))?.[e])}function VA(e){return(e?.stack?.split("\n")??[])?.filter((e=>!e.includes("Error: ")))?.reduce(((e,t)=>(e.push(GA(t)),e)),[])}function GA(e){const t=globalThis?.location?.origin,i={fullFilePath:void 0,fileName:void 0,fileNameWithLine:void 0,fileColumn:void 0,fileLine:void 0,filePath:void 0,filePathWithLine:void 0,method:void 0};if(null!=e){const s=e.match(kA);if(s){i.filePath=s[1].replace(/\?.*$/,""),i.fullFilePath=`${t}${i.filePath}`;const e=i.filePath.split("/");i.fileName=e[e.length-1],i.fileLine=s[2],i.fileColumn=s[3],i.filePathWithLine=`${i.filePath}:${i.fileLine}`,i.fileNameWithLine=`${i.fileName}:${i.fileLine}`}}return i}function zA(e){return e instanceof Error}function HA(e,t){const i=VA(e).map((e=>gA(t,t.prettyErrorStackTemplate,{...e},!0))),s={errorName:` ${e.name} `,errorMessage:Object.getOwnPropertyNames(e).reduce(((t,i)=>("stack"!==i&&t.push(e[i]),t)),[]).join(", "),errorStack:i.join("\n")};return gA(t,t.prettyErrorTemplate,s)}class WA{constructor(e,t,i=4){this.logObj=t,this.stackDepthLevel=i,this.runtime=LA,this.settings={type:e?.type??"pretty",name:e?.name,parentNames:e?.parentNames,minLevel:e?.minLevel??0,argumentsArrayName:e?.argumentsArrayName,hideLogPositionForProduction:e?.hideLogPositionForProduction??!1,prettyLogTemplate:e?.prettyLogTemplate??"{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}\t{{logLevelName}}\t{{filePathWithLine}}{{nameWithDelimiterPrefix}}\t",prettyErrorTemplate:e?.prettyErrorTemplate??"\n{{errorName}} {{errorMessage}}\nerror stack:\n{{errorStack}}",prettyErrorStackTemplate:e?.prettyErrorStackTemplate??"   {{fileName}}\t{{method}}\n\t{{filePathWithLine}}",prettyErrorParentNamesSeparator:e?.prettyErrorParentNamesSeparator??":",prettyErrorLoggerNameDelimiter:e?.prettyErrorLoggerNameDelimiter??"\t",stylePrettyLogs:e?.stylePrettyLogs??!0,prettyLogTimeZone:e?.prettyLogTimeZone??"UTC",prettyLogStyles:e?.prettyLogStyles??{logLevelName:{"*":["bold","black","bgWhiteBright","dim"],SILLY:["bold","white"],TRACE:["bold","whiteBright"],DEBUG:["bold","green"],INFO:["bold","blue"],WARN:["bold","yellow"],ERROR:["bold","red"],FATAL:["bold","redBright"]},dateIsoStr:"white",filePathWithLine:"white",name:["white","bold"],nameWithDelimiterPrefix:["white","bold"],nameWithDelimiterSuffix:["white","bold"],errorName:["bold","bgRedBright","whiteBright"],fileName:["yellow"],fileNameWithLine:"white"},prettyInspectOptions:e?.prettyInspectOptions??{colors:!0,compact:!1,depth:1/0},metaProperty:e?.metaProperty??"_meta",maskPlaceholder:e?.maskPlaceholder??"[***]",maskValuesOfKeys:e?.maskValuesOfKeys??["password"],maskValuesOfKeysCaseInsensitive:e?.maskValuesOfKeysCaseInsensitive??!1,maskValuesRegEx:e?.maskValuesRegEx,prefix:[...e?.prefix??[]],attachedTransports:[...e?.attachedTransports??[]],overwrite:{mask:e?.overwrite?.mask,toLogObj:e?.overwrite?.toLogObj,addMeta:e?.overwrite?.addMeta,addPlaceholders:e?.overwrite?.addPlaceholders,formatMeta:e?.overwrite?.formatMeta,formatLogObj:e?.overwrite?.formatLogObj,transportFormatted:e?.overwrite?.transportFormatted,transportJSON:e?.overwrite?.transportJSON}}}log(e,t,...i){if(e<this.settings.minLevel)return;const s=[...this.settings.prefix,...i],r=null!=this.settings.overwrite?.mask?this.settings.overwrite?.mask(s):null!=this.settings.maskValuesOfKeys&&this.settings.maskValuesOfKeys.length>0?this._mask(s):s,n=null!=this.logObj?this._recursiveCloneAndExecuteFunctions(this.logObj):void 0,o=null!=this.settings.overwrite?.toLogObj?this.settings.overwrite?.toLogObj(r,n):this._toLogObj(r,n),a=null!=this.settings.overwrite?.addMeta?this.settings.overwrite?.addMeta(o,e,t):this._addMetaToLogObj(o,e,t);let h,l;return null!=this.settings.overwrite?.formatMeta&&(h=this.settings.overwrite?.formatMeta(a?.[this.settings.metaProperty])),null!=this.settings.overwrite?.formatLogObj&&(l=this.settings.overwrite?.formatLogObj(r,this.settings)),"pretty"===this.settings.type&&(h=h??this._prettyFormatLogObjMeta(a?.[this.settings.metaProperty]),l=l??this.runtime.prettyFormatLogObj(r,this.settings)),null!=h&&null!=l?null!=this.settings.overwrite?.transportFormatted?this.settings.overwrite?.transportFormatted(h,l.args,l.errors,this.settings):this.runtime.transportFormatted(h,l.args,l.errors,this.settings):null!=this.settings.overwrite?.transportJSON?this.settings.overwrite?.transportJSON(a):"hidden"!==this.settings.type&&this.runtime.transportJSON(a),null!=this.settings.attachedTransports&&this.settings.attachedTransports.length>0&&this.settings.attachedTransports.forEach((e=>{e(a)})),a}attachTransport(e){this.settings.attachedTransports.push(e)}getSubLogger(e,t){const i={...this.settings,...e,parentNames:null!=this.settings?.parentNames&&null!=this.settings?.name?[...this.settings.parentNames,this.settings.name]:null!=this.settings?.name?[this.settings.name]:void 0,prefix:[...this.settings.prefix,...e?.prefix??[]]};return new this.constructor(i,t??this.logObj,this.stackDepthLevel)}_mask(e){const t=!0!==this.settings.maskValuesOfKeysCaseInsensitive?this.settings.maskValuesOfKeys:this.settings.maskValuesOfKeys.map((e=>e.toLowerCase()));return e?.map((e=>this._recursiveCloneAndMaskValuesOfKeys(e,t)))}_recursiveCloneAndMaskValuesOfKeys(e,t,i=[]){if(i.includes(e))return{...e};if("object"==typeof e&&null!==e&&i.push(e),this.runtime.isError(e)||this.runtime.isBuffer(e))return e;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(Array.isArray(e))return e.map((e=>this._recursiveCloneAndMaskValuesOfKeys(e,t,i)));if(e instanceof Date)return new Date(e.getTime());if(e instanceof URL)return{href:(s=e).href,protocol:s.protocol,username:s.username,password:s.password,host:s.host,hostname:s.hostname,port:s.port,pathname:s.pathname,search:s.search,searchParams:[...s.searchParams].map((([e,t])=>({key:e,value:t}))),hash:s.hash,origin:s.origin};var s;if(null!==e&&"object"==typeof e){const s=this.runtime.isError(e)?this._cloneError(e):Object.create(Object.getPrototypeOf(e));return Object.getOwnPropertyNames(e).reduce(((s,r)=>(s[r]=t.includes(!0!==this.settings?.maskValuesOfKeysCaseInsensitive?r:r.toLowerCase())?this.settings.maskPlaceholder:(()=>{try{return this._recursiveCloneAndMaskValuesOfKeys(e[r],t,i)}catch(e){return null}})(),s)),s)}if("string"==typeof e){let t=e;for(const e of this.settings?.maskValuesRegEx||[])t=t.replace(e,this.settings?.maskPlaceholder||"");return t}return e}_recursiveCloneAndExecuteFunctions(e,t=[]){return this.isObjectOrArray(e)&&t.includes(e)?this.shallowCopy(e):(this.isObjectOrArray(e)&&t.push(e),Array.isArray(e)?e.map((e=>this._recursiveCloneAndExecuteFunctions(e,t))):e instanceof Date?new Date(e.getTime()):this.isObject(e)?Object.getOwnPropertyNames(e).reduce(((i,s)=>{const r=Object.getOwnPropertyDescriptor(e,s);if(r){Object.defineProperty(i,s,r);const n=e[s];i[s]="function"==typeof n?n():this._recursiveCloneAndExecuteFunctions(n,t)}return i}),Object.create(Object.getPrototypeOf(e))):e)}isObjectOrArray(e){return"object"==typeof e&&null!==e}isObject(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e}shallowCopy(e){return Array.isArray(e)?[...e]:{...e}}_toLogObj(e,t={}){return e=e?.map((e=>this.runtime.isError(e)?this._toErrorObject(e):e)),null==this.settings.argumentsArrayName?1!==e.length||Array.isArray(e[0])||!0===this.runtime.isBuffer(e[0])||e[0]instanceof Date?{...t,...e}:"object"==typeof e[0]&&null!=e[0]?{...e[0],...t}:{0:e[0],...t}:{...t,[this.settings.argumentsArrayName]:e}}_cloneError(e){const t=new e.constructor;return Object.getOwnPropertyNames(e).forEach((i=>{t[i]=e[i]})),t}_toErrorObject(e){return{nativeError:e,name:e.name??"Error",message:e.message,stack:this.runtime.getErrorTrace(e)}}_addMetaToLogObj(e,t,i){return{...e,[this.settings.metaProperty]:this.runtime.getMeta(t,i,this.stackDepthLevel,this.settings.hideLogPositionForProduction,this.settings.name,this.settings.parentNames)}}_prettyFormatLogObjMeta(e){if(null==e)return"";let t=this.settings.prettyLogTemplate;const i={};t.includes("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}")?t=t.replace("{{yyyy}}.{{mm}}.{{dd}} {{hh}}:{{MM}}:{{ss}}:{{ms}}","{{dateIsoStr}}"):"UTC"===this.settings.prettyLogTimeZone?(i.yyyy=e?.date?.getUTCFullYear()??"----",i.mm=fA(e?.date?.getUTCMonth(),2,1),i.dd=fA(e?.date?.getUTCDate(),2),i.hh=fA(e?.date?.getUTCHours(),2),i.MM=fA(e?.date?.getUTCMinutes(),2),i.ss=fA(e?.date?.getUTCSeconds(),2),i.ms=fA(e?.date?.getUTCMilliseconds(),3)):(i.yyyy=e?.date?.getFullYear()??"----",i.mm=fA(e?.date?.getMonth(),2,1),i.dd=fA(e?.date?.getDate(),2),i.hh=fA(e?.date?.getHours(),2),i.MM=fA(e?.date?.getMinutes(),2),i.ss=fA(e?.date?.getSeconds(),2),i.ms=fA(e?.date?.getMilliseconds(),3));const s="UTC"===this.settings.prettyLogTimeZone?e?.date:new Date(e?.date?.getTime()-6e4*e?.date?.getTimezoneOffset());i.rawIsoStr=s?.toISOString(),i.dateIsoStr=s?.toISOString().replace("T"," ").replace("Z",""),i.logLevelName=e?.logLevelName,i.fileNameWithLine=e?.path?.fileNameWithLine??"",i.filePathWithLine=e?.path?.filePathWithLine??"",i.fullFilePath=e?.path?.fullFilePath??"";let r=this.settings.parentNames?.join(this.settings.prettyErrorParentNamesSeparator);return r=null!=r&&null!=e?.name?r+this.settings.prettyErrorParentNamesSeparator:void 0,i.name=null!=e?.name||null!=r?(r??"")+e?.name??"":"",i.nameWithDelimiterPrefix=i.name.length>0?this.settings.prettyErrorLoggerNameDelimiter+i.name:"",i.nameWithDelimiterSuffix=i.name.length>0?i.name+this.settings.prettyErrorLoggerNameDelimiter:"",null!=this.settings.overwrite?.addPlaceholders&&this.settings.overwrite?.addPlaceholders(e,i),gA(this.settings,t,i)}}class XA extends WA{constructor(e,t){const i="undefined"!=typeof window&&"undefined"!=typeof document,s=!!i&&void 0!==window.chrome&&void 0!==window.CSS&&window.CSS.supports("color","green"),r=!!i&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent);(e=e||{}).stylePrettyLogs=!(e.stylePrettyLogs&&i&&!s)&&e.stylePrettyLogs,super(e,t,r?4:5)}log(e,t,...i){return super.log(e,t,...i)}silly(...e){return super.log(0,"SILLY",...e)}trace(...e){return super.log(1,"TRACE",...e)}debug(...e){return super.log(2,"DEBUG",...e)}info(...e){return super.log(3,"INFO",...e)}warn(...e){return super.log(4,"WARN",...e)}error(...e){return super.log(5,"ERROR",...e)}fatal(...e){return super.log(6,"FATAL",...e)}getSubLogger(e,t){return super.getSubLogger(e,t)}}class qA{getLogger(e){const t=new XA({...this._defaultSettings,name:e});return{trace:t.trace.bind(t),info:t.info.bind(t),debug:t.debug.bind(t),warn:t.warn.bind(t),error:t.error.bind(t),fatal:t.fatal.bind(t)}}constructor(e){this._defaultSettings=e}}class QA{static async build(t,i,s){Nc.ImportAndPatch({isMobile:!1}),Xe();const r=new qA,n=t.ownerDocument.createElement("canvas");t.appendChild(n),n.style.width="100%",n.style.height="100%";const o=new Me.N(n,!0,void 0,!0),a=new Ie.Z(o);a.useRightHandedSystem=!0;const h=Ms.CreateFullscreenUI("UI"),l=new cA,c=new eu(!1),u=new Uc(c),d=new jA(vt.BallStopDetectionTimeS),_=new Ti,p=new Qt;p.register(l),p.register({tick(e){u.tick(e)}}),p.register(d),a.onAfterRenderObservable.add((e=>{const t=e.deltaTime/1e3;p.tick(t)})),Jt.init(p);const g=new hu(i,a),f=new au(i,{gzip:["gz","gzip"],json:["json"]},_),m=new _u(i),b=new ru({gltf:g,ballAnimations:f,audio:m}),v=b.loadGLTF(Oe.MainScene),T=b.loadBallAnimations(Le.BallAnimations),y=(async()=>{let e;console.log("Loading physics");const t=await tA()();return e=new hA(!0,t),console.log("Physics loaded"),e})();await Promise.all([v,T,y]);const x=await T,A=new gt.Pq(0,-9.8,0),C=await y;a.enablePhysics(A,C),this.createDefaultCamera(a),o.runRenderLoop((()=>{a.render()}));const S=await v,E=S.transformNodes.find((e=>e.name===QA.TN_Spinner))??(()=>{throw new Error(`Could not find '${QA.TN_Spinner}' node`)})(),R=S.transformNodes.find((e=>e.name===QA.TN_Emblem))??(()=>{throw new Error(`Could not find '${QA.TN_Spinner}' node`)})(),P=new Yx.Z("Light",new gt.Pq(2,-5,1),a);P.position=new gt.Pq(0,10,0),P.shadowEnabled=!0,P.shadowMaxZ=100,P.intensity=7;const I=new Sa(1024,P);I.setDarkness(.3),I.bias=1e-4,I.usePercentageCloserFiltering=!0;const M=QA.createBallMesh({color:bt.v9.White(),radius:vt.BallRadius},a,I),w=new Zc(a,E,{emblemNode:R,rotationSpeedRadS:-.8},M,_.getZeroBasedSequenceClockwise(e.DoubleZero),r.getLogger("Wheel"));return new QA(o,a,n,S,s,l,u,C,d,_,w,I,x,h)}static createDefaultCamera(e){const t=new fh.S("MainCamera",new gt.Pq(0,5,-10),e);return t.setTarget(gt.Pq.Zero()),t}constructor(t,i,s,r,n,o,a,h,l,c,u,d,_,p){this.BALL_RESTITUTION=.95,this.BALL_LINEAR_DAMPING=.05,this.BALL_ANGULAR_DAMPING=.05,this.BALL_GRAVITY_FACTOR=1,this.BALL_MASS=.02,this.BALL_COLLIDER_RADIUS=.014,this._wheelStaticRestitution=1,this._wheelStaticLinearDamping=0,this._wheelStaticFriction=.5,this._spinnerRestitution=1,this._ballLandedSubject=new X,this._physicsBodies=[],this._physicsConstraints=[],this._bouncesLeft=0,this._physicsShown=!1,this._engine=t,this._scene=i,this._production=n,this._motionRecorder=o,this._motionPlayer=a,this._landingZoneTracker=l,this._numSet=c,this._wheelView=u,this._loadedSpinAnimations=_,this._uiRoot=p;const g=new As("recordingOverlay");g.width=g.height="100%";const f=new cr("recording-Overlay");f.background="#ff000010",g.addControl(f);const m=new lr("recording-label");let b,v;m.fontSize=48,m.fontWeight="bold",m.color="white",m.resizeToFit=!0,m.verticalAlignment=xs.VERTICAL_ALIGNMENT_TOP,m.horizontalAlignment=As.HORIZONTAL_ALIGNMENT_CENTER,g.addControl(m),p.addControl(g),this._recordingOverlay=new ZA(g,f,m),this.hideRecordingOverlay(),r.scene.stopAllAnimations(),r.addAllToScene(),0!=r.cameras.length&&(i.activeCamera=r.cameras[0]),r.lights.forEach((e=>{})),this._physicsViewer=new $x,console.log(`Animations number: ${r.animationGroups.length}`);const T=(e=>{this._ballAnimation=e,console.log(`Updated animation with: '${e.id}'`)}).bind(this),y=document.querySelector("body");let x,A,C;y&&(y.addEventListener("dragenter",(e=>{e.preventDefault()})),y.addEventListener("dragover",(e=>{e.preventDefault()})),y.addEventListener("dragleave",(e=>{e.preventDefault()})),y.addEventListener("drop",(e=>{e.preventDefault();const t=e.dataTransfer?.files;if(t){const e=t[0],i=new FileReader;i.onload=e=>{const t=e.target?.result;if(t)try{const e=su.fromJSON(JSON.parse(t),c);T(e)}catch{}},i.readAsText(e)}}))),r.animationGroups.forEach((e=>{console.log(e.name),"FocusOnField"===e.name?b=e:"FocusOnWheel"===e.name&&(v=e)})),r.transformNodes.forEach((e=>{if(e.name===QA.TN_Spinner)x=e;else if(e.name===QA.TN_WheelStatic){console.log("Initializing wheel static");const t=new Kx(i),s={restitution:this._wheelStaticRestitution,friction:this._wheelStaticFriction,frictionCombine:Jx.MINIMUM};t.material=s,e.getChildMeshes().forEach((r=>{if(r.name.startsWith("Peg_Collider"))return void(r.isVisible=!1);r.receiveShadows=!0,d.addShadowCaster(r);const n=new Qx(r,i);t.addChildFromParent(e,n,r),n.material=s}));const r=new Hx(e,Vx.STATIC,!1,i);r.shape=t,r.disablePreStep=!1,r.setLinearDamping(0),this.registerPhysicsBody(r)}})),r.meshes.forEach((e=>{if(e.receiveShadows=!0,e.name.startsWith("HitZone"))e.isVisible=!1;else if("BallLauchSpot"===e.name)A=e,e.isVisible=!1;else if("BallSpinCenter"===e.name)e.isVisible=!1,C=e;else if(e.name.startsWith("StaticCollider")){const t=new Qx(e,i),s=new Hx(e,Vx.STATIC,!1,i);s.disablePreStep=!1,t.material={friction:1},s.shape=t,this.registerPhysicsBody(s),e.isVisible=!1}})),this._ballLaunchSpot=A??(()=>{throw new Error("Ball Launch spot is not defined")})(),this._ballSpinCenter=C??(()=>{throw new Error("Ball Spin Center is not defined")})(),console.log("Creating rotor body");const S=new Kx(i);if(!x)throw new Error;(this._ballAnimContainer=new Gn.V("BallAnimationContainer",i)).position=x.position;const E=new Hx(x,Vx.ANIMATED,!1,i);E.disablePreStep=!1,new Map;const R=this.generateNumbersHitZones(e.DoubleZero,c,{spinnerNode:x,radius:.268,yPosition:.54,spinnerBody:E,singleZeroAngleDeg:270},{radius:.022},i);x.getChildMeshes().forEach((e=>{if(e.receiveShadows=!0,d.addShadowCaster(e),"WheelCenterPost"===e.name){const t=new Qx(e,i).getBoundingBox(),s=t.extendSizeWorld.y,r=t.extendSizeWorld.x,n=new qx(new gt.Pq(0,-s,0),new gt.Pq(0,s,0),r,i);e.absoluteRotationQuaternion.invert(),S.addChildFromParent(x,n,e)}else if(e.name.startsWith("HZ"));else if(e.name.startsWith(QA.MN_SpinnerPlatform))e.isVisible=!1;else{const t=new Qx(e,i);S.addChildFromParent(x,t,e),t.material={restitution:this._spinnerRestitution,friction:0,restitutionCombine:Jx.MAXIMUM,staticFriction:0}}})),E.disablePreStep=!1,S.material={restitution:this._spinnerRestitution,friction:0,frictionCombine:Jx.MINIMUM},E.shape=S,this.registerPhysicsBody(E),this._wheelSpinner=E,new Gn.V("root",i).addChild(x,!0);const P=new uh("Camera",Math.PI/3,Math.PI/6,1,x.position);P.minZ=.1,P.viewport=new Es.L(0,0,.5,1),P.target=new gt.Pq(.159,.219,.892),P.alpha=7.06,P.beta=.779,P.radius=1.566;const I=new uh("Camera2",Math.PI/3,Math.PI/6,1,x.position);I.minZ=.1,I.viewport=new Es.L(.5,0,.5,1),I.target=P.target,I.alpha=7.1206,I.beta=.242,I.radius=1.566,i.activeCameras=[P,I];const{body:M,mesh:w}=this.createBall({meshRadius:vt.BallRadius,colliderRadius:this.BALL_COLLIDER_RADIUS},i);this._ball=M,this._ballMesh=w,d.addShadowCaster(w),this.registerPhysicsBody(this._ball),h.onTriggerCollisionObservable.add((e=>{let t;if(e.collider===this._ball?(console.log(`World Collision: [ball] collided with [${e.collidedAgainst.transformNode.name}]`),t=e.collidedAgainst):e.collidedAgainst===this._ball&&(console.log(`World Collision: [${e.collider.transformNode.name}] collided with ball`),t=e.collider),t){const i=R.get(t);if(i)if(e.type==Ux.TRIGGER_ENTERED){if(this._landingZoneTracker.numberZoneEnter(i),this._bouncesLeft>0){console.log("Force Bounce"),this._ball.getLinearVelocity();const e=(C?.absolutePosition??(()=>{throw new Z})()).subtract(this._ballMesh.absolutePosition),t=new gt.Pq(.3*e.x,1+.5*Math.random(),.3*e.z);this._ball.applyForce(t,gt.Pq.Zero()),this._bouncesLeft--}}else e.type==Ux.TRIGGER_EXITED&&this._landingZoneTracker.numberZoneExit(i)}}).bind(this))}createBall(e,t){const i=QA.createBallMesh({color:bt.v9.White(),radius:e.meshRadius},t);i.position=new gt.Pq(0,.9,1.17);const s=new Xx(gt.Pq.Zero(),e.colliderRadius,t),r=new Hx(i,Vx.STATIC,!0,t);return s.material={restitution:this.BALL_RESTITUTION,friction:0,frictionCombine:Jx.MINIMUM},r.shape=s,r.setMassProperties({mass:this.BALL_MASS}),r.setLinearDamping(this.BALL_LINEAR_DAMPING),r.setAngularDamping(this.BALL_ANGULAR_DAMPING),r.setGravityFactor(this.BALL_GRAVITY_FACTOR),r.disablePreStep=!1,{body:r,mesh:i}}async start(){this.startInternal()}async startInternal(){let t=()=>{},i=()=>{};if(!this._production){const e=await Promise.resolve().then(o.t.bind(o,7963,23));t=()=>{e.Inspector.Show(this._scene,{enablePopup:!0})},i=()=>{e.Inspector.Hide()}}const s=new KA(this._ball,this._ballMesh,{center:this._ballSpinCenter.position,radius:gt.Pq.Distance(this._ballSpinCenter.position,this._ballLaunchSpot.position)},this._scene);s.hide();const r=1/120;setInterval((()=>{s.tick(r)}),1e3*r);let n=!1;document.addEventListener("keydown",(r=>{console.log(`${r.key}`),"i"===r.key?(n?i():t(),n=!n):"b"===r.key?(async()=>{this._ballMesh.isVisible=!1,s.initSpin(),this.hideRecordingOverlay(),this._landingZoneTracker.reset(),this._wheelSpinner.setAngularVelocity(gt.Pq.Zero()),this._bouncesLeft=0+Math.floor(3*Math.random()),console.log("Wheel Acceleration Started"),await this.changeWheelSpeed(vt.WheelSpinSpeedRadPerSec,1,$t.easeInQuad),console.log("Wheel Acceleration Complete");const t=`Rec Id: [${(new Date).toISOString()}]`;this.showRecordingOverlay(t,"#ff000010");const i=this._motionRecorder.beginRecording([new uA("ball",(()=>{const e=this._ball.getObjectCenterWorld(),t=gt.Pq.TransformCoordinates(e,this._ballAnimContainer.getWorldMatrix().clone().invert()),i=new Wc(t.x,t.y,t.z);return new Xc(i)}),1/30),new uA("wheel",(()=>{const e=this._wheelSpinner.transformNode.rotationQuaternion;let t;return e&&(t=new Hc(e.x,e.y,e.z,e.w)),new Xc(void 0,t)}),1/15)]),r=this._wheelSpinner.transformNode.rotationQuaternion??(()=>{throw new Error("No wheel quaternion")})(),n=new Hc(r.x,r.y,r.z,r.w),o=await Promise.all([(async()=>{console.log("Ball Launched"),i.addMarker("ball_lauched");const e=2*-Math.PI*1,t=s.spin({radPerSec:e}),r=2*Math.PI/Math.abs(e),n=1*r;return await si.Delay(1e3*(n+Math.random()*r)),i.addMarker("ball_fall_begin"),t})()]),a=o[0];await a.fall();const h=await ce(this._landingZoneTracker.numberTriggered);i.addMarker("ball_landed"),console.log(`Ball landed at: ${h.name}`),i.addMarker("wheel_stopping"),await this.changeWheelSpeed(0,vt.WheelStopDurationS,$t.easeOutSine),i.addMarker("wheel_stopped"),this.hideRecordingOverlay();const l=i.end(),c=new su(t,n,vt.WheelSpinSpeedRadPerSec,l,e.DoubleZero,h);this._ballAnimation=c,console.log("Recording ended")})():"p"===r.key?this.togglePhysicsViewer():"o"===r.key?this._ballAnimation&&(async e=>{this.showRecordingOverlay(e.id,"#00ff0010"),await this.playBallAnimation(e),this.hideRecordingOverlay()})(this._ballAnimation):"d"===r.key?this._ballAnimation&&this.downloadRecording(this._ballAnimation):"l"===r.key&&(async()=>{const t=this._numSet.getZeroBasedSequenceClockwise(e.DoubleZero),i=Math.floor(Math.random()*t.length);await this._wheelView.playBallAnimation(this._motionPlayer,this._loadedSpinAnimations[0],t[i])})()})),this._scene.getPhysicsEngine()?.setGravity(new gt.Pq(0,-9.8,0))}async playBallAnimation(e,t){this._animatedBallInstance&&(this._animatedBallInstance.dispose(),this._animatedBallInstance=void 0),this._ballMesh.isVisible=!1,this._ball.setMotionType(Vx.STATIC);const i=this._wheelSpinner.transformNode.rotationQuaternion??(()=>{throw new Error})(),s=new gt.PT(e.initialWheelRotation.x,e.initialWheelRotation.y,e.initialWheelRotation.z,e.initialWheelRotation.w),r=i.multiply(s.invert()),n=this._ballAnimContainer.clone("ball-container",null,!0)??(()=>{throw new Error})();if(n.rotationQuaternion=r,t){console.log(`Should stop at number: ${t.number.name}`);const i=t.clockwiseSequence.length;let s=0,r=0;t.clockwiseSequence.forEach(((i,n)=>{i===t.number?r=n:i===e.endingNumber&&(s=n)}));let o=s-r;const a=2*Math.PI/i,h=gt.PT.FromEulerAngles(0,a*o,0);n.rotationQuaternion=n.rotationQuaternion.multiply(h)}this._wheelSpinner.setAngularVelocity(gt.Pq.Zero());const o=QA.createBallMesh({color:bt.v9.Random(),radius:vt.BallRadius},this._scene);this._animatedBallInstance=o,o.setParent(n),console.log("Motion play session started..."),await this._motionPlayer.play(e.motionRecording,(e=>{const t=e.get("ball");t&&t.position&&o.position.set(t.position.x,t.position.y,t.position.z);const i=e.get("wheel");i&&i.rotation&&(this._wheelSpinner.transformNode.rotationQuaternion=new gt.PT(i.rotation.x,i.rotation.y,i.rotation.z,i.rotation.w).multiply(r))}),(e=>{console.log(`Markers: [${e.join(",")}]`)})),o.setParent(this._wheelSpinner.transformNode),n?.dispose(),console.log("Motion play session complete")}changeWheelSpeed(e,t,i){const s=this._wheelSpinner,r={set velocity(e){s.setAngularVelocity(new gt.Pq(0,e,0))},get velocity(){return s.getAngularVelocity().y}};return Jt.add({duration:t,ease:i,target:r},{velocity:e})}generateNumbersHitZones(e,t,i,s,r){const n=new Map,o=t.getZeroBasedSequenceClockwise(e),a=360/o.length;let h=i.singleZeroAngleDeg;return o.forEach(((e,t)=>{const o=ha.CreateSphere(`HZ_${e.name}`,{segments:32,diameter:2*s.radius});o.isVisible=!1;const l=new ft.F(`mat-${o.name}`);l.diffuseColor=0==t?bt.v9.Green():1==t?bt.v9.Red():bt.v9.White(),o.material=l,o.setParent(i.spinnerNode),o.absolutePosition;const c=h*Math.PI/180,u=i.radius*Math.cos(c),d=i.radius*Math.sin(c),_=new gt.Pq(u,i.yPosition,d);o.setPositionWithLocalVector(_),o.setParent(null);const p=new Hx(o,Vx.DYNAMIC,!1,r);p.shape=new Xx(gt.Pq.Zero(),s.radius,r),p.shape.isTrigger=!0,this.registerPhysicsBody(p);const g=new lA(Lx.LOCK,{pivotA:_,pivotB:gt.Pq.Zero()},r);i.spinnerBody.addConstraint(p,g),n.set(p,e),h+=a})),n}downloadRecording(e){const t=e.toJSONString(),i=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(i),r=`rec-${e.id}.json`,n=document.createElement("a");n.href=s,n.download=r,n.click(),URL.revokeObjectURL(s)}onResize(e){this._engine.resize()}showRecordingOverlay(e,t){this._recordingOverlay.show(e,t)}hideRecordingOverlay(){this._recordingOverlay.hide()}registerPhysicsBody(e){this._physicsBodies.push(e),this._physicsShown&&this._physicsViewer.showBody(e)}registerConstraint(e){this._physicsConstraints.push(e),this._physicsShown&&this._physicsViewer.showConstraint(e)}togglePhysicsViewer(){this._physicsShown?(this._physicsBodies.forEach((e=>{this._physicsViewer.hideBody(e)})),this._physicsConstraints.forEach((e=>{this._physicsViewer.hideConstraint(e)}))):(this._physicsBodies.forEach((e=>{this._physicsViewer.showBody(e)})),this._physicsConstraints.forEach((e=>{this._physicsViewer.showConstraint(e)}))),this._physicsShown=!this._physicsShown}static createBallMesh(e,t,i){const s=ha.CreateSphere("ball",{segments:32,diameter:2*e.radius},t),r=new ft.F("ball-material");return r.diffuseColor=e.color,s.material=r,s.receiveShadows=!0,i&&i.addShadowCaster(s),s}}QA.TN_Spinner="RouletteRotor",QA.TN_Emblem="EmblemRotate",QA.TN_WheelStatic="StaticBase",QA.MN_SpinnerPlatform="BallLandingPlafform_";class KA{constructor(e,t,i,s){this._tickDelegate=()=>{},this._scene=s,this._ball=e,this._mesh=t,this._spinCenter=i.center,this._spinRadius=i.radius,this._ball.setMotionType(Vx.ANIMATED),e.disablePreStep=!1}hide(){this._ball.setMotionType(Vx.STATIC),this._mesh.isVisible=!1,this._ball.shape&&(this._ball.shape.isTrigger=!0)}show(){this._ball.setMotionType(Vx.STATIC),this._mesh.isVisible=!0,this._ball.shape&&(this._ball.shape.isTrigger=!1)}initSpin(){this._ball.setMotionType(Vx.ANIMATED);const e=this._spinCenter,t=this._spinRadius,i=this._ball,s=e.x+t*Math.sin(0),r=e.y,n=e.z+t*Math.cos(0);i.transformNode.position.set(s,r,n)}spin(e){this._ball.setMotionType(Vx.ANIMATED);let t=0;const i=2*Math.PI,s=this._spinCenter,r=this._spinRadius,n=this._ball;return this._tickDelegate=o=>{for(t+=e.radPerSec*o;t<0;)t+=i;for(;t>i;)t-=i;const a=s.x+r*Math.sin(t),h=s.y,l=s.z+r*Math.cos(t);n.transformNode.position.set(a,h,l)},this._tickDelegate(0),this.show(),new YA(n,{center:s,radPerSec:e.radPerSec},(()=>{this._tickDelegate=()=>{}}).bind(this),(()=>t),this._scene)}tick(e){this._tickDelegate(e)}}class YA{constructor(e,t,i,s,r){this._ball=e,this._angularSpeed=t.radPerSec,this._center=t.center,this._fallStartDelegate=i,this._angleGetter=s}async fall(){this._fallStartDelegate(),await si.Delay(1),this._ball.setMotionType(Vx.DYNAMIC);const e=gt.Pq.Distance(this._ball.transformNode.position,this._center),t=this._angularSpeed*e*.75,i=this._angleGetter()+5*Math.PI/180*Math.sign(this._angularSpeed),s=new gt.Pq(Math.cos(i)*t,0,-Math.sin(i)*t);this._ball.setLinearVelocity(s)}}class jA{constructor(e){this._running=!0,this._zoneTriggered=new X,this._requiredIntervalS=e,this._currentNumber=null}numberZoneEnter(e){this._running&&(this._currentNumber=e,this._timeInCurrentZoneS=0)}numberZoneExit(e){this._running&&e===this._currentNumber&&(this._currentNumber=null,this._timeInCurrentZoneS=0)}tick(e){this._running&&null!=this._currentNumber&&(this._timeInCurrentZoneS+=e,this._timeInCurrentZoneS>=this._requiredIntervalS&&(this._zoneTriggered.next(this._currentNumber),this._running=!1))}get numberTriggered(){return this._zoneTriggered}reset(){this._currentNumber=null,this._timeInCurrentZoneS=0,this._running=!0}}class ZA{constructor(e,t,i){this._container=e,this._bg=t,this._textField=i}show(e,t){this._textField.text=e,this._bg.background=t,this._container.isVisible=!0}hide(){this._container.isVisible=!1}}class $A{static getAssetPathMap(e){return new Map([[Oe.MainScene,"models/roulette.glb"],[Oe.Chip,"models/chipTex_Black.glb"],[Oe.MainSceneNoCamAnimation,"models/roulette_layoutB.glb"],[Le.BallAnimations,"animations/ball_animations.json.gz"],[Fe.SFX_Spin_1,"audio/sfx/Roulette_SFX_Spin1.mp3"],[Fe.SFX_Spin_2,"audio/sfx/Roulette_SFX_Spin2.mp3"],[Fe.SFX_Spin_3,"audio/sfx/Roulette_SFX_Spin3.mp3"],[Fe.SFX_Spin_4,"audio/sfx/Roulette_SFX_Spin4.mp3"],[Fe.SFX_Spin_5,"audio/sfx/Roulette_SFX_Spin5.mp3"],[Fe.SFX_Spin_6,"audio/sfx/Roulette_SFX_Spin6.mp3"],[Fe.SFX_Spin_7,"audio/sfx/Roulette_SFX_Spin7.mp3"],[Fe.SFX_Spin_8,"audio/sfx/Roulette_SFX_Spin8.mp3"],[Fe.SFX_Spin_9,"audio/sfx/Roulette_SFX_Spin9.mp3"],[Fe.SFX_Spin_10,"audio/sfx/Roulette_SFX_Spin10.mp3"],[Fe.SFX_Spin_11,"audio/sfx/Roulette_SFX_Spin11.mp3"],[Fe.SFX_Spin_12,"audio/sfx/Roulette_SFX_Spin12.mp3"],[Fe.SFX_Spin_13,"audio/sfx/Roulette_SFX_Spin13.mp3"],[Fe.SFX_Spin_14,"audio/sfx/Roulette_SFX_Spin14.mp3"],[Fe.SFX_Spin_15,"audio/sfx/Roulette_SFX_Spin15.mp3"],[Fe.SFX_ChipSelect,"audio/sfx/Roulette_Sound_ChipSelect.mp3"],[Fe.SFX_PlacedSingleChip,"audio/sfx/Roulette_Sound_SingleChipPlaced.mp3"],[Fe.SFX_PlacedChipStack,"audio/sfx/Roulette_Sound_ChipStackPlaced.mp3"],[Fe.SFX_Lose,"audio/sfx/Roulette_Sound_Lose.mp3"],[Fe.SFX_ClearTable,"audio/sfx/Roulette_Sound_Table Clear.mp3"],[Fe.SFX_UI_Click,"audio/sfx/Roulette_Sound_UI Click.mp3"],[Fe.SFX_UI_MenuClose,"audio/sfx/Roulette_Sound_UI Menu Close.mp3"],[Fe.SFX_UI_MenuOpen,"audio/sfx/Roulette_Sound_UI Open Menu.mp3"],[Fe.SFX_Win,"audio/sfx/Roulette_Sound_Win.mp3"],[Fe.SFX_WinBanner,"audio/sfx/Roulette_Win_Banner.mp3"],[Fe.Music_Heavy,"audio/music/BJ_Music_Heavy.mp3"],[Fe.Music_Neon,"audio/music/BJ_Music_Neon.mp3"],[Fe.Music_Blues,"audio/music/Roulette_Music_Blues.mp3"],[Fe.Music_Chill,"audio/music/Roulette_Music_Chill.mp3"],[Fe.Music_Groovy,"audio/music/Roulette_Music_Groovy.mp3"],[Fe.Music_Jazz,"audio/music/Roulette_Music_Jazz.mp3"],[Fe.Music_Lounge,"audio/music/Roulette_Music_Lounge.mp3"],[Fe.Music_Classical,"audio/music/Roulette_Music_classical.mp3"],[Fe.Music_CasinoAmbient,"audio/music/Roulette_Sound_CasinoAmb.mp3"],[Fe.VO_M_1,"audio/voice/male/1.mp3"],[Fe.VO_M_2,"audio/voice/male/2.mp3"],[Fe.VO_M_3,"audio/voice/male/3.mp3"],[Fe.VO_M_4,"audio/voice/male/4.mp3"],[Fe.VO_M_5,"audio/voice/male/5.mp3"],[Fe.VO_M_6,"audio/voice/male/6.mp3"],[Fe.VO_M_7,"audio/voice/male/7.mp3"],[Fe.VO_M_8,"audio/voice/male/8.mp3"],[Fe.VO_M_9,"audio/voice/male/9.mp3"],[Fe.VO_M_10,"audio/voice/male/10.mp3"],[Fe.VO_M_11,"audio/voice/male/11.mp3"],[Fe.VO_M_12,"audio/voice/male/12.mp3"],[Fe.VO_M_13,"audio/voice/male/13.mp3"],[Fe.VO_M_14,"audio/voice/male/14.mp3"],[Fe.VO_M_15,"audio/voice/male/15.mp3"],[Fe.VO_M_16,"audio/voice/male/16.mp3"],[Fe.VO_M_17,"audio/voice/male/17.mp3"],[Fe.VO_M_18,"audio/voice/male/18.mp3"],[Fe.VO_M_19,"audio/voice/male/19.mp3"],[Fe.VO_M_20,"audio/voice/male/20.mp3"],[Fe.VO_M_21,"audio/voice/male/21.mp3"],[Fe.VO_M_22,"audio/voice/male/22.mp3"],[Fe.VO_M_23,"audio/voice/male/23.mp3"],[Fe.VO_M_24,"audio/voice/male/24.mp3"],[Fe.VO_M_25,"audio/voice/male/25.mp3"],[Fe.VO_M_26,"audio/voice/male/26.mp3"],[Fe.VO_M_27,"audio/voice/male/27.mp3"],[Fe.VO_M_28,"audio/voice/male/28.mp3"],[Fe.VO_M_29,"audio/voice/male/29.mp3"],[Fe.VO_M_30,"audio/voice/male/30.mp3"],[Fe.VO_M_31,"audio/voice/male/31.mp3"],[Fe.VO_M_32,"audio/voice/male/32.mp3"],[Fe.VO_M_33,"audio/voice/male/33.mp3"],[Fe.VO_M_34,"audio/voice/male/34.mp3"],[Fe.VO_M_35,"audio/voice/male/35.mp3"],[Fe.VO_M_36,"audio/voice/male/36.mp3"],[Fe.VO_M_0,"audio/voice/male/0.mp3"],[Fe.VO_M_00,"audio/voice/male/00.mp3"],[Fe.VO_M_Black,"audio/voice/male/Black.mp3"],[Fe.VO_M_Red,"audio/voice/male/Red.mp3"],[Fe.VO_M_Odd,"audio/voice/male/Odd.mp3"],[Fe.VO_M_Even,"audio/voice/male/Even.mp3"],[Fe.VO_M_Place_Your_Bets,"audio/voice/male/Place_Your_Bets.mp3"],[Fe.VO_M_No_More_Bets,"audio/voice/male/No more bets.mp3"],[Fe.VO_M_Winner_Reg,"audio/voice/male/Winner_Reg.mp3"],[Fe.VO_M_Winner_High,"audio/voice/male/Winner_High.mp3"],[Fe.VO_M_Winner_Big,"audio/voice/male/Winner_Big.mp3"],[Fe.VO_M_HereWeGo,"audio/voice/male/HereWeGo.mp3"],[Fe.VO_M_Welcome_US_cpo,"audio/voice/male/brand/cpo/Welcome_US.mp3"],[Fe.VO_M_Welcome_US_sbk,"audio/voice/male/brand/sbk/Welcome_US.mp3"],[Fe.VO_M_Welcome_US_hso,"audio/voice/male/brand/hso/Welcome_US.mp3"],[Fe.VO_M_Welcome_EU_cpo,"audio/voice/male/brand/cpo/Welcome_EU.mp3"],[Fe.VO_M_Welcome_EU_sbk,"audio/voice/male/brand/sbk/Welcome_EU.mp3"],[Fe.VO_M_Welcome_EU_hso,"audio/voice/male/brand/hso/Welcome_EU.mp3"],[Fe.VO_F_1,"audio/voice/female/1.mp3"],[Fe.VO_F_2,"audio/voice/female/2.mp3"],[Fe.VO_F_3,"audio/voice/female/3.mp3"],[Fe.VO_F_4,"audio/voice/female/4.mp3"],[Fe.VO_F_5,"audio/voice/female/5.mp3"],[Fe.VO_F_6,"audio/voice/female/6.mp3"],[Fe.VO_F_7,"audio/voice/female/7.mp3"],[Fe.VO_F_8,"audio/voice/female/8.mp3"],[Fe.VO_F_9,"audio/voice/female/9.mp3"],[Fe.VO_F_10,"audio/voice/female/10.mp3"],[Fe.VO_F_11,"audio/voice/female/11.mp3"],[Fe.VO_F_12,"audio/voice/female/12.mp3"],[Fe.VO_F_13,"audio/voice/female/13.mp3"],[Fe.VO_F_14,"audio/voice/female/14.mp3"],[Fe.VO_F_15,"audio/voice/female/15.mp3"],[Fe.VO_F_16,"audio/voice/female/16.mp3"],[Fe.VO_F_17,"audio/voice/female/17.mp3"],[Fe.VO_F_18,"audio/voice/female/18.mp3"],[Fe.VO_F_19,"audio/voice/female/19.mp3"],[Fe.VO_F_20,"audio/voice/female/20.mp3"],[Fe.VO_F_21,"audio/voice/female/21.mp3"],[Fe.VO_F_22,"audio/voice/female/22.mp3"],[Fe.VO_F_23,"audio/voice/female/23.mp3"],[Fe.VO_F_24,"audio/voice/female/24.mp3"],[Fe.VO_F_25,"audio/voice/female/25.mp3"],[Fe.VO_F_26,"audio/voice/female/26.mp3"],[Fe.VO_F_27,"audio/voice/female/27.mp3"],[Fe.VO_F_28,"audio/voice/female/28.mp3"],[Fe.VO_F_29,"audio/voice/female/29.mp3"],[Fe.VO_F_30,"audio/voice/female/30.mp3"],[Fe.VO_F_31,"audio/voice/female/31.mp3"],[Fe.VO_F_32,"audio/voice/female/32.mp3"],[Fe.VO_F_33,"audio/voice/female/33.mp3"],[Fe.VO_F_34,"audio/voice/female/34.mp3"],[Fe.VO_F_35,"audio/voice/female/35.mp3"],[Fe.VO_F_36,"audio/voice/female/36.mp3"],[Fe.VO_F_0,"audio/voice/female/0.mp3"],[Fe.VO_F_00,"audio/voice/female/00.mp3"],[Fe.VO_F_Black,"audio/voice/female/Black.mp3"],[Fe.VO_F_Red,"audio/voice/female/Red.mp3"],[Fe.VO_F_Odd,"audio/voice/female/Odd.mp3"],[Fe.VO_F_Even,"audio/voice/female/Even.mp3"],[Fe.VO_F_Place_Your_Bets,"audio/voice/female/Place_Your_Bets.mp3"],[Fe.VO_F_No_More_Bets,"audio/voice/female/No more bets.mp3"],[Fe.VO_F_Winner_Reg,"audio/voice/female/Winner_Reg.mp3"],[Fe.VO_F_Winner_High,"audio/voice/female/Winner_High.mp3"],[Fe.VO_F_Winner_Big,"audio/voice/female/Winner_Big.mp3"],[Fe.VO_F_HereWeGo,"audio/voice/female/HereWeGo.mp3"],[Fe.VO_F_Welcome_US_cpo,"audio/voice/female/brand/cpo/Welcome_US.mp3"],[Fe.VO_F_Welcome_US_sbk,"audio/voice/female/brand/sbk/Welcome_US.mp3"],[Fe.VO_F_Welcome_US_hso,"audio/voice/female/brand/hso/Welcome_US.mp3"],[Fe.VO_F_Welcome_EU_cpo,"audio/voice/female/brand/cpo/Welcome_EU.mp3"],[Fe.VO_F_Welcome_EU_sbk,"audio/voice/female/brand/sbk/Welcome_EU.mp3"],[Fe.VO_F_Welcome_EU_hso,"audio/voice/female/brand/hso/Welcome_EU.mp3"],[Ne.Splash_Demo_1,"image/ui/sig-roulette-demo-splash-1.jpg"],[Ne.Splash_Demo_2,"image/ui/sig-roulette-demo-splash-2.png"],[Ne.Splash_Demo_3,"image/ui/sig-roulette-demo-splash-3.jpg"],[Ne.Splash_Demo_Check,"image/ui/sig-roulette-demo-splash-check.png"],[Ne.Splash_Demo_Btn_Agree,"image/ui/sig-roulette-demo-splash-btn-agree.png"],[Ne.Splash_PressToPlay,"image/ui/sig-roulette-press-to-play-button.png"],[Ne.IntroDialog_BG,"image/ui/intro/sig-roulette-acc-menu.png"],[Ne.IntroDialog_OK,"image/ui/intro/sig-roulette-acc-okay-button.png"],[Ne.IntroDialog_DontShowAgain,"image/ui/intro/sig-roulette-acc-dsa-button.png"],[Ne.UI_BtnUndo,"image/ui/rlt-undo-button-asset.png"],[Ne.UI_BtnClear,"image/ui/rlt-clear-button-asset.png"],[Ne.UI_BtnDouble,"image/ui/rlt-bet-2x-button-asset.png"],[Ne.UI_BtnRebet,"image/ui/rlt-rebet-button-asset.png"],[Ne.UI_BtnSkip,"image/ui/sig-roulette-stop-button.png"],[Ne.UI_BtnFavBet,"image/ui/sig-roulette-avorite-button.png"],[Ne.UI_BtnClose,"image/ui/sig-roulette-X-button.png"],[Ne.UI_BtnSettings,"image/ui/rlt-options-button-asset.png"],[Ne.UI_BtnAudioOn,"image/ui/rlt-sound-on-button-asset.png"],[Ne.UI_BtnAudioOff,"image/ui/rlt-sound-off-button-asset.png"],[Ne.UI_GenericGreenButton,"image/ui/rlt-button-asset.png"],[Ne.UI_BtnInfo,"image/ui/rlt-info-button-asset.png"],[Ne.UI_BtnNewGame,"image/ui/mhbj-new-game-button-asset.png"],[Ne.UI_MeterBalance,"image/ui/rlt-balance-meter-asset.png"],[Ne.UI_MeterBet,"image/ui/rlt-bet-meter-asset.png"],[Ne.UI_MeterWin,"image/ui/rlt-win-meter-asset.png"],[Ne.UI_Frame_Slice9,"image/ui/rlt-frame-scale-9.png"],[Ne.UI_PIP_Frame,"image/ui/sig-roulette-pip-box.png"],[Ne.UI_TableLimitsFrame,"image/ui/sig-roulette-table-limits.png"],[Ne.UI_BetSelector_Arrow,"image/ui/rlt-chip-arrow-select-button-asset.png"],[Ne.UI_Chip_Black,"image/chip/sig-roulette-black-chip.png"],[Ne.UI_Chip_Blue,"image/chip/sig-roulette-blue-chip.png"],[Ne.UI_Chip_Gray,"image/chip/sig-roulette-gray-chip.png"],[Ne.UI_Chip_Green,"image/chip/sig-roulette-green-chip.png"],[Ne.UI_Chip_Orange,"image/chip/sig-roulette-orange-chip.png"],[Ne.UI_Chip_Pink,"image/chip/sig-roulette-pink-chip.png"],[Ne.UI_Chip_Red,"image/chip/sig-roulette-red-chip.png"],[Ne.UI_Chip_White,"image/chip/sig-roulette-white-chip.png"],[Ne.UI_Chip_Yellow,"image/chip/sig-roulette-yellow-chip.png"],[Ne.UI_SmallDialogBox,"image/ui/sig-roulette-menu-box.png"],[Ne.UI_BtnAdd,"image/ui/sig-roulette-add-button.png"],[Ne.UI_BtnCancel,"image/ui/sig-roulette-cancel-button.png"],[Ne.UI_BtnConfirm,"image/ui/sig-roulette-confirm-button.png"],[Ne.UI_ToggleOn,"image/ui/rlt-on-button-back-asset.png"],[Ne.UI_ToggleOff,"image/ui/rlt-off-button-back-asset.png"],[Ne.UI_ToggleKnob,"image/ui/rlt-toggle-button-asset.png"],[Ne.UI_FavBet_EmptySlot,"image/ui/sig-roulette-fav-bar-long.png"],[Ne.UI_FavBet_LinkedSlot,"image/ui/sig-roulette-fav-bar-short.png"],[Ne.UI_FavBet_Background,"image/ui/sig-roulette-fav-menu-box.png"],[Ne.UI_FavBet_BtnDelete,"image/ui/sig-roulette-trash-button.png"],[Ne.UI_FavBet_Title,"image/ui/sig-roulette-favorite-bets-menu-title.png"],[Ne.UI_FavBet_EnterBetMessage,"image/ui/sig-roulette-enter-bet-name-copy.png"],[Ne.UI_FavBet_EnterBetTextBox,"image/ui/sig-roulette-textbox.png"],[Ne.UI_FavBet_DeleteConfirmationMessage,"image/ui/sig-roulette-delete-this-bet.png"],[Ne.UI_InfoDialog_Background,"image/ui/mhbj-info-menu-box-asset.png"],[Ne.UI_Stats_Wheel,"image/ui/stats/sig-roulette-numbers-wheel.png"],[Ne.UI_Stats_TitleHot,"image/ui/stats/sig-roulette-hot-numbers.png"],[Ne.UI_Stats_TitleCold,"image/ui/stats/sig-roulette-cold-numbers.png"],[Ne.UI_Stats_HotColdFrame,"image/ui/stats/sig-roulette-hot-cold-ui-box.png"],[Ne.UI_Stats_HotColdGrid,"image/ui/stats/sig-roulette-hot-cold-boxes.png"],[Ne.UI_Stats_Grid,"image/ui/stats/sig-roulette-grid.png"],[Ne.UI_Stats_Button,"image/ui/stats/sig-roulette-stats-bar-1.png"],[Ne.UI_Stats_UILastNumbersBar,"image/ui/stats/sig-roulette-stats-bar-2.png"],[Ne.UI_Stats_UILastNumberFrame,"image/ui/sig-roulette-latest-number-box.png"],[Ne.UI_RaceTrack_Background,"image/ui/racetrack/sig-roulette-aracetrack-box-ui.png"],[Ne.UI_RaceTrack_BtnPlus,"image/ui/racetrack/sig-roulette-add-button.png"],[Ne.UI_RaceTrack_BtnMinus,"image/ui/racetrack/sig-roulette-minus-button.png"],[Ne.UI_RaceTrack_Numbers,"image/ui/racetrack/sig-roulette-racetrack.png"],[Ne.UI_RaceTrack_HitZone_14,"image/ui/racetrack/sig-roulette-racetrack-highlight-2.png"],[Ne.UI_RaceTrack_HitZone_2,"image/ui/racetrack/sig-roulette-racetrack-highlight-3.png"],[Ne.UI_RaceTrack_HitZone_0,"image/ui/racetrack/sig-roulette-racetrack-highlight-4.png"],[Ne.UI_RaceTrack_HitZone_28,"image/ui/racetrack/sig-roulette-racetrack-highlight-1.png"],[Ne.UI_RaceTrack_HitZone_Rect,"image/ui/racetrack/sig-roulette-racetrack-highlight-5.png"],[Ne.UI_RaceTrack_Button,"image/ui/racetrack/sig-roulette-racetrack-button.png"],[Ne.UI_Settings_Background,"image/ui/settings/sig-roulette-menu-box-asset.png"],[Ne.UI_Settings_WheelAlt,"image/ui/settings/sig-roulette-alternating-button.png"],[Ne.UI_Settings_WheelCW,"image/ui/settings/sig-roulette-clockwise-button.png"],[Ne.UI_Settings_WheelCCW,"image/ui/settings/sig-roulette-counter-button.png"],[Ne.UI_AudioSettings_Background,"image/ui/rlt-audio-menu-box-asset.png"],[Ne.UI_WinningNumberPopup_Background,"image/ui/winningNumber/sig-roulette-winning-number-box.png"],[Ne.UI_WinningNumberPopup_Circle,"image/ui/winningNumber/sig-roulette-number-circle.png"],[Ne.UI_BetSpotHint_Background,"image/ui/bethint/sig-roulette-min-max-hint-box.png"],[Ne.UI_BetSpotHint_2X,"image/ui/bethint/sig-roulette-double-bet-button.png"],[Ne.UI_BetSpotHint_Add,"image/ui/bethint/sig-roulette-add-bet-button.png"],[Ne.UI_BetSpotHint_Clear,"image/ui/bethint/sig-roulette-trash-bet-button.png"],[Be.Skybox,"models/environment.env"],[De.Felt_CPO_Blue_SD,"image/brand/cpo/roulette-blue-felt-table-asset-sd.png"],[De.Felt_CPO_Green_SD,"image/brand/cpo/roulette-green-felt-table-asset-sd.png"],[De.Felt_CPO_Gray_SD,"image/brand/cpo/roulette-gray-felt-table-asset-sd.png"],[De.Felt_CPO_Red_SD,"image/brand/cpo/roulette-red-felt-table-asset-sd.png"],[De.Felt_HSO_Tan_SD,"image/brand/hso/roulette-hoc-tan-felt-table-asset.png"],[De.Felt_HSO_Black_SD,"image/brand/hso/roulette-hoc-black-felt-table-asset.png"],[De.Felt_HSO_Blue_SD,"image/brand/hso/roulette-hoc-blue-felt-table-asset.png"],[De.Felt_HSO_Gold_SD,"image/brand/hso/roulette-hoc-gold-felt-table-asset.png"],[De.Felt_SBK_Blue_SD,"image/brand/sbk/roulette-csb-blue-felt-table-asset.png"],[De.Felt_SBK_Green_SD,"image/brand/sbk/roulette-csb-green-felt-table-asset.png"],[De.Felt_SBK_Red_SD,"image/brand/sbk/roulette-csb-red-felt-table-asset.png"],[De.Felt_SBK_Gold_SD,"image/brand/sbk/roulette-csb-gold-felt-table-asset.png"],[De.BaseWoodTexture,"image/brand/hso/BaseWood.png"],[ke.Rubik,"fonts/Rubik.ttf"],[Ne.UI_BtnSpin,"cpo"===e?"image/brand/cpo/sig-roulette-spin-button.png":"hso"===e?"image/brand/hso/sig-roulette-hoc-spin-button.png":"sbk"===e?"image/brand/sbk/sig-roulette-csb-spin-button.png":(()=>{throw new Z(`Undefined asset path for id ${Ne.UI_BtnSpin}, brand: ${e}`)})()],[Ne.UI_BtnRebetAndSpin,"cpo"===e?"image/brand/cpo/sig-roulette-rebet-spin.png":"hso"===e?"image/brand/hso/sig-roulette-hoc-rebet-spin.png":"sbk"===e?"image/brand/sbk/sig-roulette-csb-rebet-spin.png":(()=>{throw new Z(`Undefined asset path for id ${Ne.UI_BtnRebetAndSpin}, brand: ${e}`)})()],[Ne.UI_Stats_WheelCap,"cpo"===e?"image/brand/cpo/sig-roulette-cpo-cap.png":"hso"===e?"image/brand/hso/sig-roulette-hoc-cap.png":"sbk"===e?"image/brand/sbk/sig-roulette-csb-cap.png":(()=>{throw new Z(`Undefined asset path for id ${Ne.UI_Stats_WheelCap}, brand: ${e}`)})()],[Ne.UI_Settings_FeltButtons,"cpo"===e?"image/brand/cpo/rlt-felt-colors-asset.png":"hso"===e?"image/brand/hso/sig-roulette-hoc-felt-asset.png":"sbk"===e?"image/brand/sbk/sig-roulette-csb-felt-asset.png":(()=>{throw new Z(`Undefined asset path for id ${Ne.UI_Settings_FeltButtons}, brand: ${e}`)})()],[De.Carpet,"hso"===e?"image/brand/hso/roulette-hoc-carpet-asset.png":"image/textures/roulette-carpet-asset.png"],[Ne.Splash_Background,"cpo"===e?"image/brand/cpo/sign-roulette-cpoc-splash.png":"hso"===e?"image/brand/hso/sign-roulette-hoc-splash.png":"sbk"===e?"image/brand/sbk/sign-roulette-csb-splash.png":(()=>{throw new Z(`Undefined asset path for id ${Ne.Splash_Background}, brand: ${e}`)})()]])}}class JA{constructor(){this._gameMode="FullGame",this._preloadAllAudio=!1,this.gameCode="CPO_RLT_US",this.gameCodePostfix="",this._gameType=e.DoubleZero,this._betConfigStore=new pe,this._playerBalance=new he(0),this._compositeResizeHandler=new xe,this._logSettings={minLevel:1},this._logManager=new qA(this._logSettings),this._log=this._logManager.getLogger("Game")}async init(e,t,i,s,r,n){const o=document.getElementsByClassName(t)[0],a=["cpo","hso","sbk"].includes(window.__GAME_INFO__.brand??"")?window.__GAME_INFO__.brand:"cpo";this._logSettings.minLevel=!0===n.devtools?0:4;const h=new Te(e,$A.getAssetPathMap(a)),l=new re(!0,!0);switch(this._gameMode){case"FullGame":const e=this._babylonGame=new Ox(o,i,h,r,this._gameType,a,l,{manager:this._logManager,settings:this._logSettings},!0);this._compositeResizeHandler.register(this._babylonGame),this._startTask=async t=>{const i=(async()=>{this._log.debug("Waiting for a bet config...");const e=await ce(this._betConfigStore.observable);return this._log.debug("Bet config received"),e})();await e.build(i,t,this._playerBalance,this._preloadAllAudio,(e=>{this._clientEmitter.emit("GameLoadingProgress",e)}).bind(this)),await e.start()};break;case"PhysicsRecorder":const t=this._rouletteWheelPrototype=await QA.build(o,h,!1);this._compositeResizeHandler.register(t),this._startTask=async()=>{await t.start()}}this._clientEmitter=i,JA.localise=s,JA.formatAmount=r,JA.layout=Gd.any?"mobile":"desktop";const c=new me(this._betConfigStore);this._clientEmitter.on("FrameBetConfig",(e=>{this._log.debug(`Bet Config Received: ${JSON.stringify(e)}`),c.execute(e)})),await this.create(n),this._clientEmitter.emit("GameLoadingProgress",.5),window.addEventListener("resize",(()=>this.onResize())),window.addEventListener("orientationchange",(()=>this.onResize())),this.onResize()}async start(e){this._log.debug("Start begin"),await this._startTask(e),this._clientEmitter.emit("GameLoadingProgress",1),this._log.debug("Start End")}async create(e){new be(this._clientEmitter,this._playerBalance).start()}onResize(){const[e,t]=[2331,1095],[i,s]=[window.innerWidth,window.innerHeight],r=i<s?ue.portrait:ue.landscape,n=r===ue.portrait?t:e,o=r===ue.portrait?e:t;let a=0;a=i/s>n/o?s/o:i/n;const h=new ye({width:i,height:s,orientation:r,previousOrientation:this._currentOrientation,scale:a,referenceSizeLandscape:{w:e,h:t}});this._compositeResizeHandler.onResize(h),this._currentOrientation=r}}const eC=new JA,tC=$d(),iC={base:{general:94.74,topLine:92.11}}})(),GameClient=a})();